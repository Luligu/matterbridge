import{B as e,y as r,S as st,I as Ee,U as gr,V as hr,X as Ye,Y as xr,Z as fr}from"./vendor_node_modules.js";import{u as br,S as vr}from"./vendor_notistack.js";import{D as Ie,a as De,b as Ne,B as re,c as X,A as yr,I as z,C as jr,T as H,S as Cr,F as Yt,H as Sr,d as Xt,e as Ve,R as vt,P as ze,M as wr,f as tt,g as W,L as K,h as te,i as lt,V as dt,j as He,k as Dt,l as Mr,m as kr,n as pe,o as Ir,p as Dr,q as yt,r as le,s as We,K as Lt,t as Rt,u as Ct,v as ct,w as nt,x as pt,W as it,y as ut,z as mt,E as Pe,G as Ht,J as Ot,N as Nr,O as Pr,Q as at,U as Te,X as Be,Y as Zt,Z as Tr,_ as Wr,$ as Fr,a0 as Lr,a1 as er,a2 as jt,a3 as Rr,a4 as Hr,a5 as Or,a6 as $r,a7 as $t,a8 as Er,a9 as Vr,aa as Ar,ab as _r,ac as Ur,ad as zr,ae as qr,af as Et,ag as Br,ah as Jr,ai as Qr,aj as Gr,ak as Kr,al as Yr,am as Xr,an as Zr,ao as eo,ap as to,aq as ro,ar as oo,as as no,at as io,au as ao,av as Vt,aw as rt,ax as tr,ay as ke,az as rr,aA as St,aB as Ae,aC as so,aD as lo}from"./vendor_mui.js";import{Q as co}from"./vendor_qrcode.js";import{I as ee,m as At,a as po,b as uo,c as _t,d as mo,e as Tt,f as Wt,g as go,h as ho,i as xo,j as fo,k as bo,l as vo,n as yo,o as jo,p as Ut,q as Co,r as So,s as wo,t as Mo,u as ko,v as Io,w as Do,x as No,y as zt,z as Po,A as To,B as Wo}from"./vendor_mdi.js";import{r as _e}from"./vendor_react_table.js";import{F as Fo,v as Lo,e as Ro,a as Ho,g as Oo,b as $o,c as Eo,d as Nt,A as Vo}from"./vendor_rjsf.js";import"./vendor_lodash.js";import"./vendor_emotion.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const h of a)if(h.type==="childList")for(const v of h.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&n(v)}).observe(document,{childList:!0,subtree:!0});function i(a){const h={};return a.integrity&&(h.integrity=a.integrity),a.referrerPolicy&&(h.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?h.credentials="include":a.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function n(a){if(a.ep)return;a.ep=!0;const h=i(a);fetch(a.href,h)}})();/**
 * This file contains the types for WebSocket messages.
 *
 * @file frontendTypes.ts
 * @author Luca Liguori
 * @created 2025-09-17
 * @version 1.0.0
 * @license Apache-2.0
 *
 * Copyright 2025, 2026, 2027 Luca Liguori.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Se=(o=>(o[o.Log=0]="Log",o[o.RefreshRequired=1]="RefreshRequired",o[o.RestartRequired=2]="RestartRequired",o[o.RestartNotRequired=3]="RestartNotRequired",o[o.CpuUpdate=4]="CpuUpdate",o[o.MemoryUpdate=5]="MemoryUpdate",o[o.UptimeUpdate=6]="UptimeUpdate",o[o.Snackbar=7]="Snackbar",o[o.UpdateRequired=8]="UpdateRequired",o[o.StateUpdate=9]="StateUpdate",o[o.CloseSnackbar=10]="CloseSnackbar",o[o.ShellySysUpdate=100]="ShellySysUpdate",o[o.ShellyMainUpdate=101]="ShellyMainUpdate",o))(Se||{});function Ao(o){return o.id>=0&&o.id<=101}function _o({open:o,title:c,message:i,onConfirm:n,onCancel:a}){const h=t=>{l&&console.log("Confirmed"),t.preventDefault(),n()},v=t=>{l&&console.log("Canceled"),t.preventDefault(),a()};return e.jsxs(Ie,{open:o,children:[e.jsx(De,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:c})]})}),e.jsxs(Ne,{children:[e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",margin:"0",marginBottom:"20px",maxHeight:"350px",maxWidth:"350px"},children:e.jsx("p",{style:{flex:1,margin:"0"},children:i})}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-around"},children:[e.jsx(re,{onClick:h,variant:"contained",color:"primary",size:"small",children:"Confirm"}),e.jsx(re,{onClick:v,variant:"contained",color:"primary",size:"small",children:"Cancel"})]})]})]})}const gt=[],ot=r.createContext(null);function Uo({children:o}){const{enqueueSnackbar:c,closeSnackbar:i}=br(),n=r.useCallback(y=>{l&&console.log(`UiProvider closeSnackbarMessage: message ${y}`);const F=gt.findIndex($=>$.message===y);F!==-1&&(i(gt[F].key),gt.splice(F,1),l&&console.log(`UiProvider closeSnackbarMessage: message ${y} removed from persistMessages`))},[i]),a=r.useCallback((y,F,$)=>{l&&console.log(`UiProvider showSnackbarMessage: message ${y} timeout ${F}`);const _=c(y,{variant:"default",autoHideDuration:F==null||F>0?(F??5)*1e3:null,persist:F===0,content:J=>e.jsx(X,{sx:{margin:"0",padding:"0",width:"300px",marginRight:"30px"},children:e.jsx(yr,{severity:$??"info",variant:"filled",sx:{color:"#fff",fontWeight:"normal",width:"100%",cursor:"pointer",padding:"0px 10px"},onClick:()=>i(J),action:e.jsx(z,{size:"small",onClick:()=>i(J),sx:{color:"#fff"},children:e.jsx(jr,{fontSize:"small"})}),children:y},J)},J)});F===0&&(l&&console.log(`UiProvider showSnackbarMessage: message ${y} timeout ${F} - persist key ${_}`),gt.push({message:y,key:_}))},[c,i]),[h,v]=r.useState(!1),[t,s]=r.useState(""),[M,N]=r.useState(""),[C,T]=r.useState(""),E=r.useRef(null),S=r.useRef(null),O=()=>{l&&console.log(`UiProvider handle confirm action ${C}`),v(!1),E.current&&E.current(C)},u=()=>{l&&console.log(`UiProvider handle cancel action ${C}`),v(!1),S.current&&S.current(C)},q=r.useCallback((y,F,$,_,J)=>{l&&console.log(`UiProvider showConfirmCancelDialog for command ${$}`),s(y),N(F),T($),E.current=_,S.current=J,v(!0)},[]),b=r.useMemo(()=>({showSnackbarMessage:a,closeSnackbarMessage:n,closeSnackbar:i,showConfirmCancelDialog:q}),[a,n,i,q]);return e.jsxs(ot.Provider,{value:b,children:[e.jsx(_o,{open:h,title:t,message:M,onConfirm:O,onCancel:u}),o]})}const or=r.createContext(null),xe=r.createContext(null);function zo({children:o}){const[c,i]=r.useState(localStorage.getItem("logFilterLevel")??"info"),[n,a]=r.useState(localStorage.getItem("logFilterSearch")??"*"),[h,v]=r.useState([]),[t,s]=r.useState(1e3),[M,N]=r.useState(!0),[C,T]=r.useState(!1),{showSnackbarMessage:E,closeSnackbarMessage:S,closeSnackbar:O}=r.useContext(ot),u=r.useRef([]),q=r.useRef(null),b=r.useRef(1),y=r.useRef(Math.floor(Math.random()*999e3)+1e3),F=r.useRef(null),$=r.useRef(null),_=r.useRef(null),J=r.useRef(c),f=r.useRef(n),p=r.useMemo(()=>window.location.href.replace(/^http/,"ws"),[]),x=r.useMemo(()=>window.location.href.includes("api/hassio_ingress"),[]),j=100,R=60,de=50,fe=300;r.useEffect(()=>{J.current=c},[c]),r.useEffect(()=>{f.current=n},[n]);const w=r.useCallback(()=>Math.floor(Math.random()*999e3)+1e3,[]),m=r.useCallback(I=>{if(q.current&&q.current.readyState===WebSocket.OPEN)try{I.id===void 0&&(I.id=y.current);const g=JSON.stringify(I);q.current.send(g),l&&console.log("WebSocket sent message:",I)}catch(g){l&&console.error(`WebSocket error sending message: ${g}`)}else l&&console.error("WebSocket message not sent, WebSocket not connected:",I)},[]),V=r.useCallback((I,g)=>{const d=`<span style="background-color: #5c0e91; color: white; padding: 1px 5px; font-size: 12px; border-radius: 3px;">${I}</span>`;v(L=>[...L,d+' <span style="color: var(--main-log-color);">'+g+"</span>"])},[]),P=r.useCallback((I,g)=>{i(I),a(g),V("WebSocket",`Filtering by log level "${I}" and log search "${g}"`)},[V]),Z=r.useCallback(I=>{l&&console.log("WebSocket addListener:",I),u.current=[...u.current,I],l&&console.log("WebSocket addListener total listeners:",u.current.length)},[]),he=r.useCallback(I=>{l&&console.log("WebSocket removeListener:",I),u.current=u.current.filter(g=>g!==I),l&&console.log("WebSocket removeListener total listeners:",u.current.length)},[]),we=r.useCallback(()=>{p===""||p===null||p===void 0||(V("WebSocket",`Connecting to WebSocket: ${p}`),q.current=new WebSocket(p),q.current.onmessage=I=>{C||T(!0);try{const g=JSON.parse(I.data);if(g.id===void 0)return;if(g.error&&l&&console.error("WebSocket error message:",g),g.id===y.current&&g.src==="Matterbridge"&&g.dst==="Frontend"&&g.response==="pong"){l&&console.log("WebSocket pong response message:",g,"listeners:",u.current.length),$.current&&clearTimeout($.current),u.current.forEach(L=>L(g));return}if(g.id===Se.RefreshRequired){l&&console.log("WebSocket WS_ID_REFRESH_REQUIRED message:",g,"listeners:",u.current.length),u.current.forEach(L=>L(g));return}else if(g.id===Se.RestartRequired){l&&console.log("WebSocket WS_ID_RESTART_REQUIRED message:",g,"listeners:",u.current.length),u.current.forEach(L=>L(g));return}else if(g.id===Se.RestartNotRequired){l&&console.log("WebSocket WS_ID_RESTART_NOT_REQUIRED message:",g,"listeners:",u.current.length),u.current.forEach(L=>L(g));return}else if(g.id===Se.CpuUpdate){l&&console.log("WebSocket WS_ID_CPU_UPDATE message:",g,"listeners:",u.current.length),u.current.forEach(L=>L(g));return}else if(g.id===Se.MemoryUpdate){l&&console.log("WebSocket WS_ID_MEMORY_UPDATE message:",g,"listeners:",u.current.length),u.current.forEach(L=>L(g));return}else if(g.id===Se.UptimeUpdate){l&&console.log("WebSocket WS_ID_UPTIME_UPDATE message:",g,"listeners:",u.current.length),u.current.forEach(L=>L(g));return}else if(g.id===Se.Snackbar&&g.params&&g.params.message){l&&console.log("WebSocket WS_ID_SNACKBAR message:",g,"listeners:",u.current.length),E(g.params.message,g.params.timeout,g.params.severity);return}else if(g.id===Se.CloseSnackbar&&g.params&&g.params.message){l&&console.log("WebSocket WS_ID_CLOSE_SNACKBAR message:",g,"listeners:",u.current.length),S(g.params.message);return}else if(g.id===Se.ShellySysUpdate){l&&console.log("WebSocket WS_ID_SHELLY_SYS_UPDATE message:",g,"listeners:",u.current.length),u.current.forEach(L=>L(g));return}else if(g.id===Se.ShellyMainUpdate){l&&console.log("WebSocket WS_ID_SHELLY_MAIN_UPDATE message:",g,"listeners:",u.current.length),u.current.forEach(L=>L(g));return}else if(g.id!==Se.Log){l&&console.log("WebSocket message:",g,"listeners:",u.current.length),u.current.forEach(L=>L(g));return}if(!g.params||!g.params.level||!g.params.time||!g.params.name||!g.params.message||["debug","info","notice","warn","error","fatal"].includes(g.params.level)&&(J.current==="info"&&g.params.level==="debug"||J.current==="notice"&&(g.params.level==="debug"||g.params.level==="info")||J.current==="warn"&&(g.params.level==="debug"||g.params.level==="info"||g.params.level==="notice")||J.current==="error"&&(g.params.level==="debug"||g.params.level==="info"||g.params.level==="notice"||g.params.level==="warn")||J.current==="fatal"&&(g.params.level==="debug"||g.params.level==="info"||g.params.level==="notice"||g.params.level==="warn"||g.params.level==="error"))||f.current!=="*"&&f.current!==""&&!g.params.message.toLowerCase().includes(f.current.toLowerCase())&&!g.params.name.toLowerCase().includes(f.current.toLowerCase())||g.params.name==="Commissioning"&&g.params.message.includes("is uncommissioned"))return;v(L=>{const ne=`<span style="color: #505050;">[${g.params?.time}]</span>`,ae=be=>{switch(be?.toLowerCase()){case"debug":return"gray";case"info":return"#267fb7";case"notice":return"green";case"warn":return"#e9db18";case"error":return"red";case"fatal":return"#ff0000";case"spawn":return"#ff00d0";default:return"lightblue"}},B=be=>{switch(be?.toLowerCase()){case"warn":return"black";default:return"white"}},me=`${`<span style="background-color: ${ae(g.params?.level)}; color: ${B(g.params?.level)}; padding: 1px 5px; font-size: 12px; border-radius: 3px;">${g.params?.level}</span>`} ${ne} <span style="color: #09516d;">[${g.params?.name}]</span> <span style="color: var(--main-log-color);">${g.params?.message}</span>`,oe=[...L,me];return oe.length>t?oe.slice(t/10):oe})}catch(g){console.error(`WebSocketUse error parsing message: ${g}`)}},q.current.onopen=()=>{l&&console.log(`WebSocket: Connected to WebSocket: ${p}`),V("WebSocket",`Connected to WebSocket: ${p}`),T(!0),O(),b.current=1,_.current=setTimeout(()=>{F.current=setInterval(()=>{m({id:y.current,method:"ping",src:"Frontend",dst:"Matterbridge",params:{}}),$.current&&clearTimeout($.current),$.current=setTimeout(()=>{l&&console.error(`WebSocketUse: No pong response received from WebSocket: ${p}`),V("WebSocket",`No pong response received from WebSocket: ${p}`),T(!1)},1e3*de)},1e3*R)},1e3*fe)},q.current.onclose=()=>{l&&console.error(`WebSocket: Disconnected from WebSocket ${x?"with Ingress":""}: ${p}`),V("WebSocket",`Disconnected from WebSocket: ${p}`),T(!1),O(),_.current&&clearTimeout(_.current),$.current&&clearTimeout($.current),F.current&&clearInterval(F.current),V("WebSocket",`Reconnecting (attempt ${b.current} of ${j}) to WebSocket${x?" (Ingress)":""}: ${p}`),x?setTimeout(U,5e3):b.current===1?U():b.current<j?setTimeout(U,1e3*b.current):V("WebSocket",`Reconnect attempts exceeded limit of ${j} retries, refresh the page to reconnect to: ${p}`),b.current=b.current+1},q.current.onerror=I=>{l&&console.error(`WebSocket: WebSocket error connecting to ${p}:`,I),V("WebSocket",`WebSocket error connecting to ${p}`)})},[p]),U=r.useCallback(()=>{l&&console.log(`WebSocket attemptReconnect ${b.current}/${j} to:`,p),we()},[we]);r.useEffect(()=>(we(),()=>{q.current&&q.current.readyState===WebSocket.OPEN&&q.current.close()}),[we]);const k=r.useMemo(()=>({messages:h,maxMessages:t,autoScroll:M,setMessages:v,setLogFilters:P,setMaxMessages:s,setAutoScroll:N}),[h,v,P]),D=r.useMemo(()=>({maxMessages:t,autoScroll:M,logFilterLevel:c,logFilterSearch:n,setMessages:v,setLogFilters:P,setMaxMessages:s,setAutoScroll:N,online:C,retry:b.current,getUniqueId:w,addListener:Z,removeListener:he,sendMessage:m,logMessage:V}),[t,M,v,P,s,N,C,b.current,Z,he,m,V]);return e.jsx(or.Provider,{value:k,children:e.jsx(xe.Provider,{value:D,children:o})})}function qo(){const{showSnackbarMessage:o,showConfirmCancelDialog:c}=r.useContext(ot),{online:i,sendMessage:n,logMessage:a,addListener:h,removeListener:v,getUniqueId:t}=r.useContext(xe),[s,M]=r.useState(!1),[N,C]=r.useState(!1),[T,E]=r.useState(!1),[S,O]=r.useState(!1),[u,q]=r.useState(null),b=r.useRef(t()),[y,F]=r.useState(null),[$,_]=r.useState(null),[J,f]=r.useState(null),[p,x]=r.useState(null),[j,R]=r.useState(null),de=()=>{window.open("https://www.buymeacoffee.com/luligugithub","_blank")},fe=()=>{window.open("https://github.com/Luligu/matterbridge/blob/main/README.md","_blank")},w=()=>{u.matterbridgeInformation.matterbridgeVersion.includes("-dev-")?window.open("https://github.com/Luligu/matterbridge/blob/dev/CHANGELOG.md","_blank"):window.open("https://github.com/Luligu/matterbridge/blob/main/CHANGELOG.md","_blank")},m=()=>{window.open("https://discord.gg/QX58CDe6hd","_blank")},V=()=>{window.open("https://github.com/Luligu/matterbridge","_blank")},P=()=>{n({id:b.current,sender:"Header",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:"matterbridge",restart:!0}})},Z=()=>{n({id:b.current,sender:"Header",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:"matterbridge@dev",restart:!0}})},he=()=>{n({id:b.current,sender:"Header",method:"/api/checkupdates",src:"Frontend",dst:"Matterbridge",params:{}})},we=()=>{l&&console.log("Header: handleShellySystemUpdateClick"),a("Matterbridge","Installing system updates..."),n({id:b.current,sender:"Header",method:"/api/shellysysupdate",src:"Frontend",dst:"Matterbridge",params:{}})},U=()=>{l&&console.log("Header: handleShellyMainUpdateClick"),a("Matterbridge","Installing software updates..."),n({id:b.current,sender:"Header",method:"/api/shellymainupdate",src:"Frontend",dst:"Matterbridge",params:{}})},k=()=>{l&&console.log("Header: handleShellyCreateSystemLog"),n({id:b.current,sender:"Header",method:"/api/shellycreatesystemlog",src:"Frontend",dst:"Matterbridge",params:{}})},D=()=>{l&&console.log("Header: handleShellyDownloadSystemLog"),a("Matterbridge","Downloading Shelly system log..."),o("Downloading Shelly system log...",5),window.location.href="./api/shellydownloadsystemlog"},I=()=>{u.matterbridgeInformation.restartMode===""?n({id:b.current,sender:"Header",method:"/api/restart",src:"Frontend",dst:"Matterbridge",params:{}}):n({id:b.current,sender:"Header",method:"/api/shutdown",src:"Frontend",dst:"Matterbridge",params:{}})},g=()=>{n({id:b.current,sender:"Header",method:"/api/shutdown",src:"Frontend",dst:"Matterbridge",params:{}})},d=()=>{n({id:b.current,sender:"Header",method:"/api/reboot",src:"Frontend",dst:"Matterbridge",params:{}})},L=()=>{n({id:b.current,sender:"Header",method:"/api/softreset",src:"Frontend",dst:"Matterbridge",params:{}})},ne=()=>{n({id:b.current,sender:"Header",method:"/api/hardreset",src:"Frontend",dst:"Matterbridge",params:{}})},ae=Q=>{F(Q.currentTarget)},B=Q=>{l&&console.log("Header: handleMenuClose",Q),F(null),Q==="download-mblog"?(a("Matterbridge","Downloading matterbridge log..."),o("Downloading matterbridge log...",5),window.location.href="./api/download-mblog"):Q==="download-mjlog"?(a("Matterbridge","Downloading matter log..."),o("Downloading matter log...",5),window.location.href="./api/download-mjlog"):Q==="view-mblog"?(a("Matterbridge","Loading matterbridge log..."),o("Loading matterbridge log...",5),window.location.href="./api/view-mblog"):Q==="view-mjlog"?(a("Matterbridge","Loading matter log..."),o("Loading matter log...",5),window.location.href="./api/view-mjlog"):Q==="view-shellylog"?(a("Matterbridge","Loading shelly system log..."),o("Loading shelly system log...",5),window.location.href="./api/shellyviewsystemlog"):Q==="download-mbstorage"?(a("Matterbridge","Downloading matterbridge storage..."),o("Downloading matterbridge storage...",5),window.location.href="./api/download-mbstorage"):Q==="download-pluginstorage"?(a("Matterbridge","Downloading matterbridge plugins storage..."),o("Downloading matterbridge plugins storage...",5),window.location.href="./api/download-pluginstorage"):Q==="download-pluginconfig"?(a("Matterbridge","Downloading matterbridge plugins config..."),o("Downloading matterbridge plugins config...",5),window.location.href="./api/download-pluginconfig"):Q==="download-mjstorage"?(a("Matterbridge","Downloading matter storage..."),o("Downloading matter storage...",5),window.location.href="./api/download-mjstorage"):Q==="download-backup"?(a("Matterbridge","Downloading backup..."),o("Downloading backup...",10),window.location.href="./api/download-backup"):Q==="update"?P():Q==="updatedev"?Z():Q==="updatecheck"?he():Q==="shelly-sys-update"?we():Q==="shelly-main-update"?U():Q==="shelly-create-system-log"?k():Q==="shelly-download-system-log"?D():Q==="softreset"?L():Q==="hardreset"?ne():Q==="restart"?I():Q==="shutdown"?g():Q==="reboot"?d():Q==="create-backup"?n({id:b.current,sender:"Header",method:"/api/create-backup",src:"Frontend",dst:"Matterbridge",params:{}}):Q==="unregister"?n({id:b.current,sender:"Header",method:"/api/unregister",src:"Frontend",dst:"Matterbridge",params:{}}):Q==="reset"?n({id:b.current,sender:"Header",method:"/api/reset",src:"Frontend",dst:"Matterbridge",params:{}}):Q==="factoryreset"&&n({id:b.current,sender:"Header",method:"/api/factoryreset",src:"Frontend",dst:"Matterbridge",params:{}})},ce=Q=>{l&&console.log("Header: handleMenuCloseCancel:",Q),F(null)},me=Q=>{_(Q.currentTarget)},oe=()=>{_(null)},be=Q=>{f(Q.currentTarget)},ie=()=>{f(null)},ge=Q=>{x(Q.currentTarget)},Y=()=>{x(null)},ue=Q=>{R(Q.currentTarget)},ve=()=>{R(null)},Qe=()=>{qn(),l&&console.log("Matterbridge logo clicked: debug is now",l)};return r.useEffect(()=>{const Q=se=>{se.src==="Matterbridge"&&se.dst==="Frontend"&&(se.id===b.current&&se.method==="/api/settings"&&(l&&console.log("Header received settings:",se.response),q(se.response),M(se.response.matterbridgeInformation.restartRequired||se.response.matterbridgeInformation.fixedRestartRequired),C(se.response.matterbridgeInformation.fixedRestartRequired),E(se.response.matterbridgeInformation.updateRequired)),se.method==="refresh_required"&&se.params.changed==="settings"&&(l&&console.log(`Header received refresh_required: changed=${se.params.changed} and sending /api/settings request`),n({id:b.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),se.method==="restart_required"&&(l&&console.log(`Header received restart_required with fixed: ${se.params.fixed}`),M(!0),se.params.fixed===!0&&C(!0)),se.method==="restart_not_required"&&(l&&console.log("Header received restart_not_required"),M(!1)),se.method==="update_required"&&(l&&console.log("Header received update_required"),E(!0)),se.method==="update_required_dev"&&(l&&console.log("Header received update_required_dev"),O(!0)),se.id===Se.ShellySysUpdate&&(l&&console.log("Header received WS_ID_SHELLY_SYS_UPDATE:"),q(Fe=>({...Fe,matterbridgeInformation:{...Fe.matterbridgeInformation,shellySysUpdate:se.params.available}}))),se.id===Se.ShellyMainUpdate&&(l&&console.log("Header received WS_ID_SHELLY_MAIN_UPDATE:"),q(Fe=>({...Fe,matterbridgeInformation:{...Fe.matterbridgeInformation,shellyMainUpdate:se.params.available}}))))};return h(Q),l&&console.log(`Header added WebSocket listener id ${b.current}`),()=>{v(Q),l&&console.log("Header removed WebSocket listener")}},[h,v,n,o]),r.useEffect(()=>{i&&(l&&console.log("Header sending /api/settings requests"),n({id:b.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}))},[i,n]),l&&console.log("Header rendering..."),!i||!u?null:e.jsxs("div",{className:"header",children:[e.jsxs("div",{className:"sub-header",children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"30px"},onClick:Qe}),e.jsx("h2",{style:{fontSize:"22px",color:"var(--main-icon-color)",margin:"0px"},children:"Matterbridge"}),e.jsxs("nav",{children:[e.jsx(st,{to:"/",className:"nav-link",children:"Home"}),e.jsx(st,{to:"/devices",className:"nav-link",children:"Devices"}),e.jsx(st,{to:"/log",className:"nav-link",children:"Logs"}),e.jsx(st,{to:"/settings",className:"nav-link",children:"Settings"})]})]}),e.jsxs("div",{className:"sub-header",children:[!u.matterbridgeInformation.readOnly&&T&&e.jsx(H,{title:"New Matterbridge version available, click to install",children:e.jsxs("span",{className:"status-warning",onClick:P,children:["Update to v.",u.matterbridgeInformation.matterbridgeLatestVersion]})}),!u.matterbridgeInformation.readOnly&&S&&e.jsx(H,{title:"New Matterbridge dev version available, click to install",children:e.jsxs("span",{className:"status-warning",onClick:Z,children:["Update to new dev v.",u.matterbridgeInformation.matterbridgeDevVersion.split("-dev-")[0]]})}),!u.matterbridgeInformation.readOnly&&e.jsx(H,{title:"Matterbridge version, click to see the changelog",children:e.jsxs("span",{className:"status-information",onClick:w,children:["v.",u.matterbridgeInformation.matterbridgeVersion]})}),u.matterbridgeInformation.shellyBoard&&e.jsx("img",{src:"Shelly.svg",alt:"Shelly Icon",style:{height:"30px",padding:"0px",margin:"0px",marginRight:"30px"}}),u.matterbridgeInformation.shellyBoard&&u.matterbridgeInformation.xxxmatterbridgeVersion&&e.jsx(H,{title:"Matterbridge version",children:e.jsxs("span",{style:{fontSize:"12px",color:"var(--main-icon-color)"},onClick:w,children:["v.",u.matterbridgeInformation.matterbridgeVersion]})}),u.matterbridgeInformation.bridgeMode!==""&&u.matterbridgeInformation.readOnly===!1?e.jsx(H,{title:"Bridge mode",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:u.matterbridgeInformation.bridgeMode})}):null,u.matterbridgeInformation.restartMode!==""&&u.matterbridgeInformation.readOnly===!1?e.jsx(H,{title:"Restart mode",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:u.matterbridgeInformation.restartMode})}):null,u.matterbridgeInformation.profile&&u.matterbridgeInformation.profile!==""&&u.matterbridgeInformation.readOnly===!1?e.jsx(H,{title:"Current profile",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:u.matterbridgeInformation.profile})}):null]}),e.jsxs("div",{className:"sub-header",style:{gap:"5px"},children:[u.matterbridgeInformation.readOnly===!1?e.jsx(H,{title:"Matterbridge discord group",children:e.jsx("img",{src:"discord.svg",alt:"Discord Logo",style:{cursor:"pointer",height:"25px"},onClick:m})}):null,u.matterbridgeInformation.readOnly===!1?e.jsx(H,{title:"Give a star to Matterbridge",children:e.jsx(z,{style:{color:"#FFD700",margin:"0",padding:"0"},onClick:V,children:e.jsx(Cr,{})})}):null,u.matterbridgeInformation.readOnly===!1?e.jsx(H,{title:"Sponsor Matterbridge",children:e.jsx(z,{style:{color:"#b6409c",margin:"0",padding:"0"},onClick:de,children:e.jsx(Yt,{})})}):null,e.jsx(H,{title:"Matterbridge help",children:e.jsx(z,{style:{color:"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:fe,children:e.jsx(Sr,{})})}),e.jsx(H,{title:"Matterbridge changelog",children:e.jsx(z,{style:{color:"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:w,children:e.jsx(Xt,{})})}),u.matterbridgeInformation&&!u.matterbridgeInformation.readOnly&&e.jsx(H,{title:"Update matterbridge to latest version",children:e.jsx(z,{style:{color:T?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:P,children:e.jsx(Ve,{})})}),u.matterbridgeInformation&&u.matterbridgeInformation.shellyBoard&&u.matterbridgeInformation.shellySysUpdate&&e.jsx(H,{title:"Shelly system update",children:e.jsx(z,{style:{color:"var(--primary-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:we,children:e.jsx(Ve,{})})}),u.matterbridgeInformation&&u.matterbridgeInformation.shellyBoard&&u.matterbridgeInformation.shellyMainUpdate&&e.jsx(H,{title:"Shelly software update",children:e.jsx(z,{style:{color:"var(--primary-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:U,children:e.jsx(Ve,{})})}),e.jsx(H,{title:"Restart matterbridge",children:e.jsx(z,{style:{color:s||N?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:I,children:e.jsx(vt,{})})}),u.matterbridgeInformation.restartMode===""?e.jsx(H,{title:"Shut down matterbridge",children:e.jsx(z,{style:{color:s||N?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:g,children:e.jsx(ze,{})})}):null,e.jsx(H,{title:"Download, backup and more",children:e.jsx(z,{onClick:ae,children:e.jsx(wr,{style:{color:"var(--main-icon-color)"}})})}),e.jsxs(tt,{id:"command-menu",anchorEl:y,keepMounted:!0,open:!!y,onClose:()=>B(""),children:[u.matterbridgeInformation&&!u.matterbridgeInformation.readOnly&&e.jsxs(W,{onClick:()=>B("update"),children:[e.jsx(K,{children:e.jsx(Ve,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Install latest stable",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),u.matterbridgeInformation&&!u.matterbridgeInformation.readOnly&&e.jsxs(W,{onClick:()=>B("updatedev"),children:[e.jsx(K,{children:e.jsx(Ve,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Install latest dev",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),u.matterbridgeInformation&&!u.matterbridgeInformation.readOnly&&e.jsxs(W,{onClick:()=>B("updatecheck"),children:[e.jsx(K,{children:e.jsx(Ve,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Check for updates",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),u.matterbridgeInformation&&u.matterbridgeInformation.shellyBoard&&u.matterbridgeInformation.shellySysUpdate&&e.jsxs(W,{onClick:()=>B("shelly-sys-update"),children:[e.jsx(K,{children:e.jsx(Ve,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Shelly system update",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),u.matterbridgeInformation&&u.matterbridgeInformation.shellyBoard&&u.matterbridgeInformation.shellyMainUpdate&&e.jsxs(W,{onClick:()=>B("shelly-main-update"),children:[e.jsx(K,{children:e.jsx(Ve,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Shelly software update",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(W,{onClick:()=>B("restart"),children:[e.jsx(K,{children:e.jsx(vt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Restart",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),u.matterbridgeInformation.restartMode===""?e.jsxs(W,{onClick:()=>B("shutdown"),children:[e.jsx(K,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Shutdown",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}):null,u.matterbridgeInformation&&u.matterbridgeInformation.shellyBoard&&e.jsxs(W,{onClick:()=>{c("Reboot","Are you sure you want to reboot the Shelly board?","reboot",B,ce)},children:[e.jsx(K,{children:e.jsx(vt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Reboot...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsx(lt,{}),e.jsxs(W,{onClick:be,children:[e.jsx(K,{children:e.jsx(dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"View",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(tt,{id:"sub-menu-view",anchorEl:J,keepMounted:!0,open:!!J,onClose:ie,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(W,{onClick:()=>{B("view-mblog"),ie()},children:[e.jsx(K,{children:e.jsx(dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Matterbridge log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(W,{onClick:()=>{B("view-mjlog"),ie()},children:[e.jsx(K,{children:e.jsx(dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Matter log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),u.matterbridgeInformation&&u.matterbridgeInformation.shellyBoard&&e.jsxs(W,{onClick:()=>{B("view-shellylog"),ie()},children:[e.jsx(K,{children:e.jsx(dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(lt,{}),e.jsxs(W,{onClick:ge,children:[e.jsx(K,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Download",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(tt,{id:"sub-menu-download",anchorEl:p,keepMounted:!0,open:!!p,onClose:Y,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(W,{onClick:()=>{B("download-mbstorage"),Y()},children:[e.jsx(K,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Matterbridge storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(W,{onClick:()=>{B("download-pluginstorage"),Y()},children:[e.jsx(K,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Matterbridge plugins storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(W,{onClick:()=>{B("download-pluginconfig"),Y()},children:[e.jsx(K,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Matterbridge plugins config",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(W,{onClick:()=>{B("download-mblog"),Y()},children:[e.jsx(K,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Matterbridge log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(W,{onClick:()=>{B("download-mjstorage"),Y()},children:[e.jsx(K,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Matter storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(W,{onClick:()=>{B("download-mjlog"),Y()},children:[e.jsx(K,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Matter log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),u.matterbridgeInformation&&u.matterbridgeInformation.shellyBoard&&e.jsxs(W,{onClick:()=>{B("shelly-create-system-log"),Y()},children:[e.jsx(K,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Create Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),u.matterbridgeInformation&&u.matterbridgeInformation.shellyBoard&&e.jsxs(W,{onClick:()=>{B("shelly-download-system-log"),Y()},children:[e.jsx(K,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Download Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(lt,{}),e.jsxs(W,{onClick:me,children:[e.jsx(K,{children:e.jsx(Dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(tt,{id:"sub-menu-backup",anchorEl:$,keepMounted:!0,open:!!$,onClose:oe,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(W,{onClick:()=>{B("create-backup"),oe()},children:[e.jsx(K,{children:e.jsx(Dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Create backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(W,{onClick:()=>{B("download-backup"),oe()},children:[e.jsx(K,{children:e.jsx(Dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Download backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(lt,{}),e.jsxs(W,{onClick:ue,children:[e.jsx(K,{children:e.jsx(Mr,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Reset",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(tt,{id:"sub-menu-reset",anchorEl:j,keepMounted:!0,open:!!j,onClose:ve,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(W,{onClick:()=>{ve(),c("Reset all devices and shutdown","Are you sure you want to unregister all devices? This will temporarily remove all devices from the controller and you may loose the controller configuration.","unregister",B,ce)},children:[e.jsx(K,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Reset all devices...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(W,{onClick:()=>{ve(),c("Reset commissioning and shutdown","Are you sure you want to reset the commissioning? You will have to manually remove Matterbridge from the controller.","reset",B,ce)},children:[e.jsx(K,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Reset commissioning...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),!u.matterbridgeInformation.readOnly&&e.jsxs(W,{onClick:()=>{ve(),c("Factory reset and shutdown","Are you sure you want to factory reset Matterbridge? You will have to manually remove Matterbridge from the controller.","factoryreset",B,ce)},children:[e.jsx(K,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Factory reset...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),u.matterbridgeInformation&&u.matterbridgeInformation.shellyBoard&&e.jsxs(W,{onClick:()=>{ve(),c("Network reset","Are you sure you want to factory reset the network parameters?","softreset",B,ce)},children:[e.jsx(K,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Reset network...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),u.matterbridgeInformation&&u.matterbridgeInformation.shellyBoard&&e.jsxs(W,{onClick:()=>{ve(),c("Factory reset","Are you sure you want to factory reset Matterbridge? You will have to manually remove Matterbridge from the controller.","hardreset",B,ce)},children:[e.jsx(K,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Factory reset...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]})]})]})]})}const Bo=()=>"ontouchstart"in window||typeof window.DocumentTouch<"u"&&document instanceof window.DocumentTouch?(l&&console.log("WebSocketLogs detectTouchscreen = true"),!0):(l&&console.log("WebSocketLogs detectTouchscreen = false"),!1);function Jo(){const{messages:o,autoScroll:c}=r.useContext(or),[i,n]=r.useState(!1),a=r.useRef(null),h=r.useMemo(()=>Bo(),[]),v=s=>n(!0),t=s=>n(!1);return r.useEffect(()=>{l&&console.log(`WebSocketLogs autoScroll: ${c} isHovering: ${i}`),c&&!i&&!h&&a.current?.scrollIntoView({behavior:"smooth"})},[o,i,c,h]),e.jsx("div",{style:{margin:"0px",padding:"0px"},children:e.jsxs("ul",{style:{margin:"0px",padding:"0px"},onMouseEnter:v,onMouseLeave:t,children:[o.map((s,M)=>e.jsx("li",{style:{wordWrap:"break-word",maxHeight:"200px",overflow:"hidden"},dangerouslySetInnerHTML:{__html:s}},M)),e.jsx("div",{ref:a})]})})}const nr=r.memo(Jo);function Je(){const{retry:o}=r.useContext(xe),c=()=>{window.location.reload()};return e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",fontSize:"20px",flexDirection:"column",color:"var(--main-text-color)",height:"100vh",backgroundColor:"var(--main-bg-color)"},children:e.jsx(X,{sx:{display:"flex",alignItems:"center",flexDirection:"column"},children:o<100?e.jsxs(e.Fragment,{children:[e.jsx(kr,{style:{color:"var(--primary-color)"}}),e.jsxs("div",{style:{marginTop:"20px",color:"var(--primary-color)"},children:["Reconnecting to Matterbridge ","(attempt "+o+")","..."]})]}):e.jsxs("div",{style:{marginTop:"20px",color:"var(--primary-color)",textAlign:"center"},children:["Unable to connect to Matterbridge after multiple attempts.",e.jsx("br",{}),"Please check your network connection.",e.jsx("br",{}),e.jsx(re,{variant:"contained",color:"primary",onClick:c,style:{marginTop:"20px"},children:"Refresh the Page"})]})})})}function Qo({value:o,maxChars:c}){let i=o;if(o.length>c&&c>3){const n=c-3,a=o.substring(0,Math.ceil(n/2)),h=o.substring(o.length-Math.floor(n/2),o.length);i=`${a} … ${h}`}return o!==i?e.jsx(H,{title:o,placement:"top",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[0,12]}}]}},children:e.jsx("span",{children:i})}):e.jsx("span",{children:i})}function Go({systemInfo:o,compact:c}){const[i,n]=r.useState(o),{sendMessage:a,addListener:h,removeListener:v}=r.useContext(xe);if(l&&console.log("SystemInfoTable:",i,"compact:",c),o&&c&&i.totalMemory&&i.freeMemory){const t=i.totalMemory,s=i.freeMemory;i.freeMemory=`${s} / ${t}`,i.totalMemory=""}if(o&&c&&i.heapTotal&&i.heapUsed){const t=i.heapTotal,s=i.heapUsed;i.heapUsed=`${s} / ${t}`,i.heapTotal=""}if(o&&c&&i.osRelease&&i.osType){const t=i.osType,s=i.osRelease;i.osType=`${t} (${s})`,i.osRelease=""}if(o&&c&&i.osArch&&i.osPlatform){const t=i.osPlatform,s=i.osArch;i.osPlatform=`${t} (${s})`,i.osArch=""}return r.useEffect(()=>{const t=s=>{s.src==="Matterbridge"&&s.dst==="Frontend"&&(s.method==="memory_update"&&s.params&&s.params.totalMemory&&s.params.freeMemory&&s.params.heapTotal&&s.params.heapUsed&&s.params.rss&&(l&&console.log("SystemInfoTable received memory_update",s),(i.totalMemory!==s.params?.totalMemory||i.freeMemory!==s.params?.freeMemory||i.heapTotal!==s.params?.heapTotal||i.heapUsed!==s.params?.heapUsed||i.rss!==s.params?.rss)&&n(M=>({...M,totalMemory:s.params?.totalMemory?s.params.totalMemory:"",freeMemory:s.params?.freeMemory?s.params.freeMemory:"",heapTotal:s.params?.heapTotal?s.params.heapTotal:"",heapUsed:s.params?.heapUsed?s.params.heapUsed:"",rss:s.params?.rss?s.params.rss:""}))),s.method==="cpu_update"&&s.params&&s.params.cpuUsage&&(l&&console.log("SystemInfoTable received cpu_update",s),i.cpuUsage!==(s.params?.cpuUsage?s.params.cpuUsage.toFixed(2)+" %":"")&&n(M=>({...M,cpuUsage:s.params?.cpuUsage?s.params.cpuUsage.toFixed(2)+" %":""}))),s.method==="uptime_update"&&s.params&&s.params.systemUptime&&s.params.processUptime&&(l&&console.log("SystemInfoTable received uptime_update",s),(i.systemUptime!==s.params?.systemUptime||i.processUptime!==s.params?.processUptime)&&n(M=>({...M,systemUptime:s.params?.systemUptime?s.params.systemUptime:"",processUptime:s.params?.processUptime?s.params.processUptime:""}))))};return l&&console.log("SystemInfoTable useEffect WebSocketMessage mounting"),h(t),l&&console.log("SystemInfoTable useEffect WebSocketMessage mounted"),()=>{l&&console.log("SystemInfoTable useEffect WebSocketMessage unmounting"),v(t),l&&console.log("SystemInfoTable useEffect WebSocketMessage unmounted")}},[h,i.cpuUsage,i.freeMemory,i.heapTotal,i.heapUsed,i.processUptime,i.rss,i.systemUptime,i.totalMemory,v,a]),i?(l&&console.log("SystemInfoTable rendering..."),e.jsxs("div",{className:"MbfWindowDiv",style:{minWidth:"302px",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"System Information"})}),e.jsx("div",{className:"MbfWindowDivTable",children:e.jsx("table",{style:{border:"none",borderCollapse:"collapse"},children:e.jsx("tbody",{style:{border:"none",borderCollapse:"collapse"},children:Object.entries(i).filter(([t,s])=>s!==void 0&&s!=="").map(([t,s],M)=>e.jsxs("tr",{className:M%2===0?"table-content-even":"table-content-odd",style:{border:"none",borderCollapse:"collapse"},children:[e.jsx("td",{style:{border:"none",borderCollapse:"collapse"},children:t}),e.jsx("td",{style:{border:"none",borderCollapse:"collapse"},children:e.jsx(Qo,{value:typeof s!="string"?s.toString():s,maxChars:25})})]},t))})})})]})):null}const Ko=r.memo(Go),Yo=!0,qt={margin:"0px",padding:"0px",color:"var(--div-text-color)",transition:"color 0.2s ease","& svg":{display:"block"},"& svg path":{fill:"var(--div-text-color)",transition:"fill 0.2s ease"},"&:hover":{color:"var(--primary-color)"},"&:hover svg path":{fill:"var(--primary-color)"},"&:focus-visible":{outline:"2px solid var(--primary-color)",outlineOffset:"2px"}},Xo=o=>{if(!o)return"";const c=o.toString().replace(/[^0-9]/g,"");if(c.length<5)return c;const i=c.slice(0,4),n=c.slice(4,7),a=c.slice(7,11);return[i,n,a].filter(Boolean).join("-")};function Zo({id:o}){const{online:c,sendMessage:i,addListener:n,removeListener:a,getUniqueId:h}=r.useContext(xe),[v,t]=r.useState(null),[s,M]=r.useState(null),N=r.useRef(null),C=r.useRef(h()),{showConfirmCancelDialog:T}=r.useContext(ot);r.useEffect(()=>{console.log(`QRDiv received storeId update "${o}"`),o&&(console.log(`QRDiv sending data request for storeId "${o}"`),t(o),i({id:C.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:o,server:!0}}))},[o]),r.useEffect(()=>{const b=y=>{y.src==="Matterbridge"&&y.dst==="Frontend"&&Ao(y)&&y.id===Se.RefreshRequired&&y.params.changed==="matter"&&y.params.matter&&(console.log(`QRDiv received refresh_required: changed=${y.params.changed} for storeId "${y.params.matter.id}":`,y.params.matter),v===y.params.matter.id&&(console.log(`QRDiv received refresh_required/matter: setting matter data for storeId "${y.params.matter.id}":`,y.params.matter),N.current&&clearTimeout(N.current),y.params.matter.advertising&&y.params.matter.advertiseTime&&y.params.matter.advertiseTime+9e5<=Date.now()&&(y.params.matter.advertising=!1),M(y.params.matter),y.params.matter.advertising&&(console.log(`QRDiv setting matter advertise timeout for storeId "${y.params.matter.id}":`,y.params.matter.advertiseTime+9e5-Date.now()),N.current=setTimeout(()=>{N.current&&clearTimeout(N.current),console.log(`QRDiv clearing advertising state for storeId "${v}" after 15 minutes`),M(F=>F&&{...F,advertising:!1})},y.params.matter.advertiseTime+9e5-Date.now()))))};return n(b),console.log("QRDiv webSocket effect mounted"),()=>{a(b),N.current&&clearTimeout(N.current),console.log("QRDiv webSocket effect unmounted")}},[v]);const E=()=>{console.log(`QRDiv sent matter startCommission for node "${s?.id}"`),s&&i({id:C.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:s.id,startCommission:!0}})},S=()=>{console.log(`QRDiv sent matter stopCommission for node "${s?.id}"`),s&&i({id:C.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:s.id,stopCommission:!0}})},O=()=>{console.log(`QRDiv sent matter advertise for node "${s?.id}"`),s&&i({id:C.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:s.id,advertise:!0}})},u=b=>{console.log(`QRDiv sent matter removeFabric for node "${s?.id}" and fabricIndex ${b}`),s&&i({id:C.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:s.id,removeFabric:b}})},q=async()=>{if(!s||!s.manualPairingCode)return;const b=s.manualPairingCode.toString();try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(b);else{const y=document.createElement("textarea");y.value=b,y.style.position="fixed",y.style.opacity="0",document.body.appendChild(y),y.focus(),y.select(),document.execCommand("copy"),document.body.removeChild(y)}Yo&&console.log("Manual pairing code copied to clipboard")}catch(y){console.error("Failed to copy manual pairing code",y)}};return!s||!c?(console.log("QRDiv rendering undefined state"),null):s.advertising&&s.qrPairingCode&&s.manualPairingCode?(console.log("QRDiv rendering advertising state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"QR pairing code"}),e.jsxs("div",{className:"MbfWindowHeaderFooterIcons",children:[e.jsx(z,{"aria-label":"send advertising",size:"small",onClick:O,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(H,{title:"Send again the mDNS advertisement",arrow:!0,children:e.jsx(ee,{path:At,size:"22px"})})}),e.jsx(z,{"aria-label":"stop pairing",size:"small",onClick:S,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(H,{title:"Turn off pairing",arrow:!0,children:e.jsx(ee,{path:po,size:"22px"})})})]})]}),e.jsx("p",{className:"MbfWindowHeaderText",style:{overflow:"hidden",maxWidth:"280px",textOverflow:"ellipsis",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:v}),e.jsx(co,{value:s.qrPairingCode,size:256,level:"M",fgColor:"var(--div-text-color)",bgColor:"var(--div-bg-color)",style:{margin:"20px"}}),e.jsxs("div",{className:"MbfWindowFooter",style:{justifyContent:"space-between"},children:[e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Manual pairing code: ",Xo(s.manualPairingCode)]}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(H,{title:"Copy manual pairing code",arrow:!0,children:e.jsx(z,{"aria-label":"copy manual pairing code",size:"small",onClick:q,sx:qt,children:e.jsx(ee,{path:uo,size:.85})})})})]})]})):s.commissioned&&s.fabricInformations&&s.sessionInformations?(console.log("QRDiv rendering commissioned state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px",overflow:"hidden"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Paired fabrics"}),e.jsxs("div",{className:"MbfWindowHeaderFooterIcons",children:[e.jsx(z,{"aria-label":"send advertising",size:"small",onClick:O,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(H,{title:"Send again the mDNS advertisement",arrow:!0,children:e.jsx(ee,{path:At,size:"22px"})})}),e.jsx(z,{"aria-label":"start pairing",size:"small",onClick:E,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(H,{title:"Turn on pairing",arrow:!0,children:e.jsx(ee,{path:_t,size:"22px"})})})]})]}),e.jsxs("div",{className:"MbfWindowBodyColumn",style:{paddingTop:"0px"},children:[e.jsx("p",{className:"MbfWindowHeaderText thin-scroll",style:{overflowX:"auto",maxWidth:"280px",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:v}),s.fabricInformations.map((b,y)=>e.jsxs("div",{style:{margin:"0px",padding:"10px",gap:"0px",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",textAlign:"left",fontSize:"14px"},children:[e.jsxs("div",{style:{marginLeft:"20px",marginBottom:"10px",display:"flex",flexDirection:"row",justifyContent:"space-between",gap:"20px",alignItems:"center"},children:[e.jsxs("p",{className:"status-blue",style:{margin:"0px",padding:"3px 10px",width:"200px",fontSize:"14px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},children:["Fabric: ",b.fabricIndex]}),e.jsx(H,{title:"Remove the fabric. You will also need to remove it from the controller.",arrow:!0,children:e.jsx(z,{"aria-label":"remove the fabric",size:"small",onClick:()=>T("Remove fabric","Are you sure you want to remove this fabric? You will also need to remove it from the controller.","RemoveFabric",()=>u(b.fabricIndex),()=>{}),sx:{...qt,padding:"2px"},children:e.jsx(ee,{path:mo,size:1})})})]}),e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Vendor: ",b.rootVendorId," ",b.rootVendorName]}),b.label!==""&&e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Label: ",b.label]}),e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Sessions: ",s.sessionInformations?s.sessionInformations.filter(F=>F.fabric?.fabricIndex===b.fabricIndex&&F.isPeerActive===!0).length:"0"," ","subscriptions: ",s.sessionInformations?s.sessionInformations.filter(F=>F.fabric?.fabricIndex===b.fabricIndex&&F.isPeerActive===!0&&F.numberOfActiveSubscriptions>0).length:"0"]})]},y))]}),e.jsx("div",{className:"MbfWindowFooter",children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Serial number: ",s.serialNumber]})})]})):!s.commissioned&&!s.advertising?(console.log("QRDiv rendering not commissioned and not advertising state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px"},children:[e.jsx("div",{className:"MbfWindowHeader",style:{height:"30px"},children:e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"QR pairing code"})}),e.jsx("p",{className:"MbfWindowHeaderText thin-scroll",style:{overflowX:"auto",maxWidth:"280px",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:v}),e.jsx(re,{onClick:E,endIcon:e.jsx(ee,{path:_t,size:1}),style:{margin:"20px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:"Turn on pairing"}),e.jsx("div",{className:"MbfWindowFooter",children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Serial number: ",s.serialNumber]})})]})):(console.log("QRDiv rendering unknown state"),null)}const en=r.memo(Zo);function tn(){const{logMessage:o,sendMessage:c,getUniqueId:i}=r.useContext(xe),[n,a]=r.useState("matterbridge-"),[h,v]=r.useState(!1),[t,s]=r.useState(null),M=r.useRef(i()),N=y=>{y.preventDefault(),v(!0)},C=()=>{v(!1)},T=y=>{y.preventDefault(),v(!1);const F=y.dataTransfer.files[0];if(F){o("Plugins",`Installing package ${F.name}. Please wait...`);const $=new FormData;$.append("file",F),$.append("filename",F.name),fetch("./api/uploadpackage",{method:"POST",body:$}).then(_=>_.text()).then(_=>{o("Plugins",`Server response: ${_}`)}).catch(_=>{console.error("Error uploading plugin file:",_),o("Plugins",`Error installing package ${_}`)})}},E=y=>{const F=y.target.files&&y.target.files[0];if(F){o("Plugins",`Uploading package ${F.name}`);const $=new FormData;$.append("file",F),$.append("filename",F.name),fetch("./api/uploadpackage",{method:"POST",body:$}).then(_=>_.text()).then(_=>{o("Plugins",`Server response: ${_}`)}).catch(_=>{console.error("Error uploading plugin file:",_),o("Plugins",`Error uploading package ${_}`)})}},S=()=>{c({id:M.current,sender:"InstallPlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:n,restart:!1}})},O=()=>{document.getElementById("file-upload")?.click()},u=()=>{c({id:M.current,sender:"InstallPlugins",method:"/api/addplugin",src:"Frontend",dst:"Matterbridge",params:{pluginNameOrPath:n}})},q=y=>{s(y.currentTarget)},b=y=>{y!==""&&a(y),s(null)};return l&&console.log("AddRemovePlugins rendering..."),e.jsxs("div",{style:{display:"flex",flexDirection:"row",flex:"1 1 auto",alignItems:"center",justifyContent:"space-between",margin:"0px",padding:"10px",gap:"20px"},onDragOver:N,onDragLeave:C,onDrop:T,children:[e.jsx(pe,{value:n,onChange:y=>{a(y.target.value)},size:"small",id:"plugin-name",label:"Plugin name or plugin path",variant:"outlined",fullWidth:!0}),e.jsx(z,{onClick:q,children:e.jsx(Ir,{})}),e.jsxs(tt,{id:"simple-menu",anchorEl:t,keepMounted:!0,open:!!t,onClose:()=>b(""),children:[e.jsx(W,{onClick:()=>b("matterbridge-zigbee2mqtt"),children:"matterbridge-zigbee2mqtt"}),e.jsx(W,{onClick:()=>b("matterbridge-somfy-tahoma"),children:"matterbridge-somfy-tahoma"}),e.jsx(W,{onClick:()=>b("matterbridge-shelly"),children:"matterbridge-shelly"}),e.jsx(W,{onClick:()=>b("matterbridge-hass"),children:"matterbridge-hass"}),e.jsx(W,{onClick:()=>b("matterbridge-webhooks"),children:"matterbridge-webhooks"}),e.jsx(W,{onClick:()=>b("matterbridge-bthome"),children:"matterbridge-bthome"}),e.jsx(W,{onClick:()=>b("matterbridge-test"),children:"matterbridge-test"}),e.jsx(W,{onClick:()=>b("matterbridge-example-accessory-platform"),children:"matterbridge-example-accessory-platform"}),e.jsx(W,{onClick:()=>b("matterbridge-example-dynamic-platform"),children:"matterbridge-example-dynamic-platform"}),e.jsx(W,{onClick:()=>b("matterbridge-eve-door"),children:"matterbridge-eve-door"}),e.jsx(W,{onClick:()=>b("matterbridge-eve-motion"),children:"matterbridge-eve-motion"}),e.jsx(W,{onClick:()=>b("matterbridge-eve-energy"),children:"matterbridge-eve-energy"}),e.jsx(W,{onClick:()=>b("matterbridge-eve-weather"),children:"matterbridge-eve-weather"}),e.jsx(W,{onClick:()=>b("matterbridge-eve-room"),children:"matterbridge-eve-room"})]}),e.jsx(H,{title:"Install or update a plugin from npm",children:e.jsx(re,{onClick:S,endIcon:e.jsx(He,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Install"})}),e.jsx(H,{title:"Upload and install a plugin from a tarball",children:e.jsx(re,{onClick:O,endIcon:e.jsx(Dr,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Upload"})}),e.jsx(H,{title:"Add an installed plugin",children:e.jsx(re,{onClick:u,endIcon:e.jsx(yt,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Add"})}),e.jsx("input",{id:"file-upload",type:"file",accept:".tgz",style:{display:"none"},onChange:E})]})}function Xe({status:o,enabledText:c="Enabled",disabledText:i=void 0,tooltipText:n=void 0,onClick:a}){if(o===void 0)return e.jsx("div",{style:{margin:"-2.5px"},children:e.jsx("div",{})});{const h=e.jsx("div",{className:o?"status-enabled":"status-disabled",style:{cursor:"default"},onClick:a,children:o?c:i??c});return n!==void 0?e.jsx(H,{title:n,children:h}):h}}const Ze={fontSize:"16px",fontWeight:"bold",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},et={fontSize:"12px",fontWeight:"normal",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},rn={fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)",backgroundColor:"var(--div-bg-color)"},on={fontSize:"16px",fontWeight:"bold",backgroundColor:"var(--div-bg-color)"},$e={padding:"0px",margin:"0px"},nn="5px 10px 5px 10px",ht={},je={},xt={},ft={};let bt=[],Bt=[];const an=({open:o,onClose:c,plugin:i})=>{const{sendMessage:n,addListener:a,removeListener:h,getUniqueId:v}=r.useContext(xe),t=r.useRef(v()),[s,M]=r.useState(i.configJson),[N,C]=r.useState(i.schemaJson),[T,E]=r.useState({"ui:submitButtonOptions":{submitText:"Confirm"},"ui:globalOptions":{orderable:!0}}),[S,O]=r.useState("");let u={};r.useEffect(()=>{const k=D=>{D.src==="Matterbridge"&&D.dst==="Frontend"&&(D.id===t.current&&D.method==="/api/select/devices"&&(D.response&&(bt=D.response),D.error&&console.error("ConfigPluginDialog received /api/select/devices error:",D.error)),D.id===t.current&&D.method==="/api/select/entities"&&(D.response&&(Bt=D.response),D.error&&console.error("ConfigPluginDialog received /api/select/entities error:",D.error)))};return a(k),s!==void 0&&N!==void 0&&(Object.keys(N.properties).forEach(D=>{Object.keys(N.properties[D]).forEach(I=>{I.startsWith("ui:")&&(T[D]={},T[D][I]=N.properties[D][I],delete N.properties[D][I])})}),E(T)),i.name!==void 0&&i.configJson!==void 0&&i.schemaJson!==void 0&&(M(i.configJson),C(i.schemaJson),n({id:t.current,sender:"ConfigPlugin",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:i.name}}),n({id:t.current,sender:"ConfigPlugin",method:"/api/select/entities",src:"Frontend",dst:"Matterbridge",params:{plugin:i.name}})),()=>{h(k)}},[a,s,i,h,N,n,T]);const q=({formData:k})=>{u=k},b=({formData:k})=>{M(k),i.configJson=k,i.restartRequired=!0,n({id:t.current,sender:"ConfigPlugin",method:"/api/savepluginconfig",src:"Frontend",dst:"Matterbridge",params:{pluginName:k.name,formData:k}}),c()};function y(k){const{id:D,label:I,onKeyChange:g,onDropPropertyClick:d,disabled:L,schema:ne,children:ae,registry:B,readonly:ce,required:me}=k,{templates:oe}=B,{RemoveButton:be}=oe.ButtonTemplates;if(!(Vo in ne))return e.jsx(X,{sx:{display:"flex",flexDirection:"column",flexGrow:1,padding:0,margin:0,border:"none"},children:ae});const ge=({target:Y})=>g(Y&&Y.value);return e.jsxs(X,{sx:{display:"flex",flexDirection:"row",flexGrow:1,padding:0,margin:0,border:"none"},children:[e.jsx(pe,{id:`${D}-key`,name:`${D}-key`,required:me,disabled:L||ce,defaultValue:I,onBlur:ce?void 0:ge,type:"text",variant:"outlined",sx:{width:"250px",minWidth:"250px",maxWidth:"250px",marginRight:"20px"}}),e.jsx(X,{sx:{flex:1},children:ae}),e.jsx(be,{disabled:L||ce,onClick:d(I)})]})}function F(k){const{children:D,description:I,displayLabel:g,errors:d,help:L,hidden:ne,_id:ae,_label:B,registry:ce,uiSchema:me}=k,oe=$o(me),be=Eo("WrapIfAdditionalTemplate",ce,oe);return ne?e.jsx("div",{style:{display:"none"},children:D}):e.jsx(X,{sx:{display:"flex",flexDirection:"column",flexGrow:1,padding:0,margin:0,border:"none"},children:e.jsxs(be,{...k,children:[g===!0&&I,D,d,L]})})}function $(k){const{description:D}=k;return D?e.jsx(le,{sx:et,children:D}):null}function _(k){const{required:D,title:I}=k;return I?e.jsx(X,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:e.jsxs(le,{sx:Ze,children:["Title ",I," ",D&&e.jsx("mark",{children:"***"})]})}):null}function J(k){const{help:D,_idSchema:I}=k;return D?e.jsx(X,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:e.jsx(le,{sx:rn,children:D})}):null}function f(k){const{errors:D}=k;return D?e.jsxs(X,{sx:{padding:"10px",margin:"10px",border:"1px solid grey"},children:[e.jsx(le,{color:"error",sx:on,children:"Please fix the following errors:"}),e.jsx(nt,{children:D.map((I,g)=>e.jsxs(Nr,{children:[e.jsx(K,{children:e.jsx(Pr,{color:"error"})}),e.jsx(te,{primary:I.stack})]},g))})]}):null}function p(k){const{errors:D}=k;return D?e.jsx(X,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:D.map((I,g)=>e.jsxs(le,{color:"error",variant:"body2",sx:{marginLeft:1},children:["This field ",I]},g))}):null}function x(k){const{id:D,name:I,_schema:g,_uiSchema:d,value:L,options:ne,label:ae,type:B,placeholder:ce,required:me,disabled:oe,readonly:be,autofocus:ie,onChange:ge,onChangeOverride:Y,onBlur:ue,onFocus:ve,_rawErrors:Qe,_hideError:Q,_registry:se,_formContext:Fe}=k,Le=({target:{value:ye}})=>ge(ye===""?ne.emptyValue:ye),Re=({target:ye})=>ue(D,ye&&ye.value),Ue=({target:ye})=>ve(D,ye&&ye.value);return e.jsx(X,{sx:{padding:"0px",margin:"0px"},children:e.jsx(pe,{id:D,name:D,label:ce&&ce!==""?ae:void 0,variant:"outlined",placeholder:ce&&ce!==""?ce:ae,required:me,disabled:oe||be,autoFocus:ie,value:L||L===0?L:"",type:B,autoComplete:B==="password"?"current-password":I,onChange:Y||Le,onBlur:Re,onFocus:Ue,fullWidth:!0})})}function j(k){return console.log("ArrayFieldTitleTemplate:",k),null}function R(k){return console.log("ArrayFieldDescriptionTemplate:",k),null}function de(k){return console.log("ArrayFieldItemTemplate:",k),null}function fe(k){const{canAdd:D,_className:I,_disabled:g,_formContext:d,_formData:L,_idSchema:ne,_items:ae,onAddClick:B,_rawErrors:ce,_readonly:me,_registry:oe,_required:be,schema:ie,title:ge,_uiSchema:Y}=k,[ue,ve]=r.useState(!1),[Qe,Q]=r.useState(!1),[se,Fe]=r.useState(!1),[Le,Re]=r.useState(""),Ue=A=>{Re(A.target.value)},ye=()=>{ve(!ue)},Ge=()=>{Q(!Qe)},Ke=()=>{Fe(!se)},wt=A=>{ve(!1),ie.selectFrom==="serial"?ie.items.default=A.serial:ie.selectFrom==="name"&&(ie.items.default=A.name),B()},Mt=A=>{Q(!1),ie.selectEntityFrom==="name"?ie.items.default=A.name:ie.selectEntityFrom==="description"&&(ie.items.default=A.description),B()},kt=A=>{Fe(!1),ie.selectDeviceEntityFrom==="name"?ie.items.default=A.name:ie.selectDeviceEntityFrom==="description"&&(ie.items.default=A.description),B()};return e.jsxs(X,{sx:{margin:"0px",padding:"5px 10px 5px 10px",border:"1px solid grey"},children:[ge&&e.jsxs(X,{sx:{margin:"0px",padding:"0px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[ge&&e.jsx(le,{sx:Ze,children:ge}),D&&e.jsxs(X,{sx:{margin:"0px",padding:"0px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[ie.selectFrom&&e.jsx(H,{title:"Add a device from the list",children:e.jsx(z,{onClick:ye,size:"small",color:"primary",sx:$e,children:e.jsx(ct,{})})}),ie.selectEntityFrom&&e.jsx(H,{title:"Add an entity from the list",children:e.jsx(z,{onClick:Ge,size:"small",color:"primary",sx:$e,children:e.jsx(ct,{})})}),ie.selectDeviceEntityFrom&&e.jsx(H,{title:"Add a device entity from the list",children:e.jsx(z,{onClick:Ke,size:"small",color:"primary",sx:$e,children:e.jsx(ct,{})})}),e.jsx(H,{title:"Add a new item",children:e.jsx(z,{onClick:B,size:"small",color:"primary",sx:$e,children:e.jsx(yt,{})})})]})]}),ie.description&&e.jsx(le,{sx:et,children:ie.description}),k.items.map(A=>e.jsxs(X,{sx:{margin:"2px 0px",padding:"0px",display:"flex",alignItems:"center"},children:[e.jsx(X,{sx:{flexGrow:1,marginRight:"10px"},children:A.children}),e.jsx(z,{disabled:!A.hasMoveUp,onClick:A.onReorderClick(A.index,A.index-1),size:"small",color:"primary",sx:$e,children:e.jsx(Rt,{})}),e.jsx(z,{disabled:!A.hasMoveDown,onClick:A.onReorderClick(A.index,A.index+1),size:"small",color:"primary",sx:$e,children:e.jsx(Lt,{})}),e.jsx(z,{onClick:A.onDropIndexClick(A.index),size:"small",color:"primary",sx:$e,children:e.jsx(Ct,{})})]},A.index)),e.jsxs(Ie,{open:ue,onClose:ye,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(De,{children:"Select a device"}),e.jsxs(Ne,{children:[e.jsxs(X,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(le,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(pe,{fullWidth:!0,variant:"outlined",value:Le,onChange:Ue,placeholder:"Enter serial or name"})]}),e.jsx(nt,{dense:!0,children:bt.filter(A=>A.serial.toLowerCase().includes(Le.toLowerCase())||A.name.toLowerCase().includes(Le.toLowerCase())).map((A,Me)=>e.jsxs(pt,{onClick:()=>wt(A),sx:ht,children:[A.icon==="wifi"&&e.jsx(K,{children:e.jsx(it,{style:je})}),A.icon==="ble"&&e.jsx(K,{children:e.jsx(ut,{style:je})}),A.icon==="hub"&&e.jsx(K,{children:e.jsx(mt,{style:je})}),e.jsx(te,{primary:A.name,secondary:A.serial,primaryTypographyProps:{style:xt},secondaryTypographyProps:{style:ft}})]},Me))})]}),e.jsx(Pe,{children:e.jsx(re,{onClick:ye,children:"Close"})})]}),e.jsxs(Ie,{open:Qe,onClose:Ge,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(De,{children:"Select an entity"}),e.jsxs(Ne,{children:[e.jsxs(X,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(le,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(pe,{fullWidth:!0,variant:"outlined",value:Le,onChange:Ue,placeholder:"Enter name or description"})]}),e.jsx(nt,{dense:!0,children:Bt.filter(A=>A.name.toLowerCase().includes(Le.toLowerCase())||A.description.toLowerCase().includes(Le.toLowerCase())).map((A,Me)=>e.jsxs(pt,{onClick:()=>Mt(A),sx:ht,children:[A.icon==="wifi"&&e.jsx(K,{children:e.jsx(it,{style:je})}),A.icon==="ble"&&e.jsx(K,{children:e.jsx(ut,{style:je})}),A.icon==="hub"&&e.jsx(K,{children:e.jsx(mt,{style:je})}),A.icon==="component"&&e.jsx(K,{children:e.jsx(Ht,{style:je})}),A.icon==="matter"&&e.jsx(K,{children:e.jsx(Ot,{style:je})}),e.jsx(te,{primary:A.name,secondary:A.description,primaryTypographyProps:{style:xt},secondaryTypographyProps:{style:ft}})]},Me))})]}),e.jsx(Pe,{children:e.jsx(re,{onClick:Ge,children:"Close"})})]}),e.jsxs(Ie,{open:se,onClose:Ke,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsxs(De,{children:["Select an entity for ",ge]}),e.jsx(Ne,{children:e.jsx(nt,{dense:!0,children:bt.filter(A=>A.serial===ge||A.name===ge).map(A=>A.entities?.map((Me,It)=>e.jsxs(pt,{onClick:()=>kt(Me),sx:ht,children:[Me.icon==="wifi"&&e.jsx(K,{children:e.jsx(it,{style:je})}),Me.icon==="ble"&&e.jsx(K,{children:e.jsx(ut,{style:je})}),Me.icon==="hub"&&e.jsx(K,{children:e.jsx(mt,{style:je})}),Me.icon==="component"&&e.jsx(K,{children:e.jsx(Ht,{style:je})}),Me.icon==="matter"&&e.jsx(K,{children:e.jsx(Ot,{style:je})}),e.jsx(te,{primary:Me.name,secondary:Me.description,primaryTypographyProps:{style:xt},secondaryTypographyProps:{style:ft}})]},It)))})}),e.jsx(Pe,{children:e.jsx(re,{onClick:Ke,children:"Close"})})]})]})}function w(k){const{onAddClick:D,schema:I,properties:g,title:d,description:L}=k,[ne,ae]=r.useState(!1),[B,ce]=r.useState(""),me=Y=>{ce(Y.target.value)},oe=()=>{ae(!ne)},be=Y=>{ae(!1);let ue="";I.selectFrom==="serial"?ue=Y.serial:I.selectFrom==="name"&&(ue=Y.name),O(ue),D(I)()},ie=()=>{D(I)()},ge=!I.additionalProperties;return!ge&&S!==""&&g.forEach(Y=>{if(Y.name==="newKey"&&Y.content.key==="newKey"&&Y.content.props.name==="newKey"&&Y.content.props.onKeyChange&&S!==""){const ue=S;O(""),Y.content.props.onKeyChange(ue)}}),e.jsxs(X,{sx:{margin:"0px",padding:ge?"10px":"5px 10px 0px 10px",border:ge?"none":"1px solid grey"},children:[I.title&&ge&&e.jsx(X,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px",marginBottom:"10px"},children:e.jsx(le,{sx:Ze,children:I.title})}),d&&!ge&&e.jsxs(X,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px"},children:[e.jsx(le,{sx:Ze,children:d}),e.jsxs(X,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px"},children:[I.selectFrom&&e.jsx(H,{title:"Add a device from the list",children:e.jsx(z,{onClick:oe,size:"small",color:"primary",sx:$e,children:e.jsx(ct,{})})}),e.jsx(H,{title:"Add a new item",children:e.jsx(z,{onClick:ie,size:"small",color:"primary",sx:$e,children:e.jsx(yt,{})})})]})]}),I.description&&e.jsx(X,{sx:{padding:"0px",margin:"0px",marginBottom:"10px"},children:e.jsx(le,{sx:et,children:I.description})}),g.map(({content:Y,name:ue,hidden:ve})=>!ve&&e.jsxs(X,{sx:{margin:"0px",marginBottom:"10px",padding:["object","array","boolean"].includes(I.properties[ue].type)?"0px":nn,border:["object","array","boolean"].includes(I.properties[ue].type)?"none":"1px solid grey"},children:[!["object","array","boolean"].includes(I.properties[ue].type)&&e.jsx(le,{sx:Ze,children:ue}),e.jsx(X,{sx:{flexGrow:1,padding:"0px",margin:"0px"},children:Y})]},ue)),e.jsxs(Ie,{open:ne,onClose:oe,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(De,{children:"Select a device"}),e.jsxs(Ne,{children:[e.jsxs(X,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(le,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(pe,{fullWidth:!0,variant:"outlined",value:B,onChange:me,placeholder:"Enter serial or name"})]}),e.jsx(nt,{dense:!0,children:bt.filter(Y=>Y.serial.toLowerCase().includes(B.toLowerCase())||Y.name.toLowerCase().includes(B.toLowerCase())).map((Y,ue)=>e.jsxs(pt,{onClick:()=>be(Y),sx:ht,children:[Y.icon==="wifi"&&e.jsx(K,{children:e.jsx(it,{style:je})}),Y.icon==="ble"&&e.jsx(K,{children:e.jsx(ut,{style:je})}),Y.icon==="hub"&&e.jsx(K,{children:e.jsx(mt,{style:je})}),e.jsx(te,{primary:Y.name,secondary:Y.serial,primaryTypographyProps:{style:xt},secondaryTypographyProps:{style:ft}})]},ue))})]}),e.jsx(Pe,{children:e.jsx(re,{onClick:oe,children:"Close"})})]})]})}function m(k){const{uiSchema:D}=k,{submitText:I,norender:g}=Oo(D);return g?null:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",margin:"10px",padding:"0px",gap:"20px"},children:[e.jsx(re,{type:"submit",variant:"contained",color:"primary",children:I}),e.jsx(re,{variant:"contained",color:"primary",onClick:c,children:"Cancel"})]})}function V(k){const{className:D,disabled:I,onClick:g,registry:d,style:L,uiSchema:ne,...ae}=k;return e.jsx(H,{title:"Remove the item",children:e.jsx(z,{disabled:I,size:"small",color:"primary",onClick:g,children:e.jsx(Ct,{})})})}function P(k){const{className:D,disabled:I,onClick:g,registry:d,uiSchema:L,...ne}=k;return e.jsx(H,{title:"Add an item",children:e.jsx(z,{size:"small",color:"primary",onClick:g,children:e.jsx(yt,{})})})}function Z(k){const{disabled:D,onClick:I,registry:g,style:d,uiSchema:L,...ne}=k;return e.jsx(H,{title:"Move up the item",children:e.jsx(z,{size:"small",color:"primary",onClick:I,children:e.jsx(Rt,{})})})}function he(k){const{disabled:D,onClick:I,registry:g,style:d,uiSchema:L,...ne}=k;return e.jsx(H,{title:"Move down the item",children:e.jsx(z,{size:"small",color:"primary",onClick:I,children:e.jsx(Lt,{})})})}function we(k){const{id:D,name:I,value:g,schema:d,readonly:L,onChange:ne}=k,[ae,B]=r.useState(void 0),ce=oe=>{B(oe&&oe!==""?oe:void 0)},me=()=>{n({id:t.current,sender:"ConfigPlugin",method:"/api/action",src:"Frontend",dst:"Matterbridge",params:{plugin:i.name,action:I,value:ae,formData:u,id:D}}),d.buttonClose===!0?c():d.buttonSave===!0&&b({formData:s})};return d.buttonText&&d.description?e.jsxs(X,{sx:{margin:"0px",padding:"10px",border:"1px solid grey",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(le,{sx:et,children:d.description}),e.jsx(re,{variant:"contained",color:"primary",onClick:()=>me(),children:d.buttonText})]}):d.buttonField&&d.description?e.jsxs(X,{sx:{margin:"0px",padding:"10px",gap:"20px",border:"1px solid grey",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(le,{sx:et,children:d.description}),e.jsx(pe,{id:I+"-input",name:I,label:d.textLabel,placeholder:d.textPlaceholder,onChange:oe=>ce(oe.target.value),sx:{width:"250px",minWidth:"250px",maxWidth:"250px"}}),e.jsx(re,{id:I+"-button",variant:"contained",color:"primary",disabled:ae===void 0,onClick:()=>me(),children:d.buttonField})]}):e.jsxs(X,{sx:{margin:"0px",padding:"5px 10px",border:"1px solid grey"},children:[I&&e.jsxs(X,{sx:{margin:"0px",padding:"0px",gap:"10px",display:"flex",justifyContent:"flex-start",alignItems:"center"},children:[e.jsx(le,{sx:Ze,children:I}),e.jsx(We,{checked:g,readOnly:L,onChange:()=>ne(!g),sx:{padding:"0px",margin:"0px"}})]}),d.description&&e.jsx(le,{sx:et,children:d.description})]})}function U({schema:k,id:D,name:I,options:g,label:d,hideLabel:L,required:ne,disabled:ae,placeholder:B,readonly:ce,value:me,multiple:oe,autofocus:be,onChange:ie,onBlur:ge,onFocus:Y,errorSchema:ue,rawErrors:ve=[],registry:Qe,uiSchema:Q,hideError:se,formContext:Fe,...Le}){const{enumOptions:Re,enumDisabled:Ue,emptyValue:ye}=g;oe=typeof oe>"u"?!1:!!oe;const Ge=oe?[]:"",Ke=typeof me>"u"||oe&&me.length<1||!oe&&me===Ge,wt=({target:{value:Oe}})=>ie(Nt(Oe,Re,ye)),Mt=({target:Oe})=>ge(D,Nt(Oe&&Oe.value,Re,ye)),kt=({target:Oe})=>Y(D,Nt(Oe&&Oe.value,Re,ye)),A=Ro(me,Re,oe),{InputLabelProps:Me,SelectProps:It,autocomplete:dr,...cr}=Le,pr=!oe&&k.default===void 0;return e.jsxs(pe,{id:D,name:D,value:!Ke&&typeof A<"u"?A:Ge,required:ne,disabled:ae||ce,autoFocus:be,autoComplete:dr,placeholder:B,error:ve.length>0,onChange:wt,onBlur:Mt,onFocus:kt,...cr,select:!0,InputLabelProps:{...Me,shrink:!Ke},SelectProps:{...It,multiple:oe},"aria-describedby":Ho(D),children:[pr&&e.jsx(W,{value:"",children:B}),Array.isArray(Re)&&Re.map(({value:Oe,label:ur},Ft)=>{const mr=Array.isArray(Ue)&&Ue.indexOf(Oe)!==-1;return e.jsx(W,{value:String(Ft),disabled:mr,children:ur},Ft)})]})}return!o||!N||!s?null:e.jsxs(Ie,{open:o,onClose:c,maxWidth:"800px",children:[e.jsx(De,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h3",{children:"Matterbridge plugin configuration"})]})}),e.jsx(Ne,{style:{padding:"0px",margin:"0px",width:"800px",height:"600px",overflow:"auto"},children:e.jsx(Fo,{schema:N,formData:s,uiSchema:T,validator:Lo,templates:{FieldTemplate:F,BaseInputTemplate:x,TitleFieldTemplate:_,DescriptionFieldTemplate:$,FieldHelpTemplate:J,FieldErrorTemplate:p,ErrorListTemplate:f,WrapIfAdditionalTemplate:y,ArrayFieldTitleTemplate:j,ArrayFieldDescriptionTemplate:R,ArrayFieldItemTemplate:de,ArrayFieldTemplate:fe,ObjectFieldTemplate:w,ButtonTemplates:{SubmitButton:m,RemoveButton:V,AddButton:P,MoveUpButton:Z,MoveDownButton:he}},widgets:{CheckboxWidget:we,SelectWidget:U},onChange:q,onSubmit:b})})]})};function sn({data:o,columns:c,columnVisibility:i}){const n=Ee.useMemo(()=>c.filter(M=>i[M.accessor]),[c,i]),{getTableProps:a,getTableBodyProps:h,headerGroups:v,rows:t,prepareRow:s}=_e.useTable({columns:n,data:o},_e.useSortBy);return e.jsxs("table",{...a(),style:{border:"none",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{border:"none",borderCollapse:"collapse"},children:v.map(M=>e.jsx("tr",{...M.getHeaderGroupProps(),style:{border:"none",borderCollapse:"collapse"},children:M.headers.map(N=>e.jsx("th",{...N.getHeaderProps(void 0),style:{border:"none",borderCollapse:"collapse",cursor:N.noSort?"default":"pointer"},children:N.render("Header")}))}))}),e.jsx("tbody",{...h(),style:{border:"none",borderCollapse:"collapse"},children:t.map((M,N)=>(s(M),e.jsx("tr",{className:N%2===0?"table-content-even":"table-content-odd",...M.getRowProps(),style:{border:"none",borderCollapse:"collapse"},children:M.cells.map(C=>e.jsx("td",{...C.getCellProps(),style:{border:"none",borderCollapse:"collapse"},children:C.render("Cell")}))},N)))})]})}function ln({_storeId:o,setStoreId:c}){const{online:i,sendMessage:n,addListener:a,removeListener:h,getUniqueId:v}=r.useContext(xe),{showConfirmCancelDialog:t}=r.useContext(ot),s=r.useRef(v()),[M,N]=r.useState(null),[C,T]=r.useState(null),[E,S]=r.useState([]),[O,u]=r.useState(!1),[q,b]=r.useState({name:!0,description:!0,version:!0,author:!0,type:!0,registeredDevices:!0,actions:!0,status:!0}),y=d=>{if(d===void 0||d.matter===void 0||!d.matter.fabricInformations&&!d.matter.qrPairingCode&&!d.matter.manualPairingCode)return"red";if(d.matter.commissioned===!1&&d.matter.qrPairingCode&&d.matter.manualPairingCode)return"var(--primary-color)";var L=0,ne=0;for(const ae of d.matter.sessionInformations??[])ae.fabric&&ae.isPeerActive===!0&&L++,ae.numberOfActiveSubscriptions>0&&(ne+=ae.numberOfActiveSubscriptions);return d.matter.commissioned===!0&&d.matter.fabricInformations&&d.matter.sessionInformations&&(L===0||ne===0)?"var(--secondary-color)":"var(--div-text-color)"},F=[{Header:"Name",accessor:"name",Cell:({row:d})=>e.jsx(H,{title:"Open the plugin homepage",children:e.jsx("span",{style:{cursor:"pointer"},onClick:()=>m(d.original),children:d.original.name})})},{Header:"Description",accessor:"description",Cell:({row:d})=>e.jsx(H,{title:"Open the plugin homepage",children:e.jsx("span",{style:{cursor:"pointer"},onClick:()=>m(d.original),children:d.original.description})})},{Header:"Version",accessor:"version",Cell:({row:d})=>e.jsxs(e.Fragment,{children:[d.original.latestVersion!==void 0&&d.original.latestVersion!==d.original.version&&C&&!C.readOnly&&e.jsx(H,{title:"New plugin stable version available, click to install",children:e.jsxs("span",{className:"status-warning",style:{marginRight:"10px"},onClick:()=>j(d.original),children:["Update to v.",d.original.latestVersion]})}),d.original.version.includes("-dev-")&&d.original.devVersion!==void 0&&d.original.devVersion!==d.original.version&&C&&!C.readOnly&&e.jsx(H,{title:"New plugin dev version available, click to install",children:e.jsxs("span",{className:"status-warning",style:{marginRight:"10px"},onClick:()=>R(d.original),children:["Update to new dev v.",d.original.devVersion.split("-dev-")[0]]})}),e.jsx(H,{title:"Plugin version",children:d.original.version})]})},{Header:"Author",accessor:"author",Cell:({row:d})=>e.jsx(e.Fragment,{children:d.original.author?d.original.author.replace("https://github.com/",""):"Unknown"})},{Header:"Type",accessor:"type",Cell:({row:d})=>e.jsx(e.Fragment,{children:d.original.type?d.original.type.replace("Platform",""):"Unknown"})},{Header:"Devices",accessor:"registeredDevices"},{Header:"Actions",accessor:"actions",Cell:({row:d})=>e.jsxs("div",{style:{margin:"0px",padding:"0px",gap:"4px",display:"flex",flexDirection:"row"},children:[C&&C.bridgeMode==="childbridge"&&!d.original.error&&d.original.enabled&&e.jsx(H,{title:"Shows the QRCode or the fabrics",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(z,{style:{margin:"0",padding:"0",width:"19px",height:"19px",color:y(d.original)},onClick:()=>c(d.original?.matter?.id),size:"small",children:e.jsx(Zt,{})})}),C&&C.bridgeMode==="childbridge"&&!d.original.error&&d.original.enabled&&e.jsx(H,{title:"Restart the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(z,{style:{margin:"0",padding:"0",width:"19px",height:"19px"},onClick:()=>fe(d.original),size:"small",children:e.jsx(vt,{})})}),e.jsx(H,{title:"Plugin config",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(z,{disabled:d.original.restartRequired===!0,style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>D(d.original),size:"small",children:e.jsx(Be,{})})}),C&&!C.readOnly&&e.jsx(H,{title:"Remove the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(z,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>{f("Remove plugin","Are you sure? This will remove also all the devices and configuration in the controller.","remove",d.original)},size:"small",children:e.jsx(Ct,{})})}),d.original.enabled?e.jsx(H,{title:"Disable the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(z,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>{f("Disable plugin","Are you sure? This will remove also all the devices and configuration in the controller.","disable",d.original)},size:"small",children:e.jsx(Tr,{})})}):e.jsx(e.Fragment,{}),d.original.enabled?e.jsx(e.Fragment,{}):e.jsx(H,{title:"Enable the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(z,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>w(d.original),size:"small",children:e.jsx(Wr,{})})}),e.jsx(H,{title:"Open the plugin help",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(z,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>P(d.original),size:"small",children:e.jsx(Fr,{})})}),e.jsx(H,{title:"Open the plugin version history",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(z,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>Z(d.original),size:"small",children:e.jsx(Lr,{})})}),C&&!C.readOnly&&e.jsx(H,{title:"Sponsor the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(z,{style:{margin:"0",padding:"0",width:"19px",height:"19px",color:"#b6409c"},onClick:()=>V(d.original),size:"small",children:e.jsx(Yt,{})})})]})},{Header:"Status",accessor:"status",Cell:({row:d})=>e.jsx("div",{style:{display:"flex",flexDirection:"row",flex:"1 1 auto",gap:"5px"},children:d.original.error?e.jsx(e.Fragment,{children:e.jsx(Xe,{status:!1,enabledText:"Error",disabledText:"Error",tooltipText:"The plugin is in error state. Check the log!"})}):e.jsx(e.Fragment,{children:d.original.enabled===!1?e.jsx(e.Fragment,{children:e.jsx(Xe,{status:d.original.enabled,enabledText:"Enabled",disabledText:"Disabled",tooltipText:"Whether the plugin is enable or disabled"})}):e.jsx(e.Fragment,{children:d.original.loaded&&d.original.started&&d.original.configured?e.jsx(e.Fragment,{children:e.jsx(Xe,{status:d.original.loaded,enabledText:"Running",tooltipText:"Whether the plugin is running"})}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{status:d.original.loaded,enabledText:"Loaded",tooltipText:"Whether the plugin has been loaded"}),e.jsx(Xe,{status:d.original.started,enabledText:"Started",tooltipText:"Whether the plugin started"}),e.jsx(Xe,{status:d.original.configured,enabledText:"Configured",tooltipText:"Whether the plugin has been configured"})]})})})})}];r.useEffect(()=>{const d=L=>{L.src==="Matterbridge"&&L.dst==="Frontend"&&(L.method==="refresh_required"&&L.params.changed==="plugins"&&(l&&console.log(`HomePlugins received refresh_required: changed=${L.params.changed} and sending /api/plugins request`),n({id:s.current,sender:"HomePlugins",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})),L.method==="refresh_required"&&L.params.changed==="settings"&&(l&&console.log(`HomePlugins received refresh_required: changed=${L.params.changed} and sending /api/settings request`),n({id:s.current,sender:"HomePlugins",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),L.id===s.current&&L.method==="/api/settings"&&(l&&console.log(`HomePlugins (id: ${L.id}) received settings:`,L.response),N(L.response.systemInformation),T(L.response.matterbridgeInformation)),L.id===s.current&&L.method==="/api/plugins"&&(l&&console.log(`HomePlugins (id: ${L.id}) received ${L.response.length} plugins:`,L.response),S(L.response)))};return a(d),l&&console.log("HomePlugins added WebSocket listener id:",s.current),()=>{h(d),l&&console.log("HomePlugins removed WebSocket listener")}},[a,h,n]),r.useEffect(()=>{i&&(l&&console.log("HomePlugins sending api requests"),n({id:s.current,sender:"HomePlugins",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),n({id:s.current,sender:"HomePlugins",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[i,n]),r.useEffect(()=>{const d=localStorage.getItem("homePluginsColumnVisibility");d&&b(JSON.parse(d))},[]);const $=()=>{u(!O)},_=d=>{b(L=>{const ne={...L,[d]:!L[d]};return localStorage.setItem("homePluginsColumnVisibility",JSON.stringify(ne)),ne})},J=r.useRef(null),f=(d,L,ne,ae)=>{l&&console.log(`handleActionWithConfirmCancel ${ne} ${ae.name}`),J.current=ae,t(d,L,ne,p,x)},p=d=>{l&&console.log(`handleConfirm action confirmed ${d} ${J.current.name}`),d==="remove"&&J.current?de(J.current):d==="disable"&&J.current&&w(J.current),J.current=null},x=d=>{l&&console.log(`handleCancel action canceled ${d} ${J.current.name}`),J.current=null},j=d=>{l&&console.log("handleUpdatePlugin plugin:",d.name),n({id:s.current,sender:"HomePlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:d.name,restart:!1}})},R=d=>{l&&console.log("handleUpdateDevPlugin plugin:",d.name),n({id:s.current,sender:"HomePlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:d.name+"@dev",restart:!1}})},de=d=>{l&&console.log("handleRemovePlugin plugin:",d.name),n({id:s.current,sender:"HomePlugins",method:"/api/removeplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:d.name}})},fe=d=>{l&&console.log("handleRestartPlugin plugin:",d.name),n({id:s.current,sender:"HomePlugins",method:"/api/restartplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:d.name}})},w=d=>{l&&console.log("handleEnableDisablePlugin plugin:",d.name,"enabled:",d.enabled),d.enabled===!0?(d.enabled=!1,n({id:s.current,sender:"HomePlugins",method:"/api/disableplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:d.name}})):(d.enabled=!0,n({id:s.current,sender:"HomePlugins",method:"/api/enableplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:d.name}}))},m=d=>{l&&console.log(`handleHomepagePlugin plugin: ${d.name} homepage: ${d.homepage}`),d.homepage&&window.open(d.homepage,"_blank")},V=d=>{l&&console.log("handleSponsorPlugin plugin:",d.name,"funding:",d.funding),d.funding&&window.open(d.funding,"_blank")},P=d=>{l&&console.log("handleHelpPlugin plugin:",d.name,"help:",d.help),d.help&&window.open(d.help,"_blank")},Z=d=>{l&&console.log("handleChangelogPlugin plugin:",d.name,"changelog:",d.changelog),d.changelog&&window.open(d.changelog,"_blank")},[he,we]=r.useState({}),[U,k]=r.useState(!1),D=d=>{l&&console.log("handleConfigPlugin plugin:",d.name),n({id:s.current,sender:"HomePlugins",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:d.name}}),n({id:s.current,sender:"HomePlugins",method:"/api/select/entities",src:"Frontend",dst:"Matterbridge",params:{plugin:d.name}}),we(d),I()},I=()=>{k(!0)},g=()=>{k(!1)};return l&&console.log("HomePlugins rendering..."),i?e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",width:"100%",flex:"0 0 auto",overflow:"hidden"},children:[e.jsx(an,{open:U,onClose:g,plugin:he}),e.jsxs(Ie,{open:O,onClose:$,children:[e.jsx(De,{children:"Configure Plugins Columns"}),e.jsx(Ne,{children:e.jsx(at,{children:F.map(d=>e.jsx(Te,{control:e.jsx(We,{disabled:["description","actions","status"].includes(d.accessor),checked:q[d.accessor],onChange:()=>_(d.accessor)}),label:d.Header},d.accessor))})}),e.jsx(Pe,{children:e.jsx(re,{onClick:$,children:"Close"})})]}),e.jsxs("div",{className:"MbfWindowHeader",style:{justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Plugins"}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(z,{onClick:$,"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(H,{title:"Configure columns",children:e.jsx(Be,{style:{color:"var(--header-text-color)",fontSize:"19px"}})})})})]}),e.jsx("div",{className:"MbfWindowBodyColumn",style:{margin:"0px",padding:"0px",gap:"0",overflow:"auto"},children:e.jsx(sn,{data:E,columns:F,columnVisibility:q})})]}):e.jsx(Je,{})}const dn=o=>{if(o===void 0||!o.qrPairingCode&&!o.manualPairingCode&&!o.fabricInformations&&!o.sessionInformations)return"red";if(o.commissioned===!1&&o.qrPairingCode&&o.manualPairingCode)return"var(--primary-color)";var c=0,i=0;for(const n of o.sessionInformations??[])n.fabric&&n.isPeerActive===!0&&c++,n.numberOfActiveSubscriptions>0&&(i+=n.numberOfActiveSubscriptions);return o.commissioned===!0&&o.fabricInformations&&o.sessionInformations&&(c===0||i===0)?"var(--secondary-color)":"var(--div-text-color)"},cn=o=>`${o.pluginName}::${o.serial}`;function pn({data:o,columns:c,columnVisibility:i}){const n=Ee.useMemo(()=>{const C=localStorage.getItem("homeDevicesColumnsSortBy");return C?JSON.parse(C):[{id:"name",desc:!1}]},[c]),a=Ee.useMemo(()=>c.filter(C=>i[C.accessor]),[i,c]),{getTableProps:h,getTableBodyProps:v,headerGroups:t,rows:s,prepareRow:M,state:{sortBy:N}}=_e.useTable({columns:a,data:o,getRowId:cn,initialState:{sortBy:n}},_e.useSortBy);return Ee.useEffect(()=>{localStorage.setItem("homeDevicesColumnsSortBy",JSON.stringify(N))},[N]),e.jsxs("table",{...h(),style:{border:"none",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{border:"none",borderCollapse:"collapse"},children:t.map(C=>e.jsx("tr",{...C.getHeaderGroupProps(),style:{border:"none",borderCollapse:"collapse"},children:C.headers.map(T=>e.jsxs("th",{...T.getHeaderProps(T.noSort?void 0:T.getSortByToggleProps()),style:{border:"none",borderCollapse:"collapse",cursor:T.noSort?"default":"pointer"},children:[T.render("Header"),!T.noSort&&e.jsx("span",{style:{margin:"0px",marginLeft:"5px",padding:"0px"},children:T.isSorted?T.isSortedDesc?e.jsx(ee,{path:Tt,size:"15px"}):e.jsx(ee,{path:Wt,size:"15px"}):null})]}))}))}),e.jsx("tbody",{...v(),style:{border:"none",borderCollapse:"collapse"},children:s.map((C,T)=>(M(C),e.jsx("tr",{className:T%2===0?"table-content-even":"table-content-odd",...C.getRowProps(),style:{border:"none",borderCollapse:"collapse"},children:C.cells.map(E=>e.jsx("td",{...E.getCellProps(),style:{border:"none",borderCollapse:"collapse"},children:E.render("Cell")}))})))})]})}function un({storeId:o,setStoreId:c}){const{online:i,sendMessage:n,addListener:a,removeListener:h,getUniqueId:v}=r.useContext(xe),[t,s]=r.useState(!1),[M,N]=r.useState(!0),[C,T]=r.useState(null),[E,S]=r.useState([]),[O,u]=r.useState([]),[q,b]=r.useState([]),[y,F]=r.useState([]),[$,_]=r.useState(!1),[J,f]=r.useState({pluginName:!0,name:!0,serial:!0,reachable:!0,powerSource:!0,configUrl:!1,actions:!0}),p=r.useRef(v()),x=[{Header:"Plugin",accessor:"pluginName"},{Header:"Name",accessor:"name"},{Header:"Serial",accessor:"serial"},{Header:"Availability",accessor:"reachable",Cell:({row:w})=>w.original.reachable===!0?"Online":w.original.reachable===!1?e.jsx("span",{style:{color:"red"},children:"Offline"}):"",sortType:(w,m)=>{const V=w.original.reachable===!0?1:w.original.reachable===!1?0:-1,P=m.original.reachable===!0?1:m.original.reachable===!1?0:-1;return V-P}},{Header:"Power",accessor:"powerSource",Cell:({row:w})=>w.original.powerSource==="ac"||w.original.powerSource==="dc"?e.jsx(er,{fontSize:"small",sx:{color:"var(--primary-color)"}}):w.original.powerSource==="ok"?e.jsx(jt,{fontSize:"small",sx:{color:"green"}}):w.original.powerSource==="warning"?e.jsx(jt,{fontSize:"small",sx:{color:"yellow"}}):w.original.powerSource==="critical"?e.jsx(jt,{fontSize:"small",sx:{color:"red"}}):e.jsx("span",{})},{Header:"Url",accessor:"configUrl"},{Header:"Actions",accessor:"actions",noSort:!0,Cell:({row:w})=>e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[w.original.matter!==void 0?e.jsx(H,{title:"Show the QRCode or the fabrics",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(z,{onClick:()=>c(o===w.original.matter.id?C.matterbridgeInformation.bridgeMode==="bridge"?"Matterbridge":null:w.original.matter.id),"aria-label":"Show the QRCode",sx:{margin:0,padding:0,color:dn(w.original.matter)},children:e.jsx(Zt,{fontSize:"small"})})}):e.jsx("div",{style:{width:"20px",height:"20px"}}),w.original.configUrl?e.jsx(H,{title:"Open the configuration page",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(z,{onClick:()=>window.open(w.original.configUrl,"_blank"),"aria-label":"Open config url",sx:{margin:0,padding:0},children:e.jsx(Be,{fontSize:"small"})})}):e.jsx("div",{style:{width:"20px",height:"20px"}}),w.original.selected!==void 0?e.jsx(H,{title:"Select/unselect the device",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(We,{checked:w.original.selected,onChange:m=>fe(m,w.original),sx:{margin:"0",marginLeft:"8px",padding:"0"},size:"small"})}):e.jsx("div",{style:{width:"20px",height:"20px"}})]})}],j=Ee.useCallback(w=>{w.selected=void 0;const m=E.find(Z=>Z.name===w.pluginName);if(!m)return console.error(`HomeDevices isSelected: plugin ${w.pluginName} not found for device ${w.deviceName} `),w.selected;const V=m.schemaJson?.properties?.whiteList?.selectFrom;let P=m.configJson?.postfix;return P===""&&(P=void 0),m.hasWhiteList===!0&&m.hasBlackList===!0&&V&&(w.selected=!0,V==="serial"&&m.configJson.whiteList&&m.configJson.whiteList.length>0&&m.configJson.whiteList.includes(P?w.serial.replace("-"+P,""):w.serial)&&(w.selected=!0),V==="serial"&&m.configJson.whiteList&&m.configJson.whiteList.length>0&&!m.configJson.whiteList.includes(P?w.serial.replace("-"+P,""):w.serial)&&(w.selected=!1),V==="serial"&&m.configJson.blackList&&m.configJson.blackList.length>0&&m.configJson.blackList.includes(P?w.serial.replace("-"+P,""):w.serial)&&(w.selected=!1),V==="name"&&m.configJson.whiteList&&m.configJson.whiteList.length>0&&m.configJson.whiteList.includes(w.name)&&(w.selected=!0),V==="name"&&m.configJson.whiteList&&m.configJson.whiteList.length>0&&!m.configJson.whiteList.includes(w.name)&&(w.selected=!1),V==="name"&&m.configJson.blackList&&m.configJson.blackList.length>0&&m.configJson.blackList.includes(w.name)&&(w.selected=!1)),w.selected},[E]);r.useEffect(()=>{const w=m=>{if(m.src==="Matterbridge"&&m.dst==="Frontend"){if(m.method==="refresh_required"&&(console.log(`HomeDevices received refresh_required: changed=${m.params.changed} and sending /api/plugins request`),n({id:p.current,sender:"HomeDevices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})),m.method==="restart_required"&&(l&&console.log("HomeDevices received restart_required"),s(!0)),m.method==="restart_not_required"&&(l&&console.log("HomeDevices received restart_not_required"),s(!1)),m.method==="state_update"&&m.params.plugin&&m.params.serialNumber&&m.params.cluster.includes("BasicInformationServer")&&m.params.attribute==="reachable"&&(console.log(`HomeDevices updating device reachability for plugin ${m.params.plugin} serial ${m.params.serialNumber} value ${m.params.value}`),u(V=>V.map(P=>P.pluginName===m.params.plugin&&P.serial===m.params.serialNumber?{...P,reachable:m.params.value}:P))),m.id===p.current&&m.method==="/api/settings"&&(l&&console.log(`HomeDevices (id: ${m.id}) received settings:`,m.response),T(m.response),s(m.response.matterbridgeInformation.restartRequired||m.response.matterbridgeInformation.fixedRestartRequired)),m.id===p.current&&m.method==="/api/plugins"&&(l&&console.log(`HomeDevices (id: ${m.id}) received ${m.response?.length} plugins:`,m.response),m.response)){let V=!0;for(const P of m.response)P.enabled===!0&&(P.loaded!==!0||P.started!==!0||P.error===!0)&&(V=!1);if(!V)return;l&&console.log("HomeDevices reset plugins, devices and selectDevices"),N(!1),S(m.response),u([]),b([]),n({id:p.current,sender:"HomeDevices",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}}),l&&console.log("HomeDevices sent /api/devices");for(const P of m.response)P.enabled===!0&&P.loaded===!0&&P.started===!0&&P.error!==!0&&(n({id:p.current,sender:"HomeDevices",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:P.name}}),l&&console.log(`HomeDevices sent /api/select/devices for plugin: ${P.name}`))}if(m.id===p.current&&m.method==="/api/devices"&&(l&&console.log(`HomeDevices (id: ${m.id}) received ${m.response?.length} devices:`,m.response),m.response)){for(const V of m.response)V.selected=j(V);u(m.response)}m.id===p.current&&m.method==="/api/select/devices"&&(l&&console.log(`HomeDevices (id: ${m.id}) received ${m.response?.length} selectDevices for plugin ${m.response&&m.response.length>0?m.response[0].pluginName:"no select devices"}:`,m.response),m.response&&m.response.length>0&&b(V=>{const P=V.filter(he=>he.pluginName!==m.response[0].pluginName),Z=m.response.map(he=>({...he,selected:j(he)}));return[...P,...Z]}))}};return a(w),l&&console.log(`HomeDevices added WebSocket listener id ${p.current}`),()=>{h(w),l&&console.log("HomeDevices removed WebSocket listener")}},[E,a,h,n,j]),r.useEffect(()=>{if(O.length===0&&q.length===0)return;console.log(`HomeDevices mixing devices (${O.length}) and selectDevices (${q.length})`);const w=[];for(const m of O)w.push(m);for(const m of q)O.find(V=>V.pluginName===m.pluginName&&V.serial.includes(m.serial))||w.push(m);w.length>0&&(F(w),console.log(`HomeDevices mixed ${w.length} devices and selectDevices`))},[E,O,q,F]),r.useEffect(()=>{i&&(l&&console.log("HomeDevices sending /api/settings and /api/plugins requests"),n({id:p.current,sender:"HomeDevices",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),n({id:p.current,sender:"HomeDevices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[i,n]),r.useEffect(()=>{const w=localStorage.getItem("homeDevicesColumnVisibility");if(w){const m=JSON.parse(w);m.powerSource===void 0&&(m.powerSource=!0),f(m),l&&console.log("HomeDevices loaded column visibility from localStorage")}},[]);const R=w=>{f(m=>{const V={...m,[w]:!m[w]};return localStorage.setItem("homeDevicesColumnVisibility",JSON.stringify(V)),l&&console.log("HomeDevices saved column visibility to localStorage",JSON.stringify(V),V),V})},de=()=>{_(!$)},fe=(w,m)=>{console.log(`handleCheckboxChange: checkbox changed to ${w.target.checked} for device ${m.name} serial ${m.serial}`),F(V=>{const P=V.findIndex(he=>he.pluginName===m.pluginName&&he.serial===m.serial);if(P<0)return console.error(`handleCheckboxChange: device not found ${m.name} serial ${m.serial} id ${m.id}`),V;const Z=[...V];return Z[P]={...Z[P],selected:w.target.checked},Z}),w.target.checked?n({id:p.current,sender:"HomeDevices",method:"/api/command",src:"Frontend",dst:"Matterbridge",params:{command:"selectdevice",plugin:m.pluginName,serial:m.serial,name:m.name}}):n({id:p.current,sender:"HomeDevices",method:"/api/command",src:"Frontend",dst:"Matterbridge",params:{command:"unselectdevice",plugin:m.pluginName,serial:m.serial,name:m.name}})};return l&&console.log("HomeDevices rendering..."),i?e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",width:"100%",flex:"1 1 auto",overflow:"hidden"},children:[e.jsxs(Ie,{open:$,onClose:de,children:[e.jsx(De,{children:"Configure Devices Columns"}),e.jsx(Ne,{children:e.jsx(at,{children:x.map(w=>e.jsx(Te,{control:e.jsx(We,{disabled:["name","actions"].includes(w.accessor),checked:J[w.accessor],onChange:()=>R(w.accessor)}),label:w.Header},w.accessor))})}),e.jsx(Pe,{children:e.jsx(re,{onClick:de,children:"Close"})})]}),e.jsxs("div",{className:"MbfWindowHeader",style:{justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Devices"}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(z,{onClick:de,"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(H,{title:"Configure columns",children:e.jsx(Be,{style:{color:"var(--header-text-color)",fontSize:"19px"}})})})})]}),e.jsx("div",{className:"MbfWindowBodyColumn",style:{margin:"0px",padding:"0px",gap:"0",overflow:"auto"},children:e.jsx(pn,{data:y,columns:x,columnVisibility:J})}),e.jsxs("div",{className:"MbfWindowFooter",style:{borderTop:"1px solid var(--table-border-color)",justifyContent:"space-between"},children:[M&&e.jsx("p",{className:"MbfWindowFooterText",style:{fontWeight:"normal",fontSize:"14px",color:"var(--secondary-color)"},children:"Waiting for the plugins to fully load..."}),!M&&e.jsxs("p",{className:"MbfWindowFooterText",style:{fontWeight:"normal",fontSize:"14px",color:"var(--secondary-color)"},children:["Registered devices: ",O.length.toString(),"/",y.length.toString()]}),t&&e.jsx("p",{className:"MbfWindowFooterText",style:{fontWeight:"normal",fontSize:"14px",color:"var(--secondary-color)"},children:"Restart required"})]})]}):e.jsx(Je,{})}function mn(){const[o,c]=r.useState(null),[i,n]=r.useState(null),[a,h]=r.useState([]),[v]=r.useState(localStorage.getItem("homePagePlugins")!=="false"),[t,s]=r.useState(localStorage.getItem("homePageMode")??"devices"),[M,N]=r.useState(""),[C,T]=r.useState(!1),[E,S]=r.useState(!1),[O,u]=r.useState(null),{addListener:q,removeListener:b,online:y,sendMessage:F,logFilterLevel:$,logFilterSearch:_,autoScroll:J,getUniqueId:f}=r.useContext(xe),p=r.useRef(f());return r.useEffect(()=>{const x=j=>{j.src==="Matterbridge"&&j.dst==="Frontend"&&(j.method==="refresh_required"&&j.params.changed==="settings"&&(l&&console.log(`Home received refresh_required: changed=${j.params.changed} and sending /api/settings request`),F({id:p.current,sender:"Home",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),j.id===p.current&&j.method==="/api/settings"&&(l&&console.log("Home received settings:",j.response),c(j.response.systemInformation),n(j.response.matterbridgeInformation),j.response.matterbridgeInformation.bridgeMode==="bridge"&&(O||u("Matterbridge")),j.response.matterbridgeInformation.bridgeMode==="childbridge"&&a.length>0&&O===null&&(O||u(a[0].matter.id)),j.response.matterbridgeInformation.matterbridgeVersion&&N(`https://github.com/Luligu/matterbridge/blob/${j.response.matterbridgeInformation.matterbridgeVersion.includes("-dev-")?"dev":"main"}/CHANGELOG.md`),localStorage.getItem("frontendVersion")===null?localStorage.setItem("frontendVersion",j.response.matterbridgeInformation.frontendVersion):j.response.matterbridgeInformation.frontendVersion!==localStorage.getItem("frontendVersion")&&(localStorage.setItem("frontendVersion",j.response.matterbridgeInformation.frontendVersion),S(!0)),localStorage.getItem("matterbridgeVersion")===null?localStorage.setItem("matterbridgeVersion",j.response.matterbridgeInformation.matterbridgeVersion):j.response.matterbridgeInformation.matterbridgeVersion!==localStorage.getItem("matterbridgeVersion")&&(localStorage.setItem("matterbridgeVersion",j.response.matterbridgeInformation.matterbridgeVersion),T(!0)),j.response.matterbridgeInformation.shellyBoard&&(localStorage.getItem("homePageMode")||(localStorage.setItem("homePageMode","devices"),s("devices")))),j.id===p.current&&j.method==="/api/plugins"&&(l&&console.log(`Home received plugins (${i?.bridgeMode}):`,j.response),h(j.response),i?.bridgeMode==="childbridge"&&j.response.length>0&&(O||u(j.response[0].matter.id))))};return q(x),l&&console.log(`Home added WebSocket listener id ${p.current}`),()=>{b(x),l&&console.log("Home removed WebSocket listener")}},[q,b,F,i,a,O]),r.useEffect(()=>{y&&(l&&console.log("Home received online"),F({id:p.current,sender:"Home",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),F({id:p.current,sender:"Home",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[y,F]),l&&console.log("Home rendering..."),!y||!o||!i?e.jsx(Je,{}):e.jsxs("div",{className:"MbfPageDiv",style:{flexDirection:"row"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",width:"302px",minWidth:"302px",gap:"20px"},children:[e.jsx(en,{id:O}),e.jsx(Ko,{systemInfo:o,compact:!0})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",width:"100%",gap:"20px"},children:[E&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Frontend Update"})}),e.jsxs("div",{className:"MbfWindowBody",style:{flexDirection:"row",justifyContent:"space-between"},children:[e.jsx("h4",{style:{margin:0},children:"The frontend has been updated. You are viewing an outdated web UI. Please refresh the page now."}),e.jsx("div",{children:e.jsx(re,{onClick:()=>window.location.reload(),endIcon:e.jsx(Rr,{}),style:{marginLeft:"10px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Refresh"})})]})]}),C&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge Update"})}),e.jsxs("div",{className:"MbfWindowBody",style:{flexDirection:"row",justifyContent:"space-between"},children:[e.jsx("h4",{style:{margin:0},children:"Matterbridge has been updated."}),e.jsxs("div",{children:[e.jsx(re,{onClick:()=>window.open(M,"_blank"),endIcon:e.jsx(Xt,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Changelog"}),e.jsx(re,{onClick:()=>window.location.reload(),endIcon:e.jsx(Hr,{}),style:{marginLeft:"10px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Close"})]})]})]}),v&&!i.readOnly&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Install plugins"})}),e.jsx(tn,{})]}),v&&e.jsx(ln,{storeId:O,setStoreId:u}),t==="devices"&&e.jsx(un,{storeId:O,setStoreId:u}),t==="logs"&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"1 1 auto",width:"100%",overflow:"hidden"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",minHeight:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",children:"Logs"}),e.jsx("div",{className:"MbfWindowHeaderText",style:{display:"flex",justifyContent:"space-between"},children:e.jsxs("span",{style:{fontWeight:"normal",fontSize:"12px",marginTop:"2px"},children:['Filter: logger level "',$,'" and search "',_,'" Scroll: ',J?"auto":"manual"]})})]}),e.jsx("div",{style:{flex:"1 1 auto",margin:"0px",padding:"10px",overflow:"auto"},children:e.jsx(nr,{})})]})]})]})}const Jt={display:"flex",gap:"2px",justifyContent:"space-evenly",width:"100%",height:"40px"},gn={margin:"0",padding:"0",fontSize:"36px",fontWeight:"medium",color:"var(--primary-color)"},hn={margin:"0",padding:"0",fontSize:"20px",fontWeight:"medium",color:"var(--div-text-color)",textAlign:"center"},Qt={margin:"0",padding:"0",paddingBottom:"2px",fontSize:"16px",fontWeight:"medium",color:"var(--div-text-color)",textAlign:"center"},xn={display:"flex",gap:"2px",justifyContent:"center",width:"100%",height:"18px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},fn={margin:"0",padding:"0",fontSize:"12px",fontWeight:"normal",color:"var(--div-text-color)"},bn={display:"flex",justifyContent:"center",width:"100%",height:"52px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},vn={margin:"0",padding:"0",fontSize:"14px",fontWeight:"bold",color:"var(--div-text-color)"},yn={display:"flex",gap:"4px",justifyContent:"center",width:"100%",height:"15px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},Pt={margin:"0",padding:"0px 4px",borderRadius:"5px",textAlign:"center",fontSize:"12px",fontWeight:"normal",color:"var(--secondary-color)"},jn=[256,257,268,269],Cn=[266,267],Sn=[259,260,261,271,272],wn=[256,257,268,269,266,267,259,260,261];function G({icon:o,iconColor:c,cluster:i,value:n,unit:a,prefix:h}){return l&&console.log(`Render cluster "${i.clusterName}.${i.attributeName}" value(${typeof n}-${isNaN(n)}) "${n}" unit "${a}"`),h=h??!1,e.jsxs(X,{sx:Jt,children:[o&&Ee.cloneElement(o,{key:`${i.clusterId}-${i.attributeId}-icon`,sx:{...gn,color:c??"var(--primary-color)"}}),e.jsxs(X,{sx:{...Jt,gap:"4px",alignContent:"center",alignItems:"end",justifyContent:"center"},children:[a&&h===!0&&e.jsx(le,{sx:Qt,children:a},`${i.clusterId}-${i.attributeId}-unit`),e.jsx(le,{sx:hn,children:n==null||typeof n=="number"&&isNaN(n)||n==="NaN"?"---":n},`${i.clusterId}-${i.attributeId}-value`),a&&h===!1&&e.jsx(le,{sx:Qt,children:a},`${i.clusterId}-${i.attributeId}-unit`)]},`${i.clusterId}-${i.attributeId}-valueunitbox`)]},`${i.clusterId}-${i.attributeId}-box`)}function Mn({device:o,endpoint:c,id:i,deviceType:n,clusters:a}){const h=["Unknown","Good","Fair","Moderate","Poor","VeryPoor","Ext.Poor"];let v="";return l&&console.log(`Device "${o.name}" endpoint "${c}" id "${i}" deviceType "0x${n.toString(16).padStart(4,"0")}" clusters (${a?.length}):`,a),n===17&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="batVoltage").map(t=>v=`${t.attributeLocalValue} mV`),wn.includes(n)&&a.filter(t=>t.clusterName==="LevelControl"&&t.attributeName==="currentLevel").map(t=>v=`Level ${t.attributeValue}`),n===514&&a.filter(t=>t.clusterName==="WindowCovering"&&t.attributeName==="currentPositionLiftPercent100ths").map(t=>v=`Position ${t.attributeValue/100}%`),n===769&&a.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="occupiedHeatingSetpoint").map(t=>v=`Heat ${t.attributeValue/100}°C `),n===769&&a.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="occupiedCoolingSetpoint").map(t=>v=v+`Cool ${t.attributeValue/100}°C`),n===118&&a.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="coState").map(t=>v=`${t.attributeLocalValue===0?"No CO detected":"CO alarm!"}`),n===1296&&a.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="voltage").map(t=>v=`${t.attributeLocalValue/1e3} V, `),n===1296&&a.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="activeCurrent").map(t=>v=v+`${t.attributeLocalValue/1e3} A, `),n===1296&&a.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="activePower").map(t=>v=v+`${t.attributeLocalValue/1e3} W`),e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0px",padding:"5px",width:"150px",height:"150px",borderColor:"var(--div-bg-color)",borderRadius:"5px",justifyContent:"space-between"},children:[n===19&&a.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(G,{icon:t.attributeLocalValue===!0?e.jsx(it,{}):e.jsx(Or,{}),iconColor:t.attributeLocalValue===!0?"green":"red",cluster:t,value:t.attributeLocalValue===!0?"Online":"Offline"})),n===17&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="batPercentRemaining").map(t=>e.jsx(G,{icon:e.jsx(jt,{}),cluster:t,value:t.attributeValue/2,unit:"%"})),n===17&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="wiredCurrentType").map(t=>e.jsx(G,{icon:e.jsx(er,{}),cluster:t,value:t.attributeLocalValue===0?"AC":"DC"})),n===1293&&a.filter(t=>t.clusterName==="DeviceEnergyManagement"&&t.attributeName==="esaState").map(t=>e.jsx(G,{icon:e.jsx(ee,{path:go,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Offline":"Online"})),jn.includes(n)&&a.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(G,{icon:e.jsx($r,{}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),Cn.includes(n)&&a.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(G,{icon:e.jsx(ee,{path:ho,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),Sn.includes(n)&&a.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(G,{icon:e.jsx(ee,{path:xo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),n===115&&a.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(G,{icon:e.jsx(ee,{path:fo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),n===124&&a.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(G,{icon:e.jsx(ee,{path:bo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),n===117&&a.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(G,{icon:e.jsx(ee,{path:vo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),n===123&&a.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(G,{icon:e.jsx($t,{}),cluster:t,value:"Oven"})),n===112&&a.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(G,{icon:e.jsx(Er,{}),cluster:t,value:"Fridge"})),n===113&&a.filter(t=>t.clusterName==="TemperatureControl"&&t.attributeName==="selectedTemperatureLevel").map(t=>e.jsx(G,{icon:e.jsx(ee,{path:yo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),n===121&&a.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(G,{icon:e.jsx($t,{}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),n===122&&a.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="fanMode").map(t=>e.jsx(G,{icon:e.jsx(ee,{path:jo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),n===120&&a.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(G,{icon:e.jsx(ee,{path:Ut,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Cooktop"})),n===119&&a.filter(t=>t.clusterName==="TemperatureControl"&&t.attributeName==="selectedTemperatureLevel").map(t=>e.jsx(G,{icon:e.jsx(ee,{path:Ut,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),n===116&&a.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(G,{icon:e.jsx(ee,{path:Co,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Robot"})),n===514&&a.filter(t=>t.clusterName==="WindowCovering"&&t.attributeName==="currentPositionLiftPercent100ths").map(t=>e.jsx(G,{icon:e.jsx(Vr,{}),cluster:t,value:t.attributeLocalValue/100,unit:"%"})),n===769&&a.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="localTemperature").map(t=>e.jsx(G,{icon:e.jsx(ee,{path:So,size:"40px",color:"var(--primary-color)"}),cluster:t,value:(t.attributeLocalValue??0)/100,unit:"°C"})),n===10&&a.filter(t=>t.clusterName==="DoorLock"&&t.attributeName==="lockState").map(t=>e.jsx(G,{icon:t.attributeValue==="1"?e.jsx(Ar,{}):e.jsx(_r,{}),cluster:t,value:t.attributeValue==="1"?"Locked":"Unlocked"})),n===43&&a.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="percentCurrent").map(t=>e.jsx(G,{icon:e.jsx(Ur,{}),cluster:t,value:t.attributeValue,unit:"%"})),n===15&&a.filter(t=>t.clusterName==="Switch"&&t.attributeName==="currentPosition").map(t=>e.jsx(G,{icon:e.jsx(ee,{path:wo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeValue,unit:"pos",prefix:!0})),n===39&&a.filter(t=>t.clusterName==="ModeSelect"&&t.attributeName==="currentMode").map(t=>e.jsx(G,{icon:e.jsx(zr,{}),cluster:t,value:t.attributeValue,unit:"mode",prefix:!0})),n===771&&a.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(G,{icon:e.jsx(qr,{}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),n===45&&a.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="percentCurrent").map(t=>e.jsx(G,{icon:e.jsx(Et,{}),cluster:t,value:t.attributeValue,unit:"%"})),n===114&&a.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="localTemperature").map(t=>e.jsx(G,{icon:e.jsx(Et,{}),cluster:t,value:(t.attributeLocalValue??0)/100,unit:"°C"})),n===67&&a.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(G,{icon:e.jsx(Br,{}),cluster:t,value:t.attributeLocalValue===!0?"Leak":"No leak"})),n===65&&a.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(G,{icon:e.jsx(Jr,{}),cluster:t,value:t.attributeLocalValue===!0?"Freeze":"No freeze"})),n===68&&a.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(G,{icon:e.jsx(Qr,{}),cluster:t,value:t.attributeLocalValue===!0?"Rain":"No rain"})),n===1292&&a.filter(t=>t.clusterName==="EnergyEvse"&&t.attributeName==="state").map(t=>e.jsx(G,{icon:e.jsx(ee,{path:Mo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Free":"In use"})),n===1295&&a.filter(t=>t.clusterName==="WaterHeaterManagement"&&t.attributeName==="tankPercentage").map(t=>e.jsx(G,{icon:e.jsx(ee,{path:ko,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Tank "+(t.attributeLocalValue??0)+"%"})),n===777&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="featureMap").map(t=>e.jsx(G,{icon:e.jsx(ee,{path:Io,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"HeatPump"})),n===23&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="featureMap").map(t=>e.jsx(G,{icon:e.jsx(ee,{path:Do,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Solar"})),n===24&&a.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="featureMap").map(t=>e.jsx(G,{icon:e.jsx(ee,{path:No,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Inverter"})),n===118&&a.find(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="featureMap"&&t.attributeLocalValue.smokeAlarm===!0)&&a.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="smokeState").map(t=>e.jsx(G,{icon:e.jsx(ee,{path:zt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"No smoke":"Smoke!"})),n===118&&a.find(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="featureMap"&&t.attributeLocalValue.smokeAlarm===!1)&&a.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="coState").map(t=>e.jsx(G,{icon:e.jsx(ee,{path:zt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"No Co":"Co!"})),n===66&&a.filter(t=>t.clusterName==="ValveConfigurationAndControl"&&t.attributeName==="currentState").map(t=>e.jsx(G,{icon:e.jsx(Gr,{}),cluster:t,value:t.attributeLocalValue===0?"Closed":"Opened"})),n===44&&a.filter(t=>t.clusterName==="AirQuality"&&t.attributeName==="airQuality").map(t=>e.jsx(G,{icon:e.jsx(ee,{path:Po,size:"40px",color:"var(--primary-color)"}),cluster:t,value:h[t.attributeLocalValue??0]})),n===770&&a.filter(t=>t.clusterName==="TemperatureMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(G,{icon:e.jsx(Kr,{}),cluster:t,value:t.attributeLocalValue/100,unit:"°C"})),n===775&&a.filter(t=>t.clusterName==="RelativeHumidityMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(G,{icon:e.jsx(ee,{path:To,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue/100,unit:"%"})),n===774&&a.filter(t=>t.clusterName==="FlowMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(G,{icon:e.jsx(Yr,{}),cluster:t,value:t.attributeLocalValue,unit:"l/h"})),n===773&&a.filter(t=>t.clusterName==="PressureMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(G,{icon:e.jsx(Xr,{}),cluster:t,value:t.attributeLocalValue,unit:"hPa"})),n===21&&a.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(G,{icon:t.attributeValue==="true"?e.jsx(Zr,{}):e.jsx(eo,{}),cluster:t,value:t.attributeValue==="true"?"Closed":"Opened"})),n===263&&a.filter(t=>t.clusterName==="OccupancySensing"&&t.attributeName==="occupancy").map(t=>e.jsx(G,{icon:t.attributeValue==="{ occupied: true }"?e.jsx(to,{}):e.jsx(ro,{}),cluster:t,value:t.attributeValue==="{ occupied: true }"?"Occupied":"Unocc."})),n===262&&a.filter(t=>t.clusterName==="IlluminanceMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(G,{icon:e.jsx(oo,{}),cluster:t,value:Math.round(Math.pow(10,t.attributeValue/1e4)),unit:"lx"})),n===1296&&a.filter(t=>t.clusterName==="ElectricalEnergyMeasurement"&&t.attributeName==="cumulativeEnergyImported").map(t=>e.jsx(G,{icon:e.jsx(no,{}),cluster:t,value:Math.round(t.attributeLocalValue?.energy/1e6),unit:"kwh"})),e.jsx(X,{sx:xn,children:e.jsx(le,{sx:fn,children:v})}),e.jsx(X,{sx:bn,children:e.jsx(le,{sx:vn,children:o.name})}),e.jsxs(X,{sx:yn,children:[l&&e.jsx(le,{sx:Pt,children:c}),e.jsx(le,{sx:Pt,children:i}),l&&e.jsxs(le,{sx:Pt,children:["0x",n.toString(16).padStart(4,"0")]})]})]})}function kn({filter:o}){const{online:c,sendMessage:i,addListener:n,removeListener:a,getUniqueId:h}=r.useContext(xe),[v,t]=r.useState(!1),[s,M]=r.useState({}),[N,C]=r.useState([]),[T,E]=r.useState([]),[S,O]=r.useState({}),[u,q]=r.useState({}),[b,y]=r.useState({}),[F,$]=r.useState(T),_=r.useRef(h()),J=()=>{t(!v)};return r.useEffect(()=>{const f=p=>{if(p.src==="Matterbridge"&&p.dst==="Frontend"){if(p.method==="refresh_required"&&(l&&console.log(`DevicesIcons received refresh_required: changed=${p.params.changed} and sending api requests`),i({id:_.current,sender:"Icons",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),i({id:_.current,sender:"Icons",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),i({id:_.current,sender:"Icons",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}})),p.method==="/api/settings"&&p.response&&(l&&console.log("DevicesIcons received settings:",p.response),M(p.response)),p.method==="/api/plugins"&&p.response&&(l&&console.log("DevicesIcons received plugins:",p.response),C(p.response)),p.method==="/api/devices"&&p.response){l&&console.log(`DevicesIcons received ${p.response.length} devices:`,p.response),E(p.response);for(let x of p.response)l&&console.log("DevicesIcons sending /api/clusters"),i({id:_.current,sender:"Icons",method:"/api/clusters",src:"Frontend",dst:"Matterbridge",params:{plugin:x.pluginName,endpoint:x.endpoint}})}if(p.method==="/api/clusters"&&p.response){if(console.log(`DevicesIcons received for device "${p.response.deviceName}" serial "${p.response.serialNumber}" deviceType ${p.response.deviceTypes.join(" ")} clusters (${p.response.length}):`,p.response),p.response.length===0)return;const x=p.response.serialNumber;S[x]=[],u[x]=p.response.deviceTypes,b[x]=[];for(let j of p.response.clusters)S[x].find(R=>R.endpoint===j.endpoint)||S[x].push({endpoint:j.endpoint,id:j.id,deviceTypes:j.deviceTypes}),!["FixedLabel","Descriptor","Identify","Groups","PowerTopology"].includes(j.clusterName)&&b[x].push(j);O({...S}),q({...u}),y({...b}),l&&console.log(`DevicesIcons endpoints for "${x}":`,S[x]),l&&console.log(`DevicesIcons deviceTypes for "${x}":`,u[x]),l&&console.log(`DevicesIcons clusters for "${x}":`,b[x])}}};return n(f),l&&console.log("DevicesIcons useEffect webSocket mounted"),()=>{a(f),l&&console.log("DevicesIcons useEffect webSocket unmounted")}},[n,a,i]),r.useEffect(()=>(l&&console.log("DevicesIcons useEffect online mounting"),c&&(l&&console.log("DevicesIcons useEffect online sending api requests"),i({id:_.current,sender:"Icons",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),i({id:_.current,sender:"Icons",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),i({id:_.current,sender:"Icons",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}})),l&&console.log("DevicesIcons useEffect online mounted"),()=>{l&&console.log("DevicesIcons useEffect online unmounted")}),[c,i]),r.useEffect(()=>{if(o===""){$(T);return}const f=T.filter(p=>p.name.toLowerCase().includes(o)||p.serial.toLowerCase().includes(o));$(f)},[T,o]),l&&console.log("DevicesIcons rendering..."),e.jsxs(e.Fragment,{children:[e.jsxs(Ie,{open:v,onClose:J,PaperProps:{style:{color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",border:"2px solid var(--primary-color)",borderRadius:"var(--div-border-radius)",boxShadow:"2px 2px 5px var(--div-shadow-color)"}},children:[e.jsx(De,{children:"Configure accessories"}),e.jsx(Ne,{}),e.jsx(Pe,{children:e.jsx(re,{onClick:J,children:"Close"})})]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",paddingBottom:"5px",gap:"20px",width:"100%",overflow:"auto"},children:F.map(f=>S[f.serial]&&S[f.serial].map(p=>p.deviceTypes.map(x=>e.jsx(Mn,{device:f,endpoint:p.endpoint,id:p.id,deviceType:x,clusters:b[f.serial].filter(j=>j.endpoint===p.endpoint)}))))})]})}const ir=[{Header:"Plugin name",accessor:"pluginName"},{Header:"Device type",accessor:"type"},{Header:"Endpoint",accessor:"endpoint"},{Header:"Name",accessor:"name"},{Header:"Serial number",accessor:"serial"},{Header:"Unique ID",accessor:"uniqueId"},{Header:"Url",accessor:"configUrl"},{Header:"Config",accessor:"configButton",noSort:!0,Cell:({row:o})=>o.original.configUrl?e.jsx(z,{onClick:()=>window.open(o.original.configUrl,"_blank"),"aria-label":"Open Config",sx:{margin:0,padding:0},children:e.jsx(Be,{fontSize:"small"})}):null},{Header:"Cluster",accessor:"cluster"}],ar=[{Header:"Endpoint",accessor:"endpoint"},{Header:"Id",accessor:"id"},{Header:"Device Types",accessor:"deviceTypes",Cell:({value:o})=>Array.isArray(o)?o.map(c=>`0x${c.toString(16).padStart(4,"0")}`).join(", "):o},{Header:"Cluster Name",accessor:"clusterName"},{Header:"Cluster ID",accessor:"clusterId"},{Header:"Attribute Name",accessor:"attributeName"},{Header:"Attribute ID",accessor:"attributeId"},{Header:"Attribute Value",accessor:"attributeValue",Cell:({value:o})=>e.jsx(H,{title:o,componentsProps:{tooltip:{sx:{fontSize:"14px",fontWeight:"normal",color:"#ffffff",backgroundColor:"var(--primary-color)"}}},children:e.jsx("div",{style:{maxWidth:"500px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o})})}],In=o=>`${o.pluginName}::${o.uniqueId}`,Dn=o=>`${o.endpoint}::${o.clusterName}::${o.attributeName}`;function Nn({data:o,columnVisibility:c,setPlugin:i,setEndpoint:n,setDeviceName:a}){const[h,v]=r.useState(null),t=Ee.useMemo(()=>ir.filter(S=>c[S.accessor]),[c]),{getTableProps:s,getTableBodyProps:M,headerGroups:N,rows:C,prepareRow:T}=_e.useTable({columns:t,data:o,getRowId:In},_e.useSortBy),E=S=>{if(S.id===h){v(null),i(null),n(null),a(null),l&&console.log("Device unclicked:",S.id,"selectedDeviceIndex:",h);return}v(S.id),i(S.original.pluginName),n(S.original.endpoint),a(S.original.name),l&&console.log("Device clicked:",S.id,"selectedDeviceIndex:",h,"pluginName:",S.original.pluginName,"endpoint:",S.original.endpoint)};return e.jsxs("table",{...s(),style:{margin:"-1px",border:"1px solid var(--table-border-color)"},children:[e.jsx("thead",{children:N.map(S=>e.jsx("tr",{...S.getHeaderGroupProps(),children:S.headers.map(O=>e.jsxs("th",{...O.getHeaderProps(O.noSort?void 0:O.getSortByToggleProps()),children:[O.render("Header"),!O.noSort&&e.jsx("span",{style:{margin:"0px",marginLeft:"5px",padding:"0px"},children:O.isSorted?O.isSortedDesc?e.jsx(ee,{path:Tt,size:"15px"}):e.jsx(ee,{path:Wt,size:"15px"}):null})]}))}))}),e.jsx("tbody",{...M(),children:C.map((S,O)=>(T(S),e.jsx("tr",{className:O%2===0?"table-content-even":"table-content-odd",...S.getRowProps(),onClick:()=>E(S),style:{backgroundColor:h===S.id?"var(--table-selected-bg-color)":"",cursor:"pointer"},children:S.cells.map(u=>e.jsx("td",{...u.getCellProps(),children:u.render("Cell")}))})))})]})}function Pn({data:o,columnVisibility:c}){const i=Ee.useMemo(()=>ar.filter(s=>c[s.accessor]),[c]),{getTableProps:n,getTableBodyProps:a,headerGroups:h,rows:v,prepareRow:t}=_e.useTable({columns:i,data:o,getRowId:Dn},_e.useSortBy);return e.jsxs("table",{...n(),style:{margin:"-1px"},children:[e.jsx("thead",{children:h.map(s=>e.jsx("tr",{...s.getHeaderGroupProps(),children:s.headers.map(M=>e.jsx("th",{...M.getHeaderProps(),children:M.render("Header")}))}))}),e.jsx("tbody",{...a(),children:v.map((s,M)=>(t(s),e.jsx("tr",{className:M%2===0?"table-content-even":"table-content-odd",...s.getRowProps(),children:s.cells.map(N=>e.jsx("td",{...N.getCellProps(),children:N.render("Cell")}))})))})]})}function Tn(){const{online:o,sendMessage:c,addListener:i,removeListener:n,getUniqueId:a}=r.useContext(xe),[h,v]=r.useState([]),[t,s]=r.useState([]),[M,N]=r.useState(null),[C,T]=r.useState(null),[E,S]=r.useState(null),[O,u]=r.useState(0),[q,b]=r.useState(!1),[y,F]=r.useState({pluginName:!0,type:!0,endpoint:!0,name:!0,serial:!0,uniqueId:!1,configUrl:!1,configButton:!0,cluster:!0}),[$,_]=r.useState(!1),[J,f]=r.useState({endpoint:!0,id:!0,deviceTypes:!0,clusterName:!0,clusterId:!0,attributeName:!0,attributeId:!0,attributeValue:!0}),[p,x]=r.useState(""),[j,R]=r.useState(h),[de,fe]=r.useState("icon"),w=r.useRef(a());r.useEffect(()=>{const U=k=>{if(l&&console.log("Devices received WebSocket Message:",k),k.src==="Matterbridge"&&k.dst==="Frontend"&&(k.method==="refresh_required"&&k.params.changed==="devices"&&(l&&console.log(`Devices received refresh_required: changed=${k.params.changed} and sending /api/devices request`),c({id:w.current,sender:"Devices",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}})),k.method==="/api/devices"&&(l&&console.log(`Devices received ${k.response.length} devices:`,k.response),v(k.response)),k.method==="/api/clusters")){console.log(`Devices received ${k.response.length} clusters:`,k.response),s(k.response.clusters);const D={};for(const I of k.response.clusters)l&&console.log("Cluster:",I.endpoint),D[I.endpoint]?D[I.endpoint]++:D[I.endpoint]=1;u(Object.keys(D).length)}};return i(U),l&&console.log("Devices added WebSocket listener"),()=>{n(U),l&&console.log("Devices removed WebSocket listener")}},[i,n,c]),r.useEffect(()=>{o&&(l&&console.log("Devices sending api requests"),c({id:w.current,sender:"Devices",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:w.current,sender:"Devices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:w.current,sender:"Devices",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}}))},[o,c]),r.useEffect(()=>{M&&C&&(l&&console.log("Devices sending /api/clusters"),c({id:w.current,sender:"Devices",method:"/api/clusters",src:"Frontend",dst:"Matterbridge",params:{plugin:M,endpoint:C}}))},[M,C,c]);const m=()=>{b(!q)},V=U=>{F(k=>{const D={...k,[U]:!k[U]};return localStorage.setItem("devicesColumnVisibility",JSON.stringify(D)),D})};r.useEffect(()=>{const U=localStorage.getItem("devicesColumnVisibility");U&&F(JSON.parse(U))},[]);const P=()=>{_(!$)},Z=U=>{f(k=>{const D={...k,[U]:!k[U]};return localStorage.setItem("clustersColumnVisibility",JSON.stringify(D)),D})};r.useEffect(()=>{const U=localStorage.getItem("clustersColumnVisibility");U&&f(JSON.parse(U))},[]);const he=U=>{x(U.target.value.toLowerCase()),localStorage.setItem("devicesFilter",U.target.value.toLowerCase())},we=U=>{fe(U),localStorage.setItem("devicesViewMode",U)};return r.useEffect(()=>{if(p===""){R(h);return}const U=h.filter(k=>k.name.toLowerCase().includes(p)||k.serial.toLowerCase().includes(p));R(U)},[h,p]),r.useEffect(()=>{const U=localStorage.getItem("devicesFilter");U&&x(U)},[]),r.useEffect(()=>{const U=localStorage.getItem("devicesViewMode");U&&fe(U)},[]),l&&console.log("Devices rendering..."),o?e.jsxs("div",{className:"MbfPageDiv",children:[e.jsxs("div",{className:"MbfWindowBodyRow",style:{justifyContent:"space-between",padding:0,gap:"20px",width:"100%",height:"45px",minHeight:"45px",maxHeight:"45px"},children:[e.jsxs(X,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx(le,{sx:{fontSize:"16px",fontWeight:"normal",color:"var(--div-text-color)",marginLeft:"5px",whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(pe,{variant:"outlined",value:p,onChange:he,placeholder:"Enter the device name or serial number",sx:{width:"320px"},InputProps:{style:{backgroundColor:"var(--main-bg-color)"}}})]}),e.jsxs(X,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx(le,{sx:{fontSize:"16px",fontWeight:"normal",color:"var(--div-text-color)",marginLeft:"5px",whiteSpace:"nowrap"},children:"View mode:"}),e.jsx(z,{onClick:()=>we("table"),"aria-label":"Table View",disabled:de==="table",children:e.jsx(H,{title:"Table View",children:e.jsx(io,{style:{color:de==="table"?"var(--main-icon-color)":"var(--primary-color)"}})})}),e.jsx(z,{onClick:()=>we("icon"),"aria-label":"Icon View",disabled:de==="icon",children:e.jsx(H,{title:"Icon View (beta)",children:e.jsx(ao,{style:{color:de==="icon"?"var(--main-icon-color)":"var(--primary-color)"}})})})]})]}),e.jsxs(Ie,{open:q,onClose:m,children:[e.jsx(De,{children:"Configure Devices Columns"}),e.jsx(Ne,{children:e.jsx(at,{children:ir.map(U=>e.jsx(Te,{control:e.jsx(We,{disabled:["pluginName","name","configButton"].includes(U.accessor),checked:y[U.accessor],onChange:()=>V(U.accessor)}),label:U.Header},U.accessor))})}),e.jsx(Pe,{children:e.jsx(re,{onClick:m,children:"Close"})})]}),de==="table"&&e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",maxHeight:`${M&&C?"50%":"100%"}`,width:"100%",flex:"1 1 auto",overflow:"hidden"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Registered devices"}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(z,{onClick:m,"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(H,{title:"Configure columns",children:e.jsx(Be,{style:{color:"var(--header-text-color)",fontSize:"19px"}})})})})]}),e.jsx("div",{className:"MbfWindowBodyColumn",style:{margin:"0",padding:"0",gap:"0"},children:e.jsx(Nn,{data:j,columnVisibility:y,setPlugin:N,setEndpoint:T,setDeviceName:S})}),e.jsx("div",{className:"MbfWindowFooter",style:{borderTop:"1px solid var(--table-border-color)",justifyContent:"flex-start"},children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontWeight:"normal",textAlign:"left"},children:["Total devices: ",j.length.toString()]})})]}),e.jsxs(Ie,{open:$,onClose:P,children:[e.jsx(De,{children:"Configure Clusters Columns"}),e.jsx(Ne,{children:e.jsx(at,{children:ar.map(U=>e.jsx(Te,{control:e.jsx(We,{disabled:["clusterName","attributeName","attributeValue"].includes(U.accessor),checked:J[U.accessor],onChange:()=>Z(U.accessor)}),label:U.Header},U.accessor))})}),e.jsx(Pe,{children:e.jsx(re,{onClick:P,children:"Close"})})]}),de==="table"&&M&&C&&e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",height:"50%",maxHeight:"50%",width:"100%",flex:"1 1 auto",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsxs("div",{className:"MbfWindowHeaderText",style:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[e.jsxs("p",{style:{margin:"0px",padding:"0px"},children:['Clusters for device "',E,'" on endpoint ',C]}),e.jsx(z,{onClick:P,"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(H,{title:"Configure columns",children:e.jsx(Be,{style:{color:"var(--header-text-color)",fontSize:"19px"}})})})]})}),e.jsx("div",{className:"MbfWindowBodyColumn",style:{margin:"0",padding:"0",gap:"0"},children:e.jsx(Pn,{data:t,columnVisibility:J})}),e.jsx("div",{className:"MbfWindowFooter",style:{borderTop:"1px solid var(--table-border-color)",justifyContent:"flex-start"},children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontWeight:"normal",textAlign:"left"},children:["Total child endpoints: ",O-1]})})]}),de==="icon"&&e.jsx(kn,{filter:p,devices:j})]}):e.jsx(Je,{})}function Wn(){const[o,c]=r.useState(localStorage.getItem("logFilterLevel")??"info"),[i,n]=r.useState(localStorage.getItem("logFilterSearch")??"*"),[a,h]=r.useState(localStorage.getItem("logAutoScroll")!=="false"),{setMessages:v,setLogFilters:t,online:s,setAutoScroll:M}=r.useContext(xe),N=S=>{c(S.target.value),t(S.target.value,i),localStorage.setItem("logFilterLevel",S.target.value),l&&console.log("handleChangeLevel called with value:",S.target.value)},C=S=>{n(S.target.value),t(o,S.target.value),localStorage.setItem("logFilterSearch",S.target.value),l&&console.log("handleChangeSearch called with value:",S.target.value)},T=S=>{h(S.target.checked),M(S.target.checked),localStorage.setItem("logAutoScroll",S.target.value?"true":"false"),l&&console.log("handleAutoScrollChange called with value:",S.target.checked)},E=()=>{l&&console.log("handleClearLogsClick called"),v([])};return l&&console.log("Logs rendering..."),s?e.jsxs("div",{className:"MbfPageDiv",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",margin:"0px",padding:"0px",gap:"10px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Vt,{id:"select-level",style:{color:"var(--div-text-color)"},children:"Filter log by level:"}),e.jsxs(rt,{style:{height:"30px",backgroundColor:"var(--main-bg-color)"},labelId:"select-level",id:"debug-level",value:o,onChange:N,children:[e.jsx(W,{value:"debug",children:"Debug"}),e.jsx(W,{value:"info",children:"Info"}),e.jsx(W,{value:"notice",children:"Notice"}),e.jsx(W,{value:"warn",children:"Warn"}),e.jsx(W,{value:"error",children:"Error"}),e.jsx(W,{value:"fatal",children:"Fatal"})]}),e.jsx(Vt,{id:"search",style:{color:"var(--div-text-color)"},children:"Filter log by text:"}),e.jsx(pe,{style:{width:"300px"},size:"small",id:"logsearch",variant:"outlined",value:i,onChange:C,InputProps:{style:{height:"30px",padding:"0 0px",backgroundColor:"var(--main-bg-color)"}}}),e.jsx(Te,{control:e.jsx(We,{checked:a,onChange:T}),label:"Auto scroll",style:{color:"var(--div-text-color)"}})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:e.jsx(H,{title:"Clear the logs",children:e.jsx(re,{onClick:E,endIcon:e.jsx(Ct,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Clear"})})})]}),e.jsx("div",{style:{flex:"1",overflow:"auto",margin:"0px",padding:"0px"},children:e.jsx(nr,{})})]}):e.jsx(Je,{})}const Fn=({open:o,ip:c,onClose:i,onSave:n})=>{const a=c?c.split(".").slice(0,3).join(".")+".1":"",[h,v]=r.useState("dhcp"),[t,s]=r.useState({ip:c??"",subnet:"255.255.255.0",gateway:a,dns:a}),M=T=>E=>{s({...t,[T]:E.target.value})},N=()=>{i()},C=()=>{const T=h==="static"?{type:h,...t}:{type:h};n(T),i()};return e.jsxs(Ie,{open:o,onClose:(T,E)=>{E==="backdropClick"||E==="escapeKeyDown"||i()},maxWidth:"sm",style:{maxWidth:"550px",margin:"auto"},children:[e.jsx(De,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:"Network Configuration"})]})}),e.jsxs(Ne,{dividers:!0,children:[e.jsxs(tr,{component:"fieldset",fullWidth:!0,children:[e.jsx(ke,{component:"legend",children:"Select IP Configuration"}),e.jsxs(rr,{row:!0,value:h,onChange:T=>v(T.target.value),children:[e.jsx(Te,{value:"dhcp",control:e.jsx(St,{}),label:"DHCP"}),e.jsx(Te,{value:"static",control:e.jsx(St,{}),label:"Static"})]})]}),h==="static"&&e.jsxs(Ae,{container:!0,spacing:2,sx:{mt:2},children:[e.jsx(Ae,{size:6,children:e.jsx(pe,{label:"IP Address",fullWidth:!0,value:t.ip,onChange:M("ip")})}),e.jsx(Ae,{size:6,children:e.jsx(pe,{label:"Subnet Mask",fullWidth:!0,value:t.subnet,onChange:M("subnet")})}),e.jsx(Ae,{size:6,children:e.jsx(pe,{label:"Gateway",fullWidth:!0,value:t.gateway,onChange:M("gateway")})}),e.jsx(Ae,{size:6,children:e.jsx(pe,{label:"DNS Server",fullWidth:!0,value:t.dns,onChange:M("dns")})})]})]}),e.jsxs(Pe,{children:[e.jsx(re,{onClick:N,children:"Cancel"}),e.jsx(re,{variant:"contained",onClick:C,children:"Save"})]})]})},Ln=({open:o,onClose:c,onSave:i})=>{const[n,a]=r.useState(""),[h,v]=r.useState(""),t=E=>{a(E.target.value)},s=E=>{v(E.target.value)},M=n.length>0&&n===h,N=()=>{c()},C=()=>{M&&(i(n),c())},T=()=>{i(""),c()};return e.jsxs(Ie,{open:o,onClose:(E,S)=>{S==="backdropClick"||S==="escapeKeyDown"||c()},maxWidth:"sm",style:{maxWidth:"500px",margin:"auto"},disableEscapeKeyDown:!0,children:[e.jsx(De,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:"Change Password"})]})}),e.jsx(Ne,{dividers:!0,children:e.jsx(tr,{component:"fieldset",fullWidth:!0,sx:{margin:0,padding:0,gap:"20px"},children:e.jsxs(Ae,{container:!0,spacing:2,sx:{mt:2},children:[e.jsx(Ae,{size:12,children:e.jsx(pe,{type:"password",autoComplete:"new-password",label:"New Password",size:"small",variant:"outlined",fullWidth:!0,value:n,onChange:t})}),e.jsx(Ae,{size:12,children:e.jsx(pe,{type:"password",autoComplete:"new-password",label:"Confirm Password",size:"small",variant:"outlined",fullWidth:!0,value:h,onChange:s,error:h!==""&&n!==h,helperText:h!==""&&n!==h?"Passwords do not match":""})})]})})}),e.jsxs(Pe,{children:[e.jsx(re,{onClick:N,children:"Cancel"}),e.jsx(re,{variant:"contained",onClick:C,disabled:!M,children:"Change"}),e.jsx(re,{variant:"contained",onClick:T,children:"Reset"})]})]})};function Rn(){const{online:o,addListener:c,removeListener:i,sendMessage:n,getUniqueId:a}=r.useContext(xe),[h,v]=r.useState(null),[t,s]=r.useState(null),M=r.useRef(a());return r.useEffect(()=>{const N=C=>{C.src==="Matterbridge"&&C.dst==="Frontend"&&(C.method==="refresh_required"&&C.params.changed==="settings"&&(l&&console.log(`Settings received refresh_required: changed=${C.params.changed} and sending /api/settings request`),n({id:M.current,sender:"Settings",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),C.method==="/api/settings"&&(l&&console.log("Settings received /api/settings:",C.response),v(C.response.matterbridgeInformation),s(C.response.systemInformation)))};return c(N),l&&console.log("Settings added WebSocket listener"),()=>{i(N),l&&console.log("Settings removed WebSocket listener")}},[c,i,n]),r.useEffect(()=>{o&&(l&&console.log("Settings received online"),n({id:M.current,sender:"Settings",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}))},[o,n]),h?(l&&console.log("Settings rendering..."),o?e.jsx("div",{className:"MbfPageDiv",children:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"20px",width:"100%"},children:[e.jsx(Hn,{matterbridgeInfo:h,systemInfo:t}),e.jsx(On,{matterbridgeInfo:h}),e.jsx($n,{matterbridgeInfo:h})]})}):e.jsx(Je,{})):null}function Hn({matterbridgeInfo:o,systemInfo:c}){const{sendMessage:i,getUniqueId:n}=r.useContext(xe),[a,h]=r.useState("bridge"),[v,t]=r.useState("Info"),[s,M]=r.useState(!1),[N,C]=r.useState("dark"),[T,E]=r.useState(localStorage.getItem("homePagePlugins")!=="false"),[S,O]=r.useState(localStorage.getItem("homePageMode")??"logs"),[u,q]=r.useState(localStorage.getItem("virtualMode")??"outlet"),b=r.useRef(n()),[y,F]=r.useState(!1),$=()=>F(!1),_=P=>{l&&console.log("handleSaveNetConfig called with config:",P),i({id:b.current,sender:"Settings",method:"/api/shellynetconfig",src:"Frontend",dst:"Matterbridge",params:P})},[J,f]=r.useState(!1),p=()=>f(!1),x=P=>{l&&console.log("handleSaveChangePassword called with password:",P),i({id:b.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setpassword",value:P}})};r.useEffect(()=>{o.bridgeMode!==void 0&&(h(o.bridgeMode==="bridge"?"bridge":"childbridge"),t(o.loggerLevel.charAt(0).toUpperCase()+o.loggerLevel.slice(1)),M(o.fileLogger),q(o.virtualMode))},[o]),r.useEffect(()=>{const P=localStorage.getItem("frontendTheme");P&&C(P)},[]);const j=P=>{l&&console.log("handleChangeBridgeMode called with value:",P.target.value),h(P.target.value),i({id:b.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setbridgemode",value:P.target.value}})},R=P=>{l&&console.log("handleChangeMbLoggerLevel called with value:",P.target.value),t(P.target.value),i({id:b.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmbloglevel",value:P.target.value}})},de=P=>{l&&console.log("handleLogOnFileMbChange called with value:",P.target.checked),M(P.target.checked),i({id:b.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmblogfile",value:P.target.checked}})},fe=P=>{const Z=P.target.value;l&&console.log("handleChangeTheme called with value:",Z),C(Z),localStorage.setItem("frontendTheme",Z),document.body.setAttribute("frontend-theme",Z)},w=P=>{const Z=P.target.checked;l&&console.log("handleChangeHomePagePlugins called with value:",Z),E(Z),localStorage.setItem("homePagePlugins",Z?"true":"false")},m=P=>{const Z=P.target.value;l&&console.log("handleChangeHomePageMode called with value:",Z),O(Z),localStorage.setItem("homePageMode",Z)},V=P=>{const Z=P.target.value;l&&console.log("handleChangeVirtualMode called with value:",Z),q(Z),localStorage.setItem("virtualMode",Z),i({id:b.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setvirtualmode",value:Z}})};return e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge settings"})}),e.jsx(Fn,{open:y,ip:c.ipv4Address,onClose:$,onSave:_}),e.jsx(Ln,{open:J,onClose:p,onSave:x}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(X,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},id:"matterbridgeInfo-mode",children:"Matterbridge mode:"}),e.jsxs(rr,{row:!0,name:"mode-buttons-group",value:a,onChange:j,children:[e.jsx(Te,{value:"bridge",control:e.jsx(St,{}),label:"Bridge",disabled:o.readOnly===!0}),e.jsx(Te,{value:"childbridge",control:e.jsx(St,{}),label:"Childbridge",disabled:o.readOnly===!0})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},id:"mblogger-level-label",children:"Logger level:"}),e.jsxs(rt,{style:{height:"30px"},labelId:"mblogger-level-label",id:"mblogger-level",value:v,onChange:R,children:[e.jsx(W,{value:"Debug",children:"Debug"}),e.jsx(W,{value:"Info",children:"Info"}),e.jsx(W,{value:"Notice",children:"Notice"}),e.jsx(W,{value:"Warn",children:"Warn"}),e.jsx(W,{value:"Error",children:"Error"}),e.jsx(W,{value:"Fatal",children:"Fatal"})]}),e.jsx(Te,{style:{padding:"0px",margin:"0px"},control:e.jsx(We,{checked:s,onChange:de,name:"logOnFileMb"}),label:"Log on file:",labelPlacement:"start"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},id:"frontend-theme-label",children:"Frontend theme:"}),e.jsxs(rt,{style:{height:"30px"},labelId:"frontend-theme-label",id:"frontend-theme",value:N,onChange:fe,children:[e.jsx(W,{value:"classic",children:"Classic"}),e.jsx(W,{value:"light",children:"Light"}),e.jsx(W,{value:"dark",children:"Dark"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},id:"frontend-home-plugin-label",children:"Home page plugins:"}),e.jsx(We,{checked:T,onChange:w,name:"showPlugins"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},id:"frontend-home-label",children:"Home page bottom panel:"}),e.jsxs(rt,{style:{height:"30px"},labelId:"frontend-home-label",id:"frontend-home",value:S,onChange:m,children:[e.jsx(W,{value:"logs",children:"Logs"}),e.jsx(W,{value:"devices",children:"Devices"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"10px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},id:"frontend-virtual-label",children:"Virtual devices:"}),e.jsxs(rt,{style:{height:"30px"},labelId:"frontend-virtual-label",id:"frontend-virtual",value:u,onChange:V,children:[e.jsx(W,{value:"disabled",children:"Disabled"}),e.jsx(W,{value:"outlet",children:"Outlet"}),e.jsx(W,{value:"light",children:"Light"}),e.jsx(W,{value:"switch",children:"Switch"}),e.jsx(W,{value:"mounted_switch",children:"Mounted Switch"})]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"20px"},children:e.jsx(re,{variant:"contained",color:"primary",onClick:()=>f(!0),children:"Change password"})}),o.shellyBoard&&e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"20px"},children:e.jsx(re,{variant:"contained",color:"primary",onClick:()=>F(!0),children:"Configure IP"})})]})})]})}function On({matterbridgeInfo:o}){const{sendMessage:c,getUniqueId:i}=r.useContext(xe),[n,a]=r.useState("Info"),[h,v]=r.useState(!1),[t,s]=r.useState(""),[M,N]=r.useState(""),[C,T]=r.useState(""),[E,S]=r.useState(),[O,u]=r.useState(),[q,b]=r.useState(),y=r.useRef(i());r.useEffect(()=>{o.bridgeMode!==void 0&&(a(["Debug","Info","Notice","Warn","Error","Fatal"][o.matterLoggerLevel]),v(o.matterFileLogger),s(o.matterMdnsInterface),N(o.matterIpv4Address),T(o.matterIpv6Address),S(o.matterPort),u(o.matterDiscriminator),b(o.matterPasscode))},[o]);const F=R=>{l&&console.log("handleChangeMjLoggerLevel called with value:",R.target.value),a(R.target.value),c({id:y.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmjloglevel",value:R.target.value}})},$=R=>{l&&console.log("handleLogOnFileMjChange called with value:",R.target.checked),v(R.target.checked),c({id:y.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmjlogfile",value:R.target.checked}})},_=R=>{l&&console.log("handleChangeMdnsInterface called with value:",R.target.value),s(R.target.value),c({id:y.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmdnsinterface",value:R.target.value}})},J=R=>{l&&console.log("handleChangeIpv4Address called with value:",R.target.value),N(R.target.value),c({id:y.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setipv4address",value:R.target.value}})},f=R=>{l&&console.log("handleChangeIpv6Address called with value:",R.target.value),T(R.target.value),c({id:y.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setipv6address",value:R.target.value}})},p=R=>{l&&console.log("handleChangeMatterPort called with value:",R.target.value),S(R.target.value),c({id:y.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterport",value:R.target.value}})},x=R=>{l&&console.log("handleChangeMatterDiscriminator called with value:",R.target.value),u(R.target.value),c({id:y.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterdiscriminator",value:R.target.value}})},j=R=>{l&&console.log("handleChangemMatterPasscode called with value:",R.target.value),b(R.target.value),c({id:y.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterpasscode",value:R.target.value}})};return e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matter settings"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(X,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},id:"mjdebug-info",children:"Logger level:"}),e.jsxs(rt,{style:{height:"30px"},labelId:"select-mjlevel",id:"mjdebug-level",value:n,onChange:F,children:[e.jsx(W,{value:"Debug",children:"Debug"}),e.jsx(W,{value:"Info",children:"Info"}),e.jsx(W,{value:"Notice",children:"Notice"}),e.jsx(W,{value:"Warn",children:"Warn"}),e.jsx(W,{value:"Error",children:"Error"}),e.jsx(W,{value:"Fatal",children:"Fatal"})]}),e.jsx(Te,{style:{padding:"0px",margin:"0px"},control:e.jsx(We,{checked:h,onChange:$,name:"logOnFileMj"}),label:"Log on file:",labelPlacement:"start"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},children:"Mdns interface:"}),e.jsx(pe,{value:t,onChange:_,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:o.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},children:"Ipv4 address:"}),e.jsx(pe,{value:M,onChange:J,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:o.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},children:"Ipv6 address:"}),e.jsx(pe,{value:C,onChange:f,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:o.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},children:"Commissioning port:"}),e.jsx(pe,{value:E,onChange:p,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:o.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},children:"Commissioning discriminator:"}),e.jsx(pe,{value:O,onChange:x,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:o.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},children:"Commissioning passcode:"}),e.jsx(pe,{value:q,onChange:j,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:o.readOnly===!0,style:{height:"30px",padding:"0"}}})]})]})})]})}function $n({matterbridgeInfo:o}){return e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge info"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(X,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:["          ",e.jsx(qe,{value:o.matterbridgeVersion,label:"Current Version"}),e.jsx(qe,{value:o.matterbridgeLatestVersion,label:"Latest Version"}),e.jsx(qe,{value:o.homeDirectory,label:"Home Directory"}),e.jsx(qe,{value:o.rootDirectory,label:"Root Directory"}),e.jsx(qe,{value:o.matterbridgeDirectory,label:"Matterbridge Storage Directory"}),e.jsx(qe,{value:o.matterbridgePluginDirectory,label:"Matterbridge Plugin Directory"}),e.jsx(qe,{value:o.globalModulesDirectory,label:"Global Module Directory"})]})})]})}function qe({value:o,label:c}){return e.jsx(pe,{focused:!0,value:o,size:"small",label:c,variant:"standard",sx:{width:"400px"},InputProps:{readOnly:!0,sx:{color:"var(--div-text-color)","&:before":{borderBottomColor:"var(--main-label-color)"},"&:after":{borderBottomColor:"var(--main-label-color)"}}},InputLabelProps:{sx:{marginTop:"3px",color:"var(--main-label-color)","&.Mui-focused":{color:"var(--main-label-color)"}}}})}function En(o,c,i){const n=o?.[i],a=c?.[i];return n==null&&a==null?0:n==null?-1:a==null?1:typeof n=="boolean"&&typeof a=="boolean"?n===a?0:n?1:-1:typeof n=="number"&&typeof a=="number"?n-a:String(n).localeCompare(String(a))}const Vn=r.memo(function({name:c,columns:i,rows:n,getRowKey:a,footerLeft:h,footerRight:v}){const t=r.useRef(new WeakMap),s=r.useRef(1),M=f=>{if(typeof a=="string"&&f&&f[a]!=null)return f[a];if(typeof a=="function"){const j=a(f);if(j!=null)return j}const p=i?.[0]?.id;if(p&&f&&f[p]!=null)return f[p];console.warn(`MbfTable(${c}): using fallback stable row key; consider providing getRowKey prop for better React performance`);let x=t.current.get(f);return x||(x=`rk_${s.current++}`,t.current.set(f,x)),x},[N,C]=r.useState(localStorage.getItem(`${c}_table_order_by`)||null),[T,E]=r.useState(localStorage.getItem(`${c}_table_order`)||null),[S,O]=r.useState(!1),[u,q]=r.useState(()=>{try{const f=localStorage.getItem(`${c}_column_visibility`);if(f)return JSON.parse(f)}catch{}return{}}),b=r.useMemo(()=>{const f={};for(const p of i)p.hidden||(f[p.id]=p.required?!0:u[p.id]!==!1);return f},[i,u]),y=r.useMemo(()=>{if(!N||!T)return n;const f=i.find(x=>x.id===N);if(!f||f.nosort)return n;const p=n.map((x,j)=>({el:x,index:j}));return p.sort((x,j)=>{const R=En(x.el,j.el,N);return R!==0?T==="asc"?R:-R:x.index-j.index}),p.map(x=>x.el)},[n,N,T,i]),F=f=>{if(N!==f||!N){C(f),E("asc"),localStorage.setItem(`${c}_table_order_by`,f),localStorage.setItem(`${c}_table_order`,"asc");return}if(T==="asc"){E("desc"),localStorage.setItem(`${c}_table_order`,"desc");return}C(null),E(null),localStorage.removeItem(`${c}_table_order_by`),localStorage.removeItem(`${c}_table_order`)},$=()=>{O(!S)},_=f=>{q(p=>{const x=i.find(de=>de.id===f);if(x&&x.required)return p;const j=b[f]!==!1,R={...p};j?R[f]=!1:delete R[f];try{localStorage.setItem(`${c}_column_visibility`,JSON.stringify(R))}catch{}return R})},J=()=>{const f={};q(f);try{localStorage.setItem(`${c}_column_visibility`,JSON.stringify(f))}catch{}};return console.log(`Rendering table ${c}${N&&T?` ordered by ${N}:${T}`:""}`),e.jsxs("div",{style:{display:"flex",flexDirection:"column",margin:"0",padding:"0",gap:"0",width:"100%",flex:"1 1 auto",height:"100%",minHeight:0,overflow:"hidden"},children:[e.jsxs(Ie,{open:S,onClose:(f,p)=>{p==="backdropClick"||p==="escapeKeyDown"||$()},disableEscapeKeyDown:!0,disableRestoreFocus:!0,children:[e.jsx(De,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:`Configure ${c} columns`})]})}),e.jsx(Ne,{children:e.jsx(at,{children:i.filter(f=>!f.hidden).map(f=>e.jsx(Te,{control:e.jsx(We,{disabled:!!f.required,checked:f.required?!0:b[f.id]!==!1,onChange:()=>_(f.id)}),label:f.label},f.id))})}),e.jsxs(Pe,{children:[e.jsx(re,{onClick:J,children:"Reset"}),e.jsx(re,{variant:"contained",onClick:f=>{if(f?.currentTarget&&typeof f.currentTarget.blur=="function")try{f.currentTarget.blur()}catch{}const p=document.activeElement;if(p&&p instanceof HTMLElement&&typeof p.blur=="function")try{p.blur()}catch{}$()},children:"Close"})]})]}),e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",minHeight:"30px",justifyContent:"space-between",borderBottom:"none"},children:[e.jsx("p",{className:"MbfWindowHeaderText",children:c}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(z,{onClick:f=>{if(f?.currentTarget?.blur)try{f.currentTarget.blur()}catch{}$()},"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(H,{title:`Configure ${c} columns`,children:e.jsx(ee,{path:Wo,size:"20px",style:{color:"var(--header-text-color)"}})})})})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",flex:"1 1 auto",minHeight:0,width:"100%",overflow:"auto",margin:"0px",padding:"0px",gap:"0"},children:e.jsxs("table",{"aria-label":`${c} table`,style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,border:"none",color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color"},children:e.jsx("tr",{style:{height:"30px",minHeight:"30px"},children:i.map(f=>{if(f.hidden||!f.required&&b[f.id]===!1)return null;const p=!f.nosort,x=p&&N===f.id&&!!T;return e.jsxs("th",{onClick:p?()=>F(f.id):void 0,style:{margin:"0",padding:"4px 8px",position:"sticky",top:0,minWidth:f.minWidth,maxWidth:f.maxWidth,textAlign:f.align||"left",cursor:p?"pointer":"default",border:"none",color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color)",whiteSpace:f.maxWidth?"nowrap":void 0,overflow:f.maxWidth?"hidden":void 0,textOverflow:f.maxWidth?"ellipsis":void 0},"aria-sort":p?x?T==="asc"?"ascending":"descending":"none":void 0,children:[f.label,x&&e.jsxs("span",{style:{marginLeft:6},children:[T==="asc"&&e.jsx(ee,{path:Wt,size:"15px"}),T==="desc"&&e.jsx(ee,{path:Tt,size:"15px"})]})]},f.id)})})}),e.jsx("tbody",{children:y.map((f,p)=>{const x=M(f);return e.jsx("tr",{className:p%2===0?"table-content-even":"table-content-odd",style:{height:"30px",minHeight:"30px",border:"none",borderCollapse:"collapse"},children:i.map(j=>{if(j.hidden||!j.required&&b[j.id]===!1)return null;const R=f[j.id];return e.jsx("td",{style:{border:"none",borderCollapse:"collapse",textAlign:j.align||"left",padding:"4px 8px",margin:"0",maxWidth:j.maxWidth,whiteSpace:j.maxWidth?"nowrap":void 0,overflow:j.maxWidth?"hidden":void 0,textOverflow:j.maxWidth?"ellipsis":void 0},children:typeof j.render=="function"?j.render(R,x,f,j):typeof R=="boolean"?e.jsx(We,{checked:R,disabled:!0,size:"small",sx:{m:0,p:0,color:"var(--table-text-color)","&.Mui-disabled":{color:"var(--table-text-color)",opacity:.7}}}):j.format&&typeof R=="number"?j.format(R):R!=null?String(R):null},j.id)})},x)})})]})}),e.jsxs("div",{className:"MbfWindowFooter",style:{height:"30px",minHeight:"30px",justifyContent:"space-between",border:"none"},children:[e.jsx("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)"},children:h}),e.jsx("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)"},children:v})]})]})});function An(){const{online:o,sendMessage:c,addListener:i,removeListener:n,getUniqueId:a}=r.useContext(xe),{showSnackbarMessage:h,closeSnackbarMessage:v}=r.useContext(ot),[t,s]=r.useState(null),[M,N]=r.useState([]),[C,T]=r.useState([]),[E,S]=r.useState([]),[O,u]=r.useState(null),[q,b]=r.useState(null),[y,F]=r.useState(null),$=r.useRef(null),[_,J]=r.useState(()=>sr);$.current||($.current=a(),console.log("Test uniqueId:",$)),r.useEffect(()=>{console.log("Test useEffect WebSocketMessage mounting");const p=x=>{if(x.src==="Matterbridge"&&x.dst==="Frontend"){if(x.method==="restart_required"&&(console.log("Test received restart_required"),h("Restart required",0)),x.method==="refresh_required"&&(console.log(`Test received refresh_required: changed=${x.params.changed} and sending api requests`),h("Refresh required",0),c({id:$.current,method:"/api/settings",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:$.current,method:"/api/plugins",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:$.current,method:"/api/devices",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}})),x.method==="memory_update"&&(console.log("Test received memory_update",x),b(x.params)),x.method==="cpu_update"&&(console.log("Test received cpu_update",x),u(x.params)),x.method==="uptime_update"&&(console.log("Test received uptime_update",x),F(x.params)),x.method==="/api/settings"&&x.response&&(console.log("Test received /api/settings:",x.response),h("Test received /api/settings"),s(x.response)),x.method==="/api/plugins"&&x.response&&(console.log(`Test received ${x.response.length} plugins:`,x.response),h("Test received /api/plugins"),N(x.response)),x.method==="/api/devices"&&x.response){console.log(`Test received ${x.response.length} devices:`,x.response),h("Test received /api/devices"),T(x.response);for(let j of x.response)console.log("Test sending /api/clusters for device:",j.pluginName,j.name,j.endpoint),c({method:"/api/clusters",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{plugin:j.pluginName,endpoint:j.endpoint}})}x.method==="/api/clusters"&&(console.log(`Test received ${x.response.length} clusters for device ${x.deviceName} endpoint ${x.endpoint}:`,x),h("Test received /api/clusters"),S(x.response))}else console.log("Test received WebSocketMessage:",x.method,x.src,x.dst,x.response)};return i(p),console.log("Test useEffect WebSocketMessage mounted"),()=>{console.log("Test useEffect WebSocketMessage unmounting"),n(p),console.log("Test useEffect WebSocketMessage unmounted")}},[i,n,c,h]),r.useEffect(()=>(console.log("Test useEffect online mounting"),o&&(console.log("Test useEffect online received online"),c({method:"/api/settings",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),c({method:"/api/plugins",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),c({method:"/api/devices",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}})),console.log("Test useEffect online mounted"),()=>{console.log("Test useEffect online unmounted")}),[o,c,h]);const f=r.useCallback(p=>p.code,[]);return console.log("Test rendering..."),o?e.jsx("div",{className:"MbfPageDiv",style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"20px",width:"100%"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"256px",width:"256px",margin:"10px"}}),e.jsx("p",{children:"Welcome to the Test page of the Matterbridge frontend"}),e.jsx("div",{style:{margin:"0",padding:"0",gap:"0",width:"1200px",maxWidth:"1200px",height:"600px",maxHeight:"600px",overflow:"hidden",border:"1px solid #0004ffff"},children:e.jsx(Vn,{name:"Test",columns:_n,rows:_,getRowKey:f,footerLeft:"Left Footer",footerRight:"Right Footer"})}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx(re,{variant:"contained",color:"primary",onClick:()=>{console.log("Test button clicked"),h("Test button clicked"),v("Refresh required"),v("Restart required"),v("Test permanent message removal")},children:"Test"}),e.jsx(re,{variant:"outlined",onClick:()=>{J(p=>{const x=p.findIndex(fe=>fe.code==="F123");if(x===-1)return p;const j=p[x],R={...j,population:(j.population||0)+1},de=p.slice();return de[x]=R,de})},children:"Update F123"})]})]})}):e.jsx(Je,{})}const _n=[{id:"name",label:"Name",minWidth:50,maxWidth:100,required:!0},{id:"code",label:"ISO Code",minWidth:100,render:(o,c)=>e.jsx("span",{style:{display:"inline-block",padding:"2px 6px",borderRadius:"8px",backgroundColor:"var(--chip-bg, #e6f4ff)",color:"var(--chip-fg, #0550ae)",fontFamily:'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',fontSize:"0.85em"},children:String(o)})},{id:"isIsland",label:"Island",minWidth:80,align:"center"},{id:"population",label:"Population",minWidth:170,align:"right",format:o=>o.toLocaleString("en-US")},{id:"size",label:"Size (km²)",minWidth:170,align:"right",format:o=>o.toLocaleString("en-US")},{id:"density",label:"Density",minWidth:170,align:"right",nosort:!0,format:o=>o.toFixed(2)},{id:"virtual",label:"Virtual",align:"right",required:!0,nosort:!0,render:(o,c,i)=>i.isIsland?"🏝️":"🏞️"}];function Ce(o,c,i,n,a){const h=i/n;return{name:o,code:c,population:i,size:n,density:h,isIsland:a}}const sr=[Ce("India","IN",1324171354,3287263,!1),Ce("China","CN",1403500365,9596961,!1),Ce("Italy","IT",60483973,301340,!1),Ce("United States","US",327167434,9833520,!1),Ce("Canada is a truly wonderful country","CA",37602103,9984670,!1),Ce("Australia","AU",25475400,7692024,!0),Ce("Germany","DE",83019200,357578,!1),Ce("Ireland","IE",4857e3,70273,!0),Ce("Mexico","MX",126577691,1972550,!1),Ce("Japan","JP",126317e3,377973,!0),Ce("France","FR",67022e3,640679,!1),Ce("United Kingdom","GB",67545757,242495,!0),Ce("Russia","RU",146793744,17098246,!1),Ce("Nigeria","NG",200962417,923768,!1),Ce("Brazil","BR",210147125,8515767,!1)],Gt=["Zor","Eld","Myth","Drak","Lum","Xen","Thal","Quor","Vex","Nyx"],Kt=["aria","dor","mere","land","wyn","gard","heim","quess","tor","vale"];for(let o=0;o<2e3;o++){const c=`${Gt[o%Gt.length]}${Kt[o%Kt.length]} ${o}`,i=`F${o.toString().padStart(3,"0")}`,n=Math.floor(Math.random()*1e9),a=Math.floor(Math.random()*1e7),h=Math.random()<.2;sr.push(Ce(c,i,n,a,h))}function Un(o,c){l&&console.log("getCssVariable:",o,"defaultValue",c);const i=getComputedStyle(document.body).getPropertyValue(o).trim();return i||console.error("getCssVariable: undefined",i),i||c}function zn(o){return so({palette:{primary:{main:o},action:{disabled:"var(--main-label-color)"},text:{disabled:"var(--main-label-color)"}},typography:{fontFamily:"Roboto, Helvetica, Arial, sans-serif"},components:{MuiDialog:{styleOverrides:{paper:{color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",border:"2px solid var(--div-border-color)",borderRadius:"var(--div-border-radius)",boxShadow:"2px 2px 5px var(--div-shadow-color)"}}},MuiTooltip:{defaultProps:{placement:"top-start",arrow:!0}},MuiButton:{styleOverrides:{root:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)","&:hover":{backgroundColor:"var(--main-button-bg-color)"},"&.Mui-disabled":{color:"var(--main-button-color)",backgroundColor:"var(--main-grey-color)"}},contained:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},outlined:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},text:{color:"var(--main-button-color)"}},defaultProps:{variant:"contained",size:"small"}},MuiIconButton:{styleOverrides:{root:{color:"var(--main-icon-color)","&:hover .MuiSvgIcon-root":{color:"var(--primary-color)"}}}},MuiCheckbox:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-checked":{color:"var(--primary-color)"}}}},MuiTextField:{defaultProps:{size:"small",variant:"outlined",fullWidth:!0}},MuiOutlinedInput:{styleOverrides:{root:{backgroundColor:"var(--div-bg-color)","& .MuiOutlinedInput-notchedOutline":{borderColor:"var(--main-label-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--main-text-color)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"var(--primary-color)"},padding:"0px"},input:{color:"var(--div-text-color)",padding:"4px 8px"}}},MuiInputLabel:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-focused":{color:"var(--primary-color)"}}}},MuiFormLabel:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-focused":{color:"var(--main-label-color)"}}}},MuiFormControl:{styleOverrides:{root:{color:"var(--main-grey-color)"}}},MuiRadio:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-checked":{color:"var(--primary-color)"}}}},MuiSelect:{styleOverrides:{root:{backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)",height:"30px","&:hover":{borderColor:"var(--main-text-color)"},"&.Mui-focused":{borderColor:"var(--primary-color)"}}}},MuiMenu:{styleOverrides:{paper:{backgroundColor:"var(--main-menu-bg-color)",padding:"0px",margin:"0px"},list:{padding:"0px"}}},MuiMenuItem:{styleOverrides:{root:{color:"var(--main-menu-color)",backgroundColor:"var(--main-menu-bg-color)","&:hover":{backgroundColor:"var(--main-menu-hover-color)"},"&.Mui-selected":{color:"var(--main-menu-color)",backgroundColor:"var(--main-menu-bg-color)"},"&.Mui-selected:hover":{backgroundColor:"var(--main-menu-hover-color)"}}}},MuiListItemButton:{styleOverrides:{root:{cursor:"pointer","&:hover":{backgroundColor:"var(--main-bg-color)"}}}},MuiListItemIcon:{styleOverrides:{root:{color:"var(--div-text-color)"}}},MuiListItemText:{styleOverrides:{primary:{fontSize:"16px",fontWeight:"bold",color:"var(--div-text-color)"},secondary:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"}}}}})}let l=!1;const qn=()=>{l=!l},lr=r.createContext(void 0);function Bn({children:o}){const[c,i]=r.useState(!1),[n,a]=r.useState(""),h=async v=>{try{const t=await fetch("./api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:v})});if(t.ok){const{valid:s}=await t.json();s?i(!0):v!==""&&a("Incorrect password!")}else console.error("Failed to log in:",t.statusText)}catch(t){console.error("Failed to log in:",t)}};return e.jsx(lr.Provider,{value:{loggedIn:c,logIn:h,errorMessage:n},children:o})}function Jn(){const[o,c]=r.useState(""),i=r.useContext(lr),[n,a]=r.useState("#1976d2");if(!i)throw new Error("AuthContext not found");const{loggedIn:h,logIn:v,errorMessage:t}=i,s=S=>{S.preventDefault(),v(o)},M={display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",backgroundColor:"var(--main-bg-color)"},N={display:"flex",flexDirection:"column",maxWidth:"400px",margin:"0 auto",padding:"20px",gap:"20px",border:"1px solid var(--div-border-color)",borderRadius:"var(--div-border-radius)",boxShadow:"2px 2px 5px var(--div-shadow-color)",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},C={margin:"10px 0",padding:"3px 3px",fontSize:"14px",width:"230px",border:"1px solid var(--main-label-color)",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"};r.useEffect(()=>{l&&console.log("Setting frontend theme");const S=localStorage.getItem("frontendTheme");l&&console.log("Saved theme:",S),S?document.body.setAttribute("frontend-theme",S):document.body.setAttribute("frontend-theme","dark");const O=Un("--primary-color","#1976d2");l&&console.log("Primary color from CSS:",O),a(O)},[]);const T=window.location.pathname.includes("/matterbridge/")?"/matterbridge":window.location.href.includes("/api/hassio_ingress/")?window.location.pathname:"/";console.log(`Loading App.js with href="${window.location.href}" and pathname="${window.location.pathname}" >>> baseName="${T}"`);const E=zn(n);return v(""),h?e.jsx(lo,{theme:E,children:e.jsx(vr,{dense:!0,maxSnack:10,preventDuplicate:!0,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(Uo,{children:e.jsx(zo,{children:e.jsx(gr,{basename:T,children:e.jsxs("div",{className:"MbfScreen",children:[e.jsx(qo,{}),e.jsxs(hr,{children:[e.jsx(Ye,{path:"/",element:e.jsx(mn,{})}),e.jsx(Ye,{path:"/devices",element:e.jsx(Tn,{})}),e.jsx(Ye,{path:"/log",element:e.jsx(Wn,{})}),e.jsx(Ye,{path:"/settings",element:e.jsx(Rn,{})}),e.jsx(Ye,{path:"/test",element:e.jsx(An,{})}),e.jsx(Ye,{path:"*",element:e.jsx(xr,{to:"/"})})]})]})})})})})}):e.jsx("div",{style:M,children:e.jsxs("form",{onSubmit:s,style:N,children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"64px",width:"64px"}}),e.jsx("h3",{style:{color:"var(--div-text-color)"},children:"Welcome to Matterbridge"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:"20px"},children:[e.jsx("input",{type:"text",name:"username",autoComplete:"username",style:{display:"none"},tabIndex:-1}),e.jsx("input",{type:"password",value:o,onChange:S=>c(S.target.value),style:C,placeholder:"password",autoComplete:"current-password"}),e.jsx("button",{type:"submit",style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",borderColor:"var(--div-bg-color)"},children:"Log in"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",margin:0,height:"30px"},children:t&&e.jsx("p",{style:{color:"red"},children:t})})]})})}function Qn(){return e.jsx(Bn,{children:e.jsx(Jn,{})})}fr.createRoot(document.getElementById("root")).render(e.jsx(Ee.StrictMode,{children:e.jsx(Qn,{})}));
