import{B as e,y as r,Q as Xe,S as nr,U as ir,V as Ve,X as sr,Y as ar,H as lr}from"./vendor_node_modules.js";import{u as dr,S as cr}from"./vendor_notistack.js";import{D as Ie,a as De,b as Ne,B as ae,c as Y,A as pr,I as Q,C as ur,T,S as gr,F as Vt,H as mr,d as Et,e as We,R as dt,P as Re,M as hr,f as ze,g as I,L as z,h as te,i as Ze,V as et,j as Se,k as ht,l as fr,m as xr,n as de,o as br,p as vr,q as ct,r as se,s as Te,K as St,t as Mt,u as ut,v as tt,w as Je,x as rt,W as Ge,y as ot,z as nt,E as Oe,G as kt,J as It,N as yr,O as jr,Q as Cr,U as Le,X as At,Y as vt,Z as wr,_ as Sr,$ as Mr,a0 as kr,a1 as _t,a2 as pt,a3 as Ir,a4 as Dr,a5 as Nr,a6 as Pr,a7 as Dt,a8 as Wr,a9 as Fr,aa as Lr,ab as Tr,ac as $r,ad as Rr,ae as Hr,af as Nt,ag as Or,ah as Vr,ai as Er,aj as Ar,ak as _r,al as qr,am as zr,an as Ur,ao as Br,ap as Qr,aq as Kr,ar as Jr,as as Gr,at as Yr,au as Xr,av as Pt,aw as Ue,ax as qt,ay as be,az as zt,aA as gt,aB as Fe,aC as Zr,aD as eo}from"./vendor_mui.js";import{Q as to}from"./vendor_qrcode.js";import{I as re,m as Wt,a as ro,b as oo,c as Ft,d as no,e as io,f as so,g as ao,h as lo,i as co,j as po,k as uo,l as go,n as mo,o as ho,p as fo,q as Lt,r as xo,s as bo,t as vo,u as yo,v as jo,w as Co,x as wo,y as So,z as Tt,A as Mo,B as ko}from"./vendor_mdi.js";import{F as Io,v as Do,e as No,a as Po,g as Wo,b as Fo,c as Lo,d as ft,A as To}from"./vendor_rjsf.js";import"./vendor_lodash.js";import"./vendor_emotion.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const y of l)if(y.type==="childList")for(const m of y.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&o(m)}).observe(document,{childList:!0,subtree:!0});function c(l){const y={};return l.integrity&&(y.integrity=l.integrity),l.referrerPolicy&&(y.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?y.credentials="include":l.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function o(l){if(l.ep)return;l.ep=!0;const y=c(l);fetch(l.href,y)}})();function $o({open:i,title:u,message:c,onConfirm:o,onCancel:l}){const y=t=>{n&&console.log("Confirmed"),t.preventDefault(),o()},m=t=>{n&&console.log("Canceled"),t.preventDefault(),l()};return e.jsxs(Ie,{open:i,children:[e.jsx(De,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:u})]})}),e.jsxs(Ne,{children:[e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",margin:"0",marginBottom:"20px",maxHeight:"350px",maxWidth:"350px"},children:e.jsx("p",{style:{flex:1,margin:"0"},children:c})}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-around"},children:[e.jsx(ae,{onClick:y,variant:"contained",color:"primary",size:"small",children:"Confirm"}),e.jsx(ae,{onClick:m,variant:"contained",color:"primary",size:"small",children:"Cancel"})]})]})]})}const it=[],Be=r.createContext(null);function Ro({children:i}){const{enqueueSnackbar:u,closeSnackbar:c}=dr(),o=r.useCallback(v=>{n&&console.log(`UiProvider closeSnackbarMessage: message ${v}`);const C=it.findIndex(L=>L.message===v);C!==-1&&(c(it[C].key),it.splice(C,1),n&&console.log(`UiProvider closeSnackbarMessage: message ${v} removed from persistMessages`))},[c]),l=r.useCallback((v,C,L)=>{n&&console.log(`UiProvider showSnackbarMessage: message ${v} timeout ${C}`);const w=u(v,{variant:"default",autoHideDuration:C==null||C>0?(C??5)*1e3:null,persist:C===0,content:G=>e.jsx(Y,{sx:{margin:"0",padding:"0",width:"300px",marginRight:"30px"},children:e.jsx(pr,{severity:L??"info",variant:"filled",sx:{color:"#fff",fontWeight:"normal",width:"100%",cursor:"pointer",padding:"0px 10px"},onClick:()=>c(G),action:e.jsx(Q,{size:"small",onClick:()=>c(G),sx:{color:"#fff"},children:e.jsx(ur,{fontSize:"small"})}),children:v},G)},G)});C===0&&(n&&console.log(`UiProvider showSnackbarMessage: message ${v} timeout ${C} - persist key ${w}`),it.push({message:v,key:w}))},[u,c]),[y,m]=r.useState(!1),[t,x]=r.useState(""),[N,p]=r.useState(""),[j,O]=r.useState(""),$=r.useRef(null),P=r.useRef(null),U=()=>{n&&console.log(`UiProvider handle confirm action ${j}`),m(!1),$.current&&$.current(j)},h=()=>{n&&console.log(`UiProvider handle cancel action ${j}`),m(!1),P.current&&P.current(j)},V=r.useCallback((v,C,L,w,G)=>{n&&console.log(`UiProvider showConfirmCancelDialog for command ${L}`),x(v),p(C),O(L),$.current=w,P.current=G,m(!0)},[]),b=r.useMemo(()=>({showSnackbarMessage:l,closeSnackbarMessage:o,closeSnackbar:c,showConfirmCancelDialog:V}),[l,o,c,V]);return e.jsxs(Be.Provider,{value:b,children:[e.jsx($o,{open:y,title:t,message:N,onConfirm:U,onCancel:h}),i]})}const Ut=r.createContext(null),me=r.createContext(null);function Ho({children:i}){const[u,c]=r.useState(localStorage.getItem("logFilterLevel")??"info"),[o,l]=r.useState(localStorage.getItem("logFilterSearch")??"*"),[y,m]=r.useState([]),[t,x]=r.useState(1e3),[N,p]=r.useState(!0),[j,O]=r.useState(!1),{showSnackbarMessage:$,closeSnackbarMessage:P,closeSnackbar:U}=r.useContext(Be),h=r.useRef([]),V=r.useRef(null),b=r.useRef(1),v=r.useRef(Math.floor(Math.random()*999e3)+1e3),C=r.useRef(null),L=r.useRef(null),w=r.useRef(null),G=r.useRef(u),A=r.useRef(o),a=r.useRef(0),s=r.useRef(null),d=r.useMemo(()=>window.location.href.replace(/^http/,"ws"),[]),g=r.useMemo(()=>window.location.href.includes("api/hassio_ingress"),[]),R=100,pe=60,Ce=50,we=300,ye=10;r.useEffect(()=>(n&&console.log("WebSocket messages started counter interval"),s.current=setInterval(()=>{a.current>0&&(n&&console.log(`WebSocket messages received in the last ${ye} seconds: ${a.current*(60/ye)} messages/minute`),a.current=0)},ye*1e3),()=>{n&&console.log("WebSocket messages stopped counter interval"),s.current&&clearInterval(s.current),s.current=null}),[]),r.useEffect(()=>{G.current=u},[u]),r.useEffect(()=>{A.current=o},[o]);const X=r.useCallback(()=>Math.floor(Math.random()*999e3)+1e3,[]),ie=r.useCallback(K=>{if(V.current&&V.current.readyState===WebSocket.OPEN)try{n&&console.log(`WebSocket sending message with id ${K.id}:`,K),K.id===void 0&&(K.id=v.current);const f=JSON.stringify(K);V.current.send(f),n&&console.log("WebSocket sent message:",K)}catch(f){n&&console.error(`WebSocket error sending message: ${f}`)}else n&&console.error("WebSocket message not sent, WebSocket not connected:",K)},[]),M=r.useCallback((K,f)=>{m(ne=>[...ne,{level:K,time:"",name:"",message:f}])},[]),E=r.useCallback((K,f)=>{c(K),l(f),M("WebSocket",`Filtering by log level "${K}" and log search "${f}"`)},[M]),W=r.useCallback((K,f)=>{n&&console.log(`WebSocket addListener id ${f}:`,K),(f==null||isNaN(f)||f===0)&&console.error("WebSocket addListener called without id, listener not added:",K),h.current=[...h.current,{listener:K,id:f}],n&&console.log("WebSocket addListener total listeners:",h.current.length)},[]),D=r.useCallback(K=>{n&&console.log("WebSocket removeListener:",K),h.current=h.current.filter(f=>f.listener!==K),n&&console.log("WebSocket removeListener total listeners:",h.current.length)},[]),S=r.useCallback(()=>{d===""||d===null||d===void 0||(M("WebSocket",`Connecting to WebSocket: ${d}`),V.current=new WebSocket(d),V.current.onmessage=K=>{j||O(!0),a.current+=1;try{const f=JSON.parse(K.data);if(f.id===void 0||f.src===void 0||f.dst===void 0){n&&console.error("WebSocket undefined message id/src/dst:",f);return}if(f.src!=="Matterbridge"||f.dst!=="Frontend"){n&&console.error("WebSocket invalid message src/dst:",f);return}if(f.error){n&&console.error("WebSocket error message response:",f);return}if(f.id===v.current&&f.method==="pong"&&f.response==="pong"){n&&console.log(`WebSocket pong response message id ${f.id}:`,f),L.current&&clearTimeout(L.current),L.current=null;return}else if(f.method==="snackbar"&&f.response&&f.response.message){n&&console.log(`WebSocket message id ${f.id} method ${f.method}:`,f),$(f.response.message,f.response.timeout,f.response.severity);return}else if(f.method==="close_snackbar"&&f.response&&f.response.message){n&&console.log(`WebSocket message id ${f.id} method ${f.method}:`,f),P(f.response.message);return}else if(f.method==="log"){if(!f.response||!f.response.level||!f.response.time||!f.response.name||!f.response.message||["debug","info","notice","warn","error","fatal"].includes(f.response.level)&&(G.current==="info"&&f.response.level==="debug"||G.current==="notice"&&(f.response.level==="debug"||f.response.level==="info")||G.current==="warn"&&(f.response.level==="debug"||f.response.level==="info"||f.response.level==="notice")||G.current==="error"&&(f.response.level==="debug"||f.response.level==="info"||f.response.level==="notice"||f.response.level==="warn")||G.current==="fatal"&&(f.response.level==="debug"||f.response.level==="info"||f.response.level==="notice"||f.response.level==="warn"||f.response.level==="error"))||A.current!=="*"&&A.current!==""&&!f.response.message.toLowerCase().includes(A.current.toLowerCase())&&!f.response.name.toLowerCase().includes(A.current.toLowerCase())||f.response.name==="Commissioning"&&f.response.message.includes("is uncommissioned"))return;m(H=>{const oe=[...H,{level:f.response.level,time:f.response.time,name:f.response.name,message:f.response.message}];return oe.length>t*2?oe.slice(t):oe})}else{if(n&&console.log(`WebSocket received message id ${f.id} method ${f.method}:`,f),f.id===0)h.current.forEach(ne=>ne.listener(f));else{const ne=h.current.find(H=>H.id===f.id);ne?ne.listener(f):n&&console.debug(`WebSocket no listener found for message id ${f.id}:`,f)}return}}catch(f){console.error(`WebSocketUse error parsing message: ${f}`)}},V.current.onopen=()=>{n&&console.log(`WebSocket: Connected to WebSocket: ${d}`),M("WebSocket",`Connected to WebSocket: ${d}`),O(!0),U(),b.current=1,w.current=setTimeout(()=>{C.current=setInterval(()=>{ie({id:v.current,method:"ping",src:"Frontend",dst:"Matterbridge",params:{}}),L.current&&clearTimeout(L.current),L.current=setTimeout(()=>{n&&console.error(`WebSocketUse: No pong response received from WebSocket: ${d}`),M("WebSocket",`No pong response received from WebSocket: ${d}`),O(!1)},1e3*Ce)},1e3*pe)},1e3*we)},V.current.onclose=()=>{n&&console.error(`WebSocket: Disconnected from WebSocket ${g?"with Ingress":""}: ${d}`),M("WebSocket",`Disconnected from WebSocket: ${d}`),O(!1),U(),w.current&&clearTimeout(w.current),L.current&&clearTimeout(L.current),C.current&&clearInterval(C.current),M("WebSocket",`Reconnecting (attempt ${b.current} of ${R}) to WebSocket${g?" (Ingress)":""}: ${d}`),g?setTimeout(F,5e3):b.current===1?F():b.current<R?setTimeout(F,1e3*b.current):M("WebSocket",`Reconnect attempts exceeded limit of ${R} retries, refresh the page to reconnect to: ${d}`),b.current=b.current+1},V.current.onerror=K=>{n&&console.error(`WebSocket: WebSocket error connecting to ${d}:`,K),M("WebSocket",`WebSocket error connecting to ${d}`)})},[d]),F=r.useCallback(()=>{n&&console.log(`WebSocket attemptReconnect ${b.current}/${R} to:`,d),S()},[S]);r.useEffect(()=>(S(),()=>{V.current&&V.current.readyState===WebSocket.OPEN&&V.current.close()}),[S]);const _=r.useMemo(()=>({messages:y,maxMessages:t,autoScroll:N,setMessages:m,setLogFilters:E,setMaxMessages:x,setAutoScroll:p}),[y,m,E]),Z=r.useMemo(()=>({maxMessages:t,autoScroll:N,logFilterLevel:u,logFilterSearch:o,setMessages:m,setLogFilters:E,setMaxMessages:x,setAutoScroll:p,online:j,retry:b.current,getUniqueId:X,addListener:W,removeListener:D,sendMessage:ie,logMessage:M}),[t,N,m,E,x,p,j,b.current,W,D,ie,M]);return e.jsx(Ut.Provider,{value:_,children:e.jsx(me.Provider,{value:Z,children:i})})}function Oo(){const{showSnackbarMessage:i,showConfirmCancelDialog:u}=r.useContext(Be),{online:c,sendMessage:o,logMessage:l,addListener:y,removeListener:m,getUniqueId:t}=r.useContext(me),[x,N]=r.useState(!1),[p,j]=r.useState(!1),[O,$]=r.useState(!1),[P,U]=r.useState(!1),[h,V]=r.useState(null),b=r.useRef(t()),[v,C]=r.useState(null),[L,w]=r.useState(null),[G,A]=r.useState(null),[a,s]=r.useState(null),[d,g]=r.useState(null),R=()=>{window.open("https://www.buymeacoffee.com/luligugithub","_blank")},pe=()=>{window.open("https://github.com/Luligu/matterbridge/blob/main/README.md","_blank")},Ce=()=>{h?.matterbridgeInformation.matterbridgeVersion.includes("-dev-")?window.open("https://github.com/Luligu/matterbridge/blob/dev/CHANGELOG.md","_blank"):window.open("https://github.com/Luligu/matterbridge/blob/main/CHANGELOG.md","_blank")},we=()=>{window.open("https://discord.gg/QX58CDe6hd","_blank")},ye=()=>{window.open("https://github.com/Luligu/matterbridge","_blank")},X=()=>{o({id:b.current,sender:"Header",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:"matterbridge",restart:!0}})},ie=()=>{o({id:b.current,sender:"Header",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:"matterbridge@dev",restart:!0}})},M=()=>{o({id:b.current,sender:"Header",method:"/api/checkupdates",src:"Frontend",dst:"Matterbridge",params:{}})},E=()=>{n&&console.log("Header: handleShellySystemUpdateClick"),l("Matterbridge","Installing system updates..."),o({id:b.current,sender:"Header",method:"/api/shellysysupdate",src:"Frontend",dst:"Matterbridge",params:{}})},W=()=>{n&&console.log("Header: handleShellyMainUpdateClick"),l("Matterbridge","Installing software updates..."),o({id:b.current,sender:"Header",method:"/api/shellymainupdate",src:"Frontend",dst:"Matterbridge",params:{}})},D=()=>{n&&console.log("Header: handleShellyCreateSystemLog"),o({id:b.current,sender:"Header",method:"/api/shellycreatesystemlog",src:"Frontend",dst:"Matterbridge",params:{}})},S=()=>{n&&console.log("Header: handleShellyDownloadSystemLog"),l("Matterbridge","Downloading Shelly system log..."),i("Downloading Shelly system log...",5),window.location.href="./api/shellydownloadsystemlog"},F=()=>{h?.matterbridgeInformation.restartMode===""?o({id:b.current,sender:"Header",method:"/api/restart",src:"Frontend",dst:"Matterbridge",params:{}}):o({id:b.current,sender:"Header",method:"/api/shutdown",src:"Frontend",dst:"Matterbridge",params:{}})},_=()=>{o({id:b.current,sender:"Header",method:"/api/shutdown",src:"Frontend",dst:"Matterbridge",params:{}})},Z=()=>{o({id:b.current,sender:"Header",method:"/api/reboot",src:"Frontend",dst:"Matterbridge",params:{}})},K=()=>{o({id:b.current,sender:"Header",method:"/api/softreset",src:"Frontend",dst:"Matterbridge",params:{}})},f=()=>{o({id:b.current,sender:"Header",method:"/api/hardreset",src:"Frontend",dst:"Matterbridge",params:{}})},ne=B=>{C(B.currentTarget)},H=B=>{n&&console.log("Header: handleMenuClose",B),C(null),B==="download-mblog"?(l("Matterbridge","Downloading matterbridge log..."),i("Downloading matterbridge log...",5),window.location.href="./api/download-mblog"):B==="download-mjlog"?(l("Matterbridge","Downloading matter log..."),i("Downloading matter log...",5),window.location.href="./api/download-mjlog"):B==="view-mblog"?(l("Matterbridge","Loading matterbridge log..."),i("Loading matterbridge log...",5),window.location.href="./api/view-mblog"):B==="view-mjlog"?(l("Matterbridge","Loading matter log..."),i("Loading matter log...",5),window.location.href="./api/view-mjlog"):B==="view-shellylog"?(l("Matterbridge","Loading shelly system log..."),i("Loading shelly system log...",5),window.location.href="./api/shellyviewsystemlog"):B==="download-mbstorage"?(l("Matterbridge","Downloading matterbridge storage..."),i("Downloading matterbridge storage...",5),window.location.href="./api/download-mbstorage"):B==="download-pluginstorage"?(l("Matterbridge","Downloading matterbridge plugins storage..."),i("Downloading matterbridge plugins storage...",5),window.location.href="./api/download-pluginstorage"):B==="download-pluginconfig"?(l("Matterbridge","Downloading matterbridge plugins config..."),i("Downloading matterbridge plugins config...",5),window.location.href="./api/download-pluginconfig"):B==="download-mjstorage"?(l("Matterbridge","Downloading matter storage..."),i("Downloading matter storage...",5),window.location.href="./api/download-mjstorage"):B==="download-backup"?(l("Matterbridge","Downloading backup..."),i("Downloading backup...",10),window.location.href="./api/download-backup"):B==="update"?X():B==="updatedev"?ie():B==="updatecheck"?M():B==="shelly-sys-update"?E():B==="shelly-main-update"?W():B==="shelly-create-system-log"?D():B==="shelly-download-system-log"?S():B==="softreset"?K():B==="hardreset"?f():B==="restart"?F():B==="shutdown"?_():B==="reboot"?Z():B==="create-backup"?o({id:b.current,sender:"Header",method:"/api/create-backup",src:"Frontend",dst:"Matterbridge",params:{}}):B==="unregister"?o({id:b.current,sender:"Header",method:"/api/unregister",src:"Frontend",dst:"Matterbridge",params:{}}):B==="reset"?o({id:b.current,sender:"Header",method:"/api/reset",src:"Frontend",dst:"Matterbridge",params:{}}):B==="factoryreset"&&o({id:b.current,sender:"Header",method:"/api/factoryreset",src:"Frontend",dst:"Matterbridge",params:{}})},oe=B=>{n&&console.log("Header: handleMenuCloseCancel:",B),C(null)},ue=B=>{w(B.currentTarget)},ee=()=>{w(null)},je=B=>{A(B.currentTarget)},xe=()=>{A(null)},ge=B=>{s(B.currentTarget)},J=()=>{s(null)},le=B=>{g(B.currentTarget)},fe=()=>{g(null)},Qe=()=>{Bn(),n&&console.log("Matterbridge logo clicked: debug is now",n)};return r.useEffect(()=>{const B=k=>{n&&console.log("Header received WebSocket Message:",k),k.method==="/api/settings"&&k.id===b.current?(n&&console.log("Header received settings:",k.response),V(k.response),N(k.response.matterbridgeInformation.restartRequired||k.response.matterbridgeInformation.fixedRestartRequired),j(k.response.matterbridgeInformation.fixedRestartRequired),$(k.response.matterbridgeInformation.updateRequired)):k.method==="refresh_required"&&k.response.changed==="settings"?(n&&console.log(`Header received refresh_required: changed=${k.response.changed} and sending /api/settings request`),o({id:b.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})):k.method==="restart_required"?(n&&console.log(`Header received restart_required with fixed: ${k.response.fixed}`),N(!0),k.response.fixed===!0&&j(!0)):k.method==="restart_not_required"?(n&&console.log("Header received restart_not_required"),N(!1)):k.method==="update_required"?(n&&console.log("Header received update_required"),k.response.devVersion===!0?U(!0):$(!0),o({id:b.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})):k.method==="shelly_sys_update"?(n&&console.log("Header received WS_ID_SHELLY_SYS_UPDATE:"),V(ce=>ce?{matterbridgeInformation:{...ce.matterbridgeInformation,shellySysUpdate:k.response.available},systemInformation:ce.systemInformation}:null)):k.method==="shelly_main_update"&&(n&&console.log("Header received WS_ID_SHELLY_MAIN_UPDATE:"),V(ce=>ce?{matterbridgeInformation:{...ce.matterbridgeInformation,shellyMainUpdate:k.response.available},systemInformation:ce.systemInformation}:null))};return y(B,b.current),n&&console.log(`Header added WebSocket listener id ${b.current}`),()=>{m(B),n&&console.log("Header removed WebSocket listener")}},[y,m,o,i]),r.useEffect(()=>{c&&(n&&console.log("Header sending /api/settings requests"),o({id:b.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}))},[c,o]),n&&console.log("Header rendering..."),!c||!h?null:e.jsxs("div",{className:"header",children:[e.jsxs("div",{className:"sub-header",children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"30px"},onClick:Qe}),e.jsx("h2",{style:{fontSize:"22px",color:"var(--main-icon-color)",margin:"0px"},children:"Matterbridge"}),e.jsxs("nav",{children:[e.jsx(Xe,{to:"/",className:"nav-link",children:"Home"}),e.jsx(Xe,{to:"/devices",className:"nav-link",children:"Devices"}),e.jsx(Xe,{to:"/log",className:"nav-link",children:"Logs"}),e.jsx(Xe,{to:"/settings",className:"nav-link",children:"Settings"})]})]}),e.jsxs("div",{className:"sub-header",children:[!h.matterbridgeInformation.readOnly&&O&&e.jsx(T,{title:"New Matterbridge version available, click to install",children:e.jsxs("span",{className:"status-warning",onClick:X,children:["Update to v.",h.matterbridgeInformation.matterbridgeLatestVersion]})}),!h.matterbridgeInformation.readOnly&&P&&e.jsx(T,{title:"New Matterbridge dev version available, click to install",children:e.jsxs("span",{className:"status-warning",onClick:ie,children:["Update to new dev v.",h.matterbridgeInformation.matterbridgeDevVersion.split("-dev-")[0]]})}),!h.matterbridgeInformation.readOnly&&e.jsx(T,{title:"Matterbridge version, click to see the changelog",children:e.jsxs("span",{className:"status-information",onClick:Ce,children:["v.",h.matterbridgeInformation.matterbridgeVersion]})}),h.matterbridgeInformation.shellyBoard&&e.jsx("img",{src:"Shelly.svg",alt:"Shelly Icon",style:{height:"30px",padding:"0px",margin:"0px",marginRight:"30px"}}),h.matterbridgeInformation.bridgeMode!==""&&h.matterbridgeInformation.readOnly===!1?e.jsx(T,{title:"Bridge mode",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:h.matterbridgeInformation.bridgeMode})}):null,h.matterbridgeInformation.restartMode!==""&&h.matterbridgeInformation.readOnly===!1?e.jsx(T,{title:"Restart mode",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:h.matterbridgeInformation.restartMode})}):null,h.matterbridgeInformation.profile&&h.matterbridgeInformation.profile!==""&&h.matterbridgeInformation.readOnly===!1?e.jsx(T,{title:"Current profile",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:h.matterbridgeInformation.profile})}):null]}),e.jsxs("div",{className:"sub-header",style:{gap:"5px"},children:[h.matterbridgeInformation.readOnly===!1?e.jsx(T,{title:"Matterbridge discord group",children:e.jsx("img",{src:"discord.svg",alt:"Discord Logo",style:{cursor:"pointer",height:"25px"},onClick:we})}):null,h.matterbridgeInformation.readOnly===!1?e.jsx(T,{title:"Give a star to Matterbridge",children:e.jsx(Q,{style:{color:"#FFD700",margin:"0",padding:"0"},onClick:ye,children:e.jsx(gr,{})})}):null,h.matterbridgeInformation.readOnly===!1?e.jsx(T,{title:"Sponsor Matterbridge",children:e.jsx(Q,{style:{color:"#b6409c",margin:"0",padding:"0"},onClick:R,children:e.jsx(Vt,{})})}):null,e.jsx(T,{title:"Matterbridge help",children:e.jsx(Q,{style:{color:"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:pe,children:e.jsx(mr,{})})}),e.jsx(T,{title:"Matterbridge changelog",children:e.jsx(Q,{style:{color:"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:Ce,children:e.jsx(Et,{})})}),h.matterbridgeInformation&&!h.matterbridgeInformation.readOnly&&e.jsx(T,{title:"Update matterbridge to latest version",children:e.jsx(Q,{style:{color:O?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:X,children:e.jsx(We,{})})}),h.matterbridgeInformation&&h.matterbridgeInformation.shellyBoard&&h.matterbridgeInformation.shellySysUpdate&&e.jsx(T,{title:"Shelly system update",children:e.jsx(Q,{style:{color:"var(--primary-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:E,children:e.jsx(We,{})})}),h.matterbridgeInformation&&h.matterbridgeInformation.shellyBoard&&h.matterbridgeInformation.shellyMainUpdate&&e.jsx(T,{title:"Shelly software update",children:e.jsx(Q,{style:{color:"var(--primary-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:W,children:e.jsx(We,{})})}),e.jsx(T,{title:"Restart matterbridge",children:e.jsx(Q,{style:{color:x||p?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:F,children:e.jsx(dt,{})})}),h.matterbridgeInformation.restartMode===""?e.jsx(T,{title:"Shut down matterbridge",children:e.jsx(Q,{style:{color:x||p?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:_,children:e.jsx(Re,{})})}):null,e.jsx(T,{title:"Download, backup and more",children:e.jsx(Q,{onClick:ne,children:e.jsx(hr,{style:{color:"var(--main-icon-color)"}})})}),e.jsxs(ze,{id:"command-menu",anchorEl:v,keepMounted:!0,open:!!v,onClose:()=>H(""),children:[h.matterbridgeInformation&&!h.matterbridgeInformation.readOnly&&e.jsxs(I,{onClick:()=>H("update"),children:[e.jsx(z,{children:e.jsx(We,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Install latest stable",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),h.matterbridgeInformation&&!h.matterbridgeInformation.readOnly&&e.jsxs(I,{onClick:()=>H("updatedev"),children:[e.jsx(z,{children:e.jsx(We,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Install latest dev",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),h.matterbridgeInformation&&!h.matterbridgeInformation.readOnly&&e.jsxs(I,{onClick:()=>H("updatecheck"),children:[e.jsx(z,{children:e.jsx(We,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Check for updates",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),h.matterbridgeInformation&&h.matterbridgeInformation.shellyBoard&&h.matterbridgeInformation.shellySysUpdate&&e.jsxs(I,{onClick:()=>H("shelly-sys-update"),children:[e.jsx(z,{children:e.jsx(We,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Shelly system update",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),h.matterbridgeInformation&&h.matterbridgeInformation.shellyBoard&&h.matterbridgeInformation.shellyMainUpdate&&e.jsxs(I,{onClick:()=>H("shelly-main-update"),children:[e.jsx(z,{children:e.jsx(We,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Shelly software update",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(I,{onClick:()=>H("restart"),children:[e.jsx(z,{children:e.jsx(dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Restart",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),h.matterbridgeInformation.restartMode===""?e.jsxs(I,{onClick:()=>H("shutdown"),children:[e.jsx(z,{children:e.jsx(Re,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Shutdown",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}):null,h.matterbridgeInformation&&h.matterbridgeInformation.shellyBoard&&e.jsxs(I,{onClick:()=>{u("Reboot","Are you sure you want to reboot the Shelly board?","reboot",H,oe)},children:[e.jsx(z,{children:e.jsx(dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Reboot...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsx(Ze,{}),e.jsxs(I,{onClick:je,children:[e.jsx(z,{children:e.jsx(et,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"View",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(ze,{id:"sub-menu-view",anchorEl:G,keepMounted:!0,open:!!G,onClose:xe,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(I,{onClick:()=>{H("view-mblog"),xe()},children:[e.jsx(z,{children:e.jsx(et,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Matterbridge log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(I,{onClick:()=>{H("view-mjlog"),xe()},children:[e.jsx(z,{children:e.jsx(et,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Matter log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),h.matterbridgeInformation&&h.matterbridgeInformation.shellyBoard&&e.jsxs(I,{onClick:()=>{H("view-shellylog"),xe()},children:[e.jsx(z,{children:e.jsx(et,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(Ze,{}),e.jsxs(I,{onClick:ge,children:[e.jsx(z,{children:e.jsx(Se,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Download",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(ze,{id:"sub-menu-download",anchorEl:a,keepMounted:!0,open:!!a,onClose:J,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(I,{onClick:()=>{H("download-mbstorage"),J()},children:[e.jsx(z,{children:e.jsx(Se,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Matterbridge storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(I,{onClick:()=>{H("download-pluginstorage"),J()},children:[e.jsx(z,{children:e.jsx(Se,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Matterbridge plugins storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(I,{onClick:()=>{H("download-pluginconfig"),J()},children:[e.jsx(z,{children:e.jsx(Se,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Matterbridge plugins config",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(I,{onClick:()=>{H("download-mblog"),J()},children:[e.jsx(z,{children:e.jsx(Se,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Matterbridge log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(I,{onClick:()=>{H("download-mjstorage"),J()},children:[e.jsx(z,{children:e.jsx(Se,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Matter storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(I,{onClick:()=>{H("download-mjlog"),J()},children:[e.jsx(z,{children:e.jsx(Se,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Matter log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),h.matterbridgeInformation&&h.matterbridgeInformation.shellyBoard&&e.jsxs(I,{onClick:()=>{H("shelly-create-system-log"),J()},children:[e.jsx(z,{children:e.jsx(Se,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Create Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),h.matterbridgeInformation&&h.matterbridgeInformation.shellyBoard&&e.jsxs(I,{onClick:()=>{H("shelly-download-system-log"),J()},children:[e.jsx(z,{children:e.jsx(Se,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Download Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(Ze,{}),e.jsxs(I,{onClick:ue,children:[e.jsx(z,{children:e.jsx(ht,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(ze,{id:"sub-menu-backup",anchorEl:L,keepMounted:!0,open:!!L,onClose:ee,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(I,{onClick:()=>{H("create-backup"),ee()},children:[e.jsx(z,{children:e.jsx(ht,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Create backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(I,{onClick:()=>{H("download-backup"),ee()},children:[e.jsx(z,{children:e.jsx(ht,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Download backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(Ze,{}),e.jsxs(I,{onClick:le,children:[e.jsx(z,{children:e.jsx(fr,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Reset",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(ze,{id:"sub-menu-reset",anchorEl:d,keepMounted:!0,open:!!d,onClose:fe,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(I,{onClick:()=>{fe(),u("Reset all devices and shutdown","Are you sure you want to unregister all devices? This will temporarily remove all devices from the controller and you may loose the controller configuration.","unregister",H,oe)},children:[e.jsx(z,{children:e.jsx(Re,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Reset all devices...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(I,{onClick:()=>{fe(),u("Reset commissioning and shutdown","Are you sure you want to reset the commissioning? You will have to manually remove Matterbridge from the controller.","reset",H,oe)},children:[e.jsx(z,{children:e.jsx(Re,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Reset commissioning...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),!h.matterbridgeInformation.readOnly&&e.jsxs(I,{onClick:()=>{fe(),u("Factory reset and shutdown","Are you sure you want to factory reset Matterbridge? You will have to manually remove Matterbridge from the controller.","factoryreset",H,oe)},children:[e.jsx(z,{children:e.jsx(Re,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Factory reset...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),h.matterbridgeInformation&&h.matterbridgeInformation.shellyBoard&&e.jsxs(I,{onClick:()=>{fe(),u("Network reset","Are you sure you want to factory reset the network parameters?","softreset",H,oe)},children:[e.jsx(z,{children:e.jsx(Re,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Reset network...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),h.matterbridgeInformation&&h.matterbridgeInformation.shellyBoard&&e.jsxs(I,{onClick:()=>{fe(),u("Factory reset","Are you sure you want to factory reset Matterbridge? You will have to manually remove Matterbridge from the controller.","hardreset",H,oe)},children:[e.jsx(z,{children:e.jsx(Re,{style:{color:"var(--main-icon-color)"}})}),e.jsx(te,{primary:"Factory reset...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]})]})]})]})}const Vo=r.memo(Oo),Eo=()=>"ontouchstart"in window||typeof window.DocumentTouch<"u"&&document instanceof window.DocumentTouch?(n&&console.log("WebSocketLogs detectTouchscreen = true"),!0):(n&&console.log("WebSocketLogs detectTouchscreen = false"),!1);function Ao(){const{messages:i,autoScroll:u}=r.useContext(Ut),[c,o]=r.useState(!1),l=r.useRef(null),y=r.useMemo(()=>Eo(),[]),m=p=>o(!0),t=p=>o(!1);r.useEffect(()=>{n&&console.log(`WebSocketLogs autoScroll: ${u} isHovering: ${c}`),u&&!c&&!y&&l.current?.scrollIntoView({behavior:"smooth"})},[i,c,u,y]);const x=p=>{switch(p.toLowerCase()){case"debug":return"gray";case"info":return"#267fb7";case"notice":return"green";case"warn":return"#e9db18";case"error":return"red";case"fatal":return"#ff0000";case"spawn":return"#ff00d0";default:return"#5c0e91"}},N=p=>{switch(p.toLowerCase()){case"warn":return"black";default:return"white"}};return e.jsx("div",{style:{margin:"0px",padding:"0px"},children:e.jsxs("ul",{style:{margin:"0px",padding:"0px"},onMouseEnter:m,onMouseLeave:t,children:[i.map((p,j)=>e.jsxs("li",{style:{wordWrap:"break-word",maxHeight:"200px",overflow:"hidden"},children:[e.jsx("span",{style:{marginRight:"5px",padding:"1px 5px",backgroundColor:x(p.level),color:N(p.level),fontSize:"12px",borderRadius:"3px",textAlign:"center"},children:p.level}),p.time&&e.jsx("span",{style:{marginRight:"3px",color:"#505050"},children:"["+p.time+"]"}),p.name&&e.jsx("span",{style:{marginRight:"3px",color:"#09516d"},children:"["+p.name+"]"}),e.jsx("span",{style:{color:"var(--main-log-color)"},children:p.message})]},j)),e.jsx("div",{ref:l})]})})}const Bt=r.memo(Ao);function $e(){const{retry:i}=r.useContext(me),u=()=>{window.location.reload()};return e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",fontSize:"20px",flexDirection:"column",color:"var(--main-text-color)",height:"100vh",backgroundColor:"var(--main-bg-color)"},children:e.jsx(Y,{sx:{display:"flex",alignItems:"center",flexDirection:"column"},children:i<100?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"256px",width:"256px",margin:"10px",marginBottom:"20px"}}),e.jsx(xr,{style:{color:"var(--primary-color)"}}),e.jsx("div",{style:{marginTop:"20px",color:"var(--primary-color)"},children:e.jsxs("span",{children:["Reconnecting to Matterbridge ","(attempt "+i+")","..."]})})]}):e.jsxs("div",{style:{marginTop:"20px",color:"var(--primary-color)",textAlign:"center"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"256px",width:"256px",margin:"10px",marginBottom:"20px"}}),e.jsx("span",{children:"Unable to connect to Matterbridge after multiple attempts."}),e.jsx("br",{}),e.jsx("span",{children:"Please check your network connection."}),e.jsx("br",{}),e.jsx(ae,{variant:"contained",color:"primary",onClick:u,style:{marginTop:"20px"},children:"Refresh the Page"})]})})})}function _o({value:i,maxChars:u}){let c=i;if(i.length>u&&u>3){const o=u-3,l=i.substring(0,Math.ceil(o/2)),y=i.substring(i.length-Math.floor(o/2),i.length);c=`${l} … ${y}`}return i!==c?e.jsx(T,{title:i,placement:"top",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[0,12]}}]}},children:e.jsx("span",{children:c})}):e.jsx("span",{children:c})}function qo({systemInfo:i,compact:u}){const{sendMessage:c,addListener:o,removeListener:l,getUniqueId:y}=r.useContext(me),[m,t]=r.useState(i),x=r.useRef(y());if(n&&console.log("SystemInfoTable:",m,"compact:",u),i&&u&&m.totalMemory&&m.freeMemory){const N=m.totalMemory,p=m.freeMemory;m.freeMemory=`${p} / ${N}`,m.totalMemory=""}if(i&&u&&m.heapTotal&&m.heapUsed){const N=m.heapTotal,p=m.heapUsed;m.heapUsed=`${p} / ${N}`,m.heapTotal=""}if(i&&u&&m.osRelease&&m.osType){const N=m.osType,p=m.osRelease;m.osType=`${N} (${p})`,m.osRelease=""}if(i&&u&&m.osArch&&m.osPlatform){const N=m.osPlatform,p=m.osArch;m.osPlatform=`${N} (${p})`,m.osArch=""}return r.useEffect(()=>{const N=p=>{p.src==="Matterbridge"&&p.dst==="Frontend"&&(p.method==="memory_update"&&p.response&&p.response.totalMemory&&p.response.freeMemory&&p.response.heapTotal&&p.response.heapUsed&&p.response.rss&&(n&&console.log("SystemInfoTable received memory_update",p),(m.totalMemory!==p.response.totalMemory||m.freeMemory!==p.response.freeMemory||m.heapTotal!==p.response.heapTotal||m.heapUsed!==p.response.heapUsed||m.rss!==p.response.rss)&&t(j=>({...j,totalMemory:p.response.totalMemory,freeMemory:p.response.freeMemory,heapTotal:p.response.heapTotal,heapUsed:p.response.heapUsed,rss:p.response.rss}))),p.method==="cpu_update"&&p.response&&p.response.cpuUsage&&(n&&console.log("SystemInfoTable received cpu_update",p),m.cpuUsage!==(p.response.cpuUsage?p.response.cpuUsage.toFixed(2)+" %":"")&&t(j=>({...j,cpuUsage:p.response.cpuUsage.toFixed(2)+" %"}))),p.method==="uptime_update"&&p.response&&p.response.systemUptime&&p.response.processUptime&&(n&&console.log("SystemInfoTable received uptime_update",p),(m.systemUptime!==p.response.systemUptime||m.processUptime!==p.response.processUptime)&&t(j=>({...j,systemUptime:p.response.systemUptime,processUptime:p.response.processUptime}))))};return n&&console.log("SystemInfoTable useEffect WebSocketMessage mounting"),o(N,x.current),n&&console.log("SystemInfoTable useEffect WebSocketMessage mounted"),()=>{n&&console.log("SystemInfoTable useEffect WebSocketMessage unmounting"),l(N),n&&console.log("SystemInfoTable useEffect WebSocketMessage unmounted")}},[o,m.cpuUsage,m.freeMemory,m.heapTotal,m.heapUsed,m.processUptime,m.rss,m.systemUptime,m.totalMemory,l,c]),m?(n&&console.log("SystemInfoTable rendering..."),e.jsxs("div",{className:"MbfWindowDiv",style:{minWidth:"302px",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"System Information"})}),e.jsx("div",{className:"MbfWindowDivTable",children:e.jsx("table",{style:{border:"none",borderCollapse:"collapse"},children:e.jsx("tbody",{style:{border:"none",borderCollapse:"collapse"},children:Object.entries(m).filter(([N,p])=>p!==void 0&&p!=="").map(([N,p],j)=>e.jsxs("tr",{className:j%2===0?"table-content-even":"table-content-odd",style:{border:"none",borderCollapse:"collapse"},children:[e.jsx("td",{style:{border:"none",borderCollapse:"collapse"},children:N}),e.jsx("td",{style:{border:"none",borderCollapse:"collapse"},children:e.jsx(_o,{value:typeof p!="string"?p.toString():p,maxChars:25})})]},N))})})})]})):null}const zo=r.memo(qo),$t={margin:"0px",padding:"0px",color:"var(--div-text-color)",transition:"color 0.2s ease","& svg":{display:"block"},"& svg path":{fill:"var(--div-text-color)",transition:"fill 0.2s ease"},"&:hover":{color:"var(--primary-color)"},"&:hover svg path":{fill:"var(--primary-color)"},"&:focus-visible":{outline:"2px solid var(--primary-color)",outlineOffset:"2px"}},Uo=i=>{if(!i)return"";const u=i.toString().replace(/[^0-9]/g,"");if(u.length<5)return u;const c=u.slice(0,4),o=u.slice(4,7),l=u.slice(7,11);return[c,o,l].filter(Boolean).join("-")};function Bo({id:i}){const{online:u,sendMessage:c,addListener:o,removeListener:l,getUniqueId:y}=r.useContext(me),[m,t]=r.useState(null),[x,N]=r.useState(null),p=r.useRef(null),j=r.useRef(y()),{showConfirmCancelDialog:O}=r.useContext(Be);r.useEffect(()=>{n&&console.log(`QRDiv received storeId update "${i}"`),i&&(n&&console.log(`QRDiv sending data request for storeId "${i}"`),t(i),c({id:j.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:i,server:!0}}))},[i]),r.useEffect(()=>{const b=v=>{v.src==="Matterbridge"&&v.dst==="Frontend"&&v.method==="refresh_required"&&v.response.changed==="matter"&&v.response.matter&&(n&&console.log(`QRDiv received refresh_required: changed=${v.response.changed} for storeId "${v.response.matter.id}":`,v.response.matter),m===v.response.matter.id&&(n&&console.log(`QRDiv received refresh_required/matter: setting matter data for storeId "${v.response.matter.id}":`,v.response.matter),p.current&&clearTimeout(p.current),v.response.matter.advertising&&v.response.matter.advertiseTime&&v.response.matter.advertiseTime+9e5<=Date.now()&&(v.response.matter.advertising=!1),N(v.response.matter),v.response.matter.advertising&&(n&&console.log(`QRDiv setting matter advertise timeout for storeId "${v.response.matter.id}":`,v.response.matter.advertiseTime+9e5-Date.now()),p.current=setTimeout(()=>{p.current&&clearTimeout(p.current),n&&console.log(`QRDiv clearing advertising state for storeId "${m}" after 15 minutes`),N(C=>C&&{...C,advertising:!1})},v.response.matter.advertiseTime+9e5-Date.now()))))};return o(b,j.current),n&&console.log("QRDiv webSocket effect mounted"),()=>{l(b),p.current&&clearTimeout(p.current),p.current=null,n&&console.log("QRDiv webSocket effect unmounted")}},[m]);const $=()=>{n&&console.log(`QRDiv sent matter startCommission for node "${x?.id}"`),x&&c({id:j.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:x.id,startCommission:!0}})},P=()=>{n&&console.log(`QRDiv sent matter stopCommission for node "${x?.id}"`),x&&c({id:j.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:x.id,stopCommission:!0}})},U=()=>{n&&console.log(`QRDiv sent matter advertise for node "${x?.id}"`),x&&c({id:j.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:x.id,advertise:!0}})},h=b=>{n&&console.log(`QRDiv sent matter removeFabric for node "${x?.id}" and fabricIndex ${b}`),x&&c({id:j.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:x.id,removeFabric:b}})},V=async()=>{if(!x||!x.manualPairingCode)return;const b=x.manualPairingCode.toString();try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(b);else{const v=document.createElement("textarea");v.value=b,v.style.position="fixed",v.style.opacity="0",document.body.appendChild(v),v.focus(),v.select(),document.execCommand("copy"),document.body.removeChild(v)}n&&console.log("Manual pairing code copied to clipboard")}catch(v){console.error("Failed to copy manual pairing code",v)}};return!x||!u?(n&&console.log("QRDiv rendering undefined state"),null):x.online?x.advertising&&x.qrPairingCode&&x.manualPairingCode?(n&&console.log("QRDiv rendering advertising state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"QR pairing code"}),e.jsxs("div",{className:"MbfWindowHeaderFooterIcons",children:[e.jsx(Q,{"aria-label":"send advertising",size:"small",onClick:U,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(T,{title:"Send again the mDNS advertisement",arrow:!0,children:e.jsx(re,{path:Wt,size:"22px"})})}),e.jsx(Q,{"aria-label":"stop pairing",size:"small",onClick:P,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(T,{title:"Turn off pairing",arrow:!0,children:e.jsx(re,{path:ro,size:"22px"})})})]})]}),e.jsx("p",{className:"MbfWindowHeaderText",style:{overflow:"hidden",maxWidth:"280px",textOverflow:"ellipsis",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:m}),e.jsx(to,{value:x.qrPairingCode,size:256,level:"M",fgColor:"var(--div-text-color)",bgColor:"var(--div-bg-color)",style:{margin:"20px"}}),e.jsxs("div",{className:"MbfWindowFooter",style:{justifyContent:"space-between"},children:[e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Manual pairing code: ",Uo(x.manualPairingCode)]}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(T,{title:"Copy manual pairing code",arrow:!0,children:e.jsx(Q,{"aria-label":"copy manual pairing code",size:"small",onClick:V,sx:$t,children:e.jsx(re,{path:oo,size:.85})})})})]})]})):x.commissioned&&x.fabricInformations&&x.sessionInformations?(n&&console.log("QRDiv rendering commissioned state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px",overflow:"hidden"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Paired fabrics"}),e.jsxs("div",{className:"MbfWindowHeaderFooterIcons",children:[e.jsx(Q,{"aria-label":"send advertising",size:"small",onClick:U,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(T,{title:"Send again the mDNS advertisement",arrow:!0,children:e.jsx(re,{path:Wt,size:"22px"})})}),e.jsx(Q,{"aria-label":"start pairing",size:"small",onClick:$,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(T,{title:"Turn on pairing",arrow:!0,children:e.jsx(re,{path:Ft,size:"22px"})})})]})]}),e.jsxs("div",{className:"MbfWindowBodyColumn",style:{paddingTop:"0px"},children:[e.jsx("p",{className:"MbfWindowHeaderText thin-scroll",style:{overflowX:"auto",maxWidth:"280px",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:m}),x.fabricInformations.map((b,v)=>e.jsxs("div",{style:{margin:"0px",padding:"10px",gap:"0px",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",textAlign:"left",fontSize:"14px"},children:[e.jsxs("div",{style:{marginLeft:"20px",marginBottom:"10px",display:"flex",flexDirection:"row",justifyContent:"space-between",gap:"20px",alignItems:"center"},children:[e.jsxs("p",{className:"status-blue",style:{margin:"0px",padding:"3px 10px",width:"200px",fontSize:"14px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},children:["Fabric: ",b.fabricIndex]}),e.jsx(T,{title:"Remove the fabric. You will also need to remove it from the controller.",arrow:!0,children:e.jsx(Q,{"aria-label":"remove the fabric",size:"small",onClick:()=>O("Remove fabric","Are you sure you want to remove this fabric? You will also need to remove it from the controller.","RemoveFabric",()=>h(b.fabricIndex),()=>{}),sx:{...$t,padding:"2px"},children:e.jsx(re,{path:no,size:1})})})]}),e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Vendor: ",b.rootVendorId," ",b.rootVendorName]}),b.label!==""&&e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Label: ",b.label]}),e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Sessions: ",x.sessionInformations?x.sessionInformations.filter(C=>C.fabric?.fabricIndex===b.fabricIndex&&C.isPeerActive===!0).length:"0"," ","subscriptions: ",x.sessionInformations?x.sessionInformations.filter(C=>C.fabric?.fabricIndex===b.fabricIndex&&C.isPeerActive===!0&&C.numberOfActiveSubscriptions>0).length:"0"]})]},v))]}),e.jsx("div",{className:"MbfWindowFooter",children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Serial number: ",x.serialNumber]})})]})):!x.commissioned&&!x.advertising?(n&&console.log("QRDiv rendering not commissioned and not advertising state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px"},children:[e.jsx("div",{className:"MbfWindowHeader",style:{height:"30px"},children:e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"QR pairing code"})}),e.jsx("p",{className:"MbfWindowHeaderText thin-scroll",style:{overflowX:"auto",maxWidth:"280px",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:m}),e.jsx(ae,{onClick:$,endIcon:e.jsx(re,{path:Ft,size:1}),style:{margin:"20px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:"Turn on pairing"}),e.jsx("div",{className:"MbfWindowFooter",children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Serial number: ",x.serialNumber]})})]})):(n&&console.log("QRDiv rendering unknown state"),null):(n&&console.log("QRDiv rendering offline state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Server node"}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons"})]}),e.jsx("p",{className:"MbfWindowHeaderText",style:{overflow:"hidden",maxWidth:"280px",textOverflow:"ellipsis",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:m}),e.jsx("p",{style:{textAlign:"center",fontSize:"14px",fontWeight:"bold"},children:"Server offline: restart to commission"}),e.jsx("div",{className:"MbfWindowFooter",children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Serial number: ",x.serialNumber]})})]}))}const Qo=r.memo(Bo);function Ko(){const{logMessage:i,sendMessage:u,getUniqueId:c}=r.useContext(me),[o,l]=r.useState("matterbridge-"),[y,m]=r.useState(!1),[t,x]=r.useState(null),N=r.useRef(c()),p=v=>{v.preventDefault(),m(!0)},j=()=>{m(!1)},O=v=>{v.preventDefault(),m(!1);const C=v.dataTransfer.files[0];if(C){i("Plugins",`Installing package ${C.name}. Please wait...`);const L=new FormData;L.append("file",C),L.append("filename",C.name),fetch("./api/uploadpackage",{method:"POST",body:L}).then(w=>w.text()).then(w=>{i("Plugins",`Server response: ${w}`)}).catch(w=>{console.error("Error uploading plugin file:",w),i("Plugins",`Error installing package ${w}`)})}},$=v=>{const C=v.target.files&&v.target.files[0];if(C){i("Plugins",`Uploading package ${C.name}`);const L=new FormData;L.append("file",C),L.append("filename",C.name),fetch("./api/uploadpackage",{method:"POST",body:L}).then(w=>w.text()).then(w=>{i("Plugins",`Server response: ${w}`)}).catch(w=>{console.error("Error uploading plugin file:",w),i("Plugins",`Error uploading package ${w}`)})}},P=()=>{u({id:N.current,sender:"InstallPlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:o,restart:!1}})},U=()=>{document.getElementById("file-upload")?.click()},h=()=>{u({id:N.current,sender:"InstallPlugins",method:"/api/addplugin",src:"Frontend",dst:"Matterbridge",params:{pluginNameOrPath:o}})},V=v=>{x(v.currentTarget)},b=v=>{v!==""&&l(v),x(null)};return n&&console.log("AddRemovePlugins rendering..."),e.jsxs("div",{style:{display:"flex",flexDirection:"row",flex:"1 1 auto",alignItems:"center",justifyContent:"space-between",margin:"0px",padding:"10px",gap:"20px"},onDragOver:p,onDragLeave:j,onDrop:O,children:[e.jsx(de,{value:o,onChange:v=>{l(v.target.value)},size:"small",id:"plugin-name",label:"Plugin name or plugin path",variant:"outlined",fullWidth:!0}),e.jsx(Q,{onClick:V,children:e.jsx(br,{})}),e.jsxs(ze,{id:"simple-menu",anchorEl:t,keepMounted:!0,open:!!t,onClose:()=>b(""),children:[e.jsx(I,{onClick:()=>b("matterbridge-zigbee2mqtt"),children:"matterbridge-zigbee2mqtt"}),e.jsx(I,{onClick:()=>b("matterbridge-somfy-tahoma"),children:"matterbridge-somfy-tahoma"}),e.jsx(I,{onClick:()=>b("matterbridge-shelly"),children:"matterbridge-shelly"}),e.jsx(I,{onClick:()=>b("matterbridge-hass"),children:"matterbridge-hass"}),e.jsx(I,{onClick:()=>b("matterbridge-webhooks"),children:"matterbridge-webhooks"}),e.jsx(I,{onClick:()=>b("matterbridge-bthome"),children:"matterbridge-bthome"}),e.jsx(I,{onClick:()=>b("matterbridge-test"),children:"matterbridge-test"}),e.jsx(I,{onClick:()=>b("matterbridge-example-accessory-platform"),children:"matterbridge-example-accessory-platform"}),e.jsx(I,{onClick:()=>b("matterbridge-example-dynamic-platform"),children:"matterbridge-example-dynamic-platform"}),e.jsx(I,{onClick:()=>b("matterbridge-eve-door"),children:"matterbridge-eve-door"}),e.jsx(I,{onClick:()=>b("matterbridge-eve-motion"),children:"matterbridge-eve-motion"}),e.jsx(I,{onClick:()=>b("matterbridge-eve-energy"),children:"matterbridge-eve-energy"}),e.jsx(I,{onClick:()=>b("matterbridge-eve-weather"),children:"matterbridge-eve-weather"}),e.jsx(I,{onClick:()=>b("matterbridge-eve-room"),children:"matterbridge-eve-room"})]}),e.jsx(T,{title:"Install or update a plugin from npm",children:e.jsx(ae,{onClick:P,endIcon:e.jsx(Se,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Install"})}),e.jsx(T,{title:"Upload and install a plugin from a tarball",children:e.jsx(ae,{onClick:U,endIcon:e.jsx(vr,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Upload"})}),e.jsx(T,{title:"Add an installed plugin",children:e.jsx(ae,{onClick:h,endIcon:e.jsx(ct,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Add"})}),e.jsx("input",{id:"file-upload",type:"file",accept:".tgz",style:{display:"none"},onChange:$})]})}const Jo=r.memo(Ko);function Ee({status:i,enabledText:u="Enabled",disabledText:c=void 0,tooltipText:o=void 0,onClick:l}){if(i===void 0)return null;{const y=e.jsx("div",{className:i?"status-enabled":"status-disabled",style:{cursor:"default"},onClick:l,children:i?u:c??u});return o!==void 0?e.jsx(T,{title:o,children:y}):y}}function Rt(i){return i.id!==0&&i.src==="Matterbridge"&&i.dst==="Frontend"}const Ae={fontSize:"16px",fontWeight:"bold",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},_e={fontSize:"12px",fontWeight:"normal",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},Go={fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)",backgroundColor:"var(--div-bg-color)"},Yo={fontSize:"16px",fontWeight:"bold",backgroundColor:"var(--div-bg-color)"},ke={padding:"0px",margin:"0px"},Xo="5px 10px 5px 10px",st={},he={},at={},lt={};let qe=[],xt=[];const Zo=({open:i,onClose:u,plugin:c})=>{const{sendMessage:o,addListener:l,removeListener:y,getUniqueId:m}=r.useContext(me),t=r.useRef(m()),[x,N]=r.useState(c.configJson),[p,j]=r.useState(null),[O,$]=r.useState({"ui:submitButtonOptions":{submitText:"Confirm"},"ui:globalOptions":{orderable:!0}}),[P,U]=r.useState("");let h={};r.useEffect(()=>{const D=S=>{S.src==="Matterbridge"&&S.dst==="Frontend"&&(Rt(S)&&S.id===t.current&&S.method==="/api/select/devices"&&S.response&&(n&&console.log(`ConfigPluginDialog (id: ${S.id}) received ${S.response.length} /api/select/devices:`,S.response),qe=S.response),Rt(S)&&S.id===t.current&&S.method==="/api/select/entities"&&S.response&&(n&&console.log(`ConfigPluginDialog (id: ${S.id}) received ${S.response.length} /api/select/entities:`,S.response),xt=S.response))};return l(D,t.current),n&&console.log("ConfigPluginDialog added WebSocket listener id:",t.current),x&&p&&p.properties&&(Object.keys(p.properties).forEach(S=>{Object.keys(p.properties[S]).forEach(F=>{F.startsWith("ui:")&&(O[S]={},O[S][F]=p.properties[S][F],delete p.properties[S][F])})}),$(O)),c.name&&c.configJson&&c.schemaJson&&(N(c.configJson),j(c.schemaJson),o({id:t.current,sender:"ConfigPlugin",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:c.name}}),o({id:t.current,sender:"ConfigPlugin",method:"/api/select/entities",src:"Frontend",dst:"Matterbridge",params:{plugin:c.name}}),n&&console.log('HomePlugins sent "/api/select/devices" and "/api/select/entities" for plugin:',c.name)),()=>{y(D),n&&console.log("ConfigPluginDialog removed WebSocket listener")}},[l,x,c,y,p,o,O]);const V=(D,S)=>{h=D.formData},b=D=>{n&&console.log("ConfigPluginDialog handleSaveChanges:",D.formData),N(D.formData),c.configJson=D.formData,c.restartRequired=!0,o({id:t.current,sender:"ConfigPlugin",method:"/api/savepluginconfig",src:"Frontend",dst:"Matterbridge",params:{pluginName:D.formData.name,formData:D.formData}}),u()};function v(D){const{id:S,label:F,onKeyChange:_,onDropPropertyClick:Z,disabled:K,schema:f,children:ne,registry:H,readonly:oe,required:ue}=D,{templates:ee}=H,{RemoveButton:je}=ee.ButtonTemplates;if(!(To in f))return e.jsx(Y,{sx:{display:"flex",flexDirection:"column",flexGrow:1,padding:0,margin:0,border:"none"},children:ne});const ge=({target:J})=>_(J&&J.value);return e.jsxs(Y,{sx:{display:"flex",flexDirection:"row",flexGrow:1,padding:0,margin:0,border:"none"},children:[e.jsx(de,{id:`${S}-key`,name:`${S}-key`,required:ue,disabled:K||oe,defaultValue:F,onBlur:oe?void 0:ge,type:"text",variant:"outlined",sx:{width:"250px",minWidth:"250px",maxWidth:"250px",marginRight:"20px"}}),e.jsx(Y,{sx:{flex:1},children:ne}),e.jsx(je,{disabled:K||oe,onClick:Z(F),registry:H})]})}function C(D){const{children:S,description:F,displayLabel:_,errors:Z,help:K,hidden:f,registry:ne,uiSchema:H}=D,oe=Fo(H),ue=Lo("WrapIfAdditionalTemplate",ne,oe);return f?e.jsx("div",{style:{display:"none"},children:S}):e.jsx(Y,{sx:{display:"flex",flexDirection:"column",flexGrow:1,padding:0,margin:0,border:"none"},children:e.jsxs(ue,{...D,children:[_===!0&&F,S,Z,K]})})}function L(D){const{description:S}=D;return S?e.jsx(se,{sx:_e,children:S}):null}function w(D){const{required:S,title:F}=D;return F?e.jsx(Y,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:e.jsxs(se,{sx:Ae,children:["Title ",F," ",S&&e.jsx("mark",{children:"***"})]})}):null}function G(D){const{help:S}=D;return S?e.jsx(Y,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:e.jsx(se,{sx:Go,children:S})}):null}function A(D){const{errors:S}=D;return S?e.jsxs(Y,{sx:{padding:"10px",margin:"10px",border:"1px solid grey"},children:[e.jsx(se,{color:"error",sx:Yo,children:"Please fix the following errors:"}),e.jsx(Je,{children:S.map((F,_)=>e.jsxs(yr,{children:[e.jsx(z,{children:e.jsx(jr,{color:"error"})}),e.jsx(te,{primary:F.stack})]},_))})]}):null}function a(D){const{errors:S}=D;return S?e.jsx(Y,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:S.map((F,_)=>e.jsxs(se,{color:"error",variant:"body2",sx:{marginLeft:1},children:["This field ",F]},_))}):null}function s(D){const{id:S,name:F,_schema:_,_uiSchema:Z,value:K,options:f,label:ne,type:H,placeholder:oe,required:ue,disabled:ee,readonly:je,autofocus:xe,onChange:ge,onChangeOverride:J,onBlur:le,onFocus:fe,_rawErrors:Qe,_hideError:B,_registry:k,_formContext:ce}=D,Ke=({target:{value:ve}})=>ge(ve===""?f.emptyValue:ve),Pe=({target:ve})=>le(S,ve&&ve.value),Ye=({target:ve})=>fe(S,ve&&ve.value);return e.jsx(Y,{sx:{padding:"0px",margin:"0px"},children:e.jsx(de,{id:S,name:S,label:oe&&oe!==""?ne:void 0,variant:"outlined",placeholder:oe&&oe!==""?oe:ne,required:ue,disabled:ee||je,autoFocus:xe,value:K||K===0?K:"",type:H,autoComplete:H==="password"?"current-password":F,onChange:J||Ke,onBlur:Pe,onFocus:Ye,fullWidth:!0})})}function d(D){return console.log("ArrayFieldTitleTemplate:",D),null}function g(D){return console.log("ArrayFieldDescriptionTemplate:",D),null}function R(D){return console.log("ArrayFieldItemTemplate:",D),null}function pe(D){const{canAdd:S,onAddClick:F,schema:_,title:Z}=D,[K,f]=r.useState(!1),[ne,H]=r.useState(!1),[oe,ue]=r.useState(!1),[ee,je]=r.useState(""),xe=k=>{je(k.target.value)},ge=()=>{n&&console.log("ArrayFieldTemplate: handleDialogDeviceToggle filter:",ee,"selectDevices:",qe),f(!K)},J=()=>{n&&console.log("ArrayFieldTemplate: handleDialogEntityToggle filter:",ee,"selectEntities:",xt),H(!ne)},le=()=>{n&&console.log("ArrayFieldTemplate: handleDialogDeviceEntityToggle filter:",ee,"selectDevices:",qe),ue(!oe)},fe=k=>{f(!1),_.selectFrom==="serial"?_.items.default=k.serial:_.selectFrom==="name"&&(_.items.default=k.name),F()},Qe=k=>{H(!1),_.selectEntityFrom==="name"?_.items.default=k.name:_.selectEntityFrom==="description"&&(_.items.default=k.description),F()},B=k=>{ue(!1),_.selectDeviceEntityFrom==="name"?_.items.default=k.name:_.selectDeviceEntityFrom==="description"&&(_.items.default=k.description),F()};return e.jsxs(Y,{sx:{margin:"0px",padding:"5px 10px 5px 10px",border:"1px solid grey"},children:[Z&&e.jsxs(Y,{sx:{margin:"0px",padding:"0px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[Z&&e.jsx(se,{sx:Ae,children:Z}),S&&e.jsxs(Y,{sx:{margin:"0px",padding:"0px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[_.selectFrom&&e.jsx(T,{title:"Add a device from the list",children:e.jsx(Q,{onClick:ge,size:"small",color:"primary",sx:ke,children:e.jsx(tt,{})})}),_.selectEntityFrom&&e.jsx(T,{title:"Add an entity from the list",children:e.jsx(Q,{onClick:J,size:"small",color:"primary",sx:ke,children:e.jsx(tt,{})})}),_.selectDeviceEntityFrom&&e.jsx(T,{title:"Add a device entity from the list",children:e.jsx(Q,{onClick:le,size:"small",color:"primary",sx:ke,children:e.jsx(tt,{})})}),e.jsx(T,{title:"Add a new item",children:e.jsx(Q,{onClick:F,size:"small",color:"primary",sx:ke,children:e.jsx(ct,{})})})]})]}),_.description&&e.jsx(se,{sx:_e,children:_.description}),D.items.map(k=>e.jsxs(Y,{sx:{margin:"2px 0px",padding:"0px",display:"flex",alignItems:"center"},children:[e.jsx(Y,{sx:{flexGrow:1,marginRight:"10px"},children:k.children}),e.jsx(Q,{disabled:!k.hasMoveUp,onClick:k.onReorderClick(k.index,k.index-1),size:"small",color:"primary",sx:ke,children:e.jsx(Mt,{})}),e.jsx(Q,{disabled:!k.hasMoveDown,onClick:k.onReorderClick(k.index,k.index+1),size:"small",color:"primary",sx:ke,children:e.jsx(St,{})}),e.jsx(Q,{onClick:k.onDropIndexClick(k.index),size:"small",color:"primary",sx:ke,children:e.jsx(ut,{})})]},k.index)),e.jsxs(Ie,{open:K,onClose:ge,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(De,{children:"Select a device"}),e.jsxs(Ne,{children:[e.jsxs(Y,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(se,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(de,{fullWidth:!0,variant:"outlined",value:ee,onChange:xe,placeholder:"Enter serial or name"})]}),e.jsx(Je,{dense:!0,children:qe.filter(k=>k.serial.toLowerCase().includes(ee.toLowerCase())||k.name.toLowerCase().includes(ee.toLowerCase())).map((k,ce)=>e.jsxs(rt,{onClick:()=>fe(k),sx:st,children:[k.icon==="wifi"&&e.jsx(z,{children:e.jsx(Ge,{style:he})}),k.icon==="ble"&&e.jsx(z,{children:e.jsx(ot,{style:he})}),k.icon==="hub"&&e.jsx(z,{children:e.jsx(nt,{style:he})}),e.jsx(te,{primary:k.name,secondary:k.serial,primaryTypographyProps:{style:at},secondaryTypographyProps:{style:lt}})]},ce))})]}),e.jsx(Oe,{children:e.jsx(ae,{onClick:ge,children:"Close"})})]}),e.jsxs(Ie,{open:ne,onClose:J,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(De,{children:"Select an entity"}),e.jsxs(Ne,{children:[e.jsxs(Y,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(se,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(de,{fullWidth:!0,variant:"outlined",value:ee,onChange:xe,placeholder:"Enter name or description"})]}),e.jsx(Je,{dense:!0,children:xt.filter(k=>k.name.toLowerCase().includes(ee.toLowerCase())||k.description.toLowerCase().includes(ee.toLowerCase())).map((k,ce)=>e.jsxs(rt,{onClick:()=>Qe(k),sx:st,children:[k.icon==="wifi"&&e.jsx(z,{children:e.jsx(Ge,{style:he})}),k.icon==="ble"&&e.jsx(z,{children:e.jsx(ot,{style:he})}),k.icon==="hub"&&e.jsx(z,{children:e.jsx(nt,{style:he})}),k.icon==="component"&&e.jsx(z,{children:e.jsx(kt,{style:he})}),k.icon==="matter"&&e.jsx(z,{children:e.jsx(It,{style:he})}),e.jsx(te,{primary:k.name,secondary:k.description,primaryTypographyProps:{style:at},secondaryTypographyProps:{style:lt}})]},ce))})]}),e.jsx(Oe,{children:e.jsx(ae,{onClick:J,children:"Close"})})]}),e.jsxs(Ie,{open:oe,onClose:le,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsxs(De,{children:["Select an entity for ",Z]}),e.jsx(Ne,{children:e.jsx(Je,{dense:!0,children:qe.filter(k=>k.serial===Z||k.name===Z).map(k=>k.entities?.map((ce,Ke)=>e.jsxs(rt,{onClick:()=>B(ce),sx:st,children:[ce.icon==="wifi"&&e.jsx(z,{children:e.jsx(Ge,{style:he})}),ce.icon==="ble"&&e.jsx(z,{children:e.jsx(ot,{style:he})}),ce.icon==="hub"&&e.jsx(z,{children:e.jsx(nt,{style:he})}),ce.icon==="component"&&e.jsx(z,{children:e.jsx(kt,{style:he})}),ce.icon==="matter"&&e.jsx(z,{children:e.jsx(It,{style:he})}),e.jsx(te,{primary:ce.name,secondary:ce.description,primaryTypographyProps:{style:at},secondaryTypographyProps:{style:lt}})]},Ke)))})}),e.jsx(Oe,{children:e.jsx(ae,{onClick:le,children:"Close"})})]})]})}function Ce(D){const{onAddClick:S,schema:F,properties:_,title:Z,description:K}=D,[f,ne]=r.useState(!1),[H,oe]=r.useState(""),ue=J=>{oe(J.target.value)},ee=()=>{ne(!f)},je=J=>{n&&console.log(`ObjectFieldTemplate: handleSelectValue value "${J.serial}" for schema "${F.selectFrom}"`),ne(!1);let le="";F.selectFrom==="serial"?le=J.serial:F.selectFrom==="name"&&(le=J.name),U(le),n&&console.log(`ObjectFieldTemplate: handleSelectValue newkey "${le}"`),S(F)()},xe=()=>{S(F)()},ge=!F.additionalProperties;return n&&console.log(`ObjectFieldTemplate: isRoot ${ge} newkey "${P}"`),!ge&&P!==""&&(n&&console.log("ObjectFieldTemplate: newkey",P,"properties",_),_.forEach(J=>{if(J.name==="newKey"&&J.content.key==="newKey"&&J.content.props.name==="newKey"&&J.content.props.onKeyChange&&P!==""){n&&console.log("ObjectFieldTemplate: newkey onKeyChange",P);const le=P;U(""),J.content.props.onKeyChange(le)}})),e.jsxs(Y,{sx:{margin:"0px",padding:ge?"10px":"5px 10px 0px 10px",border:ge?"none":"1px solid grey"},children:[F.title&&ge&&e.jsx(Y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px",marginBottom:"10px"},children:e.jsx(se,{sx:Ae,children:F.title})}),Z&&!ge&&e.jsxs(Y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px"},children:[e.jsx(se,{sx:Ae,children:Z}),e.jsxs(Y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px"},children:[F.selectFrom&&e.jsx(T,{title:"Add a device from the list",children:e.jsx(Q,{onClick:ee,size:"small",color:"primary",sx:ke,children:e.jsx(tt,{})})}),e.jsx(T,{title:"Add a new item",children:e.jsx(Q,{onClick:xe,size:"small",color:"primary",sx:ke,children:e.jsx(ct,{})})})]})]}),F.description&&e.jsx(Y,{sx:{padding:"0px",margin:"0px",marginBottom:"10px"},children:e.jsx(se,{sx:_e,children:F.description})}),_.map(({content:J,name:le,hidden:fe})=>!fe&&e.jsxs(Y,{sx:{margin:"0px",marginBottom:"10px",padding:["object","array","boolean"].includes(F.properties[le].type)?"0px":Xo,border:["object","array","boolean"].includes(F.properties[le].type)?"none":"1px solid grey"},children:[!["object","array","boolean"].includes(F.properties[le].type)&&e.jsx(se,{sx:Ae,children:le}),e.jsx(Y,{sx:{flexGrow:1,padding:"0px",margin:"0px"},children:J})]},le)),e.jsxs(Ie,{open:f,onClose:ee,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(De,{children:"Select a device"}),e.jsxs(Ne,{children:[e.jsxs(Y,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(se,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(de,{fullWidth:!0,variant:"outlined",value:H,onChange:ue,placeholder:"Enter serial or name"})]}),e.jsx(Je,{dense:!0,children:qe.filter(J=>J.serial.toLowerCase().includes(H.toLowerCase())||J.name.toLowerCase().includes(H.toLowerCase())).map((J,le)=>e.jsxs(rt,{onClick:()=>je(J),sx:st,children:[J.icon==="wifi"&&e.jsx(z,{children:e.jsx(Ge,{style:he})}),J.icon==="ble"&&e.jsx(z,{children:e.jsx(ot,{style:he})}),J.icon==="hub"&&e.jsx(z,{children:e.jsx(nt,{style:he})}),e.jsx(te,{primary:J.name,secondary:J.serial,primaryTypographyProps:{style:at},secondaryTypographyProps:{style:lt}})]},le))})]}),e.jsx(Oe,{children:e.jsx(ae,{onClick:ee,children:"Close"})})]})]})}function we(D){const{uiSchema:S}=D,{submitText:F,norender:_}=Wo(S);return _?null:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",margin:"10px",padding:"0px",gap:"20px"},children:[e.jsx(ae,{type:"submit",variant:"contained",color:"primary",children:F}),e.jsx(ae,{variant:"contained",color:"primary",onClick:u,children:"Cancel"})]})}function ye(D){const{className:S,disabled:F,onClick:_,registry:Z,style:K,uiSchema:f,...ne}=D;return e.jsx(T,{title:"Remove the item",children:e.jsx(Q,{disabled:F,size:"small",color:"primary",onClick:_,children:e.jsx(ut,{})})})}function X(D){const{className:S,disabled:F,onClick:_,registry:Z,uiSchema:K,...f}=D;return e.jsx(T,{title:"Add an item",children:e.jsx(Q,{size:"small",color:"primary",onClick:_,children:e.jsx(ct,{})})})}function ie(D){const{disabled:S,onClick:F,registry:_,style:Z,uiSchema:K,...f}=D;return e.jsx(T,{title:"Move up the item",children:e.jsx(Q,{size:"small",color:"primary",onClick:F,children:e.jsx(Mt,{})})})}function M(D){const{disabled:S,onClick:F,registry:_,style:Z,uiSchema:K,...f}=D;return e.jsx(T,{title:"Move down the item",children:e.jsx(Q,{size:"small",color:"primary",onClick:F,children:e.jsx(St,{})})})}function E(D){const{id:S,name:F,value:_,schema:Z,readonly:K,onChange:f}=D,[ne,H]=r.useState(),oe=ee=>{n&&console.log(`CheckboxWidget ${F} onChangeField:`,ee),H(ee&&ee!==""?ee:void 0)},ue=()=>{n&&console.log(`CheckboxWidget onClick plugin="${c.name}" action="${F}" value="${ne}"`),o({id:t.current,sender:"ConfigPlugin",method:"/api/action",src:"Frontend",dst:"Matterbridge",params:{plugin:c.name,action:F,value:ne,formData:h,id:S}}),Z.buttonClose===!0?u():Z.buttonSave===!0&&b({formData:x})};return Z.buttonText&&Z.description?e.jsxs(Y,{sx:{margin:"0px",padding:"10px",border:"1px solid grey",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(se,{sx:_e,children:Z.description}),e.jsx(ae,{variant:"contained",color:"primary",onClick:()=>ue(),children:Z.buttonText})]}):Z.buttonField&&Z.description?e.jsxs(Y,{sx:{margin:"0px",padding:"10px",gap:"20px",border:"1px solid grey",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(se,{sx:_e,children:Z.description}),e.jsx(de,{id:F+"-input",name:F,label:Z.textLabel,placeholder:Z.textPlaceholder,onChange:ee=>oe(ee.target.value),sx:{width:"250px",minWidth:"250px",maxWidth:"250px"}}),e.jsx(ae,{id:F+"-button",variant:"contained",color:"primary",disabled:ne===void 0,onClick:()=>ue(),children:Z.buttonField})]}):e.jsxs(Y,{sx:{margin:"0px",padding:"5px 10px",border:"1px solid grey"},children:[F&&e.jsxs(Y,{sx:{margin:"0px",padding:"0px",gap:"10px",display:"flex",justifyContent:"flex-start",alignItems:"center"},children:[e.jsx(se,{sx:Ae,children:F}),e.jsx(Te,{checked:_,readOnly:K,onChange:()=>f(!_),sx:{padding:"0px",margin:"0px"}})]}),Z.description&&e.jsx(se,{sx:_e,children:Z.description})]})}function W({schema:D,id:S,name:F,options:_,label:Z,hideLabel:K,required:f,disabled:ne,placeholder:H,readonly:oe,value:ue,multiple:ee,autofocus:je,onChange:xe,onBlur:ge,onFocus:J,errorSchema:le,rawErrors:fe=[],registry:Qe,uiSchema:B,hideError:k,formContext:ce,...Ke}){const{enumOptions:Pe,enumDisabled:Ye,emptyValue:ve}=_;ee=typeof ee>"u"?!1:!!ee;const yt=ee?[]:"",jt=typeof ue>"u"||ee&&ue.length<1||!ee&&ue===yt,Kt=({target:{value:Me}})=>xe(ft(Me,Pe,ve)),Jt=({target:Me})=>ge(S,ft(Me&&Me.value,Pe,ve)),Gt=({target:Me})=>J(S,ft(Me&&Me.value,Pe,ve)),Ct=No(ue,Pe,ee),{InputLabelProps:Yt,SelectProps:Xt,autocomplete:Zt,...er}=Ke,tr=!ee&&D.default===void 0;return e.jsxs(de,{id:S,name:S,value:!jt&&typeof Ct<"u"?Ct:yt,required:f,disabled:ne||oe,autoFocus:je,autoComplete:Zt,placeholder:H,error:fe.length>0,onChange:Kt,onBlur:Jt,onFocus:Gt,...er,select:!0,InputLabelProps:{...Yt,shrink:!jt},SelectProps:{...Xt,multiple:ee},"aria-describedby":Po(S),children:[tr&&e.jsx(I,{value:"",children:H}),Array.isArray(Pe)&&Pe.map(({value:Me,label:rr},wt)=>{const or=Array.isArray(Ye)&&Ye.indexOf(Me)!==-1;return e.jsx(I,{value:String(wt),disabled:or,children:rr},wt)})]})}return n&&console.log("ConfigPluginDialog rendering..."),!i||!p||!x?null:e.jsxs(Ie,{open:i,onClose:u,slotProps:{paper:{sx:{maxWidth:"800px"}}},children:[e.jsx(De,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h3",{children:"Matterbridge plugin configuration"})]})}),e.jsx(Ne,{style:{padding:"0px",margin:"0px",width:"800px",height:"600px",overflow:"auto"},children:e.jsx(Io,{schema:p,formData:x,uiSchema:O,validator:Do,templates:{FieldTemplate:C,BaseInputTemplate:s,TitleFieldTemplate:w,DescriptionFieldTemplate:L,FieldHelpTemplate:G,FieldErrorTemplate:a,ErrorListTemplate:A,WrapIfAdditionalTemplate:v,ArrayFieldTitleTemplate:d,ArrayFieldDescriptionTemplate:g,ArrayFieldItemTemplate:R,ArrayFieldTemplate:pe,ObjectFieldTemplate:Ce,ButtonTemplates:{SubmitButton:we,RemoveButton:ye,AddButton:X,MoveUpButton:ie,MoveDownButton:M}},widgets:{CheckboxWidget:E,SelectWidget:W},onChange:V,onSubmit:b})})]})};function Qt(i){if(n&&console.log(`getQRColor (id: ${i?.id}) received matter:`,i??"undefined"),i===void 0||!i.online||!i.qrPairingCode&&!i.manualPairingCode&&!i.fabricInformations&&!i.sessionInformations)return"red";if(i.commissioned===!1&&i.qrPairingCode&&i.manualPairingCode)return"var(--primary-color)";let u=0,c=0;for(const o of i.sessionInformations??[])o.fabric&&o.isPeerActive===!0&&u++,o.numberOfActiveSubscriptions>0&&(c+=o.numberOfActiveSubscriptions);return i.commissioned===!0&&i.fabricInformations&&i.sessionInformations&&(u===0||c===0)?"var(--secondary-color)":"var(--div-text-color)"}function en(i,u,c){const o=i?.[c],l=u?.[c];return o==null&&l==null?0:o==null?-1:l==null?1:typeof o=="boolean"&&typeof l=="boolean"?o===l?0:o?1:-1:typeof o=="number"&&typeof l=="number"?o-l:String(o).localeCompare(String(l))}function tn({name:i,title:u,columns:c,rows:o,getRowKey:l,footerLeft:y,footerRight:m,onRowClick:t}){const x=r.useRef(new WeakMap),N=r.useRef(1),p=a=>{if(typeof l=="string"&&a&&a[l]!=null)return a[l];if(typeof l=="function"){const g=l(a);if(g!=null)return g}const s=c?.[0]?.id;if(s&&a&&a[s]!=null)return a[s];console.warn(`MbfTable(${i}): using fallback stable row key; consider providing getRowKey prop for better React performance`);let d=x.current.get(a);return d||(d=`rk_${N.current++}`,x.current.set(a,d)),d},[j,O]=r.useState(localStorage.getItem(`${i}_table_order_by`)||null),[$,P]=r.useState(localStorage.getItem(`${i}_table_order`)||null),[U,h]=r.useState(!1),[V,b]=r.useState(()=>{try{const a=localStorage.getItem(`${i}_column_visibility`);if(a)return JSON.parse(a)}catch{}return{}}),v=r.useMemo(()=>{const a={};for(const s of c)s.hidden||(a[s.id]=s.required?!0:V[s.id]!==!1);return a},[c,V]),C=r.useMemo(()=>{if(!j||!$)return o;const a=c.find(d=>d.id===j);if(!a||a.noSort)return o;const s=o.map((d,g)=>({el:d,index:g}));return s.sort((d,g)=>{let R;return typeof a.comparator=="function"?R=a.comparator(d.el,g.el):R=en(d.el,g.el,j),R!==0?$==="asc"?R:-R:d.index-g.index}),s.map(d=>d.el)},[o,j,$,c]),L=a=>{if(j!==a||!j){O(a),P("asc"),localStorage.setItem(`${i}_table_order_by`,a),localStorage.setItem(`${i}_table_order`,"asc");return}if($==="asc"){P("desc"),localStorage.setItem(`${i}_table_order`,"desc");return}O(null),P(null),localStorage.removeItem(`${i}_table_order_by`),localStorage.removeItem(`${i}_table_order`)},w=()=>{h(!U)},G=a=>{b(s=>{const d=c.find(pe=>pe.id===a);if(d&&d.required)return s;const g=v[a]!==!1,R={...s};g?R[a]=!1:delete R[a];try{localStorage.setItem(`${i}_column_visibility`,JSON.stringify(R))}catch{}return R})},A=()=>{b({});try{localStorage.removeItem(`${i}_column_visibility`)}catch{}h(!1)};return n&&console.log(`Rendering table ${i}${j&&$?` ordered by ${j}:${$}`:""}`),e.jsxs("div",{style:{display:"flex",flexDirection:"column",margin:"0",padding:"0",gap:"0",width:"100%",flex:"1 1 auto",height:"100%",minHeight:0,overflow:"hidden"},children:[e.jsxs(Ie,{open:U,onClose:(a,s)=>{s==="backdropClick"||s==="escapeKeyDown"||w()},disableEscapeKeyDown:!0,disableRestoreFocus:!0,children:[e.jsx(De,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:`Configure ${i} columns`})]})}),e.jsx(Ne,{children:e.jsx(Cr,{children:c.filter(a=>!a.hidden).map(a=>e.jsx(Le,{control:e.jsx(Te,{disabled:!!a.required,checked:a.required?!0:v[a.id]!==!1,onChange:()=>G(a.id)}),label:a.label},a.id))})}),e.jsxs(Oe,{children:[e.jsx(ae,{onClick:A,children:"Reset"}),e.jsx(ae,{variant:"contained",onClick:a=>{if(a?.currentTarget&&typeof a.currentTarget.blur=="function")try{a.currentTarget.blur()}catch{}const s=document.activeElement;if(s&&s instanceof HTMLElement&&typeof s.blur=="function")try{s.blur()}catch{}w()},children:"Close"})]})]}),e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",minHeight:"30px",justifyContent:"space-between",borderBottom:"none"},children:[e.jsx("p",{className:"MbfWindowHeaderText",children:i}),u&&e.jsx("p",{className:"MbfWindowHeaderText",children:u}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(Q,{onClick:a=>{if(a?.currentTarget?.blur)try{a.currentTarget.blur()}catch{}w()},"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(T,{title:`Configure ${i} columns`,children:e.jsx(re,{path:io,size:"20px",color:"var(--header-text-color)"})})})})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",flex:"1 1 auto",minHeight:0,width:"100%",overflow:"auto",margin:"0px",padding:"0px",gap:"0"},children:e.jsxs("table",{"aria-label":`${i} table`,style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,border:"none",color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color"},children:e.jsx("tr",{style:{height:"30px",minHeight:"30px"},children:c.map(a=>{if(a.hidden||!a.required&&v[a.id]===!1)return null;const s=!a.noSort,d=s&&j===a.id&&!!$;return e.jsxs("th",{onClick:s?()=>L(a.id):void 0,style:{margin:"0",padding:"5px 10px",position:"sticky",top:0,minWidth:a.minWidth,maxWidth:a.maxWidth,textAlign:a.align||"left",cursor:s?"pointer":"default",border:"none",color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color)",whiteSpace:a.maxWidth?"nowrap":void 0,overflow:a.maxWidth?"hidden":void 0,textOverflow:a.maxWidth?"ellipsis":void 0},"aria-sort":s?d?$==="asc"?"ascending":"descending":"none":void 0,children:[a.label,d&&e.jsxs("span",{style:{marginLeft:6},children:[$==="asc"&&e.jsx(re,{path:so,size:"15px"}),$==="desc"&&e.jsx(re,{path:ao,size:"15px"})]})]},a.id)})})}),e.jsx("tbody",{children:C.map((a,s)=>{const d=p(a);return e.jsx("tr",{className:s%2===0?"table-content-even":"table-content-odd",onClick:t?g=>t(a,d,g):void 0,style:{height:"30px",minHeight:"30px",border:"none",borderCollapse:"collapse",cursor:t?"pointer":void 0},children:c.map(g=>{if(g.hidden||!g.required&&v[g.id]===!1)return null;const R=a[g.id];return e.jsx("td",{style:{border:"none",borderCollapse:"collapse",textAlign:g.align||"left",padding:"5px 10px",margin:"0",maxWidth:g.maxWidth,whiteSpace:g.maxWidth?"nowrap":void 0,overflow:g.maxWidth?"hidden":void 0,textOverflow:g.maxWidth?"ellipsis":void 0},children:typeof g.render=="function"?g.render(R,d,a,g):typeof R=="boolean"?e.jsx(Te,{checked:R,disabled:!0,size:"small",sx:{m:0,p:0,color:"var(--table-text-color)","&.Mui-disabled":{color:"var(--table-text-color)",opacity:.7}}}):g.format&&typeof R=="number"?g.format(R):R!=null?String(R):null},g.id)})},d)})})]})}),(y||m)&&e.jsxs("div",{className:"MbfWindowFooter",style:{height:"30px",minHeight:"30px",justifyContent:"space-between",border:"none"},children:[e.jsx("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)"},children:y}),e.jsx("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)"},children:m})]})]})}function rn(i){return r.memo(i)}const mt=rn(tn);function on({storeId:i,setStoreId:u}){const{online:c,sendMessage:o,addListener:l,removeListener:y,getUniqueId:m}=r.useContext(me),{showConfirmCancelDialog:t}=r.useContext(Be),x=r.useRef(m()),[N,p]=r.useState(null),[j,O]=r.useState(null),[$,P]=r.useState([]),U=[{label:"Name",id:"name",required:!0,render:(M,E,W,D)=>e.jsx(T,{title:"Open the plugin homepage",children:e.jsx("span",{style:{cursor:"pointer"},onClick:()=>a(W),children:W.name})})},{label:"Description",id:"description",render:(M,E,W,D)=>e.jsx(T,{title:"Open the plugin homepage",children:e.jsx("span",{style:{cursor:"pointer"},onClick:()=>a(W),children:W.description})})},{label:"Version",id:"version",render:(M,E,W,D)=>e.jsxs(e.Fragment,{children:[W.latestVersion!==void 0&&W.latestVersion!==W.version&&j&&!j.readOnly&&e.jsx(T,{title:"New plugin stable version available, click to install",children:e.jsxs("span",{className:"status-warning",style:{marginRight:"10px"},onClick:()=>C(W),children:["Update to v.",W.latestVersion]})}),W.version.includes("-dev-")&&W.devVersion!==void 0&&W.devVersion!==W.version&&j&&!j.readOnly&&e.jsx(T,{title:"New plugin dev version available, click to install",children:e.jsxs("span",{className:"status-warning",style:{marginRight:"10px"},onClick:()=>L(W),children:["Update to new dev v.",W.devVersion.split("-dev-")[0]]})}),e.jsx(T,{title:"Plugin version",children:e.jsx("span",{children:W.version})})]})},{label:"Author",id:"author",render:(M,E,W,D)=>e.jsx(e.Fragment,{children:W.author?W.author.replace("https://github.com/",""):"Unknown"})},{label:"Type",id:"type",render:(M,E,W,D)=>e.jsx(e.Fragment,{children:W.type?W.type.replace("Platform",""):"Unknown"})},{label:"Devices",id:"registeredDevices"},{label:"Actions",id:"actions",required:!0,noSort:!0,render:(M,E,W,D)=>e.jsxs("div",{style:{margin:"0px",padding:"0px",gap:"4px",display:"flex",flexDirection:"row"},children:[j&&j.bridgeMode==="childbridge"&&!W.error&&W.enabled&&e.jsx(T,{title:"Shows the QRCode or the fabrics",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0",padding:"0",width:"19px",height:"19px",color:Qt(W.matter)},onClick:()=>{W.matter?.id&&u(W.matter?.id)},size:"small",children:e.jsx(At,{})})}),j&&j.bridgeMode==="childbridge"&&!W.error&&W.enabled&&e.jsx(T,{title:"Restart the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0",padding:"0",width:"19px",height:"19px"},onClick:()=>G(W),size:"small",children:e.jsx(dt,{})})}),e.jsx(T,{title:"Plugin config",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{disabled:W.restartRequired===!0,style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>ye(W),size:"small",children:e.jsx(vt,{})})}),j&&!j.readOnly&&e.jsx(T,{title:"Remove the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>{V("Remove plugin","Are you sure? This will also remove all devices and configuration from the controller.","remove",W)},size:"small",children:e.jsx(ut,{})})}),W.enabled?e.jsx(T,{title:"Disable the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>{V("Disable plugin","Are you sure? This will also remove all devices and configuration from the controller.","disable",W)},size:"small",children:e.jsx(wr,{})})}):e.jsx(e.Fragment,{}),W.enabled?e.jsx(e.Fragment,{}):e.jsx(T,{title:"Enable the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>A(W),size:"small",children:e.jsx(Sr,{})})}),e.jsx(T,{title:"Open the plugin help",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>d(W),size:"small",children:e.jsx(Mr,{})})}),e.jsx(T,{title:"Open the plugin version history",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>g(W),size:"small",children:e.jsx(kr,{})})}),j&&!j.readOnly&&e.jsx(T,{title:"Sponsor the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0",padding:"0",width:"19px",height:"19px",color:"#b6409c"},onClick:()=>s(W),size:"small",children:e.jsx(Vt,{})})})]})},{label:"Status",id:"status",required:!0,noSort:!0,render:(M,E,W,D)=>e.jsx("div",{style:{display:"flex",flexDirection:"row",flex:"1 1 auto",margin:"0",padding:"0",gap:"5px",width:"auto",maxWidth:"max-content"},children:W.error?e.jsx(e.Fragment,{children:e.jsx(Ee,{status:!1,enabledText:"Error",disabledText:"Error",tooltipText:"The plugin is in error state. Check the log!"})}):e.jsx(e.Fragment,{children:W.enabled===!1?e.jsx(e.Fragment,{children:e.jsx(Ee,{status:W.enabled,enabledText:"Enabled",disabledText:"Disabled",tooltipText:"Whether the plugin is enable or disabled"})}):e.jsx(e.Fragment,{children:W.loaded&&W.started&&W.configured?e.jsx(e.Fragment,{children:e.jsx(Ee,{status:W.loaded,enabledText:"Running",tooltipText:"Whether the plugin is running"})}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{status:W.loaded,enabledText:"Loaded",tooltipText:"Whether the plugin has been loaded"}),e.jsx(Ee,{status:W.started,enabledText:"Started",tooltipText:"Whether the plugin started"}),e.jsx(Ee,{status:W.configured,enabledText:"Configured",tooltipText:"Whether the plugin has been configured"})]})})})})}];r.useEffect(()=>{const M=E=>{E.src==="Matterbridge"&&E.dst==="Frontend"&&(E.method==="refresh_required"&&E.response.changed==="plugins"&&(n&&console.log(`HomePlugins received refresh_required: changed=${E.response.changed} and sending /api/plugins request`),o({id:x.current,sender:"HomePlugins",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})),E.method==="refresh_required"&&E.response.changed==="matter"&&(n&&console.log(`HomePlugins received refresh_required: changed=${E.response.changed} and setting matter id ${E.response.matter?.id}`),P(W=>{const D=W.findIndex(F=>F.matter?.id===E.response.matter?.id);if(D<0)return n&&console.log(`HomePlugins received refresh_required: changed=${E.response.changed} and matter id ${E.response.matter?.id} not found`),W;n&&console.log(`HomePlugins received refresh_required: changed=${E.response.changed} set matter id ${E.response.matter?.id}`);const S=[...W];return S[D]={...S[D],matter:E.response.matter},S})),E.method==="refresh_required"&&E.response.changed==="settings"&&(n&&console.log(`HomePlugins received refresh_required: changed=${E.response.changed} and sending /api/settings request`),o({id:x.current,sender:"HomePlugins",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),E.id===x.current&&E.method==="/api/settings"&&(n&&console.log(`HomePlugins (id: ${E.id}) received settings:`,E.response),p(E.response.systemInformation),O(E.response.matterbridgeInformation)),E.id===x.current&&E.method==="/api/plugins"&&(n&&console.log(`HomePlugins (id: ${E.id}) received ${E.response.length} plugins:`,E.response),P(E.response)))};return l(M,x.current),n&&console.log("HomePlugins added WebSocket listener id:",x.current),()=>{y(M),n&&console.log("HomePlugins removed WebSocket listener")}},[l,y,o]),r.useEffect(()=>{c&&(n&&console.log("HomePlugins sending api requests"),o({id:x.current,sender:"HomePlugins",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),o({id:x.current,sender:"HomePlugins",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[c,o]);const h=r.useRef(null),V=(M,E,W,D)=>{n&&console.log(`handleActionWithConfirmCancel ${W} ${D.name}`),h.current=D,t(M,E,W,b,v)},b=M=>{n&&console.log(`handleConfirm action confirmed ${M} ${h.current?.name}`),M==="remove"&&h.current?w(h.current):M==="disable"&&h.current&&A(h.current),h.current=null},v=M=>{n&&console.log(`handleCancel action canceled ${M} ${h.current?.name}`),h.current=null},C=M=>{n&&console.log("handleUpdatePlugin plugin:",M.name),o({id:x.current,sender:"HomePlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:M.name,restart:!1}})},L=M=>{n&&console.log("handleUpdateDevPlugin plugin:",M.name),o({id:x.current,sender:"HomePlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:M.name+"@dev",restart:!1}})},w=M=>{n&&console.log("handleRemovePlugin plugin:",M.name),o({id:x.current,sender:"HomePlugins",method:"/api/removeplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:M.name}})},G=M=>{n&&console.log("handleRestartPlugin plugin:",M.name),o({id:x.current,sender:"HomePlugins",method:"/api/restartplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:M.name}})},A=M=>{n&&console.log("handleEnableDisablePlugin plugin:",M.name,"enabled:",M.enabled),M.enabled===!0?(M.enabled=!1,o({id:x.current,sender:"HomePlugins",method:"/api/disableplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:M.name}})):(M.enabled=!0,o({id:x.current,sender:"HomePlugins",method:"/api/enableplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:M.name}}))},a=M=>{n&&console.log(`handleHomepagePlugin plugin: ${M.name} homepage: ${M.homepage}`),M.homepage&&window.open(M.homepage,"_blank")},s=M=>{n&&console.log("handleSponsorPlugin plugin:",M.name,"funding:",M.funding),M.funding&&window.open(M.funding,"_blank")},d=M=>{n&&console.log("handleHelpPlugin plugin:",M.name,"help:",M.help),M.help&&window.open(M.help,"_blank")},g=M=>{n&&console.log("handleChangelogPlugin plugin:",M.name,"changelog:",M.changelog),M.changelog&&window.open(M.changelog,"_blank")},[R,pe]=r.useState(),[Ce,we]=r.useState(!1),ye=M=>{n&&console.log("handleConfigPlugin plugin:",M.name),o({id:x.current,sender:"HomePlugins",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:M.name}}),o({id:x.current,sender:"HomePlugins",method:"/api/select/entities",src:"Frontend",dst:"Matterbridge",params:{plugin:M.name}}),pe(M),X()},X=()=>{we(!0)},ie=()=>{we(!1)};return n&&console.log("HomePlugins rendering..."),c?e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",width:"100%",flex:"0 0 auto",overflow:"hidden"},children:[R&&e.jsx(Zo,{open:Ce,onClose:ie,plugin:R}),e.jsx(mt,{name:"Plugins",columns:U,rows:$,footerRight:"",footerLeft:""})]}):e.jsx($e,{})}const nn=r.memo(on),sn=i=>`${i.pluginName}::${i.serial}`;function an({storeId:i,setStoreId:u}){const{online:c,sendMessage:o,addListener:l,removeListener:y,getUniqueId:m}=r.useContext(me),[t,x]=r.useState(!1),[N,p]=r.useState(!0),[j,O]=r.useState(null),[$,P]=r.useState([]),[U,h]=r.useState([]),[V,b]=r.useState([]),[v,C]=r.useState([]),L=r.useRef(m()),w=[{label:"Plugin",id:"pluginName"},{label:"Name",id:"name",required:!0},{label:"Serial",id:"serial"},{label:"Availability",id:"availability",render:(a,s,d,g)=>d.reachable===!0?"Online":d.reachable===!1?e.jsx("span",{style:{color:"red"},children:"Offline"}):"",comparator:(a,s)=>{const d=a.reachable===!0?1:a.reachable===!1?0:-1,g=s.reachable===!0?1:s.reachable===!1?0:-1;return d-g}},{label:"Power",id:"powerSource",render:(a,s,d,g)=>d.powerSource==="ac"||d.powerSource==="dc"?e.jsx(_t,{fontSize:"small",sx:{color:"var(--primary-color)"}}):d.powerSource==="ok"?e.jsx(pt,{fontSize:"small",sx:{color:"green"}}):d.powerSource==="warning"?e.jsx(pt,{fontSize:"small",sx:{color:"yellow"}}):d.powerSource==="critical"?e.jsx(pt,{fontSize:"small",sx:{color:"red"}}):e.jsx("span",{})},{label:"Url",id:"configUrl"},{label:"Actions",id:"selected",required:!0,render:(a,s,d,g)=>e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[d.matter!==void 0?e.jsx(T,{title:"Show the QRCode or the fabrics",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{onClick:()=>u(i===d.matter?.id?j?.matterbridgeInformation.bridgeMode==="bridge"?"Matterbridge":null:d.matter?.id||null),"aria-label":"Show the QRCode",sx:{margin:0,padding:0,color:Qt(d.matter)},children:e.jsx(At,{fontSize:"small"})})}):e.jsx("div",{style:{width:"20px",height:"20px"}}),d.configUrl?e.jsx(T,{title:"Open the configuration page",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{onClick:()=>window.open(d.configUrl,"_blank"),"aria-label":"Open config url",sx:{margin:0,padding:0},children:e.jsx(vt,{fontSize:"small"})})}):e.jsx("div",{style:{width:"20px",height:"20px"}}),d.selected!==void 0?e.jsx(T,{title:"Select/unselect the device",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Te,{checked:d.selected,onChange:R=>A(R,d),sx:{margin:"0",marginLeft:"8px",padding:"0"},size:"small"})}):e.jsx("div",{style:{width:"20px",height:"20px"}})]})}],G=r.useCallback(a=>{a.selected=void 0;const s=$.find(R=>R.name===a.pluginName);if(!s)return console.error(`HomeDevices isSelected: plugin ${a.pluginName} not found for device ${a.name} `),a.selected;const d=s.schemaJson?.properties?.whiteList?.selectFrom;let g=s.configJson.postfix;return g===""&&(g=void 0),s.hasWhiteList===!0&&s.hasBlackList===!0&&d&&(a.selected=!0,d==="serial"&&s.configJson.whiteList&&s.configJson.whiteList.length>0&&s.configJson.whiteList.includes(g?a.serial.replace("-"+g,""):a.serial)&&(a.selected=!0),d==="serial"&&s.configJson.whiteList&&s.configJson.whiteList.length>0&&!s.configJson.whiteList.includes(g?a.serial.replace("-"+g,""):a.serial)&&(a.selected=!1),d==="serial"&&s.configJson.blackList&&s.configJson.blackList.length>0&&s.configJson.blackList.includes(g?a.serial.replace("-"+g,""):a.serial)&&(a.selected=!1),d==="name"&&s.configJson.whiteList&&s.configJson.whiteList.length>0&&s.configJson.whiteList.includes(a.name)&&(a.selected=!0),d==="name"&&s.configJson.whiteList&&s.configJson.whiteList.length>0&&!s.configJson.whiteList.includes(a.name)&&(a.selected=!1),d==="name"&&s.configJson.blackList&&s.configJson.blackList.length>0&&s.configJson.blackList.includes(a.name)&&(a.selected=!1)),a.selected},[$]);r.useEffect(()=>{const a=s=>{if(s.src==="Matterbridge"&&s.dst==="Frontend"){if(s.method==="refresh_required"&&s.response.changed!=="matter"&&(n&&console.log(`HomeDevices received refresh_required: changed=${s.response.changed} and sending /api/plugins request`),o({id:L.current,sender:"HomeDevices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})),s.method==="refresh_required"&&s.response.changed==="matter"&&(n&&console.log(`HomeDevices received refresh_required: changed=${s.response.changed} and setting matter id ${s.response.matter?.id}`),C(d=>{const g=d.findIndex(pe=>pe.name.replaceAll(" ","")===s.response.matter?.id);if(g<0)return n&&console.debug(`HomeDevices: matter id ${s.response.matter?.id} not found`),d;const R=[...d];return R[g]={...R[g],matter:s.response.matter},n&&console.log(`HomeDevices received refresh_required: changed=${s.response.changed} and set matter id ${s.response.matter?.id}`),R})),s.method==="restart_required"&&(n&&console.log("HomeDevices received restart_required"),x(!0)),s.method==="restart_not_required"&&(n&&console.log("HomeDevices received restart_not_required"),x(!1)),s.method==="state_update"&&s.response.plugin&&s.response.serialNumber&&s.response.cluster.includes("BasicInformationServer")&&s.response.attribute==="reachable"&&(console.log(`HomeDevices updating device reachability for plugin ${s.response.plugin} serial ${s.response.serialNumber} value ${s.response.value}`),h(d=>d.map(g=>g.pluginName===s.response.plugin&&g.serial===s.response.serialNumber?{...g,reachable:s.response.value}:g))),s.id===L.current&&s.method==="/api/settings"&&(n&&console.log(`HomeDevices (id: ${s.id}) received settings:`,s.response),O(s.response),x(s.response.matterbridgeInformation.restartRequired||s.response.matterbridgeInformation.fixedRestartRequired)),s.id===L.current&&s.method==="/api/plugins"&&(n&&console.log(`HomeDevices (id: ${s.id}) received ${s.response?.length} plugins:`,s.response),s.response)){let d=!0;for(const g of s.response)g.enabled===!0&&(g.loaded!==!0||g.started!==!0||g.error===!0)&&(d=!1);if(!d)return;n&&console.log("HomeDevices reset plugins, devices and selectDevices"),p(!1),P(s.response),h([]),b([]),o({id:L.current,sender:"HomeDevices",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}}),n&&console.log("HomeDevices sent /api/devices");for(const g of s.response)g.enabled===!0&&g.loaded===!0&&g.started===!0&&g.error!==!0&&(o({id:L.current,sender:"HomeDevices",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:g.name}}),n&&console.log(`HomeDevices sent /api/select/devices for plugin: ${g.name}`))}if(s.id===L.current&&s.method==="/api/devices"&&(n&&console.log(`HomeDevices (id: ${s.id}) received ${s.response?.length} devices:`,s.response),s.response)){for(const d of s.response)d.selected=G(d);h(s.response)}s.id===L.current&&s.method==="/api/select/devices"&&(n&&console.log(`HomeDevices (id: ${s.id}) received ${s.response?.length} selectDevices for plugin ${s.response&&s.response.length>0?s.response[0].pluginName:"without select devices"}:`,s.response),s.response&&s.response.length>0&&b(d=>{const g=d.filter(pe=>pe.pluginName!==s.response[0].pluginName),R=s.response.map(pe=>({...pe,selected:G(pe)}));return[...g,...R]}))}};return l(a,L.current),n&&console.log(`HomeDevices added WebSocket listener id ${L.current}`),()=>{y(a),n&&console.log("HomeDevices removed WebSocket listener")}},[$,l,y,o,G]),r.useEffect(()=>{if(U.length===0&&V.length===0){C([]);return}n&&console.log(`HomeDevices mixing devices (${U.length}) and selectDevices (${V.length})`);const a=[];for(const s of U)a.push(s);for(const s of V)U.find(d=>d.pluginName===s.pluginName&&d.serial.includes(s.serial))||a.push(s);a.length>0&&(C(a),n&&console.log(`HomeDevices mixed ${a.length} devices and selectDevices`))},[$,U,V,C]),r.useEffect(()=>{c&&(n&&console.log("HomeDevices sending /api/settings and /api/plugins requests"),o({id:L.current,sender:"HomeDevices",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),o({id:L.current,sender:"HomeDevices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[c,o]);const A=(a,s)=>{console.log(`handleCheckboxChange: checkbox changed to ${a.target.checked} for device ${s.name} serial ${s.serial}`),C(d=>{const g=d.findIndex(pe=>pe.pluginName===s.pluginName&&pe.serial===s.serial);if(g<0)return console.error(`handleCheckboxChange: device not found ${s.name} serial ${s.serial}`),d;const R=[...d];return R[g]={...R[g],selected:a.target.checked},R}),a.target.checked?o({id:L.current,sender:"HomeDevices",method:"/api/command",src:"Frontend",dst:"Matterbridge",params:{command:"selectdevice",plugin:s.pluginName,serial:s.serial,name:s.name}}):o({id:L.current,sender:"HomeDevices",method:"/api/command",src:"Frontend",dst:"Matterbridge",params:{command:"unselectdevice",plugin:s.pluginName,serial:s.serial,name:s.name}})};return n&&console.log("HomeDevices rendering..."),c?e.jsx("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",width:"100%",flex:"1 1 auto",overflow:"hidden"},children:e.jsx(mt,{name:"Devices",getRowKey:sn,rows:v,columns:w,footerLeft:N?"Waiting for the plugins to fully load...":`Registered devices: ${U.length.toString()}/${v.length.toString()}`,footerRight:t?"Restart required":""})}):e.jsx($e,{})}const ln=r.memo(an);function dn(){const[i,u]=r.useState(null),[c,o]=r.useState(null),[l,y]=r.useState([]),[m]=r.useState(localStorage.getItem("homePagePlugins")!=="false"),[t,x]=r.useState(localStorage.getItem("homePageMode")??"devices"),[N,p]=r.useState(""),[j,O]=r.useState(!1),[$,P]=r.useState(!1),[U,h]=r.useState(null),{addListener:V,removeListener:b,online:v,sendMessage:C,logFilterLevel:L,logFilterSearch:w,autoScroll:G,getUniqueId:A}=r.useContext(me),a=r.useRef(A());return r.useEffect(()=>{const s=d=>{d.src==="Matterbridge"&&d.dst==="Frontend"&&(d.method==="refresh_required"&&d.response.changed==="settings"&&(n&&console.log(`Home received refresh_required: changed=${d.response.changed} and sending /api/settings request`),h(null),y([]),C({id:a.current,sender:"Home",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),C({id:a.current,sender:"Home",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})),d.method==="/api/settings"&&d.id===a.current&&(n&&console.log("Home received settings:",d.response),u(d.response.systemInformation),o(d.response.matterbridgeInformation),d.response.matterbridgeInformation.bridgeMode==="bridge"&&(U||h("Matterbridge")),d.response.matterbridgeInformation.bridgeMode==="childbridge"&&l.length>0&&U===null&&!U&&l.length>0&&l[0].matter?.id&&h(l[0].matter.id),d.response.matterbridgeInformation.matterbridgeVersion&&p(`https://github.com/Luligu/matterbridge/blob/${d.response.matterbridgeInformation.matterbridgeVersion.includes("-dev-")?"dev":"main"}/CHANGELOG.md`),localStorage.getItem("frontendVersion")===null&&d.response.matterbridgeInformation.frontendVersion?localStorage.setItem("frontendVersion",d.response.matterbridgeInformation.frontendVersion):d.response.matterbridgeInformation.frontendVersion!==localStorage.getItem("frontendVersion")&&d.response.matterbridgeInformation.frontendVersion&&(localStorage.setItem("frontendVersion",d.response.matterbridgeInformation.frontendVersion),P(!0)),localStorage.getItem("matterbridgeVersion")===null?localStorage.setItem("matterbridgeVersion",d.response.matterbridgeInformation.matterbridgeVersion):d.response.matterbridgeInformation.matterbridgeVersion!==localStorage.getItem("matterbridgeVersion")&&(localStorage.setItem("matterbridgeVersion",d.response.matterbridgeInformation.matterbridgeVersion),O(!0)),d.response.matterbridgeInformation.shellyBoard&&(localStorage.getItem("homePageMode")||(localStorage.setItem("homePageMode","devices"),x("devices")))),d.method==="/api/plugins"&&d.id===a.current&&(n&&console.log(`Home received plugins (${c?.bridgeMode}):`,d.response),y(d.response),c?.bridgeMode==="childbridge"&&d.response.length>0&&!U&&d.response.length>0&&d.response[0].matter?.id&&h(d.response[0].matter.id)))};return V(s,a.current),n&&console.log(`Home added WebSocket listener id ${a.current}`),()=>{b(s),n&&console.log("Home removed WebSocket listener")}},[V,b,C,c,l,U]),r.useEffect(()=>{v&&(n&&console.log("Home received online"),C({id:a.current,sender:"Home",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),C({id:a.current,sender:"Home",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[v,C]),n&&console.log("Home rendering..."),!v||!i||!c?e.jsx($e,{}):e.jsxs("div",{className:"MbfPageDiv",style:{flexDirection:"row"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",width:"302px",minWidth:"302px",gap:"20px"},children:[e.jsx(Qo,{id:U}),e.jsx(zo,{systemInfo:i,compact:!0})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",width:"100%",gap:"20px"},children:[$&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Frontend Update"})}),e.jsxs("div",{className:"MbfWindowBody",style:{flexDirection:"row",justifyContent:"space-between"},children:[e.jsx("h4",{style:{margin:0},children:"The frontend has been updated. You are viewing an outdated web UI. Please refresh the page now."}),e.jsx("div",{children:e.jsx(ae,{onClick:()=>window.location.reload(),endIcon:e.jsx(Ir,{}),style:{marginLeft:"10px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Refresh"})})]})]}),j&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge Update"})}),e.jsxs("div",{className:"MbfWindowBody",style:{flexDirection:"row",justifyContent:"space-between"},children:[e.jsx("h4",{style:{margin:0},children:"Matterbridge has been updated."}),e.jsxs("div",{children:[e.jsx(ae,{onClick:()=>window.open(N,"_blank"),endIcon:e.jsx(Et,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Changelog"}),e.jsx(ae,{onClick:()=>window.location.reload(),endIcon:e.jsx(Dr,{}),style:{marginLeft:"10px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Close"})]})]})]}),m&&!c.readOnly&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Install plugins"})}),e.jsx(Jo,{})]}),m&&e.jsx(nn,{storeId:U,setStoreId:h}),t==="devices"&&e.jsx(ln,{storeId:U,setStoreId:h}),t==="logs"&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"1 1 auto",width:"100%",overflow:"hidden"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",minHeight:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",children:"Logs"}),e.jsx("div",{className:"MbfWindowHeaderText",style:{display:"flex",justifyContent:"space-between"},children:e.jsxs("span",{style:{fontWeight:"normal",fontSize:"12px",marginTop:"2px"},children:['Filter: logger level "',L,'" and search "',w,'" Scroll: ',G?"auto":"manual"]})})]}),e.jsx("div",{style:{flex:"1 1 auto",margin:"0px",padding:"10px",overflow:"auto"},children:e.jsx(Bt,{})})]})]})]})}const cn=r.memo(dn),Ht={display:"flex",gap:"2px",justifyContent:"space-evenly",width:"100%",height:"40px"},pn={margin:"0",padding:"0",fontSize:"36px",fontWeight:"medium",color:"var(--primary-color)"},un={margin:"0",padding:"0",fontSize:"20px",fontWeight:"medium",color:"var(--div-text-color)",textAlign:"center"},Ot={margin:"0",padding:"0",paddingBottom:"2px",fontSize:"16px",fontWeight:"medium",color:"var(--div-text-color)",textAlign:"center"},gn={display:"flex",gap:"2px",justifyContent:"center",width:"100%",height:"18px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},mn={margin:"0",padding:"0",fontSize:"12px",fontWeight:"normal",color:"var(--div-text-color)"},hn={display:"flex",justifyContent:"center",width:"100%",height:"52px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},fn={margin:"0",padding:"0",fontSize:"14px",fontWeight:"bold",color:"var(--div-text-color)"},xn={display:"flex",gap:"4px",justifyContent:"center",width:"100%",height:"15px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},bt={margin:"0",padding:"0px 4px",borderRadius:"5px",textAlign:"center",fontSize:"12px",fontWeight:"normal",color:"var(--secondary-color)"},bn=[256,257,268,269],vn=[266,267],yn=[259,260,261,271,272],jn=[256,257,268,269,266,267,259,260,261];function q({icon:i,iconColor:u,cluster:c,value:o,unit:l,prefix:y}){return n&&console.log(`Render cluster "${c.clusterName}.${c.attributeName}" value(${typeof o}-${isNaN(o)}) "${o}" unit "${l}"`),y=y??!1,e.jsxs(Y,{sx:Ht,children:[i&&r.cloneElement(i,{key:`${c.clusterId}-${c.attributeId}-icon`,sx:{...pn,color:u??"var(--primary-color)"}}),e.jsxs(Y,{sx:{...Ht,gap:"4px",alignContent:"center",alignItems:"end",justifyContent:"center"},children:[l&&y===!0&&e.jsx(se,{sx:Ot,children:l},`${c.clusterId}-${c.attributeId}-unit`),e.jsx(se,{sx:un,children:o==null||typeof o=="number"&&isNaN(o)||o==="NaN"?"---":o},`${c.clusterId}-${c.attributeId}-value`),l&&y===!1&&e.jsx(se,{sx:Ot,children:l},`${c.clusterId}-${c.attributeId}-unit`)]},`${c.clusterId}-${c.attributeId}-valueunitbox`)]},`${c.clusterId}-${c.attributeId}-box`)}function Cn({device:i,endpoint:u,id:c,deviceType:o,clusters:l}){const y=["Unknown","Good","Fair","Moderate","Poor","VeryPoor","Ext.Poor"];let m="";return n&&console.log(`Device "${i.name}" endpoint "${u}" id "${c}" deviceType "0x${o.toString(16).padStart(4,"0")}" clusters (${l?.length}):`,l),o===17&&l.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="batVoltage").map(t=>m=`${t.attributeLocalValue} mV`),jn.includes(o)&&l.filter(t=>t.clusterName==="LevelControl"&&t.attributeName==="currentLevel").map(t=>m=`Level ${t.attributeValue}`),o===514&&l.filter(t=>t.clusterName==="WindowCovering"&&t.attributeName==="currentPositionLiftPercent100ths").map(t=>m=`Position ${t.attributeLocalValue/100}%`),o===769&&l.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="occupiedHeatingSetpoint").map(t=>m=`Heat ${t.attributeLocalValue/100}°C `),o===769&&l.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="occupiedCoolingSetpoint").map(t=>m=m+`Cool ${t.attributeLocalValue/100}°C`),o===118&&l.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="coState").map(t=>m=`${t.attributeLocalValue===0?"No CO detected":"CO alarm!"}`),o===1296&&l.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="voltage").map(t=>m=`${t.attributeLocalValue/1e3} V, `),o===1296&&l.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="activeCurrent").map(t=>m=m+`${t.attributeLocalValue/1e3} A, `),o===1296&&l.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="activePower").map(t=>m=m+`${t.attributeLocalValue/1e3} W`),e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0px",padding:"5px",width:"150px",height:"150px",borderColor:"var(--div-bg-color)",borderRadius:"5px",justifyContent:"space-between"},children:[o===19&&l.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(q,{icon:t.attributeLocalValue===!0?e.jsx(Ge,{}):e.jsx(Nr,{}),iconColor:t.attributeLocalValue===!0?"green":"red",cluster:t,value:t.attributeLocalValue===!0?"Online":"Offline"})),o===17&&l.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="batPercentRemaining").map(t=>e.jsx(q,{icon:e.jsx(pt,{}),cluster:t,value:t.attributeLocalValue/2,unit:"%"})),o===17&&l.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="wiredCurrentType").map(t=>e.jsx(q,{icon:e.jsx(_t,{}),cluster:t,value:t.attributeLocalValue===0?"AC":"DC"})),o===1293&&l.filter(t=>t.clusterName==="DeviceEnergyManagement"&&t.attributeName==="esaState").map(t=>e.jsx(q,{icon:e.jsx(re,{path:lo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Offline":"Online"})),bn.includes(o)&&l.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(q,{icon:e.jsx(Pr,{}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),vn.includes(o)&&l.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(q,{icon:e.jsx(re,{path:co,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),yn.includes(o)&&l.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(q,{icon:e.jsx(re,{path:po,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),o===115&&l.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(q,{icon:e.jsx(re,{path:uo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),o===124&&l.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(q,{icon:e.jsx(re,{path:go,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),o===117&&l.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(q,{icon:e.jsx(re,{path:mo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),o===123&&l.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(q,{icon:e.jsx(Dt,{}),cluster:t,value:"Oven"})),o===112&&l.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(q,{icon:e.jsx(Wr,{}),cluster:t,value:"Fridge"})),o===113&&l.filter(t=>t.clusterName==="TemperatureControl"&&t.attributeName==="selectedTemperatureLevel").map(t=>e.jsx(q,{icon:e.jsx(re,{path:ho,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),o===121&&l.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(q,{icon:e.jsx(Dt,{}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),o===122&&l.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="fanMode").map(t=>e.jsx(q,{icon:e.jsx(re,{path:fo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),o===120&&l.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(q,{icon:e.jsx(re,{path:Lt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Cooktop"})),o===119&&l.filter(t=>t.clusterName==="TemperatureControl"&&t.attributeName==="selectedTemperatureLevel").map(t=>e.jsx(q,{icon:e.jsx(re,{path:Lt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),o===116&&l.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(q,{icon:e.jsx(re,{path:xo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Robot"})),o===514&&l.filter(t=>t.clusterName==="WindowCovering"&&t.attributeName==="currentPositionLiftPercent100ths").map(t=>e.jsx(q,{icon:e.jsx(Fr,{}),cluster:t,value:t.attributeLocalValue/100,unit:"%"})),o===769&&l.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="localTemperature").map(t=>e.jsx(q,{icon:e.jsx(re,{path:bo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:(t.attributeLocalValue??0)/100,unit:"°C"})),o===10&&l.filter(t=>t.clusterName==="DoorLock"&&t.attributeName==="lockState").map(t=>e.jsx(q,{icon:t.attributeValue==="1"?e.jsx(Lr,{}):e.jsx(Tr,{}),cluster:t,value:t.attributeValue==="1"?"Locked":"Unlocked"})),o===43&&l.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="percentCurrent").map(t=>e.jsx(q,{icon:e.jsx($r,{}),cluster:t,value:t.attributeValue,unit:"%"})),o===15&&l.filter(t=>t.clusterName==="Switch"&&t.attributeName==="currentPosition").map(t=>e.jsx(q,{icon:e.jsx(re,{path:vo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeValue,unit:"pos",prefix:!0})),o===39&&l.filter(t=>t.clusterName==="ModeSelect"&&t.attributeName==="currentMode").map(t=>e.jsx(q,{icon:e.jsx(Rr,{}),cluster:t,value:t.attributeValue,unit:"mode",prefix:!0})),o===771&&l.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(q,{icon:e.jsx(Hr,{}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),o===45&&l.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="percentCurrent").map(t=>e.jsx(q,{icon:e.jsx(Nt,{}),cluster:t,value:t.attributeValue,unit:"%"})),o===114&&l.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="localTemperature").map(t=>e.jsx(q,{icon:e.jsx(Nt,{}),cluster:t,value:(t.attributeLocalValue??0)/100,unit:"°C"})),o===67&&l.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(q,{icon:e.jsx(Or,{}),cluster:t,value:t.attributeLocalValue===!0?"Leak":"No leak"})),o===65&&l.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(q,{icon:e.jsx(Vr,{}),cluster:t,value:t.attributeLocalValue===!0?"Freeze":"No freeze"})),o===68&&l.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(q,{icon:e.jsx(Er,{}),cluster:t,value:t.attributeLocalValue===!0?"Rain":"No rain"})),o===1292&&l.filter(t=>t.clusterName==="EnergyEvse"&&t.attributeName==="state").map(t=>e.jsx(q,{icon:e.jsx(re,{path:yo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Free":"In use"})),o===1295&&l.filter(t=>t.clusterName==="WaterHeaterManagement"&&t.attributeName==="tankPercentage").map(t=>e.jsx(q,{icon:e.jsx(re,{path:jo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Tank "+(t.attributeLocalValue??0)+"%"})),o===777&&l.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="featureMap").map(t=>e.jsx(q,{icon:e.jsx(re,{path:Co,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"HeatPump"})),o===23&&l.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="featureMap").map(t=>e.jsx(q,{icon:e.jsx(re,{path:wo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Solar"})),o===24&&l.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="featureMap").map(t=>e.jsx(q,{icon:e.jsx(re,{path:So,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Inverter"})),o===118&&l.find(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="featureMap"&&t.attributeLocalValue.smokeAlarm===!0)&&l.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="smokeState").map(t=>e.jsx(q,{icon:e.jsx(re,{path:Tt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"No smoke":"Smoke!"})),o===118&&l.find(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="featureMap"&&t.attributeLocalValue.smokeAlarm===!1)&&l.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="coState").map(t=>e.jsx(q,{icon:e.jsx(re,{path:Tt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"No Co":"Co!"})),o===66&&l.filter(t=>t.clusterName==="ValveConfigurationAndControl"&&t.attributeName==="currentState").map(t=>e.jsx(q,{icon:e.jsx(Ar,{}),cluster:t,value:t.attributeLocalValue===0?"Closed":"Opened"})),o===44&&l.filter(t=>t.clusterName==="AirQuality"&&t.attributeName==="airQuality").map(t=>e.jsx(q,{icon:e.jsx(re,{path:Mo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:y[t.attributeLocalValue??0]})),o===770&&l.filter(t=>t.clusterName==="TemperatureMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(q,{icon:e.jsx(_r,{}),cluster:t,value:t.attributeLocalValue/100,unit:"°C"})),o===775&&l.filter(t=>t.clusterName==="RelativeHumidityMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(q,{icon:e.jsx(re,{path:ko,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue/100,unit:"%"})),o===774&&l.filter(t=>t.clusterName==="FlowMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(q,{icon:e.jsx(qr,{}),cluster:t,value:t.attributeLocalValue,unit:"l/h"})),o===773&&l.filter(t=>t.clusterName==="PressureMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(q,{icon:e.jsx(zr,{}),cluster:t,value:t.attributeLocalValue,unit:"hPa"})),o===21&&l.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(q,{icon:t.attributeValue==="true"?e.jsx(Ur,{}):e.jsx(Br,{}),cluster:t,value:t.attributeValue==="true"?"Closed":"Opened"})),o===263&&l.filter(t=>t.clusterName==="OccupancySensing"&&t.attributeName==="occupancy").map(t=>e.jsx(q,{icon:t.attributeValue==="{ occupied: true }"?e.jsx(Qr,{}):e.jsx(Kr,{}),cluster:t,value:t.attributeValue==="{ occupied: true }"?"Occupied":"Unocc."})),o===262&&l.filter(t=>t.clusterName==="IlluminanceMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(q,{icon:e.jsx(Jr,{}),cluster:t,value:Math.round(Math.pow(10,t.attributeLocalValue/1e4)),unit:"lx"})),o===1296&&l.filter(t=>t.clusterName==="ElectricalEnergyMeasurement"&&t.attributeName==="cumulativeEnergyImported").map(t=>e.jsx(q,{icon:e.jsx(Gr,{}),cluster:t,value:Math.round(t.attributeLocalValue?.energy/1e6),unit:"kwh"})),e.jsx(Y,{sx:gn,children:e.jsx(se,{sx:mn,children:m})}),e.jsx(Y,{sx:hn,children:e.jsx(se,{sx:fn,children:i.name})}),e.jsxs(Y,{sx:xn,children:[n&&e.jsx(se,{sx:bt,children:u}),e.jsx(se,{sx:bt,children:c}),n&&e.jsxs(se,{sx:bt,children:["0x",o.toString(16).padStart(4,"0")]})]})]})}function wn({filter:i}){const{online:u,sendMessage:c,addListener:o,removeListener:l,getUniqueId:y}=r.useContext(me),[m,t]=r.useState(null),[x,N]=r.useState([]),[p,j]=r.useState([]),[O,$]=r.useState(p),[P,U]=r.useState({}),[h,V]=r.useState({}),[b,v]=r.useState({}),C=r.useRef(y()),L=r.useRef(O),w=r.useCallback(A=>{console.log("DevicesIcons received state_update:",A.response);const a=L.current.find(d=>d.pluginName===A.response.plugin&&d.uniqueId===A.response.uniqueId);if(!a)return;console.log(`DevicesIcons found device "${a.name}" serial "${a.serial}"`);const s=b[a.serial].find(d=>d.clusterName+"Server"===A.response.cluster&&d.attributeName===A.response.attribute);console.log(`DevicesIcons found device "${a.name}" serial "${a.serial}" with cluster:`,s),s&&(s.attributeValue=String(A.response.value),s.attributeLocalValue=A.response.value,v({...b}),console.log(`DevicesIcons updated attribute ${s.clusterName}:${s.attributeName} for device "${a.name}" serial "${a.serial}" to "${s.attributeValue}"`))},[b]);r.useEffect(()=>{const A=a=>{if(a.method==="refresh_required")n&&console.log(`DevicesIcons received refresh_required: changed=${a.response.changed} and sending api requests`),c({id:C.current,sender:"Icons",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:C.current,sender:"Icons",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:C.current,sender:"Icons",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}});else if(a.method==="state_update"&&a.response)w(a);else if(a.method==="/api/settings"&&a.response)n&&console.log("DevicesIcons received settings:",a.response),t(a.response);else if(a.method==="/api/plugins"&&a.response)n&&console.log("DevicesIcons received plugins:",a.response),N(a.response);else if(a.method==="/api/devices"&&a.response){n&&console.log(`DevicesIcons received ${a.response.length} devices:`,a.response),j(a.response);for(const s of a.response)n&&console.log("DevicesIcons sending /api/clusters"),c({id:C.current,sender:"DevicesIcons",method:"/api/clusters",src:"Frontend",dst:"Matterbridge",params:{plugin:s.pluginName,endpoint:s.endpoint||0}})}else if(a.method==="/api/clusters"&&a.response){if(n&&console.log(`DevicesIcons received for device "${a.response.deviceName}" serial "${a.response.serialNumber}" deviceType ${a.response.deviceTypes.join(" ")} clusters (${a.response.clusters.length}):`,a.response),a.response.clusters.length===0)return;const s=a.response.serialNumber;P[s]=[],h[s]=a.response.deviceTypes,b[s]=[];for(const d of a.response.clusters)P[s].find(g=>g.endpoint===d.endpoint)||P[s].push({endpoint:d.endpoint,id:d.id,deviceTypes:d.deviceTypes}),!["FixedLabel","Descriptor","Identify","Groups","PowerTopology"].includes(d.clusterName)&&b[s].push(d);U({...P}),V({...h}),v({...b}),n&&console.log(`DevicesIcons endpoints for "${s}":`,P[s]),n&&console.log(`DevicesIcons deviceTypes for "${s}":`,h[s]),n&&console.log(`DevicesIcons clusters for "${s}":`,b[s])}};return o(A,C.current),n&&console.log("DevicesIcons useEffect webSocket mounted"),()=>{l(A),n&&console.log("DevicesIcons useEffect webSocket unmounted")}},[]),r.useEffect(()=>(n&&console.log("DevicesIcons useEffect online mounting"),u&&(n&&console.log("DevicesIcons useEffect online sending api requests"),c({id:C.current,sender:"DevicesIcons",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:C.current,sender:"DevicesIcons",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:C.current,sender:"DevicesIcons",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}})),n&&console.log("DevicesIcons useEffect online mounted"),()=>{n&&console.log("DevicesIcons useEffect online unmounted")}),[u,c]),r.useEffect(()=>{if(i===""){$(p),L.current=p;return}const A=p.filter(a=>a.name.toLowerCase().includes(i)||a.serial.toLowerCase().includes(i));$(A),L.current=A},[p,i]);const G=r.memo(Cn);return n&&console.log("DevicesIcons rendering..."),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",paddingBottom:"5px",gap:"20px",width:"100%",overflow:"auto"},children:O.map(A=>P[A.serial]&&P[A.serial].map(a=>a.deviceTypes.map(s=>e.jsx(G,{device:A,endpoint:a.endpoint,id:a.id,deviceType:s,clusters:b[A.serial].filter(d=>d.endpoint===a.endpoint)},`${A.pluginName}-${A.uniqueId}-${a.id}-${s.toString()}`))))})}const Sn=r.memo(wn),Mn=[{label:"Plugin name",id:"pluginName",required:!0},{label:"Device type",id:"type"},{label:"Endpoint",id:"endpoint",align:"right"},{label:"Name",id:"name",required:!0},{label:"Serial number",id:"serial"},{label:"Unique ID",id:"uniqueId"},{label:"Url",id:"configUrl"},{label:"Config",id:"configButton",noSort:!0,render:(i,u,c,o)=>c.configUrl?e.jsx(Q,{onClick:()=>window.open(c.configUrl,"_blank"),"aria-label":"Open Config",sx:{margin:0,padding:0},children:e.jsx(vt,{fontSize:"small"})}):null},{label:"Cluster",id:"cluster"}],kn=[{label:"Endpoint",id:"endpoint",required:!0},{label:"Id",id:"id"},{label:"Device Types",id:"deviceTypes",render:(i,u,c,o)=>Array.isArray(i)?e.jsx(e.Fragment,{children:i.map(l=>`0x${l.toString(16).padStart(4,"0")}`).join(", ")}):e.jsx(e.Fragment,{children:i})},{label:"Cluster Name",id:"clusterName",required:!0},{label:"Cluster ID",id:"clusterId"},{label:"Attribute Name",id:"attributeName",required:!0},{label:"Attribute ID",id:"attributeId"},{label:"Attribute Value",id:"attributeValue",required:!0,render:(i,u,c,o)=>e.jsx(T,{title:String(i),componentsProps:{tooltip:{sx:{fontSize:"14px",fontWeight:"normal",color:"#ffffff",backgroundColor:"var(--primary-color)"}}},children:e.jsx("div",{style:{maxWidth:"500px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:String(i)})})}],In=i=>`${i.pluginName}::${i.uniqueId}`,Dn=i=>`${i.endpoint}::${i.clusterName}::${i.attributeName}`;function Nn({filter:i}){const{online:u,sendMessage:c,addListener:o,removeListener:l,getUniqueId:y}=r.useContext(me),[m,t]=r.useState([]),[x,N]=r.useState(m),[p,j]=r.useState([]),[O,$]=r.useState(0),[P,U]=r.useState(null),[h,V]=r.useState(null),[b,v]=r.useState(null),[C,L]=r.useState(null),w=r.useRef(y()),G=r.useRef(x),A=r.useCallback(s=>{console.log("DevicesTable received state_update:",s.response);const d=G.current.find(g=>g.pluginName===s.response.plugin&&g.uniqueId===s.response.uniqueId);if(d&&(console.log(`DevicesTable found device "${d.name}" serial "${d.serial}"`),P&&h)){const g=p.find(R=>R.clusterName+"Server"===s.response.cluster&&R.attributeName===s.response.attribute);if(console.log(`DevicesTable found device "${d.name}" serial "${d.serial}" with cluster:`,g),!g)return;g.attributeValue=String(s.response.value),g.attributeLocalValue=s.response.value,j([...p]),console.log(`DevicesTable updated attribute ${g.clusterName}:${g.attributeName} for device "${d.name}" serial "${d.serial}" to "${g.attributeValue}"`)}},[p,h,P]);r.useEffect(()=>{const s=d=>{if(n&&console.log("DevicesTable received WebSocket Message:",d),d.method==="refresh_required"&&d.response.changed==="devices")n&&console.log(`DevicesTable received refresh_required: changed=${d.response.changed} and sending /api/devices request`),c({id:w.current,sender:"DevicesTable",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}});else if(d.method==="state_update"&&d.response)A(d);else if(d.method==="/api/devices")n&&console.log(`DevicesTable received ${d.response.length} devices:`,d.response),t(d.response);else if(d.method==="/api/clusters"){n&&console.log(`DevicesTable received ${d.response.clusters.length} clusters for plugin ${d.response.plugin}:`,d.response),j(d.response.clusters);const g={};for(const R of d.response.clusters)n&&console.log("Cluster:",R.endpoint),g[R.endpoint]?g[R.endpoint]++:g[R.endpoint]=1;$(Object.keys(g).length)}};return o(s,w.current),n&&console.log("DevicesTable added WebSocket listener"),()=>{l(s),n&&console.log("DevicesTable removed WebSocket listener")}},[c,o,l,A]),r.useEffect(()=>{u&&(n&&console.log("DevicesTable sending api requests with id ",w.current),c({id:w.current,sender:"DevicesTable",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:w.current,sender:"DevicesTable",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:w.current,sender:"DevicesTable",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}}))},[u,c]),r.useEffect(()=>{P&&h&&(n&&console.log("DevicesTable sending /api/clusters"),c({id:w.current,sender:"DevicesTable",method:"/api/clusters",src:"Frontend",dst:"Matterbridge",params:{plugin:P,endpoint:Number(h)}}))},[P,h,c]),r.useEffect(()=>{if(i===""){N(m),G.current=m;return}const s=m.filter(d=>d.name.toLowerCase().includes(i)||d.serial.toLowerCase().includes(i));N(s),G.current=s},[m,i]);const a=s=>{if(s.uniqueId===C){L(null),U(null),V(null),v(null);return}L(s.uniqueId),U(s.pluginName),V(s.endpoint?s.endpoint.toString():null),v(s.name)};return n&&console.log("DevicesTable rendering..."),u?e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",paddingBottom:"5px",gap:"20px",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",maxHeight:`${P&&h?"50%":"100%"}`,width:"100%",flex:"1 1 auto",overflow:"hidden"},children:e.jsx(mt,{name:"Registered devices",getRowKey:In,onRowClick:a,rows:x,columns:Mn,footerLeft:`Total devices: ${x.length.toString()}`})}),P&&h&&e.jsx("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",height:"50%",maxHeight:"50%",width:"100%",flex:"1 1 auto",overflow:"hidden"},children:e.jsx(mt,{name:"Clusters",title:b||"",getRowKey:Dn,rows:p,columns:kn,footerLeft:`Total child endpoints: ${O-1}`})})]}):e.jsx($e,{})}const Pn=r.memo(Nn);function Wn(){const{online:i}=r.useContext(me),[u,c]=r.useState(""),[o,l]=r.useState("icon");r.useEffect(()=>{const t=localStorage.getItem("devicesFilter");t&&c(t)},[]),r.useEffect(()=>{const t=localStorage.getItem("devicesViewMode");t&&l(t)},[]);const y=t=>{c(t.target.value.toLowerCase()),localStorage.setItem("devicesFilter",t.target.value.toLowerCase())},m=t=>{l(t),localStorage.setItem("devicesViewMode",t)};return n&&console.log("Devices rendering..."),i?e.jsxs("div",{className:"MbfPageDiv",children:[e.jsxs("div",{className:"MbfWindowBodyRow",style:{justifyContent:"space-between",padding:0,gap:"20px",width:"100%",height:"45px",minHeight:"45px",maxHeight:"45px"},children:[e.jsxs(Y,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx(se,{sx:{fontSize:"16px",fontWeight:"normal",color:"var(--div-text-color)",marginLeft:"5px",whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(de,{variant:"outlined",value:u,onChange:y,placeholder:"Enter the device name or serial number",sx:{width:"320px"},InputProps:{style:{backgroundColor:"var(--main-bg-color)"}}})]}),e.jsxs(Y,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx(se,{sx:{fontSize:"16px",fontWeight:"normal",color:"var(--div-text-color)",marginLeft:"5px",whiteSpace:"nowrap"},children:"View mode:"}),e.jsx(Q,{onClick:()=>m("table"),"aria-label":"Table View",disabled:o==="table",children:e.jsx(T,{title:"Table View",children:e.jsx(Yr,{style:{color:o==="table"?"var(--main-icon-color)":"var(--primary-color)"}})})}),e.jsx(Q,{onClick:()=>m("icon"),"aria-label":"Icon View",disabled:o==="icon",children:e.jsx(T,{title:"Icon View (beta)",children:e.jsx(Xr,{style:{color:o==="icon"?"var(--main-icon-color)":"var(--primary-color)"}})})})]})]}),o==="table"&&e.jsx(Pn,{filter:u}),o==="icon"&&e.jsx(Sn,{filter:u})]}):e.jsx($e,{})}const Fn=r.memo(Wn);function Ln(){const[i,u]=r.useState(localStorage.getItem("logFilterLevel")??"info"),[c,o]=r.useState(localStorage.getItem("logFilterSearch")??"*"),[l,y]=r.useState(localStorage.getItem("logAutoScroll")!=="false"),{setMessages:m,setLogFilters:t,online:x,setAutoScroll:N}=r.useContext(me),p=P=>{u(P.target.value),t(P.target.value,c),localStorage.setItem("logFilterLevel",P.target.value),n&&console.log("handleChangeLevel called with value:",P.target.value)},j=P=>{o(P.target.value),t(i,P.target.value),localStorage.setItem("logFilterSearch",P.target.value),n&&console.log("handleChangeSearch called with value:",P.target.value)},O=P=>{y(P.target.checked),N(P.target.checked),localStorage.setItem("logAutoScroll",P.target.value?"true":"false"),n&&console.log("handleAutoScrollChange called with value:",P.target.checked)},$=()=>{n&&console.log("handleClearLogsClick called"),m([])};return n&&console.log("Logs rendering..."),x?e.jsxs("div",{className:"MbfPageDiv",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",margin:"0px",padding:"0px",gap:"10px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Pt,{id:"select-level",style:{color:"var(--div-text-color)"},children:"Filter log by level:"}),e.jsxs(Ue,{style:{height:"30px",backgroundColor:"var(--main-bg-color)"},labelId:"select-level",id:"debug-level",value:i,onChange:p,children:[e.jsx(I,{value:"debug",children:"Debug"}),e.jsx(I,{value:"info",children:"Info"}),e.jsx(I,{value:"notice",children:"Notice"}),e.jsx(I,{value:"warn",children:"Warn"}),e.jsx(I,{value:"error",children:"Error"}),e.jsx(I,{value:"fatal",children:"Fatal"})]}),e.jsx(Pt,{id:"search",style:{color:"var(--div-text-color)"},children:"Filter log by text:"}),e.jsx(de,{style:{width:"300px"},size:"small",id:"logsearch",variant:"outlined",value:c,onChange:j,InputProps:{style:{height:"30px",padding:"0 0px",backgroundColor:"var(--main-bg-color)"}}}),e.jsx(Le,{control:e.jsx(Te,{checked:l,onChange:O}),label:"Auto scroll",style:{color:"var(--div-text-color)"}})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:e.jsx(T,{title:"Clear the logs",children:e.jsx(ae,{onClick:$,endIcon:e.jsx(ut,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Clear"})})})]}),e.jsx("div",{style:{flex:"1",overflow:"auto",margin:"0px",padding:"0px"},children:e.jsx(Bt,{})})]}):e.jsx($e,{})}const Tn=r.memo(Ln),$n=({open:i,ip:u,onClose:c,onSave:o})=>{const l=u?u.split(".").slice(0,3).join(".")+".1":"",[y,m]=r.useState("dhcp"),[t,x]=r.useState({ip:u??"",subnet:"255.255.255.0",gateway:l,dns:l}),N=O=>$=>{x({...t,[O]:$.target.value})},p=()=>{c()},j=()=>{o({type:y,...t}),c()};return e.jsxs(Ie,{open:i,onClose:(O,$)=>{$==="backdropClick"||$==="escapeKeyDown"||c()},maxWidth:"sm",style:{maxWidth:"550px",margin:"auto"},children:[e.jsx(De,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:"Network Configuration"})]})}),e.jsxs(Ne,{dividers:!0,children:[e.jsxs(qt,{component:"fieldset",fullWidth:!0,children:[e.jsx(be,{component:"legend",children:"Select IP Configuration"}),e.jsxs(zt,{row:!0,value:y,onChange:O=>m(O.target.value),children:[e.jsx(Le,{value:"dhcp",control:e.jsx(gt,{}),label:"DHCP"}),e.jsx(Le,{value:"static",control:e.jsx(gt,{}),label:"Static"})]})]}),y==="static"&&e.jsxs(Fe,{container:!0,spacing:2,sx:{mt:2},children:[e.jsx(Fe,{size:6,children:e.jsx(de,{label:"IP Address",fullWidth:!0,value:t.ip,onChange:N("ip")})}),e.jsx(Fe,{size:6,children:e.jsx(de,{label:"Subnet Mask",fullWidth:!0,value:t.subnet,onChange:N("subnet")})}),e.jsx(Fe,{size:6,children:e.jsx(de,{label:"Gateway",fullWidth:!0,value:t.gateway,onChange:N("gateway")})}),e.jsx(Fe,{size:6,children:e.jsx(de,{label:"DNS Server",fullWidth:!0,value:t.dns,onChange:N("dns")})})]})]}),e.jsxs(Oe,{children:[e.jsx(ae,{onClick:p,children:"Cancel"}),e.jsx(ae,{variant:"contained",onClick:j,children:"Save"})]})]})},Rn=({open:i,onClose:u,onSave:c})=>{const[o,l]=r.useState(""),[y,m]=r.useState(""),t=$=>{l($.target.value)},x=$=>{m($.target.value)},N=o.length>0&&o===y,p=()=>{u()},j=()=>{N&&(c(o),u())},O=()=>{c(""),u()};return e.jsxs(Ie,{open:i,onClose:($,P)=>{P==="backdropClick"||P==="escapeKeyDown"||u()},maxWidth:"sm",style:{maxWidth:"500px",margin:"auto"},disableEscapeKeyDown:!0,children:[e.jsx(De,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:"Change Password"})]})}),e.jsx(Ne,{dividers:!0,children:e.jsx(qt,{component:"fieldset",fullWidth:!0,sx:{margin:0,padding:0,gap:"20px"},children:e.jsxs(Fe,{container:!0,spacing:2,sx:{mt:2},children:[e.jsx(Fe,{size:12,children:e.jsx(de,{type:"password",autoComplete:"new-password",label:"New Password",size:"small",variant:"outlined",fullWidth:!0,value:o,onChange:t})}),e.jsx(Fe,{size:12,children:e.jsx(de,{type:"password",autoComplete:"new-password",label:"Confirm Password",size:"small",variant:"outlined",fullWidth:!0,value:y,onChange:x,error:y!==""&&o!==y,helperText:y!==""&&o!==y?"Passwords do not match":""})})]})})}),e.jsxs(Oe,{children:[e.jsx(ae,{onClick:p,children:"Cancel"}),e.jsx(ae,{variant:"contained",onClick:j,disabled:!N,children:"Change"}),e.jsx(ae,{variant:"contained",onClick:O,children:"Reset"})]})]})};function Hn(){const{online:i,addListener:u,removeListener:c,sendMessage:o,getUniqueId:l}=r.useContext(me),[y,m]=r.useState(null),[t,x]=r.useState(null),N=r.useRef(l());return r.useEffect(()=>{const p=j=>{j.src==="Matterbridge"&&j.dst==="Frontend"&&(j.method==="refresh_required"&&j.response.changed==="settings"&&(n&&console.log(`Settings received refresh_required: changed=${j.response.changed} and sending /api/settings request`),o({id:N.current,sender:"Settings",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),j.method==="/api/settings"&&(n&&console.log("Settings received /api/settings:",j.response),m(j.response.matterbridgeInformation),x(j.response.systemInformation)))};return u(p,N.current),n&&console.log("Settings added WebSocket listener"),()=>{c(p),n&&console.log("Settings removed WebSocket listener")}},[u,c,o]),r.useEffect(()=>{i&&(n&&console.log("Settings received online"),o({id:N.current,sender:"Settings",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}))},[i,o]),y?(n&&console.log("Settings rendering..."),i?e.jsx("div",{className:"MbfPageDiv",children:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"20px",width:"100%"},children:[e.jsx(On,{matterbridgeInfo:y,systemInfo:t}),e.jsx(Vn,{matterbridgeInfo:y}),e.jsx(En,{matterbridgeInfo:y})]})}):e.jsx($e,{})):null}function On({matterbridgeInfo:i,systemInfo:u}){const{sendMessage:c,getUniqueId:o}=r.useContext(me),[l,y]=r.useState("bridge"),[m,t]=r.useState("Info"),[x,N]=r.useState(!1),[p,j]=r.useState("dark"),[O,$]=r.useState(localStorage.getItem("homePagePlugins")!=="false"),[P,U]=r.useState(localStorage.getItem("homePageMode")??"devices"),[h,V]=r.useState(localStorage.getItem("virtualMode")??"outlet"),b=r.useRef(o()),[v,C]=r.useState(!1),L=()=>C(!1),w=X=>{n&&console.log("handleSaveNetConfig called with config:",X),c({id:b.current,sender:"Settings",method:"/api/shellynetconfig",src:"Frontend",dst:"Matterbridge",params:X})},[G,A]=r.useState(!1),a=()=>A(!1),s=X=>{n&&console.log("handleSaveChangePassword called with password:",X),c({id:b.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setpassword",value:X}})};r.useEffect(()=>{i&&(y(i.bridgeMode==="bridge"?"bridge":"childbridge"),t(i.loggerLevel.charAt(0).toUpperCase()+i.loggerLevel.slice(1)),N(i.fileLogger),V(i.virtualMode))},[i]),r.useEffect(()=>{const X=localStorage.getItem("frontendTheme");X&&j(X)},[]);const d=X=>{n&&console.log("handleChangeBridgeMode called with value:",X.target.value),y(X.target.value),c({id:b.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setbridgemode",value:X.target.value}})},g=X=>{n&&console.log("handleChangeMbLoggerLevel called with value:",X.target.value),t(X.target.value),c({id:b.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmbloglevel",value:X.target.value}})},R=X=>{n&&console.log("handleLogOnFileMbChange called with value:",X.target.checked),N(X.target.checked),c({id:b.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmblogfile",value:X.target.checked}})},pe=X=>{const ie=X.target.value;n&&console.log("handleChangeTheme called with value:",ie),j(ie),localStorage.setItem("frontendTheme",ie),document.body.setAttribute("frontend-theme",ie)},Ce=X=>{const ie=X.target.checked;n&&console.log("handleChangeHomePagePlugins called with value:",ie),$(ie),localStorage.setItem("homePagePlugins",ie?"true":"false")},we=X=>{const ie=X.target.value;n&&console.log("handleChangeHomePageMode called with value:",ie),U(ie),localStorage.setItem("homePageMode",ie)},ye=X=>{const ie=X.target.value;n&&console.log("handleChangeVirtualMode called with value:",ie),V(ie),localStorage.setItem("virtualMode",ie),c({id:b.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setvirtualmode",value:ie}})};return!i||!u?null:e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge settings"})}),e.jsx($n,{open:v,ip:u.ipv4Address,onClose:L,onSave:w}),e.jsx(Rn,{open:G,onClose:a,onSave:s}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(Y,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(be,{style:{padding:"0px",margin:"0px"},id:"matterbridgeInfo-mode",children:"Matterbridge mode:"}),e.jsxs(zt,{row:!0,name:"mode-buttons-group",value:l,onChange:d,children:[e.jsx(Le,{value:"bridge",control:e.jsx(gt,{}),label:"Bridge",disabled:i.readOnly===!0}),e.jsx(Le,{value:"childbridge",control:e.jsx(gt,{}),label:"Childbridge",disabled:i.readOnly===!0})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(be,{style:{padding:"0px",margin:"0px"},id:"mblogger-level-label",children:"Logger level:"}),e.jsxs(Ue,{style:{height:"30px"},labelId:"mblogger-level-label",id:"mblogger-level",value:m,onChange:g,children:[e.jsx(I,{value:"Debug",children:"Debug"}),e.jsx(I,{value:"Info",children:"Info"}),e.jsx(I,{value:"Notice",children:"Notice"}),e.jsx(I,{value:"Warn",children:"Warn"}),e.jsx(I,{value:"Error",children:"Error"}),e.jsx(I,{value:"Fatal",children:"Fatal"})]}),e.jsx(Le,{style:{padding:"0px",margin:"0px"},control:e.jsx(Te,{checked:x,onChange:R,name:"logOnFileMb"}),label:"Log on file:",labelPlacement:"start"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(be,{style:{padding:"0px",margin:"0px"},id:"frontend-theme-label",children:"Frontend theme:"}),e.jsxs(Ue,{style:{height:"30px"},labelId:"frontend-theme-label",id:"frontend-theme",value:p,onChange:pe,children:[e.jsx(I,{value:"classic",children:"Classic"}),e.jsx(I,{value:"light",children:"Light"}),e.jsx(I,{value:"dark",children:"Dark"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(be,{style:{padding:"0px",margin:"0px"},id:"frontend-home-plugin-label",children:"Home page plugins:"}),e.jsx(Te,{checked:O,onChange:Ce,name:"showPlugins"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(be,{style:{padding:"0px",margin:"0px"},id:"frontend-home-label",children:"Home page bottom panel:"}),e.jsxs(Ue,{style:{height:"30px"},labelId:"frontend-home-label",id:"frontend-home",value:P,onChange:we,children:[e.jsx(I,{value:"logs",children:"Logs"}),e.jsx(I,{value:"devices",children:"Devices"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"10px"},children:[e.jsx(be,{style:{padding:"0px",margin:"0px"},id:"frontend-virtual-label",children:"Virtual devices:"}),e.jsxs(Ue,{style:{height:"30px"},labelId:"frontend-virtual-label",id:"frontend-virtual",value:h,onChange:ye,children:[e.jsx(I,{value:"disabled",children:"Disabled"}),e.jsx(I,{value:"outlet",children:"Outlet"}),e.jsx(I,{value:"light",children:"Light"}),e.jsx(I,{value:"switch",children:"Switch"}),e.jsx(I,{value:"mounted_switch",children:"Mounted Switch"})]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"20px"},children:e.jsx(ae,{variant:"contained",color:"primary",onClick:()=>A(!0),children:"Change password"})}),i.shellyBoard&&e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"20px"},children:e.jsx(ae,{variant:"contained",color:"primary",onClick:()=>C(!0),children:"Configure IP"})})]})})]})}function Vn({matterbridgeInfo:i}){const{sendMessage:u,getUniqueId:c}=r.useContext(me),[o,l]=r.useState("Info"),[y,m]=r.useState(!1),[t,x]=r.useState(""),[N,p]=r.useState(""),[j,O]=r.useState(""),[$,P]=r.useState(""),[U,h]=r.useState(""),[V,b]=r.useState(""),v=r.useRef(c());r.useEffect(()=>{i&&(l(["Debug","Info","Notice","Warn","Error","Fatal"][i.matterLoggerLevel]),m(i.matterFileLogger),x(i.matterMdnsInterface||""),p(i.matterIpv4Address||""),O(i.matterIpv6Address||""),P(i.matterPort?i.matterPort.toString():""),h(i.matterDiscriminator?i.matterDiscriminator.toString():""),b(i.matterPasscode?i.matterPasscode.toString():""))},[i]);const C=g=>{n&&console.log("handleChangeMjLoggerLevel called with value:",g.target.value),l(g.target.value),u({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmjloglevel",value:g.target.value}})},L=g=>{n&&console.log("handleLogOnFileMjChange called with value:",g.target.checked),m(g.target.checked),u({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmjlogfile",value:g.target.checked}})},w=g=>{n&&console.log("handleChangeMdnsInterface called with value:",g.target.value),x(g.target.value),u({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmdnsinterface",value:g.target.value}})},G=g=>{n&&console.log("handleChangeIpv4Address called with value:",g.target.value),p(g.target.value),u({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setipv4address",value:g.target.value}})},A=g=>{n&&console.log("handleChangeIpv6Address called with value:",g.target.value),O(g.target.value),u({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setipv6address",value:g.target.value}})},a=g=>{n&&console.log("handleChangeMatterPort called with value:",g.target.value),P(g.target.value),u({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterport",value:g.target.value}})},s=g=>{n&&console.log("handleChangeMatterDiscriminator called with value:",g.target.value),h(g.target.value),u({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterdiscriminator",value:g.target.value}})},d=g=>{n&&console.log("handleChangemMatterPasscode called with value:",g.target.value),b(g.target.value),u({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterpasscode",value:g.target.value}})};return i?e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matter settings"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(Y,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(be,{style:{padding:"0px",margin:"0px"},id:"mjdebug-info",children:"Logger level:"}),e.jsxs(Ue,{style:{height:"30px"},labelId:"select-mjlevel",id:"mjdebug-level",value:o,onChange:C,children:[e.jsx(I,{value:"Debug",children:"Debug"}),e.jsx(I,{value:"Info",children:"Info"}),e.jsx(I,{value:"Notice",children:"Notice"}),e.jsx(I,{value:"Warn",children:"Warn"}),e.jsx(I,{value:"Error",children:"Error"}),e.jsx(I,{value:"Fatal",children:"Fatal"})]}),e.jsx(Le,{style:{padding:"0px",margin:"0px"},control:e.jsx(Te,{checked:y,onChange:L,name:"logOnFileMj"}),label:"Log on file:",labelPlacement:"start"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(be,{style:{padding:"0px",margin:"0px"},children:"Mdns interface:"}),e.jsx(de,{value:t,onChange:w,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:i.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(be,{style:{padding:"0px",margin:"0px"},children:"Ipv4 address:"}),e.jsx(de,{value:N,onChange:G,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:i.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(be,{style:{padding:"0px",margin:"0px"},children:"Ipv6 address:"}),e.jsx(de,{value:j,onChange:A,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:i.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(be,{style:{padding:"0px",margin:"0px"},children:"Commissioning port:"}),e.jsx(de,{value:$,onChange:a,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:i.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(be,{style:{padding:"0px",margin:"0px"},children:"Commissioning discriminator:"}),e.jsx(de,{value:U,onChange:s,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:i.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(be,{style:{padding:"0px",margin:"0px"},children:"Commissioning passcode:"}),e.jsx(de,{value:V,onChange:d,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:i.readOnly===!0,style:{height:"30px",padding:"0"}}})]})]})})]}):null}function En({matterbridgeInfo:i}){return i?e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge info"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(Y,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:["          ",e.jsx(He,{value:i.matterbridgeVersion,label:"Current Version"}),e.jsx(He,{value:i.matterbridgeLatestVersion,label:"Latest Version"}),e.jsx(He,{value:i.homeDirectory,label:"Home Directory"}),e.jsx(He,{value:i.rootDirectory,label:"Root Directory"}),e.jsx(He,{value:i.matterbridgeDirectory,label:"Matterbridge Storage Directory"}),e.jsx(He,{value:i.matterbridgePluginDirectory,label:"Matterbridge Plugin Directory"}),e.jsx(He,{value:i.globalModulesDirectory,label:"Global Module Directory"})]})})]}):null}function He({value:i,label:u}){return e.jsx(de,{focused:!0,value:i,size:"small",label:u,variant:"standard",sx:{width:"400px"},InputProps:{readOnly:!0,sx:{color:"var(--div-text-color)","&:before":{borderBottomColor:"var(--main-label-color)"},"&:after":{borderBottomColor:"var(--main-label-color)"}}},InputLabelProps:{sx:{marginTop:"3px",color:"var(--main-label-color)","&.Mui-focused":{color:"var(--main-label-color)"}}}})}const An=r.memo(Hn);function _n(){const{online:i,sendMessage:u,addListener:c,removeListener:o,getUniqueId:l}=r.useContext(me),{showSnackbarMessage:y}=r.useContext(Be),[m,t]=r.useState(null),[x,N]=r.useState([]),[p,j]=r.useState([]),[O,$]=r.useState(null),[P,U]=r.useState({cpuUsage:0}),[h,V]=r.useState({totalMemory:"",freeMemory:"",heapTotal:"",heapUsed:"",external:"",arrayBuffers:"",rss:""}),[b,v]=r.useState({systemUptime:"",processUptime:""}),C=r.useRef(l());return console.log("Test uniqueId:",C),r.useEffect(()=>{console.log("Test useEffect WebSocketMessage mounting");const L=w=>{if(w.method==="restart_required")console.log("Test received restart_required"),y("Restart required",0);else if(w.method==="refresh_required")console.log(`Test received refresh_required: changed=${w.response.changed} and sending api requests`),y("Refresh required",0),u({id:C.current,method:"/api/settings",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),u({id:C.current,method:"/api/plugins",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),u({id:C.current,method:"/api/devices",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}});else if(w.method==="memory_update")console.log("Test received memory_update",w),V(w.response);else if(w.method==="cpu_update")console.log("Test received cpu_update",w),U(w.response);else if(w.method==="uptime_update")console.log("Test received uptime_update",w),v(w.response);else if(w.method==="/api/settings"&&w.response)console.log("Test received /api/settings:",w.response),y("Test received /api/settings",0),t(w.response);else if(w.method==="/api/plugins"&&w.response)console.log(`Test received ${w.response.length} plugins:`,w.response),y("Test received /api/plugins",0),N(w.response);else if(w.method==="/api/devices"&&w.response){console.log(`Test received ${w.response.length} devices:`,w.response),y("Test received /api/devices",0),j(w.response);for(const G of w.response)console.log("Test sending /api/clusters for device:",G.pluginName,G.name,G.endpoint),u({id:C.current,method:"/api/clusters",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{plugin:G.pluginName,endpoint:G.endpoint||0}})}else w.method==="/api/clusters"&&w.response&&(console.log(`Test received ${w.response.clusters.length} clusters for device ${w.response.deviceName} endpoint ${w.response.endpoint}:`,w),y(`Test received /api/clusters for ${w.response.plugin}::${w.response.deviceName}`,0),$(w.response))};return c(L,C.current),console.log("Test useEffect WebSocketMessage mounted"),()=>{console.log("Test useEffect WebSocketMessage unmounting"),o(L),console.log("Test useEffect WebSocketMessage unmounted")}},[c,o,u,y]),r.useEffect(()=>(console.log("Test useEffect online mounting"),i&&(console.log("Test useEffect online received online"),u({id:C.current,method:"/api/settings",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),u({id:C.current,method:"/api/plugins",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),u({id:C.current,method:"/api/devices",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}})),console.log("Test useEffect online mounted"),()=>{console.log("Test useEffect online unmounted")}),[i,u,y]),console.log("Test rendering..."),i?e.jsx("div",{className:"MbfPageDiv",style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"20px",width:"100%"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"256px",width:"256px",margin:"10px"}}),e.jsx("p",{children:"Welcome to the Test page of the Matterbridge frontend"})]})}):e.jsx($e,{})}const qn=r.memo(_n);function zn(i,u){n&&console.log("getCssVariable:",i,"defaultValue",u);const c=getComputedStyle(document.body).getPropertyValue(i).trim();return c||console.error("getCssVariable: undefined",c),c||u}function Un(i){return Zr({palette:{primary:{main:i},action:{disabled:"var(--main-label-color)"},text:{disabled:"var(--main-label-color)"}},typography:{fontFamily:"Roboto, Helvetica, Arial, sans-serif"},components:{MuiDialog:{styleOverrides:{paper:{color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",border:"2px solid var(--div-border-color)",borderRadius:"var(--div-border-radius)",boxShadow:"2px 2px 5px var(--div-shadow-color)"}}},MuiTooltip:{defaultProps:{placement:"top-start",arrow:!0}},MuiButton:{styleOverrides:{root:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)","&:hover":{backgroundColor:"var(--main-button-bg-color)"},"&.Mui-disabled":{color:"var(--main-button-color)",backgroundColor:"var(--main-grey-color)"}},contained:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},outlined:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},text:{color:"var(--main-button-color)"}},defaultProps:{variant:"contained",size:"small"}},MuiIconButton:{styleOverrides:{root:{color:"var(--main-icon-color)","&:hover .MuiSvgIcon-root":{color:"var(--primary-color)"}}}},MuiCheckbox:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-checked":{color:"var(--primary-color)"}}}},MuiTextField:{defaultProps:{size:"small",variant:"outlined",fullWidth:!0}},MuiOutlinedInput:{styleOverrides:{root:{backgroundColor:"var(--div-bg-color)","& .MuiOutlinedInput-notchedOutline":{borderColor:"var(--main-label-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--main-text-color)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"var(--primary-color)"},padding:"0px"},input:{color:"var(--div-text-color)",padding:"4px 8px"}}},MuiInputLabel:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-focused":{color:"var(--primary-color)"}}}},MuiFormLabel:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-focused":{color:"var(--main-label-color)"}}}},MuiFormControl:{styleOverrides:{root:{color:"var(--main-grey-color)"}}},MuiRadio:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-checked":{color:"var(--primary-color)"}}}},MuiSelect:{styleOverrides:{root:{backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)",height:"30px","&:hover":{borderColor:"var(--main-text-color)"},"&.Mui-focused":{borderColor:"var(--primary-color)"}}}},MuiMenu:{styleOverrides:{paper:{backgroundColor:"var(--main-menu-bg-color)",padding:"0px",margin:"0px"},list:{padding:"0px"}}},MuiMenuItem:{styleOverrides:{root:{color:"var(--main-menu-color)",backgroundColor:"var(--main-menu-bg-color)","&:hover":{backgroundColor:"var(--main-menu-hover-color)"},"&.Mui-selected":{color:"var(--main-menu-color)",backgroundColor:"var(--main-menu-bg-color)"},"&.Mui-selected:hover":{backgroundColor:"var(--main-menu-hover-color)"}}}},MuiListItemButton:{styleOverrides:{root:{cursor:"pointer","&:hover":{backgroundColor:"var(--main-bg-color)"}}}},MuiListItemIcon:{styleOverrides:{root:{color:"var(--div-text-color)"}}},MuiListItemText:{styleOverrides:{primary:{fontSize:"16px",fontWeight:"bold",color:"var(--div-text-color)"},secondary:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"}}}}})}let n=!1;const Bn=()=>{n=!n};function Qn({setLoggedIn:i}){const[u,c]=r.useState(""),[o,l]=r.useState(""),y={display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",backgroundColor:"var(--main-bg-color)"},m={display:"flex",flexDirection:"column",maxWidth:"400px",margin:"0 auto",padding:"20px",gap:"20px",border:"1px solid var(--div-border-color)",borderRadius:"var(--div-border-radius)",boxShadow:"2px 2px 5px var(--div-shadow-color)",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},t={margin:"10px 0",padding:"3px 3px",fontSize:"14px",width:"230px",border:"1px solid var(--main-label-color)",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},x=async p=>{try{const j=await fetch("./api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:p})});if(j.ok){const{valid:O}=await j.json();O?i(!0):p!==""&&l("Incorrect password!")}else console.error("Failed to log in:",j.statusText)}catch(j){console.error("Failed to log in:",j)}},N=p=>{p.preventDefault(),x(u)};return x(""),e.jsx("div",{style:y,children:e.jsxs("form",{onSubmit:N,style:m,children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"64px",width:"64px"}}),e.jsx("h3",{style:{color:"var(--div-text-color)"},children:"Welcome to Matterbridge"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:"20px"},children:[e.jsx("input",{type:"text",name:"username",autoComplete:"username",style:{display:"none"},tabIndex:-1}),e.jsx("input",{type:"password",value:u,onChange:p=>c(p.target.value),style:t,placeholder:"password",autoComplete:"current-password"}),e.jsx("button",{type:"submit",style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",borderColor:"var(--div-bg-color)"},children:"Log in"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",margin:0,height:"30px"},children:o&&e.jsx("p",{style:{color:"red"},children:o})})]})})}function Kn(){const[i,u]=r.useState(!1);n&&console.log("Setting frontend theme");const c=localStorage.getItem("frontendTheme");n&&console.log("Saved theme:",c),c?document.body.setAttribute("frontend-theme",c):document.body.setAttribute("frontend-theme","dark");const o=zn("--primary-color","#1976d2");n&&console.log("Primary color from CSS:",o);const l=Un(o),y=window.location.pathname.includes("/matterbridge/")?"/matterbridge":window.location.href.includes("/api/hassio_ingress/")?window.location.pathname:"/";return n&&(console.log("Loading App..."),console.log("- production mode"),console.log(`- with href = "${window.location.href}"`),console.log(`- pathname = "${window.location.pathname}"`),console.log(`- baseName = "${y}"`)),i?e.jsx(eo,{theme:l,children:e.jsx(cr,{dense:!0,maxSnack:10,preventDuplicate:!0,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(Ro,{children:e.jsx(Ho,{children:e.jsx(nr,{basename:y,children:e.jsxs("div",{className:"MbfScreen",children:[e.jsx(Vo,{}),e.jsxs(ir,{children:[e.jsx(Ve,{path:"/",element:e.jsx(cn,{})}),e.jsx(Ve,{path:"/devices",element:e.jsx(Fn,{})}),e.jsx(Ve,{path:"/log",element:e.jsx(Tn,{})}),e.jsx(Ve,{path:"/settings",element:e.jsx(An,{})}),e.jsx(Ve,{path:"/test",element:e.jsx(qn,{})}),e.jsx(Ve,{path:"*",element:e.jsx(sr,{to:"/"})})]})]})})})})})}):e.jsx(Qn,{setLoggedIn:u})}ar.createRoot(document.getElementById("root")).render(e.jsx(lr.StrictMode,{children:e.jsx(Kn,{})}));
