import{B as e,y as r,S as at,I as Oe,U as xr,V as fr,X as Ke,Y as br,Z as vr}from"./vendor_node_modules.js";import{u as yr,S as jr}from"./vendor_notistack.js";import{D as Ie,a as ke,b as De,B as oe,c as Z,A as Cr,I as B,C as Sr,T as H,S as wr,F as Yt,H as Mr,d as Xt,e as Ve,R as bt,P as ze,M as Ir,f as et,g as N,L as Q,h as re,i as st,V as lt,j as He,k as kt,l as kr,m as Dr,n as pe,o as Nr,p as Pr,q as vt,r as de,s as We,K as Ft,t as Lt,u as jt,v as dt,w as ot,x as ct,W as nt,y as pt,z as ut,E as Ne,G as Ht,J as Ot,N as Wr,O as Tr,Q as it,U as Pe,X as Ue,Y as Zt,Z as Fr,_ as Lr,$ as Hr,a0 as Or,a1 as er,a2 as yt,a3 as Rr,a4 as Er,a5 as Vr,a6 as _r,a7 as Rt,a8 as $r,a9 as Ar,aa as zr,ab as Br,ac as Ur,ad as qr,ae as Jr,af as Et,ag as Gr,ah as Qr,ai as Kr,aj as Yr,ak as Xr,al as Zr,am as eo,an as to,ao as ro,ap as oo,aq as no,ar as io,as as ao,at as so,au as lo,av as Vt,aw as tt,ax as tr,ay as Me,az as rr,aA as Ct,aB as _e,aC as co,aD as po}from"./vendor_mui.js";import{Q as uo}from"./vendor_qrcode.js";import{I as te,m as _t,a as go,b as mo,c as $t,d as ho,e as Pt,f as Wt,g as xo,h as fo,i as bo,j as vo,k as yo,l as jo,n as Co,o as So,p as At,q as wo,r as Mo,s as Io,t as ko,u as Do,v as No,w as Po,x as Wo,y as zt,z as To,A as Fo,B as Lo}from"./vendor_mdi.js";import{r as $e}from"./vendor_react_table.js";import{F as Ho,v as Oo,e as Ro,a as Eo,g as Vo,b as _o,c as $o,d as Dt,A as Ao}from"./vendor_rjsf.js";import"./vendor_lodash.js";import"./vendor_emotion.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const m of s)if(m.type==="childList")for(const b of m.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&o(b)}).observe(document,{childList:!0,subtree:!0});function a(s){const m={};return s.integrity&&(m.integrity=s.integrity),s.referrerPolicy&&(m.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?m.credentials="include":s.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function o(s){if(s.ep)return;s.ep=!0;const m=a(s);fetch(s.href,m)}})();/**
 * This file contains the types for WebSocket messages.
 *
 * @file frontendTypes.tsx
 * @author Luca Liguori
 * @created 2025-09-17
 * @version 1.0.0
 * @license Apache-2.0
 *
 * Copyright 2025, 2026, 2027 Luca Liguori.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bt=0,zo=1,Bo=2,Uo=3,qo=4,Jo=6,Go=9,or=100,nr=101;function Qo({open:n,title:c,message:a,onConfirm:o,onCancel:s}){const m=t=>{i&&console.log("Confirmed"),t.preventDefault(),o()},b=t=>{i&&console.log("Canceled"),t.preventDefault(),s()};return e.jsxs(Ie,{open:n,children:[e.jsx(ke,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:c})]})}),e.jsxs(De,{children:[e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",margin:"0",marginBottom:"20px",maxHeight:"350px",maxWidth:"350px"},children:e.jsx("p",{style:{flex:1,margin:"0"},children:a})}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-around"},children:[e.jsx(oe,{onClick:m,variant:"contained",color:"primary",size:"small",children:"Confirm"}),e.jsx(oe,{onClick:b,variant:"contained",color:"primary",size:"small",children:"Cancel"})]})]})]})}const gt=[],rt=r.createContext(null);function Ko({children:n}){const{enqueueSnackbar:c,closeSnackbar:a}=yr(),o=r.useCallback(L=>{i&&console.log(`UiProvider closeSnackbarMessage: message ${L}`);const R=gt.findIndex(V=>V.message===L);R!==-1&&(a(gt[R].key),gt.splice(R,1),i&&console.log(`UiProvider closeSnackbarMessage: message ${L} removed from persistMessages`))},[a]),s=r.useCallback((L,R,V)=>{i&&console.log(`UiProvider showSnackbarMessage: message ${L} timeout ${R}`);const _=c(L,{variant:"default",autoHideDuration:R==null||R>0?(R??5)*1e3:null,persist:R===0,content:q=>e.jsx(Z,{sx:{margin:"0",padding:"0",width:"300px",marginRight:"30px"},children:e.jsx(Cr,{severity:V??"info",variant:"filled",sx:{color:"#fff",fontWeight:"normal",width:"100%",cursor:"pointer",padding:"0px 10px"},onClick:()=>a(q),action:e.jsx(B,{size:"small",onClick:()=>a(q),sx:{color:"#fff"},children:e.jsx(Sr,{fontSize:"small"})}),children:L},q)},q)});R===0&&(i&&console.log(`UiProvider showSnackbarMessage: message ${L} timeout ${R} - persist key ${_}`),gt.push({message:L,key:_}))},[c,a]),[m,b]=r.useState(!1),[t,g]=r.useState(""),[S,F]=r.useState(""),[v,T]=r.useState(""),O=r.useRef(null),y=r.useRef(null),P=()=>{i&&console.log(`UiProvider handle confirm action ${v}`),b(!1),O.current&&O.current(v)},p=()=>{i&&console.log(`UiProvider handle cancel action ${v}`),b(!1),y.current&&y.current(v)},E=r.useCallback((L,R,V,_,q)=>{i&&console.log(`UiProvider showConfirmCancelDialog for command ${V}`),g(L),F(R),T(V),O.current=_,y.current=q,b(!0)},[]),C=r.useMemo(()=>({showSnackbarMessage:s,closeSnackbarMessage:o,closeSnackbar:a,showConfirmCancelDialog:E}),[s,o,a,E]);return e.jsxs(rt.Provider,{value:C,children:[e.jsx(Qo,{open:m,title:t,message:S,onConfirm:P,onCancel:p}),n]})}const ir=r.createContext(void 0),fe=r.createContext(void 0);function Yo({children:n}){const[c,a]=r.useState(localStorage.getItem("logFilterLevel")??"info"),[o,s]=r.useState(localStorage.getItem("logFilterSearch")??"*"),[m,b]=r.useState([]),[t,g]=r.useState(1e3),[S,F]=r.useState(!0),[v,T]=r.useState(!1),{showSnackbarMessage:O,closeSnackbarMessage:y,closeSnackbar:P}=r.useContext(rt),p=r.useRef([]),E=r.useRef(null),C=r.useRef(1),L=r.useRef(Math.floor(Math.random()*999e3)+1e3),R=r.useRef(null),V=r.useRef(null),_=r.useRef(null),q=r.useRef(c),Y=r.useRef(o),l=r.useMemo(()=>window.location.href.replace(/^http/,"ws"),[]),h=r.useMemo(()=>window.location.href.includes("api/hassio_ingress"),[]),f=100,D=60,X=50,he=300;r.useEffect(()=>{q.current=c},[c]),r.useEffect(()=>{Y.current=o},[o]);const j=r.useCallback(()=>Math.floor(Math.random()*999e3)+1e3,[]),u=r.useCallback(w=>{if(E.current&&E.current.readyState===WebSocket.OPEN)try{w.id===void 0&&(w.id=L.current);const x=JSON.stringify(w);E.current.send(x),i&&console.log("WebSocket sent message:",w)}catch(x){i&&console.error(`WebSocket error sending message: ${x}`)}else i&&console.error("WebSocket message not sent, WebSocket not connected:",w)},[]),$=r.useCallback((w,x)=>{const d=`<span style="background-color: #5c0e91; color: white; padding: 1px 5px; font-size: 12px; border-radius: 3px;">${w}</span>`;b(W=>[...W,d+' <span style="color: var(--main-log-color);">'+x+"</span>"])},[]),k=r.useCallback((w,x)=>{a(w),s(x),$("WebSocket",`Filtering by log level "${w}" and log search "${x}"`)},[$]),ee=r.useCallback(w=>{i&&console.log("WebSocket addListener:",w),p.current=[...p.current,w],i&&console.log("WebSocket addListener total listeners:",p.current.length)},[]),xe=r.useCallback(w=>{i&&console.log("WebSocket removeListener:",w),p.current=p.current.filter(x=>x!==w),i&&console.log("WebSocket removeListener total listeners:",p.current.length)},[]),Se=r.useCallback(()=>{l===""||l===null||l===void 0||($("WebSocket",`Connecting to WebSocket: ${l}`),E.current=new WebSocket(l),E.current.onmessage=w=>{v||T(!0);try{const x=JSON.parse(w.data);if(x.error&&i&&console.error("WebSocket error message:",x),x.id===void 0)return;if(x.id===zo){i&&console.log("WebSocket WS_ID_REFRESH_NEEDED message:",x,"listeners:",p.current.length),p.current.forEach(W=>W(x));return}else if(x.id===Bo){i&&console.log("WebSocket WS_ID_RESTART_NEEDED message:",x,"listeners:",p.current.length),p.current.forEach(W=>W(x));return}else if(x.id===Uo){i&&console.log("WebSocket WS_ID_CPU_UPDATE message:",x,"listeners:",p.current.length),p.current.forEach(W=>W(x));return}else if(x.id===qo){i&&console.log("WebSocket WS_ID_MEMORY_UPDATE message:",x,"listeners:",p.current.length),p.current.forEach(W=>W(x));return}else if(x.id===Jo){i&&console.log("WebSocket WS_ID_SNACKBAR message:",x,"listeners:",p.current.length),O(x.params.message,x.params.timeout,x.params.severity);return}else if(x.id===Go){i&&console.log("WebSocket WS_ID_CLOSE_SNACKBAR message:",x,"listeners:",p.current.length),y(x.params.message);return}else if(x.id===or){i&&console.log("WebSocket WS_ID_SHELLY_SYS_UPDATE message:",x,"listeners:",p.current.length),p.current.forEach(W=>W(x));return}else if(x.id===nr){i&&console.log("WebSocket WS_ID_SHELLY_MAIN_UPDATE message:",x,"listeners:",p.current.length),p.current.forEach(W=>W(x));return}else if(x.id===L.current&&x.src==="Matterbridge"&&x.dst==="Frontend"&&x.response==="pong"){i&&console.log("WebSocket pong response message:",x,"listeners:",p.current.length),V.current&&clearTimeout(V.current),p.current.forEach(W=>W(x));return}else if(x.id!==Bt){i&&console.log("WebSocket message:",x,"listeners:",p.current.length),p.current.forEach(W=>W(x));return}if(x.id!==Bt||!x.level||!x.time||!x.name||!x.message||["debug","info","notice","warn","error","fatal"].includes(x.level)&&(q.current==="info"&&x.level==="debug"||q.current==="notice"&&(x.level==="debug"||x.level==="info")||q.current==="warn"&&(x.level==="debug"||x.level==="info"||x.level==="notice")||q.current==="error"&&(x.level==="debug"||x.level==="info"||x.level==="notice"||x.level==="warn")||q.current==="fatal"&&(x.level==="debug"||x.level==="info"||x.level==="notice"||x.level==="warn"||x.level==="error"))||Y.current!=="*"&&Y.current!==""&&!x.message.toLowerCase().includes(Y.current.toLowerCase())&&!x.name.toLowerCase().includes(Y.current.toLowerCase())||x.name==="Commissioning"&&x.message.includes("is uncommissioned"))return;b(W=>{const ae=`<span style="color: #505050;">[${x.time}]</span>`,le=be=>{switch(be.toLowerCase()){case"debug":return"gray";case"info":return"#267fb7";case"notice":return"green";case"warn":return"#e9db18";case"error":return"red";case"fatal":return"#ff0000";case"spawn":return"#ff00d0";default:return"lightblue"}},U=be=>{switch(be.toLowerCase()){case"warn":return"black";default:return"white"}},ge=`${`<span style="background-color: ${le(x.level)}; color: ${U(x.level)}; padding: 1px 5px; font-size: 12px; border-radius: 3px;">${x.level}</span>`} ${ae} <span style="color: #09516d;">[${x.name}]</span> <span style="color: var(--main-log-color);">${x.message}</span>`,ne=[...W,ge];return ne.length>t?ne.slice(t/10):ne})}catch(x){console.error(`WebSocketUse error parsing message: ${x}`)}},E.current.onopen=()=>{i&&console.log(`WebSocket: Connected to WebSocket: ${l}`),$("WebSocket",`Connected to WebSocket: ${l}`),T(!0),P(),C.current=1,_.current=setTimeout(()=>{R.current=setInterval(()=>{u({id:L.current,method:"ping",src:"Frontend",dst:"Matterbridge",params:{}}),V.current&&clearTimeout(V.current),V.current=setTimeout(()=>{i&&console.error(`WebSocketUse: No pong response received from WebSocket: ${l}`),$("WebSocket",`No pong response received from WebSocket: ${l}`),T(!1)},1e3*X)},1e3*D)},1e3*he)},E.current.onclose=()=>{i&&console.error(`WebSocket: Disconnected from WebSocket ${h?"with Ingress":""}: ${l}`),$("WebSocket",`Disconnected from WebSocket: ${l}`),T(!1),P(),_.current&&clearTimeout(_.current),V.current&&clearTimeout(V.current),R.current&&clearInterval(R.current),$("WebSocket",`Reconnecting (attempt ${C.current} of ${f}) to WebSocket${h?" (Ingress)":""}: ${l}`),h?setTimeout(z,5e3):C.current===1?z():C.current<f?setTimeout(z,1e3*C.current):$("WebSocket",`Reconnect attempts exceeded limit of ${f} retries, refresh the page to reconnect to: ${l}`),C.current=C.current+1},E.current.onerror=w=>{i&&console.error(`WebSocket: WebSocket error connecting to ${l}:`,w),$("WebSocket",`WebSocket error connecting to ${l}`)})},[l]),z=r.useCallback(()=>{i&&console.log(`WebSocket attemptReconnect ${C.current}/${f} to:`,l),Se()},[Se]);r.useEffect(()=>(Se(),()=>{E.current&&E.current.readyState===WebSocket.OPEN&&E.current.close()}),[Se]);const M=r.useMemo(()=>({messages:m,maxMessages:t,autoScroll:S,setMessages:b,setLogFilters:k,setMaxMessages:g,setAutoScroll:F}),[m,b,k]),I=r.useMemo(()=>({maxMessages:t,autoScroll:S,logFilterLevel:c,logFilterSearch:o,setMessages:b,setLogFilters:k,setMaxMessages:g,setAutoScroll:F,online:v,retry:C.current,getUniqueId:j,addListener:ee,removeListener:xe,sendMessage:u,logMessage:$}),[t,S,b,k,g,F,v,C.current,ee,xe,u,$]);return e.jsx(ir.Provider,{value:M,children:e.jsx(fe.Provider,{value:I,children:n})})}function Xo(){const{showSnackbarMessage:n,showConfirmCancelDialog:c}=r.useContext(rt),{online:a,sendMessage:o,logMessage:s,addListener:m,removeListener:b,getUniqueId:t}=r.useContext(fe),[g,S]=r.useState(!1),[F,v]=r.useState(!1),[T,O]=r.useState(!1),[y,P]=r.useState(!1),[p,E]=r.useState(null),C=r.useRef(t()),[L,R]=r.useState(null),[V,_]=r.useState(null),[q,Y]=r.useState(null),[l,h]=r.useState(null),[f,D]=r.useState(null),X=()=>{window.open("https://www.buymeacoffee.com/luligugithub","_blank")},he=()=>{window.open("https://github.com/Luligu/matterbridge/blob/main/README.md","_blank")},j=()=>{p.matterbridgeInformation.matterbridgeVersion.includes("-dev-")?window.open("https://github.com/Luligu/matterbridge/blob/dev/CHANGELOG.md","_blank"):window.open("https://github.com/Luligu/matterbridge/blob/main/CHANGELOG.md","_blank")},u=()=>{window.open("https://discord.gg/QX58CDe6hd","_blank")},$=()=>{window.open("https://github.com/Luligu/matterbridge","_blank")},k=()=>{o({id:C.current,sender:"Header",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:"matterbridge",restart:!0}})},ee=()=>{o({id:C.current,sender:"Header",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:"matterbridge@dev",restart:!0}})},xe=()=>{o({id:C.current,sender:"Header",method:"/api/checkupdates",src:"Frontend",dst:"Matterbridge",params:{}})},Se=()=>{i&&console.log("Header: handleShellySystemUpdateClick"),s("Matterbridge","Installing system updates..."),o({id:C.current,sender:"Header",method:"/api/shellysysupdate",src:"Frontend",dst:"Matterbridge",params:{}})},z=()=>{i&&console.log("Header: handleShellyMainUpdateClick"),s("Matterbridge","Installing software updates..."),o({id:C.current,sender:"Header",method:"/api/shellymainupdate",src:"Frontend",dst:"Matterbridge",params:{}})},M=()=>{i&&console.log("Header: handleShellyCreateSystemLog"),o({id:C.current,sender:"Header",method:"/api/shellycreatesystemlog",src:"Frontend",dst:"Matterbridge",params:{}})},I=()=>{i&&console.log("Header: handleShellyDownloadSystemLog"),s("Matterbridge","Downloading Shelly system log..."),n("Downloading Shelly system log...",5),window.location.href="./api/shellydownloadsystemlog"},w=()=>{p.matterbridgeInformation.restartMode===""?o({id:C.current,sender:"Header",method:"/api/restart",src:"Frontend",dst:"Matterbridge",params:{}}):o({id:C.current,sender:"Header",method:"/api/shutdown",src:"Frontend",dst:"Matterbridge",params:{}})},x=()=>{o({id:C.current,sender:"Header",method:"/api/shutdown",src:"Frontend",dst:"Matterbridge",params:{}})},d=()=>{o({id:C.current,sender:"Header",method:"/api/reboot",src:"Frontend",dst:"Matterbridge",params:{}})},W=()=>{o({id:C.current,sender:"Header",method:"/api/softreset",src:"Frontend",dst:"Matterbridge",params:{}})},ae=()=>{o({id:C.current,sender:"Header",method:"/api/hardreset",src:"Frontend",dst:"Matterbridge",params:{}})},le=J=>{R(J.currentTarget)},U=J=>{i&&console.log("Header: handleMenuClose",J),R(null),J==="download-mblog"?(s("Matterbridge","Downloading matterbridge log..."),n("Downloading matterbridge log...",5),window.location.href="./api/download-mblog"):J==="download-mjlog"?(s("Matterbridge","Downloading matter log..."),n("Downloading matter log...",5),window.location.href="./api/download-mjlog"):J==="view-mblog"?(s("Matterbridge","Loading matterbridge log..."),n("Loading matterbridge log...",5),window.location.href="./api/view-mblog"):J==="view-mjlog"?(s("Matterbridge","Loading matter log..."),n("Loading matter log...",5),window.location.href="./api/view-mjlog"):J==="view-shellylog"?(s("Matterbridge","Loading shelly system log..."),n("Loading shelly system log...",5),window.location.href="./api/shellyviewsystemlog"):J==="download-mbstorage"?(s("Matterbridge","Downloading matterbridge storage..."),n("Downloading matterbridge storage...",5),window.location.href="./api/download-mbstorage"):J==="download-pluginstorage"?(s("Matterbridge","Downloading matterbridge plugins storage..."),n("Downloading matterbridge plugins storage...",5),window.location.href="./api/download-pluginstorage"):J==="download-pluginconfig"?(s("Matterbridge","Downloading matterbridge plugins config..."),n("Downloading matterbridge plugins config...",5),window.location.href="./api/download-pluginconfig"):J==="download-mjstorage"?(s("Matterbridge","Downloading matter storage..."),n("Downloading matter storage...",5),window.location.href="./api/download-mjstorage"):J==="download-backup"?(s("Matterbridge","Downloading backup..."),n("Downloading backup...",10),window.location.href="./api/download-backup"):J==="update"?k():J==="updatedev"?ee():J==="updatecheck"?xe():J==="shelly-sys-update"?Se():J==="shelly-main-update"?z():J==="shelly-create-system-log"?M():J==="shelly-download-system-log"?I():J==="softreset"?W():J==="hardreset"?ae():J==="restart"?w():J==="shutdown"?x():J==="reboot"?d():J==="create-backup"?o({id:C.current,sender:"Header",method:"/api/create-backup",src:"Frontend",dst:"Matterbridge",params:{}}):J==="unregister"?o({id:C.current,sender:"Header",method:"/api/unregister",src:"Frontend",dst:"Matterbridge",params:{}}):J==="reset"?o({id:C.current,sender:"Header",method:"/api/reset",src:"Frontend",dst:"Matterbridge",params:{}}):J==="factoryreset"&&o({id:C.current,sender:"Header",method:"/api/factoryreset",src:"Frontend",dst:"Matterbridge",params:{}})},ce=J=>{i&&console.log("Header: handleMenuCloseCancel:",J),R(null)},ge=J=>{_(J.currentTarget)},ne=()=>{_(null)},be=J=>{Y(J.currentTarget)},se=()=>{Y(null)},me=J=>{h(J.currentTarget)},K=()=>{h(null)},ue=J=>{D(J.currentTarget)},ve=()=>{D(null)},Je=()=>{Gn(),i&&console.log("Matterbridge logo clicked: debug is now",i)};return r.useEffect(()=>{const J=ie=>{ie.src==="Matterbridge"&&ie.dst==="Frontend"&&(ie.id===C.current&&ie.method==="/api/settings"&&(i&&console.log("Header received settings:",ie.response),E(ie.response),S(ie.response.matterbridgeInformation.restartRequired||ie.response.matterbridgeInformation.fixedRestartRequired),v(ie.response.matterbridgeInformation.fixedRestartRequired),O(ie.response.matterbridgeInformation.updateRequired)),ie.method==="refresh_required"&&(ie.params.changed===null||ie.params.changed==="matterbridgeLatestVersion"||ie.params.changed==="matterbridgeAdvertise"||ie.params.changed==="fabrics")&&(i&&console.log(`Header received refresh_required: changed=${ie.params.changed}`),o({id:C.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),ie.method==="restart_required"&&(i&&console.log(`Header received restart_required with fixed: ${ie.params.fixed}`),S(!0),ie.params.fixed===!0&&v(!0)),ie.method==="restart_not_required"&&(i&&console.log("Header received restart_not_required"),S(!1)),ie.method==="update_required"&&(i&&console.log("Header received update_required"),O(!0)),ie.method==="update_required_dev"&&(i&&console.log("Header received update_required_dev"),P(!0)),ie.id===or&&(i&&console.log("Header received WS_ID_SHELLY_SYS_UPDATE:"),E(Te=>({...Te,matterbridgeInformation:{...Te.matterbridgeInformation,shellySysUpdate:ie.params.available}}))),ie.id===nr&&(i&&console.log("Header received WS_ID_SHELLY_MAIN_UPDATE:"),E(Te=>({...Te,matterbridgeInformation:{...Te.matterbridgeInformation,shellyMainUpdate:ie.params.available}}))))};return m(J),i&&console.log(`Header added WebSocket listener id ${C.current}`),()=>{b(J),i&&console.log("Header removed WebSocket listener")}},[m,b,o,n]),r.useEffect(()=>{a&&(i&&console.log("Header sending /api/settings requests"),o({id:C.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}))},[a,o]),i&&console.log("Header rendering..."),!a||!p?null:e.jsxs("div",{className:"header",children:[e.jsxs("div",{className:"sub-header",children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"30px"},onClick:Je}),e.jsx("h2",{style:{fontSize:"22px",color:"var(--main-icon-color)",margin:"0px"},children:"Matterbridge"}),e.jsxs("nav",{children:[e.jsx(at,{to:"/",className:"nav-link",children:"Home"}),e.jsx(at,{to:"/devices",className:"nav-link",children:"Devices"}),e.jsx(at,{to:"/log",className:"nav-link",children:"Logs"}),e.jsx(at,{to:"/settings",className:"nav-link",children:"Settings"})]})]}),e.jsxs("div",{className:"sub-header",children:[!p.matterbridgeInformation.readOnly&&T&&e.jsx(H,{title:"New Matterbridge version available, click to install",children:e.jsxs("span",{className:"status-warning",onClick:k,children:["Update to v.",p.matterbridgeInformation.matterbridgeLatestVersion]})}),!p.matterbridgeInformation.readOnly&&y&&e.jsx(H,{title:"New Matterbridge dev version available, click to install",children:e.jsxs("span",{className:"status-warning",onClick:ee,children:["Update to new dev v.",p.matterbridgeInformation.matterbridgeDevVersion.split("-dev-")[0]]})}),!p.matterbridgeInformation.readOnly&&e.jsx(H,{title:"Matterbridge version, click to see the changelog",children:e.jsxs("span",{className:"status-information",onClick:j,children:["v.",p.matterbridgeInformation.matterbridgeVersion]})}),p.matterbridgeInformation.shellyBoard&&e.jsx("img",{src:"Shelly.svg",alt:"Shelly Icon",style:{height:"30px",padding:"0px",margin:"0px",marginRight:"30px"}}),p.matterbridgeInformation.shellyBoard&&p.matterbridgeInformation.xxxmatterbridgeVersion&&e.jsx(H,{title:"Matterbridge version",children:e.jsxs("span",{style:{fontSize:"12px",color:"var(--main-icon-color)"},onClick:j,children:["v.",p.matterbridgeInformation.matterbridgeVersion]})}),p.matterbridgeInformation.bridgeMode!==""&&p.matterbridgeInformation.readOnly===!1?e.jsx(H,{title:"Bridge mode",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:p.matterbridgeInformation.bridgeMode})}):null,p.matterbridgeInformation.restartMode!==""&&p.matterbridgeInformation.readOnly===!1?e.jsx(H,{title:"Restart mode",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:p.matterbridgeInformation.restartMode})}):null,p.matterbridgeInformation.profile&&p.matterbridgeInformation.profile!==""&&p.matterbridgeInformation.readOnly===!1?e.jsx(H,{title:"Current profile",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:p.matterbridgeInformation.profile})}):null]}),e.jsxs("div",{className:"sub-header",style:{gap:"5px"},children:[p.matterbridgeInformation.readOnly===!1?e.jsx(H,{title:"Matterbridge discord group",children:e.jsx("img",{src:"discord.svg",alt:"Discord Logo",style:{cursor:"pointer",height:"25px"},onClick:u})}):null,p.matterbridgeInformation.readOnly===!1?e.jsx(H,{title:"Give a star to Matterbridge",children:e.jsx(B,{style:{color:"#FFD700",margin:"0",padding:"0"},onClick:$,children:e.jsx(wr,{})})}):null,p.matterbridgeInformation.readOnly===!1?e.jsx(H,{title:"Sponsor Matterbridge",children:e.jsx(B,{style:{color:"#b6409c",margin:"0",padding:"0"},onClick:X,children:e.jsx(Yt,{})})}):null,e.jsx(H,{title:"Matterbridge help",children:e.jsx(B,{style:{color:"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:he,children:e.jsx(Mr,{})})}),e.jsx(H,{title:"Matterbridge changelog",children:e.jsx(B,{style:{color:"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:j,children:e.jsx(Xt,{})})}),p.matterbridgeInformation&&!p.matterbridgeInformation.readOnly&&e.jsx(H,{title:"Update matterbridge to latest version",children:e.jsx(B,{style:{color:T?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:k,children:e.jsx(Ve,{})})}),p.matterbridgeInformation&&p.matterbridgeInformation.shellyBoard&&p.matterbridgeInformation.shellySysUpdate&&e.jsx(H,{title:"Shelly system update",children:e.jsx(B,{style:{color:"var(--primary-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:Se,children:e.jsx(Ve,{})})}),p.matterbridgeInformation&&p.matterbridgeInformation.shellyBoard&&p.matterbridgeInformation.shellyMainUpdate&&e.jsx(H,{title:"Shelly software update",children:e.jsx(B,{style:{color:"var(--primary-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:z,children:e.jsx(Ve,{})})}),e.jsx(H,{title:"Restart matterbridge",children:e.jsx(B,{style:{color:g||F?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:w,children:e.jsx(bt,{})})}),p.matterbridgeInformation.restartMode===""?e.jsx(H,{title:"Shut down matterbridge",children:e.jsx(B,{style:{color:g||F?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:x,children:e.jsx(ze,{})})}):null,e.jsx(H,{title:"Download, backup and more",children:e.jsx(B,{onClick:le,children:e.jsx(Ir,{style:{color:"var(--main-icon-color)"}})})}),e.jsxs(et,{id:"command-menu",anchorEl:L,keepMounted:!0,open:!!L,onClose:()=>U(""),children:[p.matterbridgeInformation&&!p.matterbridgeInformation.readOnly&&e.jsxs(N,{onClick:()=>U("update"),children:[e.jsx(Q,{children:e.jsx(Ve,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Install latest stable",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),p.matterbridgeInformation&&!p.matterbridgeInformation.readOnly&&e.jsxs(N,{onClick:()=>U("updatedev"),children:[e.jsx(Q,{children:e.jsx(Ve,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Install latest dev",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),p.matterbridgeInformation&&!p.matterbridgeInformation.readOnly&&e.jsxs(N,{onClick:()=>U("updatecheck"),children:[e.jsx(Q,{children:e.jsx(Ve,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Check for updates",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),p.matterbridgeInformation&&p.matterbridgeInformation.shellyBoard&&p.matterbridgeInformation.shellySysUpdate&&e.jsxs(N,{onClick:()=>U("shelly-sys-update"),children:[e.jsx(Q,{children:e.jsx(Ve,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Shelly system update",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),p.matterbridgeInformation&&p.matterbridgeInformation.shellyBoard&&p.matterbridgeInformation.shellyMainUpdate&&e.jsxs(N,{onClick:()=>U("shelly-main-update"),children:[e.jsx(Q,{children:e.jsx(Ve,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Shelly software update",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(N,{onClick:()=>U("restart"),children:[e.jsx(Q,{children:e.jsx(bt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Restart",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),p.matterbridgeInformation.restartMode===""?e.jsxs(N,{onClick:()=>U("shutdown"),children:[e.jsx(Q,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Shutdown",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}):null,p.matterbridgeInformation&&p.matterbridgeInformation.shellyBoard&&e.jsxs(N,{onClick:()=>{c("Reboot","Are you sure you want to reboot the Shelly board?","reboot",U,ce)},children:[e.jsx(Q,{children:e.jsx(bt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Reboot...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsx(st,{}),e.jsxs(N,{onClick:be,children:[e.jsx(Q,{children:e.jsx(lt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"View",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(et,{id:"sub-menu-view",anchorEl:q,keepMounted:!0,open:!!q,onClose:se,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(N,{onClick:()=>{U("view-mblog"),se()},children:[e.jsx(Q,{children:e.jsx(lt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matterbridge log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(N,{onClick:()=>{U("view-mjlog"),se()},children:[e.jsx(Q,{children:e.jsx(lt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matter log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),p.matterbridgeInformation&&p.matterbridgeInformation.shellyBoard&&e.jsxs(N,{onClick:()=>{U("view-shellylog"),se()},children:[e.jsx(Q,{children:e.jsx(lt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(st,{}),e.jsxs(N,{onClick:me,children:[e.jsx(Q,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Download",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(et,{id:"sub-menu-download",anchorEl:l,keepMounted:!0,open:!!l,onClose:K,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(N,{onClick:()=>{U("download-mbstorage"),K()},children:[e.jsx(Q,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matterbridge storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(N,{onClick:()=>{U("download-pluginstorage"),K()},children:[e.jsx(Q,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matterbridge plugins storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(N,{onClick:()=>{U("download-pluginconfig"),K()},children:[e.jsx(Q,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matterbridge plugins config",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(N,{onClick:()=>{U("download-mblog"),K()},children:[e.jsx(Q,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matterbridge log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(N,{onClick:()=>{U("download-mjstorage"),K()},children:[e.jsx(Q,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matter storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(N,{onClick:()=>{U("download-mjlog"),K()},children:[e.jsx(Q,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matter log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),p.matterbridgeInformation&&p.matterbridgeInformation.shellyBoard&&e.jsxs(N,{onClick:()=>{U("shelly-create-system-log"),K()},children:[e.jsx(Q,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Create Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),p.matterbridgeInformation&&p.matterbridgeInformation.shellyBoard&&e.jsxs(N,{onClick:()=>{U("shelly-download-system-log"),K()},children:[e.jsx(Q,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Download Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(st,{}),e.jsxs(N,{onClick:ge,children:[e.jsx(Q,{children:e.jsx(kt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(et,{id:"sub-menu-backup",anchorEl:V,keepMounted:!0,open:!!V,onClose:ne,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(N,{onClick:()=>{U("create-backup"),ne()},children:[e.jsx(Q,{children:e.jsx(kt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Create backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(N,{onClick:()=>{U("download-backup"),ne()},children:[e.jsx(Q,{children:e.jsx(kt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Download backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(st,{}),e.jsxs(N,{onClick:ue,children:[e.jsx(Q,{children:e.jsx(kr,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Reset",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(et,{id:"sub-menu-reset",anchorEl:f,keepMounted:!0,open:!!f,onClose:ve,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(N,{onClick:()=>{ve(),c("Reset all devices and shutdown","Are you sure you want to unregister all devices? This will temporarily remove all devices from the controller and you may loose the controller configuration.","unregister",U,ce)},children:[e.jsx(Q,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Reset all devices...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(N,{onClick:()=>{ve(),c("Reset commissioning and shutdown","Are you sure you want to reset the commissioning? You will have to manually remove Matterbridge from the controller.","reset",U,ce)},children:[e.jsx(Q,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Reset commissioning...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),!p.matterbridgeInformation.readOnly&&e.jsxs(N,{onClick:()=>{ve(),c("Factory reset and shutdown","Are you sure you want to factory reset Matterbridge? You will have to manually remove Matterbridge from the controller.","factoryreset",U,ce)},children:[e.jsx(Q,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Factory reset...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),p.matterbridgeInformation&&p.matterbridgeInformation.shellyBoard&&e.jsxs(N,{onClick:()=>{ve(),c("Network reset","Are you sure you want to factory reset the network parameters?","softreset",U,ce)},children:[e.jsx(Q,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Reset network...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),p.matterbridgeInformation&&p.matterbridgeInformation.shellyBoard&&e.jsxs(N,{onClick:()=>{ve(),c("Factory reset","Are you sure you want to factory reset Matterbridge? You will have to manually remove Matterbridge from the controller.","hardreset",U,ce)},children:[e.jsx(Q,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Factory reset...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]})]})]})]})}const Zo=()=>{let n=!1;return("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)&&(n=!0),n};function ar(){const{messages:n,autoScroll:c}=r.useContext(ir),[a,o]=r.useState(!1),s=r.useRef(null),m=()=>o(!0),b=()=>o(!1);return r.useEffect(()=>{c&&!a&&!Zo()&&s.current.scrollIntoView({behavior:"smooth"})},[n,a,c]),e.jsx("div",{style:{margin:"0px",padding:"0px"},children:e.jsxs("ul",{style:{margin:"0px",padding:"0px"},onMouseEnter:m,onMouseLeave:b,children:[n.map((t,g)=>e.jsx("li",{style:{wordWrap:"break-word",maxHeight:"200px",overflow:"hidden"},dangerouslySetInnerHTML:{__html:t}},g)),e.jsx("div",{ref:s})," "]})})}function qe(){const{retry:n}=r.useContext(fe),c=()=>{window.location.reload()};return e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",fontSize:"20px",flexDirection:"column",color:"var(--main-text-color)",height:"100vh",backgroundColor:"var(--main-bg-color)"},children:e.jsx(Z,{sx:{display:"flex",alignItems:"center",flexDirection:"column"},children:n<100?e.jsxs(e.Fragment,{children:[e.jsx(Dr,{style:{color:"var(--primary-color)"}}),e.jsxs("div",{style:{marginTop:"20px",color:"var(--primary-color)"},children:["Reconnecting to Matterbridge ","(attempt "+n+")","..."]})]}):e.jsxs("div",{style:{marginTop:"20px",color:"var(--primary-color)",textAlign:"center"},children:["Unable to connect to Matterbridge after multiple attempts.",e.jsx("br",{}),"Please check your network connection.",e.jsx("br",{}),e.jsx(oe,{variant:"contained",color:"primary",onClick:c,style:{marginTop:"20px"},children:"Refresh the Page"})]})})})}function en({value:n,maxChars:c}){let a=n;if(n.length>c&&c>3){const o=c-3,s=n.substring(0,Math.ceil(o/2)),m=n.substring(n.length-Math.floor(o/2),n.length);a=`${s} … ${m}`}return n!==a?e.jsx(H,{title:n,placement:"top",PopperProps:{modifiers:[{name:"offset",options:{offset:[0,12]}}]},children:e.jsx("span",{children:a})}):e.jsx("span",{children:a})}function tn({systemInfo:n,compact:c}){const[a,o]=r.useState(n),{sendMessage:s,addListener:m,removeListener:b}=r.useContext(fe);if(i&&console.log("SystemInfoTable:",a,"compact:",c),c&&a.totalMemory){const t=a.totalMemory,g=a.freeMemory;a.freeMemory=`${g} / ${t}`,delete a.totalMemory}if(c&&a.heapTotal){const t=a.heapTotal,g=a.heapUsed;a.heapUsed=`${g} / ${t}`,delete a.heapTotal}if(c&&a.osRelease){const t=a.osType,g=a.osRelease;a.osType=`${t} (${g})`,delete a.osRelease}if(c&&a.osArch){const t=a.osPlatform,g=a.osArch;a.osPlatform=`${t} (${g})`,delete a.osArch}return r.useEffect(()=>{i&&console.log("SystemInfoTable useEffect WebSocketMessage mounting");const t=g=>{g.src==="Matterbridge"&&g.dst==="Frontend"?(g.method==="memory_update"&&g.params&&g.params.totalMemory&&g.params.freeMemory&&(i&&console.log("SystemInfoTable received memory_update",g),o(S=>({...S,totalMemory:g.params.totalMemory,freeMemory:g.params.freeMemory,heapTotal:g.params.heapTotal,heapUsed:g.params.heapUsed,rss:g.params.rss}))),g.method==="cpu_update"&&g.params&&g.params.cpuUsage&&(i&&console.log("SystemInfoTable received cpu_update",g),o(S=>({...S,cpuUsage:g.params.cpuUsage.toFixed(2)+" %"}))),g.method==="uptime_update"&&g.params&&g.params.systemUptime&&g.params.processUptime&&(i&&console.log("SystemInfoTable received uptime_update",g),o(S=>({...S,systemUptime:g.params.systemUptime,processUptime:g.params.processUptime})))):i&&console.log("Test received WebSocketMessage:",g.method,g.src,g.dst,g.response)};return m(t),i&&console.log("SystemInfoTable useEffect WebSocketMessage mounted"),()=>{i&&console.log("SystemInfoTable useEffect WebSocketMessage unmounting"),b(t),i&&console.log("SystemInfoTable useEffect WebSocketMessage unmounted")}},[m,b,s]),a?(i&&console.log("SystemInfoTable rendering..."),e.jsxs("div",{className:"MbfWindowDiv",style:{minWidth:"302px",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"System Information"})}),e.jsx("div",{className:"MbfWindowDivTable",children:e.jsx("table",{style:{border:"none",borderCollapse:"collapse"},children:e.jsx("tbody",{style:{border:"none",borderCollapse:"collapse"},children:Object.entries(a).map(([t,g],S)=>e.jsxs("tr",{className:S%2===0?"table-content-even":"table-content-odd",style:{border:"none",borderCollapse:"collapse"},children:[e.jsx("td",{style:{border:"none",borderCollapse:"collapse"},children:t}),e.jsx("td",{style:{border:"none",borderCollapse:"collapse"},children:e.jsx(en,{value:typeof g!="string"?g.toString():g,maxChars:25})})]},t))})})})]})):null}const Ut={margin:"0px",padding:"0px",color:"var(--div-text-color)",transition:"color 0.2s ease","& svg":{display:"block"},"& svg path":{fill:"var(--div-text-color)",transition:"fill 0.2s ease"},"&:hover":{color:"var(--primary-color)"},"&:hover svg path":{fill:"var(--primary-color)"},"&:focus-visible":{outline:"2px solid var(--primary-color)",outlineOffset:"2px"}},rn=n=>{if(!n)return"";const c=n.toString().replace(/[^0-9]/g,"");if(c.length<5)return c;const a=c.slice(0,4),o=c.slice(4,7),s=c.slice(7,11);return[a,o,s].filter(Boolean).join("-")};function on({id:n}){const{online:c,sendMessage:a,addListener:o,removeListener:s}=r.useContext(fe),[m,b]=r.useState(null),[t,g]=r.useState(null),S=r.useRef(null);r.useEffect(()=>{i&&console.log(`QRDiv received storeId update "${n}"`),n&&(i&&console.log(`QRDiv sending data request for storeId "${n}"`),b(n),a({method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:n,server:!0}}))},[n]),r.useEffect(()=>{const P=p=>{p.src==="Matterbridge"&&p.dst==="Frontend"&&p.method==="refresh_required"&&p.params.changed==="matter"&&p.params.matter&&(i&&console.log(`QRDiv received refresh_required/matter for storeId "${p.params.matter.id}":`,p.params.matter),m===p.params.matter.id&&(i&&console.log(`QRDiv received refresh_required/matter: setting matter data for storeId "${p.params.matter.id}":`,p.params.matter),clearTimeout(S.current),p.params.matter.advertising&&p.params.matter.advertiseTime&&p.params.matter.advertiseTime+9e5<=Date.now()&&(p.params.matter.advertising=!1),g(p.params.matter),p.params.matter.advertising&&(i&&console.log(`QRDiv setting matter advertise timeout for storeId "${p.params.matter.id}":`,p.params.matter.advertiseTime+9e5-Date.now()),S.current=setTimeout(()=>{clearTimeout(S.current),i&&console.log(`QRDiv clearing advertising state for storeId "${p.params.matter.id}" after 15 minutes`),g(E=>({...E,advertising:!1}))},p.params.matter.advertiseTime+9e5-Date.now()))))};return o(P),i&&console.log("QRDiv webSocket effect mounted"),()=>{s(P),clearTimeout(S.current),i&&console.log("QRDiv webSocket effect unmounted")}},[m]);const F=()=>{i&&console.log(`QRDiv sent matter startCommission for node "${t.id}"`),t&&a({method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:t.id,startCommission:!0}})},v=()=>{i&&console.log(`QRDiv sent matter stopCommission for node "${t.id}"`),t&&a({method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:t.id,stopCommission:!0}})},T=()=>{i&&console.log(`QRDiv sent matter advertise for node "${t.id}"`),t&&a({method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:t.id,advertise:!0}})},O=P=>{i&&console.log(`QRDiv sent matter removeFabric for node "${t.id}" and fabricIndex ${P}`),t&&a({method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:t.id,removeFabric:P}})},y=async()=>{if(!t||!t.manualPairingCode)return;const P=t.manualPairingCode.toString();try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(P);else{const p=document.createElement("textarea");p.value=P,p.style.position="fixed",p.style.opacity="0",document.body.appendChild(p),p.focus(),p.select(),document.execCommand("copy"),document.body.removeChild(p)}i&&console.log("Manual pairing code copied to clipboard")}catch(p){console.error("Failed to copy manual pairing code",p)}};return!t||!c?(i&&console.log("QRDiv rendering undefined state"),null):t.advertising&&t.qrPairingCode&&t.manualPairingCode?(i&&console.log("QRDiv rendering advertising state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"QR pairing code"}),e.jsxs("div",{className:"MbfWindowHeaderFooterIcons",children:[e.jsx(B,{"aria-label":"send advertising",size:"small",onClick:T,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(H,{title:"Send again the mDNS advertisement",arrow:!0,children:e.jsx(te,{path:_t,size:"22px"})})}),e.jsx(B,{"aria-label":"stop pairing",size:"small",onClick:v,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(H,{title:"Turn off pairing",arrow:!0,children:e.jsx(te,{path:go,size:"22px"})})})]})]}),e.jsx("p",{className:"MbfWindowHeaderText",style:{overflow:"hidden",maxWidth:"280px",textOverflow:"ellipsis",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:m}),e.jsx(uo,{value:t.qrPairingCode,size:256,level:"M",fgColor:"var(--div-text-color)",bgColor:"var(--div-bg-color)",style:{margin:"20px"}}),e.jsxs("div",{className:"MbfWindowFooter",style:{justifyContent:"space-between"},children:[e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Manual pairing code: ",rn(t.manualPairingCode)]}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(H,{title:"Copy manual pairing code",arrow:!0,children:e.jsx(B,{"aria-label":"copy manual pairing code",size:"small",onClick:y,sx:Ut,children:e.jsx(te,{path:mo,size:.85})})})})]})]})):t.commissioned&&t.fabricInformations&&t.sessionInformations?(i&&console.log("QRDiv rendering commissioned state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px",overflow:"hidden"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Paired fabrics"}),e.jsxs("div",{className:"MbfWindowHeaderFooterIcons",children:[e.jsx(B,{"aria-label":"send advertising",size:"small",onClick:T,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(H,{title:"Send again the mDNS advertisement",arrow:!0,children:e.jsx(te,{path:_t,size:"22px"})})}),e.jsx(B,{"aria-label":"start pairing",size:"small",onClick:F,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(H,{title:"Turn on pairing",arrow:!0,children:e.jsx(te,{path:$t,size:"22px"})})})]})]}),e.jsxs("div",{className:"MbfWindowBodyColumn",style:{paddingTop:"0px"},children:[e.jsx("p",{className:"MbfWindowHeaderText thin-scroll",style:{overflowX:"auto",maxWidth:"280px",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:m}),t.fabricInformations.map((P,p)=>e.jsxs("div",{style:{margin:"0px",padding:"10px",gap:"0px",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",textAlign:"left",fontSize:"14px"},children:[e.jsxs("div",{style:{marginLeft:"20px",marginBottom:"10px",display:"flex",flexDirection:"row",justifyContent:"space-between",gap:"20px",alignItems:"center"},children:[e.jsxs("p",{className:"status-blue",style:{margin:"0px",padding:"3px 10px",width:"200px",fontSize:"14px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},children:["Fabric: ",P.fabricIndex]}),e.jsx(H,{title:"Remove the fabric. You will need to remove it also from the controller.",arrow:!0,children:e.jsx(B,{"aria-label":"remove the fabric",size:"small",onClick:()=>O(P.fabricIndex),sx:{...Ut,padding:"2px"},children:e.jsx(te,{path:ho,size:1})})})]}),e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Vendor: ",P.rootVendorId," ",P.rootVendorName]}),P.label!==""&&e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Label: ",P.label]}),e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Sessions: ",t.sessionInformations?t.sessionInformations.filter(E=>E.fabric.fabricIndex===P.fabricIndex&&E.isPeerActive===!0).length:"0"," ","subscriptions: ",t.sessionInformations?t.sessionInformations.filter(E=>E.fabric.fabricIndex===P.fabricIndex&&E.isPeerActive===!0&&E.numberOfActiveSubscriptions>0).length:"0"]})]},p))]}),e.jsx("div",{className:"MbfWindowFooter",children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Serial number: ",t.serialNumber]})})]})):!t.commissioned&&!t.advertising?(i&&console.log("QRDiv rendering not commissioned and not advertising state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px"},children:[e.jsx("div",{className:"MbfWindowHeader",style:{height:"30px"},children:e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"QR pairing code"})}),e.jsx("p",{className:"MbfWindowHeaderText thin-scroll",style:{overflowX:"auto",maxWidth:"280px",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:m}),e.jsx(oe,{onClick:F,endIcon:e.jsx(te,{path:$t,size:1}),style:{margin:"20px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:"Turn on pairing"}),e.jsx("div",{className:"MbfWindowFooter",children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Serial number: ",t.serialNumber]})})]})):(i&&console.log("QRDiv rendering unknown state"),null)}function nn(){const{logMessage:n,sendMessage:c,getUniqueId:a}=r.useContext(fe),[o,s]=r.useState("matterbridge-"),[m,b]=r.useState(!1),[t,g]=Oe.useState(null),S=r.useRef(a()),F=L=>{L.preventDefault(),b(!0)},v=()=>{b(!1)},T=L=>{L.preventDefault(),b(!1);const R=L.dataTransfer.files[0];if(R){n("Plugins",`Installing package ${R.name}. Please wait...`);const V=new FormData;V.append("file",R),V.append("filename",R.name),fetch("./api/uploadpackage",{method:"POST",body:V}).then(_=>_.text()).then(_=>{n("Plugins",`Server response: ${_}`)}).catch(_=>{console.error("Error uploading plugin file:",_),n("Plugins",`Error installing package ${_}`)})}},O=L=>{const R=L.target.files[0];if(R){n("Plugins",`Uploading package ${R.name}`);const V=new FormData;V.append("file",R),V.append("filename",R.name),fetch("./api/uploadpackage",{method:"POST",body:V}).then(_=>_.text()).then(_=>{n("Plugins",`Server response: ${_}`)}).catch(_=>{console.error("Error uploading plugin file:",_),n("Plugins",`Error uploading package ${_}`)})}},y=()=>{c({id:S.current,sender:"InstallPlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:o,restart:!1}})},P=()=>{document.getElementById("file-upload").click()},p=()=>{c({id:S.current,sender:"InstallPlugins",method:"/api/addplugin",src:"Frontend",dst:"Matterbridge",params:{pluginNameOrPath:o}})},E=L=>{g(L.currentTarget)},C=L=>{L!==""&&s(L),g(null)};return i&&console.log("AddRemovePlugins rendering..."),e.jsxs("div",{style:{display:"flex",flexDirection:"row",flex:"1 1 auto",alignItems:"center",justifyContent:"space-between",margin:"0px",padding:"10px",gap:"20px"},onDragOver:F,onDragLeave:v,onDrop:T,children:[e.jsx(pe,{value:o,onChange:L=>{s(L.target.value)},size:"small",id:"plugin-name",label:"Plugin name or plugin path",variant:"outlined",fullWidth:!0}),e.jsx(B,{onClick:E,children:e.jsx(Nr,{})}),e.jsxs(et,{id:"simple-menu",anchorEl:t,keepMounted:!0,open:!!t,onClose:()=>C(""),children:[e.jsx(N,{onClick:()=>C("matterbridge-zigbee2mqtt"),children:"matterbridge-zigbee2mqtt"}),e.jsx(N,{onClick:()=>C("matterbridge-somfy-tahoma"),children:"matterbridge-somfy-tahoma"}),e.jsx(N,{onClick:()=>C("matterbridge-shelly"),children:"matterbridge-shelly"}),e.jsx(N,{onClick:()=>C("matterbridge-hass"),children:"matterbridge-hass"}),e.jsx(N,{onClick:()=>C("matterbridge-webhooks"),children:"matterbridge-webhooks"}),e.jsx(N,{onClick:()=>C("matterbridge-bthome"),children:"matterbridge-bthome"}),e.jsx(N,{onClick:()=>C("matterbridge-test"),children:"matterbridge-test"}),e.jsx(N,{onClick:()=>C("matterbridge-example-accessory-platform"),children:"matterbridge-example-accessory-platform"}),e.jsx(N,{onClick:()=>C("matterbridge-example-dynamic-platform"),children:"matterbridge-example-dynamic-platform"}),e.jsx(N,{onClick:()=>C("matterbridge-eve-door"),children:"matterbridge-eve-door"}),e.jsx(N,{onClick:()=>C("matterbridge-eve-motion"),children:"matterbridge-eve-motion"}),e.jsx(N,{onClick:()=>C("matterbridge-eve-energy"),children:"matterbridge-eve-energy"}),e.jsx(N,{onClick:()=>C("matterbridge-eve-weather"),children:"matterbridge-eve-weather"}),e.jsx(N,{onClick:()=>C("matterbridge-eve-room"),children:"matterbridge-eve-room"})]}),e.jsx(H,{title:"Install or update a plugin from npm",children:e.jsx(oe,{onClick:y,endIcon:e.jsx(He,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Install"})}),e.jsx(H,{title:"Upload and install a plugin from a tarball",children:e.jsx(oe,{onClick:P,endIcon:e.jsx(Pr,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Upload"})}),e.jsx(H,{title:"Add an installed plugin",children:e.jsx(oe,{onClick:p,endIcon:e.jsx(vt,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Add"})}),e.jsx("input",{id:"file-upload",type:"file",accept:".tgz",style:{display:"none"},onChange:O})]})}function Ye({status:n,enabledText:c="Enabled",disabledText:a=void 0,tooltipText:o=void 0,onClick:s}){if(n===void 0)return e.jsx("div",{style:{margin:"-2.5px"},children:e.jsx("div",{})});{const m=e.jsx("div",{className:n?"status-enabled":"status-disabled",style:{cursor:"default"},onClick:s,children:n?c:a??c});return o!==void 0?e.jsx(H,{title:o,children:m}):m}}const Xe={fontSize:"16px",fontWeight:"bold",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},Ze={fontSize:"12px",fontWeight:"normal",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},an={fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)",backgroundColor:"var(--div-bg-color)"},sn={fontSize:"16px",fontWeight:"bold",backgroundColor:"var(--div-bg-color)"},Ee={padding:"0px",margin:"0px"},ln="5px 10px 5px 10px",mt={},je={},ht={},xt={};let ft=[],qt=[];const dn=({open:n,onClose:c,plugin:a})=>{const{sendMessage:o,addListener:s,removeListener:m,getUniqueId:b}=r.useContext(fe),t=r.useRef(b()),[g,S]=r.useState(a.configJson),[F,v]=r.useState(a.schemaJson),[T,O]=r.useState({"ui:submitButtonOptions":{submitText:"Confirm"},"ui:globalOptions":{orderable:!0}}),[y,P]=r.useState("");let p={};r.useEffect(()=>{const M=I=>{I.src==="Matterbridge"&&I.dst==="Frontend"&&(I.id===t.current&&I.method==="/api/select/devices"&&(I.response&&(ft=I.response),I.error&&console.error("ConfigPluginDialog received /api/select/devices error:",I.error)),I.id===t.current&&I.method==="/api/select/entities"&&(I.response&&(qt=I.response),I.error&&console.error("ConfigPluginDialog received /api/select/entities error:",I.error)))};return s(M),g!==void 0&&F!==void 0&&(Object.keys(F.properties).forEach(I=>{Object.keys(F.properties[I]).forEach(w=>{w.startsWith("ui:")&&(T[I]={},T[I][w]=F.properties[I][w],delete F.properties[I][w])})}),O(T)),a.name!==void 0&&a.configJson!==void 0&&a.schemaJson!==void 0&&(S(a.configJson),v(a.schemaJson),o({id:t.current,sender:"ConfigPlugin",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:a.name}}),o({id:t.current,sender:"ConfigPlugin",method:"/api/select/entities",src:"Frontend",dst:"Matterbridge",params:{plugin:a.name}})),()=>{m(M)}},[s,g,a,m,F,o,T]);const E=({formData:M})=>{p=M},C=({formData:M})=>{S(M),a.configJson=M,a.restartRequired=!0,o({id:t.current,sender:"ConfigPlugin",method:"/api/savepluginconfig",src:"Frontend",dst:"Matterbridge",params:{pluginName:M.name,formData:M}}),c()};function L(M){const{id:I,label:w,onKeyChange:x,onDropPropertyClick:d,disabled:W,schema:ae,children:le,registry:U,readonly:ce,required:ge}=M,{templates:ne}=U,{RemoveButton:be}=ne.ButtonTemplates;if(!(Ao in ae))return e.jsx(Z,{sx:{display:"flex",flexDirection:"column",flexGrow:1,padding:0,margin:0,border:"none"},children:le});const me=({target:K})=>x(K&&K.value);return e.jsxs(Z,{sx:{display:"flex",flexDirection:"row",flexGrow:1,padding:0,margin:0,border:"none"},children:[e.jsx(pe,{id:`${I}-key`,name:`${I}-key`,required:ge,disabled:W||ce,defaultValue:w,onBlur:ce?void 0:me,type:"text",variant:"outlined",sx:{width:"250px",minWidth:"250px",maxWidth:"250px",marginRight:"20px"}}),e.jsx(Z,{sx:{flex:1},children:le}),e.jsx(be,{disabled:W||ce,onClick:d(w)})]})}function R(M){const{children:I,description:w,displayLabel:x,errors:d,help:W,hidden:ae,_id:le,_label:U,registry:ce,uiSchema:ge}=M,ne=_o(ge),be=$o("WrapIfAdditionalTemplate",ce,ne);return ae?e.jsx("div",{style:{display:"none"},children:I}):e.jsx(Z,{sx:{display:"flex",flexDirection:"column",flexGrow:1,padding:0,margin:0,border:"none"},children:e.jsxs(be,{...M,children:[x===!0&&w,I,d,W]})})}function V(M){const{description:I}=M;return I?e.jsx(de,{sx:Ze,children:I}):null}function _(M){const{required:I,title:w}=M;return w?e.jsx(Z,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:e.jsxs(de,{sx:Xe,children:["Title ",w," ",I&&e.jsx("mark",{children:"***"})]})}):null}function q(M){const{help:I,_idSchema:w}=M;return I?e.jsx(Z,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:e.jsx(de,{sx:an,children:I})}):null}function Y(M){const{errors:I}=M;return I?e.jsxs(Z,{sx:{padding:"10px",margin:"10px",border:"1px solid grey"},children:[e.jsx(de,{color:"error",sx:sn,children:"Please fix the following errors:"}),e.jsx(ot,{children:I.map((w,x)=>e.jsxs(Wr,{children:[e.jsx(Q,{children:e.jsx(Tr,{color:"error"})}),e.jsx(re,{primary:w.stack})]},x))})]}):null}function l(M){const{errors:I}=M;return I?e.jsx(Z,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:I.map((w,x)=>e.jsxs(de,{color:"error",variant:"body2",sx:{marginLeft:1},children:["This field ",w]},x))}):null}function h(M){const{id:I,name:w,_schema:x,_uiSchema:d,value:W,options:ae,label:le,type:U,placeholder:ce,required:ge,disabled:ne,readonly:be,autofocus:se,onChange:me,onChangeOverride:K,onBlur:ue,onFocus:ve,_rawErrors:Je,_hideError:J,_registry:ie,_formContext:Te}=M,Fe=({target:{value:ye}})=>me(ye===""?ae.emptyValue:ye),Le=({target:ye})=>ue(I,ye&&ye.value),Ae=({target:ye})=>ve(I,ye&&ye.value);return e.jsx(Z,{sx:{padding:"0px",margin:"0px"},children:e.jsx(pe,{id:I,name:I,label:ce&&ce!==""?le:void 0,variant:"outlined",placeholder:ce&&ce!==""?ce:le,required:ge,disabled:ne||be,autoFocus:se,value:W||W===0?W:"",type:U,autoComplete:U==="password"?"current-password":w,onChange:K||Fe,onBlur:Le,onFocus:Ae,fullWidth:!0})})}function f(M){return console.log("ArrayFieldTitleTemplate:",M),null}function D(M){return console.log("ArrayFieldDescriptionTemplate:",M),null}function X(M){return console.log("ArrayFieldItemTemplate:",M),null}function he(M){const{canAdd:I,_className:w,_disabled:x,_formContext:d,_formData:W,_idSchema:ae,_items:le,onAddClick:U,_rawErrors:ce,_readonly:ge,_registry:ne,_required:be,schema:se,title:me,_uiSchema:K}=M,[ue,ve]=r.useState(!1),[Je,J]=r.useState(!1),[ie,Te]=r.useState(!1),[Fe,Le]=r.useState(""),Ae=A=>{Le(A.target.value)},ye=()=>{ve(!ue)},Ge=()=>{J(!Je)},Qe=()=>{Te(!ie)},St=A=>{ve(!1),se.selectFrom==="serial"?se.items.default=A.serial:se.selectFrom==="name"&&(se.items.default=A.name),U()},wt=A=>{J(!1),se.selectEntityFrom==="name"?se.items.default=A.name:se.selectEntityFrom==="description"&&(se.items.default=A.description),U()},Mt=A=>{Te(!1),se.selectDeviceEntityFrom==="name"?se.items.default=A.name:se.selectDeviceEntityFrom==="description"&&(se.items.default=A.description),U()};return e.jsxs(Z,{sx:{margin:"0px",padding:"5px 10px 5px 10px",border:"1px solid grey"},children:[me&&e.jsxs(Z,{sx:{margin:"0px",padding:"0px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[me&&e.jsx(de,{sx:Xe,children:me}),I&&e.jsxs(Z,{sx:{margin:"0px",padding:"0px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[se.selectFrom&&e.jsx(H,{title:"Add a device from the list",children:e.jsx(B,{onClick:ye,size:"small",color:"primary",sx:Ee,children:e.jsx(dt,{})})}),se.selectEntityFrom&&e.jsx(H,{title:"Add an entity from the list",children:e.jsx(B,{onClick:Ge,size:"small",color:"primary",sx:Ee,children:e.jsx(dt,{})})}),se.selectDeviceEntityFrom&&e.jsx(H,{title:"Add a device entity from the list",children:e.jsx(B,{onClick:Qe,size:"small",color:"primary",sx:Ee,children:e.jsx(dt,{})})}),e.jsx(H,{title:"Add a new item",children:e.jsx(B,{onClick:U,size:"small",color:"primary",sx:Ee,children:e.jsx(vt,{})})})]})]}),se.description&&e.jsx(de,{sx:Ze,children:se.description}),M.items.map(A=>e.jsxs(Z,{sx:{margin:"2px 0px",padding:"0px",display:"flex",alignItems:"center"},children:[e.jsx(Z,{sx:{flexGrow:1,marginRight:"10px"},children:A.children}),e.jsx(B,{disabled:!A.hasMoveUp,onClick:A.onReorderClick(A.index,A.index-1),size:"small",color:"primary",sx:Ee,children:e.jsx(Lt,{})}),e.jsx(B,{disabled:!A.hasMoveDown,onClick:A.onReorderClick(A.index,A.index+1),size:"small",color:"primary",sx:Ee,children:e.jsx(Ft,{})}),e.jsx(B,{onClick:A.onDropIndexClick(A.index),size:"small",color:"primary",sx:Ee,children:e.jsx(jt,{})})]},A.index)),e.jsxs(Ie,{open:ue,onClose:ye,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(ke,{children:"Select a device"}),e.jsxs(De,{children:[e.jsxs(Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(de,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(pe,{fullWidth:!0,variant:"outlined",value:Fe,onChange:Ae,placeholder:"Enter serial or name"})]}),e.jsx(ot,{dense:!0,children:ft.filter(A=>A.serial.toLowerCase().includes(Fe.toLowerCase())||A.name.toLowerCase().includes(Fe.toLowerCase())).map((A,we)=>e.jsxs(ct,{onClick:()=>St(A),sx:mt,children:[A.icon==="wifi"&&e.jsx(Q,{children:e.jsx(nt,{style:je})}),A.icon==="ble"&&e.jsx(Q,{children:e.jsx(pt,{style:je})}),A.icon==="hub"&&e.jsx(Q,{children:e.jsx(ut,{style:je})}),e.jsx(re,{primary:A.name,secondary:A.serial,primaryTypographyProps:{style:ht},secondaryTypographyProps:{style:xt}})]},we))})]}),e.jsx(Ne,{children:e.jsx(oe,{onClick:ye,children:"Close"})})]}),e.jsxs(Ie,{open:Je,onClose:Ge,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(ke,{children:"Select an entity"}),e.jsxs(De,{children:[e.jsxs(Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(de,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(pe,{fullWidth:!0,variant:"outlined",value:Fe,onChange:Ae,placeholder:"Enter name or description"})]}),e.jsx(ot,{dense:!0,children:qt.filter(A=>A.name.toLowerCase().includes(Fe.toLowerCase())||A.description.toLowerCase().includes(Fe.toLowerCase())).map((A,we)=>e.jsxs(ct,{onClick:()=>wt(A),sx:mt,children:[A.icon==="wifi"&&e.jsx(Q,{children:e.jsx(nt,{style:je})}),A.icon==="ble"&&e.jsx(Q,{children:e.jsx(pt,{style:je})}),A.icon==="hub"&&e.jsx(Q,{children:e.jsx(ut,{style:je})}),A.icon==="component"&&e.jsx(Q,{children:e.jsx(Ht,{style:je})}),A.icon==="matter"&&e.jsx(Q,{children:e.jsx(Ot,{style:je})}),e.jsx(re,{primary:A.name,secondary:A.description,primaryTypographyProps:{style:ht},secondaryTypographyProps:{style:xt}})]},we))})]}),e.jsx(Ne,{children:e.jsx(oe,{onClick:Ge,children:"Close"})})]}),e.jsxs(Ie,{open:ie,onClose:Qe,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsxs(ke,{children:["Select an entity for ",me]}),e.jsx(De,{children:e.jsx(ot,{dense:!0,children:ft.filter(A=>A.serial===me||A.name===me).map(A=>A.entities?.map((we,It)=>e.jsxs(ct,{onClick:()=>Mt(we),sx:mt,children:[we.icon==="wifi"&&e.jsx(Q,{children:e.jsx(nt,{style:je})}),we.icon==="ble"&&e.jsx(Q,{children:e.jsx(pt,{style:je})}),we.icon==="hub"&&e.jsx(Q,{children:e.jsx(ut,{style:je})}),we.icon==="component"&&e.jsx(Q,{children:e.jsx(Ht,{style:je})}),we.icon==="matter"&&e.jsx(Q,{children:e.jsx(Ot,{style:je})}),e.jsx(re,{primary:we.name,secondary:we.description,primaryTypographyProps:{style:ht},secondaryTypographyProps:{style:xt}})]},It)))})}),e.jsx(Ne,{children:e.jsx(oe,{onClick:Qe,children:"Close"})})]})]})}function j(M){const{onAddClick:I,schema:w,properties:x,title:d,description:W}=M,[ae,le]=r.useState(!1),[U,ce]=r.useState(""),ge=K=>{ce(K.target.value)},ne=()=>{le(!ae)},be=K=>{le(!1);let ue="";w.selectFrom==="serial"?ue=K.serial:w.selectFrom==="name"&&(ue=K.name),P(ue),I(w)()},se=()=>{I(w)()},me=!w.additionalProperties;return!me&&y!==""&&x.forEach(K=>{if(K.name==="newKey"&&K.content.key==="newKey"&&K.content.props.name==="newKey"&&K.content.props.onKeyChange&&y!==""){const ue=y;P(""),K.content.props.onKeyChange(ue)}}),e.jsxs(Z,{sx:{margin:"0px",padding:me?"10px":"5px 10px 0px 10px",border:me?"none":"1px solid grey"},children:[w.title&&me&&e.jsx(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px",marginBottom:"10px"},children:e.jsx(de,{sx:Xe,children:w.title})}),d&&!me&&e.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px"},children:[e.jsx(de,{sx:Xe,children:d}),e.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px"},children:[w.selectFrom&&e.jsx(H,{title:"Add a device from the list",children:e.jsx(B,{onClick:ne,size:"small",color:"primary",sx:Ee,children:e.jsx(dt,{})})}),e.jsx(H,{title:"Add a new item",children:e.jsx(B,{onClick:se,size:"small",color:"primary",sx:Ee,children:e.jsx(vt,{})})})]})]}),w.description&&e.jsx(Z,{sx:{padding:"0px",margin:"0px",marginBottom:"10px"},children:e.jsx(de,{sx:Ze,children:w.description})}),x.map(({content:K,name:ue,hidden:ve})=>!ve&&e.jsxs(Z,{sx:{margin:"0px",marginBottom:"10px",padding:["object","array","boolean"].includes(w.properties[ue].type)?"0px":ln,border:["object","array","boolean"].includes(w.properties[ue].type)?"none":"1px solid grey"},children:[!["object","array","boolean"].includes(w.properties[ue].type)&&e.jsx(de,{sx:Xe,children:ue}),e.jsx(Z,{sx:{flexGrow:1,padding:"0px",margin:"0px"},children:K})]},ue)),e.jsxs(Ie,{open:ae,onClose:ne,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(ke,{children:"Select a device"}),e.jsxs(De,{children:[e.jsxs(Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(de,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(pe,{fullWidth:!0,variant:"outlined",value:U,onChange:ge,placeholder:"Enter serial or name"})]}),e.jsx(ot,{dense:!0,children:ft.filter(K=>K.serial.toLowerCase().includes(U.toLowerCase())||K.name.toLowerCase().includes(U.toLowerCase())).map((K,ue)=>e.jsxs(ct,{onClick:()=>be(K),sx:mt,children:[K.icon==="wifi"&&e.jsx(Q,{children:e.jsx(nt,{style:je})}),K.icon==="ble"&&e.jsx(Q,{children:e.jsx(pt,{style:je})}),K.icon==="hub"&&e.jsx(Q,{children:e.jsx(ut,{style:je})}),e.jsx(re,{primary:K.name,secondary:K.serial,primaryTypographyProps:{style:ht},secondaryTypographyProps:{style:xt}})]},ue))})]}),e.jsx(Ne,{children:e.jsx(oe,{onClick:ne,children:"Close"})})]})]})}function u(M){const{uiSchema:I}=M,{submitText:w,norender:x}=Vo(I);return x?null:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",margin:"10px",padding:"0px",gap:"20px"},children:[e.jsx(oe,{type:"submit",variant:"contained",color:"primary",children:w}),e.jsx(oe,{variant:"contained",color:"primary",onClick:c,children:"Cancel"})]})}function $(M){const{className:I,disabled:w,onClick:x,registry:d,style:W,uiSchema:ae,...le}=M;return e.jsx(H,{title:"Remove the item",children:e.jsx(B,{disabled:w,size:"small",color:"primary",onClick:x,children:e.jsx(jt,{})})})}function k(M){const{className:I,disabled:w,onClick:x,registry:d,uiSchema:W,...ae}=M;return e.jsx(H,{title:"Add an item",children:e.jsx(B,{size:"small",color:"primary",onClick:x,children:e.jsx(vt,{})})})}function ee(M){const{disabled:I,onClick:w,registry:x,style:d,uiSchema:W,...ae}=M;return e.jsx(H,{title:"Move up the item",children:e.jsx(B,{size:"small",color:"primary",onClick:w,children:e.jsx(Lt,{})})})}function xe(M){const{disabled:I,onClick:w,registry:x,style:d,uiSchema:W,...ae}=M;return e.jsx(H,{title:"Move down the item",children:e.jsx(B,{size:"small",color:"primary",onClick:w,children:e.jsx(Ft,{})})})}function Se(M){const{id:I,name:w,value:x,schema:d,readonly:W,onChange:ae}=M,[le,U]=r.useState(void 0),ce=ne=>{U(ne&&ne!==""?ne:void 0)},ge=()=>{o({id:t.current,sender:"ConfigPlugin",method:"/api/action",src:"Frontend",dst:"Matterbridge",params:{plugin:a.name,action:w,value:le,formData:p,id:I}}),d.buttonClose===!0?c():d.buttonSave===!0&&C({formData:g})};return d.buttonText&&d.description?e.jsxs(Z,{sx:{margin:"0px",padding:"10px",border:"1px solid grey",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(de,{sx:Ze,children:d.description}),e.jsx(oe,{variant:"contained",color:"primary",onClick:()=>ge(),children:d.buttonText})]}):d.buttonField&&d.description?e.jsxs(Z,{sx:{margin:"0px",padding:"10px",gap:"20px",border:"1px solid grey",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(de,{sx:Ze,children:d.description}),e.jsx(pe,{id:w+"-input",name:w,label:d.textLabel,placeholder:d.textPlaceholder,onChange:ne=>ce(ne.target.value),sx:{width:"250px",minWidth:"250px",maxWidth:"250px"}}),e.jsx(oe,{id:w+"-button",variant:"contained",color:"primary",disabled:le===void 0,onClick:()=>ge(),children:d.buttonField})]}):e.jsxs(Z,{sx:{margin:"0px",padding:"5px 10px",border:"1px solid grey"},children:[w&&e.jsxs(Z,{sx:{margin:"0px",padding:"0px",gap:"10px",display:"flex",justifyContent:"flex-start",alignItems:"center"},children:[e.jsx(de,{sx:Xe,children:w}),e.jsx(We,{checked:x,readOnly:W,onChange:()=>ae(!x),sx:{padding:"0px",margin:"0px"}})]}),d.description&&e.jsx(de,{sx:Ze,children:d.description})]})}function z({schema:M,id:I,name:w,options:x,label:d,hideLabel:W,required:ae,disabled:le,placeholder:U,readonly:ce,value:ge,multiple:ne,autofocus:be,onChange:se,onBlur:me,onFocus:K,errorSchema:ue,rawErrors:ve=[],registry:Je,uiSchema:J,hideError:ie,formContext:Te,...Fe}){const{enumOptions:Le,enumDisabled:Ae,emptyValue:ye}=x;ne=typeof ne>"u"?!1:!!ne;const Ge=ne?[]:"",Qe=typeof ge>"u"||ne&&ge.length<1||!ne&&ge===Ge,St=({target:{value:Re}})=>se(Dt(Re,Le,ye)),wt=({target:Re})=>me(I,Dt(Re&&Re.value,Le,ye)),Mt=({target:Re})=>K(I,Dt(Re&&Re.value,Le,ye)),A=Ro(ge,Le,ne),{InputLabelProps:we,SelectProps:It,autocomplete:pr,...ur}=Fe,gr=!ne&&M.default===void 0;return e.jsxs(pe,{id:I,name:I,value:!Qe&&typeof A<"u"?A:Ge,required:ae,disabled:le||ce,autoFocus:be,autoComplete:pr,placeholder:U,error:ve.length>0,onChange:St,onBlur:wt,onFocus:Mt,...ur,select:!0,InputLabelProps:{...we,shrink:!Qe},SelectProps:{...It,multiple:ne},"aria-describedby":Eo(I),children:[gr&&e.jsx(N,{value:"",children:U}),Array.isArray(Le)&&Le.map(({value:Re,label:mr},Tt)=>{const hr=Array.isArray(Ae)&&Ae.indexOf(Re)!==-1;return e.jsx(N,{value:String(Tt),disabled:hr,children:mr},Tt)})]})}return!n||!F||!g?null:e.jsxs(Ie,{open:n,onClose:c,maxWidth:"800px",children:[e.jsx(ke,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h3",{children:"Matterbridge plugin configuration"})]})}),e.jsx(De,{style:{padding:"0px",margin:"0px",width:"800px",height:"600px",overflow:"auto"},children:e.jsx(Ho,{schema:F,formData:g,uiSchema:T,validator:Oo,templates:{FieldTemplate:R,BaseInputTemplate:h,TitleFieldTemplate:_,DescriptionFieldTemplate:V,FieldHelpTemplate:q,FieldErrorTemplate:l,ErrorListTemplate:Y,WrapIfAdditionalTemplate:L,ArrayFieldTitleTemplate:f,ArrayFieldDescriptionTemplate:D,ArrayFieldItemTemplate:X,ArrayFieldTemplate:he,ObjectFieldTemplate:j,ButtonTemplates:{SubmitButton:u,RemoveButton:$,AddButton:k,MoveUpButton:ee,MoveDownButton:xe}},widgets:{CheckboxWidget:Se,SelectWidget:z},onChange:E,onSubmit:C})})]})};function cn({data:n,columns:c,columnVisibility:a}){const o=Oe.useMemo(()=>c.filter(S=>a[S.accessor]),[c,a]),{getTableProps:s,getTableBodyProps:m,headerGroups:b,rows:t,prepareRow:g}=$e.useTable({columns:o,data:n},$e.useSortBy);return e.jsxs("table",{...s(),style:{border:"none",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{border:"none",borderCollapse:"collapse"},children:b.map(S=>e.jsx("tr",{...S.getHeaderGroupProps(),style:{border:"none",borderCollapse:"collapse"},children:S.headers.map(F=>e.jsx("th",{...F.getHeaderProps(void 0),style:{border:"none",borderCollapse:"collapse",cursor:F.noSort?"default":"pointer"},children:F.render("Header")}))}))}),e.jsx("tbody",{...m(),style:{border:"none",borderCollapse:"collapse"},children:t.map((S,F)=>(g(S),e.jsx("tr",{className:F%2===0?"table-content-even":"table-content-odd",...S.getRowProps(),style:{border:"none",borderCollapse:"collapse"},children:S.cells.map(v=>e.jsx("td",{...v.getCellProps(),style:{border:"none",borderCollapse:"collapse"},children:v.render("Cell")}))},F)))})]})}function pn({_storeId:n,setStoreId:c}){const{online:a,sendMessage:o,addListener:s,removeListener:m,getUniqueId:b}=r.useContext(fe),{showConfirmCancelDialog:t}=r.useContext(rt),g=r.useRef(b()),[S,F]=r.useState(null),[v,T]=r.useState(null),[O,y]=r.useState([]),[P,p]=r.useState(!1),[E,C]=r.useState({name:!0,description:!0,version:!0,author:!0,type:!0,registeredDevices:!0,actions:!0,status:!0}),L=d=>{if(d===void 0||d.matter===void 0||!d.matter.fabricInformations&&!d.matter.qrPairingCode&&!d.matter.manualPairingCode)return"red";if(d.matter.commissioned===!1&&d.matter.qrPairingCode&&d.matter.manualPairingCode)return"var(--primary-color)";var W=0,ae=0;for(const le of d.matter.sessionInformations??[])le.fabric&&le.isPeerActive===!0&&W++,le.numberOfActiveSubscriptions>0&&(ae+=le.numberOfActiveSubscriptions);return d.matter.commissioned===!0&&d.matter.fabricInformations&&d.matter.sessionInformations&&(W===0||ae===0)?"var(--secondary-color)":"var(--div-text-color)"},R=[{Header:"Name",accessor:"name",Cell:({row:d})=>e.jsx(H,{title:"Open the plugin homepage",children:e.jsx("span",{style:{cursor:"pointer"},onClick:()=>u(d.original),children:d.original.name})})},{Header:"Description",accessor:"description",Cell:({row:d})=>e.jsx(H,{title:"Open the plugin homepage",children:e.jsx("span",{style:{cursor:"pointer"},onClick:()=>u(d.original),children:d.original.description})})},{Header:"Version",accessor:"version",Cell:({row:d})=>e.jsxs(e.Fragment,{children:[d.original.latestVersion!==void 0&&d.original.latestVersion!==d.original.version&&v&&!v.readOnly&&e.jsx(H,{title:"New plugin stable version available, click to install",children:e.jsxs("span",{className:"status-warning",style:{marginRight:"10px"},onClick:()=>f(d.original),children:["Update to v.",d.original.latestVersion]})}),d.original.version.includes("-dev-")&&d.original.devVersion!==void 0&&d.original.devVersion!==d.original.version&&v&&!v.readOnly&&e.jsx(H,{title:"New plugin dev version available, click to install",children:e.jsxs("span",{className:"status-warning",style:{marginRight:"10px"},onClick:()=>D(d.original),children:["Update to new dev v.",d.original.devVersion.split("-dev-")[0]]})}),e.jsx(H,{title:"Plugin version",children:d.original.version})]})},{Header:"Author",accessor:"author",Cell:({row:d})=>e.jsx(e.Fragment,{children:d.original.author?d.original.author.replace("https://github.com/",""):"Unknown"})},{Header:"Type",accessor:"type",Cell:({row:d})=>e.jsx(e.Fragment,{children:d.original.type?d.original.type.replace("Platform",""):"Unknown"})},{Header:"Devices",accessor:"registeredDevices"},{Header:"Actions",accessor:"actions",Cell:({row:d})=>e.jsxs("div",{style:{margin:"0px",padding:"0px",gap:"4px",display:"flex",flexDirection:"row"},children:[v&&v.bridgeMode==="childbridge"&&!d.original.error&&d.original.enabled&&e.jsx(H,{title:"Shows the QRCode or the fabrics",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(B,{style:{margin:"0",padding:"0",width:"19px",height:"19px",color:L(d.original)},onClick:()=>c(d.original?.matter?.id),size:"small",children:e.jsx(Zt,{})})}),v&&v.bridgeMode==="childbridge"&&!d.original.error&&d.original.enabled&&e.jsx(H,{title:"Restart the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(B,{style:{margin:"0",padding:"0",width:"19px",height:"19px"},onClick:()=>he(d.original),size:"small",children:e.jsx(bt,{})})}),e.jsx(H,{title:"Plugin config",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(B,{disabled:d.original.restartRequired===!0,style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>I(d.original),size:"small",children:e.jsx(Ue,{})})}),v&&!v.readOnly&&e.jsx(H,{title:"Remove the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(B,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>{Y("Remove plugin","Are you sure? This will remove also all the devices and configuration in the controller.","remove",d.original)},size:"small",children:e.jsx(jt,{})})}),d.original.enabled?e.jsx(H,{title:"Disable the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(B,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>{Y("Disable plugin","Are you sure? This will remove also all the devices and configuration in the controller.","disable",d.original)},size:"small",children:e.jsx(Fr,{})})}):e.jsx(e.Fragment,{}),d.original.enabled?e.jsx(e.Fragment,{}):e.jsx(H,{title:"Enable the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(B,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>j(d.original),size:"small",children:e.jsx(Lr,{})})}),e.jsx(H,{title:"Open the plugin help",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(B,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>k(d.original),size:"small",children:e.jsx(Hr,{})})}),e.jsx(H,{title:"Open the plugin version history",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(B,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>ee(d.original),size:"small",children:e.jsx(Or,{})})}),v&&!v.readOnly&&e.jsx(H,{title:"Sponsor the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(B,{style:{margin:"0",padding:"0",width:"19px",height:"19px",color:"#b6409c"},onClick:()=>$(d.original),size:"small",children:e.jsx(Yt,{})})})]})},{Header:"Status",accessor:"status",Cell:({row:d})=>e.jsx("div",{style:{display:"flex",flexDirection:"row",flex:"1 1 auto",gap:"5px"},children:d.original.error?e.jsx(e.Fragment,{children:e.jsx(Ye,{status:!1,enabledText:"Error",disabledText:"Error",tooltipText:"The plugin is in error state. Check the log!"})}):e.jsx(e.Fragment,{children:d.original.enabled===!1?e.jsx(e.Fragment,{children:e.jsx(Ye,{status:d.original.enabled,enabledText:"Enabled",disabledText:"Disabled",tooltipText:"Whether the plugin is enable or disabled"})}):e.jsx(e.Fragment,{children:d.original.loaded&&d.original.started&&d.original.configured?e.jsx(e.Fragment,{children:e.jsx(Ye,{status:d.original.loaded,enabledText:"Running",tooltipText:"Whether the plugin is running"})}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{status:d.original.loaded,enabledText:"Loaded",tooltipText:"Whether the plugin has been loaded"}),e.jsx(Ye,{status:d.original.started,enabledText:"Started",tooltipText:"Whether the plugin started"}),e.jsx(Ye,{status:d.original.configured,enabledText:"Configured",tooltipText:"Whether the plugin has been configured"})]})})})})}];r.useEffect(()=>{const d=W=>{W.src==="Matterbridge"&&W.dst==="Frontend"&&(W.method==="refresh_required"&&(W.params.changed==="plugins"||W.params.changed==="fabrics"||W.params.changed==="sessions"||W.params.changed==="pluginsRestart")&&(i&&console.log("HomePlugins received refresh_required for",W.params.changed),o({id:g.current,sender:"HomePlugins",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})),W.method==="refresh_required"&&W.params.changed==="settings"&&(i&&console.log("HomePlugins received refresh_required for",W.params.changed),o({id:g.current,sender:"HomePlugins",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),W.id===g.current&&W.method==="/api/settings"&&(i&&console.log(`HomePlugins (id: ${W.id}) received settings:`,W.response),F(W.response.systemInformation),T(W.response.matterbridgeInformation)),W.id===g.current&&W.method==="/api/plugins"&&(i&&console.log(`HomePlugins (id: ${W.id}) received ${W.response.length} plugins:`,W.response),y(W.response)))};return s(d),i&&console.log("HomePlugins added WebSocket listener id:",g.current),()=>{m(d),i&&console.log("HomePlugins removed WebSocket listener")}},[s,m,o]),r.useEffect(()=>{a&&(i&&console.log("HomePlugins sending api requests"),o({id:g.current,sender:"HomePlugins",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),o({id:g.current,sender:"HomePlugins",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[a,o]),r.useEffect(()=>{const d=localStorage.getItem("homePluginsColumnVisibility");d&&C(JSON.parse(d))},[]);const V=()=>{p(!P)},_=d=>{C(W=>{const ae={...W,[d]:!W[d]};return localStorage.setItem("homePluginsColumnVisibility",JSON.stringify(ae)),ae})},q=r.useRef(null),Y=(d,W,ae,le)=>{i&&console.log(`handleActionWithConfirmCancel ${ae} ${le.name}`),q.current=le,t(d,W,ae,l,h)},l=d=>{i&&console.log(`handleConfirm action confirmed ${d} ${q.current.name}`),d==="remove"&&q.current?X(q.current):d==="disable"&&q.current&&j(q.current),q.current=null},h=d=>{i&&console.log(`handleCancel action canceled ${d} ${q.current.name}`),q.current=null},f=d=>{i&&console.log("handleUpdatePlugin plugin:",d.name),o({id:g.current,sender:"HomePlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:d.name,restart:!1}})},D=d=>{i&&console.log("handleUpdateDevPlugin plugin:",d.name),o({id:g.current,sender:"HomePlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:d.name+"@dev",restart:!1}})},X=d=>{i&&console.log("handleRemovePlugin plugin:",d.name),o({id:g.current,sender:"HomePlugins",method:"/api/removeplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:d.name}})},he=d=>{i&&console.log("handleRestartPlugin plugin:",d.name),o({id:g.current,sender:"HomePlugins",method:"/api/restartplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:d.name}})},j=d=>{i&&console.log("handleEnableDisablePlugin plugin:",d.name,"enabled:",d.enabled),d.enabled===!0?(d.enabled=!1,o({id:g.current,sender:"HomePlugins",method:"/api/disableplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:d.name}})):(d.enabled=!0,o({id:g.current,sender:"HomePlugins",method:"/api/enableplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:d.name}}))},u=d=>{i&&console.log(`handleHomepagePlugin plugin: ${d.name} homepage: ${d.homepage}`),d.homepage&&window.open(d.homepage,"_blank")},$=d=>{i&&console.log("handleSponsorPlugin plugin:",d.name,"funding:",d.funding),d.funding&&window.open(d.funding,"_blank")},k=d=>{i&&console.log("handleHelpPlugin plugin:",d.name,"help:",d.help),d.help&&window.open(d.help,"_blank")},ee=d=>{i&&console.log("handleChangelogPlugin plugin:",d.name,"changelog:",d.changelog),d.changelog&&window.open(d.changelog,"_blank")},[xe,Se]=r.useState({}),[z,M]=r.useState(!1),I=d=>{i&&console.log("handleConfigPlugin plugin:",d.name),o({id:g.current,sender:"HomePlugins",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:d.name}}),o({id:g.current,sender:"HomePlugins",method:"/api/select/entities",src:"Frontend",dst:"Matterbridge",params:{plugin:d.name}}),Se(d),w()},w=()=>{M(!0)},x=()=>{M(!1)};return i&&console.log("HomePlugins rendering..."),a?e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",width:"100%",flex:"0 0 auto",overflow:"hidden"},children:[e.jsx(dn,{open:z,onClose:x,plugin:xe}),e.jsxs(Ie,{open:P,onClose:V,children:[e.jsx(ke,{children:"Configure Plugins Columns"}),e.jsx(De,{children:e.jsx(it,{children:R.map(d=>e.jsx(Pe,{control:e.jsx(We,{disabled:["description","actions","status"].includes(d.accessor),checked:E[d.accessor],onChange:()=>_(d.accessor)}),label:d.Header},d.accessor))})}),e.jsx(Ne,{children:e.jsx(oe,{onClick:V,children:"Close"})})]}),e.jsxs("div",{className:"MbfWindowHeader",style:{justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Plugins"}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(B,{onClick:V,"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(H,{title:"Configure columns",children:e.jsx(Ue,{style:{color:"var(--header-text-color)",fontSize:"19px"}})})})})]}),e.jsx("div",{className:"MbfWindowBodyColumn",style:{margin:"0px",padding:"0px",gap:"0",overflow:"auto"},children:e.jsx(cn,{data:O,columns:R,columnVisibility:E})})]}):e.jsx(qe,{})}const un=n=>{if(n===void 0||!n.qrPairingCode&&!n.manualPairingCode&&!n.fabricInformations&&!n.sessionInformations)return"red";if(n.commissioned===!1&&n.qrPairingCode&&n.manualPairingCode)return"var(--primary-color)";var c=0,a=0;for(const o of n.sessionInformations??[])o.fabric&&o.isPeerActive===!0&&c++,o.numberOfActiveSubscriptions>0&&(a+=o.numberOfActiveSubscriptions);return n.commissioned===!0&&n.fabricInformations&&n.sessionInformations&&(c===0||a===0)?"var(--secondary-color)":"var(--div-text-color)"},gn=n=>`${n.pluginName}::${n.serial}`;function mn({data:n,columns:c,columnVisibility:a}){const o=Oe.useMemo(()=>{const v=localStorage.getItem("homeDevicesColumnsSortBy");return v?JSON.parse(v):[{id:"name",desc:!1}]},[c]),s=Oe.useMemo(()=>c.filter(v=>a[v.accessor]),[a,c]),{getTableProps:m,getTableBodyProps:b,headerGroups:t,rows:g,prepareRow:S,state:{sortBy:F}}=$e.useTable({columns:s,data:n,getRowId:gn,initialState:{sortBy:o}},$e.useSortBy);return Oe.useEffect(()=>{localStorage.setItem("homeDevicesColumnsSortBy",JSON.stringify(F))},[F]),e.jsxs("table",{...m(),style:{border:"none",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{border:"none",borderCollapse:"collapse"},children:t.map(v=>e.jsx("tr",{...v.getHeaderGroupProps(),style:{border:"none",borderCollapse:"collapse"},children:v.headers.map(T=>e.jsxs("th",{...T.getHeaderProps(T.noSort?void 0:T.getSortByToggleProps()),style:{border:"none",borderCollapse:"collapse",cursor:T.noSort?"default":"pointer"},children:[T.render("Header"),!T.noSort&&e.jsx("span",{style:{margin:"0px",marginLeft:"5px",padding:"0px"},children:T.isSorted?T.isSortedDesc?e.jsx(te,{path:Pt,size:"15px"}):e.jsx(te,{path:Wt,size:"15px"}):null})]}))}))}),e.jsx("tbody",{...b(),style:{border:"none",borderCollapse:"collapse"},children:g.map((v,T)=>(S(v),e.jsx("tr",{className:T%2===0?"table-content-even":"table-content-odd",...v.getRowProps(),style:{border:"none",borderCollapse:"collapse"},children:v.cells.map(O=>e.jsx("td",{...O.getCellProps(),style:{border:"none",borderCollapse:"collapse"},children:O.render("Cell")}))})))})]})}function hn({storeId:n,setStoreId:c}){const{online:a,sendMessage:o,addListener:s,removeListener:m,getUniqueId:b}=r.useContext(fe),[t,g]=r.useState(!1),[S,F]=r.useState(!0),[v,T]=r.useState(null),[O,y]=r.useState([]),[P,p]=r.useState([]),[E,C]=r.useState([]),[L,R]=r.useState([]),[V,_]=r.useState(!1),[q,Y]=r.useState({pluginName:!0,name:!0,serial:!0,reachable:!0,powerSource:!0,configUrl:!1,actions:!0}),l=r.useRef(b()),h=[{Header:"Plugin",accessor:"pluginName"},{Header:"Name",accessor:"name"},{Header:"Serial",accessor:"serial"},{Header:"Availability",accessor:"reachable",Cell:({row:j})=>j.original.reachable===!0?"Online":j.original.reachable===!1?e.jsx("span",{style:{color:"red"},children:"Offline"}):"",sortType:(j,u)=>{const $=j.original.reachable===!0?1:j.original.reachable===!1?0:-1,k=u.original.reachable===!0?1:u.original.reachable===!1?0:-1;return $-k}},{Header:"Power",accessor:"powerSource",Cell:({row:j})=>j.original.powerSource==="ac"||j.original.powerSource==="dc"?e.jsx(er,{fontSize:"small",sx:{color:"var(--primary-color)"}}):j.original.powerSource==="ok"?e.jsx(yt,{fontSize:"small",sx:{color:"green"}}):j.original.powerSource==="warning"?e.jsx(yt,{fontSize:"small",sx:{color:"yellow"}}):j.original.powerSource==="critical"?e.jsx(yt,{fontSize:"small",sx:{color:"red"}}):e.jsx("span",{})},{Header:"Url",accessor:"configUrl"},{Header:"Actions",accessor:"actions",noSort:!0,Cell:({row:j})=>e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[j.original.matter!==void 0?e.jsx(H,{title:"Show the QRCode or the fabrics",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(B,{onClick:()=>c(n===j.original.matter.id?v.matterbridgeInformation.bridgeMode==="bridge"?"Matterbridge":null:j.original.matter.id),"aria-label":"Show the QRCode",sx:{margin:0,padding:0,color:un(j.original.matter)},children:e.jsx(Zt,{fontSize:"small"})})}):e.jsx("div",{style:{width:"20px",height:"20px"}}),j.original.configUrl?e.jsx(H,{title:"Open the configuration page",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(B,{onClick:()=>window.open(j.original.configUrl,"_blank"),"aria-label":"Open config url",sx:{margin:0,padding:0},children:e.jsx(Ue,{fontSize:"small"})})}):e.jsx("div",{style:{width:"20px",height:"20px"}}),j.original.selected!==void 0?e.jsx(H,{title:"Select/unselect the device",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(We,{checked:j.original.selected,onChange:u=>he(u,j.original),sx:{margin:"0",marginLeft:"8px",padding:"0"},size:"small"})}):e.jsx("div",{style:{width:"20px",height:"20px"}})]})}],f=Oe.useCallback(j=>{j.selected=void 0;const u=O.find(ee=>ee.name===j.pluginName);if(!u)return console.error(`HomeDevices isSelected: plugin ${j.pluginName} not found for device ${j.deviceName} `),j.selected;const $=u.schemaJson?.properties?.whiteList?.selectFrom;let k=u.configJson?.postfix;return k===""&&(k=void 0),u.hasWhiteList===!0&&u.hasBlackList===!0&&$&&(j.selected=!0,$==="serial"&&u.configJson.whiteList&&u.configJson.whiteList.length>0&&u.configJson.whiteList.includes(k?j.serial.replace("-"+k,""):j.serial)&&(j.selected=!0),$==="serial"&&u.configJson.whiteList&&u.configJson.whiteList.length>0&&!u.configJson.whiteList.includes(k?j.serial.replace("-"+k,""):j.serial)&&(j.selected=!1),$==="serial"&&u.configJson.blackList&&u.configJson.blackList.length>0&&u.configJson.blackList.includes(k?j.serial.replace("-"+k,""):j.serial)&&(j.selected=!1),$==="name"&&u.configJson.whiteList&&u.configJson.whiteList.length>0&&u.configJson.whiteList.includes(j.name)&&(j.selected=!0),$==="name"&&u.configJson.whiteList&&u.configJson.whiteList.length>0&&!u.configJson.whiteList.includes(j.name)&&(j.selected=!1),$==="name"&&u.configJson.blackList&&u.configJson.blackList.length>0&&u.configJson.blackList.includes(j.name)&&(j.selected=!1)),j.selected},[O]);r.useEffect(()=>{const j=u=>{if(u.src==="Matterbridge"&&u.dst==="Frontend"){if(u.method==="refresh_required"&&u.params.changed!=="matter"&&u.params.changed!=="pluginsRestart"&&u.params.changed!=="sessions"&&u.params.changed!=="matterbridgeLatestVersion"&&u.params.changed!=="reachability"&&(i&&console.log(`HomeDevices received refresh_required: changed=${u.params.changed}`),o({id:l.current,sender:"HomeDevices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})),u.method==="restart_required"&&(i&&console.log("HomeDevices received restart_required"),g(!0)),u.method==="restart_not_required"&&(i&&console.log("HomeDevices received restart_not_required"),g(!1)),u.method==="state_update"&&u.params.plugin&&u.params.serialNumber&&u.params.cluster.includes("BasicInformationServer")&&u.params.attribute==="reachable"&&(console.log(`HomeDevices updating device reachability for plugin ${u.params.plugin} serial ${u.params.serialNumber} value ${u.params.value}`),p($=>$.map(k=>k.pluginName===u.params.plugin&&k.serial===u.params.serialNumber?{...k,reachable:u.params.value}:k))),u.id===l.current&&u.method==="/api/settings"&&(i&&console.log(`HomeDevices (id: ${u.id}) received settings:`,u.response),T(u.response),g(u.response.matterbridgeInformation.restartRequired)),u.id===l.current&&u.method==="/api/plugins"&&(i&&console.log(`HomeDevices (id: ${u.id}) received ${u.response?.length} plugins:`,u.response),u.response)){let $=!0;for(const k of u.response)k.enabled===!0&&(k.loaded!==!0||k.started!==!0||k.error===!0)&&($=!1);if(!$)return;i&&console.log("HomeDevices reset plugins, devices and selectDevices"),F(!1),y(u.response),p([]),C([]),o({id:l.current,sender:"HomeDevices",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}}),i&&console.log("HomeDevices sent /api/devices");for(const k of u.response)k.enabled===!0&&k.loaded===!0&&k.started===!0&&k.error!==!0&&(o({id:l.current,sender:"HomeDevices",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:k.name}}),i&&console.log(`HomeDevices sent /api/select/devices for plugin: ${k.name}`))}if(u.id===l.current&&u.method==="/api/devices"&&(i&&console.log(`HomeDevices (id: ${u.id}) received ${u.response?.length} devices:`,u.response),u.response)){for(const $ of u.response)$.selected=f($);p(u.response)}u.id===l.current&&u.method==="/api/select/devices"&&(i&&console.log(`HomeDevices (id: ${u.id}) received ${u.response?.length} selectDevices for plugin ${u.plugin}:`,u.response),u.response&&C($=>{const k=$.filter(xe=>xe.pluginName!==u.plugin),ee=u.response.map(xe=>({...xe,selected:f(xe)}));return[...k,...ee]}))}};return s(j),i&&console.log(`HomeDevices added WebSocket listener id ${l.current}`),()=>{m(j),i&&console.log("HomeDevices removed WebSocket listener")}},[O,s,m,o,f]),r.useEffect(()=>{console.log(`HomeDevices mixing devices (${P.length}) and selectDevices (${E.length})`);const j=[];for(const u of P)j.push(u);for(const u of E)P.find($=>$.pluginName===u.pluginName&&$.serial.includes(u.serial))||j.push(u);j.length>0&&R(j),console.log(`HomeDevices mixed ${j.length} devices and selectDevices`)},[O,P,E,R]),r.useEffect(()=>{a&&(i&&console.log("HomeDevices sending /api/settings and /api/plugins requests"),o({id:l.current,sender:"HomeDevices",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),o({id:l.current,sender:"HomeDevices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[a,o]),r.useEffect(()=>{const j=localStorage.getItem("homeDevicesColumnVisibility");if(j){const u=JSON.parse(j);u.powerSource===void 0&&(u.powerSource=!0),Y(u),i&&console.log("HomeDevices loaded column visibility from localStorage")}},[]);const D=j=>{Y(u=>{const $={...u,[j]:!u[j]};return localStorage.setItem("homeDevicesColumnVisibility",JSON.stringify($)),i&&console.log("HomeDevices saved column visibility to localStorage",JSON.stringify($),$),$})},X=()=>{_(!V)},he=(j,u)=>{console.log(`handleCheckboxChange: checkbox changed to ${j.target.checked} for device ${u.name} serial ${u.serial}`),R($=>{const k=$.findIndex(xe=>xe.pluginName===u.pluginName&&xe.serial===u.serial);if(k<0)return console.error(`handleCheckboxChange: device not found ${u.name} serial ${u.serial} id ${u.id}`),$;const ee=[...$];return ee[k]={...ee[k],selected:j.target.checked},ee}),j.target.checked?o({id:l.current,sender:"HomeDevices",method:"/api/command",src:"Frontend",dst:"Matterbridge",params:{command:"selectdevice",plugin:u.pluginName,serial:u.serial,name:u.name}}):o({id:l.current,sender:"HomeDevices",method:"/api/command",src:"Frontend",dst:"Matterbridge",params:{command:"unselectdevice",plugin:u.pluginName,serial:u.serial,name:u.name}})};return i&&console.log("HomeDevices rendering..."),a?e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",width:"100%",flex:"1 1 auto",overflow:"hidden"},children:[e.jsxs(Ie,{open:V,onClose:X,children:[e.jsx(ke,{children:"Configure Devices Columns"}),e.jsx(De,{children:e.jsx(it,{children:h.map(j=>e.jsx(Pe,{control:e.jsx(We,{disabled:["name","actions"].includes(j.accessor),checked:q[j.accessor],onChange:()=>D(j.accessor)}),label:j.Header},j.accessor))})}),e.jsx(Ne,{children:e.jsx(oe,{onClick:X,children:"Close"})})]}),e.jsxs("div",{className:"MbfWindowHeader",style:{justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Devices"}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(B,{onClick:X,"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(H,{title:"Configure columns",children:e.jsx(Ue,{style:{color:"var(--header-text-color)",fontSize:"19px"}})})})})]}),e.jsx("div",{className:"MbfWindowBodyColumn",style:{margin:"0px",padding:"0px",gap:"0",overflow:"auto"},children:e.jsx(mn,{data:L,columns:h,columnVisibility:q})}),e.jsxs("div",{className:"MbfWindowFooter",style:{borderTop:"1px solid var(--table-border-color)",justifyContent:"space-between"},children:[S&&e.jsx("p",{className:"MbfWindowFooterText",style:{fontWeight:"normal",fontSize:"14px",color:"var(--secondary-color)"},children:"Waiting for the plugins to fully load..."}),!S&&e.jsxs("p",{className:"MbfWindowFooterText",style:{fontWeight:"normal",fontSize:"14px",color:"var(--secondary-color)"},children:["Registered devices: ",P.length.toString(),"/",L.length.toString()]}),t&&e.jsx("p",{className:"MbfWindowFooterText",style:{fontWeight:"normal",fontSize:"14px",color:"var(--secondary-color)"},children:"Restart required"})]})]}):e.jsx(qe,{})}function xn(){const[n,c]=r.useState(null),[a,o]=r.useState(null),[s,m]=r.useState([]),[b]=r.useState(localStorage.getItem("homePagePlugins")!=="false"),[t,g]=r.useState(localStorage.getItem("homePageMode")??"devices"),[S,F]=r.useState(""),[v,T]=r.useState(!1),[O,y]=r.useState(!1),[P,p]=r.useState(null),{addListener:E,removeListener:C,online:L,sendMessage:R,logFilterLevel:V,logFilterSearch:_,autoScroll:q,getUniqueId:Y}=r.useContext(fe),l=r.useRef(Y());return r.useEffect(()=>{const h=f=>{f.src==="Matterbridge"&&f.dst==="Frontend"&&(f.method==="refresh_required"&&f.params.changed!=="matterbridgeLatestVersion"&&f.params.changed!=="reachability"&&(i&&console.log(`Home received refresh_required: changed=${f.params.changed}`),R({id:l.current,sender:"Home",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),f.id===l.current&&f.method==="/api/settings"&&(i&&console.log("Home received settings:",f.response),c(f.response.systemInformation),o(f.response.matterbridgeInformation),f.response.matterbridgeInformation.bridgeMode==="bridge"&&(P||p(f.response.matterbridgeInformation.matter.id)),f.response.matterbridgeInformation.bridgeMode==="childbridge"&&s.length>0&&P===null&&(P||p(s[0].matter.id)),f.response.matterbridgeInformation.matterbridgeVersion&&F(`https://github.com/Luligu/matterbridge/blob/${f.response.matterbridgeInformation.matterbridgeVersion.includes("-dev-")?"dev":"main"}/CHANGELOG.md`),localStorage.getItem("frontendVersion")===null?localStorage.setItem("frontendVersion",f.response.matterbridgeInformation.frontendVersion):f.response.matterbridgeInformation.frontendVersion!==localStorage.getItem("frontendVersion")&&(localStorage.setItem("frontendVersion",f.response.matterbridgeInformation.frontendVersion),y(!0)),localStorage.getItem("matterbridgeVersion")===null?localStorage.setItem("matterbridgeVersion",f.response.matterbridgeInformation.matterbridgeVersion):f.response.matterbridgeInformation.matterbridgeVersion!==localStorage.getItem("matterbridgeVersion")&&(localStorage.setItem("matterbridgeVersion",f.response.matterbridgeInformation.matterbridgeVersion),T(!0)),f.response.matterbridgeInformation.shellyBoard&&(localStorage.getItem("homePageMode")||(localStorage.setItem("homePageMode","devices"),g("devices")))),f.id===l.current&&f.method==="/api/plugins"&&(i&&console.log(`Home received plugins (${a?.bridgeMode}):`,f.response),m(f.response),a?.bridgeMode==="childbridge"&&f.response.length>0&&(P||p(f.response[0].matter.id))))};return E(h),i&&console.log(`Home added WebSocket listener id ${l.current}`),()=>{C(h),i&&console.log("Home removed WebSocket listener")}},[E,C,R,a,s,P]),r.useEffect(()=>{L&&(i&&console.log("Home received online"),R({id:l.current,sender:"Home",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),R({id:l.current,sender:"Home",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[L,R]),i&&console.log("Home rendering..."),!L||!n||!a?e.jsx(qe,{}):e.jsxs("div",{className:"MbfPageDiv",style:{flexDirection:"row"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",width:"302px",minWidth:"302px",gap:"20px"},children:[e.jsx(on,{id:P}),e.jsx(tn,{systemInfo:n,compact:!0})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",width:"100%",gap:"20px"},children:[O&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Frontend Update"})}),e.jsxs("div",{className:"MbfWindowBody",style:{flexDirection:"row",justifyContent:"space-between"},children:[e.jsx("h4",{style:{margin:0},children:"The frontend has been updated. You are viewing an outdated web UI. Please refresh the page now."}),e.jsx("div",{children:e.jsx(oe,{onClick:()=>window.location.reload(),endIcon:e.jsx(Rr,{}),style:{marginLeft:"10px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Refresh"})})]})]}),v&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge Update"})}),e.jsxs("div",{className:"MbfWindowBody",style:{flexDirection:"row",justifyContent:"space-between"},children:[e.jsx("h4",{style:{margin:0},children:"Matterbridge has been updated."}),e.jsxs("div",{children:[e.jsx(oe,{onClick:()=>window.open(S,"_blank"),endIcon:e.jsx(Xt,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Changelog"}),e.jsx(oe,{onClick:()=>window.location.reload(),endIcon:e.jsx(Er,{}),style:{marginLeft:"10px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Close"})]})]})]}),b&&!a.readOnly&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Install plugins"})}),e.jsx(nn,{})]}),b&&e.jsx(pn,{storeId:P,setStoreId:p}),t==="devices"&&e.jsx(hn,{storeId:P,setStoreId:p}),t==="logs"&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"1 1 auto",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",style:{flexShrink:0},children:e.jsxs("div",{className:"MbfWindowHeaderText",style:{display:"flex",justifyContent:"space-between"},children:["Logs",e.jsxs("span",{style:{fontWeight:"normal",fontSize:"12px",marginTop:"2px"},children:['Filter: logger level "',V,'" and search "',_,'" Scroll: ',q?"auto":"manual"]})]})}),e.jsx("div",{style:{flex:"1 1 auto",margin:"0px",padding:"10px",overflow:"auto"},children:e.jsx(ar,{})})]})]})]})}const Jt={display:"flex",gap:"2px",justifyContent:"space-evenly",width:"100%",height:"40px"},fn={margin:"0",padding:"0",fontSize:"36px",fontWeight:"medium",color:"var(--primary-color)"},bn={margin:"0",padding:"0",fontSize:"20px",fontWeight:"medium",color:"var(--div-text-color)",textAlign:"center"},Gt={margin:"0",padding:"0",paddingBottom:"2px",fontSize:"16px",fontWeight:"medium",color:"var(--div-text-color)",textAlign:"center"},vn={display:"flex",gap:"2px",justifyContent:"center",width:"100%",height:"18px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},yn={margin:"0",padding:"0",fontSize:"12px",fontWeight:"normal",color:"var(--div-text-color)"},jn={display:"flex",justifyContent:"center",width:"100%",height:"52px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},Cn={margin:"0",padding:"0",fontSize:"14px",fontWeight:"bold",color:"var(--div-text-color)"},Sn={display:"flex",gap:"4px",justifyContent:"center",width:"100%",height:"15px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},Nt={margin:"0",padding:"0px 4px",borderRadius:"5px",textAlign:"center",fontSize:"12px",fontWeight:"normal",color:"var(--secondary-color)"},wn=[256,257,268,269],Mn=[266,267],In=[259,260,261,271,272],kn=[256,257,268,269,266,267,259,260,261];function G({icon:n,iconColor:c,cluster:a,value:o,unit:s,prefix:m}){return i&&console.log(`Render cluster "${a.clusterName}.${a.attributeName}" value(${typeof o}-${isNaN(o)}) "${o}" unit "${s}"`),m=m??!1,e.jsxs(Z,{sx:Jt,children:[n&&Oe.cloneElement(n,{key:`${a.clusterId}-${a.attributeId}-icon`,sx:{...fn,color:c??"var(--primary-color)"}}),e.jsxs(Z,{sx:{...Jt,gap:"4px",alignContent:"center",alignItems:"end",justifyContent:"center"},children:[s&&m===!0&&e.jsx(de,{sx:Gt,children:s},`${a.clusterId}-${a.attributeId}-unit`),e.jsx(de,{sx:bn,children:o==null||typeof o=="number"&&isNaN(o)||o==="NaN"?"---":o},`${a.clusterId}-${a.attributeId}-value`),s&&m===!1&&e.jsx(de,{sx:Gt,children:s},`${a.clusterId}-${a.attributeId}-unit`)]},`${a.clusterId}-${a.attributeId}-valueunitbox`)]},`${a.clusterId}-${a.attributeId}-box`)}function Dn({device:n,endpoint:c,id:a,deviceType:o,clusters:s}){const m=["Unknown","Good","Fair","Moderate","Poor","VeryPoor","Ext.Poor"];let b="";return i&&console.log(`Device "${n.name}" endpoint "${c}" id "${a}" deviceType "0x${o.toString(16).padStart(4,"0")}" clusters (${s?.length}):`,s),o===17&&s.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="batVoltage").map(t=>b=`${t.attributeLocalValue} mV`),kn.includes(o)&&s.filter(t=>t.clusterName==="LevelControl"&&t.attributeName==="currentLevel").map(t=>b=`Level ${t.attributeValue}`),o===514&&s.filter(t=>t.clusterName==="WindowCovering"&&t.attributeName==="currentPositionLiftPercent100ths").map(t=>b=`Position ${t.attributeValue/100}%`),o===769&&s.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="occupiedHeatingSetpoint").map(t=>b=`Heat ${t.attributeValue/100}°C `),o===769&&s.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="occupiedCoolingSetpoint").map(t=>b=b+`Cool ${t.attributeValue/100}°C`),o===118&&s.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="coState").map(t=>b=`${t.attributeLocalValue===0?"No CO detected":"CO alarm!"}`),o===1296&&s.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="voltage").map(t=>b=`${t.attributeLocalValue/1e3} V, `),o===1296&&s.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="activeCurrent").map(t=>b=b+`${t.attributeLocalValue/1e3} A, `),o===1296&&s.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="activePower").map(t=>b=b+`${t.attributeLocalValue/1e3} W`),e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0px",padding:"5px",width:"150px",height:"150px",borderColor:"var(--div-bg-color)",borderRadius:"5px",justifyContent:"space-between"},children:[o===19&&s.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(G,{icon:t.attributeLocalValue===!0?e.jsx(nt,{}):e.jsx(Vr,{}),iconColor:t.attributeLocalValue===!0?"green":"red",cluster:t,value:t.attributeLocalValue===!0?"Online":"Offline"})),o===17&&s.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="batPercentRemaining").map(t=>e.jsx(G,{icon:e.jsx(yt,{}),cluster:t,value:t.attributeValue/2,unit:"%"})),o===17&&s.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="wiredCurrentType").map(t=>e.jsx(G,{icon:e.jsx(er,{}),cluster:t,value:t.attributeLocalValue===0?"AC":"DC"})),o===1293&&s.filter(t=>t.clusterName==="DeviceEnergyManagement"&&t.attributeName==="esaState").map(t=>e.jsx(G,{icon:e.jsx(te,{path:xo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Offline":"Online"})),wn.includes(o)&&s.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(G,{icon:e.jsx(_r,{}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),Mn.includes(o)&&s.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(G,{icon:e.jsx(te,{path:fo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),In.includes(o)&&s.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(G,{icon:e.jsx(te,{path:bo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),o===115&&s.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(G,{icon:e.jsx(te,{path:vo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),o===124&&s.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(G,{icon:e.jsx(te,{path:yo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),o===117&&s.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(G,{icon:e.jsx(te,{path:jo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),o===123&&s.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(G,{icon:e.jsx(Rt,{}),cluster:t,value:"Oven"})),o===112&&s.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(G,{icon:e.jsx($r,{}),cluster:t,value:"Fridge"})),o===113&&s.filter(t=>t.clusterName==="TemperatureControl"&&t.attributeName==="selectedTemperatureLevel").map(t=>e.jsx(G,{icon:e.jsx(te,{path:Co,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),o===121&&s.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(G,{icon:e.jsx(Rt,{}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),o===122&&s.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="fanMode").map(t=>e.jsx(G,{icon:e.jsx(te,{path:So,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),o===120&&s.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(G,{icon:e.jsx(te,{path:At,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Cooktop"})),o===119&&s.filter(t=>t.clusterName==="TemperatureControl"&&t.attributeName==="selectedTemperatureLevel").map(t=>e.jsx(G,{icon:e.jsx(te,{path:At,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),o===116&&s.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(G,{icon:e.jsx(te,{path:wo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Robot"})),o===514&&s.filter(t=>t.clusterName==="WindowCovering"&&t.attributeName==="currentPositionLiftPercent100ths").map(t=>e.jsx(G,{icon:e.jsx(Ar,{}),cluster:t,value:t.attributeLocalValue/100,unit:"%"})),o===769&&s.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="localTemperature").map(t=>e.jsx(G,{icon:e.jsx(te,{path:Mo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:(t.attributeLocalValue??0)/100,unit:"°C"})),o===10&&s.filter(t=>t.clusterName==="DoorLock"&&t.attributeName==="lockState").map(t=>e.jsx(G,{icon:t.attributeValue==="1"?e.jsx(zr,{}):e.jsx(Br,{}),cluster:t,value:t.attributeValue==="1"?"Locked":"Unlocked"})),o===43&&s.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="percentCurrent").map(t=>e.jsx(G,{icon:e.jsx(Ur,{}),cluster:t,value:t.attributeValue,unit:"%"})),o===15&&s.filter(t=>t.clusterName==="Switch"&&t.attributeName==="currentPosition").map(t=>e.jsx(G,{icon:e.jsx(te,{path:Io,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeValue,unit:"pos",prefix:!0})),o===39&&s.filter(t=>t.clusterName==="ModeSelect"&&t.attributeName==="currentMode").map(t=>e.jsx(G,{icon:e.jsx(qr,{}),cluster:t,value:t.attributeValue,unit:"mode",prefix:!0})),o===771&&s.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(G,{icon:e.jsx(Jr,{}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),o===45&&s.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="percentCurrent").map(t=>e.jsx(G,{icon:e.jsx(Et,{}),cluster:t,value:t.attributeValue,unit:"%"})),o===114&&s.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="localTemperature").map(t=>e.jsx(G,{icon:e.jsx(Et,{}),cluster:t,value:(t.attributeLocalValue??0)/100,unit:"°C"})),o===67&&s.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(G,{icon:e.jsx(Gr,{}),cluster:t,value:t.attributeLocalValue===!0?"Leak":"No leak"})),o===65&&s.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(G,{icon:e.jsx(Qr,{}),cluster:t,value:t.attributeLocalValue===!0?"Freeze":"No freeze"})),o===68&&s.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(G,{icon:e.jsx(Kr,{}),cluster:t,value:t.attributeLocalValue===!0?"Rain":"No rain"})),o===1292&&s.filter(t=>t.clusterName==="EnergyEvse"&&t.attributeName==="state").map(t=>e.jsx(G,{icon:e.jsx(te,{path:ko,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Free":"In use"})),o===1295&&s.filter(t=>t.clusterName==="WaterHeaterManagement"&&t.attributeName==="tankPercentage").map(t=>e.jsx(G,{icon:e.jsx(te,{path:Do,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Tank "+(t.attributeLocalValue??0)+"%"})),o===777&&s.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="featureMap").map(t=>e.jsx(G,{icon:e.jsx(te,{path:No,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"HeatPump"})),o===23&&s.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="featureMap").map(t=>e.jsx(G,{icon:e.jsx(te,{path:Po,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Solar"})),o===24&&s.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="featureMap").map(t=>e.jsx(G,{icon:e.jsx(te,{path:Wo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Inverter"})),o===118&&s.find(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="featureMap"&&t.attributeLocalValue.smokeAlarm===!0)&&s.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="smokeState").map(t=>e.jsx(G,{icon:e.jsx(te,{path:zt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"No smoke":"Smoke!"})),o===118&&s.find(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="featureMap"&&t.attributeLocalValue.smokeAlarm===!1)&&s.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="coState").map(t=>e.jsx(G,{icon:e.jsx(te,{path:zt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"No Co":"Co!"})),o===66&&s.filter(t=>t.clusterName==="ValveConfigurationAndControl"&&t.attributeName==="currentState").map(t=>e.jsx(G,{icon:e.jsx(Yr,{}),cluster:t,value:t.attributeLocalValue===0?"Closed":"Opened"})),o===44&&s.filter(t=>t.clusterName==="AirQuality"&&t.attributeName==="airQuality").map(t=>e.jsx(G,{icon:e.jsx(te,{path:To,size:"40px",color:"var(--primary-color)"}),cluster:t,value:m[t.attributeLocalValue??0]})),o===770&&s.filter(t=>t.clusterName==="TemperatureMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(G,{icon:e.jsx(Xr,{}),cluster:t,value:t.attributeLocalValue/100,unit:"°C"})),o===775&&s.filter(t=>t.clusterName==="RelativeHumidityMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(G,{icon:e.jsx(te,{path:Fo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue/100,unit:"%"})),o===774&&s.filter(t=>t.clusterName==="FlowMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(G,{icon:e.jsx(Zr,{}),cluster:t,value:t.attributeLocalValue,unit:"l/h"})),o===773&&s.filter(t=>t.clusterName==="PressureMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(G,{icon:e.jsx(eo,{}),cluster:t,value:t.attributeLocalValue,unit:"hPa"})),o===21&&s.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(G,{icon:t.attributeValue==="true"?e.jsx(to,{}):e.jsx(ro,{}),cluster:t,value:t.attributeValue==="true"?"Closed":"Opened"})),o===263&&s.filter(t=>t.clusterName==="OccupancySensing"&&t.attributeName==="occupancy").map(t=>e.jsx(G,{icon:t.attributeValue==="{ occupied: true }"?e.jsx(oo,{}):e.jsx(no,{}),cluster:t,value:t.attributeValue==="{ occupied: true }"?"Occupied":"Unocc."})),o===262&&s.filter(t=>t.clusterName==="IlluminanceMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(G,{icon:e.jsx(io,{}),cluster:t,value:Math.round(Math.pow(10,t.attributeValue/1e4)),unit:"lx"})),o===1296&&s.filter(t=>t.clusterName==="ElectricalEnergyMeasurement"&&t.attributeName==="cumulativeEnergyImported").map(t=>e.jsx(G,{icon:e.jsx(ao,{}),cluster:t,value:Math.round(t.attributeLocalValue?.energy/1e6),unit:"kwh"})),e.jsx(Z,{sx:vn,children:e.jsx(de,{sx:yn,children:b})}),e.jsx(Z,{sx:jn,children:e.jsx(de,{sx:Cn,children:n.name})}),e.jsxs(Z,{sx:Sn,children:[i&&e.jsx(de,{sx:Nt,children:c}),e.jsx(de,{sx:Nt,children:a}),i&&e.jsxs(de,{sx:Nt,children:["0x",o.toString(16).padStart(4,"0")]})]})]})}function Nn({filter:n}){const{online:c,sendMessage:a,addListener:o,removeListener:s,getUniqueId:m}=r.useContext(fe),[b,t]=r.useState(!1),[g,S]=r.useState({}),[F,v]=r.useState([]),[T,O]=r.useState([]),[y,P]=r.useState({}),[p,E]=r.useState({}),[C,L]=r.useState({}),[R,V]=r.useState(T),_=r.useRef(m()),q=()=>{t(!b)};return r.useEffect(()=>{const Y=l=>{if(l.src==="Matterbridge"&&l.dst==="Frontend"){if(l.method==="refresh_required"&&(i&&console.log("DevicesIcons received refresh_required and sending api requests"),a({id:_.current,sender:"Icons",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),a({id:_.current,sender:"Icons",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),a({id:_.current,sender:"Icons",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}})),l.method==="/api/settings"&&l.response&&(i&&console.log("DevicesIcons received settings:",l.response),S(l.response)),l.method==="/api/plugins"&&l.response&&(i&&console.log("DevicesIcons received plugins:",l.response),v(l.response)),l.method==="/api/devices"&&l.response){i&&console.log(`DevicesIcons received ${l.response.length} devices:`,l.response),O(l.response);for(let h of l.response)i&&console.log("DevicesIcons sending /api/clusters"),a({id:_.current,sender:"Icons",method:"/api/clusters",src:"Frontend",dst:"Matterbridge",params:{plugin:h.pluginName,endpoint:h.endpoint}})}if(l.method==="/api/clusters"&&l.response){if(i&&console.log(`DevicesIcons received for device "${l.deviceName}" serial "${l.serialNumber}" deviceType ${l.deviceTypes.join(" ")} clusters (${l.response.length}):`,l.response),l.response.length===0)return;const h=l.serialNumber;y[h]=[],p[h]=l.deviceTypes,C[h]=[];for(let f of l.response)y[h].find(D=>D.endpoint===f.endpoint)||y[h].push({endpoint:f.endpoint,id:f.id,deviceTypes:f.deviceTypes}),!["FixedLabel","Descriptor","Identify","Groups","PowerTopology"].includes(f.clusterName)&&C[h].push(f);P({...y}),E({...p}),L({...C}),i&&console.log(`DevicesIcons endpoints for "${h}":`,y[h]),i&&console.log(`DevicesIcons deviceTypes for "${h}":`,p[h]),i&&console.log(`DevicesIcons clusters for "${h}":`,C[h])}}};return o(Y),i&&console.log("DevicesIcons useEffect webSocket mounted"),()=>{s(Y),i&&console.log("DevicesIcons useEffect webSocket unmounted")}},[o,s,a]),r.useEffect(()=>(i&&console.log("DevicesIcons useEffect online mounting"),c&&(i&&console.log("DevicesIcons useEffect online sending api requests"),a({id:_.current,sender:"Icons",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),a({id:_.current,sender:"Icons",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),a({id:_.current,sender:"Icons",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}})),i&&console.log("DevicesIcons useEffect online mounted"),()=>{i&&console.log("DevicesIcons useEffect online unmounted")}),[c,a]),r.useEffect(()=>{if(n===""){V(T);return}const Y=T.filter(l=>l.name.toLowerCase().includes(n)||l.serial.toLowerCase().includes(n));V(Y)},[T,n]),i&&console.log("DevicesIcons rendering..."),e.jsxs(e.Fragment,{children:[e.jsxs(Ie,{open:b,onClose:q,PaperProps:{style:{color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",border:"2px solid var(--primary-color)",borderRadius:"var(--div-border-radius)",boxShadow:"2px 2px 5px var(--div-shadow-color)"}},children:[e.jsx(ke,{children:"Configure accessories"}),e.jsx(De,{}),e.jsx(Ne,{children:e.jsx(oe,{onClick:q,children:"Close"})})]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",paddingBottom:"5px",gap:"20px",width:"100%",overflow:"auto"},children:R.map(Y=>y[Y.serial]&&y[Y.serial].map(l=>l.deviceTypes.map(h=>e.jsx(Dn,{device:Y,endpoint:l.endpoint,id:l.id,deviceType:h,clusters:C[Y.serial].filter(f=>f.endpoint===l.endpoint)}))))})]})}const sr=[{Header:"Plugin name",accessor:"pluginName"},{Header:"Device type",accessor:"type"},{Header:"Endpoint",accessor:"endpoint"},{Header:"Name",accessor:"name"},{Header:"Serial number",accessor:"serial"},{Header:"Unique ID",accessor:"uniqueId"},{Header:"Url",accessor:"configUrl"},{Header:"Config",accessor:"configButton",noSort:!0,Cell:({row:n})=>n.original.configUrl?e.jsx(B,{onClick:()=>window.open(n.original.configUrl,"_blank"),"aria-label":"Open Config",sx:{margin:0,padding:0},children:e.jsx(Ue,{fontSize:"small"})}):null},{Header:"Cluster",accessor:"cluster"}],lr=[{Header:"Endpoint",accessor:"endpoint"},{Header:"Id",accessor:"id"},{Header:"Device Types",accessor:"deviceTypes",Cell:({value:n})=>Array.isArray(n)?n.map(c=>`0x${c.toString(16).padStart(4,"0")}`).join(", "):n},{Header:"Cluster Name",accessor:"clusterName"},{Header:"Cluster ID",accessor:"clusterId"},{Header:"Attribute Name",accessor:"attributeName"},{Header:"Attribute ID",accessor:"attributeId"},{Header:"Attribute Value",accessor:"attributeValue",Cell:({value:n})=>e.jsx(H,{title:n,componentsProps:{tooltip:{sx:{fontSize:"14px",fontWeight:"normal",color:"#ffffff",backgroundColor:"var(--primary-color)"}}},children:e.jsx("div",{style:{maxWidth:"500px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n})})}],Pn=n=>`${n.pluginName}::${n.uniqueId}`,Wn=n=>`${n.endpoint}::${n.clusterName}::${n.attributeName}`;function Tn({data:n,columnVisibility:c,setPlugin:a,setEndpoint:o,setDeviceName:s}){const[m,b]=r.useState(null),t=Oe.useMemo(()=>sr.filter(y=>c[y.accessor]),[c]),{getTableProps:g,getTableBodyProps:S,headerGroups:F,rows:v,prepareRow:T}=$e.useTable({columns:t,data:n,getRowId:Pn},$e.useSortBy),O=y=>{if(y.id===m){b(null),a(null),o(null),s(null),i&&console.log("Device unclicked:",y.id,"selectedDeviceIndex:",m);return}b(y.id),a(y.original.pluginName),o(y.original.endpoint),s(y.original.name),i&&console.log("Device clicked:",y.id,"selectedDeviceIndex:",m,"pluginName:",y.original.pluginName,"endpoint:",y.original.endpoint)};return e.jsxs("table",{...g(),style:{margin:"-1px",border:"1px solid var(--table-border-color)"},children:[e.jsx("thead",{children:F.map(y=>e.jsx("tr",{...y.getHeaderGroupProps(),children:y.headers.map(P=>e.jsxs("th",{...P.getHeaderProps(P.noSort?void 0:P.getSortByToggleProps()),children:[P.render("Header"),!P.noSort&&e.jsx("span",{style:{margin:"0px",marginLeft:"5px",padding:"0px"},children:P.isSorted?P.isSortedDesc?e.jsx(te,{path:Pt,size:"15px"}):e.jsx(te,{path:Wt,size:"15px"}):null})]}))}))}),e.jsx("tbody",{...S(),children:v.map((y,P)=>(T(y),e.jsx("tr",{className:P%2===0?"table-content-even":"table-content-odd",...y.getRowProps(),onClick:()=>O(y),style:{backgroundColor:m===y.id?"var(--table-selected-bg-color)":"",cursor:"pointer"},children:y.cells.map(p=>e.jsx("td",{...p.getCellProps(),children:p.render("Cell")}))})))})]})}function Fn({data:n,columnVisibility:c}){const a=Oe.useMemo(()=>lr.filter(g=>c[g.accessor]),[c]),{getTableProps:o,getTableBodyProps:s,headerGroups:m,rows:b,prepareRow:t}=$e.useTable({columns:a,data:n,getRowId:Wn},$e.useSortBy);return e.jsxs("table",{...o(),style:{margin:"-1px"},children:[e.jsx("thead",{children:m.map(g=>e.jsx("tr",{...g.getHeaderGroupProps(),children:g.headers.map(S=>e.jsx("th",{...S.getHeaderProps(),children:S.render("Header")}))}))}),e.jsx("tbody",{...s(),children:b.map((g,S)=>(t(g),e.jsx("tr",{className:S%2===0?"table-content-even":"table-content-odd",...g.getRowProps(),children:g.cells.map(F=>e.jsx("td",{...F.getCellProps(),children:F.render("Cell")}))})))})]})}function Ln(){const{online:n,sendMessage:c,addListener:a,removeListener:o,getUniqueId:s}=r.useContext(fe),[m,b]=r.useState([]),[t,g]=r.useState([]),[S,F]=r.useState(null),[v,T]=r.useState(null),[O,y]=r.useState(null),[P,p]=r.useState(0),[E,C]=r.useState(!1),[L,R]=r.useState({pluginName:!0,type:!0,endpoint:!0,name:!0,serial:!0,uniqueId:!1,configUrl:!1,configButton:!0,cluster:!0}),[V,_]=r.useState(!1),[q,Y]=r.useState({endpoint:!0,id:!0,deviceTypes:!0,clusterName:!0,clusterId:!0,attributeName:!0,attributeId:!0,attributeValue:!0}),[l,h]=r.useState(""),[f,D]=r.useState(m),[X,he]=r.useState("icon"),j=r.useRef(s());r.useEffect(()=>{const z=M=>{if(i&&console.log("Devices received WebSocket Message:",M),M.src==="Matterbridge"&&M.dst==="Frontend"&&(M.method==="refresh_required"&&(i&&console.log("Devices received refresh_required"),c({id:j.current,sender:"Devices",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}})),M.method==="/api/devices"&&(i&&console.log(`Devices received ${M.response.length} devices:`,M.response),b(M.response)),M.method==="/api/clusters")){i&&console.log(`Devices received ${M.response.length} clusters:`,M.response),g(M.response);const I={};for(const w of M.response)i&&console.log("Cluster:",w.endpoint),I[w.endpoint]?I[w.endpoint]++:I[w.endpoint]=1;p(Object.keys(I).length)}};return a(z),i&&console.log("Devices added WebSocket listener"),()=>{o(z),i&&console.log("Devices removed WebSocket listener")}},[a,o,c]),r.useEffect(()=>{n&&(i&&console.log("Devices sending api requests"),c({id:j.current,sender:"Devices",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:j.current,sender:"Devices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:j.current,sender:"Devices",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}}))},[n,c]),r.useEffect(()=>{S&&v&&(i&&console.log("Devices sending /api/clusters"),c({id:j.current,sender:"Devices",method:"/api/clusters",src:"Frontend",dst:"Matterbridge",params:{plugin:S,endpoint:v}}))},[S,v,c]);const u=()=>{C(!E)},$=z=>{R(M=>{const I={...M,[z]:!M[z]};return localStorage.setItem("devicesColumnVisibility",JSON.stringify(I)),I})};r.useEffect(()=>{const z=localStorage.getItem("devicesColumnVisibility");z&&R(JSON.parse(z))},[]);const k=()=>{_(!V)},ee=z=>{Y(M=>{const I={...M,[z]:!M[z]};return localStorage.setItem("clustersColumnVisibility",JSON.stringify(I)),I})};r.useEffect(()=>{const z=localStorage.getItem("clustersColumnVisibility");z&&Y(JSON.parse(z))},[]);const xe=z=>{h(z.target.value.toLowerCase()),localStorage.setItem("devicesFilter",z.target.value.toLowerCase())},Se=z=>{he(z),localStorage.setItem("devicesViewMode",z)};return r.useEffect(()=>{if(l===""){D(m);return}const z=m.filter(M=>M.name.toLowerCase().includes(l)||M.serial.toLowerCase().includes(l));D(z)},[m,l]),r.useEffect(()=>{const z=localStorage.getItem("devicesFilter");z&&h(z)},[]),r.useEffect(()=>{const z=localStorage.getItem("devicesViewMode");z&&he(z)},[]),i&&console.log("Devices rendering..."),n?e.jsxs("div",{className:"MbfPageDiv",children:[e.jsxs("div",{className:"MbfWindowBodyRow",style:{justifyContent:"space-between",padding:0,gap:"20px",width:"100%",height:"45px",minHeight:"45px",maxHeight:"45px"},children:[e.jsxs(Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx(de,{sx:{fontSize:"16px",fontWeight:"normal",color:"var(--div-text-color)",marginLeft:"5px",whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(pe,{variant:"outlined",value:l,onChange:xe,placeholder:"Enter the device name or serial number",sx:{width:"320px"},InputProps:{style:{backgroundColor:"var(--main-bg-color)"}}})]}),e.jsxs(Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx(de,{sx:{fontSize:"16px",fontWeight:"normal",color:"var(--div-text-color)",marginLeft:"5px",whiteSpace:"nowrap"},children:"View mode:"}),e.jsx(B,{onClick:()=>Se("table"),"aria-label":"Table View",disabled:X==="table",children:e.jsx(H,{title:"Table View",children:e.jsx(so,{style:{color:X==="table"?"var(--main-icon-color)":"var(--primary-color)"}})})}),e.jsx(B,{onClick:()=>Se("icon"),"aria-label":"Icon View",disabled:X==="icon",children:e.jsx(H,{title:"Icon View (beta)",children:e.jsx(lo,{style:{color:X==="icon"?"var(--main-icon-color)":"var(--primary-color)"}})})})]})]}),e.jsxs(Ie,{open:E,onClose:u,children:[e.jsx(ke,{children:"Configure Devices Columns"}),e.jsx(De,{children:e.jsx(it,{children:sr.map(z=>e.jsx(Pe,{control:e.jsx(We,{disabled:["pluginName","name","configButton"].includes(z.accessor),checked:L[z.accessor],onChange:()=>$(z.accessor)}),label:z.Header},z.accessor))})}),e.jsx(Ne,{children:e.jsx(oe,{onClick:u,children:"Close"})})]}),X==="table"&&e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",maxHeight:`${S&&v?"50%":"100%"}`,width:"100%",flex:"1 1 auto",overflow:"hidden"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Registered devices"}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(B,{onClick:u,"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(H,{title:"Configure columns",children:e.jsx(Ue,{style:{color:"var(--header-text-color)",fontSize:"19px"}})})})})]}),e.jsx("div",{className:"MbfWindowBodyColumn",style:{margin:"0",padding:"0",gap:"0"},children:e.jsx(Tn,{data:f,columnVisibility:L,setPlugin:F,setEndpoint:T,setDeviceName:y})}),e.jsx("div",{className:"MbfWindowFooter",style:{borderTop:"1px solid var(--table-border-color)",justifyContent:"flex-start"},children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontWeight:"normal",textAlign:"left"},children:["Total devices: ",f.length.toString()]})})]}),e.jsxs(Ie,{open:V,onClose:k,children:[e.jsx(ke,{children:"Configure Clusters Columns"}),e.jsx(De,{children:e.jsx(it,{children:lr.map(z=>e.jsx(Pe,{control:e.jsx(We,{disabled:["clusterName","attributeName","attributeValue"].includes(z.accessor),checked:q[z.accessor],onChange:()=>ee(z.accessor)}),label:z.Header},z.accessor))})}),e.jsx(Ne,{children:e.jsx(oe,{onClick:k,children:"Close"})})]}),X==="table"&&S&&v&&e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",height:"50%",maxHeight:"50%",width:"100%",flex:"1 1 auto",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsxs("div",{className:"MbfWindowHeaderText",style:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[e.jsxs("p",{style:{margin:"0px",padding:"0px"},children:['Clusters for device "',O,'" on endpoint ',v]}),e.jsx(B,{onClick:k,"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(H,{title:"Configure columns",children:e.jsx(Ue,{style:{color:"var(--header-text-color)",fontSize:"19px"}})})})]})}),e.jsx("div",{className:"MbfWindowBodyColumn",style:{margin:"0",padding:"0",gap:"0"},children:e.jsx(Fn,{data:t,columnVisibility:q})}),e.jsx("div",{className:"MbfWindowFooter",style:{borderTop:"1px solid var(--table-border-color)",justifyContent:"flex-start"},children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontWeight:"normal",textAlign:"left"},children:["Total child endpoints: ",P-1]})})]}),X==="icon"&&e.jsx(Nn,{filter:l,devices:f})]}):e.jsx(qe,{})}function Hn(){const[n,c]=r.useState(localStorage.getItem("logFilterLevel")??"info"),[a,o]=r.useState(localStorage.getItem("logFilterSearch")??"*"),[s,m]=r.useState(localStorage.getItem("logAutoScroll")!=="false"),{setMessages:b,setLogFilters:t,online:g,setAutoScroll:S}=r.useContext(fe),F=y=>{c(y.target.value),t(y.target.value,a),localStorage.setItem("logFilterLevel",y.target.value),i&&console.log("handleChangeLevel called with value:",y.target.value)},v=y=>{o(y.target.value),t(n,y.target.value),localStorage.setItem("logFilterSearch",y.target.value),i&&console.log("handleChangeSearch called with value:",y.target.value)},T=y=>{m(y.target.checked),S(y.target.checked),localStorage.setItem("logAutoScroll",y.target.value?"true":"false"),i&&console.log("handleAutoScrollChange called with value:",y.target.checked)},O=()=>{i&&console.log("handleClearLogsClick called"),b([])};return i&&console.log("Logs rendering..."),g?e.jsxs("div",{className:"MbfPageDiv",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",margin:"0px",padding:"0px",gap:"10px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Vt,{id:"select-level",style:{color:"var(--div-text-color)"},children:"Filter log by level:"}),e.jsxs(tt,{style:{height:"30px",backgroundColor:"var(--main-bg-color)"},labelId:"select-level",id:"debug-level",value:n,onChange:F,children:[e.jsx(N,{value:"debug",children:"Debug"}),e.jsx(N,{value:"info",children:"Info"}),e.jsx(N,{value:"notice",children:"Notice"}),e.jsx(N,{value:"warn",children:"Warn"}),e.jsx(N,{value:"error",children:"Error"}),e.jsx(N,{value:"fatal",children:"Fatal"})]}),e.jsx(Vt,{id:"search",style:{color:"var(--div-text-color)"},children:"Filter log by text:"}),e.jsx(pe,{style:{width:"300px"},size:"small",id:"logsearch",variant:"outlined",value:a,onChange:v,InputProps:{style:{height:"30px",padding:"0 0px",backgroundColor:"var(--main-bg-color)"}}}),e.jsx(Pe,{control:e.jsx(We,{checked:s,onChange:T}),label:"Auto scroll",style:{color:"var(--div-text-color)"}})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:e.jsx(H,{title:"Clear the logs",children:e.jsx(oe,{onClick:O,endIcon:e.jsx(jt,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Clear"})})})]}),e.jsx("div",{style:{flex:"1",overflow:"auto",margin:"0px",padding:"0px"},children:e.jsx(ar,{})})]}):e.jsx(qe,{})}const On=({open:n,ip:c,onClose:a,onSave:o})=>{const s=c?c.split(".").slice(0,3).join(".")+".1":"",[m,b]=r.useState("dhcp"),[t,g]=r.useState({ip:c??"",subnet:"255.255.255.0",gateway:s,dns:s}),S=T=>O=>{g({...t,[T]:O.target.value})},F=()=>{a()},v=()=>{const T=m==="static"?{type:m,...t}:{type:m};o(T),a()};return e.jsxs(Ie,{open:n,onClose:(T,O)=>{O==="backdropClick"||O==="escapeKeyDown"||a()},maxWidth:"sm",style:{maxWidth:"550px",margin:"auto"},children:[e.jsx(ke,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:"Network Configuration"})]})}),e.jsxs(De,{dividers:!0,children:[e.jsxs(tr,{component:"fieldset",fullWidth:!0,children:[e.jsx(Me,{component:"legend",children:"Select IP Configuration"}),e.jsxs(rr,{row:!0,value:m,onChange:T=>b(T.target.value),children:[e.jsx(Pe,{value:"dhcp",control:e.jsx(Ct,{}),label:"DHCP"}),e.jsx(Pe,{value:"static",control:e.jsx(Ct,{}),label:"Static"})]})]}),m==="static"&&e.jsxs(_e,{container:!0,spacing:2,sx:{mt:2},children:[e.jsx(_e,{item:!0,xs:12,sm:6,children:e.jsx(pe,{label:"IP Address",fullWidth:!0,value:t.ip,onChange:S("ip")})}),e.jsx(_e,{item:!0,xs:12,sm:6,children:e.jsx(pe,{label:"Subnet Mask",fullWidth:!0,value:t.subnet,onChange:S("subnet")})}),e.jsx(_e,{item:!0,xs:12,sm:6,children:e.jsx(pe,{label:"Gateway",fullWidth:!0,value:t.gateway,onChange:S("gateway")})}),e.jsx(_e,{item:!0,xs:12,sm:6,children:e.jsx(pe,{label:"DNS Server",fullWidth:!0,value:t.dns,onChange:S("dns")})})]})]}),e.jsxs(Ne,{children:[e.jsx(oe,{onClick:F,children:"Cancel"}),e.jsx(oe,{variant:"contained",onClick:v,children:"Save"})]})]})},Rn=({open:n,onClose:c,onSave:a})=>{const[o,s]=r.useState(""),[m,b]=r.useState(""),t=O=>{s(O.target.value)},g=O=>{b(O.target.value)},S=o.length>0&&o===m,F=()=>{c()},v=()=>{S&&(a(o),c())},T=()=>{a(""),c()};return e.jsxs(Ie,{open:n,onClose:(O,y)=>{y==="backdropClick"||y==="escapeKeyDown"||c()},maxWidth:"sm",style:{maxWidth:"500px",margin:"auto"},disableEscapeKeyDown:!0,children:[e.jsx(ke,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:"Change Password"})]})}),e.jsx(De,{dividers:!0,children:e.jsx(tr,{component:"fieldset",fullWidth:!0,sx:{margin:0,padding:0,gap:"20px"},children:e.jsxs(_e,{container:!0,spacing:2,sx:{mt:2},children:[e.jsx(_e,{item:!0,xs:12,children:e.jsx(pe,{type:"password",autoComplete:"new-password",label:"New Password",size:"small",variant:"outlined",fullWidth:!0,value:o,onChange:t})}),e.jsx(_e,{item:!0,xs:12,children:e.jsx(pe,{type:"password",autoComplete:"new-password",label:"Confirm Password",size:"small",variant:"outlined",fullWidth:!0,value:m,onChange:g,error:m!==""&&o!==m,helperText:m!==""&&o!==m?"Passwords do not match":""})})]})})}),e.jsxs(Ne,{children:[e.jsx(oe,{onClick:F,children:"Cancel"}),e.jsx(oe,{variant:"contained",onClick:v,disabled:!S,children:"Change"}),e.jsx(oe,{variant:"contained",onClick:T,children:"Reset"})]})]})};function En(){const{online:n,addListener:c,removeListener:a,sendMessage:o,getUniqueId:s}=r.useContext(fe),[m,b]=r.useState(null),[t,g]=r.useState(null),S=r.useRef(s());return r.useEffect(()=>{const F=v=>{v.src==="Matterbridge"&&v.dst==="Frontend"&&(v.method==="refresh_required"&&(i&&console.log("Settings received refresh_required"),o({id:S.current,sender:"Settings",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),v.method==="/api/settings"&&(i&&console.log("Settings received /api/settings:",v.response),b(v.response.matterbridgeInformation),g(v.response.systemInformation)))};return c(F),i&&console.log("Settings added WebSocket listener"),()=>{a(F),i&&console.log("Settings removed WebSocket listener")}},[c,a,o]),r.useEffect(()=>{n&&(i&&console.log("Settings received online"),o({id:S.current,sender:"Settings",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}))},[n,o]),m?(i&&console.log("Settings rendering..."),n?e.jsx("div",{className:"MbfPageDiv",children:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"20px",width:"100%"},children:[e.jsx(Vn,{matterbridgeInfo:m,systemInfo:t}),e.jsx(_n,{matterbridgeInfo:m}),e.jsx($n,{matterbridgeInfo:m})]})}):e.jsx(qe,{})):null}function Vn({matterbridgeInfo:n,systemInfo:c}){const{sendMessage:a,getUniqueId:o}=r.useContext(fe),[s,m]=r.useState("bridge"),[b,t]=r.useState("Info"),[g,S]=r.useState(!1),[F,v]=r.useState("dark"),[T,O]=r.useState(localStorage.getItem("homePagePlugins")!=="false"),[y,P]=r.useState(localStorage.getItem("homePageMode")??"logs"),[p,E]=r.useState(localStorage.getItem("virtualMode")??"outlet"),C=r.useRef(o()),[L,R]=r.useState(!1),V=()=>R(!1),_=k=>{i&&console.log("handleSaveNetConfig called with config:",k),a({id:C.current,sender:"Settings",method:"/api/shellynetconfig",src:"Frontend",dst:"Matterbridge",params:k})},[q,Y]=r.useState(!1),l=()=>Y(!1),h=k=>{i&&console.log("handleSaveChangePassword called with password:",k),a({id:C.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setpassword",value:k}})};r.useEffect(()=>{n.bridgeMode!==void 0&&(m(n.bridgeMode==="bridge"?"bridge":"childbridge"),t(n.loggerLevel.charAt(0).toUpperCase()+n.loggerLevel.slice(1)),S(n.fileLogger),E(n.virtualMode))},[n]),r.useEffect(()=>{const k=localStorage.getItem("frontendTheme");k&&v(k)},[]);const f=k=>{i&&console.log("handleChangeBridgeMode called with value:",k.target.value),m(k.target.value),a({id:C.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setbridgemode",value:k.target.value}})},D=k=>{i&&console.log("handleChangeMbLoggerLevel called with value:",k.target.value),t(k.target.value),a({id:C.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmbloglevel",value:k.target.value}})},X=k=>{i&&console.log("handleLogOnFileMbChange called with value:",k.target.checked),S(k.target.checked),a({id:C.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmblogfile",value:k.target.checked}})},he=k=>{const ee=k.target.value;i&&console.log("handleChangeTheme called with value:",ee),v(ee),localStorage.setItem("frontendTheme",ee),document.body.setAttribute("frontend-theme",ee)},j=k=>{const ee=k.target.checked;i&&console.log("handleChangeHomePagePlugins called with value:",ee),O(ee),localStorage.setItem("homePagePlugins",ee?"true":"false")},u=k=>{const ee=k.target.value;i&&console.log("handleChangeHomePageMode called with value:",ee),P(ee),localStorage.setItem("homePageMode",ee)},$=k=>{const ee=k.target.value;i&&console.log("handleChangeVirtualMode called with value:",ee),E(ee),localStorage.setItem("virtualMode",ee),a({id:C.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setvirtualmode",value:ee}})};return e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge settings"})}),e.jsx(On,{open:L,ip:c.ipv4Address,onClose:V,onSave:_}),e.jsx(Rn,{open:q,onClose:l,onSave:h}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(Z,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Me,{style:{padding:"0px",margin:"0px"},id:"matterbridgeInfo-mode",children:"Matterbridge mode:"}),e.jsxs(rr,{row:!0,name:"mode-buttons-group",value:s,onChange:f,children:[e.jsx(Pe,{value:"bridge",control:e.jsx(Ct,{}),label:"Bridge",disabled:n.readOnly===!0}),e.jsx(Pe,{value:"childbridge",control:e.jsx(Ct,{}),label:"Childbridge",disabled:n.readOnly===!0})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Me,{style:{padding:"0px",margin:"0px"},id:"mblogger-level-label",children:"Logger level:"}),e.jsxs(tt,{style:{height:"30px"},labelId:"mblogger-level-label",id:"mblogger-level",value:b,onChange:D,children:[e.jsx(N,{value:"Debug",children:"Debug"}),e.jsx(N,{value:"Info",children:"Info"}),e.jsx(N,{value:"Notice",children:"Notice"}),e.jsx(N,{value:"Warn",children:"Warn"}),e.jsx(N,{value:"Error",children:"Error"}),e.jsx(N,{value:"Fatal",children:"Fatal"})]}),e.jsx(Pe,{style:{padding:"0px",margin:"0px"},control:e.jsx(We,{checked:g,onChange:X,name:"logOnFileMb"}),label:"Log on file:",labelPlacement:"start"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(Me,{style:{padding:"0px",margin:"0px"},id:"frontend-theme-label",children:"Frontend theme:"}),e.jsxs(tt,{style:{height:"30px"},labelId:"frontend-theme-label",id:"frontend-theme",value:F,onChange:he,children:[e.jsx(N,{value:"classic",children:"Classic"}),e.jsx(N,{value:"light",children:"Light"}),e.jsx(N,{value:"dark",children:"Dark"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(Me,{style:{padding:"0px",margin:"0px"},id:"frontend-home-plugin-label",children:"Home page plugins:"}),e.jsx(We,{checked:T,onChange:j,name:"showPlugins"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(Me,{style:{padding:"0px",margin:"0px"},id:"frontend-home-label",children:"Home page bottom panel:"}),e.jsxs(tt,{style:{height:"30px"},labelId:"frontend-home-label",id:"frontend-home",value:y,onChange:u,children:[e.jsx(N,{value:"logs",children:"Logs"}),e.jsx(N,{value:"devices",children:"Devices"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"10px"},children:[e.jsx(Me,{style:{padding:"0px",margin:"0px"},id:"frontend-virtual-label",children:"Virtual devices:"}),e.jsxs(tt,{style:{height:"30px"},labelId:"frontend-virtual-label",id:"frontend-virtual",value:p,onChange:$,children:[e.jsx(N,{value:"disabled",children:"Disabled"}),e.jsx(N,{value:"outlet",children:"Outlet"}),e.jsx(N,{value:"light",children:"Light"}),e.jsx(N,{value:"switch",children:"Switch"}),e.jsx(N,{value:"mounted_switch",children:"Mounted Switch"})]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"20px"},children:e.jsx(oe,{variant:"contained",color:"primary",onClick:()=>Y(!0),children:"Change password"})}),n.shellyBoard&&e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"20px"},children:e.jsx(oe,{variant:"contained",color:"primary",onClick:()=>R(!0),children:"Configure IP"})})]})})]})}function _n({matterbridgeInfo:n}){const{sendMessage:c,getUniqueId:a}=r.useContext(fe),[o,s]=r.useState("Info"),[m,b]=r.useState(!1),[t,g]=r.useState(""),[S,F]=r.useState(""),[v,T]=r.useState(""),[O,y]=r.useState(),[P,p]=r.useState(),[E,C]=r.useState(),L=r.useRef(a());r.useEffect(()=>{n.bridgeMode!==void 0&&(s(["Debug","Info","Notice","Warn","Error","Fatal"][n.matterLoggerLevel]),b(n.matterFileLogger),g(n.mattermdnsinterface),F(n.matteripv4address),T(n.matteripv6address),y(n.matterPort),p(n.matterDiscriminator),C(n.matterPasscode))},[n]);const R=D=>{i&&console.log("handleChangeMjLoggerLevel called with value:",D.target.value),s(D.target.value),c({id:L.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmjloglevel",value:D.target.value}})},V=D=>{i&&console.log("handleLogOnFileMjChange called with value:",D.target.checked),b(D.target.checked),c({id:L.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmjlogfile",value:D.target.checked}})},_=D=>{i&&console.log("handleChangeMdnsInterface called with value:",D.target.value),g(D.target.value),c({id:L.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmdnsinterface",value:D.target.value}})},q=D=>{i&&console.log("handleChangeIpv4Address called with value:",D.target.value),F(D.target.value),c({id:L.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setipv4address",value:D.target.value}})},Y=D=>{i&&console.log("handleChangeIpv6Address called with value:",D.target.value),T(D.target.value),c({id:L.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setipv6address",value:D.target.value}})},l=D=>{i&&console.log("handleChangeMatterPort called with value:",D.target.value),y(D.target.value),c({id:L.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterport",value:D.target.value}})},h=D=>{i&&console.log("handleChangeMatterDiscriminator called with value:",D.target.value),p(D.target.value),c({id:L.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterdiscriminator",value:D.target.value}})},f=D=>{i&&console.log("handleChangemMatterPasscode called with value:",D.target.value),C(D.target.value),c({id:L.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterpasscode",value:D.target.value}})};return e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matter settings"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(Z,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Me,{style:{padding:"0px",margin:"0px"},id:"mjdebug-info",children:"Logger level:"}),e.jsxs(tt,{style:{height:"30px"},labelId:"select-mjlevel",id:"mjdebug-level",value:o,onChange:R,children:[e.jsx(N,{value:"Debug",children:"Debug"}),e.jsx(N,{value:"Info",children:"Info"}),e.jsx(N,{value:"Notice",children:"Notice"}),e.jsx(N,{value:"Warn",children:"Warn"}),e.jsx(N,{value:"Error",children:"Error"}),e.jsx(N,{value:"Fatal",children:"Fatal"})]}),e.jsx(Pe,{style:{padding:"0px",margin:"0px"},control:e.jsx(We,{checked:m,onChange:V,name:"logOnFileMj"}),label:"Log on file:",labelPlacement:"start"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Me,{style:{padding:"0px",margin:"0px"},children:"Mdns interface:"}),e.jsx(pe,{value:t,onChange:_,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Me,{style:{padding:"0px",margin:"0px"},children:"Ipv4 address:"}),e.jsx(pe,{value:S,onChange:q,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Me,{style:{padding:"0px",margin:"0px"},children:"Ipv6 address:"}),e.jsx(pe,{value:v,onChange:Y,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Me,{style:{padding:"0px",margin:"0px"},children:"Commissioning port:"}),e.jsx(pe,{value:O,onChange:l,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Me,{style:{padding:"0px",margin:"0px"},children:"Commissioning discriminator:"}),e.jsx(pe,{value:P,onChange:h,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Me,{style:{padding:"0px",margin:"0px"},children:"Commissioning passcode:"}),e.jsx(pe,{value:E,onChange:f,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]})]})})]})}function $n({matterbridgeInfo:n}){return e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge info"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(Z,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:["          ",e.jsx(Be,{value:n.matterbridgeVersion,label:"Current Version"}),e.jsx(Be,{value:n.matterbridgeLatestVersion,label:"Latest Version"}),e.jsx(Be,{value:n.homeDirectory,label:"Home Directory"}),e.jsx(Be,{value:n.rootDirectory,label:"Root Directory"}),e.jsx(Be,{value:n.matterbridgeDirectory,label:"Matterbridge Storage Directory"}),e.jsx(Be,{value:n.matterbridgePluginDirectory,label:"Matterbridge Plugin Directory"}),e.jsx(Be,{value:n.globalModulesDirectory,label:"Global Module Directory"})]})})]})}function Be({value:n,label:c}){return e.jsx(pe,{focused:!0,value:n,size:"small",label:c,variant:"standard",sx:{width:"400px"},InputProps:{readOnly:!0,sx:{color:"var(--div-text-color)","&:before":{borderBottomColor:"var(--main-label-color)"},"&:after":{borderBottomColor:"var(--main-label-color)"}}},InputLabelProps:{sx:{marginTop:"3px",color:"var(--main-label-color)","&.Mui-focused":{color:"var(--main-label-color)"}}}})}function An(n,c,a){const o=n?.[a],s=c?.[a];return o==null&&s==null?0:o==null?-1:s==null?1:typeof o=="boolean"&&typeof s=="boolean"?o===s?0:o?1:-1:typeof o=="number"&&typeof s=="number"?o-s:String(o).localeCompare(String(s))}const zn=r.memo(function({name:c,columns:a,rows:o,getRowKey:s,footerLeft:m,footerRight:b}){const t=r.useRef(new WeakMap),g=r.useRef(1),S=l=>{if(typeof s=="string"&&l&&l[s]!=null)return l[s];if(typeof s=="function"){const D=s(l);if(D!=null)return D}const h=a?.[0]?.id;if(h&&l&&l[h]!=null)return l[h];console.warn(`MbfTable(${c}): using fallback stable row key; consider providing getRowKey prop for better React performance`);let f=t.current.get(l);return f||(f=`rk_${g.current++}`,t.current.set(l,f)),f},{_showConfirmCancelDialog:F}=r.useContext(rt),[v,T]=r.useState(localStorage.getItem(`${c}_table_order_by`)||null),[O,y]=r.useState(localStorage.getItem(`${c}_table_order`)||null),[P,p]=r.useState(!1),[E,C]=r.useState(()=>{try{const l=localStorage.getItem(`${c}_column_visibility`);if(l)return JSON.parse(l)}catch{}return{}}),L=r.useMemo(()=>{const l={};for(const h of a)h.hidden||(l[h.id]=h.required?!0:E[h.id]!==!1);return l},[a,E]),R=r.useMemo(()=>{if(!v||!O)return o;const l=a.find(f=>f.id===v);if(!l||l.nosort)return o;const h=o.map((f,D)=>({el:f,index:D}));return h.sort((f,D)=>{const X=An(f.el,D.el,v);return X!==0?O==="asc"?X:-X:f.index-D.index}),h.map(f=>f.el)},[o,v,O,a]),V=l=>{if(v!==l||!v){T(l),y("asc"),localStorage.setItem(`${c}_table_order_by`,l),localStorage.setItem(`${c}_table_order`,"asc");return}if(O==="asc"){y("desc"),localStorage.setItem(`${c}_table_order`,"desc");return}T(null),y(null),localStorage.removeItem(`${c}_table_order_by`),localStorage.removeItem(`${c}_table_order`)},_=()=>{p(!P)},q=l=>{C(h=>{const f=a.find(he=>he.id===l);if(f&&f.required)return h;const D=L[l]!==!1,X={...h};D?X[l]=!1:delete X[l];try{localStorage.setItem(`${c}_column_visibility`,JSON.stringify(X))}catch{}return X})},Y=()=>{const l={};C(l);try{localStorage.setItem(`${c}_column_visibility`,JSON.stringify(l))}catch{}};return console.log(`Rendering table ${c}${v&&O?` ordered by ${v}:${O}`:""}`),e.jsxs("div",{style:{display:"flex",flexDirection:"column",margin:"0",padding:"0",gap:"0",width:"100%",flex:"1 1 auto",height:"100%",minHeight:0,overflow:"hidden"},children:[e.jsxs(Ie,{open:P,onClose:(l,h)=>{h==="backdropClick"||h==="escapeKeyDown"||_()},disableEscapeKeyDown:!0,disableRestoreFocus:!0,children:[e.jsx(ke,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:`Configure ${c} columns`})]})}),e.jsx(De,{children:e.jsx(it,{children:a.filter(l=>!l.hidden).map(l=>e.jsx(Pe,{control:e.jsx(We,{disabled:!!l.required,checked:l.required?!0:L[l.id]!==!1,onChange:()=>q(l.id)}),label:l.label},l.id))})}),e.jsxs(Ne,{children:[e.jsx(oe,{onClick:Y,children:"Reset"}),e.jsx(oe,{variant:"contained",onClick:l=>{if(l?.currentTarget&&typeof l.currentTarget.blur=="function")try{l.currentTarget.blur()}catch{}const h=document.activeElement;if(h&&h instanceof HTMLElement&&typeof h.blur=="function")try{h.blur()}catch{}_()},children:"Close"})]})]}),e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",minHeight:"30px",justifyContent:"space-between",borderBottom:"none"},children:[e.jsx("p",{className:"MbfWindowHeaderText",children:c}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(B,{onClick:l=>{if(l?.currentTarget?.blur)try{l.currentTarget.blur()}catch{}_()},"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(H,{title:`Configure ${c} columns`,children:e.jsx(te,{path:Lo,size:"20px",style:{color:"var(--header-text-color)"}})})})})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",flex:"1 1 auto",minHeight:0,width:"100%",overflow:"auto",margin:"0px",padding:"0px",gap:"0"},children:e.jsxs("table",{"aria-label":`${c} table`,style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,border:"none",color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color"},children:e.jsx("tr",{style:{height:"30px",minHeight:"30px"},children:a.map(l=>{if(l.hidden||!l.required&&L[l.id]===!1)return null;const h=!l.nosort,f=h&&v===l.id&&!!O;return e.jsxs("th",{onClick:h?()=>V(l.id):void 0,style:{margin:"0",padding:"4px 8px",position:"sticky",top:0,minWidth:l.minWidth,maxWidth:l.maxWidth,textAlign:l.align||"left",cursor:h?"pointer":"default",border:"none",color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color)",whiteSpace:l.maxWidth?"nowrap":void 0,overflow:l.maxWidth?"hidden":void 0,textOverflow:l.maxWidth?"ellipsis":void 0},"aria-sort":h?f?O==="asc"?"ascending":"descending":"none":void 0,children:[l.label,f&&e.jsxs("span",{style:{marginLeft:6},children:[O==="asc"&&e.jsx(te,{path:Wt,size:"15px"}),O==="desc"&&e.jsx(te,{path:Pt,size:"15px"})]})]},l.id)})})}),e.jsx("tbody",{children:R.map((l,h)=>{const f=S(l);return e.jsx("tr",{className:h%2===0?"table-content-even":"table-content-odd",style:{height:"30px",minHeight:"30px",border:"none",borderCollapse:"collapse"},children:a.map(D=>{if(D.hidden||!D.required&&L[D.id]===!1)return null;const X=l[D.id];return e.jsx("td",{style:{border:"none",borderCollapse:"collapse",textAlign:D.align||"left",padding:"4px 8px",margin:"0",maxWidth:D.maxWidth,whiteSpace:D.maxWidth?"nowrap":void 0,overflow:D.maxWidth?"hidden":void 0,textOverflow:D.maxWidth?"ellipsis":void 0},children:typeof D.render=="function"?D.render(X,f,l,D):typeof X=="boolean"?e.jsx(We,{checked:X,disabled:!0,size:"small",sx:{m:0,p:0,color:"var(--table-text-color)","&.Mui-disabled":{color:"var(--table-text-color)",opacity:.7}}}):D.format&&typeof X=="number"?D.format(X):X??""},D.id)})},f)})})]})}),e.jsxs("div",{className:"MbfWindowFooter",style:{height:"30px",minHeight:"30px",justifyContent:"space-between",border:"none"},children:[e.jsx("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)"},children:m}),e.jsx("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)"},children:b})]})]})});function Bn(){const{online:n,sendMessage:c,addListener:a,removeListener:o,getUniqueId:s}=r.useContext(fe),{showSnackbarMessage:m,closeSnackbarMessage:b}=r.useContext(rt),[t,g]=r.useState(null),[S,F]=r.useState([]),[v,T]=r.useState([]),[O,y]=r.useState([]),[P,p]=r.useState(null),[E,C]=r.useState(null),[L,R]=r.useState(null),V=r.useRef(null),[_,q]=r.useState(()=>dr);V.current||(V.current=s(),console.log("Test uniqueId:",V)),r.useEffect(()=>{console.log("Test useEffect WebSocketMessage mounting");const l=h=>{if(h.src==="Matterbridge"&&h.dst==="Frontend"){if(h.method==="restart_required"&&(console.log("Test received restart_required"),m("Restart required",0)),h.method==="refresh_required"&&(console.log("Test received refresh_required"),m("Refresh required",0),c({id:V.current,method:"/api/settings",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:V.current,method:"/api/plugins",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:V.current,method:"/api/devices",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}})),h.method==="memory_update"&&(console.log("Test received memory_update",h),C(h.params)),h.method==="cpu_update"&&(console.log("Test received cpu_update",h),p(h.params)),h.method==="uptime_update"&&(console.log("Test received uptime_update",h),R(h.params)),h.method==="/api/settings"&&h.response&&(console.log("Test received /api/settings:",h.response),m("Test received /api/settings"),g(h.response)),h.method==="/api/plugins"&&h.response&&(console.log(`Test received ${h.response.length} plugins:`,h.response),m("Test received /api/plugins"),F(h.response)),h.method==="/api/devices"&&h.response){console.log(`Test received ${h.response.length} devices:`,h.response),m("Test received /api/devices"),T(h.response);for(let f of h.response)console.log("Test sending /api/clusters for device:",f.pluginName,f.name,f.endpoint),c({method:"/api/clusters",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{plugin:f.pluginName,endpoint:f.endpoint}})}h.method==="/api/clusters"&&(console.log(`Test received ${h.response.length} clusters for device ${h.deviceName} endpoint ${h.endpoint}:`,h),m("Test received /api/clusters"),y(h.response))}else console.log("Test received WebSocketMessage:",h.method,h.src,h.dst,h.response)};return a(l),console.log("Test useEffect WebSocketMessage mounted"),()=>{console.log("Test useEffect WebSocketMessage unmounting"),o(l),console.log("Test useEffect WebSocketMessage unmounted")}},[a,o,c,m]),r.useEffect(()=>(console.log("Test useEffect online mounting"),n&&(console.log("Test useEffect online received online"),c({method:"/api/settings",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),c({method:"/api/plugins",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),c({method:"/api/devices",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}})),console.log("Test useEffect online mounted"),()=>{console.log("Test useEffect online unmounted")}),[n,c,m]);const Y=r.useCallback(l=>l.code,[]);return console.log("Test rendering..."),n?e.jsx("div",{className:"MbfPageDiv",style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"20px",width:"100%"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"256px",width:"256px",margin:"10px"}}),e.jsx("p",{children:"Welcome to the Test page of the Matterbridge frontend"}),e.jsx("div",{style:{margin:"0",padding:"0",gap:"0",width:"1200px",maxWidth:"1200px",height:"600px",maxHeight:"600px",overflow:"hidden",border:"1px solid #0004ffff"},children:e.jsx(zn,{name:"Test",columns:Un,rows:_,getRowKey:Y,footerLeft:"Left Footer",footerRight:"Right Footer"})}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx(oe,{variant:"contained",color:"primary",onClick:()=>{console.log("Test button clicked"),m("Test button clicked"),b("Refresh required"),b("Restart required"),b("Test permanent message removal")},children:"Test"}),e.jsx(oe,{variant:"outlined",onClick:()=>{q(l=>{const h=l.findIndex(he=>he.code==="F123");if(h===-1)return l;const f=l[h],D={...f,population:(f.population||0)+1},X=l.slice();return X[h]=D,X})},children:"Update F123"})]})]})}):e.jsx(qe,{})}const Un=[{id:"name",label:"Name",minWidth:50,maxWidth:100,required:!0},{id:"code",label:"ISO Code",minWidth:100,render:(n,c)=>e.jsx("span",{style:{display:"inline-block",padding:"2px 6px",borderRadius:"8px",backgroundColor:"var(--chip-bg, #e6f4ff)",color:"var(--chip-fg, #0550ae)",fontFamily:'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',fontSize:"0.85em"},children:String(n)})},{id:"isIsland",label:"Island",minWidth:80,align:"center"},{id:"population",label:"Population",minWidth:170,align:"right",format:n=>n.toLocaleString("en-US")},{id:"size",label:"Size (km²)",minWidth:170,align:"right",format:n=>n.toLocaleString("en-US")},{id:"density",label:"Density",minWidth:170,align:"right",nosort:!0,format:n=>n.toFixed(2)},{id:"virtual",label:"Virtual",align:"right",required:!0,nosort:!0,render:(n,c,a)=>a.isIsland?"🏝️":"🏞️"}];function Ce(n,c,a,o,s){const m=a/o;return{name:n,code:c,population:a,size:o,density:m,isIsland:s}}const dr=[Ce("India","IN",1324171354,3287263,!1),Ce("China","CN",1403500365,9596961,!1),Ce("Italy","IT",60483973,301340,!1),Ce("United States","US",327167434,9833520,!1),Ce("Canada is a truly wonderful country","CA",37602103,9984670,!1),Ce("Australia","AU",25475400,7692024,!0),Ce("Germany","DE",83019200,357578,!1),Ce("Ireland","IE",4857e3,70273,!0),Ce("Mexico","MX",126577691,1972550,!1),Ce("Japan","JP",126317e3,377973,!0),Ce("France","FR",67022e3,640679,!1),Ce("United Kingdom","GB",67545757,242495,!0),Ce("Russia","RU",146793744,17098246,!1),Ce("Nigeria","NG",200962417,923768,!1),Ce("Brazil","BR",210147125,8515767,!1)],Qt=["Zor","Eld","Myth","Drak","Lum","Xen","Thal","Quor","Vex","Nyx"],Kt=["aria","dor","mere","land","wyn","gard","heim","quess","tor","vale"];for(let n=0;n<2e3;n++){const c=`${Qt[n%Qt.length]}${Kt[n%Kt.length]} ${n}`,a=`F${n.toString().padStart(3,"0")}`,o=Math.floor(Math.random()*1e9),s=Math.floor(Math.random()*1e7),m=Math.random()<.2;dr.push(Ce(c,a,o,s,m))}function qn(n,c){i&&console.log("getCssVariable:",n,"defaultValue",c);const a=getComputedStyle(document.body).getPropertyValue(n).trim();return a||console.error("getCssVariable: undefined",a),a||c}function Jn(n){return co({palette:{primary:{main:n},action:{disabled:"var(--main-label-color)"},text:{disabled:"var(--main-label-color)"}},typography:{fontFamily:"Roboto, Helvetica, Arial, sans-serif"},components:{MuiDialog:{styleOverrides:{paper:{color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",border:"2px solid var(--div-border-color)",borderRadius:"var(--div-border-radius)",boxShadow:"2px 2px 5px var(--div-shadow-color)"}}},MuiTooltip:{defaultProps:{placement:"top-start",arrow:!0}},MuiButton:{styleOverrides:{root:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)","&:hover":{backgroundColor:"var(--main-button-bg-color)"},"&.Mui-disabled":{color:"var(--main-button-color)",backgroundColor:"var(--main-grey-color)"}},contained:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},outlined:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},text:{color:"var(--main-button-color)"}},defaultProps:{variant:"contained",size:"small"}},MuiIconButton:{styleOverrides:{root:{color:"var(--main-icon-color)","&:hover .MuiSvgIcon-root":{color:"var(--primary-color)"}}}},MuiCheckbox:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-checked":{color:"var(--primary-color)"}}}},MuiTextField:{defaultProps:{size:"small",variant:"outlined",fullWidth:!0}},MuiOutlinedInput:{styleOverrides:{root:{backgroundColor:"var(--div-bg-color)","& .MuiOutlinedInput-notchedOutline":{borderColor:"var(--main-label-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--main-text-color)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"var(--primary-color)"},padding:"0px"},input:{color:"var(--div-text-color)",padding:"4px 8px"}}},MuiInputLabel:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-focused":{color:"var(--primary-color)"}}}},MuiFormLabel:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-focused":{color:"var(--main-label-color)"}}}},MuiFormControl:{styleOverrides:{root:{color:"var(--main-grey-color)"}}},MuiRadio:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-checked":{color:"var(--primary-color)"}}}},MuiSelect:{styleOverrides:{root:{backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)",height:"30px","&:hover":{borderColor:"var(--main-text-color)"},"&.Mui-focused":{borderColor:"var(--primary-color)"}}}},MuiMenu:{styleOverrides:{paper:{backgroundColor:"var(--main-menu-bg-color)",padding:"0px",margin:"0px"},list:{padding:"0px"}}},MuiMenuItem:{styleOverrides:{root:{color:"var(--main-menu-color)",backgroundColor:"var(--main-menu-bg-color)","&:hover":{backgroundColor:"var(--main-menu-hover-color)"},"&.Mui-selected":{color:"var(--main-menu-color)",backgroundColor:"var(--main-menu-bg-color)"},"&.Mui-selected:hover":{backgroundColor:"var(--main-menu-hover-color)"}}}},MuiListItemButton:{styleOverrides:{root:{cursor:"pointer","&:hover":{backgroundColor:"var(--main-bg-color)"}}}},MuiListItemIcon:{styleOverrides:{root:{color:"var(--div-text-color)"}}},MuiListItemText:{styleOverrides:{primary:{fontSize:"16px",fontWeight:"bold",color:"var(--div-text-color)"},secondary:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"}}}}})}let i=!1;const Gn=()=>{i=!i},cr=r.createContext(void 0);function Qn({children:n}){const[c,a]=r.useState(!1),[o,s]=r.useState(""),m=async b=>{try{const t=await fetch("./api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:b})});if(t.ok){const{valid:g}=await t.json();g?a(!0):b!==""&&s("Incorrect password!")}else console.error("Failed to log in:",t.statusText)}catch(t){console.error("Failed to log in:",t)}};return e.jsx(cr.Provider,{value:{loggedIn:c,logIn:m,errorMessage:o},children:n})}function Kn(){const[n,c]=r.useState(""),a=r.useContext(cr),[o,s]=r.useState("#1976d2");if(!a)throw new Error("AuthContext not found");const{loggedIn:m,logIn:b,errorMessage:t}=a,g=y=>{y.preventDefault(),b(n)},S={display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",backgroundColor:"var(--main-bg-color)"},F={display:"flex",flexDirection:"column",maxWidth:"400px",margin:"0 auto",padding:"20px",gap:"20px",border:"1px solid var(--div-border-color)",borderRadius:"var(--div-border-radius)",boxShadow:"2px 2px 5px var(--div-shadow-color)",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},v={margin:"10px 0",padding:"3px 3px",fontSize:"14px",width:"230px",border:"1px solid var(--main-label-color)",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"};r.useEffect(()=>{i&&console.log("Setting frontend theme");const y=localStorage.getItem("frontendTheme");i&&console.log("Saved theme:",y),y?document.body.setAttribute("frontend-theme",y):document.body.setAttribute("frontend-theme","dark");const P=qn("--primary-color","#1976d2");i&&console.log("Primary color from CSS:",P),s(P)},[]);const T=window.location.pathname.includes("/matterbridge/")?"/matterbridge":window.location.href.includes("/api/hassio_ingress/")?window.location.pathname:"/";console.log(`Loading App.js with href="${window.location.href}" and pathname="${window.location.pathname}" >>> baseName="${T}"`);const O=Jn(o);return b(""),m?e.jsx(po,{theme:O,children:e.jsx(jr,{dense:!0,maxSnack:10,preventDuplicate:!0,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(Ko,{children:e.jsx(Yo,{children:e.jsx(xr,{basename:T,children:e.jsxs("div",{className:"MbfScreen",children:[e.jsx(Xo,{}),e.jsxs(fr,{children:[e.jsx(Ke,{path:"/",element:e.jsx(xn,{})}),e.jsx(Ke,{path:"/devices",element:e.jsx(Ln,{})}),e.jsx(Ke,{path:"/log",element:e.jsx(Hn,{})}),e.jsx(Ke,{path:"/settings",element:e.jsx(En,{})}),e.jsx(Ke,{path:"/test",element:e.jsx(Bn,{})}),e.jsx(Ke,{path:"*",element:e.jsx(br,{to:"/"})})]})]})})})})})}):e.jsx("div",{style:S,children:e.jsxs("form",{onSubmit:g,style:F,children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"64px",width:"64px"}}),e.jsx("h3",{style:{color:"var(--div-text-color)"},children:"Welcome to Matterbridge"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:"20px"},children:[e.jsx("input",{type:"text",name:"username",autoComplete:"username",style:{display:"none"},tabIndex:-1}),e.jsx("input",{type:"password",value:n,onChange:y=>c(y.target.value),style:v,placeholder:"password",autoComplete:"current-password"}),e.jsx("button",{type:"submit",style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",borderColor:"var(--div-bg-color)"},children:"Log in"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",margin:0,height:"30px"},children:t&&e.jsx("p",{style:{color:"red"},children:t})})]})})}function Yn(){return e.jsx(Qn,{children:e.jsx(Kn,{})})}vr.createRoot(document.getElementById("root")).render(e.jsx(Oe.StrictMode,{children:e.jsx(Yn,{})}));
