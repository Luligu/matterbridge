import{B as e,y as r,S as st,I as Ee,U as gr,V as hr,X as Ye,Y as xr,Z as fr}from"./vendor_node_modules.js";import{u as br,S as vr}from"./vendor_notistack.js";import{D as Ie,a as De,b as Ne,B as oe,c as Z,A as yr,I as z,C as jr,T as R,S as Cr,F as Yt,H as Sr,d as Xt,e as Ve,R as vt,P as ze,M as wr,f as tt,g as P,L as G,h as re,i as lt,V as dt,j as He,k as Dt,l as Mr,m as kr,n as pe,o as Ir,p as Dr,q as yt,r as de,s as We,K as Lt,t as Rt,u as Ct,v as ct,w as nt,x as pt,W as it,y as ut,z as mt,E as Pe,G as Ht,J as Ot,N as Nr,O as Pr,Q as at,U as Te,X as Be,Y as Zt,Z as Tr,_ as Wr,$ as Fr,a0 as Lr,a1 as er,a2 as jt,a3 as Rr,a4 as Hr,a5 as Or,a6 as $r,a7 as $t,a8 as Er,a9 as Vr,aa as _r,ab as Ar,ac as Ur,ad as zr,ae as qr,af as Et,ag as Br,ah as Jr,ai as Qr,aj as Gr,ak as Kr,al as Yr,am as Xr,an as Zr,ao as eo,ap as to,aq as ro,ar as oo,as as no,at as io,au as ao,av as Vt,aw as rt,ax as tr,ay as ke,az as rr,aA as St,aB as _e,aC as so,aD as lo}from"./vendor_mui.js";import{Q as co}from"./vendor_qrcode.js";import{I as te,m as _t,a as po,b as uo,c as At,d as mo,e as Tt,f as Wt,g as go,h as ho,i as xo,j as fo,k as bo,l as vo,n as yo,o as jo,p as Ut,q as Co,r as So,s as wo,t as Mo,u as ko,v as Io,w as Do,x as No,y as zt,z as Po,A as To,B as Wo}from"./vendor_mdi.js";import{r as Ae}from"./vendor_react_table.js";import{F as Fo,v as Lo,e as Ro,a as Ho,g as Oo,b as $o,c as Eo,d as Nt,A as Vo}from"./vendor_rjsf.js";import"./vendor_lodash.js";import"./vendor_emotion.js";(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const x of a)if(x.type==="childList")for(const v of x.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&n(v)}).observe(document,{childList:!0,subtree:!0});function i(a){const x={};return a.integrity&&(x.integrity=a.integrity),a.referrerPolicy&&(x.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?x.credentials="include":a.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function n(a){if(a.ep)return;a.ep=!0;const x=i(a);fetch(a.href,x)}})();/**
 * This file contains the types for WebSocket messages.
 *
 * @file frontendTypes.ts
 * @author Luca Liguori
 * @created 2025-09-17
 * @version 1.0.0
 * @license Apache-2.0
 *
 * Copyright 2025, 2026, 2027 Luca Liguori.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Se=(o=>(o[o.Log=0]="Log",o[o.RefreshRequired=1]="RefreshRequired",o[o.RestartRequired=2]="RestartRequired",o[o.RestartNotRequired=3]="RestartNotRequired",o[o.CpuUpdate=4]="CpuUpdate",o[o.MemoryUpdate=5]="MemoryUpdate",o[o.UptimeUpdate=6]="UptimeUpdate",o[o.Snackbar=7]="Snackbar",o[o.UpdateRequired=8]="UpdateRequired",o[o.StateUpdate=9]="StateUpdate",o[o.CloseSnackbar=10]="CloseSnackbar",o[o.ShellySysUpdate=100]="ShellySysUpdate",o[o.ShellyMainUpdate=101]="ShellyMainUpdate",o))(Se||{});function _o(o){return o.id>=0&&o.id<=101}function Ao({open:o,title:p,message:i,onConfirm:n,onCancel:a}){const x=t=>{l&&console.log("Confirmed"),t.preventDefault(),n()},v=t=>{l&&console.log("Canceled"),t.preventDefault(),a()};return e.jsxs(Ie,{open:o,children:[e.jsx(De,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:p})]})}),e.jsxs(Ne,{children:[e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",margin:"0",marginBottom:"20px",maxHeight:"350px",maxWidth:"350px"},children:e.jsx("p",{style:{flex:1,margin:"0"},children:i})}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-around"},children:[e.jsx(oe,{onClick:x,variant:"contained",color:"primary",size:"small",children:"Confirm"}),e.jsx(oe,{onClick:v,variant:"contained",color:"primary",size:"small",children:"Cancel"})]})]})]})}const gt=[],ot=r.createContext(null);function Uo({children:o}){const{enqueueSnackbar:p,closeSnackbar:i}=br(),n=r.useCallback(N=>{l&&console.log(`UiProvider closeSnackbarMessage: message ${N}`);const O=gt.findIndex(E=>E.message===N);O!==-1&&(i(gt[O].key),gt.splice(O,1),l&&console.log(`UiProvider closeSnackbarMessage: message ${N} removed from persistMessages`))},[i]),a=r.useCallback((N,O,E)=>{l&&console.log(`UiProvider showSnackbarMessage: message ${N} timeout ${O}`);const V=p(N,{variant:"default",autoHideDuration:O==null||O>0?(O??5)*1e3:null,persist:O===0,content:B=>e.jsx(Z,{sx:{margin:"0",padding:"0",width:"300px",marginRight:"30px"},children:e.jsx(yr,{severity:E??"info",variant:"filled",sx:{color:"#fff",fontWeight:"normal",width:"100%",cursor:"pointer",padding:"0px 10px"},onClick:()=>i(B),action:e.jsx(z,{size:"small",onClick:()=>i(B),sx:{color:"#fff"},children:e.jsx(jr,{fontSize:"small"})}),children:N},B)},B)});O===0&&(l&&console.log(`UiProvider showSnackbarMessage: message ${N} timeout ${O} - persist key ${V}`),gt.push({message:N,key:V}))},[p,i]),[x,v]=r.useState(!1),[t,s]=r.useState(""),[S,W]=r.useState(""),[b,F]=r.useState(""),H=r.useRef(null),j=r.useRef(null),$=()=>{l&&console.log(`UiProvider handle confirm action ${b}`),v(!1),H.current&&H.current(b)},u=()=>{l&&console.log(`UiProvider handle cancel action ${b}`),v(!1),j.current&&j.current(b)},L=r.useCallback((N,O,E,V,B)=>{l&&console.log(`UiProvider showConfirmCancelDialog for command ${E}`),s(N),W(O),F(E),H.current=V,j.current=B,v(!0)},[]),h=r.useMemo(()=>({showSnackbarMessage:a,closeSnackbarMessage:n,closeSnackbar:i,showConfirmCancelDialog:L}),[a,n,i,L]);return e.jsxs(ot.Provider,{value:h,children:[e.jsx(Ao,{open:x,title:t,message:S,onConfirm:$,onCancel:u}),o]})}const or=r.createContext(null),fe=r.createContext(null);function zo({children:o}){const[p,i]=r.useState(localStorage.getItem("logFilterLevel")??"info"),[n,a]=r.useState(localStorage.getItem("logFilterSearch")??"*"),[x,v]=r.useState([]),[t,s]=r.useState(1e3),[S,W]=r.useState(!0),[b,F]=r.useState(!1),{showSnackbarMessage:H,closeSnackbarMessage:j,closeSnackbar:$}=r.useContext(ot),u=r.useRef([]),L=r.useRef(null),h=r.useRef(1),N=r.useRef(Math.floor(Math.random()*999e3)+1e3),O=r.useRef(null),E=r.useRef(null),V=r.useRef(null),B=r.useRef(p),Y=r.useRef(n),d=r.useMemo(()=>window.location.href.replace(/^http/,"ws"),[]),f=r.useMemo(()=>window.location.href.includes("api/hassio_ingress"),[]),y=100,D=60,X=50,he=300;r.useEffect(()=>{B.current=p},[p]),r.useEffect(()=>{Y.current=n},[n]);const C=r.useCallback(()=>Math.floor(Math.random()*999e3)+1e3,[]),m=r.useCallback(M=>{if(L.current&&L.current.readyState===WebSocket.OPEN)try{M.id===void 0&&(M.id=N.current);const g=JSON.stringify(M);L.current.send(g),l&&console.log("WebSocket sent message:",M)}catch(g){l&&console.error(`WebSocket error sending message: ${g}`)}else l&&console.error("WebSocket message not sent, WebSocket not connected:",M)},[]),_=r.useCallback((M,g)=>{const c=`<span style="background-color: #5c0e91; color: white; padding: 1px 5px; font-size: 12px; border-radius: 3px;">${M}</span>`;v(T=>[...T,c+' <span style="color: var(--main-log-color);">'+g+"</span>"])},[]),I=r.useCallback((M,g)=>{i(M),a(g),_("WebSocket",`Filtering by log level "${M}" and log search "${g}"`)},[_]),ee=r.useCallback(M=>{l&&console.log("WebSocket addListener:",M),u.current=[...u.current,M],l&&console.log("WebSocket addListener total listeners:",u.current.length)},[]),xe=r.useCallback(M=>{l&&console.log("WebSocket removeListener:",M),u.current=u.current.filter(g=>g!==M),l&&console.log("WebSocket removeListener total listeners:",u.current.length)},[]),we=r.useCallback(()=>{d===""||d===null||d===void 0||(_("WebSocket",`Connecting to WebSocket: ${d}`),L.current=new WebSocket(d),L.current.onmessage=M=>{b||F(!0);try{const g=JSON.parse(M.data);if(g.id===void 0)return;if(g.error&&l&&console.error("WebSocket error message:",g),g.id===N.current&&g.src==="Matterbridge"&&g.dst==="Frontend"&&g.response==="pong"){l&&console.log("WebSocket pong response message:",g,"listeners:",u.current.length),E.current&&clearTimeout(E.current),u.current.forEach(T=>T(g));return}if(g.id===Se.RefreshRequired){l&&console.log("WebSocket WS_ID_REFRESH_REQUIRED message:",g,"listeners:",u.current.length),u.current.forEach(T=>T(g));return}else if(g.id===Se.RestartRequired){l&&console.log("WebSocket WS_ID_RESTART_REQUIRED message:",g,"listeners:",u.current.length),u.current.forEach(T=>T(g));return}else if(g.id===Se.RestartNotRequired){l&&console.log("WebSocket WS_ID_RESTART_NOT_REQUIRED message:",g,"listeners:",u.current.length),u.current.forEach(T=>T(g));return}else if(g.id===Se.CpuUpdate){l&&console.log("WebSocket WS_ID_CPU_UPDATE message:",g,"listeners:",u.current.length),u.current.forEach(T=>T(g));return}else if(g.id===Se.MemoryUpdate){l&&console.log("WebSocket WS_ID_MEMORY_UPDATE message:",g,"listeners:",u.current.length),u.current.forEach(T=>T(g));return}else if(g.id===Se.UptimeUpdate){l&&console.log("WebSocket WS_ID_UPTIME_UPDATE message:",g,"listeners:",u.current.length),u.current.forEach(T=>T(g));return}else if(g.id===Se.Snackbar&&g.params&&g.params.message){l&&console.log("WebSocket WS_ID_SNACKBAR message:",g,"listeners:",u.current.length),H(g.params.message,g.params.timeout,g.params.severity);return}else if(g.id===Se.CloseSnackbar&&g.params&&g.params.message){l&&console.log("WebSocket WS_ID_CLOSE_SNACKBAR message:",g,"listeners:",u.current.length),j(g.params.message);return}else if(g.id===Se.ShellySysUpdate){l&&console.log("WebSocket WS_ID_SHELLY_SYS_UPDATE message:",g,"listeners:",u.current.length),u.current.forEach(T=>T(g));return}else if(g.id===Se.ShellyMainUpdate){l&&console.log("WebSocket WS_ID_SHELLY_MAIN_UPDATE message:",g,"listeners:",u.current.length),u.current.forEach(T=>T(g));return}else if(g.id!==Se.Log){l&&console.log("WebSocket message:",g,"listeners:",u.current.length),u.current.forEach(T=>T(g));return}if(!g.params||!g.params.level||!g.params.time||!g.params.name||!g.params.message||["debug","info","notice","warn","error","fatal"].includes(g.params.level)&&(B.current==="info"&&g.params.level==="debug"||B.current==="notice"&&(g.params.level==="debug"||g.params.level==="info")||B.current==="warn"&&(g.params.level==="debug"||g.params.level==="info"||g.params.level==="notice")||B.current==="error"&&(g.params.level==="debug"||g.params.level==="info"||g.params.level==="notice"||g.params.level==="warn")||B.current==="fatal"&&(g.params.level==="debug"||g.params.level==="info"||g.params.level==="notice"||g.params.level==="warn"||g.params.level==="error"))||Y.current!=="*"&&Y.current!==""&&!g.params.message.toLowerCase().includes(Y.current.toLowerCase())&&!g.params.name.toLowerCase().includes(Y.current.toLowerCase())||g.params.name==="Commissioning"&&g.params.message.includes("is uncommissioned"))return;v(T=>{const ie=`<span style="color: #505050;">[${g.params?.time}]</span>`,se=be=>{switch(be?.toLowerCase()){case"debug":return"gray";case"info":return"#267fb7";case"notice":return"green";case"warn":return"#e9db18";case"error":return"red";case"fatal":return"#ff0000";case"spawn":return"#ff00d0";default:return"lightblue"}},q=be=>{switch(be?.toLowerCase()){case"warn":return"black";default:return"white"}},me=`${`<span style="background-color: ${se(g.params?.level)}; color: ${q(g.params?.level)}; padding: 1px 5px; font-size: 12px; border-radius: 3px;">${g.params?.level}</span>`} ${ie} <span style="color: #09516d;">[${g.params?.name}]</span> <span style="color: var(--main-log-color);">${g.params?.message}</span>`,ne=[...T,me];return ne.length>t?ne.slice(t/10):ne})}catch(g){console.error(`WebSocketUse error parsing message: ${g}`)}},L.current.onopen=()=>{l&&console.log(`WebSocket: Connected to WebSocket: ${d}`),_("WebSocket",`Connected to WebSocket: ${d}`),F(!0),$(),h.current=1,V.current=setTimeout(()=>{O.current=setInterval(()=>{m({id:N.current,method:"ping",src:"Frontend",dst:"Matterbridge",params:{}}),E.current&&clearTimeout(E.current),E.current=setTimeout(()=>{l&&console.error(`WebSocketUse: No pong response received from WebSocket: ${d}`),_("WebSocket",`No pong response received from WebSocket: ${d}`),F(!1)},1e3*X)},1e3*D)},1e3*he)},L.current.onclose=()=>{l&&console.error(`WebSocket: Disconnected from WebSocket ${f?"with Ingress":""}: ${d}`),_("WebSocket",`Disconnected from WebSocket: ${d}`),F(!1),$(),V.current&&clearTimeout(V.current),E.current&&clearTimeout(E.current),O.current&&clearInterval(O.current),_("WebSocket",`Reconnecting (attempt ${h.current} of ${y}) to WebSocket${f?" (Ingress)":""}: ${d}`),f?setTimeout(U,5e3):h.current===1?U():h.current<y?setTimeout(U,1e3*h.current):_("WebSocket",`Reconnect attempts exceeded limit of ${y} retries, refresh the page to reconnect to: ${d}`),h.current=h.current+1},L.current.onerror=M=>{l&&console.error(`WebSocket: WebSocket error connecting to ${d}:`,M),_("WebSocket",`WebSocket error connecting to ${d}`)})},[d]),U=r.useCallback(()=>{l&&console.log(`WebSocket attemptReconnect ${h.current}/${y} to:`,d),we()},[we]);r.useEffect(()=>(we(),()=>{L.current&&L.current.readyState===WebSocket.OPEN&&L.current.close()}),[we]);const w=r.useMemo(()=>({messages:x,maxMessages:t,autoScroll:S,setMessages:v,setLogFilters:I,setMaxMessages:s,setAutoScroll:W}),[x,v,I]),k=r.useMemo(()=>({maxMessages:t,autoScroll:S,logFilterLevel:p,logFilterSearch:n,setMessages:v,setLogFilters:I,setMaxMessages:s,setAutoScroll:W,online:b,retry:h.current,getUniqueId:C,addListener:ee,removeListener:xe,sendMessage:m,logMessage:_}),[t,S,v,I,s,W,b,h.current,ee,xe,m,_]);return e.jsx(or.Provider,{value:w,children:e.jsx(fe.Provider,{value:k,children:o})})}function qo(){const{showSnackbarMessage:o,showConfirmCancelDialog:p}=r.useContext(ot),{online:i,sendMessage:n,logMessage:a,addListener:x,removeListener:v,getUniqueId:t}=r.useContext(fe),[s,S]=r.useState(!1),[W,b]=r.useState(!1),[F,H]=r.useState(!1),[j,$]=r.useState(!1),[u,L]=r.useState(null),h=r.useRef(t()),[N,O]=r.useState(null),[E,V]=r.useState(null),[B,Y]=r.useState(null),[d,f]=r.useState(null),[y,D]=r.useState(null),X=()=>{window.open("https://www.buymeacoffee.com/luligugithub","_blank")},he=()=>{window.open("https://github.com/Luligu/matterbridge/blob/main/README.md","_blank")},C=()=>{u.matterbridgeInformation.matterbridgeVersion.includes("-dev-")?window.open("https://github.com/Luligu/matterbridge/blob/dev/CHANGELOG.md","_blank"):window.open("https://github.com/Luligu/matterbridge/blob/main/CHANGELOG.md","_blank")},m=()=>{window.open("https://discord.gg/QX58CDe6hd","_blank")},_=()=>{window.open("https://github.com/Luligu/matterbridge","_blank")},I=()=>{n({id:h.current,sender:"Header",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:"matterbridge",restart:!0}})},ee=()=>{n({id:h.current,sender:"Header",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:"matterbridge@dev",restart:!0}})},xe=()=>{n({id:h.current,sender:"Header",method:"/api/checkupdates",src:"Frontend",dst:"Matterbridge",params:{}})},we=()=>{l&&console.log("Header: handleShellySystemUpdateClick"),a("Matterbridge","Installing system updates..."),n({id:h.current,sender:"Header",method:"/api/shellysysupdate",src:"Frontend",dst:"Matterbridge",params:{}})},U=()=>{l&&console.log("Header: handleShellyMainUpdateClick"),a("Matterbridge","Installing software updates..."),n({id:h.current,sender:"Header",method:"/api/shellymainupdate",src:"Frontend",dst:"Matterbridge",params:{}})},w=()=>{l&&console.log("Header: handleShellyCreateSystemLog"),n({id:h.current,sender:"Header",method:"/api/shellycreatesystemlog",src:"Frontend",dst:"Matterbridge",params:{}})},k=()=>{l&&console.log("Header: handleShellyDownloadSystemLog"),a("Matterbridge","Downloading Shelly system log..."),o("Downloading Shelly system log...",5),window.location.href="./api/shellydownloadsystemlog"},M=()=>{u.matterbridgeInformation.restartMode===""?n({id:h.current,sender:"Header",method:"/api/restart",src:"Frontend",dst:"Matterbridge",params:{}}):n({id:h.current,sender:"Header",method:"/api/shutdown",src:"Frontend",dst:"Matterbridge",params:{}})},g=()=>{n({id:h.current,sender:"Header",method:"/api/shutdown",src:"Frontend",dst:"Matterbridge",params:{}})},c=()=>{n({id:h.current,sender:"Header",method:"/api/reboot",src:"Frontend",dst:"Matterbridge",params:{}})},T=()=>{n({id:h.current,sender:"Header",method:"/api/softreset",src:"Frontend",dst:"Matterbridge",params:{}})},ie=()=>{n({id:h.current,sender:"Header",method:"/api/hardreset",src:"Frontend",dst:"Matterbridge",params:{}})},se=J=>{O(J.currentTarget)},q=J=>{l&&console.log("Header: handleMenuClose",J),O(null),J==="download-mblog"?(a("Matterbridge","Downloading matterbridge log..."),o("Downloading matterbridge log...",5),window.location.href="./api/download-mblog"):J==="download-mjlog"?(a("Matterbridge","Downloading matter log..."),o("Downloading matter log...",5),window.location.href="./api/download-mjlog"):J==="view-mblog"?(a("Matterbridge","Loading matterbridge log..."),o("Loading matterbridge log...",5),window.location.href="./api/view-mblog"):J==="view-mjlog"?(a("Matterbridge","Loading matter log..."),o("Loading matter log...",5),window.location.href="./api/view-mjlog"):J==="view-shellylog"?(a("Matterbridge","Loading shelly system log..."),o("Loading shelly system log...",5),window.location.href="./api/shellyviewsystemlog"):J==="download-mbstorage"?(a("Matterbridge","Downloading matterbridge storage..."),o("Downloading matterbridge storage...",5),window.location.href="./api/download-mbstorage"):J==="download-pluginstorage"?(a("Matterbridge","Downloading matterbridge plugins storage..."),o("Downloading matterbridge plugins storage...",5),window.location.href="./api/download-pluginstorage"):J==="download-pluginconfig"?(a("Matterbridge","Downloading matterbridge plugins config..."),o("Downloading matterbridge plugins config...",5),window.location.href="./api/download-pluginconfig"):J==="download-mjstorage"?(a("Matterbridge","Downloading matter storage..."),o("Downloading matter storage...",5),window.location.href="./api/download-mjstorage"):J==="download-backup"?(a("Matterbridge","Downloading backup..."),o("Downloading backup...",10),window.location.href="./api/download-backup"):J==="update"?I():J==="updatedev"?ee():J==="updatecheck"?xe():J==="shelly-sys-update"?we():J==="shelly-main-update"?U():J==="shelly-create-system-log"?w():J==="shelly-download-system-log"?k():J==="softreset"?T():J==="hardreset"?ie():J==="restart"?M():J==="shutdown"?g():J==="reboot"?c():J==="create-backup"?n({id:h.current,sender:"Header",method:"/api/create-backup",src:"Frontend",dst:"Matterbridge",params:{}}):J==="unregister"?n({id:h.current,sender:"Header",method:"/api/unregister",src:"Frontend",dst:"Matterbridge",params:{}}):J==="reset"?n({id:h.current,sender:"Header",method:"/api/reset",src:"Frontend",dst:"Matterbridge",params:{}}):J==="factoryreset"&&n({id:h.current,sender:"Header",method:"/api/factoryreset",src:"Frontend",dst:"Matterbridge",params:{}})},ce=J=>{l&&console.log("Header: handleMenuCloseCancel:",J),O(null)},me=J=>{V(J.currentTarget)},ne=()=>{V(null)},be=J=>{Y(J.currentTarget)},ae=()=>{Y(null)},ge=J=>{f(J.currentTarget)},K=()=>{f(null)},ue=J=>{D(J.currentTarget)},ve=()=>{D(null)},Qe=()=>{qn(),l&&console.log("Matterbridge logo clicked: debug is now",l)};return r.useEffect(()=>{const J=le=>{le.src==="Matterbridge"&&le.dst==="Frontend"&&(le.id===h.current&&le.method==="/api/settings"&&(l&&console.log("Header received settings:",le.response),L(le.response),S(le.response.matterbridgeInformation.restartRequired||le.response.matterbridgeInformation.fixedRestartRequired),b(le.response.matterbridgeInformation.fixedRestartRequired),H(le.response.matterbridgeInformation.updateRequired)),le.method==="refresh_required"&&le.params.changed==="settings"&&(l&&console.log(`Header received refresh_required: changed=${le.params.changed} and sending /api/settings request`),n({id:h.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),le.method==="restart_required"&&(l&&console.log(`Header received restart_required with fixed: ${le.params.fixed}`),S(!0),le.params.fixed===!0&&b(!0)),le.method==="restart_not_required"&&(l&&console.log("Header received restart_not_required"),S(!1)),le.method==="update_required"&&(l&&console.log("Header received update_required"),H(!0)),le.method==="update_required_dev"&&(l&&console.log("Header received update_required_dev"),$(!0)),le.id===Se.ShellySysUpdate&&(l&&console.log("Header received WS_ID_SHELLY_SYS_UPDATE:"),L(Fe=>({...Fe,matterbridgeInformation:{...Fe.matterbridgeInformation,shellySysUpdate:le.params.available}}))),le.id===Se.ShellyMainUpdate&&(l&&console.log("Header received WS_ID_SHELLY_MAIN_UPDATE:"),L(Fe=>({...Fe,matterbridgeInformation:{...Fe.matterbridgeInformation,shellyMainUpdate:le.params.available}}))))};return x(J),l&&console.log(`Header added WebSocket listener id ${h.current}`),()=>{v(J),l&&console.log("Header removed WebSocket listener")}},[x,v,n,o]),r.useEffect(()=>{i&&(l&&console.log("Header sending /api/settings requests"),n({id:h.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}))},[i,n]),l&&console.log("Header rendering..."),!i||!u?null:e.jsxs("div",{className:"header",children:[e.jsxs("div",{className:"sub-header",children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"30px"},onClick:Qe}),e.jsx("h2",{style:{fontSize:"22px",color:"var(--main-icon-color)",margin:"0px"},children:"Matterbridge"}),e.jsxs("nav",{children:[e.jsx(st,{to:"/",className:"nav-link",children:"Home"}),e.jsx(st,{to:"/devices",className:"nav-link",children:"Devices"}),e.jsx(st,{to:"/log",className:"nav-link",children:"Logs"}),e.jsx(st,{to:"/settings",className:"nav-link",children:"Settings"})]})]}),e.jsxs("div",{className:"sub-header",children:[!u.matterbridgeInformation.readOnly&&F&&e.jsx(R,{title:"New Matterbridge version available, click to install",children:e.jsxs("span",{className:"status-warning",onClick:I,children:["Update to v.",u.matterbridgeInformation.matterbridgeLatestVersion]})}),!u.matterbridgeInformation.readOnly&&j&&e.jsx(R,{title:"New Matterbridge dev version available, click to install",children:e.jsxs("span",{className:"status-warning",onClick:ee,children:["Update to new dev v.",u.matterbridgeInformation.matterbridgeDevVersion.split("-dev-")[0]]})}),!u.matterbridgeInformation.readOnly&&e.jsx(R,{title:"Matterbridge version, click to see the changelog",children:e.jsxs("span",{className:"status-information",onClick:C,children:["v.",u.matterbridgeInformation.matterbridgeVersion]})}),u.matterbridgeInformation.shellyBoard&&e.jsx("img",{src:"Shelly.svg",alt:"Shelly Icon",style:{height:"30px",padding:"0px",margin:"0px",marginRight:"30px"}}),u.matterbridgeInformation.shellyBoard&&u.matterbridgeInformation.xxxmatterbridgeVersion&&e.jsx(R,{title:"Matterbridge version",children:e.jsxs("span",{style:{fontSize:"12px",color:"var(--main-icon-color)"},onClick:C,children:["v.",u.matterbridgeInformation.matterbridgeVersion]})}),u.matterbridgeInformation.bridgeMode!==""&&u.matterbridgeInformation.readOnly===!1?e.jsx(R,{title:"Bridge mode",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:u.matterbridgeInformation.bridgeMode})}):null,u.matterbridgeInformation.restartMode!==""&&u.matterbridgeInformation.readOnly===!1?e.jsx(R,{title:"Restart mode",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:u.matterbridgeInformation.restartMode})}):null,u.matterbridgeInformation.profile&&u.matterbridgeInformation.profile!==""&&u.matterbridgeInformation.readOnly===!1?e.jsx(R,{title:"Current profile",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:u.matterbridgeInformation.profile})}):null]}),e.jsxs("div",{className:"sub-header",style:{gap:"5px"},children:[u.matterbridgeInformation.readOnly===!1?e.jsx(R,{title:"Matterbridge discord group",children:e.jsx("img",{src:"discord.svg",alt:"Discord Logo",style:{cursor:"pointer",height:"25px"},onClick:m})}):null,u.matterbridgeInformation.readOnly===!1?e.jsx(R,{title:"Give a star to Matterbridge",children:e.jsx(z,{style:{color:"#FFD700",margin:"0",padding:"0"},onClick:_,children:e.jsx(Cr,{})})}):null,u.matterbridgeInformation.readOnly===!1?e.jsx(R,{title:"Sponsor Matterbridge",children:e.jsx(z,{style:{color:"#b6409c",margin:"0",padding:"0"},onClick:X,children:e.jsx(Yt,{})})}):null,e.jsx(R,{title:"Matterbridge help",children:e.jsx(z,{style:{color:"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:he,children:e.jsx(Sr,{})})}),e.jsx(R,{title:"Matterbridge changelog",children:e.jsx(z,{style:{color:"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:C,children:e.jsx(Xt,{})})}),u.matterbridgeInformation&&!u.matterbridgeInformation.readOnly&&e.jsx(R,{title:"Update matterbridge to latest version",children:e.jsx(z,{style:{color:F?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:I,children:e.jsx(Ve,{})})}),u.matterbridgeInformation&&u.matterbridgeInformation.shellyBoard&&u.matterbridgeInformation.shellySysUpdate&&e.jsx(R,{title:"Shelly system update",children:e.jsx(z,{style:{color:"var(--primary-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:we,children:e.jsx(Ve,{})})}),u.matterbridgeInformation&&u.matterbridgeInformation.shellyBoard&&u.matterbridgeInformation.shellyMainUpdate&&e.jsx(R,{title:"Shelly software update",children:e.jsx(z,{style:{color:"var(--primary-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:U,children:e.jsx(Ve,{})})}),e.jsx(R,{title:"Restart matterbridge",children:e.jsx(z,{style:{color:s||W?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:M,children:e.jsx(vt,{})})}),u.matterbridgeInformation.restartMode===""?e.jsx(R,{title:"Shut down matterbridge",children:e.jsx(z,{style:{color:s||W?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:g,children:e.jsx(ze,{})})}):null,e.jsx(R,{title:"Download, backup and more",children:e.jsx(z,{onClick:se,children:e.jsx(wr,{style:{color:"var(--main-icon-color)"}})})}),e.jsxs(tt,{id:"command-menu",anchorEl:N,keepMounted:!0,open:!!N,onClose:()=>q(""),children:[u.matterbridgeInformation&&!u.matterbridgeInformation.readOnly&&e.jsxs(P,{onClick:()=>q("update"),children:[e.jsx(G,{children:e.jsx(Ve,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Install latest stable",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),u.matterbridgeInformation&&!u.matterbridgeInformation.readOnly&&e.jsxs(P,{onClick:()=>q("updatedev"),children:[e.jsx(G,{children:e.jsx(Ve,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Install latest dev",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),u.matterbridgeInformation&&!u.matterbridgeInformation.readOnly&&e.jsxs(P,{onClick:()=>q("updatecheck"),children:[e.jsx(G,{children:e.jsx(Ve,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Check for updates",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),u.matterbridgeInformation&&u.matterbridgeInformation.shellyBoard&&u.matterbridgeInformation.shellySysUpdate&&e.jsxs(P,{onClick:()=>q("shelly-sys-update"),children:[e.jsx(G,{children:e.jsx(Ve,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Shelly system update",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),u.matterbridgeInformation&&u.matterbridgeInformation.shellyBoard&&u.matterbridgeInformation.shellyMainUpdate&&e.jsxs(P,{onClick:()=>q("shelly-main-update"),children:[e.jsx(G,{children:e.jsx(Ve,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Shelly software update",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(P,{onClick:()=>q("restart"),children:[e.jsx(G,{children:e.jsx(vt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Restart",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),u.matterbridgeInformation.restartMode===""?e.jsxs(P,{onClick:()=>q("shutdown"),children:[e.jsx(G,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Shutdown",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}):null,u.matterbridgeInformation&&u.matterbridgeInformation.shellyBoard&&e.jsxs(P,{onClick:()=>{p("Reboot","Are you sure you want to reboot the Shelly board?","reboot",q,ce)},children:[e.jsx(G,{children:e.jsx(vt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Reboot...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsx(lt,{}),e.jsxs(P,{onClick:be,children:[e.jsx(G,{children:e.jsx(dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"View",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(tt,{id:"sub-menu-view",anchorEl:B,keepMounted:!0,open:!!B,onClose:ae,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(P,{onClick:()=>{q("view-mblog"),ae()},children:[e.jsx(G,{children:e.jsx(dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matterbridge log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(P,{onClick:()=>{q("view-mjlog"),ae()},children:[e.jsx(G,{children:e.jsx(dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matter log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),u.matterbridgeInformation&&u.matterbridgeInformation.shellyBoard&&e.jsxs(P,{onClick:()=>{q("view-shellylog"),ae()},children:[e.jsx(G,{children:e.jsx(dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(lt,{}),e.jsxs(P,{onClick:ge,children:[e.jsx(G,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Download",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(tt,{id:"sub-menu-download",anchorEl:d,keepMounted:!0,open:!!d,onClose:K,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(P,{onClick:()=>{q("download-mbstorage"),K()},children:[e.jsx(G,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matterbridge storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(P,{onClick:()=>{q("download-pluginstorage"),K()},children:[e.jsx(G,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matterbridge plugins storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(P,{onClick:()=>{q("download-pluginconfig"),K()},children:[e.jsx(G,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matterbridge plugins config",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(P,{onClick:()=>{q("download-mblog"),K()},children:[e.jsx(G,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matterbridge log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(P,{onClick:()=>{q("download-mjstorage"),K()},children:[e.jsx(G,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matter storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(P,{onClick:()=>{q("download-mjlog"),K()},children:[e.jsx(G,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matter log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),u.matterbridgeInformation&&u.matterbridgeInformation.shellyBoard&&e.jsxs(P,{onClick:()=>{q("shelly-create-system-log"),K()},children:[e.jsx(G,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Create Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),u.matterbridgeInformation&&u.matterbridgeInformation.shellyBoard&&e.jsxs(P,{onClick:()=>{q("shelly-download-system-log"),K()},children:[e.jsx(G,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Download Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(lt,{}),e.jsxs(P,{onClick:me,children:[e.jsx(G,{children:e.jsx(Dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(tt,{id:"sub-menu-backup",anchorEl:E,keepMounted:!0,open:!!E,onClose:ne,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(P,{onClick:()=>{q("create-backup"),ne()},children:[e.jsx(G,{children:e.jsx(Dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Create backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(P,{onClick:()=>{q("download-backup"),ne()},children:[e.jsx(G,{children:e.jsx(Dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Download backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(lt,{}),e.jsxs(P,{onClick:ue,children:[e.jsx(G,{children:e.jsx(Mr,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Reset",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(tt,{id:"sub-menu-reset",anchorEl:y,keepMounted:!0,open:!!y,onClose:ve,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(P,{onClick:()=>{ve(),p("Reset all devices and shutdown","Are you sure you want to unregister all devices? This will temporarily remove all devices from the controller and you may loose the controller configuration.","unregister",q,ce)},children:[e.jsx(G,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Reset all devices...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(P,{onClick:()=>{ve(),p("Reset commissioning and shutdown","Are you sure you want to reset the commissioning? You will have to manually remove Matterbridge from the controller.","reset",q,ce)},children:[e.jsx(G,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Reset commissioning...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),!u.matterbridgeInformation.readOnly&&e.jsxs(P,{onClick:()=>{ve(),p("Factory reset and shutdown","Are you sure you want to factory reset Matterbridge? You will have to manually remove Matterbridge from the controller.","factoryreset",q,ce)},children:[e.jsx(G,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Factory reset...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),u.matterbridgeInformation&&u.matterbridgeInformation.shellyBoard&&e.jsxs(P,{onClick:()=>{ve(),p("Network reset","Are you sure you want to factory reset the network parameters?","softreset",q,ce)},children:[e.jsx(G,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Reset network...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),u.matterbridgeInformation&&u.matterbridgeInformation.shellyBoard&&e.jsxs(P,{onClick:()=>{ve(),p("Factory reset","Are you sure you want to factory reset Matterbridge? You will have to manually remove Matterbridge from the controller.","hardreset",q,ce)},children:[e.jsx(G,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Factory reset...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]})]})]})]})}const Bo=()=>"ontouchstart"in window||typeof window.DocumentTouch<"u"&&document instanceof window.DocumentTouch?(l&&console.log("WebSocketLogs detectTouchscreen = true"),!0):(l&&console.log("WebSocketLogs detectTouchscreen = false"),!1);function Jo(){const{messages:o,autoScroll:p}=r.useContext(or),[i,n]=r.useState(!1),a=r.useRef(null),x=r.useMemo(()=>Bo(),[]),v=s=>n(!0),t=s=>n(!1);return r.useEffect(()=>{l&&console.log(`WebSocketLogs autoScroll: ${p} isHovering: ${i}`),p&&!i&&!x&&a.current?.scrollIntoView({behavior:"smooth"})},[o,i,p,x]),e.jsx("div",{style:{margin:"0px",padding:"0px"},children:e.jsxs("ul",{style:{margin:"0px",padding:"0px"},onMouseEnter:v,onMouseLeave:t,children:[o.map((s,S)=>e.jsx("li",{style:{wordWrap:"break-word",maxHeight:"200px",overflow:"hidden"},dangerouslySetInnerHTML:{__html:s}},S)),e.jsx("div",{ref:a})]})})}const nr=r.memo(Jo);function Je(){const{retry:o}=r.useContext(fe),p=()=>{window.location.reload()};return e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",fontSize:"20px",flexDirection:"column",color:"var(--main-text-color)",height:"100vh",backgroundColor:"var(--main-bg-color)"},children:e.jsx(Z,{sx:{display:"flex",alignItems:"center",flexDirection:"column"},children:o<100?e.jsxs(e.Fragment,{children:[e.jsx(kr,{style:{color:"var(--primary-color)"}}),e.jsxs("div",{style:{marginTop:"20px",color:"var(--primary-color)"},children:["Reconnecting to Matterbridge ","(attempt "+o+")","..."]})]}):e.jsxs("div",{style:{marginTop:"20px",color:"var(--primary-color)",textAlign:"center"},children:["Unable to connect to Matterbridge after multiple attempts.",e.jsx("br",{}),"Please check your network connection.",e.jsx("br",{}),e.jsx(oe,{variant:"contained",color:"primary",onClick:p,style:{marginTop:"20px"},children:"Refresh the Page"})]})})})}function Qo({value:o,maxChars:p}){let i=o;if(o.length>p&&p>3){const n=p-3,a=o.substring(0,Math.ceil(n/2)),x=o.substring(o.length-Math.floor(n/2),o.length);i=`${a} … ${x}`}return o!==i?e.jsx(R,{title:o,placement:"top",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[0,12]}}]}},children:e.jsx("span",{children:i})}):e.jsx("span",{children:i})}function Go({systemInfo:o,compact:p}){const[i,n]=r.useState(o),{sendMessage:a,addListener:x,removeListener:v}=r.useContext(fe);if(l&&console.log("SystemInfoTable:",i,"compact:",p),o&&p&&i.totalMemory&&i.freeMemory){const t=i.totalMemory,s=i.freeMemory;i.freeMemory=`${s} / ${t}`,i.totalMemory=""}if(o&&p&&i.heapTotal&&i.heapUsed){const t=i.heapTotal,s=i.heapUsed;i.heapUsed=`${s} / ${t}`,i.heapTotal=""}if(o&&p&&i.osRelease&&i.osType){const t=i.osType,s=i.osRelease;i.osType=`${t} (${s})`,i.osRelease=""}if(o&&p&&i.osArch&&i.osPlatform){const t=i.osPlatform,s=i.osArch;i.osPlatform=`${t} (${s})`,i.osArch=""}return r.useEffect(()=>{const t=s=>{s.src==="Matterbridge"&&s.dst==="Frontend"&&(s.method==="memory_update"&&s.params&&s.params.totalMemory&&s.params.freeMemory&&s.params.heapTotal&&s.params.heapUsed&&s.params.rss&&(l&&console.log("SystemInfoTable received memory_update",s),(i.totalMemory!==s.params?.totalMemory||i.freeMemory!==s.params?.freeMemory||i.heapTotal!==s.params?.heapTotal||i.heapUsed!==s.params?.heapUsed||i.rss!==s.params?.rss)&&n(S=>({...S,totalMemory:s.params?.totalMemory?s.params.totalMemory:"",freeMemory:s.params?.freeMemory?s.params.freeMemory:"",heapTotal:s.params?.heapTotal?s.params.heapTotal:"",heapUsed:s.params?.heapUsed?s.params.heapUsed:"",rss:s.params?.rss?s.params.rss:""}))),s.method==="cpu_update"&&s.params&&s.params.cpuUsage&&(l&&console.log("SystemInfoTable received cpu_update",s),i.cpuUsage!==(s.params?.cpuUsage?s.params.cpuUsage.toFixed(2)+" %":"")&&n(S=>({...S,cpuUsage:s.params?.cpuUsage?s.params.cpuUsage.toFixed(2)+" %":""}))),s.method==="uptime_update"&&s.params&&s.params.systemUptime&&s.params.processUptime&&(l&&console.log("SystemInfoTable received uptime_update",s),(i.systemUptime!==s.params?.systemUptime||i.processUptime!==s.params?.processUptime)&&n(S=>({...S,systemUptime:s.params?.systemUptime?s.params.systemUptime:"",processUptime:s.params?.processUptime?s.params.processUptime:""}))))};return l&&console.log("SystemInfoTable useEffect WebSocketMessage mounting"),x(t),l&&console.log("SystemInfoTable useEffect WebSocketMessage mounted"),()=>{l&&console.log("SystemInfoTable useEffect WebSocketMessage unmounting"),v(t),l&&console.log("SystemInfoTable useEffect WebSocketMessage unmounted")}},[x,i.cpuUsage,i.freeMemory,i.heapTotal,i.heapUsed,i.processUptime,i.rss,i.systemUptime,i.totalMemory,v,a]),i?(l&&console.log("SystemInfoTable rendering..."),e.jsxs("div",{className:"MbfWindowDiv",style:{minWidth:"302px",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"System Information"})}),e.jsx("div",{className:"MbfWindowDivTable",children:e.jsx("table",{style:{border:"none",borderCollapse:"collapse"},children:e.jsx("tbody",{style:{border:"none",borderCollapse:"collapse"},children:Object.entries(i).filter(([t,s])=>s!==void 0&&s!=="").map(([t,s],S)=>e.jsxs("tr",{className:S%2===0?"table-content-even":"table-content-odd",style:{border:"none",borderCollapse:"collapse"},children:[e.jsx("td",{style:{border:"none",borderCollapse:"collapse"},children:t}),e.jsx("td",{style:{border:"none",borderCollapse:"collapse"},children:e.jsx(Qo,{value:typeof s!="string"?s.toString():s,maxChars:25})})]},t))})})})]})):null}const Ko=r.memo(Go),Yo=!0,qt={margin:"0px",padding:"0px",color:"var(--div-text-color)",transition:"color 0.2s ease","& svg":{display:"block"},"& svg path":{fill:"var(--div-text-color)",transition:"fill 0.2s ease"},"&:hover":{color:"var(--primary-color)"},"&:hover svg path":{fill:"var(--primary-color)"},"&:focus-visible":{outline:"2px solid var(--primary-color)",outlineOffset:"2px"}},Xo=o=>{if(!o)return"";const p=o.toString().replace(/[^0-9]/g,"");if(p.length<5)return p;const i=p.slice(0,4),n=p.slice(4,7),a=p.slice(7,11);return[i,n,a].filter(Boolean).join("-")};function Zo({id:o}){const{online:p,sendMessage:i,addListener:n,removeListener:a,getUniqueId:x}=r.useContext(fe),[v,t]=r.useState(null),[s,S]=r.useState(null),W=r.useRef(null),b=r.useRef(x());r.useEffect(()=>{console.log(`QRDiv received storeId update "${o}"`),o&&(console.log(`QRDiv sending data request for storeId "${o}"`),t(o),i({id:b.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:o,server:!0}}))},[o]),r.useEffect(()=>{const L=h=>{h.src==="Matterbridge"&&h.dst==="Frontend"&&_o(h)&&h.id===Se.RefreshRequired&&h.params.changed==="matter"&&h.params.matter&&(console.log(`QRDiv received refresh_required: changed=${h.params.changed} for storeId "${h.params.matter.id}":`,h.params.matter),v===h.params.matter.id&&(console.log(`QRDiv received refresh_required/matter: setting matter data for storeId "${h.params.matter.id}":`,h.params.matter),W.current&&clearTimeout(W.current),h.params.matter.advertising&&h.params.matter.advertiseTime&&h.params.matter.advertiseTime+9e5<=Date.now()&&(h.params.matter.advertising=!1),S(h.params.matter),h.params.matter.advertising&&(console.log(`QRDiv setting matter advertise timeout for storeId "${h.params.matter.id}":`,h.params.matter.advertiseTime+9e5-Date.now()),W.current=setTimeout(()=>{W.current&&clearTimeout(W.current),console.log(`QRDiv clearing advertising state for storeId "${h.params.matter.id}" after 15 minutes`),S(N=>({...N,advertising:!1}))},h.params.matter.advertiseTime+9e5-Date.now()))))};return n(L),console.log("QRDiv webSocket effect mounted"),()=>{a(L),W.current&&clearTimeout(W.current),console.log("QRDiv webSocket effect unmounted")}},[v]);const F=()=>{console.log(`QRDiv sent matter startCommission for node "${s?.id}"`),s&&i({id:b.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:s.id,startCommission:!0}})},H=()=>{console.log(`QRDiv sent matter stopCommission for node "${s?.id}"`),s&&i({id:b.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:s.id,stopCommission:!0}})},j=()=>{console.log(`QRDiv sent matter advertise for node "${s?.id}"`),s&&i({id:b.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:s.id,advertise:!0}})},$=L=>{console.log(`QRDiv sent matter removeFabric for node "${s?.id}" and fabricIndex ${L}`),s&&i({id:b.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:s.id,removeFabric:L}})},u=async()=>{if(!s||!s.manualPairingCode)return;const L=s.manualPairingCode.toString();try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(L);else{const h=document.createElement("textarea");h.value=L,h.style.position="fixed",h.style.opacity="0",document.body.appendChild(h),h.focus(),h.select(),document.execCommand("copy"),document.body.removeChild(h)}Yo&&console.log("Manual pairing code copied to clipboard")}catch(h){console.error("Failed to copy manual pairing code",h)}};return!s||!p?(console.log("QRDiv rendering undefined state"),null):s.advertising&&s.qrPairingCode&&s.manualPairingCode?(console.log("QRDiv rendering advertising state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"QR pairing code"}),e.jsxs("div",{className:"MbfWindowHeaderFooterIcons",children:[e.jsx(z,{"aria-label":"send advertising",size:"small",onClick:j,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(R,{title:"Send again the mDNS advertisement",arrow:!0,children:e.jsx(te,{path:_t,size:"22px"})})}),e.jsx(z,{"aria-label":"stop pairing",size:"small",onClick:H,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(R,{title:"Turn off pairing",arrow:!0,children:e.jsx(te,{path:po,size:"22px"})})})]})]}),e.jsx("p",{className:"MbfWindowHeaderText",style:{overflow:"hidden",maxWidth:"280px",textOverflow:"ellipsis",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:v}),e.jsx(co,{value:s.qrPairingCode,size:256,level:"M",fgColor:"var(--div-text-color)",bgColor:"var(--div-bg-color)",style:{margin:"20px"}}),e.jsxs("div",{className:"MbfWindowFooter",style:{justifyContent:"space-between"},children:[e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Manual pairing code: ",Xo(s.manualPairingCode)]}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(R,{title:"Copy manual pairing code",arrow:!0,children:e.jsx(z,{"aria-label":"copy manual pairing code",size:"small",onClick:u,sx:qt,children:e.jsx(te,{path:uo,size:.85})})})})]})]})):s.commissioned&&s.fabricInformations&&s.sessionInformations?(console.log("QRDiv rendering commissioned state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px",overflow:"hidden"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Paired fabrics"}),e.jsxs("div",{className:"MbfWindowHeaderFooterIcons",children:[e.jsx(z,{"aria-label":"send advertising",size:"small",onClick:j,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(R,{title:"Send again the mDNS advertisement",arrow:!0,children:e.jsx(te,{path:_t,size:"22px"})})}),e.jsx(z,{"aria-label":"start pairing",size:"small",onClick:F,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(R,{title:"Turn on pairing",arrow:!0,children:e.jsx(te,{path:At,size:"22px"})})})]})]}),e.jsxs("div",{className:"MbfWindowBodyColumn",style:{paddingTop:"0px"},children:[e.jsx("p",{className:"MbfWindowHeaderText thin-scroll",style:{overflowX:"auto",maxWidth:"280px",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:v}),s.fabricInformations.map((L,h)=>e.jsxs("div",{style:{margin:"0px",padding:"10px",gap:"0px",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",textAlign:"left",fontSize:"14px"},children:[e.jsxs("div",{style:{marginLeft:"20px",marginBottom:"10px",display:"flex",flexDirection:"row",justifyContent:"space-between",gap:"20px",alignItems:"center"},children:[e.jsxs("p",{className:"status-blue",style:{margin:"0px",padding:"3px 10px",width:"200px",fontSize:"14px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},children:["Fabric: ",L.fabricIndex]}),e.jsx(R,{title:"Remove the fabric. You will need to remove it also from the controller.",arrow:!0,children:e.jsx(z,{"aria-label":"remove the fabric",size:"small",onClick:()=>$(L.fabricIndex),sx:{...qt,padding:"2px"},children:e.jsx(te,{path:mo,size:1})})})]}),e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Vendor: ",L.rootVendorId," ",L.rootVendorName]}),L.label!==""&&e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Label: ",L.label]}),e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Sessions: ",s.sessionInformations?s.sessionInformations.filter(N=>N.fabric.fabricIndex===L.fabricIndex&&N.isPeerActive===!0).length:"0"," ","subscriptions: ",s.sessionInformations?s.sessionInformations.filter(N=>N.fabric.fabricIndex===L.fabricIndex&&N.isPeerActive===!0&&N.numberOfActiveSubscriptions>0).length:"0"]})]},h))]}),e.jsx("div",{className:"MbfWindowFooter",children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Serial number: ",s.serialNumber]})})]})):!s.commissioned&&!s.advertising?(console.log("QRDiv rendering not commissioned and not advertising state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px"},children:[e.jsx("div",{className:"MbfWindowHeader",style:{height:"30px"},children:e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"QR pairing code"})}),e.jsx("p",{className:"MbfWindowHeaderText thin-scroll",style:{overflowX:"auto",maxWidth:"280px",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:v}),e.jsx(oe,{onClick:F,endIcon:e.jsx(te,{path:At,size:1}),style:{margin:"20px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:"Turn on pairing"}),e.jsx("div",{className:"MbfWindowFooter",children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Serial number: ",s.serialNumber]})})]})):(console.log("QRDiv rendering unknown state"),null)}const en=r.memo(Zo);function tn(){const{logMessage:o,sendMessage:p,getUniqueId:i}=r.useContext(fe),[n,a]=r.useState("matterbridge-"),[x,v]=r.useState(!1),[t,s]=r.useState(null),S=r.useRef(i()),W=N=>{N.preventDefault(),v(!0)},b=()=>{v(!1)},F=N=>{N.preventDefault(),v(!1);const O=N.dataTransfer.files[0];if(O){o("Plugins",`Installing package ${O.name}. Please wait...`);const E=new FormData;E.append("file",O),E.append("filename",O.name),fetch("./api/uploadpackage",{method:"POST",body:E}).then(V=>V.text()).then(V=>{o("Plugins",`Server response: ${V}`)}).catch(V=>{console.error("Error uploading plugin file:",V),o("Plugins",`Error installing package ${V}`)})}},H=N=>{const O=N.target.files&&N.target.files[0];if(O){o("Plugins",`Uploading package ${O.name}`);const E=new FormData;E.append("file",O),E.append("filename",O.name),fetch("./api/uploadpackage",{method:"POST",body:E}).then(V=>V.text()).then(V=>{o("Plugins",`Server response: ${V}`)}).catch(V=>{console.error("Error uploading plugin file:",V),o("Plugins",`Error uploading package ${V}`)})}},j=()=>{p({id:S.current,sender:"InstallPlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:n,restart:!1}})},$=()=>{document.getElementById("file-upload")?.click()},u=()=>{p({id:S.current,sender:"InstallPlugins",method:"/api/addplugin",src:"Frontend",dst:"Matterbridge",params:{pluginNameOrPath:n}})},L=N=>{s(N.currentTarget)},h=N=>{N!==""&&a(N),s(null)};return l&&console.log("AddRemovePlugins rendering..."),e.jsxs("div",{style:{display:"flex",flexDirection:"row",flex:"1 1 auto",alignItems:"center",justifyContent:"space-between",margin:"0px",padding:"10px",gap:"20px"},onDragOver:W,onDragLeave:b,onDrop:F,children:[e.jsx(pe,{value:n,onChange:N=>{a(N.target.value)},size:"small",id:"plugin-name",label:"Plugin name or plugin path",variant:"outlined",fullWidth:!0}),e.jsx(z,{onClick:L,children:e.jsx(Ir,{})}),e.jsxs(tt,{id:"simple-menu",anchorEl:t,keepMounted:!0,open:!!t,onClose:()=>h(""),children:[e.jsx(P,{onClick:()=>h("matterbridge-zigbee2mqtt"),children:"matterbridge-zigbee2mqtt"}),e.jsx(P,{onClick:()=>h("matterbridge-somfy-tahoma"),children:"matterbridge-somfy-tahoma"}),e.jsx(P,{onClick:()=>h("matterbridge-shelly"),children:"matterbridge-shelly"}),e.jsx(P,{onClick:()=>h("matterbridge-hass"),children:"matterbridge-hass"}),e.jsx(P,{onClick:()=>h("matterbridge-webhooks"),children:"matterbridge-webhooks"}),e.jsx(P,{onClick:()=>h("matterbridge-bthome"),children:"matterbridge-bthome"}),e.jsx(P,{onClick:()=>h("matterbridge-test"),children:"matterbridge-test"}),e.jsx(P,{onClick:()=>h("matterbridge-example-accessory-platform"),children:"matterbridge-example-accessory-platform"}),e.jsx(P,{onClick:()=>h("matterbridge-example-dynamic-platform"),children:"matterbridge-example-dynamic-platform"}),e.jsx(P,{onClick:()=>h("matterbridge-eve-door"),children:"matterbridge-eve-door"}),e.jsx(P,{onClick:()=>h("matterbridge-eve-motion"),children:"matterbridge-eve-motion"}),e.jsx(P,{onClick:()=>h("matterbridge-eve-energy"),children:"matterbridge-eve-energy"}),e.jsx(P,{onClick:()=>h("matterbridge-eve-weather"),children:"matterbridge-eve-weather"}),e.jsx(P,{onClick:()=>h("matterbridge-eve-room"),children:"matterbridge-eve-room"})]}),e.jsx(R,{title:"Install or update a plugin from npm",children:e.jsx(oe,{onClick:j,endIcon:e.jsx(He,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Install"})}),e.jsx(R,{title:"Upload and install a plugin from a tarball",children:e.jsx(oe,{onClick:$,endIcon:e.jsx(Dr,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Upload"})}),e.jsx(R,{title:"Add an installed plugin",children:e.jsx(oe,{onClick:u,endIcon:e.jsx(yt,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Add"})}),e.jsx("input",{id:"file-upload",type:"file",accept:".tgz",style:{display:"none"},onChange:H})]})}function Xe({status:o,enabledText:p="Enabled",disabledText:i=void 0,tooltipText:n=void 0,onClick:a}){if(o===void 0)return e.jsx("div",{style:{margin:"-2.5px"},children:e.jsx("div",{})});{const x=e.jsx("div",{className:o?"status-enabled":"status-disabled",style:{cursor:"default"},onClick:a,children:o?p:i??p});return n!==void 0?e.jsx(R,{title:n,children:x}):x}}const Ze={fontSize:"16px",fontWeight:"bold",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},et={fontSize:"12px",fontWeight:"normal",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},rn={fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)",backgroundColor:"var(--div-bg-color)"},on={fontSize:"16px",fontWeight:"bold",backgroundColor:"var(--div-bg-color)"},$e={padding:"0px",margin:"0px"},nn="5px 10px 5px 10px",ht={},je={},xt={},ft={};let bt=[],Bt=[];const an=({open:o,onClose:p,plugin:i})=>{const{sendMessage:n,addListener:a,removeListener:x,getUniqueId:v}=r.useContext(fe),t=r.useRef(v()),[s,S]=r.useState(i.configJson),[W,b]=r.useState(i.schemaJson),[F,H]=r.useState({"ui:submitButtonOptions":{submitText:"Confirm"},"ui:globalOptions":{orderable:!0}}),[j,$]=r.useState("");let u={};r.useEffect(()=>{const w=k=>{k.src==="Matterbridge"&&k.dst==="Frontend"&&(k.id===t.current&&k.method==="/api/select/devices"&&(k.response&&(bt=k.response),k.error&&console.error("ConfigPluginDialog received /api/select/devices error:",k.error)),k.id===t.current&&k.method==="/api/select/entities"&&(k.response&&(Bt=k.response),k.error&&console.error("ConfigPluginDialog received /api/select/entities error:",k.error)))};return a(w),s!==void 0&&W!==void 0&&(Object.keys(W.properties).forEach(k=>{Object.keys(W.properties[k]).forEach(M=>{M.startsWith("ui:")&&(F[k]={},F[k][M]=W.properties[k][M],delete W.properties[k][M])})}),H(F)),i.name!==void 0&&i.configJson!==void 0&&i.schemaJson!==void 0&&(S(i.configJson),b(i.schemaJson),n({id:t.current,sender:"ConfigPlugin",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:i.name}}),n({id:t.current,sender:"ConfigPlugin",method:"/api/select/entities",src:"Frontend",dst:"Matterbridge",params:{plugin:i.name}})),()=>{x(w)}},[a,s,i,x,W,n,F]);const L=({formData:w})=>{u=w},h=({formData:w})=>{S(w),i.configJson=w,i.restartRequired=!0,n({id:t.current,sender:"ConfigPlugin",method:"/api/savepluginconfig",src:"Frontend",dst:"Matterbridge",params:{pluginName:w.name,formData:w}}),p()};function N(w){const{id:k,label:M,onKeyChange:g,onDropPropertyClick:c,disabled:T,schema:ie,children:se,registry:q,readonly:ce,required:me}=w,{templates:ne}=q,{RemoveButton:be}=ne.ButtonTemplates;if(!(Vo in ie))return e.jsx(Z,{sx:{display:"flex",flexDirection:"column",flexGrow:1,padding:0,margin:0,border:"none"},children:se});const ge=({target:K})=>g(K&&K.value);return e.jsxs(Z,{sx:{display:"flex",flexDirection:"row",flexGrow:1,padding:0,margin:0,border:"none"},children:[e.jsx(pe,{id:`${k}-key`,name:`${k}-key`,required:me,disabled:T||ce,defaultValue:M,onBlur:ce?void 0:ge,type:"text",variant:"outlined",sx:{width:"250px",minWidth:"250px",maxWidth:"250px",marginRight:"20px"}}),e.jsx(Z,{sx:{flex:1},children:se}),e.jsx(be,{disabled:T||ce,onClick:c(M)})]})}function O(w){const{children:k,description:M,displayLabel:g,errors:c,help:T,hidden:ie,_id:se,_label:q,registry:ce,uiSchema:me}=w,ne=$o(me),be=Eo("WrapIfAdditionalTemplate",ce,ne);return ie?e.jsx("div",{style:{display:"none"},children:k}):e.jsx(Z,{sx:{display:"flex",flexDirection:"column",flexGrow:1,padding:0,margin:0,border:"none"},children:e.jsxs(be,{...w,children:[g===!0&&M,k,c,T]})})}function E(w){const{description:k}=w;return k?e.jsx(de,{sx:et,children:k}):null}function V(w){const{required:k,title:M}=w;return M?e.jsx(Z,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:e.jsxs(de,{sx:Ze,children:["Title ",M," ",k&&e.jsx("mark",{children:"***"})]})}):null}function B(w){const{help:k,_idSchema:M}=w;return k?e.jsx(Z,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:e.jsx(de,{sx:rn,children:k})}):null}function Y(w){const{errors:k}=w;return k?e.jsxs(Z,{sx:{padding:"10px",margin:"10px",border:"1px solid grey"},children:[e.jsx(de,{color:"error",sx:on,children:"Please fix the following errors:"}),e.jsx(nt,{children:k.map((M,g)=>e.jsxs(Nr,{children:[e.jsx(G,{children:e.jsx(Pr,{color:"error"})}),e.jsx(re,{primary:M.stack})]},g))})]}):null}function d(w){const{errors:k}=w;return k?e.jsx(Z,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:k.map((M,g)=>e.jsxs(de,{color:"error",variant:"body2",sx:{marginLeft:1},children:["This field ",M]},g))}):null}function f(w){const{id:k,name:M,_schema:g,_uiSchema:c,value:T,options:ie,label:se,type:q,placeholder:ce,required:me,disabled:ne,readonly:be,autofocus:ae,onChange:ge,onChangeOverride:K,onBlur:ue,onFocus:ve,_rawErrors:Qe,_hideError:J,_registry:le,_formContext:Fe}=w,Le=({target:{value:ye}})=>ge(ye===""?ie.emptyValue:ye),Re=({target:ye})=>ue(k,ye&&ye.value),Ue=({target:ye})=>ve(k,ye&&ye.value);return e.jsx(Z,{sx:{padding:"0px",margin:"0px"},children:e.jsx(pe,{id:k,name:k,label:ce&&ce!==""?se:void 0,variant:"outlined",placeholder:ce&&ce!==""?ce:se,required:me,disabled:ne||be,autoFocus:ae,value:T||T===0?T:"",type:q,autoComplete:q==="password"?"current-password":M,onChange:K||Le,onBlur:Re,onFocus:Ue,fullWidth:!0})})}function y(w){return console.log("ArrayFieldTitleTemplate:",w),null}function D(w){return console.log("ArrayFieldDescriptionTemplate:",w),null}function X(w){return console.log("ArrayFieldItemTemplate:",w),null}function he(w){const{canAdd:k,_className:M,_disabled:g,_formContext:c,_formData:T,_idSchema:ie,_items:se,onAddClick:q,_rawErrors:ce,_readonly:me,_registry:ne,_required:be,schema:ae,title:ge,_uiSchema:K}=w,[ue,ve]=r.useState(!1),[Qe,J]=r.useState(!1),[le,Fe]=r.useState(!1),[Le,Re]=r.useState(""),Ue=A=>{Re(A.target.value)},ye=()=>{ve(!ue)},Ge=()=>{J(!Qe)},Ke=()=>{Fe(!le)},wt=A=>{ve(!1),ae.selectFrom==="serial"?ae.items.default=A.serial:ae.selectFrom==="name"&&(ae.items.default=A.name),q()},Mt=A=>{J(!1),ae.selectEntityFrom==="name"?ae.items.default=A.name:ae.selectEntityFrom==="description"&&(ae.items.default=A.description),q()},kt=A=>{Fe(!1),ae.selectDeviceEntityFrom==="name"?ae.items.default=A.name:ae.selectDeviceEntityFrom==="description"&&(ae.items.default=A.description),q()};return e.jsxs(Z,{sx:{margin:"0px",padding:"5px 10px 5px 10px",border:"1px solid grey"},children:[ge&&e.jsxs(Z,{sx:{margin:"0px",padding:"0px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[ge&&e.jsx(de,{sx:Ze,children:ge}),k&&e.jsxs(Z,{sx:{margin:"0px",padding:"0px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[ae.selectFrom&&e.jsx(R,{title:"Add a device from the list",children:e.jsx(z,{onClick:ye,size:"small",color:"primary",sx:$e,children:e.jsx(ct,{})})}),ae.selectEntityFrom&&e.jsx(R,{title:"Add an entity from the list",children:e.jsx(z,{onClick:Ge,size:"small",color:"primary",sx:$e,children:e.jsx(ct,{})})}),ae.selectDeviceEntityFrom&&e.jsx(R,{title:"Add a device entity from the list",children:e.jsx(z,{onClick:Ke,size:"small",color:"primary",sx:$e,children:e.jsx(ct,{})})}),e.jsx(R,{title:"Add a new item",children:e.jsx(z,{onClick:q,size:"small",color:"primary",sx:$e,children:e.jsx(yt,{})})})]})]}),ae.description&&e.jsx(de,{sx:et,children:ae.description}),w.items.map(A=>e.jsxs(Z,{sx:{margin:"2px 0px",padding:"0px",display:"flex",alignItems:"center"},children:[e.jsx(Z,{sx:{flexGrow:1,marginRight:"10px"},children:A.children}),e.jsx(z,{disabled:!A.hasMoveUp,onClick:A.onReorderClick(A.index,A.index-1),size:"small",color:"primary",sx:$e,children:e.jsx(Rt,{})}),e.jsx(z,{disabled:!A.hasMoveDown,onClick:A.onReorderClick(A.index,A.index+1),size:"small",color:"primary",sx:$e,children:e.jsx(Lt,{})}),e.jsx(z,{onClick:A.onDropIndexClick(A.index),size:"small",color:"primary",sx:$e,children:e.jsx(Ct,{})})]},A.index)),e.jsxs(Ie,{open:ue,onClose:ye,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(De,{children:"Select a device"}),e.jsxs(Ne,{children:[e.jsxs(Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(de,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(pe,{fullWidth:!0,variant:"outlined",value:Le,onChange:Ue,placeholder:"Enter serial or name"})]}),e.jsx(nt,{dense:!0,children:bt.filter(A=>A.serial.toLowerCase().includes(Le.toLowerCase())||A.name.toLowerCase().includes(Le.toLowerCase())).map((A,Me)=>e.jsxs(pt,{onClick:()=>wt(A),sx:ht,children:[A.icon==="wifi"&&e.jsx(G,{children:e.jsx(it,{style:je})}),A.icon==="ble"&&e.jsx(G,{children:e.jsx(ut,{style:je})}),A.icon==="hub"&&e.jsx(G,{children:e.jsx(mt,{style:je})}),e.jsx(re,{primary:A.name,secondary:A.serial,primaryTypographyProps:{style:xt},secondaryTypographyProps:{style:ft}})]},Me))})]}),e.jsx(Pe,{children:e.jsx(oe,{onClick:ye,children:"Close"})})]}),e.jsxs(Ie,{open:Qe,onClose:Ge,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(De,{children:"Select an entity"}),e.jsxs(Ne,{children:[e.jsxs(Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(de,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(pe,{fullWidth:!0,variant:"outlined",value:Le,onChange:Ue,placeholder:"Enter name or description"})]}),e.jsx(nt,{dense:!0,children:Bt.filter(A=>A.name.toLowerCase().includes(Le.toLowerCase())||A.description.toLowerCase().includes(Le.toLowerCase())).map((A,Me)=>e.jsxs(pt,{onClick:()=>Mt(A),sx:ht,children:[A.icon==="wifi"&&e.jsx(G,{children:e.jsx(it,{style:je})}),A.icon==="ble"&&e.jsx(G,{children:e.jsx(ut,{style:je})}),A.icon==="hub"&&e.jsx(G,{children:e.jsx(mt,{style:je})}),A.icon==="component"&&e.jsx(G,{children:e.jsx(Ht,{style:je})}),A.icon==="matter"&&e.jsx(G,{children:e.jsx(Ot,{style:je})}),e.jsx(re,{primary:A.name,secondary:A.description,primaryTypographyProps:{style:xt},secondaryTypographyProps:{style:ft}})]},Me))})]}),e.jsx(Pe,{children:e.jsx(oe,{onClick:Ge,children:"Close"})})]}),e.jsxs(Ie,{open:le,onClose:Ke,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsxs(De,{children:["Select an entity for ",ge]}),e.jsx(Ne,{children:e.jsx(nt,{dense:!0,children:bt.filter(A=>A.serial===ge||A.name===ge).map(A=>A.entities?.map((Me,It)=>e.jsxs(pt,{onClick:()=>kt(Me),sx:ht,children:[Me.icon==="wifi"&&e.jsx(G,{children:e.jsx(it,{style:je})}),Me.icon==="ble"&&e.jsx(G,{children:e.jsx(ut,{style:je})}),Me.icon==="hub"&&e.jsx(G,{children:e.jsx(mt,{style:je})}),Me.icon==="component"&&e.jsx(G,{children:e.jsx(Ht,{style:je})}),Me.icon==="matter"&&e.jsx(G,{children:e.jsx(Ot,{style:je})}),e.jsx(re,{primary:Me.name,secondary:Me.description,primaryTypographyProps:{style:xt},secondaryTypographyProps:{style:ft}})]},It)))})}),e.jsx(Pe,{children:e.jsx(oe,{onClick:Ke,children:"Close"})})]})]})}function C(w){const{onAddClick:k,schema:M,properties:g,title:c,description:T}=w,[ie,se]=r.useState(!1),[q,ce]=r.useState(""),me=K=>{ce(K.target.value)},ne=()=>{se(!ie)},be=K=>{se(!1);let ue="";M.selectFrom==="serial"?ue=K.serial:M.selectFrom==="name"&&(ue=K.name),$(ue),k(M)()},ae=()=>{k(M)()},ge=!M.additionalProperties;return!ge&&j!==""&&g.forEach(K=>{if(K.name==="newKey"&&K.content.key==="newKey"&&K.content.props.name==="newKey"&&K.content.props.onKeyChange&&j!==""){const ue=j;$(""),K.content.props.onKeyChange(ue)}}),e.jsxs(Z,{sx:{margin:"0px",padding:ge?"10px":"5px 10px 0px 10px",border:ge?"none":"1px solid grey"},children:[M.title&&ge&&e.jsx(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px",marginBottom:"10px"},children:e.jsx(de,{sx:Ze,children:M.title})}),c&&!ge&&e.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px"},children:[e.jsx(de,{sx:Ze,children:c}),e.jsxs(Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px"},children:[M.selectFrom&&e.jsx(R,{title:"Add a device from the list",children:e.jsx(z,{onClick:ne,size:"small",color:"primary",sx:$e,children:e.jsx(ct,{})})}),e.jsx(R,{title:"Add a new item",children:e.jsx(z,{onClick:ae,size:"small",color:"primary",sx:$e,children:e.jsx(yt,{})})})]})]}),M.description&&e.jsx(Z,{sx:{padding:"0px",margin:"0px",marginBottom:"10px"},children:e.jsx(de,{sx:et,children:M.description})}),g.map(({content:K,name:ue,hidden:ve})=>!ve&&e.jsxs(Z,{sx:{margin:"0px",marginBottom:"10px",padding:["object","array","boolean"].includes(M.properties[ue].type)?"0px":nn,border:["object","array","boolean"].includes(M.properties[ue].type)?"none":"1px solid grey"},children:[!["object","array","boolean"].includes(M.properties[ue].type)&&e.jsx(de,{sx:Ze,children:ue}),e.jsx(Z,{sx:{flexGrow:1,padding:"0px",margin:"0px"},children:K})]},ue)),e.jsxs(Ie,{open:ie,onClose:ne,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(De,{children:"Select a device"}),e.jsxs(Ne,{children:[e.jsxs(Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(de,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(pe,{fullWidth:!0,variant:"outlined",value:q,onChange:me,placeholder:"Enter serial or name"})]}),e.jsx(nt,{dense:!0,children:bt.filter(K=>K.serial.toLowerCase().includes(q.toLowerCase())||K.name.toLowerCase().includes(q.toLowerCase())).map((K,ue)=>e.jsxs(pt,{onClick:()=>be(K),sx:ht,children:[K.icon==="wifi"&&e.jsx(G,{children:e.jsx(it,{style:je})}),K.icon==="ble"&&e.jsx(G,{children:e.jsx(ut,{style:je})}),K.icon==="hub"&&e.jsx(G,{children:e.jsx(mt,{style:je})}),e.jsx(re,{primary:K.name,secondary:K.serial,primaryTypographyProps:{style:xt},secondaryTypographyProps:{style:ft}})]},ue))})]}),e.jsx(Pe,{children:e.jsx(oe,{onClick:ne,children:"Close"})})]})]})}function m(w){const{uiSchema:k}=w,{submitText:M,norender:g}=Oo(k);return g?null:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",margin:"10px",padding:"0px",gap:"20px"},children:[e.jsx(oe,{type:"submit",variant:"contained",color:"primary",children:M}),e.jsx(oe,{variant:"contained",color:"primary",onClick:p,children:"Cancel"})]})}function _(w){const{className:k,disabled:M,onClick:g,registry:c,style:T,uiSchema:ie,...se}=w;return e.jsx(R,{title:"Remove the item",children:e.jsx(z,{disabled:M,size:"small",color:"primary",onClick:g,children:e.jsx(Ct,{})})})}function I(w){const{className:k,disabled:M,onClick:g,registry:c,uiSchema:T,...ie}=w;return e.jsx(R,{title:"Add an item",children:e.jsx(z,{size:"small",color:"primary",onClick:g,children:e.jsx(yt,{})})})}function ee(w){const{disabled:k,onClick:M,registry:g,style:c,uiSchema:T,...ie}=w;return e.jsx(R,{title:"Move up the item",children:e.jsx(z,{size:"small",color:"primary",onClick:M,children:e.jsx(Rt,{})})})}function xe(w){const{disabled:k,onClick:M,registry:g,style:c,uiSchema:T,...ie}=w;return e.jsx(R,{title:"Move down the item",children:e.jsx(z,{size:"small",color:"primary",onClick:M,children:e.jsx(Lt,{})})})}function we(w){const{id:k,name:M,value:g,schema:c,readonly:T,onChange:ie}=w,[se,q]=r.useState(void 0),ce=ne=>{q(ne&&ne!==""?ne:void 0)},me=()=>{n({id:t.current,sender:"ConfigPlugin",method:"/api/action",src:"Frontend",dst:"Matterbridge",params:{plugin:i.name,action:M,value:se,formData:u,id:k}}),c.buttonClose===!0?p():c.buttonSave===!0&&h({formData:s})};return c.buttonText&&c.description?e.jsxs(Z,{sx:{margin:"0px",padding:"10px",border:"1px solid grey",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(de,{sx:et,children:c.description}),e.jsx(oe,{variant:"contained",color:"primary",onClick:()=>me(),children:c.buttonText})]}):c.buttonField&&c.description?e.jsxs(Z,{sx:{margin:"0px",padding:"10px",gap:"20px",border:"1px solid grey",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(de,{sx:et,children:c.description}),e.jsx(pe,{id:M+"-input",name:M,label:c.textLabel,placeholder:c.textPlaceholder,onChange:ne=>ce(ne.target.value),sx:{width:"250px",minWidth:"250px",maxWidth:"250px"}}),e.jsx(oe,{id:M+"-button",variant:"contained",color:"primary",disabled:se===void 0,onClick:()=>me(),children:c.buttonField})]}):e.jsxs(Z,{sx:{margin:"0px",padding:"5px 10px",border:"1px solid grey"},children:[M&&e.jsxs(Z,{sx:{margin:"0px",padding:"0px",gap:"10px",display:"flex",justifyContent:"flex-start",alignItems:"center"},children:[e.jsx(de,{sx:Ze,children:M}),e.jsx(We,{checked:g,readOnly:T,onChange:()=>ie(!g),sx:{padding:"0px",margin:"0px"}})]}),c.description&&e.jsx(de,{sx:et,children:c.description})]})}function U({schema:w,id:k,name:M,options:g,label:c,hideLabel:T,required:ie,disabled:se,placeholder:q,readonly:ce,value:me,multiple:ne,autofocus:be,onChange:ae,onBlur:ge,onFocus:K,errorSchema:ue,rawErrors:ve=[],registry:Qe,uiSchema:J,hideError:le,formContext:Fe,...Le}){const{enumOptions:Re,enumDisabled:Ue,emptyValue:ye}=g;ne=typeof ne>"u"?!1:!!ne;const Ge=ne?[]:"",Ke=typeof me>"u"||ne&&me.length<1||!ne&&me===Ge,wt=({target:{value:Oe}})=>ae(Nt(Oe,Re,ye)),Mt=({target:Oe})=>ge(k,Nt(Oe&&Oe.value,Re,ye)),kt=({target:Oe})=>K(k,Nt(Oe&&Oe.value,Re,ye)),A=Ro(me,Re,ne),{InputLabelProps:Me,SelectProps:It,autocomplete:dr,...cr}=Le,pr=!ne&&w.default===void 0;return e.jsxs(pe,{id:k,name:k,value:!Ke&&typeof A<"u"?A:Ge,required:ie,disabled:se||ce,autoFocus:be,autoComplete:dr,placeholder:q,error:ve.length>0,onChange:wt,onBlur:Mt,onFocus:kt,...cr,select:!0,InputLabelProps:{...Me,shrink:!Ke},SelectProps:{...It,multiple:ne},"aria-describedby":Ho(k),children:[pr&&e.jsx(P,{value:"",children:q}),Array.isArray(Re)&&Re.map(({value:Oe,label:ur},Ft)=>{const mr=Array.isArray(Ue)&&Ue.indexOf(Oe)!==-1;return e.jsx(P,{value:String(Ft),disabled:mr,children:ur},Ft)})]})}return!o||!W||!s?null:e.jsxs(Ie,{open:o,onClose:p,maxWidth:"800px",children:[e.jsx(De,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h3",{children:"Matterbridge plugin configuration"})]})}),e.jsx(Ne,{style:{padding:"0px",margin:"0px",width:"800px",height:"600px",overflow:"auto"},children:e.jsx(Fo,{schema:W,formData:s,uiSchema:F,validator:Lo,templates:{FieldTemplate:O,BaseInputTemplate:f,TitleFieldTemplate:V,DescriptionFieldTemplate:E,FieldHelpTemplate:B,FieldErrorTemplate:d,ErrorListTemplate:Y,WrapIfAdditionalTemplate:N,ArrayFieldTitleTemplate:y,ArrayFieldDescriptionTemplate:D,ArrayFieldItemTemplate:X,ArrayFieldTemplate:he,ObjectFieldTemplate:C,ButtonTemplates:{SubmitButton:m,RemoveButton:_,AddButton:I,MoveUpButton:ee,MoveDownButton:xe}},widgets:{CheckboxWidget:we,SelectWidget:U},onChange:L,onSubmit:h})})]})};function sn({data:o,columns:p,columnVisibility:i}){const n=Ee.useMemo(()=>p.filter(S=>i[S.accessor]),[p,i]),{getTableProps:a,getTableBodyProps:x,headerGroups:v,rows:t,prepareRow:s}=Ae.useTable({columns:n,data:o},Ae.useSortBy);return e.jsxs("table",{...a(),style:{border:"none",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{border:"none",borderCollapse:"collapse"},children:v.map(S=>e.jsx("tr",{...S.getHeaderGroupProps(),style:{border:"none",borderCollapse:"collapse"},children:S.headers.map(W=>e.jsx("th",{...W.getHeaderProps(void 0),style:{border:"none",borderCollapse:"collapse",cursor:W.noSort?"default":"pointer"},children:W.render("Header")}))}))}),e.jsx("tbody",{...x(),style:{border:"none",borderCollapse:"collapse"},children:t.map((S,W)=>(s(S),e.jsx("tr",{className:W%2===0?"table-content-even":"table-content-odd",...S.getRowProps(),style:{border:"none",borderCollapse:"collapse"},children:S.cells.map(b=>e.jsx("td",{...b.getCellProps(),style:{border:"none",borderCollapse:"collapse"},children:b.render("Cell")}))},W)))})]})}function ln({_storeId:o,setStoreId:p}){const{online:i,sendMessage:n,addListener:a,removeListener:x,getUniqueId:v}=r.useContext(fe),{showConfirmCancelDialog:t}=r.useContext(ot),s=r.useRef(v()),[S,W]=r.useState(null),[b,F]=r.useState(null),[H,j]=r.useState([]),[$,u]=r.useState(!1),[L,h]=r.useState({name:!0,description:!0,version:!0,author:!0,type:!0,registeredDevices:!0,actions:!0,status:!0}),N=c=>{if(c===void 0||c.matter===void 0||!c.matter.fabricInformations&&!c.matter.qrPairingCode&&!c.matter.manualPairingCode)return"red";if(c.matter.commissioned===!1&&c.matter.qrPairingCode&&c.matter.manualPairingCode)return"var(--primary-color)";var T=0,ie=0;for(const se of c.matter.sessionInformations??[])se.fabric&&se.isPeerActive===!0&&T++,se.numberOfActiveSubscriptions>0&&(ie+=se.numberOfActiveSubscriptions);return c.matter.commissioned===!0&&c.matter.fabricInformations&&c.matter.sessionInformations&&(T===0||ie===0)?"var(--secondary-color)":"var(--div-text-color)"},O=[{Header:"Name",accessor:"name",Cell:({row:c})=>e.jsx(R,{title:"Open the plugin homepage",children:e.jsx("span",{style:{cursor:"pointer"},onClick:()=>m(c.original),children:c.original.name})})},{Header:"Description",accessor:"description",Cell:({row:c})=>e.jsx(R,{title:"Open the plugin homepage",children:e.jsx("span",{style:{cursor:"pointer"},onClick:()=>m(c.original),children:c.original.description})})},{Header:"Version",accessor:"version",Cell:({row:c})=>e.jsxs(e.Fragment,{children:[c.original.latestVersion!==void 0&&c.original.latestVersion!==c.original.version&&b&&!b.readOnly&&e.jsx(R,{title:"New plugin stable version available, click to install",children:e.jsxs("span",{className:"status-warning",style:{marginRight:"10px"},onClick:()=>y(c.original),children:["Update to v.",c.original.latestVersion]})}),c.original.version.includes("-dev-")&&c.original.devVersion!==void 0&&c.original.devVersion!==c.original.version&&b&&!b.readOnly&&e.jsx(R,{title:"New plugin dev version available, click to install",children:e.jsxs("span",{className:"status-warning",style:{marginRight:"10px"},onClick:()=>D(c.original),children:["Update to new dev v.",c.original.devVersion.split("-dev-")[0]]})}),e.jsx(R,{title:"Plugin version",children:c.original.version})]})},{Header:"Author",accessor:"author",Cell:({row:c})=>e.jsx(e.Fragment,{children:c.original.author?c.original.author.replace("https://github.com/",""):"Unknown"})},{Header:"Type",accessor:"type",Cell:({row:c})=>e.jsx(e.Fragment,{children:c.original.type?c.original.type.replace("Platform",""):"Unknown"})},{Header:"Devices",accessor:"registeredDevices"},{Header:"Actions",accessor:"actions",Cell:({row:c})=>e.jsxs("div",{style:{margin:"0px",padding:"0px",gap:"4px",display:"flex",flexDirection:"row"},children:[b&&b.bridgeMode==="childbridge"&&!c.original.error&&c.original.enabled&&e.jsx(R,{title:"Shows the QRCode or the fabrics",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(z,{style:{margin:"0",padding:"0",width:"19px",height:"19px",color:N(c.original)},onClick:()=>p(c.original?.matter?.id),size:"small",children:e.jsx(Zt,{})})}),b&&b.bridgeMode==="childbridge"&&!c.original.error&&c.original.enabled&&e.jsx(R,{title:"Restart the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(z,{style:{margin:"0",padding:"0",width:"19px",height:"19px"},onClick:()=>he(c.original),size:"small",children:e.jsx(vt,{})})}),e.jsx(R,{title:"Plugin config",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(z,{disabled:c.original.restartRequired===!0,style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>k(c.original),size:"small",children:e.jsx(Be,{})})}),b&&!b.readOnly&&e.jsx(R,{title:"Remove the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(z,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>{Y("Remove plugin","Are you sure? This will remove also all the devices and configuration in the controller.","remove",c.original)},size:"small",children:e.jsx(Ct,{})})}),c.original.enabled?e.jsx(R,{title:"Disable the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(z,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>{Y("Disable plugin","Are you sure? This will remove also all the devices and configuration in the controller.","disable",c.original)},size:"small",children:e.jsx(Tr,{})})}):e.jsx(e.Fragment,{}),c.original.enabled?e.jsx(e.Fragment,{}):e.jsx(R,{title:"Enable the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(z,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>C(c.original),size:"small",children:e.jsx(Wr,{})})}),e.jsx(R,{title:"Open the plugin help",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(z,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>I(c.original),size:"small",children:e.jsx(Fr,{})})}),e.jsx(R,{title:"Open the plugin version history",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(z,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>ee(c.original),size:"small",children:e.jsx(Lr,{})})}),b&&!b.readOnly&&e.jsx(R,{title:"Sponsor the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(z,{style:{margin:"0",padding:"0",width:"19px",height:"19px",color:"#b6409c"},onClick:()=>_(c.original),size:"small",children:e.jsx(Yt,{})})})]})},{Header:"Status",accessor:"status",Cell:({row:c})=>e.jsx("div",{style:{display:"flex",flexDirection:"row",flex:"1 1 auto",gap:"5px"},children:c.original.error?e.jsx(e.Fragment,{children:e.jsx(Xe,{status:!1,enabledText:"Error",disabledText:"Error",tooltipText:"The plugin is in error state. Check the log!"})}):e.jsx(e.Fragment,{children:c.original.enabled===!1?e.jsx(e.Fragment,{children:e.jsx(Xe,{status:c.original.enabled,enabledText:"Enabled",disabledText:"Disabled",tooltipText:"Whether the plugin is enable or disabled"})}):e.jsx(e.Fragment,{children:c.original.loaded&&c.original.started&&c.original.configured?e.jsx(e.Fragment,{children:e.jsx(Xe,{status:c.original.loaded,enabledText:"Running",tooltipText:"Whether the plugin is running"})}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{status:c.original.loaded,enabledText:"Loaded",tooltipText:"Whether the plugin has been loaded"}),e.jsx(Xe,{status:c.original.started,enabledText:"Started",tooltipText:"Whether the plugin started"}),e.jsx(Xe,{status:c.original.configured,enabledText:"Configured",tooltipText:"Whether the plugin has been configured"})]})})})})}];r.useEffect(()=>{const c=T=>{T.src==="Matterbridge"&&T.dst==="Frontend"&&(T.method==="refresh_required"&&T.params.changed==="plugins"&&(l&&console.log(`HomePlugins received refresh_required: changed=${T.params.changed} and sending /api/plugins request`),n({id:s.current,sender:"HomePlugins",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})),T.method==="refresh_required"&&T.params.changed==="settings"&&(l&&console.log(`HomePlugins received refresh_required: changed=${T.params.changed} and sending /api/settings request`),n({id:s.current,sender:"HomePlugins",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),T.id===s.current&&T.method==="/api/settings"&&(l&&console.log(`HomePlugins (id: ${T.id}) received settings:`,T.response),W(T.response.systemInformation),F(T.response.matterbridgeInformation)),T.id===s.current&&T.method==="/api/plugins"&&(l&&console.log(`HomePlugins (id: ${T.id}) received ${T.response.length} plugins:`,T.response),j(T.response)))};return a(c),l&&console.log("HomePlugins added WebSocket listener id:",s.current),()=>{x(c),l&&console.log("HomePlugins removed WebSocket listener")}},[a,x,n]),r.useEffect(()=>{i&&(l&&console.log("HomePlugins sending api requests"),n({id:s.current,sender:"HomePlugins",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),n({id:s.current,sender:"HomePlugins",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[i,n]),r.useEffect(()=>{const c=localStorage.getItem("homePluginsColumnVisibility");c&&h(JSON.parse(c))},[]);const E=()=>{u(!$)},V=c=>{h(T=>{const ie={...T,[c]:!T[c]};return localStorage.setItem("homePluginsColumnVisibility",JSON.stringify(ie)),ie})},B=r.useRef(null),Y=(c,T,ie,se)=>{l&&console.log(`handleActionWithConfirmCancel ${ie} ${se.name}`),B.current=se,t(c,T,ie,d,f)},d=c=>{l&&console.log(`handleConfirm action confirmed ${c} ${B.current.name}`),c==="remove"&&B.current?X(B.current):c==="disable"&&B.current&&C(B.current),B.current=null},f=c=>{l&&console.log(`handleCancel action canceled ${c} ${B.current.name}`),B.current=null},y=c=>{l&&console.log("handleUpdatePlugin plugin:",c.name),n({id:s.current,sender:"HomePlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:c.name,restart:!1}})},D=c=>{l&&console.log("handleUpdateDevPlugin plugin:",c.name),n({id:s.current,sender:"HomePlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:c.name+"@dev",restart:!1}})},X=c=>{l&&console.log("handleRemovePlugin plugin:",c.name),n({id:s.current,sender:"HomePlugins",method:"/api/removeplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:c.name}})},he=c=>{l&&console.log("handleRestartPlugin plugin:",c.name),n({id:s.current,sender:"HomePlugins",method:"/api/restartplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:c.name}})},C=c=>{l&&console.log("handleEnableDisablePlugin plugin:",c.name,"enabled:",c.enabled),c.enabled===!0?(c.enabled=!1,n({id:s.current,sender:"HomePlugins",method:"/api/disableplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:c.name}})):(c.enabled=!0,n({id:s.current,sender:"HomePlugins",method:"/api/enableplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:c.name}}))},m=c=>{l&&console.log(`handleHomepagePlugin plugin: ${c.name} homepage: ${c.homepage}`),c.homepage&&window.open(c.homepage,"_blank")},_=c=>{l&&console.log("handleSponsorPlugin plugin:",c.name,"funding:",c.funding),c.funding&&window.open(c.funding,"_blank")},I=c=>{l&&console.log("handleHelpPlugin plugin:",c.name,"help:",c.help),c.help&&window.open(c.help,"_blank")},ee=c=>{l&&console.log("handleChangelogPlugin plugin:",c.name,"changelog:",c.changelog),c.changelog&&window.open(c.changelog,"_blank")},[xe,we]=r.useState({}),[U,w]=r.useState(!1),k=c=>{l&&console.log("handleConfigPlugin plugin:",c.name),n({id:s.current,sender:"HomePlugins",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:c.name}}),n({id:s.current,sender:"HomePlugins",method:"/api/select/entities",src:"Frontend",dst:"Matterbridge",params:{plugin:c.name}}),we(c),M()},M=()=>{w(!0)},g=()=>{w(!1)};return l&&console.log("HomePlugins rendering..."),i?e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",width:"100%",flex:"0 0 auto",overflow:"hidden"},children:[e.jsx(an,{open:U,onClose:g,plugin:xe}),e.jsxs(Ie,{open:$,onClose:E,children:[e.jsx(De,{children:"Configure Plugins Columns"}),e.jsx(Ne,{children:e.jsx(at,{children:O.map(c=>e.jsx(Te,{control:e.jsx(We,{disabled:["description","actions","status"].includes(c.accessor),checked:L[c.accessor],onChange:()=>V(c.accessor)}),label:c.Header},c.accessor))})}),e.jsx(Pe,{children:e.jsx(oe,{onClick:E,children:"Close"})})]}),e.jsxs("div",{className:"MbfWindowHeader",style:{justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Plugins"}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(z,{onClick:E,"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(R,{title:"Configure columns",children:e.jsx(Be,{style:{color:"var(--header-text-color)",fontSize:"19px"}})})})})]}),e.jsx("div",{className:"MbfWindowBodyColumn",style:{margin:"0px",padding:"0px",gap:"0",overflow:"auto"},children:e.jsx(sn,{data:H,columns:O,columnVisibility:L})})]}):e.jsx(Je,{})}const dn=o=>{if(o===void 0||!o.qrPairingCode&&!o.manualPairingCode&&!o.fabricInformations&&!o.sessionInformations)return"red";if(o.commissioned===!1&&o.qrPairingCode&&o.manualPairingCode)return"var(--primary-color)";var p=0,i=0;for(const n of o.sessionInformations??[])n.fabric&&n.isPeerActive===!0&&p++,n.numberOfActiveSubscriptions>0&&(i+=n.numberOfActiveSubscriptions);return o.commissioned===!0&&o.fabricInformations&&o.sessionInformations&&(p===0||i===0)?"var(--secondary-color)":"var(--div-text-color)"},cn=o=>`${o.pluginName}::${o.serial}`;function pn({data:o,columns:p,columnVisibility:i}){const n=Ee.useMemo(()=>{const b=localStorage.getItem("homeDevicesColumnsSortBy");return b?JSON.parse(b):[{id:"name",desc:!1}]},[p]),a=Ee.useMemo(()=>p.filter(b=>i[b.accessor]),[i,p]),{getTableProps:x,getTableBodyProps:v,headerGroups:t,rows:s,prepareRow:S,state:{sortBy:W}}=Ae.useTable({columns:a,data:o,getRowId:cn,initialState:{sortBy:n}},Ae.useSortBy);return Ee.useEffect(()=>{localStorage.setItem("homeDevicesColumnsSortBy",JSON.stringify(W))},[W]),e.jsxs("table",{...x(),style:{border:"none",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{border:"none",borderCollapse:"collapse"},children:t.map(b=>e.jsx("tr",{...b.getHeaderGroupProps(),style:{border:"none",borderCollapse:"collapse"},children:b.headers.map(F=>e.jsxs("th",{...F.getHeaderProps(F.noSort?void 0:F.getSortByToggleProps()),style:{border:"none",borderCollapse:"collapse",cursor:F.noSort?"default":"pointer"},children:[F.render("Header"),!F.noSort&&e.jsx("span",{style:{margin:"0px",marginLeft:"5px",padding:"0px"},children:F.isSorted?F.isSortedDesc?e.jsx(te,{path:Tt,size:"15px"}):e.jsx(te,{path:Wt,size:"15px"}):null})]}))}))}),e.jsx("tbody",{...v(),style:{border:"none",borderCollapse:"collapse"},children:s.map((b,F)=>(S(b),e.jsx("tr",{className:F%2===0?"table-content-even":"table-content-odd",...b.getRowProps(),style:{border:"none",borderCollapse:"collapse"},children:b.cells.map(H=>e.jsx("td",{...H.getCellProps(),style:{border:"none",borderCollapse:"collapse"},children:H.render("Cell")}))})))})]})}function un({storeId:o,setStoreId:p}){const{online:i,sendMessage:n,addListener:a,removeListener:x,getUniqueId:v}=r.useContext(fe),[t,s]=r.useState(!1),[S,W]=r.useState(!0),[b,F]=r.useState(null),[H,j]=r.useState([]),[$,u]=r.useState([]),[L,h]=r.useState([]),[N,O]=r.useState([]),[E,V]=r.useState(!1),[B,Y]=r.useState({pluginName:!0,name:!0,serial:!0,reachable:!0,powerSource:!0,configUrl:!1,actions:!0}),d=r.useRef(v()),f=[{Header:"Plugin",accessor:"pluginName"},{Header:"Name",accessor:"name"},{Header:"Serial",accessor:"serial"},{Header:"Availability",accessor:"reachable",Cell:({row:C})=>C.original.reachable===!0?"Online":C.original.reachable===!1?e.jsx("span",{style:{color:"red"},children:"Offline"}):"",sortType:(C,m)=>{const _=C.original.reachable===!0?1:C.original.reachable===!1?0:-1,I=m.original.reachable===!0?1:m.original.reachable===!1?0:-1;return _-I}},{Header:"Power",accessor:"powerSource",Cell:({row:C})=>C.original.powerSource==="ac"||C.original.powerSource==="dc"?e.jsx(er,{fontSize:"small",sx:{color:"var(--primary-color)"}}):C.original.powerSource==="ok"?e.jsx(jt,{fontSize:"small",sx:{color:"green"}}):C.original.powerSource==="warning"?e.jsx(jt,{fontSize:"small",sx:{color:"yellow"}}):C.original.powerSource==="critical"?e.jsx(jt,{fontSize:"small",sx:{color:"red"}}):e.jsx("span",{})},{Header:"Url",accessor:"configUrl"},{Header:"Actions",accessor:"actions",noSort:!0,Cell:({row:C})=>e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[C.original.matter!==void 0?e.jsx(R,{title:"Show the QRCode or the fabrics",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(z,{onClick:()=>p(o===C.original.matter.id?b.matterbridgeInformation.bridgeMode==="bridge"?"Matterbridge":null:C.original.matter.id),"aria-label":"Show the QRCode",sx:{margin:0,padding:0,color:dn(C.original.matter)},children:e.jsx(Zt,{fontSize:"small"})})}):e.jsx("div",{style:{width:"20px",height:"20px"}}),C.original.configUrl?e.jsx(R,{title:"Open the configuration page",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(z,{onClick:()=>window.open(C.original.configUrl,"_blank"),"aria-label":"Open config url",sx:{margin:0,padding:0},children:e.jsx(Be,{fontSize:"small"})})}):e.jsx("div",{style:{width:"20px",height:"20px"}}),C.original.selected!==void 0?e.jsx(R,{title:"Select/unselect the device",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(We,{checked:C.original.selected,onChange:m=>he(m,C.original),sx:{margin:"0",marginLeft:"8px",padding:"0"},size:"small"})}):e.jsx("div",{style:{width:"20px",height:"20px"}})]})}],y=Ee.useCallback(C=>{C.selected=void 0;const m=H.find(ee=>ee.name===C.pluginName);if(!m)return console.error(`HomeDevices isSelected: plugin ${C.pluginName} not found for device ${C.deviceName} `),C.selected;const _=m.schemaJson?.properties?.whiteList?.selectFrom;let I=m.configJson?.postfix;return I===""&&(I=void 0),m.hasWhiteList===!0&&m.hasBlackList===!0&&_&&(C.selected=!0,_==="serial"&&m.configJson.whiteList&&m.configJson.whiteList.length>0&&m.configJson.whiteList.includes(I?C.serial.replace("-"+I,""):C.serial)&&(C.selected=!0),_==="serial"&&m.configJson.whiteList&&m.configJson.whiteList.length>0&&!m.configJson.whiteList.includes(I?C.serial.replace("-"+I,""):C.serial)&&(C.selected=!1),_==="serial"&&m.configJson.blackList&&m.configJson.blackList.length>0&&m.configJson.blackList.includes(I?C.serial.replace("-"+I,""):C.serial)&&(C.selected=!1),_==="name"&&m.configJson.whiteList&&m.configJson.whiteList.length>0&&m.configJson.whiteList.includes(C.name)&&(C.selected=!0),_==="name"&&m.configJson.whiteList&&m.configJson.whiteList.length>0&&!m.configJson.whiteList.includes(C.name)&&(C.selected=!1),_==="name"&&m.configJson.blackList&&m.configJson.blackList.length>0&&m.configJson.blackList.includes(C.name)&&(C.selected=!1)),C.selected},[H]);r.useEffect(()=>{const C=m=>{if(m.src==="Matterbridge"&&m.dst==="Frontend"){if(m.method==="refresh_required"&&(console.log(`HomeDevices received refresh_required: changed=${m.params.changed} and sending /api/plugins request`),n({id:d.current,sender:"HomeDevices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})),m.method==="restart_required"&&(l&&console.log("HomeDevices received restart_required"),s(!0)),m.method==="restart_not_required"&&(l&&console.log("HomeDevices received restart_not_required"),s(!1)),m.method==="state_update"&&m.params.plugin&&m.params.serialNumber&&m.params.cluster.includes("BasicInformationServer")&&m.params.attribute==="reachable"&&(console.log(`HomeDevices updating device reachability for plugin ${m.params.plugin} serial ${m.params.serialNumber} value ${m.params.value}`),u(_=>_.map(I=>I.pluginName===m.params.plugin&&I.serial===m.params.serialNumber?{...I,reachable:m.params.value}:I))),m.id===d.current&&m.method==="/api/settings"&&(l&&console.log(`HomeDevices (id: ${m.id}) received settings:`,m.response),F(m.response),s(m.response.matterbridgeInformation.restartRequired||m.response.matterbridgeInformation.fixedRestartRequired)),m.id===d.current&&m.method==="/api/plugins"&&(l&&console.log(`HomeDevices (id: ${m.id}) received ${m.response?.length} plugins:`,m.response),m.response)){let _=!0;for(const I of m.response)I.enabled===!0&&(I.loaded!==!0||I.started!==!0||I.error===!0)&&(_=!1);if(!_)return;l&&console.log("HomeDevices reset plugins, devices and selectDevices"),W(!1),j(m.response),u([]),h([]),n({id:d.current,sender:"HomeDevices",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}}),l&&console.log("HomeDevices sent /api/devices");for(const I of m.response)I.enabled===!0&&I.loaded===!0&&I.started===!0&&I.error!==!0&&(n({id:d.current,sender:"HomeDevices",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:I.name}}),l&&console.log(`HomeDevices sent /api/select/devices for plugin: ${I.name}`))}if(m.id===d.current&&m.method==="/api/devices"&&(l&&console.log(`HomeDevices (id: ${m.id}) received ${m.response?.length} devices:`,m.response),m.response)){for(const _ of m.response)_.selected=y(_);u(m.response)}m.id===d.current&&m.method==="/api/select/devices"&&(l&&console.log(`HomeDevices (id: ${m.id}) received ${m.response?.length} selectDevices for plugin ${m.response&&m.response.length>0?m.response[0].pluginName:"no select devices"}:`,m.response),m.response&&m.response.length>0&&h(_=>{const I=_.filter(xe=>xe.pluginName!==m.response[0].pluginName),ee=m.response.map(xe=>({...xe,selected:y(xe)}));return[...I,...ee]}))}};return a(C),l&&console.log(`HomeDevices added WebSocket listener id ${d.current}`),()=>{x(C),l&&console.log("HomeDevices removed WebSocket listener")}},[H,a,x,n,y]),r.useEffect(()=>{if($.length===0&&L.length===0)return;console.log(`HomeDevices mixing devices (${$.length}) and selectDevices (${L.length})`);const C=[];for(const m of $)C.push(m);for(const m of L)$.find(_=>_.pluginName===m.pluginName&&_.serial.includes(m.serial))||C.push(m);C.length>0&&(O(C),console.log(`HomeDevices mixed ${C.length} devices and selectDevices`))},[H,$,L,O]),r.useEffect(()=>{i&&(l&&console.log("HomeDevices sending /api/settings and /api/plugins requests"),n({id:d.current,sender:"HomeDevices",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),n({id:d.current,sender:"HomeDevices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[i,n]),r.useEffect(()=>{const C=localStorage.getItem("homeDevicesColumnVisibility");if(C){const m=JSON.parse(C);m.powerSource===void 0&&(m.powerSource=!0),Y(m),l&&console.log("HomeDevices loaded column visibility from localStorage")}},[]);const D=C=>{Y(m=>{const _={...m,[C]:!m[C]};return localStorage.setItem("homeDevicesColumnVisibility",JSON.stringify(_)),l&&console.log("HomeDevices saved column visibility to localStorage",JSON.stringify(_),_),_})},X=()=>{V(!E)},he=(C,m)=>{console.log(`handleCheckboxChange: checkbox changed to ${C.target.checked} for device ${m.name} serial ${m.serial}`),O(_=>{const I=_.findIndex(xe=>xe.pluginName===m.pluginName&&xe.serial===m.serial);if(I<0)return console.error(`handleCheckboxChange: device not found ${m.name} serial ${m.serial} id ${m.id}`),_;const ee=[..._];return ee[I]={...ee[I],selected:C.target.checked},ee}),C.target.checked?n({id:d.current,sender:"HomeDevices",method:"/api/command",src:"Frontend",dst:"Matterbridge",params:{command:"selectdevice",plugin:m.pluginName,serial:m.serial,name:m.name}}):n({id:d.current,sender:"HomeDevices",method:"/api/command",src:"Frontend",dst:"Matterbridge",params:{command:"unselectdevice",plugin:m.pluginName,serial:m.serial,name:m.name}})};return l&&console.log("HomeDevices rendering..."),i?e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",width:"100%",flex:"1 1 auto",overflow:"hidden"},children:[e.jsxs(Ie,{open:E,onClose:X,children:[e.jsx(De,{children:"Configure Devices Columns"}),e.jsx(Ne,{children:e.jsx(at,{children:f.map(C=>e.jsx(Te,{control:e.jsx(We,{disabled:["name","actions"].includes(C.accessor),checked:B[C.accessor],onChange:()=>D(C.accessor)}),label:C.Header},C.accessor))})}),e.jsx(Pe,{children:e.jsx(oe,{onClick:X,children:"Close"})})]}),e.jsxs("div",{className:"MbfWindowHeader",style:{justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Devices"}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(z,{onClick:X,"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(R,{title:"Configure columns",children:e.jsx(Be,{style:{color:"var(--header-text-color)",fontSize:"19px"}})})})})]}),e.jsx("div",{className:"MbfWindowBodyColumn",style:{margin:"0px",padding:"0px",gap:"0",overflow:"auto"},children:e.jsx(pn,{data:N,columns:f,columnVisibility:B})}),e.jsxs("div",{className:"MbfWindowFooter",style:{borderTop:"1px solid var(--table-border-color)",justifyContent:"space-between"},children:[S&&e.jsx("p",{className:"MbfWindowFooterText",style:{fontWeight:"normal",fontSize:"14px",color:"var(--secondary-color)"},children:"Waiting for the plugins to fully load..."}),!S&&e.jsxs("p",{className:"MbfWindowFooterText",style:{fontWeight:"normal",fontSize:"14px",color:"var(--secondary-color)"},children:["Registered devices: ",$.length.toString(),"/",N.length.toString()]}),t&&e.jsx("p",{className:"MbfWindowFooterText",style:{fontWeight:"normal",fontSize:"14px",color:"var(--secondary-color)"},children:"Restart required"})]})]}):e.jsx(Je,{})}function mn(){const[o,p]=r.useState(null),[i,n]=r.useState(null),[a,x]=r.useState([]),[v]=r.useState(localStorage.getItem("homePagePlugins")!=="false"),[t,s]=r.useState(localStorage.getItem("homePageMode")??"devices"),[S,W]=r.useState(""),[b,F]=r.useState(!1),[H,j]=r.useState(!1),[$,u]=r.useState(null),{addListener:L,removeListener:h,online:N,sendMessage:O,logFilterLevel:E,logFilterSearch:V,autoScroll:B,getUniqueId:Y}=r.useContext(fe),d=r.useRef(Y());return r.useEffect(()=>{const f=y=>{y.src==="Matterbridge"&&y.dst==="Frontend"&&(y.method==="refresh_required"&&y.params.changed==="settings"&&(l&&console.log(`Home received refresh_required: changed=${y.params.changed} and sending /api/settings request`),O({id:d.current,sender:"Home",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),y.id===d.current&&y.method==="/api/settings"&&(l&&console.log("Home received settings:",y.response),p(y.response.systemInformation),n(y.response.matterbridgeInformation),y.response.matterbridgeInformation.bridgeMode==="bridge"&&($||u("Matterbridge")),y.response.matterbridgeInformation.bridgeMode==="childbridge"&&a.length>0&&$===null&&($||u(a[0].matter.id)),y.response.matterbridgeInformation.matterbridgeVersion&&W(`https://github.com/Luligu/matterbridge/blob/${y.response.matterbridgeInformation.matterbridgeVersion.includes("-dev-")?"dev":"main"}/CHANGELOG.md`),localStorage.getItem("frontendVersion")===null?localStorage.setItem("frontendVersion",y.response.matterbridgeInformation.frontendVersion):y.response.matterbridgeInformation.frontendVersion!==localStorage.getItem("frontendVersion")&&(localStorage.setItem("frontendVersion",y.response.matterbridgeInformation.frontendVersion),j(!0)),localStorage.getItem("matterbridgeVersion")===null?localStorage.setItem("matterbridgeVersion",y.response.matterbridgeInformation.matterbridgeVersion):y.response.matterbridgeInformation.matterbridgeVersion!==localStorage.getItem("matterbridgeVersion")&&(localStorage.setItem("matterbridgeVersion",y.response.matterbridgeInformation.matterbridgeVersion),F(!0)),y.response.matterbridgeInformation.shellyBoard&&(localStorage.getItem("homePageMode")||(localStorage.setItem("homePageMode","devices"),s("devices")))),y.id===d.current&&y.method==="/api/plugins"&&(l&&console.log(`Home received plugins (${i?.bridgeMode}):`,y.response),x(y.response),i?.bridgeMode==="childbridge"&&y.response.length>0&&($||u(y.response[0].matter.id))))};return L(f),l&&console.log(`Home added WebSocket listener id ${d.current}`),()=>{h(f),l&&console.log("Home removed WebSocket listener")}},[L,h,O,i,a,$]),r.useEffect(()=>{N&&(l&&console.log("Home received online"),O({id:d.current,sender:"Home",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),O({id:d.current,sender:"Home",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[N,O]),l&&console.log("Home rendering..."),!N||!o||!i?e.jsx(Je,{}):e.jsxs("div",{className:"MbfPageDiv",style:{flexDirection:"row"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",width:"302px",minWidth:"302px",gap:"20px"},children:[e.jsx(en,{id:$}),e.jsx(Ko,{systemInfo:o,compact:!0})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",width:"100%",gap:"20px"},children:[H&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Frontend Update"})}),e.jsxs("div",{className:"MbfWindowBody",style:{flexDirection:"row",justifyContent:"space-between"},children:[e.jsx("h4",{style:{margin:0},children:"The frontend has been updated. You are viewing an outdated web UI. Please refresh the page now."}),e.jsx("div",{children:e.jsx(oe,{onClick:()=>window.location.reload(),endIcon:e.jsx(Rr,{}),style:{marginLeft:"10px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Refresh"})})]})]}),b&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge Update"})}),e.jsxs("div",{className:"MbfWindowBody",style:{flexDirection:"row",justifyContent:"space-between"},children:[e.jsx("h4",{style:{margin:0},children:"Matterbridge has been updated."}),e.jsxs("div",{children:[e.jsx(oe,{onClick:()=>window.open(S,"_blank"),endIcon:e.jsx(Xt,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Changelog"}),e.jsx(oe,{onClick:()=>window.location.reload(),endIcon:e.jsx(Hr,{}),style:{marginLeft:"10px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Close"})]})]})]}),v&&!i.readOnly&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Install plugins"})}),e.jsx(tn,{})]}),v&&e.jsx(ln,{storeId:$,setStoreId:u}),t==="devices"&&e.jsx(un,{storeId:$,setStoreId:u}),t==="logs"&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"1 1 auto",width:"100%",overflow:"hidden"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",minHeight:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",children:"Logs"}),e.jsx("div",{className:"MbfWindowHeaderText",style:{display:"flex",justifyContent:"space-between"},children:e.jsxs("span",{style:{fontWeight:"normal",fontSize:"12px",marginTop:"2px"},children:['Filter: logger level "',E,'" and search "',V,'" Scroll: ',B?"auto":"manual"]})})]}),e.jsx("div",{style:{flex:"1 1 auto",margin:"0px",padding:"10px",overflow:"auto"},children:e.jsx(nr,{})})]})]})]})}const Jt={display:"flex",gap:"2px",justifyContent:"space-evenly",width:"100%",height:"40px"},gn={margin:"0",padding:"0",fontSize:"36px",fontWeight:"medium",color:"var(--primary-color)"},hn={margin:"0",padding:"0",fontSize:"20px",fontWeight:"medium",color:"var(--div-text-color)",textAlign:"center"},Qt={margin:"0",padding:"0",paddingBottom:"2px",fontSize:"16px",fontWeight:"medium",color:"var(--div-text-color)",textAlign:"center"},xn={display:"flex",gap:"2px",justifyContent:"center",width:"100%",height:"18px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},fn={margin:"0",padding:"0",fontSize:"12px",fontWeight:"normal",color:"var(--div-text-color)"},bn={display:"flex",justifyContent:"center",width:"100%",height:"52px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},vn={margin:"0",padding:"0",fontSize:"14px",fontWeight:"bold",color:"var(--div-text-color)"},yn={display:"flex",gap:"4px",justifyContent:"center",width:"100%",height:"15px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},Pt={margin:"0",padding:"0px 4px",borderRadius:"5px",textAlign:"center",fontSize:"12px",fontWeight:"normal",color:"var(--secondary-color)"},jn=[256,257,268,269],Cn=[266,267],Sn=[259,260,261,271,272],wn=[256,257,268,269,266,267,259,260,261];function Q({icon:o,iconColor:p,cluster:i,value:n,unit:a,prefix:x}){return l&&console.log(`Render cluster "${i.clusterName}.${i.attributeName}" value(${typeof n}-${isNaN(n)}) "${n}" unit "${a}"`),x=x??!1,e.jsxs(Z,{sx:Jt,children:[o&&Ee.cloneElement(o,{key:`${i.clusterId}-${i.attributeId}-icon`,sx:{...gn,color:p??"var(--primary-color)"}}),e.jsxs(Z,{sx:{...Jt,gap:"4px",alignContent:"center",alignItems:"end",justifyContent:"center"},children:[a&&x===!0&&e.jsx(de,{sx:Qt,children:a},`${i.clusterId}-${i.attributeId}-unit`),e.jsx(de,{sx:hn,children:n==null||typeof n=="number"&&isNaN(n)||n==="NaN"?"---":n},`${i.clusterId}-${i.attributeId}-value`),a&&x===!1&&e.jsx(de,{sx:Qt,children:a},`${i.clusterId}-${i.attributeId}-unit`)]},`${i.clusterId}-${i.attributeId}-valueunitbox`)]},`${i.clusterId}-${i.attributeId}-box`)}function Mn({device:o,endpoint:p,id:i,deviceType:n,clusters:a}){const x=["Unknown","Good","Fair","Moderate","Poor","VeryPoor","Ext.Poor"];let v="";return l&&console.log(`Device "${o.name}" endpoint "${p}" id "${i}" deviceType "0x${n.toString(16).padStart(4,"0")}" clusters (${a?.length}):`,a),n===17&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="batVoltage").map(t=>v=`${t.attributeLocalValue} mV`),wn.includes(n)&&a.filter(t=>t.clusterName==="LevelControl"&&t.attributeName==="currentLevel").map(t=>v=`Level ${t.attributeValue}`),n===514&&a.filter(t=>t.clusterName==="WindowCovering"&&t.attributeName==="currentPositionLiftPercent100ths").map(t=>v=`Position ${t.attributeValue/100}%`),n===769&&a.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="occupiedHeatingSetpoint").map(t=>v=`Heat ${t.attributeValue/100}°C `),n===769&&a.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="occupiedCoolingSetpoint").map(t=>v=v+`Cool ${t.attributeValue/100}°C`),n===118&&a.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="coState").map(t=>v=`${t.attributeLocalValue===0?"No CO detected":"CO alarm!"}`),n===1296&&a.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="voltage").map(t=>v=`${t.attributeLocalValue/1e3} V, `),n===1296&&a.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="activeCurrent").map(t=>v=v+`${t.attributeLocalValue/1e3} A, `),n===1296&&a.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="activePower").map(t=>v=v+`${t.attributeLocalValue/1e3} W`),e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0px",padding:"5px",width:"150px",height:"150px",borderColor:"var(--div-bg-color)",borderRadius:"5px",justifyContent:"space-between"},children:[n===19&&a.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(Q,{icon:t.attributeLocalValue===!0?e.jsx(it,{}):e.jsx(Or,{}),iconColor:t.attributeLocalValue===!0?"green":"red",cluster:t,value:t.attributeLocalValue===!0?"Online":"Offline"})),n===17&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="batPercentRemaining").map(t=>e.jsx(Q,{icon:e.jsx(jt,{}),cluster:t,value:t.attributeValue/2,unit:"%"})),n===17&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="wiredCurrentType").map(t=>e.jsx(Q,{icon:e.jsx(er,{}),cluster:t,value:t.attributeLocalValue===0?"AC":"DC"})),n===1293&&a.filter(t=>t.clusterName==="DeviceEnergyManagement"&&t.attributeName==="esaState").map(t=>e.jsx(Q,{icon:e.jsx(te,{path:go,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Offline":"Online"})),jn.includes(n)&&a.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(Q,{icon:e.jsx($r,{}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),Cn.includes(n)&&a.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(Q,{icon:e.jsx(te,{path:ho,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),Sn.includes(n)&&a.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(Q,{icon:e.jsx(te,{path:xo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),n===115&&a.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(Q,{icon:e.jsx(te,{path:fo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),n===124&&a.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(Q,{icon:e.jsx(te,{path:bo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),n===117&&a.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(Q,{icon:e.jsx(te,{path:vo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),n===123&&a.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(Q,{icon:e.jsx($t,{}),cluster:t,value:"Oven"})),n===112&&a.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(Q,{icon:e.jsx(Er,{}),cluster:t,value:"Fridge"})),n===113&&a.filter(t=>t.clusterName==="TemperatureControl"&&t.attributeName==="selectedTemperatureLevel").map(t=>e.jsx(Q,{icon:e.jsx(te,{path:yo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),n===121&&a.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(Q,{icon:e.jsx($t,{}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),n===122&&a.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="fanMode").map(t=>e.jsx(Q,{icon:e.jsx(te,{path:jo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),n===120&&a.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(Q,{icon:e.jsx(te,{path:Ut,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Cooktop"})),n===119&&a.filter(t=>t.clusterName==="TemperatureControl"&&t.attributeName==="selectedTemperatureLevel").map(t=>e.jsx(Q,{icon:e.jsx(te,{path:Ut,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),n===116&&a.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(Q,{icon:e.jsx(te,{path:Co,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Robot"})),n===514&&a.filter(t=>t.clusterName==="WindowCovering"&&t.attributeName==="currentPositionLiftPercent100ths").map(t=>e.jsx(Q,{icon:e.jsx(Vr,{}),cluster:t,value:t.attributeLocalValue/100,unit:"%"})),n===769&&a.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="localTemperature").map(t=>e.jsx(Q,{icon:e.jsx(te,{path:So,size:"40px",color:"var(--primary-color)"}),cluster:t,value:(t.attributeLocalValue??0)/100,unit:"°C"})),n===10&&a.filter(t=>t.clusterName==="DoorLock"&&t.attributeName==="lockState").map(t=>e.jsx(Q,{icon:t.attributeValue==="1"?e.jsx(_r,{}):e.jsx(Ar,{}),cluster:t,value:t.attributeValue==="1"?"Locked":"Unlocked"})),n===43&&a.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="percentCurrent").map(t=>e.jsx(Q,{icon:e.jsx(Ur,{}),cluster:t,value:t.attributeValue,unit:"%"})),n===15&&a.filter(t=>t.clusterName==="Switch"&&t.attributeName==="currentPosition").map(t=>e.jsx(Q,{icon:e.jsx(te,{path:wo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeValue,unit:"pos",prefix:!0})),n===39&&a.filter(t=>t.clusterName==="ModeSelect"&&t.attributeName==="currentMode").map(t=>e.jsx(Q,{icon:e.jsx(zr,{}),cluster:t,value:t.attributeValue,unit:"mode",prefix:!0})),n===771&&a.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(Q,{icon:e.jsx(qr,{}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),n===45&&a.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="percentCurrent").map(t=>e.jsx(Q,{icon:e.jsx(Et,{}),cluster:t,value:t.attributeValue,unit:"%"})),n===114&&a.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="localTemperature").map(t=>e.jsx(Q,{icon:e.jsx(Et,{}),cluster:t,value:(t.attributeLocalValue??0)/100,unit:"°C"})),n===67&&a.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(Q,{icon:e.jsx(Br,{}),cluster:t,value:t.attributeLocalValue===!0?"Leak":"No leak"})),n===65&&a.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(Q,{icon:e.jsx(Jr,{}),cluster:t,value:t.attributeLocalValue===!0?"Freeze":"No freeze"})),n===68&&a.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(Q,{icon:e.jsx(Qr,{}),cluster:t,value:t.attributeLocalValue===!0?"Rain":"No rain"})),n===1292&&a.filter(t=>t.clusterName==="EnergyEvse"&&t.attributeName==="state").map(t=>e.jsx(Q,{icon:e.jsx(te,{path:Mo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Free":"In use"})),n===1295&&a.filter(t=>t.clusterName==="WaterHeaterManagement"&&t.attributeName==="tankPercentage").map(t=>e.jsx(Q,{icon:e.jsx(te,{path:ko,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Tank "+(t.attributeLocalValue??0)+"%"})),n===777&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="featureMap").map(t=>e.jsx(Q,{icon:e.jsx(te,{path:Io,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"HeatPump"})),n===23&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="featureMap").map(t=>e.jsx(Q,{icon:e.jsx(te,{path:Do,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Solar"})),n===24&&a.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="featureMap").map(t=>e.jsx(Q,{icon:e.jsx(te,{path:No,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Inverter"})),n===118&&a.find(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="featureMap"&&t.attributeLocalValue.smokeAlarm===!0)&&a.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="smokeState").map(t=>e.jsx(Q,{icon:e.jsx(te,{path:zt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"No smoke":"Smoke!"})),n===118&&a.find(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="featureMap"&&t.attributeLocalValue.smokeAlarm===!1)&&a.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="coState").map(t=>e.jsx(Q,{icon:e.jsx(te,{path:zt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"No Co":"Co!"})),n===66&&a.filter(t=>t.clusterName==="ValveConfigurationAndControl"&&t.attributeName==="currentState").map(t=>e.jsx(Q,{icon:e.jsx(Gr,{}),cluster:t,value:t.attributeLocalValue===0?"Closed":"Opened"})),n===44&&a.filter(t=>t.clusterName==="AirQuality"&&t.attributeName==="airQuality").map(t=>e.jsx(Q,{icon:e.jsx(te,{path:Po,size:"40px",color:"var(--primary-color)"}),cluster:t,value:x[t.attributeLocalValue??0]})),n===770&&a.filter(t=>t.clusterName==="TemperatureMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(Q,{icon:e.jsx(Kr,{}),cluster:t,value:t.attributeLocalValue/100,unit:"°C"})),n===775&&a.filter(t=>t.clusterName==="RelativeHumidityMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(Q,{icon:e.jsx(te,{path:To,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue/100,unit:"%"})),n===774&&a.filter(t=>t.clusterName==="FlowMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(Q,{icon:e.jsx(Yr,{}),cluster:t,value:t.attributeLocalValue,unit:"l/h"})),n===773&&a.filter(t=>t.clusterName==="PressureMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(Q,{icon:e.jsx(Xr,{}),cluster:t,value:t.attributeLocalValue,unit:"hPa"})),n===21&&a.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(Q,{icon:t.attributeValue==="true"?e.jsx(Zr,{}):e.jsx(eo,{}),cluster:t,value:t.attributeValue==="true"?"Closed":"Opened"})),n===263&&a.filter(t=>t.clusterName==="OccupancySensing"&&t.attributeName==="occupancy").map(t=>e.jsx(Q,{icon:t.attributeValue==="{ occupied: true }"?e.jsx(to,{}):e.jsx(ro,{}),cluster:t,value:t.attributeValue==="{ occupied: true }"?"Occupied":"Unocc."})),n===262&&a.filter(t=>t.clusterName==="IlluminanceMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(Q,{icon:e.jsx(oo,{}),cluster:t,value:Math.round(Math.pow(10,t.attributeValue/1e4)),unit:"lx"})),n===1296&&a.filter(t=>t.clusterName==="ElectricalEnergyMeasurement"&&t.attributeName==="cumulativeEnergyImported").map(t=>e.jsx(Q,{icon:e.jsx(no,{}),cluster:t,value:Math.round(t.attributeLocalValue?.energy/1e6),unit:"kwh"})),e.jsx(Z,{sx:xn,children:e.jsx(de,{sx:fn,children:v})}),e.jsx(Z,{sx:bn,children:e.jsx(de,{sx:vn,children:o.name})}),e.jsxs(Z,{sx:yn,children:[l&&e.jsx(de,{sx:Pt,children:p}),e.jsx(de,{sx:Pt,children:i}),l&&e.jsxs(de,{sx:Pt,children:["0x",n.toString(16).padStart(4,"0")]})]})]})}function kn({filter:o}){const{online:p,sendMessage:i,addListener:n,removeListener:a,getUniqueId:x}=r.useContext(fe),[v,t]=r.useState(!1),[s,S]=r.useState({}),[W,b]=r.useState([]),[F,H]=r.useState([]),[j,$]=r.useState({}),[u,L]=r.useState({}),[h,N]=r.useState({}),[O,E]=r.useState(F),V=r.useRef(x()),B=()=>{t(!v)};return r.useEffect(()=>{const Y=d=>{if(d.src==="Matterbridge"&&d.dst==="Frontend"){if(d.method==="refresh_required"&&(l&&console.log(`DevicesIcons received refresh_required: changed=${d.params.changed} and sending api requests`),i({id:V.current,sender:"Icons",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),i({id:V.current,sender:"Icons",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),i({id:V.current,sender:"Icons",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}})),d.method==="/api/settings"&&d.response&&(l&&console.log("DevicesIcons received settings:",d.response),S(d.response)),d.method==="/api/plugins"&&d.response&&(l&&console.log("DevicesIcons received plugins:",d.response),b(d.response)),d.method==="/api/devices"&&d.response){l&&console.log(`DevicesIcons received ${d.response.length} devices:`,d.response),H(d.response);for(let f of d.response)l&&console.log("DevicesIcons sending /api/clusters"),i({id:V.current,sender:"Icons",method:"/api/clusters",src:"Frontend",dst:"Matterbridge",params:{plugin:f.pluginName,endpoint:f.endpoint}})}if(d.method==="/api/clusters"&&d.response){if(console.log(`DevicesIcons received for device "${d.response.deviceName}" serial "${d.response.serialNumber}" deviceType ${d.response.deviceTypes.join(" ")} clusters (${d.response.length}):`,d.response),d.response.length===0)return;const f=d.response.serialNumber;j[f]=[],u[f]=d.response.deviceTypes,h[f]=[];for(let y of d.response.clusters)j[f].find(D=>D.endpoint===y.endpoint)||j[f].push({endpoint:y.endpoint,id:y.id,deviceTypes:y.deviceTypes}),!["FixedLabel","Descriptor","Identify","Groups","PowerTopology"].includes(y.clusterName)&&h[f].push(y);$({...j}),L({...u}),N({...h}),l&&console.log(`DevicesIcons endpoints for "${f}":`,j[f]),l&&console.log(`DevicesIcons deviceTypes for "${f}":`,u[f]),l&&console.log(`DevicesIcons clusters for "${f}":`,h[f])}}};return n(Y),l&&console.log("DevicesIcons useEffect webSocket mounted"),()=>{a(Y),l&&console.log("DevicesIcons useEffect webSocket unmounted")}},[n,a,i]),r.useEffect(()=>(l&&console.log("DevicesIcons useEffect online mounting"),p&&(l&&console.log("DevicesIcons useEffect online sending api requests"),i({id:V.current,sender:"Icons",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),i({id:V.current,sender:"Icons",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),i({id:V.current,sender:"Icons",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}})),l&&console.log("DevicesIcons useEffect online mounted"),()=>{l&&console.log("DevicesIcons useEffect online unmounted")}),[p,i]),r.useEffect(()=>{if(o===""){E(F);return}const Y=F.filter(d=>d.name.toLowerCase().includes(o)||d.serial.toLowerCase().includes(o));E(Y)},[F,o]),l&&console.log("DevicesIcons rendering..."),e.jsxs(e.Fragment,{children:[e.jsxs(Ie,{open:v,onClose:B,PaperProps:{style:{color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",border:"2px solid var(--primary-color)",borderRadius:"var(--div-border-radius)",boxShadow:"2px 2px 5px var(--div-shadow-color)"}},children:[e.jsx(De,{children:"Configure accessories"}),e.jsx(Ne,{}),e.jsx(Pe,{children:e.jsx(oe,{onClick:B,children:"Close"})})]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",paddingBottom:"5px",gap:"20px",width:"100%",overflow:"auto"},children:O.map(Y=>j[Y.serial]&&j[Y.serial].map(d=>d.deviceTypes.map(f=>e.jsx(Mn,{device:Y,endpoint:d.endpoint,id:d.id,deviceType:f,clusters:h[Y.serial].filter(y=>y.endpoint===d.endpoint)}))))})]})}const ir=[{Header:"Plugin name",accessor:"pluginName"},{Header:"Device type",accessor:"type"},{Header:"Endpoint",accessor:"endpoint"},{Header:"Name",accessor:"name"},{Header:"Serial number",accessor:"serial"},{Header:"Unique ID",accessor:"uniqueId"},{Header:"Url",accessor:"configUrl"},{Header:"Config",accessor:"configButton",noSort:!0,Cell:({row:o})=>o.original.configUrl?e.jsx(z,{onClick:()=>window.open(o.original.configUrl,"_blank"),"aria-label":"Open Config",sx:{margin:0,padding:0},children:e.jsx(Be,{fontSize:"small"})}):null},{Header:"Cluster",accessor:"cluster"}],ar=[{Header:"Endpoint",accessor:"endpoint"},{Header:"Id",accessor:"id"},{Header:"Device Types",accessor:"deviceTypes",Cell:({value:o})=>Array.isArray(o)?o.map(p=>`0x${p.toString(16).padStart(4,"0")}`).join(", "):o},{Header:"Cluster Name",accessor:"clusterName"},{Header:"Cluster ID",accessor:"clusterId"},{Header:"Attribute Name",accessor:"attributeName"},{Header:"Attribute ID",accessor:"attributeId"},{Header:"Attribute Value",accessor:"attributeValue",Cell:({value:o})=>e.jsx(R,{title:o,componentsProps:{tooltip:{sx:{fontSize:"14px",fontWeight:"normal",color:"#ffffff",backgroundColor:"var(--primary-color)"}}},children:e.jsx("div",{style:{maxWidth:"500px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o})})}],In=o=>`${o.pluginName}::${o.uniqueId}`,Dn=o=>`${o.endpoint}::${o.clusterName}::${o.attributeName}`;function Nn({data:o,columnVisibility:p,setPlugin:i,setEndpoint:n,setDeviceName:a}){const[x,v]=r.useState(null),t=Ee.useMemo(()=>ir.filter(j=>p[j.accessor]),[p]),{getTableProps:s,getTableBodyProps:S,headerGroups:W,rows:b,prepareRow:F}=Ae.useTable({columns:t,data:o,getRowId:In},Ae.useSortBy),H=j=>{if(j.id===x){v(null),i(null),n(null),a(null),l&&console.log("Device unclicked:",j.id,"selectedDeviceIndex:",x);return}v(j.id),i(j.original.pluginName),n(j.original.endpoint),a(j.original.name),l&&console.log("Device clicked:",j.id,"selectedDeviceIndex:",x,"pluginName:",j.original.pluginName,"endpoint:",j.original.endpoint)};return e.jsxs("table",{...s(),style:{margin:"-1px",border:"1px solid var(--table-border-color)"},children:[e.jsx("thead",{children:W.map(j=>e.jsx("tr",{...j.getHeaderGroupProps(),children:j.headers.map($=>e.jsxs("th",{...$.getHeaderProps($.noSort?void 0:$.getSortByToggleProps()),children:[$.render("Header"),!$.noSort&&e.jsx("span",{style:{margin:"0px",marginLeft:"5px",padding:"0px"},children:$.isSorted?$.isSortedDesc?e.jsx(te,{path:Tt,size:"15px"}):e.jsx(te,{path:Wt,size:"15px"}):null})]}))}))}),e.jsx("tbody",{...S(),children:b.map((j,$)=>(F(j),e.jsx("tr",{className:$%2===0?"table-content-even":"table-content-odd",...j.getRowProps(),onClick:()=>H(j),style:{backgroundColor:x===j.id?"var(--table-selected-bg-color)":"",cursor:"pointer"},children:j.cells.map(u=>e.jsx("td",{...u.getCellProps(),children:u.render("Cell")}))})))})]})}function Pn({data:o,columnVisibility:p}){const i=Ee.useMemo(()=>ar.filter(s=>p[s.accessor]),[p]),{getTableProps:n,getTableBodyProps:a,headerGroups:x,rows:v,prepareRow:t}=Ae.useTable({columns:i,data:o,getRowId:Dn},Ae.useSortBy);return e.jsxs("table",{...n(),style:{margin:"-1px"},children:[e.jsx("thead",{children:x.map(s=>e.jsx("tr",{...s.getHeaderGroupProps(),children:s.headers.map(S=>e.jsx("th",{...S.getHeaderProps(),children:S.render("Header")}))}))}),e.jsx("tbody",{...a(),children:v.map((s,S)=>(t(s),e.jsx("tr",{className:S%2===0?"table-content-even":"table-content-odd",...s.getRowProps(),children:s.cells.map(W=>e.jsx("td",{...W.getCellProps(),children:W.render("Cell")}))})))})]})}function Tn(){const{online:o,sendMessage:p,addListener:i,removeListener:n,getUniqueId:a}=r.useContext(fe),[x,v]=r.useState([]),[t,s]=r.useState([]),[S,W]=r.useState(null),[b,F]=r.useState(null),[H,j]=r.useState(null),[$,u]=r.useState(0),[L,h]=r.useState(!1),[N,O]=r.useState({pluginName:!0,type:!0,endpoint:!0,name:!0,serial:!0,uniqueId:!1,configUrl:!1,configButton:!0,cluster:!0}),[E,V]=r.useState(!1),[B,Y]=r.useState({endpoint:!0,id:!0,deviceTypes:!0,clusterName:!0,clusterId:!0,attributeName:!0,attributeId:!0,attributeValue:!0}),[d,f]=r.useState(""),[y,D]=r.useState(x),[X,he]=r.useState("icon"),C=r.useRef(a());r.useEffect(()=>{const U=w=>{if(l&&console.log("Devices received WebSocket Message:",w),w.src==="Matterbridge"&&w.dst==="Frontend"&&(w.method==="refresh_required"&&w.params.changed==="devices"&&(l&&console.log(`Devices received refresh_required: changed=${w.params.changed} and sending /api/devices request`),p({id:C.current,sender:"Devices",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}})),w.method==="/api/devices"&&(l&&console.log(`Devices received ${w.response.length} devices:`,w.response),v(w.response)),w.method==="/api/clusters")){console.log(`Devices received ${w.response.length} clusters:`,w.response),s(w.response.clusters);const k={};for(const M of w.response.clusters)l&&console.log("Cluster:",M.endpoint),k[M.endpoint]?k[M.endpoint]++:k[M.endpoint]=1;u(Object.keys(k).length)}};return i(U),l&&console.log("Devices added WebSocket listener"),()=>{n(U),l&&console.log("Devices removed WebSocket listener")}},[i,n,p]),r.useEffect(()=>{o&&(l&&console.log("Devices sending api requests"),p({id:C.current,sender:"Devices",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),p({id:C.current,sender:"Devices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),p({id:C.current,sender:"Devices",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}}))},[o,p]),r.useEffect(()=>{S&&b&&(l&&console.log("Devices sending /api/clusters"),p({id:C.current,sender:"Devices",method:"/api/clusters",src:"Frontend",dst:"Matterbridge",params:{plugin:S,endpoint:b}}))},[S,b,p]);const m=()=>{h(!L)},_=U=>{O(w=>{const k={...w,[U]:!w[U]};return localStorage.setItem("devicesColumnVisibility",JSON.stringify(k)),k})};r.useEffect(()=>{const U=localStorage.getItem("devicesColumnVisibility");U&&O(JSON.parse(U))},[]);const I=()=>{V(!E)},ee=U=>{Y(w=>{const k={...w,[U]:!w[U]};return localStorage.setItem("clustersColumnVisibility",JSON.stringify(k)),k})};r.useEffect(()=>{const U=localStorage.getItem("clustersColumnVisibility");U&&Y(JSON.parse(U))},[]);const xe=U=>{f(U.target.value.toLowerCase()),localStorage.setItem("devicesFilter",U.target.value.toLowerCase())},we=U=>{he(U),localStorage.setItem("devicesViewMode",U)};return r.useEffect(()=>{if(d===""){D(x);return}const U=x.filter(w=>w.name.toLowerCase().includes(d)||w.serial.toLowerCase().includes(d));D(U)},[x,d]),r.useEffect(()=>{const U=localStorage.getItem("devicesFilter");U&&f(U)},[]),r.useEffect(()=>{const U=localStorage.getItem("devicesViewMode");U&&he(U)},[]),l&&console.log("Devices rendering..."),o?e.jsxs("div",{className:"MbfPageDiv",children:[e.jsxs("div",{className:"MbfWindowBodyRow",style:{justifyContent:"space-between",padding:0,gap:"20px",width:"100%",height:"45px",minHeight:"45px",maxHeight:"45px"},children:[e.jsxs(Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx(de,{sx:{fontSize:"16px",fontWeight:"normal",color:"var(--div-text-color)",marginLeft:"5px",whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(pe,{variant:"outlined",value:d,onChange:xe,placeholder:"Enter the device name or serial number",sx:{width:"320px"},InputProps:{style:{backgroundColor:"var(--main-bg-color)"}}})]}),e.jsxs(Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx(de,{sx:{fontSize:"16px",fontWeight:"normal",color:"var(--div-text-color)",marginLeft:"5px",whiteSpace:"nowrap"},children:"View mode:"}),e.jsx(z,{onClick:()=>we("table"),"aria-label":"Table View",disabled:X==="table",children:e.jsx(R,{title:"Table View",children:e.jsx(io,{style:{color:X==="table"?"var(--main-icon-color)":"var(--primary-color)"}})})}),e.jsx(z,{onClick:()=>we("icon"),"aria-label":"Icon View",disabled:X==="icon",children:e.jsx(R,{title:"Icon View (beta)",children:e.jsx(ao,{style:{color:X==="icon"?"var(--main-icon-color)":"var(--primary-color)"}})})})]})]}),e.jsxs(Ie,{open:L,onClose:m,children:[e.jsx(De,{children:"Configure Devices Columns"}),e.jsx(Ne,{children:e.jsx(at,{children:ir.map(U=>e.jsx(Te,{control:e.jsx(We,{disabled:["pluginName","name","configButton"].includes(U.accessor),checked:N[U.accessor],onChange:()=>_(U.accessor)}),label:U.Header},U.accessor))})}),e.jsx(Pe,{children:e.jsx(oe,{onClick:m,children:"Close"})})]}),X==="table"&&e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",maxHeight:`${S&&b?"50%":"100%"}`,width:"100%",flex:"1 1 auto",overflow:"hidden"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Registered devices"}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(z,{onClick:m,"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(R,{title:"Configure columns",children:e.jsx(Be,{style:{color:"var(--header-text-color)",fontSize:"19px"}})})})})]}),e.jsx("div",{className:"MbfWindowBodyColumn",style:{margin:"0",padding:"0",gap:"0"},children:e.jsx(Nn,{data:y,columnVisibility:N,setPlugin:W,setEndpoint:F,setDeviceName:j})}),e.jsx("div",{className:"MbfWindowFooter",style:{borderTop:"1px solid var(--table-border-color)",justifyContent:"flex-start"},children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontWeight:"normal",textAlign:"left"},children:["Total devices: ",y.length.toString()]})})]}),e.jsxs(Ie,{open:E,onClose:I,children:[e.jsx(De,{children:"Configure Clusters Columns"}),e.jsx(Ne,{children:e.jsx(at,{children:ar.map(U=>e.jsx(Te,{control:e.jsx(We,{disabled:["clusterName","attributeName","attributeValue"].includes(U.accessor),checked:B[U.accessor],onChange:()=>ee(U.accessor)}),label:U.Header},U.accessor))})}),e.jsx(Pe,{children:e.jsx(oe,{onClick:I,children:"Close"})})]}),X==="table"&&S&&b&&e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",height:"50%",maxHeight:"50%",width:"100%",flex:"1 1 auto",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsxs("div",{className:"MbfWindowHeaderText",style:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[e.jsxs("p",{style:{margin:"0px",padding:"0px"},children:['Clusters for device "',H,'" on endpoint ',b]}),e.jsx(z,{onClick:I,"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(R,{title:"Configure columns",children:e.jsx(Be,{style:{color:"var(--header-text-color)",fontSize:"19px"}})})})]})}),e.jsx("div",{className:"MbfWindowBodyColumn",style:{margin:"0",padding:"0",gap:"0"},children:e.jsx(Pn,{data:t,columnVisibility:B})}),e.jsx("div",{className:"MbfWindowFooter",style:{borderTop:"1px solid var(--table-border-color)",justifyContent:"flex-start"},children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontWeight:"normal",textAlign:"left"},children:["Total child endpoints: ",$-1]})})]}),X==="icon"&&e.jsx(kn,{filter:d,devices:y})]}):e.jsx(Je,{})}function Wn(){const[o,p]=r.useState(localStorage.getItem("logFilterLevel")??"info"),[i,n]=r.useState(localStorage.getItem("logFilterSearch")??"*"),[a,x]=r.useState(localStorage.getItem("logAutoScroll")!=="false"),{setMessages:v,setLogFilters:t,online:s,setAutoScroll:S}=r.useContext(fe),W=j=>{p(j.target.value),t(j.target.value,i),localStorage.setItem("logFilterLevel",j.target.value),l&&console.log("handleChangeLevel called with value:",j.target.value)},b=j=>{n(j.target.value),t(o,j.target.value),localStorage.setItem("logFilterSearch",j.target.value),l&&console.log("handleChangeSearch called with value:",j.target.value)},F=j=>{x(j.target.checked),S(j.target.checked),localStorage.setItem("logAutoScroll",j.target.value?"true":"false"),l&&console.log("handleAutoScrollChange called with value:",j.target.checked)},H=()=>{l&&console.log("handleClearLogsClick called"),v([])};return l&&console.log("Logs rendering..."),s?e.jsxs("div",{className:"MbfPageDiv",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",margin:"0px",padding:"0px",gap:"10px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Vt,{id:"select-level",style:{color:"var(--div-text-color)"},children:"Filter log by level:"}),e.jsxs(rt,{style:{height:"30px",backgroundColor:"var(--main-bg-color)"},labelId:"select-level",id:"debug-level",value:o,onChange:W,children:[e.jsx(P,{value:"debug",children:"Debug"}),e.jsx(P,{value:"info",children:"Info"}),e.jsx(P,{value:"notice",children:"Notice"}),e.jsx(P,{value:"warn",children:"Warn"}),e.jsx(P,{value:"error",children:"Error"}),e.jsx(P,{value:"fatal",children:"Fatal"})]}),e.jsx(Vt,{id:"search",style:{color:"var(--div-text-color)"},children:"Filter log by text:"}),e.jsx(pe,{style:{width:"300px"},size:"small",id:"logsearch",variant:"outlined",value:i,onChange:b,InputProps:{style:{height:"30px",padding:"0 0px",backgroundColor:"var(--main-bg-color)"}}}),e.jsx(Te,{control:e.jsx(We,{checked:a,onChange:F}),label:"Auto scroll",style:{color:"var(--div-text-color)"}})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:e.jsx(R,{title:"Clear the logs",children:e.jsx(oe,{onClick:H,endIcon:e.jsx(Ct,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Clear"})})})]}),e.jsx("div",{style:{flex:"1",overflow:"auto",margin:"0px",padding:"0px"},children:e.jsx(nr,{})})]}):e.jsx(Je,{})}const Fn=({open:o,ip:p,onClose:i,onSave:n})=>{const a=p?p.split(".").slice(0,3).join(".")+".1":"",[x,v]=r.useState("dhcp"),[t,s]=r.useState({ip:p??"",subnet:"255.255.255.0",gateway:a,dns:a}),S=F=>H=>{s({...t,[F]:H.target.value})},W=()=>{i()},b=()=>{const F=x==="static"?{type:x,...t}:{type:x};n(F),i()};return e.jsxs(Ie,{open:o,onClose:(F,H)=>{H==="backdropClick"||H==="escapeKeyDown"||i()},maxWidth:"sm",style:{maxWidth:"550px",margin:"auto"},children:[e.jsx(De,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:"Network Configuration"})]})}),e.jsxs(Ne,{dividers:!0,children:[e.jsxs(tr,{component:"fieldset",fullWidth:!0,children:[e.jsx(ke,{component:"legend",children:"Select IP Configuration"}),e.jsxs(rr,{row:!0,value:x,onChange:F=>v(F.target.value),children:[e.jsx(Te,{value:"dhcp",control:e.jsx(St,{}),label:"DHCP"}),e.jsx(Te,{value:"static",control:e.jsx(St,{}),label:"Static"})]})]}),x==="static"&&e.jsxs(_e,{container:!0,spacing:2,sx:{mt:2},children:[e.jsx(_e,{size:6,children:e.jsx(pe,{label:"IP Address",fullWidth:!0,value:t.ip,onChange:S("ip")})}),e.jsx(_e,{size:6,children:e.jsx(pe,{label:"Subnet Mask",fullWidth:!0,value:t.subnet,onChange:S("subnet")})}),e.jsx(_e,{size:6,children:e.jsx(pe,{label:"Gateway",fullWidth:!0,value:t.gateway,onChange:S("gateway")})}),e.jsx(_e,{size:6,children:e.jsx(pe,{label:"DNS Server",fullWidth:!0,value:t.dns,onChange:S("dns")})})]})]}),e.jsxs(Pe,{children:[e.jsx(oe,{onClick:W,children:"Cancel"}),e.jsx(oe,{variant:"contained",onClick:b,children:"Save"})]})]})},Ln=({open:o,onClose:p,onSave:i})=>{const[n,a]=r.useState(""),[x,v]=r.useState(""),t=H=>{a(H.target.value)},s=H=>{v(H.target.value)},S=n.length>0&&n===x,W=()=>{p()},b=()=>{S&&(i(n),p())},F=()=>{i(""),p()};return e.jsxs(Ie,{open:o,onClose:(H,j)=>{j==="backdropClick"||j==="escapeKeyDown"||p()},maxWidth:"sm",style:{maxWidth:"500px",margin:"auto"},disableEscapeKeyDown:!0,children:[e.jsx(De,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:"Change Password"})]})}),e.jsx(Ne,{dividers:!0,children:e.jsx(tr,{component:"fieldset",fullWidth:!0,sx:{margin:0,padding:0,gap:"20px"},children:e.jsxs(_e,{container:!0,spacing:2,sx:{mt:2},children:[e.jsx(_e,{size:12,children:e.jsx(pe,{type:"password",autoComplete:"new-password",label:"New Password",size:"small",variant:"outlined",fullWidth:!0,value:n,onChange:t})}),e.jsx(_e,{size:12,children:e.jsx(pe,{type:"password",autoComplete:"new-password",label:"Confirm Password",size:"small",variant:"outlined",fullWidth:!0,value:x,onChange:s,error:x!==""&&n!==x,helperText:x!==""&&n!==x?"Passwords do not match":""})})]})})}),e.jsxs(Pe,{children:[e.jsx(oe,{onClick:W,children:"Cancel"}),e.jsx(oe,{variant:"contained",onClick:b,disabled:!S,children:"Change"}),e.jsx(oe,{variant:"contained",onClick:F,children:"Reset"})]})]})};function Rn(){const{online:o,addListener:p,removeListener:i,sendMessage:n,getUniqueId:a}=r.useContext(fe),[x,v]=r.useState(null),[t,s]=r.useState(null),S=r.useRef(a());return r.useEffect(()=>{const W=b=>{b.src==="Matterbridge"&&b.dst==="Frontend"&&(b.method==="refresh_required"&&b.params.changed==="settings"&&(l&&console.log(`Settings received refresh_required: changed=${b.params.changed} and sending /api/settings request`),n({id:S.current,sender:"Settings",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),b.method==="/api/settings"&&(l&&console.log("Settings received /api/settings:",b.response),v(b.response.matterbridgeInformation),s(b.response.systemInformation)))};return p(W),l&&console.log("Settings added WebSocket listener"),()=>{i(W),l&&console.log("Settings removed WebSocket listener")}},[p,i,n]),r.useEffect(()=>{o&&(l&&console.log("Settings received online"),n({id:S.current,sender:"Settings",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}))},[o,n]),x?(l&&console.log("Settings rendering..."),o?e.jsx("div",{className:"MbfPageDiv",children:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"20px",width:"100%"},children:[e.jsx(Hn,{matterbridgeInfo:x,systemInfo:t}),e.jsx(On,{matterbridgeInfo:x}),e.jsx($n,{matterbridgeInfo:x})]})}):e.jsx(Je,{})):null}function Hn({matterbridgeInfo:o,systemInfo:p}){const{sendMessage:i,getUniqueId:n}=r.useContext(fe),[a,x]=r.useState("bridge"),[v,t]=r.useState("Info"),[s,S]=r.useState(!1),[W,b]=r.useState("dark"),[F,H]=r.useState(localStorage.getItem("homePagePlugins")!=="false"),[j,$]=r.useState(localStorage.getItem("homePageMode")??"logs"),[u,L]=r.useState(localStorage.getItem("virtualMode")??"outlet"),h=r.useRef(n()),[N,O]=r.useState(!1),E=()=>O(!1),V=I=>{l&&console.log("handleSaveNetConfig called with config:",I),i({id:h.current,sender:"Settings",method:"/api/shellynetconfig",src:"Frontend",dst:"Matterbridge",params:I})},[B,Y]=r.useState(!1),d=()=>Y(!1),f=I=>{l&&console.log("handleSaveChangePassword called with password:",I),i({id:h.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setpassword",value:I}})};r.useEffect(()=>{o.bridgeMode!==void 0&&(x(o.bridgeMode==="bridge"?"bridge":"childbridge"),t(o.loggerLevel.charAt(0).toUpperCase()+o.loggerLevel.slice(1)),S(o.fileLogger),L(o.virtualMode))},[o]),r.useEffect(()=>{const I=localStorage.getItem("frontendTheme");I&&b(I)},[]);const y=I=>{l&&console.log("handleChangeBridgeMode called with value:",I.target.value),x(I.target.value),i({id:h.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setbridgemode",value:I.target.value}})},D=I=>{l&&console.log("handleChangeMbLoggerLevel called with value:",I.target.value),t(I.target.value),i({id:h.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmbloglevel",value:I.target.value}})},X=I=>{l&&console.log("handleLogOnFileMbChange called with value:",I.target.checked),S(I.target.checked),i({id:h.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmblogfile",value:I.target.checked}})},he=I=>{const ee=I.target.value;l&&console.log("handleChangeTheme called with value:",ee),b(ee),localStorage.setItem("frontendTheme",ee),document.body.setAttribute("frontend-theme",ee)},C=I=>{const ee=I.target.checked;l&&console.log("handleChangeHomePagePlugins called with value:",ee),H(ee),localStorage.setItem("homePagePlugins",ee?"true":"false")},m=I=>{const ee=I.target.value;l&&console.log("handleChangeHomePageMode called with value:",ee),$(ee),localStorage.setItem("homePageMode",ee)},_=I=>{const ee=I.target.value;l&&console.log("handleChangeVirtualMode called with value:",ee),L(ee),localStorage.setItem("virtualMode",ee),i({id:h.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setvirtualmode",value:ee}})};return e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge settings"})}),e.jsx(Fn,{open:N,ip:p.ipv4Address,onClose:E,onSave:V}),e.jsx(Ln,{open:B,onClose:d,onSave:f}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(Z,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},id:"matterbridgeInfo-mode",children:"Matterbridge mode:"}),e.jsxs(rr,{row:!0,name:"mode-buttons-group",value:a,onChange:y,children:[e.jsx(Te,{value:"bridge",control:e.jsx(St,{}),label:"Bridge",disabled:o.readOnly===!0}),e.jsx(Te,{value:"childbridge",control:e.jsx(St,{}),label:"Childbridge",disabled:o.readOnly===!0})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},id:"mblogger-level-label",children:"Logger level:"}),e.jsxs(rt,{style:{height:"30px"},labelId:"mblogger-level-label",id:"mblogger-level",value:v,onChange:D,children:[e.jsx(P,{value:"Debug",children:"Debug"}),e.jsx(P,{value:"Info",children:"Info"}),e.jsx(P,{value:"Notice",children:"Notice"}),e.jsx(P,{value:"Warn",children:"Warn"}),e.jsx(P,{value:"Error",children:"Error"}),e.jsx(P,{value:"Fatal",children:"Fatal"})]}),e.jsx(Te,{style:{padding:"0px",margin:"0px"},control:e.jsx(We,{checked:s,onChange:X,name:"logOnFileMb"}),label:"Log on file:",labelPlacement:"start"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},id:"frontend-theme-label",children:"Frontend theme:"}),e.jsxs(rt,{style:{height:"30px"},labelId:"frontend-theme-label",id:"frontend-theme",value:W,onChange:he,children:[e.jsx(P,{value:"classic",children:"Classic"}),e.jsx(P,{value:"light",children:"Light"}),e.jsx(P,{value:"dark",children:"Dark"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},id:"frontend-home-plugin-label",children:"Home page plugins:"}),e.jsx(We,{checked:F,onChange:C,name:"showPlugins"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},id:"frontend-home-label",children:"Home page bottom panel:"}),e.jsxs(rt,{style:{height:"30px"},labelId:"frontend-home-label",id:"frontend-home",value:j,onChange:m,children:[e.jsx(P,{value:"logs",children:"Logs"}),e.jsx(P,{value:"devices",children:"Devices"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"10px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},id:"frontend-virtual-label",children:"Virtual devices:"}),e.jsxs(rt,{style:{height:"30px"},labelId:"frontend-virtual-label",id:"frontend-virtual",value:u,onChange:_,children:[e.jsx(P,{value:"disabled",children:"Disabled"}),e.jsx(P,{value:"outlet",children:"Outlet"}),e.jsx(P,{value:"light",children:"Light"}),e.jsx(P,{value:"switch",children:"Switch"}),e.jsx(P,{value:"mounted_switch",children:"Mounted Switch"})]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"20px"},children:e.jsx(oe,{variant:"contained",color:"primary",onClick:()=>Y(!0),children:"Change password"})}),o.shellyBoard&&e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"20px"},children:e.jsx(oe,{variant:"contained",color:"primary",onClick:()=>O(!0),children:"Configure IP"})})]})})]})}function On({matterbridgeInfo:o}){const{sendMessage:p,getUniqueId:i}=r.useContext(fe),[n,a]=r.useState("Info"),[x,v]=r.useState(!1),[t,s]=r.useState(""),[S,W]=r.useState(""),[b,F]=r.useState(""),[H,j]=r.useState(),[$,u]=r.useState(),[L,h]=r.useState(),N=r.useRef(i());r.useEffect(()=>{o.bridgeMode!==void 0&&(a(["Debug","Info","Notice","Warn","Error","Fatal"][o.matterLoggerLevel]),v(o.matterFileLogger),s(o.matterMdnsInterface),W(o.matterIpv4Address),F(o.matterIpv6Address),j(o.matterPort),u(o.matterDiscriminator),h(o.matterPasscode))},[o]);const O=D=>{l&&console.log("handleChangeMjLoggerLevel called with value:",D.target.value),a(D.target.value),p({id:N.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmjloglevel",value:D.target.value}})},E=D=>{l&&console.log("handleLogOnFileMjChange called with value:",D.target.checked),v(D.target.checked),p({id:N.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmjlogfile",value:D.target.checked}})},V=D=>{l&&console.log("handleChangeMdnsInterface called with value:",D.target.value),s(D.target.value),p({id:N.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmdnsinterface",value:D.target.value}})},B=D=>{l&&console.log("handleChangeIpv4Address called with value:",D.target.value),W(D.target.value),p({id:N.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setipv4address",value:D.target.value}})},Y=D=>{l&&console.log("handleChangeIpv6Address called with value:",D.target.value),F(D.target.value),p({id:N.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setipv6address",value:D.target.value}})},d=D=>{l&&console.log("handleChangeMatterPort called with value:",D.target.value),j(D.target.value),p({id:N.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterport",value:D.target.value}})},f=D=>{l&&console.log("handleChangeMatterDiscriminator called with value:",D.target.value),u(D.target.value),p({id:N.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterdiscriminator",value:D.target.value}})},y=D=>{l&&console.log("handleChangemMatterPasscode called with value:",D.target.value),h(D.target.value),p({id:N.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterpasscode",value:D.target.value}})};return e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matter settings"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(Z,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},id:"mjdebug-info",children:"Logger level:"}),e.jsxs(rt,{style:{height:"30px"},labelId:"select-mjlevel",id:"mjdebug-level",value:n,onChange:O,children:[e.jsx(P,{value:"Debug",children:"Debug"}),e.jsx(P,{value:"Info",children:"Info"}),e.jsx(P,{value:"Notice",children:"Notice"}),e.jsx(P,{value:"Warn",children:"Warn"}),e.jsx(P,{value:"Error",children:"Error"}),e.jsx(P,{value:"Fatal",children:"Fatal"})]}),e.jsx(Te,{style:{padding:"0px",margin:"0px"},control:e.jsx(We,{checked:x,onChange:E,name:"logOnFileMj"}),label:"Log on file:",labelPlacement:"start"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},children:"Mdns interface:"}),e.jsx(pe,{value:t,onChange:V,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:o.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},children:"Ipv4 address:"}),e.jsx(pe,{value:S,onChange:B,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:o.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},children:"Ipv6 address:"}),e.jsx(pe,{value:b,onChange:Y,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:o.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},children:"Commissioning port:"}),e.jsx(pe,{value:H,onChange:d,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:o.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},children:"Commissioning discriminator:"}),e.jsx(pe,{value:$,onChange:f,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:o.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(ke,{style:{padding:"0px",margin:"0px"},children:"Commissioning passcode:"}),e.jsx(pe,{value:L,onChange:y,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:o.readOnly===!0,style:{height:"30px",padding:"0"}}})]})]})})]})}function $n({matterbridgeInfo:o}){return e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge info"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(Z,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:["          ",e.jsx(qe,{value:o.matterbridgeVersion,label:"Current Version"}),e.jsx(qe,{value:o.matterbridgeLatestVersion,label:"Latest Version"}),e.jsx(qe,{value:o.homeDirectory,label:"Home Directory"}),e.jsx(qe,{value:o.rootDirectory,label:"Root Directory"}),e.jsx(qe,{value:o.matterbridgeDirectory,label:"Matterbridge Storage Directory"}),e.jsx(qe,{value:o.matterbridgePluginDirectory,label:"Matterbridge Plugin Directory"}),e.jsx(qe,{value:o.globalModulesDirectory,label:"Global Module Directory"})]})})]})}function qe({value:o,label:p}){return e.jsx(pe,{focused:!0,value:o,size:"small",label:p,variant:"standard",sx:{width:"400px"},InputProps:{readOnly:!0,sx:{color:"var(--div-text-color)","&:before":{borderBottomColor:"var(--main-label-color)"},"&:after":{borderBottomColor:"var(--main-label-color)"}}},InputLabelProps:{sx:{marginTop:"3px",color:"var(--main-label-color)","&.Mui-focused":{color:"var(--main-label-color)"}}}})}function En(o,p,i){const n=o?.[i],a=p?.[i];return n==null&&a==null?0:n==null?-1:a==null?1:typeof n=="boolean"&&typeof a=="boolean"?n===a?0:n?1:-1:typeof n=="number"&&typeof a=="number"?n-a:String(n).localeCompare(String(a))}const Vn=r.memo(function({name:p,columns:i,rows:n,getRowKey:a,footerLeft:x,footerRight:v}){const t=r.useRef(new WeakMap),s=r.useRef(1),S=d=>{if(typeof a=="string"&&d&&d[a]!=null)return d[a];if(typeof a=="function"){const D=a(d);if(D!=null)return D}const f=i?.[0]?.id;if(f&&d&&d[f]!=null)return d[f];console.warn(`MbfTable(${p}): using fallback stable row key; consider providing getRowKey prop for better React performance`);let y=t.current.get(d);return y||(y=`rk_${s.current++}`,t.current.set(d,y)),y},{_showConfirmCancelDialog:W}=r.useContext(ot),[b,F]=r.useState(localStorage.getItem(`${p}_table_order_by`)||null),[H,j]=r.useState(localStorage.getItem(`${p}_table_order`)||null),[$,u]=r.useState(!1),[L,h]=r.useState(()=>{try{const d=localStorage.getItem(`${p}_column_visibility`);if(d)return JSON.parse(d)}catch{}return{}}),N=r.useMemo(()=>{const d={};for(const f of i)f.hidden||(d[f.id]=f.required?!0:L[f.id]!==!1);return d},[i,L]),O=r.useMemo(()=>{if(!b||!H)return n;const d=i.find(y=>y.id===b);if(!d||d.nosort)return n;const f=n.map((y,D)=>({el:y,index:D}));return f.sort((y,D)=>{const X=En(y.el,D.el,b);return X!==0?H==="asc"?X:-X:y.index-D.index}),f.map(y=>y.el)},[n,b,H,i]),E=d=>{if(b!==d||!b){F(d),j("asc"),localStorage.setItem(`${p}_table_order_by`,d),localStorage.setItem(`${p}_table_order`,"asc");return}if(H==="asc"){j("desc"),localStorage.setItem(`${p}_table_order`,"desc");return}F(null),j(null),localStorage.removeItem(`${p}_table_order_by`),localStorage.removeItem(`${p}_table_order`)},V=()=>{u(!$)},B=d=>{h(f=>{const y=i.find(he=>he.id===d);if(y&&y.required)return f;const D=N[d]!==!1,X={...f};D?X[d]=!1:delete X[d];try{localStorage.setItem(`${p}_column_visibility`,JSON.stringify(X))}catch{}return X})},Y=()=>{const d={};h(d);try{localStorage.setItem(`${p}_column_visibility`,JSON.stringify(d))}catch{}};return console.log(`Rendering table ${p}${b&&H?` ordered by ${b}:${H}`:""}`),e.jsxs("div",{style:{display:"flex",flexDirection:"column",margin:"0",padding:"0",gap:"0",width:"100%",flex:"1 1 auto",height:"100%",minHeight:0,overflow:"hidden"},children:[e.jsxs(Ie,{open:$,onClose:(d,f)=>{f==="backdropClick"||f==="escapeKeyDown"||V()},disableEscapeKeyDown:!0,disableRestoreFocus:!0,children:[e.jsx(De,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:`Configure ${p} columns`})]})}),e.jsx(Ne,{children:e.jsx(at,{children:i.filter(d=>!d.hidden).map(d=>e.jsx(Te,{control:e.jsx(We,{disabled:!!d.required,checked:d.required?!0:N[d.id]!==!1,onChange:()=>B(d.id)}),label:d.label},d.id))})}),e.jsxs(Pe,{children:[e.jsx(oe,{onClick:Y,children:"Reset"}),e.jsx(oe,{variant:"contained",onClick:d=>{if(d?.currentTarget&&typeof d.currentTarget.blur=="function")try{d.currentTarget.blur()}catch{}const f=document.activeElement;if(f&&f instanceof HTMLElement&&typeof f.blur=="function")try{f.blur()}catch{}V()},children:"Close"})]})]}),e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",minHeight:"30px",justifyContent:"space-between",borderBottom:"none"},children:[e.jsx("p",{className:"MbfWindowHeaderText",children:p}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(z,{onClick:d=>{if(d?.currentTarget?.blur)try{d.currentTarget.blur()}catch{}V()},"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(R,{title:`Configure ${p} columns`,children:e.jsx(te,{path:Wo,size:"20px",style:{color:"var(--header-text-color)"}})})})})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",flex:"1 1 auto",minHeight:0,width:"100%",overflow:"auto",margin:"0px",padding:"0px",gap:"0"},children:e.jsxs("table",{"aria-label":`${p} table`,style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,border:"none",color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color"},children:e.jsx("tr",{style:{height:"30px",minHeight:"30px"},children:i.map(d=>{if(d.hidden||!d.required&&N[d.id]===!1)return null;const f=!d.nosort,y=f&&b===d.id&&!!H;return e.jsxs("th",{onClick:f?()=>E(d.id):void 0,style:{margin:"0",padding:"4px 8px",position:"sticky",top:0,minWidth:d.minWidth,maxWidth:d.maxWidth,textAlign:d.align||"left",cursor:f?"pointer":"default",border:"none",color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color)",whiteSpace:d.maxWidth?"nowrap":void 0,overflow:d.maxWidth?"hidden":void 0,textOverflow:d.maxWidth?"ellipsis":void 0},"aria-sort":f?y?H==="asc"?"ascending":"descending":"none":void 0,children:[d.label,y&&e.jsxs("span",{style:{marginLeft:6},children:[H==="asc"&&e.jsx(te,{path:Wt,size:"15px"}),H==="desc"&&e.jsx(te,{path:Tt,size:"15px"})]})]},d.id)})})}),e.jsx("tbody",{children:O.map((d,f)=>{const y=S(d);return e.jsx("tr",{className:f%2===0?"table-content-even":"table-content-odd",style:{height:"30px",minHeight:"30px",border:"none",borderCollapse:"collapse"},children:i.map(D=>{if(D.hidden||!D.required&&N[D.id]===!1)return null;const X=d[D.id];return e.jsx("td",{style:{border:"none",borderCollapse:"collapse",textAlign:D.align||"left",padding:"4px 8px",margin:"0",maxWidth:D.maxWidth,whiteSpace:D.maxWidth?"nowrap":void 0,overflow:D.maxWidth?"hidden":void 0,textOverflow:D.maxWidth?"ellipsis":void 0},children:typeof D.render=="function"?D.render(X,y,d,D):typeof X=="boolean"?e.jsx(We,{checked:X,disabled:!0,size:"small",sx:{m:0,p:0,color:"var(--table-text-color)","&.Mui-disabled":{color:"var(--table-text-color)",opacity:.7}}}):D.format&&typeof X=="number"?D.format(X):X??""},D.id)})},y)})})]})}),e.jsxs("div",{className:"MbfWindowFooter",style:{height:"30px",minHeight:"30px",justifyContent:"space-between",border:"none"},children:[e.jsx("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)"},children:x}),e.jsx("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)"},children:v})]})]})});function _n(){const{online:o,sendMessage:p,addListener:i,removeListener:n,getUniqueId:a}=r.useContext(fe),{showSnackbarMessage:x,closeSnackbarMessage:v}=r.useContext(ot),[t,s]=r.useState(null),[S,W]=r.useState([]),[b,F]=r.useState([]),[H,j]=r.useState([]),[$,u]=r.useState(null),[L,h]=r.useState(null),[N,O]=r.useState(null),E=r.useRef(null),[V,B]=r.useState(()=>sr);E.current||(E.current=a(),console.log("Test uniqueId:",E)),r.useEffect(()=>{console.log("Test useEffect WebSocketMessage mounting");const d=f=>{if(f.src==="Matterbridge"&&f.dst==="Frontend"){if(f.method==="restart_required"&&(console.log("Test received restart_required"),x("Restart required",0)),f.method==="refresh_required"&&(console.log(`Test received refresh_required: changed=${f.params.changed} and sending api requests`),x("Refresh required",0),p({id:E.current,method:"/api/settings",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),p({id:E.current,method:"/api/plugins",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),p({id:E.current,method:"/api/devices",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}})),f.method==="memory_update"&&(console.log("Test received memory_update",f),h(f.params)),f.method==="cpu_update"&&(console.log("Test received cpu_update",f),u(f.params)),f.method==="uptime_update"&&(console.log("Test received uptime_update",f),O(f.params)),f.method==="/api/settings"&&f.response&&(console.log("Test received /api/settings:",f.response),x("Test received /api/settings"),s(f.response)),f.method==="/api/plugins"&&f.response&&(console.log(`Test received ${f.response.length} plugins:`,f.response),x("Test received /api/plugins"),W(f.response)),f.method==="/api/devices"&&f.response){console.log(`Test received ${f.response.length} devices:`,f.response),x("Test received /api/devices"),F(f.response);for(let y of f.response)console.log("Test sending /api/clusters for device:",y.pluginName,y.name,y.endpoint),p({method:"/api/clusters",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{plugin:y.pluginName,endpoint:y.endpoint}})}f.method==="/api/clusters"&&(console.log(`Test received ${f.response.length} clusters for device ${f.deviceName} endpoint ${f.endpoint}:`,f),x("Test received /api/clusters"),j(f.response))}else console.log("Test received WebSocketMessage:",f.method,f.src,f.dst,f.response)};return i(d),console.log("Test useEffect WebSocketMessage mounted"),()=>{console.log("Test useEffect WebSocketMessage unmounting"),n(d),console.log("Test useEffect WebSocketMessage unmounted")}},[i,n,p,x]),r.useEffect(()=>(console.log("Test useEffect online mounting"),o&&(console.log("Test useEffect online received online"),p({method:"/api/settings",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),p({method:"/api/plugins",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),p({method:"/api/devices",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}})),console.log("Test useEffect online mounted"),()=>{console.log("Test useEffect online unmounted")}),[o,p,x]);const Y=r.useCallback(d=>d.code,[]);return console.log("Test rendering..."),o?e.jsx("div",{className:"MbfPageDiv",style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"20px",width:"100%"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"256px",width:"256px",margin:"10px"}}),e.jsx("p",{children:"Welcome to the Test page of the Matterbridge frontend"}),e.jsx("div",{style:{margin:"0",padding:"0",gap:"0",width:"1200px",maxWidth:"1200px",height:"600px",maxHeight:"600px",overflow:"hidden",border:"1px solid #0004ffff"},children:e.jsx(Vn,{name:"Test",columns:An,rows:V,getRowKey:Y,footerLeft:"Left Footer",footerRight:"Right Footer"})}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx(oe,{variant:"contained",color:"primary",onClick:()=>{console.log("Test button clicked"),x("Test button clicked"),v("Refresh required"),v("Restart required"),v("Test permanent message removal")},children:"Test"}),e.jsx(oe,{variant:"outlined",onClick:()=>{B(d=>{const f=d.findIndex(he=>he.code==="F123");if(f===-1)return d;const y=d[f],D={...y,population:(y.population||0)+1},X=d.slice();return X[f]=D,X})},children:"Update F123"})]})]})}):e.jsx(Je,{})}const An=[{id:"name",label:"Name",minWidth:50,maxWidth:100,required:!0},{id:"code",label:"ISO Code",minWidth:100,render:(o,p)=>e.jsx("span",{style:{display:"inline-block",padding:"2px 6px",borderRadius:"8px",backgroundColor:"var(--chip-bg, #e6f4ff)",color:"var(--chip-fg, #0550ae)",fontFamily:'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',fontSize:"0.85em"},children:String(o)})},{id:"isIsland",label:"Island",minWidth:80,align:"center"},{id:"population",label:"Population",minWidth:170,align:"right",format:o=>o.toLocaleString("en-US")},{id:"size",label:"Size (km²)",minWidth:170,align:"right",format:o=>o.toLocaleString("en-US")},{id:"density",label:"Density",minWidth:170,align:"right",nosort:!0,format:o=>o.toFixed(2)},{id:"virtual",label:"Virtual",align:"right",required:!0,nosort:!0,render:(o,p,i)=>i.isIsland?"🏝️":"🏞️"}];function Ce(o,p,i,n,a){const x=i/n;return{name:o,code:p,population:i,size:n,density:x,isIsland:a}}const sr=[Ce("India","IN",1324171354,3287263,!1),Ce("China","CN",1403500365,9596961,!1),Ce("Italy","IT",60483973,301340,!1),Ce("United States","US",327167434,9833520,!1),Ce("Canada is a truly wonderful country","CA",37602103,9984670,!1),Ce("Australia","AU",25475400,7692024,!0),Ce("Germany","DE",83019200,357578,!1),Ce("Ireland","IE",4857e3,70273,!0),Ce("Mexico","MX",126577691,1972550,!1),Ce("Japan","JP",126317e3,377973,!0),Ce("France","FR",67022e3,640679,!1),Ce("United Kingdom","GB",67545757,242495,!0),Ce("Russia","RU",146793744,17098246,!1),Ce("Nigeria","NG",200962417,923768,!1),Ce("Brazil","BR",210147125,8515767,!1)],Gt=["Zor","Eld","Myth","Drak","Lum","Xen","Thal","Quor","Vex","Nyx"],Kt=["aria","dor","mere","land","wyn","gard","heim","quess","tor","vale"];for(let o=0;o<2e3;o++){const p=`${Gt[o%Gt.length]}${Kt[o%Kt.length]} ${o}`,i=`F${o.toString().padStart(3,"0")}`,n=Math.floor(Math.random()*1e9),a=Math.floor(Math.random()*1e7),x=Math.random()<.2;sr.push(Ce(p,i,n,a,x))}function Un(o,p){l&&console.log("getCssVariable:",o,"defaultValue",p);const i=getComputedStyle(document.body).getPropertyValue(o).trim();return i||console.error("getCssVariable: undefined",i),i||p}function zn(o){return so({palette:{primary:{main:o},action:{disabled:"var(--main-label-color)"},text:{disabled:"var(--main-label-color)"}},typography:{fontFamily:"Roboto, Helvetica, Arial, sans-serif"},components:{MuiDialog:{styleOverrides:{paper:{color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",border:"2px solid var(--div-border-color)",borderRadius:"var(--div-border-radius)",boxShadow:"2px 2px 5px var(--div-shadow-color)"}}},MuiTooltip:{defaultProps:{placement:"top-start",arrow:!0}},MuiButton:{styleOverrides:{root:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)","&:hover":{backgroundColor:"var(--main-button-bg-color)"},"&.Mui-disabled":{color:"var(--main-button-color)",backgroundColor:"var(--main-grey-color)"}},contained:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},outlined:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},text:{color:"var(--main-button-color)"}},defaultProps:{variant:"contained",size:"small"}},MuiIconButton:{styleOverrides:{root:{color:"var(--main-icon-color)","&:hover .MuiSvgIcon-root":{color:"var(--primary-color)"}}}},MuiCheckbox:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-checked":{color:"var(--primary-color)"}}}},MuiTextField:{defaultProps:{size:"small",variant:"outlined",fullWidth:!0}},MuiOutlinedInput:{styleOverrides:{root:{backgroundColor:"var(--div-bg-color)","& .MuiOutlinedInput-notchedOutline":{borderColor:"var(--main-label-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--main-text-color)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"var(--primary-color)"},padding:"0px"},input:{color:"var(--div-text-color)",padding:"4px 8px"}}},MuiInputLabel:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-focused":{color:"var(--primary-color)"}}}},MuiFormLabel:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-focused":{color:"var(--main-label-color)"}}}},MuiFormControl:{styleOverrides:{root:{color:"var(--main-grey-color)"}}},MuiRadio:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-checked":{color:"var(--primary-color)"}}}},MuiSelect:{styleOverrides:{root:{backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)",height:"30px","&:hover":{borderColor:"var(--main-text-color)"},"&.Mui-focused":{borderColor:"var(--primary-color)"}}}},MuiMenu:{styleOverrides:{paper:{backgroundColor:"var(--main-menu-bg-color)",padding:"0px",margin:"0px"},list:{padding:"0px"}}},MuiMenuItem:{styleOverrides:{root:{color:"var(--main-menu-color)",backgroundColor:"var(--main-menu-bg-color)","&:hover":{backgroundColor:"var(--main-menu-hover-color)"},"&.Mui-selected":{color:"var(--main-menu-color)",backgroundColor:"var(--main-menu-bg-color)"},"&.Mui-selected:hover":{backgroundColor:"var(--main-menu-hover-color)"}}}},MuiListItemButton:{styleOverrides:{root:{cursor:"pointer","&:hover":{backgroundColor:"var(--main-bg-color)"}}}},MuiListItemIcon:{styleOverrides:{root:{color:"var(--div-text-color)"}}},MuiListItemText:{styleOverrides:{primary:{fontSize:"16px",fontWeight:"bold",color:"var(--div-text-color)"},secondary:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"}}}}})}let l=!1;const qn=()=>{l=!l},lr=r.createContext(void 0);function Bn({children:o}){const[p,i]=r.useState(!1),[n,a]=r.useState(""),x=async v=>{try{const t=await fetch("./api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:v})});if(t.ok){const{valid:s}=await t.json();s?i(!0):v!==""&&a("Incorrect password!")}else console.error("Failed to log in:",t.statusText)}catch(t){console.error("Failed to log in:",t)}};return e.jsx(lr.Provider,{value:{loggedIn:p,logIn:x,errorMessage:n},children:o})}function Jn(){const[o,p]=r.useState(""),i=r.useContext(lr),[n,a]=r.useState("#1976d2");if(!i)throw new Error("AuthContext not found");const{loggedIn:x,logIn:v,errorMessage:t}=i,s=j=>{j.preventDefault(),v(o)},S={display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",backgroundColor:"var(--main-bg-color)"},W={display:"flex",flexDirection:"column",maxWidth:"400px",margin:"0 auto",padding:"20px",gap:"20px",border:"1px solid var(--div-border-color)",borderRadius:"var(--div-border-radius)",boxShadow:"2px 2px 5px var(--div-shadow-color)",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},b={margin:"10px 0",padding:"3px 3px",fontSize:"14px",width:"230px",border:"1px solid var(--main-label-color)",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"};r.useEffect(()=>{l&&console.log("Setting frontend theme");const j=localStorage.getItem("frontendTheme");l&&console.log("Saved theme:",j),j?document.body.setAttribute("frontend-theme",j):document.body.setAttribute("frontend-theme","dark");const $=Un("--primary-color","#1976d2");l&&console.log("Primary color from CSS:",$),a($)},[]);const F=window.location.pathname.includes("/matterbridge/")?"/matterbridge":window.location.href.includes("/api/hassio_ingress/")?window.location.pathname:"/";console.log(`Loading App.js with href="${window.location.href}" and pathname="${window.location.pathname}" >>> baseName="${F}"`);const H=zn(n);return v(""),x?e.jsx(lo,{theme:H,children:e.jsx(vr,{dense:!0,maxSnack:10,preventDuplicate:!0,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(Uo,{children:e.jsx(zo,{children:e.jsx(gr,{basename:F,children:e.jsxs("div",{className:"MbfScreen",children:[e.jsx(qo,{}),e.jsxs(hr,{children:[e.jsx(Ye,{path:"/",element:e.jsx(mn,{})}),e.jsx(Ye,{path:"/devices",element:e.jsx(Tn,{})}),e.jsx(Ye,{path:"/log",element:e.jsx(Wn,{})}),e.jsx(Ye,{path:"/settings",element:e.jsx(Rn,{})}),e.jsx(Ye,{path:"/test",element:e.jsx(_n,{})}),e.jsx(Ye,{path:"*",element:e.jsx(xr,{to:"/"})})]})]})})})})})}):e.jsx("div",{style:S,children:e.jsxs("form",{onSubmit:s,style:W,children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"64px",width:"64px"}}),e.jsx("h3",{style:{color:"var(--div-text-color)"},children:"Welcome to Matterbridge"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:"20px"},children:[e.jsx("input",{type:"text",name:"username",autoComplete:"username",style:{display:"none"},tabIndex:-1}),e.jsx("input",{type:"password",value:o,onChange:j=>p(j.target.value),style:b,placeholder:"password",autoComplete:"current-password"}),e.jsx("button",{type:"submit",style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",borderColor:"var(--div-bg-color)"},children:"Log in"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",margin:0,height:"30px"},children:t&&e.jsx("p",{style:{color:"red"},children:t})})]})})}function Qn(){return e.jsx(Bn,{children:e.jsx(Jn,{})})}fr.createRoot(document.getElementById("root")).render(e.jsx(Ee.StrictMode,{children:e.jsx(Qn,{})}));
