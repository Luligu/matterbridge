import{B as e,y as o,S as at,U as xr,V as br,X as Ke,Y as vr,Z as yr,I as jr}from"./vendor_node_modules.js";import{u as Cr,S as Sr}from"./vendor_notistack.js";import{D as Pe,a as We,b as Fe,B as oe,c as K,A as wr,I as U,C as Mr,T as H,S as kr,F as Yt,H as Ir,d as Xt,e as Ve,R as bt,P as ze,M as Dr,f as et,g as W,L as B,h as X,i as st,V as lt,j as Re,k as Dt,l as Nr,m as Pr,n as ce,o as Wr,p as Fr,q as vt,r as ae,s as $e,K as Lt,t as Rt,u as jt,v as dt,w as ot,x as ct,W as nt,y as pt,z as ut,E as _e,G as Ht,J as $t,N as Tr,O as Lr,Q as Wt,U as He,X as Zt,Y as it,Z as Rr,_ as Hr,$ as $r,a0 as Or,a1 as er,a2 as yt,a3 as Er,a4 as _r,a5 as Vr,a6 as Ar,a7 as Ot,a8 as Ur,a9 as zr,aa as qr,ab as Br,ac as Qr,ad as Jr,ae as Gr,af as Et,ag as Kr,ah as Yr,ai as Xr,aj as Zr,ak as eo,al as to,am as ro,an as oo,ao as no,ap as io,aq as ao,ar as so,as as lo,at as co,au as po,av as _t,aw as tt,ax as tr,ay as Ie,az as rr,aA as Ct,aB as Ae,aC as uo,aD as mo}from"./vendor_mui.js";import{Q as go}from"./vendor_qrcode.js";import{I as te,m as Vt,a as ho,b as fo,c as At,d as xo,e as bo,f as or,g as nr,h as vo,i as yo,j as jo,k as Co,l as So,n as wo,o as Mo,p as ko,q as Ut,r as Io,s as Do,t as No,u as Po,v as Wo,w as Fo,x as To,y as Lo,z as zt,A as Ro,B as Ho}from"./vendor_mdi.js";import{F as $o,v as Oo,e as Eo,a as _o,g as Vo,b as Ao,c as Uo,d as Nt,A as zo}from"./vendor_rjsf.js";import{r as St}from"./vendor_react_table.js";import"./vendor_lodash.js";import"./vendor_emotion.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const f of l)if(f.type==="childList")for(const j of f.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&n(j)}).observe(document,{childList:!0,subtree:!0});function s(l){const f={};return l.integrity&&(f.integrity=l.integrity),l.referrerPolicy&&(f.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?f.credentials="include":l.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function n(l){if(l.ep)return;l.ep=!0;const f=s(l);fetch(l.href,f)}})();/**
 * This file contains the types for WebSocket messages.
 *
 * @file frontendTypes.ts
 * @author Luca Liguori
 * @created 2025-09-17
 * @version 1.0.0
 * @license Apache-2.0
 *
 * Copyright 2025, 2026, 2027 Luca Liguori.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Me=(r=>(r[r.Log=0]="Log",r[r.RefreshRequired=1]="RefreshRequired",r[r.RestartRequired=2]="RestartRequired",r[r.RestartNotRequired=3]="RestartNotRequired",r[r.CpuUpdate=4]="CpuUpdate",r[r.MemoryUpdate=5]="MemoryUpdate",r[r.UptimeUpdate=6]="UptimeUpdate",r[r.Snackbar=7]="Snackbar",r[r.UpdateRequired=8]="UpdateRequired",r[r.StateUpdate=9]="StateUpdate",r[r.CloseSnackbar=10]="CloseSnackbar",r[r.ShellySysUpdate=100]="ShellySysUpdate",r[r.ShellyMainUpdate=101]="ShellyMainUpdate",r))(Me||{});function le(r){return r.id>=0&&r.id<=101}function De(r){return r.id>101&&r.src==="Matterbridge"&&r.dst==="Frontend"&&("success"in r||"error"in r)}function qo({open:r,title:c,message:s,onConfirm:n,onCancel:l}){const f=t=>{a&&console.log("Confirmed"),t.preventDefault(),n()},j=t=>{a&&console.log("Canceled"),t.preventDefault(),l()};return e.jsxs(Pe,{open:r,children:[e.jsx(We,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:c})]})}),e.jsxs(Fe,{children:[e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",margin:"0",marginBottom:"20px",maxHeight:"350px",maxWidth:"350px"},children:e.jsx("p",{style:{flex:1,margin:"0"},children:s})}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-around"},children:[e.jsx(oe,{onClick:f,variant:"contained",color:"primary",size:"small",children:"Confirm"}),e.jsx(oe,{onClick:j,variant:"contained",color:"primary",size:"small",children:"Cancel"})]})]})]})}const mt=[],rt=o.createContext(null);function Bo({children:r}){const{enqueueSnackbar:c,closeSnackbar:s}=Cr(),n=o.useCallback(v=>{a&&console.log(`UiProvider closeSnackbarMessage: message ${v}`);const k=mt.findIndex(P=>P.message===v);k!==-1&&(s(mt[k].key),mt.splice(k,1),a&&console.log(`UiProvider closeSnackbarMessage: message ${v} removed from persistMessages`))},[s]),l=o.useCallback((v,k,P)=>{a&&console.log(`UiProvider showSnackbarMessage: message ${v} timeout ${k}`);const D=c(v,{variant:"default",autoHideDuration:k==null||k>0?(k??5)*1e3:null,persist:k===0,content:h=>e.jsx(K,{sx:{margin:"0",padding:"0",width:"300px",marginRight:"30px"},children:e.jsx(wr,{severity:P??"info",variant:"filled",sx:{color:"#fff",fontWeight:"normal",width:"100%",cursor:"pointer",padding:"0px 10px"},onClick:()=>s(h),action:e.jsx(U,{size:"small",onClick:()=>s(h),sx:{color:"#fff"},children:e.jsx(Mr,{fontSize:"small"})}),children:v},h)},h)});k===0&&(a&&console.log(`UiProvider showSnackbarMessage: message ${v} timeout ${k} - persist key ${D}`),mt.push({message:v,key:D}))},[c,s]),[f,j]=o.useState(!1),[t,d]=o.useState(""),[N,T]=o.useState(""),[w,R]=o.useState(""),_=o.useRef(null),S=o.useRef(null),$=()=>{a&&console.log(`UiProvider handle confirm action ${w}`),j(!1),_.current&&_.current(w)},p=()=>{a&&console.log(`UiProvider handle cancel action ${w}`),j(!1),S.current&&S.current(w)},V=o.useCallback((v,k,P,D,h)=>{a&&console.log(`UiProvider showConfirmCancelDialog for command ${P}`),d(v),T(k),R(P),_.current=D,S.current=h,j(!0)},[]),b=o.useMemo(()=>({showSnackbarMessage:l,closeSnackbarMessage:n,closeSnackbar:s,showConfirmCancelDialog:V}),[l,n,s,V]);return e.jsxs(rt.Provider,{value:b,children:[e.jsx(qo,{open:f,title:t,message:N,onConfirm:$,onCancel:p}),r]})}const ir=o.createContext(null),xe=o.createContext(null);function Qo({children:r}){const[c,s]=o.useState(localStorage.getItem("logFilterLevel")??"info"),[n,l]=o.useState(localStorage.getItem("logFilterSearch")??"*"),[f,j]=o.useState([]),[t,d]=o.useState(1e3),[N,T]=o.useState(!0),[w,R]=o.useState(!1),{showSnackbarMessage:_,closeSnackbarMessage:S,closeSnackbar:$}=o.useContext(rt),p=o.useRef([]),V=o.useRef(null),b=o.useRef(1),v=o.useRef(Math.floor(Math.random()*999e3)+1e3),k=o.useRef(null),P=o.useRef(null),D=o.useRef(null),h=o.useRef(c),L=o.useRef(n),m=o.useMemo(()=>window.location.href.replace(/^http/,"ws"),[]),i=o.useMemo(()=>window.location.href.includes("api/hassio_ingress"),[]),u=100,C=60,Z=50,de=300;o.useEffect(()=>{h.current=c},[c]),o.useEffect(()=>{L.current=n},[n]);const be=o.useCallback(()=>Math.floor(Math.random()*999e3)+1e3,[]),ve=o.useCallback(I=>{if(V.current&&V.current.readyState===WebSocket.OPEN)try{I.id===void 0&&(I.id=v.current);const g=JSON.stringify(I);V.current.send(g),a&&console.log("WebSocket sent message:",I)}catch(g){a&&console.error(`WebSocket error sending message: ${g}`)}else a&&console.error("WebSocket message not sent, WebSocket not connected:",I)},[]),pe=o.useCallback((I,g)=>{const re=`<span style="background-color: #5c0e91; color: white; padding: 1px 5px; font-size: 12px; border-radius: 3px;">${I}</span>`;j(J=>[...J,re+' <span style="color: var(--main-log-color);">'+g+"</span>"])},[]),Q=o.useCallback((I,g)=>{s(I),l(g),pe("WebSocket",`Filtering by log level "${I}" and log search "${g}"`)},[pe]),ne=o.useCallback(I=>{a&&console.log("WebSocket addListener:",I),p.current=[...p.current,I],a&&console.log("WebSocket addListener total listeners:",p.current.length)},[]),F=o.useCallback(I=>{a&&console.log("WebSocket removeListener:",I),p.current=p.current.filter(g=>g!==I),a&&console.log("WebSocket removeListener total listeners:",p.current.length)},[]),O=o.useCallback(()=>{m===""||m===null||m===void 0||(pe("WebSocket",`Connecting to WebSocket: ${m}`),V.current=new WebSocket(m),V.current.onmessage=I=>{w||R(!0);try{const g=JSON.parse(I.data);if(g.id===void 0)return;if(g.error&&a&&console.error("WebSocket error message:",g),g.id===v.current&&g.src==="Matterbridge"&&g.dst==="Frontend"&&g.response==="pong"){a&&console.log("WebSocket pong response message:",g,"listeners:",p.current.length),P.current&&clearTimeout(P.current),p.current.forEach(J=>J(g));return}if(g.id===Me.RefreshRequired){a&&console.log("WebSocket WS_ID_REFRESH_REQUIRED message:",g,"listeners:",p.current.length),p.current.forEach(J=>J(g));return}else if(g.id===Me.RestartRequired){a&&console.log("WebSocket WS_ID_RESTART_REQUIRED message:",g,"listeners:",p.current.length),p.current.forEach(J=>J(g));return}else if(g.id===Me.RestartNotRequired){a&&console.log("WebSocket WS_ID_RESTART_NOT_REQUIRED message:",g,"listeners:",p.current.length),p.current.forEach(J=>J(g));return}else if(g.id===Me.CpuUpdate){a&&console.log("WebSocket WS_ID_CPU_UPDATE message:",g,"listeners:",p.current.length),p.current.forEach(J=>J(g));return}else if(g.id===Me.MemoryUpdate){a&&console.log("WebSocket WS_ID_MEMORY_UPDATE message:",g,"listeners:",p.current.length),p.current.forEach(J=>J(g));return}else if(g.id===Me.UptimeUpdate){a&&console.log("WebSocket WS_ID_UPTIME_UPDATE message:",g,"listeners:",p.current.length),p.current.forEach(J=>J(g));return}else if(g.id===Me.Snackbar&&g.params&&g.params.message){a&&console.log("WebSocket WS_ID_SNACKBAR message:",g,"listeners:",p.current.length),_(g.params.message,g.params.timeout,g.params.severity);return}else if(g.id===Me.CloseSnackbar&&g.params&&g.params.message){a&&console.log("WebSocket WS_ID_CLOSE_SNACKBAR message:",g,"listeners:",p.current.length),S(g.params.message);return}else if(g.id===Me.ShellySysUpdate){a&&console.log("WebSocket WS_ID_SHELLY_SYS_UPDATE message:",g,"listeners:",p.current.length),p.current.forEach(J=>J(g));return}else if(g.id===Me.ShellyMainUpdate){a&&console.log("WebSocket WS_ID_SHELLY_MAIN_UPDATE message:",g,"listeners:",p.current.length),p.current.forEach(J=>J(g));return}else if(g.id!==Me.Log){a&&console.log("WebSocket message:",g,"listeners:",p.current.length),p.current.forEach(J=>J(g));return}if(!g.params||!g.params.level||!g.params.time||!g.params.name||!g.params.message||["debug","info","notice","warn","error","fatal"].includes(g.params.level)&&(h.current==="info"&&g.params.level==="debug"||h.current==="notice"&&(g.params.level==="debug"||g.params.level==="info")||h.current==="warn"&&(g.params.level==="debug"||g.params.level==="info"||g.params.level==="notice")||h.current==="error"&&(g.params.level==="debug"||g.params.level==="info"||g.params.level==="notice"||g.params.level==="warn")||h.current==="fatal"&&(g.params.level==="debug"||g.params.level==="info"||g.params.level==="notice"||g.params.level==="warn"||g.params.level==="error"))||L.current!=="*"&&L.current!==""&&!g.params.message.toLowerCase().includes(L.current.toLowerCase())&&!g.params.name.toLowerCase().includes(L.current.toLowerCase())||g.params.name==="Commissioning"&&g.params.message.includes("is uncommissioned"))return;j(J=>{const ue=`<span style="color: #505050;">[${g.params?.time}]</span>`,ge=ye=>{switch(ye?.toLowerCase()){case"debug":return"gray";case"info":return"#267fb7";case"notice":return"green";case"warn":return"#e9db18";case"error":return"red";case"fatal":return"#ff0000";case"spawn":return"#ff00d0";default:return"lightblue"}},A=ye=>{switch(ye?.toLowerCase()){case"warn":return"black";default:return"white"}},he=`${`<span style="background-color: ${ge(g.params?.level)}; color: ${A(g.params?.level)}; padding: 1px 5px; font-size: 12px; border-radius: 3px;">${g.params?.level}</span>`} ${ue} <span style="color: #09516d;">[${g.params?.name}]</span> <span style="color: var(--main-log-color);">${g.params?.message}</span>`,ee=[...J,he];return ee.length>t?ee.slice(t/10):ee})}catch(g){console.error(`WebSocketUse error parsing message: ${g}`)}},V.current.onopen=()=>{a&&console.log(`WebSocket: Connected to WebSocket: ${m}`),pe("WebSocket",`Connected to WebSocket: ${m}`),R(!0),$(),b.current=1,D.current=setTimeout(()=>{k.current=setInterval(()=>{ve({id:v.current,method:"ping",src:"Frontend",dst:"Matterbridge",params:{}}),P.current&&clearTimeout(P.current),P.current=setTimeout(()=>{a&&console.error(`WebSocketUse: No pong response received from WebSocket: ${m}`),pe("WebSocket",`No pong response received from WebSocket: ${m}`),R(!1)},1e3*Z)},1e3*C)},1e3*de)},V.current.onclose=()=>{a&&console.error(`WebSocket: Disconnected from WebSocket ${i?"with Ingress":""}: ${m}`),pe("WebSocket",`Disconnected from WebSocket: ${m}`),R(!1),$(),D.current&&clearTimeout(D.current),P.current&&clearTimeout(P.current),k.current&&clearInterval(k.current),pe("WebSocket",`Reconnecting (attempt ${b.current} of ${u}) to WebSocket${i?" (Ingress)":""}: ${m}`),i?setTimeout(x,5e3):b.current===1?x():b.current<u?setTimeout(x,1e3*b.current):pe("WebSocket",`Reconnect attempts exceeded limit of ${u} retries, refresh the page to reconnect to: ${m}`),b.current=b.current+1},V.current.onerror=I=>{a&&console.error(`WebSocket: WebSocket error connecting to ${m}:`,I),pe("WebSocket",`WebSocket error connecting to ${m}`)})},[m]),x=o.useCallback(()=>{a&&console.log(`WebSocket attemptReconnect ${b.current}/${u} to:`,m),O()},[O]);o.useEffect(()=>(O(),()=>{V.current&&V.current.readyState===WebSocket.OPEN&&V.current.close()}),[O]);const y=o.useMemo(()=>({messages:f,maxMessages:t,autoScroll:N,setMessages:j,setLogFilters:Q,setMaxMessages:d,setAutoScroll:T}),[f,j,Q]),M=o.useMemo(()=>({maxMessages:t,autoScroll:N,logFilterLevel:c,logFilterSearch:n,setMessages:j,setLogFilters:Q,setMaxMessages:d,setAutoScroll:T,online:w,retry:b.current,getUniqueId:be,addListener:ne,removeListener:F,sendMessage:ve,logMessage:pe}),[t,N,j,Q,d,T,w,b.current,ne,F,ve,pe]);return e.jsx(ir.Provider,{value:y,children:e.jsx(xe.Provider,{value:M,children:r})})}function Jo(){const{showSnackbarMessage:r,showConfirmCancelDialog:c}=o.useContext(rt),{online:s,sendMessage:n,logMessage:l,addListener:f,removeListener:j,getUniqueId:t}=o.useContext(xe),[d,N]=o.useState(!1),[T,w]=o.useState(!1),[R,_]=o.useState(!1),[S,$]=o.useState(!1),[p,V]=o.useState(null),b=o.useRef(t()),[v,k]=o.useState(null),[P,D]=o.useState(null),[h,L]=o.useState(null),[m,i]=o.useState(null),[u,C]=o.useState(null),Z=()=>{window.open("https://www.buymeacoffee.com/luligugithub","_blank")},de=()=>{window.open("https://github.com/Luligu/matterbridge/blob/main/README.md","_blank")},be=()=>{p?.matterbridgeInformation.matterbridgeVersion.includes("-dev-")?window.open("https://github.com/Luligu/matterbridge/blob/dev/CHANGELOG.md","_blank"):window.open("https://github.com/Luligu/matterbridge/blob/main/CHANGELOG.md","_blank")},ve=()=>{window.open("https://discord.gg/QX58CDe6hd","_blank")},pe=()=>{window.open("https://github.com/Luligu/matterbridge","_blank")},Q=()=>{n({id:b.current,sender:"Header",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:"matterbridge",restart:!0}})},ne=()=>{n({id:b.current,sender:"Header",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:"matterbridge@dev",restart:!0}})},F=()=>{n({id:b.current,sender:"Header",method:"/api/checkupdates",src:"Frontend",dst:"Matterbridge",params:{}})},O=()=>{a&&console.log("Header: handleShellySystemUpdateClick"),l("Matterbridge","Installing system updates..."),n({id:b.current,sender:"Header",method:"/api/shellysysupdate",src:"Frontend",dst:"Matterbridge",params:{}})},x=()=>{a&&console.log("Header: handleShellyMainUpdateClick"),l("Matterbridge","Installing software updates..."),n({id:b.current,sender:"Header",method:"/api/shellymainupdate",src:"Frontend",dst:"Matterbridge",params:{}})},y=()=>{a&&console.log("Header: handleShellyCreateSystemLog"),n({id:b.current,sender:"Header",method:"/api/shellycreatesystemlog",src:"Frontend",dst:"Matterbridge",params:{}})},M=()=>{a&&console.log("Header: handleShellyDownloadSystemLog"),l("Matterbridge","Downloading Shelly system log..."),r("Downloading Shelly system log...",5),window.location.href="./api/shellydownloadsystemlog"},I=()=>{p?.matterbridgeInformation.restartMode===""?n({id:b.current,sender:"Header",method:"/api/restart",src:"Frontend",dst:"Matterbridge",params:{}}):n({id:b.current,sender:"Header",method:"/api/shutdown",src:"Frontend",dst:"Matterbridge",params:{}})},g=()=>{n({id:b.current,sender:"Header",method:"/api/shutdown",src:"Frontend",dst:"Matterbridge",params:{}})},re=()=>{n({id:b.current,sender:"Header",method:"/api/reboot",src:"Frontend",dst:"Matterbridge",params:{}})},J=()=>{n({id:b.current,sender:"Header",method:"/api/softreset",src:"Frontend",dst:"Matterbridge",params:{}})},ue=()=>{n({id:b.current,sender:"Header",method:"/api/hardreset",src:"Frontend",dst:"Matterbridge",params:{}})},ge=z=>{k(z.currentTarget)},A=z=>{a&&console.log("Header: handleMenuClose",z),k(null),z==="download-mblog"?(l("Matterbridge","Downloading matterbridge log..."),r("Downloading matterbridge log...",5),window.location.href="./api/download-mblog"):z==="download-mjlog"?(l("Matterbridge","Downloading matter log..."),r("Downloading matter log...",5),window.location.href="./api/download-mjlog"):z==="view-mblog"?(l("Matterbridge","Loading matterbridge log..."),r("Loading matterbridge log...",5),window.location.href="./api/view-mblog"):z==="view-mjlog"?(l("Matterbridge","Loading matter log..."),r("Loading matter log...",5),window.location.href="./api/view-mjlog"):z==="view-shellylog"?(l("Matterbridge","Loading shelly system log..."),r("Loading shelly system log...",5),window.location.href="./api/shellyviewsystemlog"):z==="download-mbstorage"?(l("Matterbridge","Downloading matterbridge storage..."),r("Downloading matterbridge storage...",5),window.location.href="./api/download-mbstorage"):z==="download-pluginstorage"?(l("Matterbridge","Downloading matterbridge plugins storage..."),r("Downloading matterbridge plugins storage...",5),window.location.href="./api/download-pluginstorage"):z==="download-pluginconfig"?(l("Matterbridge","Downloading matterbridge plugins config..."),r("Downloading matterbridge plugins config...",5),window.location.href="./api/download-pluginconfig"):z==="download-mjstorage"?(l("Matterbridge","Downloading matter storage..."),r("Downloading matter storage...",5),window.location.href="./api/download-mjstorage"):z==="download-backup"?(l("Matterbridge","Downloading backup..."),r("Downloading backup...",10),window.location.href="./api/download-backup"):z==="update"?Q():z==="updatedev"?ne():z==="updatecheck"?F():z==="shelly-sys-update"?O():z==="shelly-main-update"?x():z==="shelly-create-system-log"?y():z==="shelly-download-system-log"?M():z==="softreset"?J():z==="hardreset"?ue():z==="restart"?I():z==="shutdown"?g():z==="reboot"?re():z==="create-backup"?n({id:b.current,sender:"Header",method:"/api/create-backup",src:"Frontend",dst:"Matterbridge",params:{}}):z==="unregister"?n({id:b.current,sender:"Header",method:"/api/unregister",src:"Frontend",dst:"Matterbridge",params:{}}):z==="reset"?n({id:b.current,sender:"Header",method:"/api/reset",src:"Frontend",dst:"Matterbridge",params:{}}):z==="factoryreset"&&n({id:b.current,sender:"Header",method:"/api/factoryreset",src:"Frontend",dst:"Matterbridge",params:{}})},se=z=>{a&&console.log("Header: handleMenuCloseCancel:",z),k(null)},he=z=>{D(z.currentTarget)},ee=()=>{D(null)},ye=z=>{L(z.currentTarget)},ie=()=>{L(null)},fe=z=>{i(z.currentTarget)},G=()=>{i(null)},me=z=>{C(z.currentTarget)},je=()=>{C(null)},Qe=()=>{Zn(),a&&console.log("Matterbridge logo clicked: debug is now",a)};return o.useEffect(()=>{const z=Y=>{Y.src==="Matterbridge"&&Y.dst==="Frontend"&&(De(Y)&&Y.method==="/api/settings"&&Y.id===b.current&&(a&&console.log("Header received settings:",Y.response),V(Y.response),N(Y.response.matterbridgeInformation.restartRequired||Y.response.matterbridgeInformation.fixedRestartRequired),w(Y.response.matterbridgeInformation.fixedRestartRequired),_(Y.response.matterbridgeInformation.updateRequired)),le(Y)&&Y.method==="refresh_required"&&Y.params.changed==="settings"&&(a&&console.log(`Header received refresh_required: changed=${Y.params.changed} and sending /api/settings request`),n({id:b.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),le(Y)&&Y.method==="restart_required"&&(a&&console.log(`Header received restart_required with fixed: ${Y.params.fixed}`),N(!0),Y.params.fixed===!0&&w(!0)),le(Y)&&Y.method==="restart_not_required"&&(a&&console.log("Header received restart_not_required"),N(!1)),le(Y)&&Y.method==="update_required"&&(a&&console.log("Header received update_required"),_(!0),n({id:b.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),le(Y)&&Y.method==="update_required_dev"&&(a&&console.log("Header received update_required_dev"),$(!0),n({id:b.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),le(Y)&&Y.id===Me.ShellySysUpdate&&(a&&console.log("Header received WS_ID_SHELLY_SYS_UPDATE:"),V(Ne=>Ne?{matterbridgeInformation:{...Ne.matterbridgeInformation,shellySysUpdate:Y.params.available},systemInformation:Ne.systemInformation}:null)),le(Y)&&Y.id===Me.ShellyMainUpdate&&(a&&console.log("Header received WS_ID_SHELLY_MAIN_UPDATE:"),V(Ne=>Ne?{matterbridgeInformation:{...Ne.matterbridgeInformation,shellyMainUpdate:Y.params.available},systemInformation:Ne.systemInformation}:null)))};return f(z),a&&console.log(`Header added WebSocket listener id ${b.current}`),()=>{j(z),a&&console.log("Header removed WebSocket listener")}},[f,j,n,r]),o.useEffect(()=>{s&&(a&&console.log("Header sending /api/settings requests"),n({id:b.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}))},[s,n]),a&&console.log("Header rendering..."),!s||!p?null:e.jsxs("div",{className:"header",children:[e.jsxs("div",{className:"sub-header",children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"30px"},onClick:Qe}),e.jsx("h2",{style:{fontSize:"22px",color:"var(--main-icon-color)",margin:"0px"},children:"Matterbridge"}),e.jsxs("nav",{children:[e.jsx(at,{to:"/",className:"nav-link",children:"Home"}),e.jsx(at,{to:"/devices",className:"nav-link",children:"Devices"}),e.jsx(at,{to:"/log",className:"nav-link",children:"Logs"}),e.jsx(at,{to:"/settings",className:"nav-link",children:"Settings"})]})]}),e.jsxs("div",{className:"sub-header",children:[!p.matterbridgeInformation.readOnly&&R&&e.jsx(H,{title:"New Matterbridge version available, click to install",children:e.jsxs("span",{className:"status-warning",onClick:Q,children:["Update to v.",p.matterbridgeInformation.matterbridgeLatestVersion]})}),!p.matterbridgeInformation.readOnly&&S&&e.jsx(H,{title:"New Matterbridge dev version available, click to install",children:e.jsxs("span",{className:"status-warning",onClick:ne,children:["Update to new dev v.",p.matterbridgeInformation.matterbridgeDevVersion.split("-dev-")[0]]})}),!p.matterbridgeInformation.readOnly&&e.jsx(H,{title:"Matterbridge version, click to see the changelog",children:e.jsxs("span",{className:"status-information",onClick:be,children:["v.",p.matterbridgeInformation.matterbridgeVersion]})}),p.matterbridgeInformation.shellyBoard&&e.jsx("img",{src:"Shelly.svg",alt:"Shelly Icon",style:{height:"30px",padding:"0px",margin:"0px",marginRight:"30px"}}),p.matterbridgeInformation.bridgeMode!==""&&p.matterbridgeInformation.readOnly===!1?e.jsx(H,{title:"Bridge mode",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:p.matterbridgeInformation.bridgeMode})}):null,p.matterbridgeInformation.restartMode!==""&&p.matterbridgeInformation.readOnly===!1?e.jsx(H,{title:"Restart mode",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:p.matterbridgeInformation.restartMode})}):null,p.matterbridgeInformation.profile&&p.matterbridgeInformation.profile!==""&&p.matterbridgeInformation.readOnly===!1?e.jsx(H,{title:"Current profile",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:p.matterbridgeInformation.profile})}):null]}),e.jsxs("div",{className:"sub-header",style:{gap:"5px"},children:[p.matterbridgeInformation.readOnly===!1?e.jsx(H,{title:"Matterbridge discord group",children:e.jsx("img",{src:"discord.svg",alt:"Discord Logo",style:{cursor:"pointer",height:"25px"},onClick:ve})}):null,p.matterbridgeInformation.readOnly===!1?e.jsx(H,{title:"Give a star to Matterbridge",children:e.jsx(U,{style:{color:"#FFD700",margin:"0",padding:"0"},onClick:pe,children:e.jsx(kr,{})})}):null,p.matterbridgeInformation.readOnly===!1?e.jsx(H,{title:"Sponsor Matterbridge",children:e.jsx(U,{style:{color:"#b6409c",margin:"0",padding:"0"},onClick:Z,children:e.jsx(Yt,{})})}):null,e.jsx(H,{title:"Matterbridge help",children:e.jsx(U,{style:{color:"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:de,children:e.jsx(Ir,{})})}),e.jsx(H,{title:"Matterbridge changelog",children:e.jsx(U,{style:{color:"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:be,children:e.jsx(Xt,{})})}),p.matterbridgeInformation&&!p.matterbridgeInformation.readOnly&&e.jsx(H,{title:"Update matterbridge to latest version",children:e.jsx(U,{style:{color:R?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:Q,children:e.jsx(Ve,{})})}),p.matterbridgeInformation&&p.matterbridgeInformation.shellyBoard&&p.matterbridgeInformation.shellySysUpdate&&e.jsx(H,{title:"Shelly system update",children:e.jsx(U,{style:{color:"var(--primary-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:O,children:e.jsx(Ve,{})})}),p.matterbridgeInformation&&p.matterbridgeInformation.shellyBoard&&p.matterbridgeInformation.shellyMainUpdate&&e.jsx(H,{title:"Shelly software update",children:e.jsx(U,{style:{color:"var(--primary-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:x,children:e.jsx(Ve,{})})}),e.jsx(H,{title:"Restart matterbridge",children:e.jsx(U,{style:{color:d||T?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:I,children:e.jsx(bt,{})})}),p.matterbridgeInformation.restartMode===""?e.jsx(H,{title:"Shut down matterbridge",children:e.jsx(U,{style:{color:d||T?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:g,children:e.jsx(ze,{})})}):null,e.jsx(H,{title:"Download, backup and more",children:e.jsx(U,{onClick:ge,children:e.jsx(Dr,{style:{color:"var(--main-icon-color)"}})})}),e.jsxs(et,{id:"command-menu",anchorEl:v,keepMounted:!0,open:!!v,onClose:()=>A(""),children:[p.matterbridgeInformation&&!p.matterbridgeInformation.readOnly&&e.jsxs(W,{onClick:()=>A("update"),children:[e.jsx(B,{children:e.jsx(Ve,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Install latest stable",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),p.matterbridgeInformation&&!p.matterbridgeInformation.readOnly&&e.jsxs(W,{onClick:()=>A("updatedev"),children:[e.jsx(B,{children:e.jsx(Ve,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Install latest dev",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),p.matterbridgeInformation&&!p.matterbridgeInformation.readOnly&&e.jsxs(W,{onClick:()=>A("updatecheck"),children:[e.jsx(B,{children:e.jsx(Ve,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Check for updates",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),p.matterbridgeInformation&&p.matterbridgeInformation.shellyBoard&&p.matterbridgeInformation.shellySysUpdate&&e.jsxs(W,{onClick:()=>A("shelly-sys-update"),children:[e.jsx(B,{children:e.jsx(Ve,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Shelly system update",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),p.matterbridgeInformation&&p.matterbridgeInformation.shellyBoard&&p.matterbridgeInformation.shellyMainUpdate&&e.jsxs(W,{onClick:()=>A("shelly-main-update"),children:[e.jsx(B,{children:e.jsx(Ve,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Shelly software update",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(W,{onClick:()=>A("restart"),children:[e.jsx(B,{children:e.jsx(bt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Restart",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),p.matterbridgeInformation.restartMode===""?e.jsxs(W,{onClick:()=>A("shutdown"),children:[e.jsx(B,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Shutdown",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}):null,p.matterbridgeInformation&&p.matterbridgeInformation.shellyBoard&&e.jsxs(W,{onClick:()=>{c("Reboot","Are you sure you want to reboot the Shelly board?","reboot",A,se)},children:[e.jsx(B,{children:e.jsx(bt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Reboot...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsx(st,{}),e.jsxs(W,{onClick:ye,children:[e.jsx(B,{children:e.jsx(lt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"View",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(et,{id:"sub-menu-view",anchorEl:h,keepMounted:!0,open:!!h,onClose:ie,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(W,{onClick:()=>{A("view-mblog"),ie()},children:[e.jsx(B,{children:e.jsx(lt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Matterbridge log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(W,{onClick:()=>{A("view-mjlog"),ie()},children:[e.jsx(B,{children:e.jsx(lt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Matter log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),p.matterbridgeInformation&&p.matterbridgeInformation.shellyBoard&&e.jsxs(W,{onClick:()=>{A("view-shellylog"),ie()},children:[e.jsx(B,{children:e.jsx(lt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(st,{}),e.jsxs(W,{onClick:fe,children:[e.jsx(B,{children:e.jsx(Re,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Download",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(et,{id:"sub-menu-download",anchorEl:m,keepMounted:!0,open:!!m,onClose:G,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(W,{onClick:()=>{A("download-mbstorage"),G()},children:[e.jsx(B,{children:e.jsx(Re,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Matterbridge storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(W,{onClick:()=>{A("download-pluginstorage"),G()},children:[e.jsx(B,{children:e.jsx(Re,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Matterbridge plugins storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(W,{onClick:()=>{A("download-pluginconfig"),G()},children:[e.jsx(B,{children:e.jsx(Re,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Matterbridge plugins config",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(W,{onClick:()=>{A("download-mblog"),G()},children:[e.jsx(B,{children:e.jsx(Re,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Matterbridge log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(W,{onClick:()=>{A("download-mjstorage"),G()},children:[e.jsx(B,{children:e.jsx(Re,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Matter storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(W,{onClick:()=>{A("download-mjlog"),G()},children:[e.jsx(B,{children:e.jsx(Re,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Matter log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),p.matterbridgeInformation&&p.matterbridgeInformation.shellyBoard&&e.jsxs(W,{onClick:()=>{A("shelly-create-system-log"),G()},children:[e.jsx(B,{children:e.jsx(Re,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Create Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),p.matterbridgeInformation&&p.matterbridgeInformation.shellyBoard&&e.jsxs(W,{onClick:()=>{A("shelly-download-system-log"),G()},children:[e.jsx(B,{children:e.jsx(Re,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Download Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(st,{}),e.jsxs(W,{onClick:he,children:[e.jsx(B,{children:e.jsx(Dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(et,{id:"sub-menu-backup",anchorEl:P,keepMounted:!0,open:!!P,onClose:ee,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(W,{onClick:()=>{A("create-backup"),ee()},children:[e.jsx(B,{children:e.jsx(Dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Create backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(W,{onClick:()=>{A("download-backup"),ee()},children:[e.jsx(B,{children:e.jsx(Dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Download backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(st,{}),e.jsxs(W,{onClick:me,children:[e.jsx(B,{children:e.jsx(Nr,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Reset",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(et,{id:"sub-menu-reset",anchorEl:u,keepMounted:!0,open:!!u,onClose:je,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(W,{onClick:()=>{je(),c("Reset all devices and shutdown","Are you sure you want to unregister all devices? This will temporarily remove all devices from the controller and you may loose the controller configuration.","unregister",A,se)},children:[e.jsx(B,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Reset all devices...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(W,{onClick:()=>{je(),c("Reset commissioning and shutdown","Are you sure you want to reset the commissioning? You will have to manually remove Matterbridge from the controller.","reset",A,se)},children:[e.jsx(B,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Reset commissioning...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),!p.matterbridgeInformation.readOnly&&e.jsxs(W,{onClick:()=>{je(),c("Factory reset and shutdown","Are you sure you want to factory reset Matterbridge? You will have to manually remove Matterbridge from the controller.","factoryreset",A,se)},children:[e.jsx(B,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Factory reset...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),p.matterbridgeInformation&&p.matterbridgeInformation.shellyBoard&&e.jsxs(W,{onClick:()=>{je(),c("Network reset","Are you sure you want to factory reset the network parameters?","softreset",A,se)},children:[e.jsx(B,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Reset network...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),p.matterbridgeInformation&&p.matterbridgeInformation.shellyBoard&&e.jsxs(W,{onClick:()=>{je(),c("Factory reset","Are you sure you want to factory reset Matterbridge? You will have to manually remove Matterbridge from the controller.","hardreset",A,se)},children:[e.jsx(B,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(X,{primary:"Factory reset...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]})]})]})]})}const Go=o.memo(Jo),Ko=()=>"ontouchstart"in window||typeof window.DocumentTouch<"u"&&document instanceof window.DocumentTouch?(a&&console.log("WebSocketLogs detectTouchscreen = true"),!0):(a&&console.log("WebSocketLogs detectTouchscreen = false"),!1);function Yo(){const{messages:r,autoScroll:c}=o.useContext(ir),[s,n]=o.useState(!1),l=o.useRef(null),f=o.useMemo(()=>Ko(),[]),j=d=>n(!0),t=d=>n(!1);return o.useEffect(()=>{a&&console.log(`WebSocketLogs autoScroll: ${c} isHovering: ${s}`),c&&!s&&!f&&l.current?.scrollIntoView({behavior:"smooth"})},[r,s,c,f]),e.jsx("div",{style:{margin:"0px",padding:"0px"},children:e.jsxs("ul",{style:{margin:"0px",padding:"0px"},onMouseEnter:j,onMouseLeave:t,children:[r.map((d,N)=>e.jsx("li",{style:{wordWrap:"break-word",maxHeight:"200px",overflow:"hidden"},dangerouslySetInnerHTML:{__html:d}},N)),e.jsx("div",{ref:l})]})})}const ar=o.memo(Yo);function Be(){const{retry:r}=o.useContext(xe),c=()=>{window.location.reload()};return e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",fontSize:"20px",flexDirection:"column",color:"var(--main-text-color)",height:"100vh",backgroundColor:"var(--main-bg-color)"},children:e.jsx(K,{sx:{display:"flex",alignItems:"center",flexDirection:"column"},children:r<100?e.jsxs(e.Fragment,{children:[e.jsx(Pr,{style:{color:"var(--primary-color)"}}),e.jsxs("div",{style:{marginTop:"20px",color:"var(--primary-color)"},children:["Reconnecting to Matterbridge ","(attempt "+r+")","..."]})]}):e.jsxs("div",{style:{marginTop:"20px",color:"var(--primary-color)",textAlign:"center"},children:["Unable to connect to Matterbridge after multiple attempts.",e.jsx("br",{}),"Please check your network connection.",e.jsx("br",{}),e.jsx(oe,{variant:"contained",color:"primary",onClick:c,style:{marginTop:"20px"},children:"Refresh the Page"})]})})})}function Xo({value:r,maxChars:c}){let s=r;if(r.length>c&&c>3){const n=c-3,l=r.substring(0,Math.ceil(n/2)),f=r.substring(r.length-Math.floor(n/2),r.length);s=`${l} … ${f}`}return r!==s?e.jsx(H,{title:r,placement:"top",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[0,12]}}]}},children:e.jsx("span",{children:s})}):e.jsx("span",{children:s})}function Zo({systemInfo:r,compact:c}){const[s,n]=o.useState(r),{sendMessage:l,addListener:f,removeListener:j}=o.useContext(xe);if(a&&console.log("SystemInfoTable:",s,"compact:",c),r&&c&&s.totalMemory&&s.freeMemory){const t=s.totalMemory,d=s.freeMemory;s.freeMemory=`${d} / ${t}`,s.totalMemory=""}if(r&&c&&s.heapTotal&&s.heapUsed){const t=s.heapTotal,d=s.heapUsed;s.heapUsed=`${d} / ${t}`,s.heapTotal=""}if(r&&c&&s.osRelease&&s.osType){const t=s.osType,d=s.osRelease;s.osType=`${t} (${d})`,s.osRelease=""}if(r&&c&&s.osArch&&s.osPlatform){const t=s.osPlatform,d=s.osArch;s.osPlatform=`${t} (${d})`,s.osArch=""}return o.useEffect(()=>{const t=d=>{d.src==="Matterbridge"&&d.dst==="Frontend"&&(le(d)&&d.method==="memory_update"&&d.params&&d.params.totalMemory&&d.params.freeMemory&&d.params.heapTotal&&d.params.heapUsed&&d.params.rss&&(a&&console.log("SystemInfoTable received memory_update",d),(s.totalMemory!==d.params?.totalMemory||s.freeMemory!==d.params?.freeMemory||s.heapTotal!==d.params?.heapTotal||s.heapUsed!==d.params?.heapUsed||s.rss!==d.params?.rss)&&n(N=>({...N,totalMemory:d.params?.totalMemory?d.params.totalMemory:"",freeMemory:d.params?.freeMemory?d.params.freeMemory:"",heapTotal:d.params?.heapTotal?d.params.heapTotal:"",heapUsed:d.params?.heapUsed?d.params.heapUsed:"",rss:d.params?.rss?d.params.rss:""}))),le(d)&&d.method==="cpu_update"&&d.params&&d.params.cpuUsage&&(a&&console.log("SystemInfoTable received cpu_update",d),s.cpuUsage!==(d.params?.cpuUsage?d.params.cpuUsage.toFixed(2)+" %":"")&&n(N=>({...N,cpuUsage:d.params?.cpuUsage?d.params.cpuUsage.toFixed(2)+" %":""}))),le(d)&&d.method==="uptime_update"&&d.params&&d.params.systemUptime&&d.params.processUptime&&(a&&console.log("SystemInfoTable received uptime_update",d),(s.systemUptime!==d.params?.systemUptime||s.processUptime!==d.params?.processUptime)&&n(N=>({...N,systemUptime:d.params?.systemUptime?d.params.systemUptime:"",processUptime:d.params?.processUptime?d.params.processUptime:""}))))};return a&&console.log("SystemInfoTable useEffect WebSocketMessage mounting"),f(t),a&&console.log("SystemInfoTable useEffect WebSocketMessage mounted"),()=>{a&&console.log("SystemInfoTable useEffect WebSocketMessage unmounting"),j(t),a&&console.log("SystemInfoTable useEffect WebSocketMessage unmounted")}},[f,s.cpuUsage,s.freeMemory,s.heapTotal,s.heapUsed,s.processUptime,s.rss,s.systemUptime,s.totalMemory,j,l]),s?(a&&console.log("SystemInfoTable rendering..."),e.jsxs("div",{className:"MbfWindowDiv",style:{minWidth:"302px",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"System Information"})}),e.jsx("div",{className:"MbfWindowDivTable",children:e.jsx("table",{style:{border:"none",borderCollapse:"collapse"},children:e.jsx("tbody",{style:{border:"none",borderCollapse:"collapse"},children:Object.entries(s).filter(([t,d])=>d!==void 0&&d!=="").map(([t,d],N)=>e.jsxs("tr",{className:N%2===0?"table-content-even":"table-content-odd",style:{border:"none",borderCollapse:"collapse"},children:[e.jsx("td",{style:{border:"none",borderCollapse:"collapse"},children:t}),e.jsx("td",{style:{border:"none",borderCollapse:"collapse"},children:e.jsx(Xo,{value:typeof d!="string"?d.toString():d,maxChars:25})})]},t))})})})]})):null}const en=o.memo(Zo),qt={margin:"0px",padding:"0px",color:"var(--div-text-color)",transition:"color 0.2s ease","& svg":{display:"block"},"& svg path":{fill:"var(--div-text-color)",transition:"fill 0.2s ease"},"&:hover":{color:"var(--primary-color)"},"&:hover svg path":{fill:"var(--primary-color)"},"&:focus-visible":{outline:"2px solid var(--primary-color)",outlineOffset:"2px"}},tn=r=>{if(!r)return"";const c=r.toString().replace(/[^0-9]/g,"");if(c.length<5)return c;const s=c.slice(0,4),n=c.slice(4,7),l=c.slice(7,11);return[s,n,l].filter(Boolean).join("-")};function rn({id:r}){const{online:c,sendMessage:s,addListener:n,removeListener:l,getUniqueId:f}=o.useContext(xe),[j,t]=o.useState(null),[d,N]=o.useState(null),T=o.useRef(null),w=o.useRef(f()),{showConfirmCancelDialog:R}=o.useContext(rt);o.useEffect(()=>{a&&console.log(`QRDiv received storeId update "${r}"`),r&&(a&&console.log(`QRDiv sending data request for storeId "${r}"`),t(r),s({id:w.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:r,server:!0}}))},[r]),o.useEffect(()=>{const b=v=>{v.src==="Matterbridge"&&v.dst==="Frontend"&&le(v)&&v.id===Me.RefreshRequired&&v.params.changed==="matter"&&v.params.matter&&(a&&console.log(`QRDiv received refresh_required: changed=${v.params.changed} for storeId "${v.params.matter.id}":`,v.params.matter),j===v.params.matter.id&&(a&&console.log(`QRDiv received refresh_required/matter: setting matter data for storeId "${v.params.matter.id}":`,v.params.matter),T.current&&clearTimeout(T.current),v.params.matter.advertising&&v.params.matter.advertiseTime&&v.params.matter.advertiseTime+9e5<=Date.now()&&(v.params.matter.advertising=!1),N(v.params.matter),v.params.matter.advertising&&(a&&console.log(`QRDiv setting matter advertise timeout for storeId "${v.params.matter.id}":`,v.params.matter.advertiseTime+9e5-Date.now()),T.current=setTimeout(()=>{T.current&&clearTimeout(T.current),a&&console.log(`QRDiv clearing advertising state for storeId "${j}" after 15 minutes`),N(k=>k&&{...k,advertising:!1})},v.params.matter.advertiseTime+9e5-Date.now()))))};return n(b),a&&console.log("QRDiv webSocket effect mounted"),()=>{l(b),T.current&&clearTimeout(T.current),a&&console.log("QRDiv webSocket effect unmounted")}},[j]);const _=()=>{a&&console.log(`QRDiv sent matter startCommission for node "${d?.id}"`),d&&s({id:w.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:d.id,startCommission:!0}})},S=()=>{a&&console.log(`QRDiv sent matter stopCommission for node "${d?.id}"`),d&&s({id:w.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:d.id,stopCommission:!0}})},$=()=>{a&&console.log(`QRDiv sent matter advertise for node "${d?.id}"`),d&&s({id:w.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:d.id,advertise:!0}})},p=b=>{a&&console.log(`QRDiv sent matter removeFabric for node "${d?.id}" and fabricIndex ${b}`),d&&s({id:w.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:d.id,removeFabric:b}})},V=async()=>{if(!d||!d.manualPairingCode)return;const b=d.manualPairingCode.toString();try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(b);else{const v=document.createElement("textarea");v.value=b,v.style.position="fixed",v.style.opacity="0",document.body.appendChild(v),v.focus(),v.select(),document.execCommand("copy"),document.body.removeChild(v)}a&&console.log("Manual pairing code copied to clipboard")}catch(v){console.error("Failed to copy manual pairing code",v)}};return!d||!c?(a&&console.log("QRDiv rendering undefined state"),null):d.online?d.advertising&&d.qrPairingCode&&d.manualPairingCode?(a&&console.log("QRDiv rendering advertising state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"QR pairing code"}),e.jsxs("div",{className:"MbfWindowHeaderFooterIcons",children:[e.jsx(U,{"aria-label":"send advertising",size:"small",onClick:$,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(H,{title:"Send again the mDNS advertisement",arrow:!0,children:e.jsx(te,{path:Vt,size:"22px"})})}),e.jsx(U,{"aria-label":"stop pairing",size:"small",onClick:S,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(H,{title:"Turn off pairing",arrow:!0,children:e.jsx(te,{path:ho,size:"22px"})})})]})]}),e.jsx("p",{className:"MbfWindowHeaderText",style:{overflow:"hidden",maxWidth:"280px",textOverflow:"ellipsis",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:j}),e.jsx(go,{value:d.qrPairingCode,size:256,level:"M",fgColor:"var(--div-text-color)",bgColor:"var(--div-bg-color)",style:{margin:"20px"}}),e.jsxs("div",{className:"MbfWindowFooter",style:{justifyContent:"space-between"},children:[e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Manual pairing code: ",tn(d.manualPairingCode)]}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(H,{title:"Copy manual pairing code",arrow:!0,children:e.jsx(U,{"aria-label":"copy manual pairing code",size:"small",onClick:V,sx:qt,children:e.jsx(te,{path:fo,size:.85})})})})]})]})):d.commissioned&&d.fabricInformations&&d.sessionInformations?(a&&console.log("QRDiv rendering commissioned state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px",overflow:"hidden"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Paired fabrics"}),e.jsxs("div",{className:"MbfWindowHeaderFooterIcons",children:[e.jsx(U,{"aria-label":"send advertising",size:"small",onClick:$,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(H,{title:"Send again the mDNS advertisement",arrow:!0,children:e.jsx(te,{path:Vt,size:"22px"})})}),e.jsx(U,{"aria-label":"start pairing",size:"small",onClick:_,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(H,{title:"Turn on pairing",arrow:!0,children:e.jsx(te,{path:At,size:"22px"})})})]})]}),e.jsxs("div",{className:"MbfWindowBodyColumn",style:{paddingTop:"0px"},children:[e.jsx("p",{className:"MbfWindowHeaderText thin-scroll",style:{overflowX:"auto",maxWidth:"280px",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:j}),d.fabricInformations.map((b,v)=>e.jsxs("div",{style:{margin:"0px",padding:"10px",gap:"0px",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",textAlign:"left",fontSize:"14px"},children:[e.jsxs("div",{style:{marginLeft:"20px",marginBottom:"10px",display:"flex",flexDirection:"row",justifyContent:"space-between",gap:"20px",alignItems:"center"},children:[e.jsxs("p",{className:"status-blue",style:{margin:"0px",padding:"3px 10px",width:"200px",fontSize:"14px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},children:["Fabric: ",b.fabricIndex]}),e.jsx(H,{title:"Remove the fabric. You will also need to remove it from the controller.",arrow:!0,children:e.jsx(U,{"aria-label":"remove the fabric",size:"small",onClick:()=>R("Remove fabric","Are you sure you want to remove this fabric? You will also need to remove it from the controller.","RemoveFabric",()=>p(b.fabricIndex),()=>{}),sx:{...qt,padding:"2px"},children:e.jsx(te,{path:xo,size:1})})})]}),e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Vendor: ",b.rootVendorId," ",b.rootVendorName]}),b.label!==""&&e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Label: ",b.label]}),e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Sessions: ",d.sessionInformations?d.sessionInformations.filter(k=>k.fabric?.fabricIndex===b.fabricIndex&&k.isPeerActive===!0).length:"0"," ","subscriptions: ",d.sessionInformations?d.sessionInformations.filter(k=>k.fabric?.fabricIndex===b.fabricIndex&&k.isPeerActive===!0&&k.numberOfActiveSubscriptions>0).length:"0"]})]},v))]}),e.jsx("div",{className:"MbfWindowFooter",children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Serial number: ",d.serialNumber]})})]})):!d.commissioned&&!d.advertising?(a&&console.log("QRDiv rendering not commissioned and not advertising state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px"},children:[e.jsx("div",{className:"MbfWindowHeader",style:{height:"30px"},children:e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"QR pairing code"})}),e.jsx("p",{className:"MbfWindowHeaderText thin-scroll",style:{overflowX:"auto",maxWidth:"280px",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:j}),e.jsx(oe,{onClick:_,endIcon:e.jsx(te,{path:At,size:1}),style:{margin:"20px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:"Turn on pairing"}),e.jsx("div",{className:"MbfWindowFooter",children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Serial number: ",d.serialNumber]})})]})):(a&&console.log("QRDiv rendering unknown state"),null):(a&&console.log("QRDiv rendering offline state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Server node"}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons"})]}),e.jsx("p",{className:"MbfWindowHeaderText",style:{overflow:"hidden",maxWidth:"280px",textOverflow:"ellipsis",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:j}),e.jsx("p",{style:{textAlign:"center",fontSize:"14px",fontWeight:"bold"},children:"Server offline: restart to commission"}),e.jsx("div",{className:"MbfWindowFooter",children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Serial number: ",d.serialNumber]})})]}))}const on=o.memo(rn);function nn(){const{logMessage:r,sendMessage:c,getUniqueId:s}=o.useContext(xe),[n,l]=o.useState("matterbridge-"),[f,j]=o.useState(!1),[t,d]=o.useState(null),N=o.useRef(s()),T=v=>{v.preventDefault(),j(!0)},w=()=>{j(!1)},R=v=>{v.preventDefault(),j(!1);const k=v.dataTransfer.files[0];if(k){r("Plugins",`Installing package ${k.name}. Please wait...`);const P=new FormData;P.append("file",k),P.append("filename",k.name),fetch("./api/uploadpackage",{method:"POST",body:P}).then(D=>D.text()).then(D=>{r("Plugins",`Server response: ${D}`)}).catch(D=>{console.error("Error uploading plugin file:",D),r("Plugins",`Error installing package ${D}`)})}},_=v=>{const k=v.target.files&&v.target.files[0];if(k){r("Plugins",`Uploading package ${k.name}`);const P=new FormData;P.append("file",k),P.append("filename",k.name),fetch("./api/uploadpackage",{method:"POST",body:P}).then(D=>D.text()).then(D=>{r("Plugins",`Server response: ${D}`)}).catch(D=>{console.error("Error uploading plugin file:",D),r("Plugins",`Error uploading package ${D}`)})}},S=()=>{c({id:N.current,sender:"InstallPlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:n,restart:!1}})},$=()=>{document.getElementById("file-upload")?.click()},p=()=>{c({id:N.current,sender:"InstallPlugins",method:"/api/addplugin",src:"Frontend",dst:"Matterbridge",params:{pluginNameOrPath:n}})},V=v=>{d(v.currentTarget)},b=v=>{v!==""&&l(v),d(null)};return a&&console.log("AddRemovePlugins rendering..."),e.jsxs("div",{style:{display:"flex",flexDirection:"row",flex:"1 1 auto",alignItems:"center",justifyContent:"space-between",margin:"0px",padding:"10px",gap:"20px"},onDragOver:T,onDragLeave:w,onDrop:R,children:[e.jsx(ce,{value:n,onChange:v=>{l(v.target.value)},size:"small",id:"plugin-name",label:"Plugin name or plugin path",variant:"outlined",fullWidth:!0}),e.jsx(U,{onClick:V,children:e.jsx(Wr,{})}),e.jsxs(et,{id:"simple-menu",anchorEl:t,keepMounted:!0,open:!!t,onClose:()=>b(""),children:[e.jsx(W,{onClick:()=>b("matterbridge-zigbee2mqtt"),children:"matterbridge-zigbee2mqtt"}),e.jsx(W,{onClick:()=>b("matterbridge-somfy-tahoma"),children:"matterbridge-somfy-tahoma"}),e.jsx(W,{onClick:()=>b("matterbridge-shelly"),children:"matterbridge-shelly"}),e.jsx(W,{onClick:()=>b("matterbridge-hass"),children:"matterbridge-hass"}),e.jsx(W,{onClick:()=>b("matterbridge-webhooks"),children:"matterbridge-webhooks"}),e.jsx(W,{onClick:()=>b("matterbridge-bthome"),children:"matterbridge-bthome"}),e.jsx(W,{onClick:()=>b("matterbridge-test"),children:"matterbridge-test"}),e.jsx(W,{onClick:()=>b("matterbridge-example-accessory-platform"),children:"matterbridge-example-accessory-platform"}),e.jsx(W,{onClick:()=>b("matterbridge-example-dynamic-platform"),children:"matterbridge-example-dynamic-platform"}),e.jsx(W,{onClick:()=>b("matterbridge-eve-door"),children:"matterbridge-eve-door"}),e.jsx(W,{onClick:()=>b("matterbridge-eve-motion"),children:"matterbridge-eve-motion"}),e.jsx(W,{onClick:()=>b("matterbridge-eve-energy"),children:"matterbridge-eve-energy"}),e.jsx(W,{onClick:()=>b("matterbridge-eve-weather"),children:"matterbridge-eve-weather"}),e.jsx(W,{onClick:()=>b("matterbridge-eve-room"),children:"matterbridge-eve-room"})]}),e.jsx(H,{title:"Install or update a plugin from npm",children:e.jsx(oe,{onClick:S,endIcon:e.jsx(Re,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Install"})}),e.jsx(H,{title:"Upload and install a plugin from a tarball",children:e.jsx(oe,{onClick:$,endIcon:e.jsx(Fr,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Upload"})}),e.jsx(H,{title:"Add an installed plugin",children:e.jsx(oe,{onClick:p,endIcon:e.jsx(vt,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Add"})}),e.jsx("input",{id:"file-upload",type:"file",accept:".tgz",style:{display:"none"},onChange:_})]})}const an=o.memo(nn);function Ye({status:r,enabledText:c="Enabled",disabledText:s=void 0,tooltipText:n=void 0,onClick:l}){if(r===void 0)return null;{const f=e.jsx("div",{className:r?"status-enabled":"status-disabled",style:{cursor:"default"},onClick:l,children:r?c:s??c});return n!==void 0?e.jsx(H,{title:n,children:f}):f}}const Xe={fontSize:"16px",fontWeight:"bold",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},Ze={fontSize:"12px",fontWeight:"normal",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},sn={fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)",backgroundColor:"var(--div-bg-color)"},ln={fontSize:"16px",fontWeight:"bold",backgroundColor:"var(--div-bg-color)"},Ee={padding:"0px",margin:"0px"},dn="5px 10px 5px 10px",gt={},Se={},ht={},ft={};let xt=[],Bt=[];const cn=({open:r,onClose:c,plugin:s})=>{const{sendMessage:n,addListener:l,removeListener:f,getUniqueId:j}=o.useContext(xe),t=o.useRef(j()),[d,N]=o.useState(s.configJson),[T,w]=o.useState(s.schemaJson),[R,_]=o.useState({"ui:submitButtonOptions":{submitText:"Confirm"},"ui:globalOptions":{orderable:!0}}),[S,$]=o.useState("");let p={};o.useEffect(()=>{const y=M=>{M.src==="Matterbridge"&&M.dst==="Frontend"&&(M.id===t.current&&M.method==="/api/select/devices"&&(M.response&&(xt=M.response),M.error&&console.error("ConfigPluginDialog received /api/select/devices error:",M.error)),M.id===t.current&&M.method==="/api/select/entities"&&(M.response&&(Bt=M.response),M.error&&console.error("ConfigPluginDialog received /api/select/entities error:",M.error)))};return l(y),d!==void 0&&T!==void 0&&(Object.keys(T.properties).forEach(M=>{Object.keys(T.properties[M]).forEach(I=>{I.startsWith("ui:")&&(R[M]={},R[M][I]=T.properties[M][I],delete T.properties[M][I])})}),_(R)),s.name!==void 0&&s.configJson!==void 0&&s.schemaJson!==void 0&&(N(s.configJson),w(s.schemaJson),n({id:t.current,sender:"ConfigPlugin",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:s.name}}),n({id:t.current,sender:"ConfigPlugin",method:"/api/select/entities",src:"Frontend",dst:"Matterbridge",params:{plugin:s.name}})),()=>{f(y)}},[l,d,s,f,T,n,R]);const V=({formData:y})=>{p=y},b=({formData:y})=>{N(y),s.configJson=y,s.restartRequired=!0,n({id:t.current,sender:"ConfigPlugin",method:"/api/savepluginconfig",src:"Frontend",dst:"Matterbridge",params:{pluginName:y.name,formData:y}}),c()};function v(y){const{id:M,label:I,onKeyChange:g,onDropPropertyClick:re,disabled:J,schema:ue,children:ge,registry:A,readonly:se,required:he}=y,{templates:ee}=A,{RemoveButton:ye}=ee.ButtonTemplates;if(!(zo in ue))return e.jsx(K,{sx:{display:"flex",flexDirection:"column",flexGrow:1,padding:0,margin:0,border:"none"},children:ge});const fe=({target:G})=>g(G&&G.value);return e.jsxs(K,{sx:{display:"flex",flexDirection:"row",flexGrow:1,padding:0,margin:0,border:"none"},children:[e.jsx(ce,{id:`${M}-key`,name:`${M}-key`,required:he,disabled:J||se,defaultValue:I,onBlur:se?void 0:fe,type:"text",variant:"outlined",sx:{width:"250px",minWidth:"250px",maxWidth:"250px",marginRight:"20px"}}),e.jsx(K,{sx:{flex:1},children:ge}),e.jsx(ye,{disabled:J||se,onClick:re(I)})]})}function k(y){const{children:M,description:I,displayLabel:g,errors:re,help:J,hidden:ue,_id:ge,_label:A,registry:se,uiSchema:he}=y,ee=Ao(he),ye=Uo("WrapIfAdditionalTemplate",se,ee);return ue?e.jsx("div",{style:{display:"none"},children:M}):e.jsx(K,{sx:{display:"flex",flexDirection:"column",flexGrow:1,padding:0,margin:0,border:"none"},children:e.jsxs(ye,{...y,children:[g===!0&&I,M,re,J]})})}function P(y){const{description:M}=y;return M?e.jsx(ae,{sx:Ze,children:M}):null}function D(y){const{required:M,title:I}=y;return I?e.jsx(K,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:e.jsxs(ae,{sx:Xe,children:["Title ",I," ",M&&e.jsx("mark",{children:"***"})]})}):null}function h(y){const{help:M,_idSchema:I}=y;return M?e.jsx(K,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:e.jsx(ae,{sx:sn,children:M})}):null}function L(y){const{errors:M}=y;return M?e.jsxs(K,{sx:{padding:"10px",margin:"10px",border:"1px solid grey"},children:[e.jsx(ae,{color:"error",sx:ln,children:"Please fix the following errors:"}),e.jsx(ot,{children:M.map((I,g)=>e.jsxs(Tr,{children:[e.jsx(B,{children:e.jsx(Lr,{color:"error"})}),e.jsx(X,{primary:I.stack})]},g))})]}):null}function m(y){const{errors:M}=y;return M?e.jsx(K,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:M.map((I,g)=>e.jsxs(ae,{color:"error",variant:"body2",sx:{marginLeft:1},children:["This field ",I]},g))}):null}function i(y){const{id:M,name:I,_schema:g,_uiSchema:re,value:J,options:ue,label:ge,type:A,placeholder:se,required:he,disabled:ee,readonly:ye,autofocus:ie,onChange:fe,onChangeOverride:G,onBlur:me,onFocus:je,_rawErrors:Qe,_hideError:z,_registry:Y,_formContext:Ne}=y,Te=({target:{value:Ce}})=>fe(Ce===""?ue.emptyValue:Ce),Le=({target:Ce})=>me(M,Ce&&Ce.value),Ue=({target:Ce})=>je(M,Ce&&Ce.value);return e.jsx(K,{sx:{padding:"0px",margin:"0px"},children:e.jsx(ce,{id:M,name:M,label:se&&se!==""?ge:void 0,variant:"outlined",placeholder:se&&se!==""?se:ge,required:he,disabled:ee||ye,autoFocus:ie,value:J||J===0?J:"",type:A,autoComplete:A==="password"?"current-password":I,onChange:G||Te,onBlur:Le,onFocus:Ue,fullWidth:!0})})}function u(y){return console.log("ArrayFieldTitleTemplate:",y),null}function C(y){return console.log("ArrayFieldDescriptionTemplate:",y),null}function Z(y){return console.log("ArrayFieldItemTemplate:",y),null}function de(y){const{canAdd:M,_className:I,_disabled:g,_formContext:re,_formData:J,_idSchema:ue,_items:ge,onAddClick:A,_rawErrors:se,_readonly:he,_registry:ee,_required:ye,schema:ie,title:fe,_uiSchema:G}=y,[me,je]=o.useState(!1),[Qe,z]=o.useState(!1),[Y,Ne]=o.useState(!1),[Te,Le]=o.useState(""),Ue=E=>{Le(E.target.value)},Ce=()=>{je(!me)},Je=()=>{z(!Qe)},Ge=()=>{Ne(!Y)},wt=E=>{je(!1),ie.selectFrom==="serial"?ie.items.default=E.serial:ie.selectFrom==="name"&&(ie.items.default=E.name),A()},Mt=E=>{z(!1),ie.selectEntityFrom==="name"?ie.items.default=E.name:ie.selectEntityFrom==="description"&&(ie.items.default=E.description),A()},kt=E=>{Ne(!1),ie.selectDeviceEntityFrom==="name"?ie.items.default=E.name:ie.selectDeviceEntityFrom==="description"&&(ie.items.default=E.description),A()};return e.jsxs(K,{sx:{margin:"0px",padding:"5px 10px 5px 10px",border:"1px solid grey"},children:[fe&&e.jsxs(K,{sx:{margin:"0px",padding:"0px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[fe&&e.jsx(ae,{sx:Xe,children:fe}),M&&e.jsxs(K,{sx:{margin:"0px",padding:"0px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[ie.selectFrom&&e.jsx(H,{title:"Add a device from the list",children:e.jsx(U,{onClick:Ce,size:"small",color:"primary",sx:Ee,children:e.jsx(dt,{})})}),ie.selectEntityFrom&&e.jsx(H,{title:"Add an entity from the list",children:e.jsx(U,{onClick:Je,size:"small",color:"primary",sx:Ee,children:e.jsx(dt,{})})}),ie.selectDeviceEntityFrom&&e.jsx(H,{title:"Add a device entity from the list",children:e.jsx(U,{onClick:Ge,size:"small",color:"primary",sx:Ee,children:e.jsx(dt,{})})}),e.jsx(H,{title:"Add a new item",children:e.jsx(U,{onClick:A,size:"small",color:"primary",sx:Ee,children:e.jsx(vt,{})})})]})]}),ie.description&&e.jsx(ae,{sx:Ze,children:ie.description}),y.items.map(E=>e.jsxs(K,{sx:{margin:"2px 0px",padding:"0px",display:"flex",alignItems:"center"},children:[e.jsx(K,{sx:{flexGrow:1,marginRight:"10px"},children:E.children}),e.jsx(U,{disabled:!E.hasMoveUp,onClick:E.onReorderClick(E.index,E.index-1),size:"small",color:"primary",sx:Ee,children:e.jsx(Rt,{})}),e.jsx(U,{disabled:!E.hasMoveDown,onClick:E.onReorderClick(E.index,E.index+1),size:"small",color:"primary",sx:Ee,children:e.jsx(Lt,{})}),e.jsx(U,{onClick:E.onDropIndexClick(E.index),size:"small",color:"primary",sx:Ee,children:e.jsx(jt,{})})]},E.index)),e.jsxs(Pe,{open:me,onClose:Ce,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(We,{children:"Select a device"}),e.jsxs(Fe,{children:[e.jsxs(K,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(ae,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(ce,{fullWidth:!0,variant:"outlined",value:Te,onChange:Ue,placeholder:"Enter serial or name"})]}),e.jsx(ot,{dense:!0,children:xt.filter(E=>E.serial.toLowerCase().includes(Te.toLowerCase())||E.name.toLowerCase().includes(Te.toLowerCase())).map((E,ke)=>e.jsxs(ct,{onClick:()=>wt(E),sx:gt,children:[E.icon==="wifi"&&e.jsx(B,{children:e.jsx(nt,{style:Se})}),E.icon==="ble"&&e.jsx(B,{children:e.jsx(pt,{style:Se})}),E.icon==="hub"&&e.jsx(B,{children:e.jsx(ut,{style:Se})}),e.jsx(X,{primary:E.name,secondary:E.serial,primaryTypographyProps:{style:ht},secondaryTypographyProps:{style:ft}})]},ke))})]}),e.jsx(_e,{children:e.jsx(oe,{onClick:Ce,children:"Close"})})]}),e.jsxs(Pe,{open:Qe,onClose:Je,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(We,{children:"Select an entity"}),e.jsxs(Fe,{children:[e.jsxs(K,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(ae,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(ce,{fullWidth:!0,variant:"outlined",value:Te,onChange:Ue,placeholder:"Enter name or description"})]}),e.jsx(ot,{dense:!0,children:Bt.filter(E=>E.name.toLowerCase().includes(Te.toLowerCase())||E.description.toLowerCase().includes(Te.toLowerCase())).map((E,ke)=>e.jsxs(ct,{onClick:()=>Mt(E),sx:gt,children:[E.icon==="wifi"&&e.jsx(B,{children:e.jsx(nt,{style:Se})}),E.icon==="ble"&&e.jsx(B,{children:e.jsx(pt,{style:Se})}),E.icon==="hub"&&e.jsx(B,{children:e.jsx(ut,{style:Se})}),E.icon==="component"&&e.jsx(B,{children:e.jsx(Ht,{style:Se})}),E.icon==="matter"&&e.jsx(B,{children:e.jsx($t,{style:Se})}),e.jsx(X,{primary:E.name,secondary:E.description,primaryTypographyProps:{style:ht},secondaryTypographyProps:{style:ft}})]},ke))})]}),e.jsx(_e,{children:e.jsx(oe,{onClick:Je,children:"Close"})})]}),e.jsxs(Pe,{open:Y,onClose:Ge,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsxs(We,{children:["Select an entity for ",fe]}),e.jsx(Fe,{children:e.jsx(ot,{dense:!0,children:xt.filter(E=>E.serial===fe||E.name===fe).map(E=>E.entities?.map((ke,It)=>e.jsxs(ct,{onClick:()=>kt(ke),sx:gt,children:[ke.icon==="wifi"&&e.jsx(B,{children:e.jsx(nt,{style:Se})}),ke.icon==="ble"&&e.jsx(B,{children:e.jsx(pt,{style:Se})}),ke.icon==="hub"&&e.jsx(B,{children:e.jsx(ut,{style:Se})}),ke.icon==="component"&&e.jsx(B,{children:e.jsx(Ht,{style:Se})}),ke.icon==="matter"&&e.jsx(B,{children:e.jsx($t,{style:Se})}),e.jsx(X,{primary:ke.name,secondary:ke.description,primaryTypographyProps:{style:ht},secondaryTypographyProps:{style:ft}})]},It)))})}),e.jsx(_e,{children:e.jsx(oe,{onClick:Ge,children:"Close"})})]})]})}function be(y){const{onAddClick:M,schema:I,properties:g,title:re,description:J}=y,[ue,ge]=o.useState(!1),[A,se]=o.useState(""),he=G=>{se(G.target.value)},ee=()=>{ge(!ue)},ye=G=>{ge(!1);let me="";I.selectFrom==="serial"?me=G.serial:I.selectFrom==="name"&&(me=G.name),$(me),M(I)()},ie=()=>{M(I)()},fe=!I.additionalProperties;return!fe&&S!==""&&g.forEach(G=>{if(G.name==="newKey"&&G.content.key==="newKey"&&G.content.props.name==="newKey"&&G.content.props.onKeyChange&&S!==""){const me=S;$(""),G.content.props.onKeyChange(me)}}),e.jsxs(K,{sx:{margin:"0px",padding:fe?"10px":"5px 10px 0px 10px",border:fe?"none":"1px solid grey"},children:[I.title&&fe&&e.jsx(K,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px",marginBottom:"10px"},children:e.jsx(ae,{sx:Xe,children:I.title})}),re&&!fe&&e.jsxs(K,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px"},children:[e.jsx(ae,{sx:Xe,children:re}),e.jsxs(K,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px"},children:[I.selectFrom&&e.jsx(H,{title:"Add a device from the list",children:e.jsx(U,{onClick:ee,size:"small",color:"primary",sx:Ee,children:e.jsx(dt,{})})}),e.jsx(H,{title:"Add a new item",children:e.jsx(U,{onClick:ie,size:"small",color:"primary",sx:Ee,children:e.jsx(vt,{})})})]})]}),I.description&&e.jsx(K,{sx:{padding:"0px",margin:"0px",marginBottom:"10px"},children:e.jsx(ae,{sx:Ze,children:I.description})}),g.map(({content:G,name:me,hidden:je})=>!je&&e.jsxs(K,{sx:{margin:"0px",marginBottom:"10px",padding:["object","array","boolean"].includes(I.properties[me].type)?"0px":dn,border:["object","array","boolean"].includes(I.properties[me].type)?"none":"1px solid grey"},children:[!["object","array","boolean"].includes(I.properties[me].type)&&e.jsx(ae,{sx:Xe,children:me}),e.jsx(K,{sx:{flexGrow:1,padding:"0px",margin:"0px"},children:G})]},me)),e.jsxs(Pe,{open:ue,onClose:ee,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(We,{children:"Select a device"}),e.jsxs(Fe,{children:[e.jsxs(K,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(ae,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(ce,{fullWidth:!0,variant:"outlined",value:A,onChange:he,placeholder:"Enter serial or name"})]}),e.jsx(ot,{dense:!0,children:xt.filter(G=>G.serial.toLowerCase().includes(A.toLowerCase())||G.name.toLowerCase().includes(A.toLowerCase())).map((G,me)=>e.jsxs(ct,{onClick:()=>ye(G),sx:gt,children:[G.icon==="wifi"&&e.jsx(B,{children:e.jsx(nt,{style:Se})}),G.icon==="ble"&&e.jsx(B,{children:e.jsx(pt,{style:Se})}),G.icon==="hub"&&e.jsx(B,{children:e.jsx(ut,{style:Se})}),e.jsx(X,{primary:G.name,secondary:G.serial,primaryTypographyProps:{style:ht},secondaryTypographyProps:{style:ft}})]},me))})]}),e.jsx(_e,{children:e.jsx(oe,{onClick:ee,children:"Close"})})]})]})}function ve(y){const{uiSchema:M}=y,{submitText:I,norender:g}=Vo(M);return g?null:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",margin:"10px",padding:"0px",gap:"20px"},children:[e.jsx(oe,{type:"submit",variant:"contained",color:"primary",children:I}),e.jsx(oe,{variant:"contained",color:"primary",onClick:c,children:"Cancel"})]})}function pe(y){const{className:M,disabled:I,onClick:g,registry:re,style:J,uiSchema:ue,...ge}=y;return e.jsx(H,{title:"Remove the item",children:e.jsx(U,{disabled:I,size:"small",color:"primary",onClick:g,children:e.jsx(jt,{})})})}function Q(y){const{className:M,disabled:I,onClick:g,registry:re,uiSchema:J,...ue}=y;return e.jsx(H,{title:"Add an item",children:e.jsx(U,{size:"small",color:"primary",onClick:g,children:e.jsx(vt,{})})})}function ne(y){const{disabled:M,onClick:I,registry:g,style:re,uiSchema:J,...ue}=y;return e.jsx(H,{title:"Move up the item",children:e.jsx(U,{size:"small",color:"primary",onClick:I,children:e.jsx(Rt,{})})})}function F(y){const{disabled:M,onClick:I,registry:g,style:re,uiSchema:J,...ue}=y;return e.jsx(H,{title:"Move down the item",children:e.jsx(U,{size:"small",color:"primary",onClick:I,children:e.jsx(Lt,{})})})}function O(y){const{id:M,name:I,value:g,schema:re,readonly:J,onChange:ue}=y,[ge,A]=o.useState(void 0),se=ee=>{A(ee&&ee!==""?ee:void 0)},he=()=>{n({id:t.current,sender:"ConfigPlugin",method:"/api/action",src:"Frontend",dst:"Matterbridge",params:{plugin:s.name,action:I,value:ge,formData:p,id:M}}),re.buttonClose===!0?c():re.buttonSave===!0&&b({formData:d})};return re.buttonText&&re.description?e.jsxs(K,{sx:{margin:"0px",padding:"10px",border:"1px solid grey",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(ae,{sx:Ze,children:re.description}),e.jsx(oe,{variant:"contained",color:"primary",onClick:()=>he(),children:re.buttonText})]}):re.buttonField&&re.description?e.jsxs(K,{sx:{margin:"0px",padding:"10px",gap:"20px",border:"1px solid grey",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(ae,{sx:Ze,children:re.description}),e.jsx(ce,{id:I+"-input",name:I,label:re.textLabel,placeholder:re.textPlaceholder,onChange:ee=>se(ee.target.value),sx:{width:"250px",minWidth:"250px",maxWidth:"250px"}}),e.jsx(oe,{id:I+"-button",variant:"contained",color:"primary",disabled:ge===void 0,onClick:()=>he(),children:re.buttonField})]}):e.jsxs(K,{sx:{margin:"0px",padding:"5px 10px",border:"1px solid grey"},children:[I&&e.jsxs(K,{sx:{margin:"0px",padding:"0px",gap:"10px",display:"flex",justifyContent:"flex-start",alignItems:"center"},children:[e.jsx(ae,{sx:Xe,children:I}),e.jsx($e,{checked:g,readOnly:J,onChange:()=>ue(!g),sx:{padding:"0px",margin:"0px"}})]}),re.description&&e.jsx(ae,{sx:Ze,children:re.description})]})}function x({schema:y,id:M,name:I,options:g,label:re,hideLabel:J,required:ue,disabled:ge,placeholder:A,readonly:se,value:he,multiple:ee,autofocus:ye,onChange:ie,onBlur:fe,onFocus:G,errorSchema:me,rawErrors:je=[],registry:Qe,uiSchema:z,hideError:Y,formContext:Ne,...Te}){const{enumOptions:Le,enumDisabled:Ue,emptyValue:Ce}=g;ee=typeof ee>"u"?!1:!!ee;const Je=ee?[]:"",Ge=typeof he>"u"||ee&&he.length<1||!ee&&he===Je,wt=({target:{value:Oe}})=>ie(Nt(Oe,Le,Ce)),Mt=({target:Oe})=>fe(M,Nt(Oe&&Oe.value,Le,Ce)),kt=({target:Oe})=>G(M,Nt(Oe&&Oe.value,Le,Ce)),E=Eo(he,Le,ee),{InputLabelProps:ke,SelectProps:It,autocomplete:ur,...mr}=Te,gr=!ee&&y.default===void 0;return e.jsxs(ce,{id:M,name:M,value:!Ge&&typeof E<"u"?E:Je,required:ue,disabled:ge||se,autoFocus:ye,autoComplete:ur,placeholder:A,error:je.length>0,onChange:wt,onBlur:Mt,onFocus:kt,...mr,select:!0,InputLabelProps:{...ke,shrink:!Ge},SelectProps:{...It,multiple:ee},"aria-describedby":_o(M),children:[gr&&e.jsx(W,{value:"",children:A}),Array.isArray(Le)&&Le.map(({value:Oe,label:hr},Tt)=>{const fr=Array.isArray(Ue)&&Ue.indexOf(Oe)!==-1;return e.jsx(W,{value:String(Tt),disabled:fr,children:hr},Tt)})]})}return!r||!T||!d?null:e.jsxs(Pe,{open:r,onClose:c,maxWidth:"800px",children:[e.jsx(We,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h3",{children:"Matterbridge plugin configuration"})]})}),e.jsx(Fe,{style:{padding:"0px",margin:"0px",width:"800px",height:"600px",overflow:"auto"},children:e.jsx($o,{schema:T,formData:d,uiSchema:R,validator:Oo,templates:{FieldTemplate:k,BaseInputTemplate:i,TitleFieldTemplate:D,DescriptionFieldTemplate:P,FieldHelpTemplate:h,FieldErrorTemplate:m,ErrorListTemplate:L,WrapIfAdditionalTemplate:v,ArrayFieldTitleTemplate:u,ArrayFieldDescriptionTemplate:C,ArrayFieldItemTemplate:Z,ArrayFieldTemplate:de,ObjectFieldTemplate:be,ButtonTemplates:{SubmitButton:ve,RemoveButton:pe,AddButton:Q,MoveUpButton:ne,MoveDownButton:F}},widgets:{CheckboxWidget:O,SelectWidget:x},onChange:V,onSubmit:b})})]})};function sr(r){if(a&&console.log(`getQRColor (id: ${r?.id}) received matter:`,r??"undefined"),r===void 0||!r.online||!r.qrPairingCode&&!r.manualPairingCode&&!r.fabricInformations&&!r.sessionInformations)return"red";if(r.commissioned===!1&&r.qrPairingCode&&r.manualPairingCode)return"var(--primary-color)";let c=0,s=0;for(const n of r.sessionInformations??[])n.fabric&&n.isPeerActive===!0&&c++,n.numberOfActiveSubscriptions>0&&(s+=n.numberOfActiveSubscriptions);return r.commissioned===!0&&r.fabricInformations&&r.sessionInformations&&(c===0||s===0)?"var(--secondary-color)":"var(--div-text-color)"}function pn(r,c,s){const n=r?.[s],l=c?.[s];return n==null&&l==null?0:n==null?-1:l==null?1:typeof n=="boolean"&&typeof l=="boolean"?n===l?0:n?1:-1:typeof n=="number"&&typeof l=="number"?n-l:String(n).localeCompare(String(l))}function un({name:r,columns:c,rows:s,getRowKey:n,footerLeft:l,footerRight:f}){const j=o.useRef(new WeakMap),t=o.useRef(1),d=h=>{if(typeof n=="string"&&h&&h[n]!=null)return h[n];if(typeof n=="function"){const i=n(h);if(i!=null)return i}const L=c?.[0]?.id;if(L&&h&&h[L]!=null)return h[L];console.warn(`MbfTable(${r}): using fallback stable row key; consider providing getRowKey prop for better React performance`);let m=j.current.get(h);return m||(m=`rk_${t.current++}`,j.current.set(h,m)),m},[N,T]=o.useState(localStorage.getItem(`${r}_table_order_by`)||null),[w,R]=o.useState(localStorage.getItem(`${r}_table_order`)||null),[_,S]=o.useState(!1),[$,p]=o.useState(()=>{try{const h=localStorage.getItem(`${r}_column_visibility`);if(h)return JSON.parse(h)}catch{}return{}}),V=o.useMemo(()=>{const h={};for(const L of c)L.hidden||(h[L.id]=L.required?!0:$[L.id]!==!1);return h},[c,$]),b=o.useMemo(()=>{if(!N||!w)return s;const h=c.find(m=>m.id===N);if(!h||h.noSort)return s;const L=s.map((m,i)=>({el:m,index:i}));return L.sort((m,i)=>{let u;return typeof h.comparator=="function"?u=h.comparator(m.el,i.el):u=pn(m.el,i.el,N),u!==0?w==="asc"?u:-u:m.index-i.index}),L.map(m=>m.el)},[s,N,w,c]),v=h=>{if(N!==h||!N){T(h),R("asc"),localStorage.setItem(`${r}_table_order_by`,h),localStorage.setItem(`${r}_table_order`,"asc");return}if(w==="asc"){R("desc"),localStorage.setItem(`${r}_table_order`,"desc");return}T(null),R(null),localStorage.removeItem(`${r}_table_order_by`),localStorage.removeItem(`${r}_table_order`)},k=()=>{S(!_)},P=h=>{p(L=>{const m=c.find(C=>C.id===h);if(m&&m.required)return L;const i=V[h]!==!1,u={...L};i?u[h]=!1:delete u[h];try{localStorage.setItem(`${r}_column_visibility`,JSON.stringify(u))}catch{}return u})},D=()=>{p({});try{localStorage.removeItem(`${r}_column_visibility`)}catch{}S(!1)};return a&&console.log(`Rendering table ${r}${N&&w?` ordered by ${N}:${w}`:""}`),e.jsxs("div",{style:{display:"flex",flexDirection:"column",margin:"0",padding:"0",gap:"0",width:"100%",flex:"1 1 auto",height:"100%",minHeight:0,overflow:"hidden"},children:[e.jsxs(Pe,{open:_,onClose:(h,L)=>{L==="backdropClick"||L==="escapeKeyDown"||k()},disableEscapeKeyDown:!0,disableRestoreFocus:!0,children:[e.jsx(We,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:`Configure ${r} columns`})]})}),e.jsx(Fe,{children:e.jsx(Wt,{children:c.filter(h=>!h.hidden).map(h=>e.jsx(He,{control:e.jsx($e,{disabled:!!h.required,checked:h.required?!0:V[h.id]!==!1,onChange:()=>P(h.id)}),label:h.label},h.id))})}),e.jsxs(_e,{children:[e.jsx(oe,{onClick:D,children:"Reset"}),e.jsx(oe,{variant:"contained",onClick:h=>{if(h?.currentTarget&&typeof h.currentTarget.blur=="function")try{h.currentTarget.blur()}catch{}const L=document.activeElement;if(L&&L instanceof HTMLElement&&typeof L.blur=="function")try{L.blur()}catch{}k()},children:"Close"})]})]}),e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",minHeight:"30px",justifyContent:"space-between",borderBottom:"none"},children:[e.jsx("p",{className:"MbfWindowHeaderText",children:r}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(U,{onClick:h=>{if(h?.currentTarget?.blur)try{h.currentTarget.blur()}catch{}k()},"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(H,{title:`Configure ${r} columns`,children:e.jsx(te,{path:bo,size:"20px",style:{color:"var(--header-text-color)"}})})})})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",flex:"1 1 auto",minHeight:0,width:"100%",overflow:"auto",margin:"0px",padding:"0px",gap:"0"},children:e.jsxs("table",{"aria-label":`${r} table`,style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,border:"none",color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color"},children:e.jsx("tr",{style:{height:"30px",minHeight:"30px"},children:c.map(h=>{if(h.hidden||!h.required&&V[h.id]===!1)return null;const L=!h.noSort,m=L&&N===h.id&&!!w;return e.jsxs("th",{onClick:L?()=>v(h.id):void 0,style:{margin:"0",padding:"5px 10px",position:"sticky",top:0,minWidth:h.minWidth,maxWidth:h.maxWidth,textAlign:h.align||"left",cursor:L?"pointer":"default",border:"none",color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color)",whiteSpace:h.maxWidth?"nowrap":void 0,overflow:h.maxWidth?"hidden":void 0,textOverflow:h.maxWidth?"ellipsis":void 0},"aria-sort":L?m?w==="asc"?"ascending":"descending":"none":void 0,children:[h.label,m&&e.jsxs("span",{style:{marginLeft:6},children:[w==="asc"&&e.jsx(te,{path:or,size:"15px"}),w==="desc"&&e.jsx(te,{path:nr,size:"15px"})]})]},h.id)})})}),e.jsx("tbody",{children:b.map((h,L)=>{const m=d(h);return e.jsx("tr",{className:L%2===0?"table-content-even":"table-content-odd",style:{height:"30px",minHeight:"30px",border:"none",borderCollapse:"collapse"},children:c.map(i=>{if(i.hidden||!i.required&&V[i.id]===!1)return null;const u=h[i.id];return e.jsx("td",{style:{border:"none",borderCollapse:"collapse",textAlign:i.align||"left",padding:"5px 10px",margin:"0",maxWidth:i.maxWidth,whiteSpace:i.maxWidth?"nowrap":void 0,overflow:i.maxWidth?"hidden":void 0,textOverflow:i.maxWidth?"ellipsis":void 0},children:typeof i.render=="function"?i.render(u,m,h,i):typeof u=="boolean"?e.jsx($e,{checked:u,disabled:!0,size:"small",sx:{m:0,p:0,color:"var(--table-text-color)","&.Mui-disabled":{color:"var(--table-text-color)",opacity:.7}}}):i.format&&typeof u=="number"?i.format(u):u!=null?String(u):null},i.id)})},m)})})]})}),(l||f)&&e.jsxs("div",{className:"MbfWindowFooter",style:{height:"30px",minHeight:"30px",justifyContent:"space-between",border:"none"},children:[e.jsx("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)"},children:l}),e.jsx("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)"},children:f})]})]})}function mn(r){return o.memo(r)}const Ft=mn(un);function gn({storeId:r,setStoreId:c}){const{online:s,sendMessage:n,addListener:l,removeListener:f,getUniqueId:j}=o.useContext(xe),{showConfirmCancelDialog:t}=o.useContext(rt),d=o.useRef(j()),[N,T]=o.useState(null),[w,R]=o.useState(null),[_,S]=o.useState([]),$=[{label:"Name",id:"name",required:!0,render:(F,O,x,y)=>e.jsx(H,{title:"Open the plugin homepage",children:e.jsx("span",{style:{cursor:"pointer"},onClick:()=>m(x),children:x.name})})},{label:"Description",id:"description",render:(F,O,x,y)=>e.jsx(H,{title:"Open the plugin homepage",children:e.jsx("span",{style:{cursor:"pointer"},onClick:()=>m(x),children:x.description})})},{label:"Version",id:"version",render:(F,O,x,y)=>e.jsxs(e.Fragment,{children:[x.latestVersion!==void 0&&x.latestVersion!==x.version&&w&&!w.readOnly&&e.jsx(H,{title:"New plugin stable version available, click to install",children:e.jsxs("span",{className:"status-warning",style:{marginRight:"10px"},onClick:()=>k(x),children:["Update to v.",x.latestVersion]})}),x.version.includes("-dev-")&&x.devVersion!==void 0&&x.devVersion!==x.version&&w&&!w.readOnly&&e.jsx(H,{title:"New plugin dev version available, click to install",children:e.jsxs("span",{className:"status-warning",style:{marginRight:"10px"},onClick:()=>P(x),children:["Update to new dev v.",x.devVersion.split("-dev-")[0]]})}),e.jsx(H,{title:"Plugin version",children:e.jsx("span",{children:x.version})})]})},{label:"Author",id:"author",render:(F,O,x,y)=>e.jsx(e.Fragment,{children:x.author?x.author.replace("https://github.com/",""):"Unknown"})},{label:"Type",id:"type",render:(F,O,x,y)=>e.jsx(e.Fragment,{children:x.type?x.type.replace("Platform",""):"Unknown"})},{label:"Devices",id:"registeredDevices"},{label:"Actions",id:"actions",required:!0,render:(F,O,x,y)=>e.jsxs("div",{style:{margin:"0px",padding:"0px",gap:"4px",display:"flex",flexDirection:"row"},children:[w&&w.bridgeMode==="childbridge"&&!x.error&&x.enabled&&e.jsx(H,{title:"Shows the QRCode or the fabrics",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(U,{style:{margin:"0",padding:"0",width:"19px",height:"19px",color:sr(x.matter)},onClick:()=>{x.matter?.id&&c(x.matter?.id)},size:"small",children:e.jsx(Zt,{})})}),w&&w.bridgeMode==="childbridge"&&!x.error&&x.enabled&&e.jsx(H,{title:"Restart the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(U,{style:{margin:"0",padding:"0",width:"19px",height:"19px"},onClick:()=>h(x),size:"small",children:e.jsx(bt,{})})}),e.jsx(H,{title:"Plugin config",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(U,{disabled:x.restartRequired===!0,style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>pe(x),size:"small",children:e.jsx(it,{})})}),w&&!w.readOnly&&e.jsx(H,{title:"Remove the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(U,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>{V("Remove plugin","Are you sure? This will also remove all devices and configuration from the controller.","remove",x)},size:"small",children:e.jsx(jt,{})})}),x.enabled?e.jsx(H,{title:"Disable the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(U,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>{V("Disable plugin","Are you sure? This will also remove all devices and configuration from the controller.","disable",x)},size:"small",children:e.jsx(Rr,{})})}):e.jsx(e.Fragment,{}),x.enabled?e.jsx(e.Fragment,{}):e.jsx(H,{title:"Enable the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(U,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>L(x),size:"small",children:e.jsx(Hr,{})})}),e.jsx(H,{title:"Open the plugin help",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(U,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>u(x),size:"small",children:e.jsx($r,{})})}),e.jsx(H,{title:"Open the plugin version history",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(U,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>C(x),size:"small",children:e.jsx(Or,{})})}),w&&!w.readOnly&&e.jsx(H,{title:"Sponsor the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(U,{style:{margin:"0",padding:"0",width:"19px",height:"19px",color:"#b6409c"},onClick:()=>i(x),size:"small",children:e.jsx(Yt,{})})})]})},{label:"Status",id:"status",required:!0,render:(F,O,x,y)=>e.jsx("div",{style:{display:"flex",flexDirection:"row",flex:"1 1 auto",margin:"0",padding:"0",gap:"5px",width:"auto",maxWidth:"max-content"},children:x.error?e.jsx(e.Fragment,{children:e.jsx(Ye,{status:!1,enabledText:"Error",disabledText:"Error",tooltipText:"The plugin is in error state. Check the log!"})}):e.jsx(e.Fragment,{children:x.enabled===!1?e.jsx(e.Fragment,{children:e.jsx(Ye,{status:x.enabled,enabledText:"Enabled",disabledText:"Disabled",tooltipText:"Whether the plugin is enable or disabled"})}):e.jsx(e.Fragment,{children:x.loaded&&x.started&&x.configured?e.jsx(e.Fragment,{children:e.jsx(Ye,{status:x.loaded,enabledText:"Running",tooltipText:"Whether the plugin is running"})}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{status:x.loaded,enabledText:"Loaded",tooltipText:"Whether the plugin has been loaded"}),e.jsx(Ye,{status:x.started,enabledText:"Started",tooltipText:"Whether the plugin started"}),e.jsx(Ye,{status:x.configured,enabledText:"Configured",tooltipText:"Whether the plugin has been configured"})]})})})})}];o.useEffect(()=>{const F=O=>{O.src==="Matterbridge"&&O.dst==="Frontend"&&(le(O)&&O.method==="refresh_required"&&O.params.changed==="plugins"&&(a&&console.log(`HomePlugins received refresh_required: changed=${O.params.changed} and sending /api/plugins request`),n({id:d.current,sender:"HomePlugins",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})),le(O)&&O.method==="refresh_required"&&O.params.changed==="matter"&&(a&&console.log(`HomePlugins received refresh_required: changed=${O.params.changed} and setting matter id ${O.params.matter?.id}`),S(x=>{const y=x.findIndex(I=>I.matter?.id===O.params.matter?.id);if(y<0)return a&&console.log(`HomePlugins received refresh_required: changed=${O.params.changed} and matter id ${O.params.matter?.id} not found`),x;a&&console.log(`HomePlugins received refresh_required: changed=${O.params.changed} set matter id ${O.params.matter?.id}`);const M=[...x];return M[y]={...M[y],matter:O.params.matter},M})),le(O)&&O.method==="refresh_required"&&O.params.changed==="settings"&&(a&&console.log(`HomePlugins received refresh_required: changed=${O.params.changed} and sending /api/settings request`),n({id:d.current,sender:"HomePlugins",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),De(O)&&O.id===d.current&&O.method==="/api/settings"&&(a&&console.log(`HomePlugins (id: ${O.id}) received settings:`,O.response),T(O.response.systemInformation),R(O.response.matterbridgeInformation)),De(O)&&O.id===d.current&&O.method==="/api/plugins"&&(a&&console.log(`HomePlugins (id: ${O.id}) received ${O.response.length} plugins:`,O.response),S(O.response)))};return l(F),a&&console.log("HomePlugins added WebSocket listener id:",d.current),()=>{f(F),a&&console.log("HomePlugins removed WebSocket listener")}},[l,f,n]),o.useEffect(()=>{s&&(a&&console.log("HomePlugins sending api requests"),n({id:d.current,sender:"HomePlugins",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),n({id:d.current,sender:"HomePlugins",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[s,n]);const p=o.useRef(null),V=(F,O,x,y)=>{a&&console.log(`handleActionWithConfirmCancel ${x} ${y.name}`),p.current=y,t(F,O,x,b,v)},b=F=>{a&&console.log(`handleConfirm action confirmed ${F} ${p.current?.name}`),F==="remove"&&p.current?D(p.current):F==="disable"&&p.current&&L(p.current),p.current=null},v=F=>{a&&console.log(`handleCancel action canceled ${F} ${p.current?.name}`),p.current=null},k=F=>{a&&console.log("handleUpdatePlugin plugin:",F.name),n({id:d.current,sender:"HomePlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:F.name,restart:!1}})},P=F=>{a&&console.log("handleUpdateDevPlugin plugin:",F.name),n({id:d.current,sender:"HomePlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:F.name+"@dev",restart:!1}})},D=F=>{a&&console.log("handleRemovePlugin plugin:",F.name),n({id:d.current,sender:"HomePlugins",method:"/api/removeplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:F.name}})},h=F=>{a&&console.log("handleRestartPlugin plugin:",F.name),n({id:d.current,sender:"HomePlugins",method:"/api/restartplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:F.name}})},L=F=>{a&&console.log("handleEnableDisablePlugin plugin:",F.name,"enabled:",F.enabled),F.enabled===!0?(F.enabled=!1,n({id:d.current,sender:"HomePlugins",method:"/api/disableplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:F.name}})):(F.enabled=!0,n({id:d.current,sender:"HomePlugins",method:"/api/enableplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:F.name}}))},m=F=>{a&&console.log(`handleHomepagePlugin plugin: ${F.name} homepage: ${F.homepage}`),F.homepage&&window.open(F.homepage,"_blank")},i=F=>{a&&console.log("handleSponsorPlugin plugin:",F.name,"funding:",F.funding),F.funding&&window.open(F.funding,"_blank")},u=F=>{a&&console.log("handleHelpPlugin plugin:",F.name,"help:",F.help),F.help&&window.open(F.help,"_blank")},C=F=>{a&&console.log("handleChangelogPlugin plugin:",F.name,"changelog:",F.changelog),F.changelog&&window.open(F.changelog,"_blank")},[Z,de]=o.useState({}),[be,ve]=o.useState(!1),pe=F=>{a&&console.log("handleConfigPlugin plugin:",F.name),n({id:d.current,sender:"HomePlugins",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:F.name}}),n({id:d.current,sender:"HomePlugins",method:"/api/select/entities",src:"Frontend",dst:"Matterbridge",params:{plugin:F.name}}),de(F),Q()},Q=()=>{ve(!0)},ne=()=>{ve(!1)};return a&&console.log("HomePlugins rendering..."),s?e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",width:"100%",flex:"0 0 auto",overflow:"hidden"},children:[e.jsx(cn,{open:be,onClose:ne,plugin:Z}),e.jsx(Ft,{name:"Plugins",columns:$,rows:_,footerRight:"",footerLeft:""})]}):e.jsx(Be,{})}const hn=o.memo(gn),fn=r=>`${r.pluginName}::${r.serial}`;function xn({storeId:r,setStoreId:c}){const{online:s,sendMessage:n,addListener:l,removeListener:f,getUniqueId:j}=o.useContext(xe),[t,d]=o.useState(!1),[N,T]=o.useState(!0),[w,R]=o.useState(null),[_,S]=o.useState([]),[$,p]=o.useState([]),[V,b]=o.useState([]),[v,k]=o.useState([]),P=o.useRef(j()),D=[{label:"Plugin",id:"pluginName"},{label:"Name",id:"name",required:!0},{label:"Serial",id:"serial"},{label:"Availability",id:"availability",render:(m,i,u,C)=>u.reachable===!0?"Online":u.reachable===!1?e.jsx("span",{style:{color:"red"},children:"Offline"}):"",comparator:(m,i)=>{const u=m.reachable===!0?1:m.reachable===!1?0:-1,C=i.reachable===!0?1:i.reachable===!1?0:-1;return u-C}},{label:"Power",id:"powerSource",render:(m,i,u,C)=>u.powerSource==="ac"||u.powerSource==="dc"?e.jsx(er,{fontSize:"small",sx:{color:"var(--primary-color)"}}):u.powerSource==="ok"?e.jsx(yt,{fontSize:"small",sx:{color:"green"}}):u.powerSource==="warning"?e.jsx(yt,{fontSize:"small",sx:{color:"yellow"}}):u.powerSource==="critical"?e.jsx(yt,{fontSize:"small",sx:{color:"red"}}):e.jsx("span",{})},{label:"Url",id:"configUrl"},{label:"Actions",id:"selected",required:!0,render:(m,i,u,C)=>e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[u.matter!==void 0?e.jsx(H,{title:"Show the QRCode or the fabrics",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(U,{onClick:()=>c(r===u.matter?.id?w?.matterbridgeInformation.bridgeMode==="bridge"?"Matterbridge":null:u.matter?.id||null),"aria-label":"Show the QRCode",sx:{margin:0,padding:0,color:sr(u.matter)},children:e.jsx(Zt,{fontSize:"small"})})}):e.jsx("div",{style:{width:"20px",height:"20px"}}),u.configUrl?e.jsx(H,{title:"Open the configuration page",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(U,{onClick:()=>window.open(u.configUrl,"_blank"),"aria-label":"Open config url",sx:{margin:0,padding:0},children:e.jsx(it,{fontSize:"small"})})}):e.jsx("div",{style:{width:"20px",height:"20px"}}),u.selected!==void 0?e.jsx(H,{title:"Select/unselect the device",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx($e,{checked:u.selected,onChange:Z=>L(Z,u),sx:{margin:"0",marginLeft:"8px",padding:"0"},size:"small"})}):e.jsx("div",{style:{width:"20px",height:"20px"}})]})}],h=o.useCallback(m=>{m.selected=void 0;const i=_.find(Z=>Z.name===m.pluginName);if(!i)return console.error(`HomeDevices isSelected: plugin ${m.pluginName} not found for device ${m.name} `),m.selected;const u=i.schemaJson?.properties?.whiteList?.selectFrom;let C=i.configJson.postfix;return C===""&&(C=void 0),i.hasWhiteList===!0&&i.hasBlackList===!0&&u&&(m.selected=!0,u==="serial"&&i.configJson.whiteList&&i.configJson.whiteList.length>0&&i.configJson.whiteList.includes(C?m.serial.replace("-"+C,""):m.serial)&&(m.selected=!0),u==="serial"&&i.configJson.whiteList&&i.configJson.whiteList.length>0&&!i.configJson.whiteList.includes(C?m.serial.replace("-"+C,""):m.serial)&&(m.selected=!1),u==="serial"&&i.configJson.blackList&&i.configJson.blackList.length>0&&i.configJson.blackList.includes(C?m.serial.replace("-"+C,""):m.serial)&&(m.selected=!1),u==="name"&&i.configJson.whiteList&&i.configJson.whiteList.length>0&&i.configJson.whiteList.includes(m.name)&&(m.selected=!0),u==="name"&&i.configJson.whiteList&&i.configJson.whiteList.length>0&&!i.configJson.whiteList.includes(m.name)&&(m.selected=!1),u==="name"&&i.configJson.blackList&&i.configJson.blackList.length>0&&i.configJson.blackList.includes(m.name)&&(m.selected=!1)),m.selected},[_]);o.useEffect(()=>{const m=i=>{if(i.src==="Matterbridge"&&i.dst==="Frontend"){if(le(i)&&i.method==="refresh_required"&&i.params.changed!=="matter"&&(a&&console.log(`HomeDevices received refresh_required: changed=${i.params.changed} and sending /api/plugins request`),n({id:P.current,sender:"HomeDevices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})),le(i)&&i.method==="refresh_required"&&i.params.changed==="matter"&&(a&&console.log(`HomeDevices received refresh_required: changed=${i.params.changed} and setting matter id ${i.params.matter?.id}`),k(u=>{const C=u.findIndex(de=>de.name.replaceAll(" ","")===i.params.matter?.id);if(C<0)return a&&console.debug(`HomeDevices: matter id ${i.params.matter?.id} not found`),u;const Z=[...u];return Z[C]={...Z[C],matter:i.params.matter},a&&console.log(`HomeDevices received refresh_required: changed=${i.params.changed} and set matter id ${i.params.matter?.id}`),Z})),le(i)&&i.method==="restart_required"&&(a&&console.log("HomeDevices received restart_required"),d(!0)),le(i)&&i.method==="restart_not_required"&&(a&&console.log("HomeDevices received restart_not_required"),d(!1)),le(i)&&i.method==="state_update"&&i.params.plugin&&i.params.serialNumber&&i.params.cluster.includes("BasicInformationServer")&&i.params.attribute==="reachable"&&(console.log(`HomeDevices updating device reachability for plugin ${i.params.plugin} serial ${i.params.serialNumber} value ${i.params.value}`),p(u=>u.map(C=>C.pluginName===i.params.plugin&&C.serial===i.params.serialNumber?{...C,reachable:i.params.value}:C))),De(i)&&i.id===P.current&&i.method==="/api/settings"&&(a&&console.log(`HomeDevices (id: ${i.id}) received settings:`,i.response),R(i.response),d(i.response.matterbridgeInformation.restartRequired||i.response.matterbridgeInformation.fixedRestartRequired)),De(i)&&i.id===P.current&&i.method==="/api/plugins"&&(a&&console.log(`HomeDevices (id: ${i.id}) received ${i.response?.length} plugins:`,i.response),i.response)){let u=!0;for(const C of i.response)C.enabled===!0&&(C.loaded!==!0||C.started!==!0||C.error===!0)&&(u=!1);if(!u)return;a&&console.log("HomeDevices reset plugins, devices and selectDevices"),T(!1),S(i.response),p([]),b([]),n({id:P.current,sender:"HomeDevices",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}}),a&&console.log("HomeDevices sent /api/devices");for(const C of i.response)C.enabled===!0&&C.loaded===!0&&C.started===!0&&C.error!==!0&&(n({id:P.current,sender:"HomeDevices",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:C.name}}),a&&console.log(`HomeDevices sent /api/select/devices for plugin: ${C.name}`))}if(De(i)&&i.id===P.current&&i.method==="/api/devices"&&(a&&console.log(`HomeDevices (id: ${i.id}) received ${i.response?.length} devices:`,i.response),i.response)){for(const u of i.response)u.selected=h(u);p(i.response)}De(i)&&i.id===P.current&&i.method==="/api/select/devices"&&(a&&console.log(`HomeDevices (id: ${i.id}) received ${i.response?.length} selectDevices for plugin ${i.response&&i.response.length>0?i.response[0].pluginName:"without select devices"}:`,i.response),i.response&&i.response.length>0&&b(u=>{const C=u.filter(de=>de.pluginName!==i.response[0].pluginName),Z=i.response.map(de=>({...de,selected:h(de)}));return[...C,...Z]}))}};return l(m),a&&console.log(`HomeDevices added WebSocket listener id ${P.current}`),()=>{f(m),a&&console.log("HomeDevices removed WebSocket listener")}},[_,l,f,n,h]),o.useEffect(()=>{if($.length===0&&V.length===0){k([]);return}a&&console.log(`HomeDevices mixing devices (${$.length}) and selectDevices (${V.length})`);const m=[];for(const i of $)m.push(i);for(const i of V)$.find(u=>u.pluginName===i.pluginName&&u.serial.includes(i.serial))||m.push(i);m.length>0&&(k(m),a&&console.log(`HomeDevices mixed ${m.length} devices and selectDevices`))},[_,$,V,k]),o.useEffect(()=>{s&&(a&&console.log("HomeDevices sending /api/settings and /api/plugins requests"),n({id:P.current,sender:"HomeDevices",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),n({id:P.current,sender:"HomeDevices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[s,n]);const L=(m,i)=>{console.log(`handleCheckboxChange: checkbox changed to ${m.target.checked} for device ${i.name} serial ${i.serial}`),k(u=>{const C=u.findIndex(de=>de.pluginName===i.pluginName&&de.serial===i.serial);if(C<0)return console.error(`handleCheckboxChange: device not found ${i.name} serial ${i.serial}`),u;const Z=[...u];return Z[C]={...Z[C],selected:m.target.checked},Z}),m.target.checked?n({id:P.current,sender:"HomeDevices",method:"/api/command",src:"Frontend",dst:"Matterbridge",params:{command:"selectdevice",plugin:i.pluginName,serial:i.serial,name:i.name}}):n({id:P.current,sender:"HomeDevices",method:"/api/command",src:"Frontend",dst:"Matterbridge",params:{command:"unselectdevice",plugin:i.pluginName,serial:i.serial,name:i.name}})};return a&&console.log("HomeDevices rendering..."),s?e.jsx("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",width:"100%",flex:"1 1 auto",overflow:"hidden"},children:e.jsx(Ft,{name:"Devices",getRowKey:fn,rows:v,columns:D,footerLeft:N?"Waiting for the plugins to fully load...":`Registered devices: ${$.length.toString()}/${v.length.toString()}`,footerRight:t?"Restart required":""})}):e.jsx(Be,{})}const bn=o.memo(xn);function vn(){const[r,c]=o.useState(null),[s,n]=o.useState(null),[l,f]=o.useState([]),[j]=o.useState(localStorage.getItem("homePagePlugins")!=="false"),[t,d]=o.useState(localStorage.getItem("homePageMode")??"devices"),[N,T]=o.useState(""),[w,R]=o.useState(!1),[_,S]=o.useState(!1),[$,p]=o.useState(null),{addListener:V,removeListener:b,online:v,sendMessage:k,logFilterLevel:P,logFilterSearch:D,autoScroll:h,getUniqueId:L}=o.useContext(xe),m=o.useRef(L());return o.useEffect(()=>{const i=u=>{u.src==="Matterbridge"&&u.dst==="Frontend"&&(le(u)&&u.method==="refresh_required"&&u.params.changed==="settings"&&(a&&console.log(`Home received refresh_required: changed=${u.params.changed} and sending /api/settings request`),p(null),f([]),k({id:m.current,sender:"Home",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),k({id:m.current,sender:"Home",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})),De(u)&&u.method==="/api/settings"&&u.id===m.current&&(a&&console.log("Home received settings:",u.response),c(u.response.systemInformation),n(u.response.matterbridgeInformation),u.response.matterbridgeInformation.bridgeMode==="bridge"&&($||p("Matterbridge")),u.response.matterbridgeInformation.bridgeMode==="childbridge"&&l.length>0&&$===null&&!$&&l.length>0&&l[0].matter?.id&&p(l[0].matter.id),u.response.matterbridgeInformation.matterbridgeVersion&&T(`https://github.com/Luligu/matterbridge/blob/${u.response.matterbridgeInformation.matterbridgeVersion.includes("-dev-")?"dev":"main"}/CHANGELOG.md`),localStorage.getItem("frontendVersion")===null&&u.response.matterbridgeInformation.frontendVersion?localStorage.setItem("frontendVersion",u.response.matterbridgeInformation.frontendVersion):u.response.matterbridgeInformation.frontendVersion!==localStorage.getItem("frontendVersion")&&u.response.matterbridgeInformation.frontendVersion&&(localStorage.setItem("frontendVersion",u.response.matterbridgeInformation.frontendVersion),S(!0)),localStorage.getItem("matterbridgeVersion")===null?localStorage.setItem("matterbridgeVersion",u.response.matterbridgeInformation.matterbridgeVersion):u.response.matterbridgeInformation.matterbridgeVersion!==localStorage.getItem("matterbridgeVersion")&&(localStorage.setItem("matterbridgeVersion",u.response.matterbridgeInformation.matterbridgeVersion),R(!0)),u.response.matterbridgeInformation.shellyBoard&&(localStorage.getItem("homePageMode")||(localStorage.setItem("homePageMode","devices"),d("devices")))),De(u)&&u.method==="/api/plugins"&&u.id===m.current&&(a&&console.log(`Home received plugins (${s?.bridgeMode}):`,u.response),f(u.response),s?.bridgeMode==="childbridge"&&u.response.length>0&&!$&&u.response.length>0&&u.response[0].matter?.id&&p(u.response[0].matter.id)))};return V(i),a&&console.log(`Home added WebSocket listener id ${m.current}`),()=>{b(i),a&&console.log("Home removed WebSocket listener")}},[V,b,k,s,l,$]),o.useEffect(()=>{v&&(a&&console.log("Home received online"),k({id:m.current,sender:"Home",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),k({id:m.current,sender:"Home",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[v,k]),a&&console.log("Home rendering..."),!v||!r||!s?e.jsx(Be,{}):e.jsxs("div",{className:"MbfPageDiv",style:{flexDirection:"row"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",width:"302px",minWidth:"302px",gap:"20px"},children:[e.jsx(on,{id:$}),e.jsx(en,{systemInfo:r,compact:!0})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",width:"100%",gap:"20px"},children:[_&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Frontend Update"})}),e.jsxs("div",{className:"MbfWindowBody",style:{flexDirection:"row",justifyContent:"space-between"},children:[e.jsx("h4",{style:{margin:0},children:"The frontend has been updated. You are viewing an outdated web UI. Please refresh the page now."}),e.jsx("div",{children:e.jsx(oe,{onClick:()=>window.location.reload(),endIcon:e.jsx(Er,{}),style:{marginLeft:"10px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Refresh"})})]})]}),w&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge Update"})}),e.jsxs("div",{className:"MbfWindowBody",style:{flexDirection:"row",justifyContent:"space-between"},children:[e.jsx("h4",{style:{margin:0},children:"Matterbridge has been updated."}),e.jsxs("div",{children:[e.jsx(oe,{onClick:()=>window.open(N,"_blank"),endIcon:e.jsx(Xt,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Changelog"}),e.jsx(oe,{onClick:()=>window.location.reload(),endIcon:e.jsx(_r,{}),style:{marginLeft:"10px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Close"})]})]})]}),j&&!s.readOnly&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Install plugins"})}),e.jsx(an,{})]}),j&&e.jsx(hn,{storeId:$,setStoreId:p}),t==="devices"&&e.jsx(bn,{storeId:$,setStoreId:p}),t==="logs"&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"1 1 auto",width:"100%",overflow:"hidden"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",minHeight:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",children:"Logs"}),e.jsx("div",{className:"MbfWindowHeaderText",style:{display:"flex",justifyContent:"space-between"},children:e.jsxs("span",{style:{fontWeight:"normal",fontSize:"12px",marginTop:"2px"},children:['Filter: logger level "',P,'" and search "',D,'" Scroll: ',h?"auto":"manual"]})})]}),e.jsx("div",{style:{flex:"1 1 auto",margin:"0px",padding:"10px",overflow:"auto"},children:e.jsx(ar,{})})]})]})]})}const yn=o.memo(vn),Qt={display:"flex",gap:"2px",justifyContent:"space-evenly",width:"100%",height:"40px"},jn={margin:"0",padding:"0",fontSize:"36px",fontWeight:"medium",color:"var(--primary-color)"},Cn={margin:"0",padding:"0",fontSize:"20px",fontWeight:"medium",color:"var(--div-text-color)",textAlign:"center"},Jt={margin:"0",padding:"0",paddingBottom:"2px",fontSize:"16px",fontWeight:"medium",color:"var(--div-text-color)",textAlign:"center"},Sn={display:"flex",gap:"2px",justifyContent:"center",width:"100%",height:"18px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},wn={margin:"0",padding:"0",fontSize:"12px",fontWeight:"normal",color:"var(--div-text-color)"},Mn={display:"flex",justifyContent:"center",width:"100%",height:"52px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},kn={margin:"0",padding:"0",fontSize:"14px",fontWeight:"bold",color:"var(--div-text-color)"},In={display:"flex",gap:"4px",justifyContent:"center",width:"100%",height:"15px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},Pt={margin:"0",padding:"0px 4px",borderRadius:"5px",textAlign:"center",fontSize:"12px",fontWeight:"normal",color:"var(--secondary-color)"},Dn=[256,257,268,269],Nn=[266,267],Pn=[259,260,261,271,272],Wn=[256,257,268,269,266,267,259,260,261];function q({icon:r,iconColor:c,cluster:s,value:n,unit:l,prefix:f}){return a&&console.log(`Render cluster "${s.clusterName}.${s.attributeName}" value(${typeof n}-${isNaN(n)}) "${n}" unit "${l}"`),f=f??!1,e.jsxs(K,{sx:Qt,children:[r&&o.cloneElement(r,{key:`${s.clusterId}-${s.attributeId}-icon`,sx:{...jn,color:c??"var(--primary-color)"}}),e.jsxs(K,{sx:{...Qt,gap:"4px",alignContent:"center",alignItems:"end",justifyContent:"center"},children:[l&&f===!0&&e.jsx(ae,{sx:Jt,children:l},`${s.clusterId}-${s.attributeId}-unit`),e.jsx(ae,{sx:Cn,children:n==null||typeof n=="number"&&isNaN(n)||n==="NaN"?"---":n},`${s.clusterId}-${s.attributeId}-value`),l&&f===!1&&e.jsx(ae,{sx:Jt,children:l},`${s.clusterId}-${s.attributeId}-unit`)]},`${s.clusterId}-${s.attributeId}-valueunitbox`)]},`${s.clusterId}-${s.attributeId}-box`)}function Fn({device:r,endpoint:c,id:s,deviceType:n,clusters:l}){const f=["Unknown","Good","Fair","Moderate","Poor","VeryPoor","Ext.Poor"];let j="";return a&&console.log(`Device "${r.name}" endpoint "${c}" id "${s}" deviceType "0x${n.toString(16).padStart(4,"0")}" clusters (${l?.length}):`,l),n===17&&l.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="batVoltage").map(t=>j=`${t.attributeLocalValue} mV`),Wn.includes(n)&&l.filter(t=>t.clusterName==="LevelControl"&&t.attributeName==="currentLevel").map(t=>j=`Level ${t.attributeValue}`),n===514&&l.filter(t=>t.clusterName==="WindowCovering"&&t.attributeName==="currentPositionLiftPercent100ths").map(t=>j=`Position ${t.attributeValue/100}%`),n===769&&l.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="occupiedHeatingSetpoint").map(t=>j=`Heat ${t.attributeValue/100}°C `),n===769&&l.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="occupiedCoolingSetpoint").map(t=>j=j+`Cool ${t.attributeValue/100}°C`),n===118&&l.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="coState").map(t=>j=`${t.attributeLocalValue===0?"No CO detected":"CO alarm!"}`),n===1296&&l.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="voltage").map(t=>j=`${t.attributeLocalValue/1e3} V, `),n===1296&&l.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="activeCurrent").map(t=>j=j+`${t.attributeLocalValue/1e3} A, `),n===1296&&l.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="activePower").map(t=>j=j+`${t.attributeLocalValue/1e3} W`),e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0px",padding:"5px",width:"150px",height:"150px",borderColor:"var(--div-bg-color)",borderRadius:"5px",justifyContent:"space-between"},children:[n===19&&l.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(q,{icon:t.attributeLocalValue===!0?e.jsx(nt,{}):e.jsx(Vr,{}),iconColor:t.attributeLocalValue===!0?"green":"red",cluster:t,value:t.attributeLocalValue===!0?"Online":"Offline"})),n===17&&l.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="batPercentRemaining").map(t=>e.jsx(q,{icon:e.jsx(yt,{}),cluster:t,value:t.attributeValue/2,unit:"%"})),n===17&&l.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="wiredCurrentType").map(t=>e.jsx(q,{icon:e.jsx(er,{}),cluster:t,value:t.attributeLocalValue===0?"AC":"DC"})),n===1293&&l.filter(t=>t.clusterName==="DeviceEnergyManagement"&&t.attributeName==="esaState").map(t=>e.jsx(q,{icon:e.jsx(te,{path:vo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Offline":"Online"})),Dn.includes(n)&&l.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(q,{icon:e.jsx(Ar,{}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),Nn.includes(n)&&l.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(q,{icon:e.jsx(te,{path:yo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),Pn.includes(n)&&l.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(q,{icon:e.jsx(te,{path:jo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),n===115&&l.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(q,{icon:e.jsx(te,{path:Co,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),n===124&&l.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(q,{icon:e.jsx(te,{path:So,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),n===117&&l.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(q,{icon:e.jsx(te,{path:wo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),n===123&&l.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(q,{icon:e.jsx(Ot,{}),cluster:t,value:"Oven"})),n===112&&l.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(q,{icon:e.jsx(Ur,{}),cluster:t,value:"Fridge"})),n===113&&l.filter(t=>t.clusterName==="TemperatureControl"&&t.attributeName==="selectedTemperatureLevel").map(t=>e.jsx(q,{icon:e.jsx(te,{path:Mo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),n===121&&l.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(q,{icon:e.jsx(Ot,{}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),n===122&&l.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="fanMode").map(t=>e.jsx(q,{icon:e.jsx(te,{path:ko,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),n===120&&l.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(q,{icon:e.jsx(te,{path:Ut,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Cooktop"})),n===119&&l.filter(t=>t.clusterName==="TemperatureControl"&&t.attributeName==="selectedTemperatureLevel").map(t=>e.jsx(q,{icon:e.jsx(te,{path:Ut,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),n===116&&l.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(q,{icon:e.jsx(te,{path:Io,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Robot"})),n===514&&l.filter(t=>t.clusterName==="WindowCovering"&&t.attributeName==="currentPositionLiftPercent100ths").map(t=>e.jsx(q,{icon:e.jsx(zr,{}),cluster:t,value:t.attributeLocalValue/100,unit:"%"})),n===769&&l.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="localTemperature").map(t=>e.jsx(q,{icon:e.jsx(te,{path:Do,size:"40px",color:"var(--primary-color)"}),cluster:t,value:(t.attributeLocalValue??0)/100,unit:"°C"})),n===10&&l.filter(t=>t.clusterName==="DoorLock"&&t.attributeName==="lockState").map(t=>e.jsx(q,{icon:t.attributeValue==="1"?e.jsx(qr,{}):e.jsx(Br,{}),cluster:t,value:t.attributeValue==="1"?"Locked":"Unlocked"})),n===43&&l.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="percentCurrent").map(t=>e.jsx(q,{icon:e.jsx(Qr,{}),cluster:t,value:t.attributeValue,unit:"%"})),n===15&&l.filter(t=>t.clusterName==="Switch"&&t.attributeName==="currentPosition").map(t=>e.jsx(q,{icon:e.jsx(te,{path:No,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeValue,unit:"pos",prefix:!0})),n===39&&l.filter(t=>t.clusterName==="ModeSelect"&&t.attributeName==="currentMode").map(t=>e.jsx(q,{icon:e.jsx(Jr,{}),cluster:t,value:t.attributeValue,unit:"mode",prefix:!0})),n===771&&l.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(q,{icon:e.jsx(Gr,{}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),n===45&&l.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="percentCurrent").map(t=>e.jsx(q,{icon:e.jsx(Et,{}),cluster:t,value:t.attributeValue,unit:"%"})),n===114&&l.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="localTemperature").map(t=>e.jsx(q,{icon:e.jsx(Et,{}),cluster:t,value:(t.attributeLocalValue??0)/100,unit:"°C"})),n===67&&l.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(q,{icon:e.jsx(Kr,{}),cluster:t,value:t.attributeLocalValue===!0?"Leak":"No leak"})),n===65&&l.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(q,{icon:e.jsx(Yr,{}),cluster:t,value:t.attributeLocalValue===!0?"Freeze":"No freeze"})),n===68&&l.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(q,{icon:e.jsx(Xr,{}),cluster:t,value:t.attributeLocalValue===!0?"Rain":"No rain"})),n===1292&&l.filter(t=>t.clusterName==="EnergyEvse"&&t.attributeName==="state").map(t=>e.jsx(q,{icon:e.jsx(te,{path:Po,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Free":"In use"})),n===1295&&l.filter(t=>t.clusterName==="WaterHeaterManagement"&&t.attributeName==="tankPercentage").map(t=>e.jsx(q,{icon:e.jsx(te,{path:Wo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Tank "+(t.attributeLocalValue??0)+"%"})),n===777&&l.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="featureMap").map(t=>e.jsx(q,{icon:e.jsx(te,{path:Fo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"HeatPump"})),n===23&&l.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="featureMap").map(t=>e.jsx(q,{icon:e.jsx(te,{path:To,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Solar"})),n===24&&l.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="featureMap").map(t=>e.jsx(q,{icon:e.jsx(te,{path:Lo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Inverter"})),n===118&&l.find(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="featureMap"&&t.attributeLocalValue.smokeAlarm===!0)&&l.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="smokeState").map(t=>e.jsx(q,{icon:e.jsx(te,{path:zt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"No smoke":"Smoke!"})),n===118&&l.find(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="featureMap"&&t.attributeLocalValue.smokeAlarm===!1)&&l.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="coState").map(t=>e.jsx(q,{icon:e.jsx(te,{path:zt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"No Co":"Co!"})),n===66&&l.filter(t=>t.clusterName==="ValveConfigurationAndControl"&&t.attributeName==="currentState").map(t=>e.jsx(q,{icon:e.jsx(Zr,{}),cluster:t,value:t.attributeLocalValue===0?"Closed":"Opened"})),n===44&&l.filter(t=>t.clusterName==="AirQuality"&&t.attributeName==="airQuality").map(t=>e.jsx(q,{icon:e.jsx(te,{path:Ro,size:"40px",color:"var(--primary-color)"}),cluster:t,value:f[t.attributeLocalValue??0]})),n===770&&l.filter(t=>t.clusterName==="TemperatureMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(q,{icon:e.jsx(eo,{}),cluster:t,value:t.attributeLocalValue/100,unit:"°C"})),n===775&&l.filter(t=>t.clusterName==="RelativeHumidityMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(q,{icon:e.jsx(te,{path:Ho,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue/100,unit:"%"})),n===774&&l.filter(t=>t.clusterName==="FlowMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(q,{icon:e.jsx(to,{}),cluster:t,value:t.attributeLocalValue,unit:"l/h"})),n===773&&l.filter(t=>t.clusterName==="PressureMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(q,{icon:e.jsx(ro,{}),cluster:t,value:t.attributeLocalValue,unit:"hPa"})),n===21&&l.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(q,{icon:t.attributeValue==="true"?e.jsx(oo,{}):e.jsx(no,{}),cluster:t,value:t.attributeValue==="true"?"Closed":"Opened"})),n===263&&l.filter(t=>t.clusterName==="OccupancySensing"&&t.attributeName==="occupancy").map(t=>e.jsx(q,{icon:t.attributeValue==="{ occupied: true }"?e.jsx(io,{}):e.jsx(ao,{}),cluster:t,value:t.attributeValue==="{ occupied: true }"?"Occupied":"Unocc."})),n===262&&l.filter(t=>t.clusterName==="IlluminanceMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(q,{icon:e.jsx(so,{}),cluster:t,value:Math.round(Math.pow(10,t.attributeValue/1e4)),unit:"lx"})),n===1296&&l.filter(t=>t.clusterName==="ElectricalEnergyMeasurement"&&t.attributeName==="cumulativeEnergyImported").map(t=>e.jsx(q,{icon:e.jsx(lo,{}),cluster:t,value:Math.round(t.attributeLocalValue?.energy/1e6),unit:"kwh"})),e.jsx(K,{sx:Sn,children:e.jsx(ae,{sx:wn,children:j})}),e.jsx(K,{sx:Mn,children:e.jsx(ae,{sx:kn,children:r.name})}),e.jsxs(K,{sx:In,children:[a&&e.jsx(ae,{sx:Pt,children:c}),e.jsx(ae,{sx:Pt,children:s}),a&&e.jsxs(ae,{sx:Pt,children:["0x",n.toString(16).padStart(4,"0")]})]})]})}function Tn({filter:r}){const{online:c,sendMessage:s,addListener:n,removeListener:l,getUniqueId:f}=o.useContext(xe),[j,t]=o.useState({}),[d,N]=o.useState([]),[T,w]=o.useState([]),[R,_]=o.useState({}),[S,$]=o.useState({}),[p,V]=o.useState({}),[b,v]=o.useState(T),k=o.useRef(f());return o.useEffect(()=>{const P=D=>{if(D.src==="Matterbridge"&&D.dst==="Frontend"){if(D.method==="refresh_required"&&(a&&console.log(`DevicesIcons received refresh_required: changed=${D.params.changed} and sending api requests`),s({id:k.current,sender:"Icons",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),s({id:k.current,sender:"Icons",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),s({id:k.current,sender:"Icons",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}})),D.method==="/api/settings"&&D.response&&(a&&console.log("DevicesIcons received settings:",D.response),t(D.response)),D.method==="/api/plugins"&&D.response&&(a&&console.log("DevicesIcons received plugins:",D.response),N(D.response)),D.method==="/api/devices"&&D.response){a&&console.log(`DevicesIcons received ${D.response.length} devices:`,D.response),w(D.response);for(let h of D.response)a&&console.log("DevicesIcons sending /api/clusters"),s({id:k.current,sender:"Icons",method:"/api/clusters",src:"Frontend",dst:"Matterbridge",params:{plugin:h.pluginName,endpoint:h.endpoint}})}if(D.method==="/api/clusters"&&D.response){if(console.log(`DevicesIcons received for device "${D.response.deviceName}" serial "${D.response.serialNumber}" deviceType ${D.response.deviceTypes.join(" ")} clusters (${D.response.length}):`,D.response),D.response.length===0)return;const h=D.response.serialNumber;R[h]=[],S[h]=D.response.deviceTypes,p[h]=[];for(let L of D.response.clusters)R[h].find(m=>m.endpoint===L.endpoint)||R[h].push({endpoint:L.endpoint,id:L.id,deviceTypes:L.deviceTypes}),!["FixedLabel","Descriptor","Identify","Groups","PowerTopology"].includes(L.clusterName)&&p[h].push(L);_({...R}),$({...S}),V({...p}),a&&console.log(`DevicesIcons endpoints for "${h}":`,R[h]),a&&console.log(`DevicesIcons deviceTypes for "${h}":`,S[h]),a&&console.log(`DevicesIcons clusters for "${h}":`,p[h])}}};return n(P),a&&console.log("DevicesIcons useEffect webSocket mounted"),()=>{l(P),a&&console.log("DevicesIcons useEffect webSocket unmounted")}},[n,l,s]),o.useEffect(()=>(a&&console.log("DevicesIcons useEffect online mounting"),c&&(a&&console.log("DevicesIcons useEffect online sending api requests"),s({id:k.current,sender:"Icons",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),s({id:k.current,sender:"Icons",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),s({id:k.current,sender:"Icons",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}})),a&&console.log("DevicesIcons useEffect online mounted"),()=>{a&&console.log("DevicesIcons useEffect online unmounted")}),[c,s]),o.useEffect(()=>{if(r===""){v(T);return}const P=T.filter(D=>D.name.toLowerCase().includes(r)||D.serial.toLowerCase().includes(r));v(P)},[T,r]),a&&console.log("DevicesIcons rendering..."),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",paddingBottom:"5px",gap:"20px",width:"100%",overflow:"auto"},children:b.map(P=>R[P.serial]&&R[P.serial].map(D=>D.deviceTypes.map(h=>e.jsx(Fn,{device:P,endpoint:D.endpoint,id:D.id,deviceType:h,clusters:p[P.serial].filter(L=>L.endpoint===D.endpoint)}))))})}const Ln=o.memo(Tn),lr=[{Header:"Plugin name",accessor:"pluginName"},{Header:"Device type",accessor:"type"},{Header:"Endpoint",accessor:"endpoint"},{Header:"Name",accessor:"name"},{Header:"Serial number",accessor:"serial"},{Header:"Unique ID",accessor:"uniqueId"},{Header:"Url",accessor:"configUrl"},{Header:"Config",accessor:"configButton",noSort:!0,Cell:({row:r})=>r.original.configUrl?e.jsx(U,{onClick:()=>window.open(r.original.configUrl,"_blank"),"aria-label":"Open Config",sx:{margin:0,padding:0},children:e.jsx(it,{fontSize:"small"})}):null},{Header:"Cluster",accessor:"cluster"}],dr=[{Header:"Endpoint",accessor:"endpoint"},{Header:"Id",accessor:"id"},{Header:"Device Types",accessor:"deviceTypes",Cell:({value:r})=>Array.isArray(r)?r.map(c=>`0x${c.toString(16).padStart(4,"0")}`).join(", "):r},{Header:"Cluster Name",accessor:"clusterName"},{Header:"Cluster ID",accessor:"clusterId"},{Header:"Attribute Name",accessor:"attributeName"},{Header:"Attribute ID",accessor:"attributeId"},{Header:"Attribute Value",accessor:"attributeValue",Cell:({value:r})=>e.jsx(H,{title:r,componentsProps:{tooltip:{sx:{fontSize:"14px",fontWeight:"normal",color:"#ffffff",backgroundColor:"var(--primary-color)"}}},children:e.jsx("div",{style:{maxWidth:"500px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r})})}],Rn=r=>`${r.pluginName}::${r.uniqueId}`,Hn=r=>`${r.endpoint}::${r.clusterName}::${r.attributeName}`;function $n({data:r,columnVisibility:c,setPlugin:s,setEndpoint:n,setDeviceName:l}){const[f,j]=o.useState(null),t=o.useMemo(()=>lr.filter(S=>c[S.accessor]),[c]),{getTableProps:d,getTableBodyProps:N,headerGroups:T,rows:w,prepareRow:R}=St.useTable({columns:t,data:r,getRowId:Rn},St.useSortBy),_=S=>{if(S.id===f){j(null),s(null),n(null),l(null),a&&console.log("Device unclicked:",S.id,"selectedDeviceIndex:",f);return}j(S.id),s(S.original.pluginName),n(S.original.endpoint),l(S.original.name),a&&console.log("Device clicked:",S.id,"selectedDeviceIndex:",f,"pluginName:",S.original.pluginName,"endpoint:",S.original.endpoint)};return e.jsxs("table",{...d(),style:{margin:"-1px",border:"1px solid var(--table-border-color)"},children:[e.jsx("thead",{children:T.map(S=>e.jsx("tr",{...S.getHeaderGroupProps(),children:S.headers.map($=>e.jsxs("th",{...$.getHeaderProps($.noSort?void 0:$.getSortByToggleProps()),children:[$.render("Header"),!$.noSort&&e.jsx("span",{style:{margin:"0px",marginLeft:"5px",padding:"0px"},children:$.isSorted?$.isSortedDesc?e.jsx(te,{path:nr,size:"15px"}):e.jsx(te,{path:or,size:"15px"}):null})]}))}))}),e.jsx("tbody",{...N(),children:w.map((S,$)=>(R(S),e.jsx("tr",{className:$%2===0?"table-content-even":"table-content-odd",...S.getRowProps(),onClick:()=>_(S),style:{backgroundColor:f===S.id?"var(--table-selected-bg-color)":"",cursor:"pointer"},children:S.cells.map(p=>e.jsx("td",{...p.getCellProps(),children:p.render("Cell")}))})))})]})}function On({data:r,columnVisibility:c}){const s=o.useMemo(()=>dr.filter(d=>c[d.accessor]),[c]),{getTableProps:n,getTableBodyProps:l,headerGroups:f,rows:j,prepareRow:t}=St.useTable({columns:s,data:r,getRowId:Hn},St.useSortBy);return e.jsxs("table",{...n(),style:{margin:"-1px"},children:[e.jsx("thead",{children:f.map(d=>e.jsx("tr",{...d.getHeaderGroupProps(),children:d.headers.map(N=>e.jsx("th",{...N.getHeaderProps(),children:N.render("Header")}))}))}),e.jsx("tbody",{...l(),children:j.map((d,N)=>(t(d),e.jsx("tr",{className:N%2===0?"table-content-even":"table-content-odd",...d.getRowProps(),children:d.cells.map(T=>e.jsx("td",{...T.getCellProps(),children:T.render("Cell")}))})))})]})}function En(){const{online:r,sendMessage:c,addListener:s,removeListener:n,getUniqueId:l}=o.useContext(xe),[f,j]=o.useState([]),[t,d]=o.useState([]),[N,T]=o.useState(null),[w,R]=o.useState(null),[_,S]=o.useState(null),[$,p]=o.useState(0),[V,b]=o.useState(!1),[v,k]=o.useState({pluginName:!0,type:!0,endpoint:!0,name:!0,serial:!0,uniqueId:!1,configUrl:!1,configButton:!0,cluster:!0}),[P,D]=o.useState(!1),[h,L]=o.useState({endpoint:!0,id:!0,deviceTypes:!0,clusterName:!0,clusterId:!0,attributeName:!0,attributeId:!0,attributeValue:!0}),[m,i]=o.useState(""),[u,C]=o.useState(f),[Z,de]=o.useState("icon"),be=o.useRef(l());o.useEffect(()=>{const x=y=>{if(a&&console.log("Devices received WebSocket Message:",y),y.src==="Matterbridge"&&y.dst==="Frontend"&&(y.method==="refresh_required"&&y.params.changed==="devices"&&(a&&console.log(`Devices received refresh_required: changed=${y.params.changed} and sending /api/devices request`),c({id:be.current,sender:"Devices",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}})),y.method==="/api/devices"&&(a&&console.log(`Devices received ${y.response.length} devices:`,y.response),j(y.response)),y.method==="/api/clusters")){console.log(`Devices received ${y.response.length} clusters:`,y.response),d(y.response.clusters);const M={};for(const I of y.response.clusters)a&&console.log("Cluster:",I.endpoint),M[I.endpoint]?M[I.endpoint]++:M[I.endpoint]=1;p(Object.keys(M).length)}};return s(x),a&&console.log("Devices added WebSocket listener"),()=>{n(x),a&&console.log("Devices removed WebSocket listener")}},[s,n,c]),o.useEffect(()=>{r&&(a&&console.log("Devices sending api requests"),c({id:be.current,sender:"Devices",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:be.current,sender:"Devices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:be.current,sender:"Devices",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}}))},[r,c]),o.useEffect(()=>{N&&w&&(a&&console.log("Devices sending /api/clusters"),c({id:be.current,sender:"Devices",method:"/api/clusters",src:"Frontend",dst:"Matterbridge",params:{plugin:N,endpoint:w}}))},[N,w,c]);const ve=()=>{b(!V)},pe=x=>{k(y=>{const M={...y,[x]:!y[x]};return localStorage.setItem("devicesColumnVisibility",JSON.stringify(M)),M})};o.useEffect(()=>{const x=localStorage.getItem("devicesColumnVisibility");x&&k(JSON.parse(x))},[]);const Q=()=>{D(!P)},ne=x=>{L(y=>{const M={...y,[x]:!y[x]};return localStorage.setItem("clustersColumnVisibility",JSON.stringify(M)),M})};o.useEffect(()=>{const x=localStorage.getItem("clustersColumnVisibility");x&&L(JSON.parse(x))},[]);const F=x=>{i(x.target.value.toLowerCase()),localStorage.setItem("devicesFilter",x.target.value.toLowerCase())},O=x=>{de(x),localStorage.setItem("devicesViewMode",x)};return o.useEffect(()=>{if(m===""){C(f);return}const x=f.filter(y=>y.name.toLowerCase().includes(m)||y.serial.toLowerCase().includes(m));C(x)},[f,m]),o.useEffect(()=>{const x=localStorage.getItem("devicesFilter");x&&i(x)},[]),o.useEffect(()=>{const x=localStorage.getItem("devicesViewMode");x&&de(x)},[]),a&&console.log("Devices rendering..."),r?e.jsxs("div",{className:"MbfPageDiv",children:[e.jsxs("div",{className:"MbfWindowBodyRow",style:{justifyContent:"space-between",padding:0,gap:"20px",width:"100%",height:"45px",minHeight:"45px",maxHeight:"45px"},children:[e.jsxs(K,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx(ae,{sx:{fontSize:"16px",fontWeight:"normal",color:"var(--div-text-color)",marginLeft:"5px",whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(ce,{variant:"outlined",value:m,onChange:F,placeholder:"Enter the device name or serial number",sx:{width:"320px"},InputProps:{style:{backgroundColor:"var(--main-bg-color)"}}})]}),e.jsxs(K,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx(ae,{sx:{fontSize:"16px",fontWeight:"normal",color:"var(--div-text-color)",marginLeft:"5px",whiteSpace:"nowrap"},children:"View mode:"}),e.jsx(U,{onClick:()=>O("table"),"aria-label":"Table View",disabled:Z==="table",children:e.jsx(H,{title:"Table View",children:e.jsx(co,{style:{color:Z==="table"?"var(--main-icon-color)":"var(--primary-color)"}})})}),e.jsx(U,{onClick:()=>O("icon"),"aria-label":"Icon View",disabled:Z==="icon",children:e.jsx(H,{title:"Icon View (beta)",children:e.jsx(po,{style:{color:Z==="icon"?"var(--main-icon-color)":"var(--primary-color)"}})})})]})]}),e.jsxs(Pe,{open:V,onClose:ve,children:[e.jsx(We,{children:"Configure Devices Columns"}),e.jsx(Fe,{children:e.jsx(Wt,{children:lr.map(x=>e.jsx(He,{control:e.jsx($e,{disabled:["pluginName","name","configButton"].includes(x.accessor),checked:v[x.accessor],onChange:()=>pe(x.accessor)}),label:x.Header},x.accessor))})}),e.jsx(_e,{children:e.jsx(oe,{onClick:ve,children:"Close"})})]}),Z==="table"&&e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",maxHeight:`${N&&w?"50%":"100%"}`,width:"100%",flex:"1 1 auto",overflow:"hidden"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Registered devices"}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(U,{onClick:ve,"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(H,{title:"Configure columns",children:e.jsx(it,{style:{color:"var(--header-text-color)",fontSize:"19px"}})})})})]}),e.jsx("div",{className:"MbfWindowBodyColumn",style:{margin:"0",padding:"0",gap:"0"},children:e.jsx($n,{data:u,columnVisibility:v,setPlugin:T,setEndpoint:R,setDeviceName:S})}),e.jsx("div",{className:"MbfWindowFooter",style:{borderTop:"1px solid var(--table-border-color)",justifyContent:"flex-start"},children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontWeight:"normal",textAlign:"left"},children:["Total devices: ",u.length.toString()]})})]}),e.jsxs(Pe,{open:P,onClose:Q,children:[e.jsx(We,{children:"Configure Clusters Columns"}),e.jsx(Fe,{children:e.jsx(Wt,{children:dr.map(x=>e.jsx(He,{control:e.jsx($e,{disabled:["clusterName","attributeName","attributeValue"].includes(x.accessor),checked:h[x.accessor],onChange:()=>ne(x.accessor)}),label:x.Header},x.accessor))})}),e.jsx(_e,{children:e.jsx(oe,{onClick:Q,children:"Close"})})]}),Z==="table"&&N&&w&&e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",height:"50%",maxHeight:"50%",width:"100%",flex:"1 1 auto",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsxs("div",{className:"MbfWindowHeaderText",style:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[e.jsxs("p",{style:{margin:"0px",padding:"0px"},children:['Clusters for device "',_,'" on endpoint ',w]}),e.jsx(U,{onClick:Q,"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(H,{title:"Configure columns",children:e.jsx(it,{style:{color:"var(--header-text-color)",fontSize:"19px"}})})})]})}),e.jsx("div",{className:"MbfWindowBodyColumn",style:{margin:"0",padding:"0",gap:"0"},children:e.jsx(On,{data:t,columnVisibility:h})}),e.jsx("div",{className:"MbfWindowFooter",style:{borderTop:"1px solid var(--table-border-color)",justifyContent:"flex-start"},children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontWeight:"normal",textAlign:"left"},children:["Total child endpoints: ",$-1]})})]}),Z==="icon"&&e.jsx(Ln,{filter:m,devices:u})]}):e.jsx(Be,{})}const _n=o.memo(En);function Vn(){const[r,c]=o.useState(localStorage.getItem("logFilterLevel")??"info"),[s,n]=o.useState(localStorage.getItem("logFilterSearch")??"*"),[l,f]=o.useState(localStorage.getItem("logAutoScroll")!=="false"),{setMessages:j,setLogFilters:t,online:d,setAutoScroll:N}=o.useContext(xe),T=S=>{c(S.target.value),t(S.target.value,s),localStorage.setItem("logFilterLevel",S.target.value),a&&console.log("handleChangeLevel called with value:",S.target.value)},w=S=>{n(S.target.value),t(r,S.target.value),localStorage.setItem("logFilterSearch",S.target.value),a&&console.log("handleChangeSearch called with value:",S.target.value)},R=S=>{f(S.target.checked),N(S.target.checked),localStorage.setItem("logAutoScroll",S.target.value?"true":"false"),a&&console.log("handleAutoScrollChange called with value:",S.target.checked)},_=()=>{a&&console.log("handleClearLogsClick called"),j([])};return a&&console.log("Logs rendering..."),d?e.jsxs("div",{className:"MbfPageDiv",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",margin:"0px",padding:"0px",gap:"10px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(_t,{id:"select-level",style:{color:"var(--div-text-color)"},children:"Filter log by level:"}),e.jsxs(tt,{style:{height:"30px",backgroundColor:"var(--main-bg-color)"},labelId:"select-level",id:"debug-level",value:r,onChange:T,children:[e.jsx(W,{value:"debug",children:"Debug"}),e.jsx(W,{value:"info",children:"Info"}),e.jsx(W,{value:"notice",children:"Notice"}),e.jsx(W,{value:"warn",children:"Warn"}),e.jsx(W,{value:"error",children:"Error"}),e.jsx(W,{value:"fatal",children:"Fatal"})]}),e.jsx(_t,{id:"search",style:{color:"var(--div-text-color)"},children:"Filter log by text:"}),e.jsx(ce,{style:{width:"300px"},size:"small",id:"logsearch",variant:"outlined",value:s,onChange:w,InputProps:{style:{height:"30px",padding:"0 0px",backgroundColor:"var(--main-bg-color)"}}}),e.jsx(He,{control:e.jsx($e,{checked:l,onChange:R}),label:"Auto scroll",style:{color:"var(--div-text-color)"}})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:e.jsx(H,{title:"Clear the logs",children:e.jsx(oe,{onClick:_,endIcon:e.jsx(jt,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Clear"})})})]}),e.jsx("div",{style:{flex:"1",overflow:"auto",margin:"0px",padding:"0px"},children:e.jsx(ar,{})})]}):e.jsx(Be,{})}const An=({open:r,ip:c,onClose:s,onSave:n})=>{const l=c?c.split(".").slice(0,3).join(".")+".1":"",[f,j]=o.useState("dhcp"),[t,d]=o.useState({ip:c??"",subnet:"255.255.255.0",gateway:l,dns:l}),N=R=>_=>{d({...t,[R]:_.target.value})},T=()=>{s()},w=()=>{const R=f==="static"?{type:f,...t}:{type:f};n(R),s()};return e.jsxs(Pe,{open:r,onClose:(R,_)=>{_==="backdropClick"||_==="escapeKeyDown"||s()},maxWidth:"sm",style:{maxWidth:"550px",margin:"auto"},children:[e.jsx(We,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:"Network Configuration"})]})}),e.jsxs(Fe,{dividers:!0,children:[e.jsxs(tr,{component:"fieldset",fullWidth:!0,children:[e.jsx(Ie,{component:"legend",children:"Select IP Configuration"}),e.jsxs(rr,{row:!0,value:f,onChange:R=>j(R.target.value),children:[e.jsx(He,{value:"dhcp",control:e.jsx(Ct,{}),label:"DHCP"}),e.jsx(He,{value:"static",control:e.jsx(Ct,{}),label:"Static"})]})]}),f==="static"&&e.jsxs(Ae,{container:!0,spacing:2,sx:{mt:2},children:[e.jsx(Ae,{size:6,children:e.jsx(ce,{label:"IP Address",fullWidth:!0,value:t.ip,onChange:N("ip")})}),e.jsx(Ae,{size:6,children:e.jsx(ce,{label:"Subnet Mask",fullWidth:!0,value:t.subnet,onChange:N("subnet")})}),e.jsx(Ae,{size:6,children:e.jsx(ce,{label:"Gateway",fullWidth:!0,value:t.gateway,onChange:N("gateway")})}),e.jsx(Ae,{size:6,children:e.jsx(ce,{label:"DNS Server",fullWidth:!0,value:t.dns,onChange:N("dns")})})]})]}),e.jsxs(_e,{children:[e.jsx(oe,{onClick:T,children:"Cancel"}),e.jsx(oe,{variant:"contained",onClick:w,children:"Save"})]})]})},Un=({open:r,onClose:c,onSave:s})=>{const[n,l]=o.useState(""),[f,j]=o.useState(""),t=_=>{l(_.target.value)},d=_=>{j(_.target.value)},N=n.length>0&&n===f,T=()=>{c()},w=()=>{N&&(s(n),c())},R=()=>{s(""),c()};return e.jsxs(Pe,{open:r,onClose:(_,S)=>{S==="backdropClick"||S==="escapeKeyDown"||c()},maxWidth:"sm",style:{maxWidth:"500px",margin:"auto"},disableEscapeKeyDown:!0,children:[e.jsx(We,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:"Change Password"})]})}),e.jsx(Fe,{dividers:!0,children:e.jsx(tr,{component:"fieldset",fullWidth:!0,sx:{margin:0,padding:0,gap:"20px"},children:e.jsxs(Ae,{container:!0,spacing:2,sx:{mt:2},children:[e.jsx(Ae,{size:12,children:e.jsx(ce,{type:"password",autoComplete:"new-password",label:"New Password",size:"small",variant:"outlined",fullWidth:!0,value:n,onChange:t})}),e.jsx(Ae,{size:12,children:e.jsx(ce,{type:"password",autoComplete:"new-password",label:"Confirm Password",size:"small",variant:"outlined",fullWidth:!0,value:f,onChange:d,error:f!==""&&n!==f,helperText:f!==""&&n!==f?"Passwords do not match":""})})]})})}),e.jsxs(_e,{children:[e.jsx(oe,{onClick:T,children:"Cancel"}),e.jsx(oe,{variant:"contained",onClick:w,disabled:!N,children:"Change"}),e.jsx(oe,{variant:"contained",onClick:R,children:"Reset"})]})]})};function zn(){const{online:r,addListener:c,removeListener:s,sendMessage:n,getUniqueId:l}=o.useContext(xe),[f,j]=o.useState(null),[t,d]=o.useState(null),N=o.useRef(l());return o.useEffect(()=>{const T=w=>{w.src==="Matterbridge"&&w.dst==="Frontend"&&(w.method==="refresh_required"&&w.params.changed==="settings"&&(a&&console.log(`Settings received refresh_required: changed=${w.params.changed} and sending /api/settings request`),n({id:N.current,sender:"Settings",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),w.method==="/api/settings"&&(a&&console.log("Settings received /api/settings:",w.response),j(w.response.matterbridgeInformation),d(w.response.systemInformation)))};return c(T),a&&console.log("Settings added WebSocket listener"),()=>{s(T),a&&console.log("Settings removed WebSocket listener")}},[c,s,n]),o.useEffect(()=>{r&&(a&&console.log("Settings received online"),n({id:N.current,sender:"Settings",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}))},[r,n]),f?(a&&console.log("Settings rendering..."),r?e.jsx("div",{className:"MbfPageDiv",children:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"20px",width:"100%"},children:[e.jsx(qn,{matterbridgeInfo:f,systemInfo:t}),e.jsx(Bn,{matterbridgeInfo:f}),e.jsx(Qn,{matterbridgeInfo:f})]})}):e.jsx(Be,{})):null}function qn({matterbridgeInfo:r,systemInfo:c}){const{sendMessage:s,getUniqueId:n}=o.useContext(xe),[l,f]=o.useState("bridge"),[j,t]=o.useState("Info"),[d,N]=o.useState(!1),[T,w]=o.useState("dark"),[R,_]=o.useState(localStorage.getItem("homePagePlugins")!=="false"),[S,$]=o.useState(localStorage.getItem("homePageMode")??"logs"),[p,V]=o.useState(localStorage.getItem("virtualMode")??"outlet"),b=o.useRef(n()),[v,k]=o.useState(!1),P=()=>k(!1),D=Q=>{a&&console.log("handleSaveNetConfig called with config:",Q),s({id:b.current,sender:"Settings",method:"/api/shellynetconfig",src:"Frontend",dst:"Matterbridge",params:Q})},[h,L]=o.useState(!1),m=()=>L(!1),i=Q=>{a&&console.log("handleSaveChangePassword called with password:",Q),s({id:b.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setpassword",value:Q}})};o.useEffect(()=>{r.bridgeMode!==void 0&&(f(r.bridgeMode==="bridge"?"bridge":"childbridge"),t(r.loggerLevel.charAt(0).toUpperCase()+r.loggerLevel.slice(1)),N(r.fileLogger),V(r.virtualMode))},[r]),o.useEffect(()=>{const Q=localStorage.getItem("frontendTheme");Q&&w(Q)},[]);const u=Q=>{a&&console.log("handleChangeBridgeMode called with value:",Q.target.value),f(Q.target.value),s({id:b.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setbridgemode",value:Q.target.value}})},C=Q=>{a&&console.log("handleChangeMbLoggerLevel called with value:",Q.target.value),t(Q.target.value),s({id:b.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmbloglevel",value:Q.target.value}})},Z=Q=>{a&&console.log("handleLogOnFileMbChange called with value:",Q.target.checked),N(Q.target.checked),s({id:b.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmblogfile",value:Q.target.checked}})},de=Q=>{const ne=Q.target.value;a&&console.log("handleChangeTheme called with value:",ne),w(ne),localStorage.setItem("frontendTheme",ne),document.body.setAttribute("frontend-theme",ne)},be=Q=>{const ne=Q.target.checked;a&&console.log("handleChangeHomePagePlugins called with value:",ne),_(ne),localStorage.setItem("homePagePlugins",ne?"true":"false")},ve=Q=>{const ne=Q.target.value;a&&console.log("handleChangeHomePageMode called with value:",ne),$(ne),localStorage.setItem("homePageMode",ne)},pe=Q=>{const ne=Q.target.value;a&&console.log("handleChangeVirtualMode called with value:",ne),V(ne),localStorage.setItem("virtualMode",ne),s({id:b.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setvirtualmode",value:ne}})};return e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge settings"})}),e.jsx(An,{open:v,ip:c.ipv4Address,onClose:P,onSave:D}),e.jsx(Un,{open:h,onClose:m,onSave:i}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(K,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},id:"matterbridgeInfo-mode",children:"Matterbridge mode:"}),e.jsxs(rr,{row:!0,name:"mode-buttons-group",value:l,onChange:u,children:[e.jsx(He,{value:"bridge",control:e.jsx(Ct,{}),label:"Bridge",disabled:r.readOnly===!0}),e.jsx(He,{value:"childbridge",control:e.jsx(Ct,{}),label:"Childbridge",disabled:r.readOnly===!0})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},id:"mblogger-level-label",children:"Logger level:"}),e.jsxs(tt,{style:{height:"30px"},labelId:"mblogger-level-label",id:"mblogger-level",value:j,onChange:C,children:[e.jsx(W,{value:"Debug",children:"Debug"}),e.jsx(W,{value:"Info",children:"Info"}),e.jsx(W,{value:"Notice",children:"Notice"}),e.jsx(W,{value:"Warn",children:"Warn"}),e.jsx(W,{value:"Error",children:"Error"}),e.jsx(W,{value:"Fatal",children:"Fatal"})]}),e.jsx(He,{style:{padding:"0px",margin:"0px"},control:e.jsx($e,{checked:d,onChange:Z,name:"logOnFileMb"}),label:"Log on file:",labelPlacement:"start"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},id:"frontend-theme-label",children:"Frontend theme:"}),e.jsxs(tt,{style:{height:"30px"},labelId:"frontend-theme-label",id:"frontend-theme",value:T,onChange:de,children:[e.jsx(W,{value:"classic",children:"Classic"}),e.jsx(W,{value:"light",children:"Light"}),e.jsx(W,{value:"dark",children:"Dark"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},id:"frontend-home-plugin-label",children:"Home page plugins:"}),e.jsx($e,{checked:R,onChange:be,name:"showPlugins"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},id:"frontend-home-label",children:"Home page bottom panel:"}),e.jsxs(tt,{style:{height:"30px"},labelId:"frontend-home-label",id:"frontend-home",value:S,onChange:ve,children:[e.jsx(W,{value:"logs",children:"Logs"}),e.jsx(W,{value:"devices",children:"Devices"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"10px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},id:"frontend-virtual-label",children:"Virtual devices:"}),e.jsxs(tt,{style:{height:"30px"},labelId:"frontend-virtual-label",id:"frontend-virtual",value:p,onChange:pe,children:[e.jsx(W,{value:"disabled",children:"Disabled"}),e.jsx(W,{value:"outlet",children:"Outlet"}),e.jsx(W,{value:"light",children:"Light"}),e.jsx(W,{value:"switch",children:"Switch"}),e.jsx(W,{value:"mounted_switch",children:"Mounted Switch"})]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"20px"},children:e.jsx(oe,{variant:"contained",color:"primary",onClick:()=>L(!0),children:"Change password"})}),r.shellyBoard&&e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"20px"},children:e.jsx(oe,{variant:"contained",color:"primary",onClick:()=>k(!0),children:"Configure IP"})})]})})]})}function Bn({matterbridgeInfo:r}){const{sendMessage:c,getUniqueId:s}=o.useContext(xe),[n,l]=o.useState("Info"),[f,j]=o.useState(!1),[t,d]=o.useState(""),[N,T]=o.useState(""),[w,R]=o.useState(""),[_,S]=o.useState(),[$,p]=o.useState(),[V,b]=o.useState(),v=o.useRef(s());o.useEffect(()=>{r.bridgeMode!==void 0&&(l(["Debug","Info","Notice","Warn","Error","Fatal"][r.matterLoggerLevel]),j(r.matterFileLogger),d(r.matterMdnsInterface),T(r.matterIpv4Address),R(r.matterIpv6Address),S(r.matterPort),p(r.matterDiscriminator),b(r.matterPasscode))},[r]);const k=C=>{a&&console.log("handleChangeMjLoggerLevel called with value:",C.target.value),l(C.target.value),c({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmjloglevel",value:C.target.value}})},P=C=>{a&&console.log("handleLogOnFileMjChange called with value:",C.target.checked),j(C.target.checked),c({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmjlogfile",value:C.target.checked}})},D=C=>{a&&console.log("handleChangeMdnsInterface called with value:",C.target.value),d(C.target.value),c({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmdnsinterface",value:C.target.value}})},h=C=>{a&&console.log("handleChangeIpv4Address called with value:",C.target.value),T(C.target.value),c({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setipv4address",value:C.target.value}})},L=C=>{a&&console.log("handleChangeIpv6Address called with value:",C.target.value),R(C.target.value),c({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setipv6address",value:C.target.value}})},m=C=>{a&&console.log("handleChangeMatterPort called with value:",C.target.value),S(C.target.value),c({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterport",value:C.target.value}})},i=C=>{a&&console.log("handleChangeMatterDiscriminator called with value:",C.target.value),p(C.target.value),c({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterdiscriminator",value:C.target.value}})},u=C=>{a&&console.log("handleChangemMatterPasscode called with value:",C.target.value),b(C.target.value),c({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterpasscode",value:C.target.value}})};return e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matter settings"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(K,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},id:"mjdebug-info",children:"Logger level:"}),e.jsxs(tt,{style:{height:"30px"},labelId:"select-mjlevel",id:"mjdebug-level",value:n,onChange:k,children:[e.jsx(W,{value:"Debug",children:"Debug"}),e.jsx(W,{value:"Info",children:"Info"}),e.jsx(W,{value:"Notice",children:"Notice"}),e.jsx(W,{value:"Warn",children:"Warn"}),e.jsx(W,{value:"Error",children:"Error"}),e.jsx(W,{value:"Fatal",children:"Fatal"})]}),e.jsx(He,{style:{padding:"0px",margin:"0px"},control:e.jsx($e,{checked:f,onChange:P,name:"logOnFileMj"}),label:"Log on file:",labelPlacement:"start"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},children:"Mdns interface:"}),e.jsx(ce,{value:t,onChange:D,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:r.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},children:"Ipv4 address:"}),e.jsx(ce,{value:N,onChange:h,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:r.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},children:"Ipv6 address:"}),e.jsx(ce,{value:w,onChange:L,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:r.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},children:"Commissioning port:"}),e.jsx(ce,{value:_,onChange:m,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:r.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},children:"Commissioning discriminator:"}),e.jsx(ce,{value:$,onChange:i,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:r.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},children:"Commissioning passcode:"}),e.jsx(ce,{value:V,onChange:u,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:r.readOnly===!0,style:{height:"30px",padding:"0"}}})]})]})})]})}function Qn({matterbridgeInfo:r}){return e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge info"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(K,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:["          ",e.jsx(qe,{value:r.matterbridgeVersion,label:"Current Version"}),e.jsx(qe,{value:r.matterbridgeLatestVersion,label:"Latest Version"}),e.jsx(qe,{value:r.homeDirectory,label:"Home Directory"}),e.jsx(qe,{value:r.rootDirectory,label:"Root Directory"}),e.jsx(qe,{value:r.matterbridgeDirectory,label:"Matterbridge Storage Directory"}),e.jsx(qe,{value:r.matterbridgePluginDirectory,label:"Matterbridge Plugin Directory"}),e.jsx(qe,{value:r.globalModulesDirectory,label:"Global Module Directory"})]})})]})}function qe({value:r,label:c}){return e.jsx(ce,{focused:!0,value:r,size:"small",label:c,variant:"standard",sx:{width:"400px"},InputProps:{readOnly:!0,sx:{color:"var(--div-text-color)","&:before":{borderBottomColor:"var(--main-label-color)"},"&:after":{borderBottomColor:"var(--main-label-color)"}}},InputLabelProps:{sx:{marginTop:"3px",color:"var(--main-label-color)","&.Mui-focused":{color:"var(--main-label-color)"}}}})}function Jn(){const{online:r,sendMessage:c,addListener:s,removeListener:n,getUniqueId:l}=o.useContext(xe),{showSnackbarMessage:f,closeSnackbarMessage:j}=o.useContext(rt),[t,d]=o.useState(null),[N,T]=o.useState([]),[w,R]=o.useState([]),[_,S]=o.useState(null),[$,p]=o.useState({cpuUsage:0}),[V,b]=o.useState({totalMemory:"",freeMemory:"",heapTotal:"",heapUsed:"",external:"",arrayBuffers:"",rss:""}),[v,k]=o.useState({systemUptime:"",processUptime:""}),P=o.useRef(-1),[D,h]=o.useState(()=>cr);P.current||(P.current=l(),console.log("Test uniqueId:",P)),o.useEffect(()=>{console.log("Test useEffect WebSocketMessage mounting");const m=i=>{if(i.src==="Matterbridge"&&i.dst==="Frontend"){if(le(i)&&i.method==="restart_required"&&(console.log("Test received restart_required"),f("Restart required",0)),le(i)&&i.method==="refresh_required"&&(console.log(`Test received refresh_required: changed=${i.params.changed} and sending api requests`),f("Refresh required",0),c({id:P.current,method:"/api/settings",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:P.current,method:"/api/plugins",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:P.current,method:"/api/devices",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}})),le(i)&&i.method==="memory_update"&&(console.log("Test received memory_update",i),b(i.params)),le(i)&&i.method==="cpu_update"&&(console.log("Test received cpu_update",i),p(i.params)),le(i)&&i.method==="uptime_update"&&(console.log("Test received uptime_update",i),k(i.params)),De(i)&&i.method==="/api/settings"&&i.response&&(console.log("Test received /api/settings:",i.response),f("Test received /api/settings"),d(i.response)),De(i)&&i.method==="/api/plugins"&&i.response&&(console.log(`Test received ${i.response.length} plugins:`,i.response),f("Test received /api/plugins"),T(i.response)),De(i)&&i.method==="/api/devices"&&i.response){console.log(`Test received ${i.response.length} devices:`,i.response),f("Test received /api/devices"),R(i.response);for(const u of i.response)console.log("Test sending /api/clusters for device:",u.pluginName,u.name,u.endpoint),c({id:P.current,method:"/api/clusters",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{plugin:u.pluginName,endpoint:u.endpoint||0}})}De(i)&&i.method==="/api/clusters"&&i.response&&(console.log(`Test received ${i.response.clusters.length} clusters for device ${i.response.deviceName} endpoint ${i.response.endpoint}:`,i),f("Test received /api/clusters"),S(i.response))}};return s(m),console.log("Test useEffect WebSocketMessage mounted"),()=>{console.log("Test useEffect WebSocketMessage unmounting"),n(m),console.log("Test useEffect WebSocketMessage unmounted")}},[s,n,c,f]),o.useEffect(()=>(console.log("Test useEffect online mounting"),r&&(console.log("Test useEffect online received online"),c({id:P.current,method:"/api/settings",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:P.current,method:"/api/plugins",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:P.current,method:"/api/devices",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}})),console.log("Test useEffect online mounted"),()=>{console.log("Test useEffect online unmounted")}),[r,c,f]);const L=o.useCallback(m=>String(m.code),[]);return console.log("Test rendering..."),r?e.jsx("div",{className:"MbfPageDiv",style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"20px",width:"100%"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"256px",width:"256px",margin:"10px"}}),e.jsx("p",{children:"Welcome to the Test page of the Matterbridge frontend"}),e.jsx("div",{style:{margin:"0",padding:"0",gap:"0",width:"1200px",maxWidth:"1200px",height:"600px",maxHeight:"600px",overflow:"hidden",backgroundColor:"var(--div-bg-color)",border:"1px solid #0004ffff"},children:e.jsx(Ft,{name:"Test",columns:Kn,rows:D,getRowKey:L,footerLeft:"Left Footer",footerRight:"Right Footer"})}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx(oe,{variant:"contained",color:"primary",onClick:()=>{console.log("Test button clicked"),f("Test button clicked"),j("Refresh required"),j("Restart required"),j("Test permanent message removal")},children:"Test"}),e.jsx(oe,{variant:"outlined",onClick:()=>{h(m=>{const i=m.findIndex(de=>de.code==="F123");if(i===-1)return m;const u=m[i],C={...u,population:(u.population||0)+1},Z=m.slice();return Z[i]=C,Z})},children:"Update F123"})]})]})}):e.jsx(Be,{})}const Gn=o.memo(Jn),Kn=[{id:"name",label:"Name",minWidth:50,maxWidth:100,required:!0},{id:"code",label:"ISO Code",minWidth:100,render:(r,c,s,n)=>e.jsx("span",{style:{display:"inline-block",padding:"2px 6px",borderRadius:"8px",backgroundColor:"var(--chip-bg, #e6f4ff)",color:"var(--chip-fg, #0550ae)",fontFamily:'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',fontSize:"0.85em"},children:String(r)})},{id:"isIsland",label:"Island",minWidth:80,align:"center"},{id:"population",label:"Population",minWidth:170,align:"right",format:r=>r.toLocaleString("en-US")},{id:"size",label:"Size (km²)",minWidth:170,align:"right",format:r=>r.toLocaleString("en-US")},{id:"density",label:"Density",minWidth:170,align:"right",noSort:!0,format:r=>r.toFixed(2)},{id:"virtual",label:"Virtual",align:"right",required:!0,noSort:!0,render:(r,c,s,n)=>s.isIsland?"🏝️":"🏞️"}];function we(r,c,s,n,l){const f=s/n;return{name:r,code:c,population:s,size:n,density:f,isIsland:l}}const cr=[we("India","IN",1324171354,3287263,!1),we("China","CN",1403500365,9596961,!1),we("Italy","IT",60483973,301340,!1),we("United States","US",327167434,9833520,!1),we("Canada is a truly wonderful country","CA",37602103,9984670,!1),we("Australia","AU",25475400,7692024,!0),we("Germany","DE",83019200,357578,!1),we("Ireland","IE",4857e3,70273,!0),we("Mexico","MX",126577691,1972550,!1),we("Japan","JP",126317e3,377973,!0),we("France","FR",67022e3,640679,!1),we("United Kingdom","GB",67545757,242495,!0),we("Russia","RU",146793744,17098246,!1),we("Nigeria","NG",200962417,923768,!1),we("Brazil","BR",210147125,8515767,!1)],Gt=["Zor","Eld","Myth","Drak","Lum","Xen","Thal","Quor","Vex","Nyx"],Kt=["aria","dor","mere","land","wyn","gard","heim","quess","tor","vale"];for(let r=0;r<2e3;r++){const c=`${Gt[r%Gt.length]}${Kt[r%Kt.length]} ${r}`,s=`F${r.toString().padStart(3,"0")}`,n=Math.floor(Math.random()*1e9),l=Math.floor(Math.random()*1e7),f=Math.random()<.2;cr.push(we(c,s,n,l,f))}function Yn(r,c){a&&console.log("getCssVariable:",r,"defaultValue",c);const s=getComputedStyle(document.body).getPropertyValue(r).trim();return s||console.error("getCssVariable: undefined",s),s||c}function Xn(r){return uo({palette:{primary:{main:r},action:{disabled:"var(--main-label-color)"},text:{disabled:"var(--main-label-color)"}},typography:{fontFamily:"Roboto, Helvetica, Arial, sans-serif"},components:{MuiDialog:{styleOverrides:{paper:{color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",border:"2px solid var(--div-border-color)",borderRadius:"var(--div-border-radius)",boxShadow:"2px 2px 5px var(--div-shadow-color)"}}},MuiTooltip:{defaultProps:{placement:"top-start",arrow:!0}},MuiButton:{styleOverrides:{root:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)","&:hover":{backgroundColor:"var(--main-button-bg-color)"},"&.Mui-disabled":{color:"var(--main-button-color)",backgroundColor:"var(--main-grey-color)"}},contained:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},outlined:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},text:{color:"var(--main-button-color)"}},defaultProps:{variant:"contained",size:"small"}},MuiIconButton:{styleOverrides:{root:{color:"var(--main-icon-color)","&:hover .MuiSvgIcon-root":{color:"var(--primary-color)"}}}},MuiCheckbox:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-checked":{color:"var(--primary-color)"}}}},MuiTextField:{defaultProps:{size:"small",variant:"outlined",fullWidth:!0}},MuiOutlinedInput:{styleOverrides:{root:{backgroundColor:"var(--div-bg-color)","& .MuiOutlinedInput-notchedOutline":{borderColor:"var(--main-label-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--main-text-color)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"var(--primary-color)"},padding:"0px"},input:{color:"var(--div-text-color)",padding:"4px 8px"}}},MuiInputLabel:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-focused":{color:"var(--primary-color)"}}}},MuiFormLabel:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-focused":{color:"var(--main-label-color)"}}}},MuiFormControl:{styleOverrides:{root:{color:"var(--main-grey-color)"}}},MuiRadio:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-checked":{color:"var(--primary-color)"}}}},MuiSelect:{styleOverrides:{root:{backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)",height:"30px","&:hover":{borderColor:"var(--main-text-color)"},"&.Mui-focused":{borderColor:"var(--primary-color)"}}}},MuiMenu:{styleOverrides:{paper:{backgroundColor:"var(--main-menu-bg-color)",padding:"0px",margin:"0px"},list:{padding:"0px"}}},MuiMenuItem:{styleOverrides:{root:{color:"var(--main-menu-color)",backgroundColor:"var(--main-menu-bg-color)","&:hover":{backgroundColor:"var(--main-menu-hover-color)"},"&.Mui-selected":{color:"var(--main-menu-color)",backgroundColor:"var(--main-menu-bg-color)"},"&.Mui-selected:hover":{backgroundColor:"var(--main-menu-hover-color)"}}}},MuiListItemButton:{styleOverrides:{root:{cursor:"pointer","&:hover":{backgroundColor:"var(--main-bg-color)"}}}},MuiListItemIcon:{styleOverrides:{root:{color:"var(--div-text-color)"}}},MuiListItemText:{styleOverrides:{primary:{fontSize:"16px",fontWeight:"bold",color:"var(--div-text-color)"},secondary:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"}}}}})}let a=!1;const Zn=()=>{a=!a},pr=o.createContext(void 0);function ei({children:r}){const[c,s]=o.useState(!1),[n,l]=o.useState(""),f=async j=>{try{const t=await fetch("./api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:j})});if(t.ok){const{valid:d}=await t.json();d?s(!0):j!==""&&l("Incorrect password!")}else console.error("Failed to log in:",t.statusText)}catch(t){console.error("Failed to log in:",t)}};return e.jsx(pr.Provider,{value:{loggedIn:c,logIn:f,errorMessage:n},children:r})}function ti(){const[r,c]=o.useState(""),s=o.useContext(pr),[n,l]=o.useState("#1976d2");if(!s)throw new Error("AuthContext not found");const{loggedIn:f,logIn:j,errorMessage:t}=s,d=S=>{S.preventDefault(),j(r)},N={display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",backgroundColor:"var(--main-bg-color)"},T={display:"flex",flexDirection:"column",maxWidth:"400px",margin:"0 auto",padding:"20px",gap:"20px",border:"1px solid var(--div-border-color)",borderRadius:"var(--div-border-radius)",boxShadow:"2px 2px 5px var(--div-shadow-color)",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},w={margin:"10px 0",padding:"3px 3px",fontSize:"14px",width:"230px",border:"1px solid var(--main-label-color)",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"};o.useEffect(()=>{a&&console.log("Setting frontend theme");const S=localStorage.getItem("frontendTheme");a&&console.log("Saved theme:",S),S?document.body.setAttribute("frontend-theme",S):document.body.setAttribute("frontend-theme","dark");const $=Yn("--primary-color","#1976d2");a&&console.log("Primary color from CSS:",$),l($)},[]);const R=window.location.pathname.includes("/matterbridge/")?"/matterbridge":window.location.href.includes("/api/hassio_ingress/")?window.location.pathname:"/";a&&(console.log("Loading App..."),console.log("- production mode"),console.log(`- with href = "${window.location.href}"`),console.log(`- pathname = "${window.location.pathname}"`),console.log(`- baseName = "${R}"`));const _=Xn(n);return j(""),f?e.jsx(mo,{theme:_,children:e.jsx(Sr,{dense:!0,maxSnack:10,preventDuplicate:!0,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(Bo,{children:e.jsx(Qo,{children:e.jsx(xr,{basename:R,children:e.jsxs("div",{className:"MbfScreen",children:[e.jsx(Go,{}),e.jsxs(br,{children:[e.jsx(Ke,{path:"/",element:e.jsx(yn,{})}),e.jsx(Ke,{path:"/devices",element:e.jsx(_n,{})}),e.jsx(Ke,{path:"/log",element:e.jsx(Vn,{})}),e.jsx(Ke,{path:"/settings",element:e.jsx(zn,{})}),e.jsx(Ke,{path:"/test",element:e.jsx(Gn,{})}),e.jsx(Ke,{path:"*",element:e.jsx(vr,{to:"/"})})]})]})})})})})}):e.jsx("div",{style:N,children:e.jsxs("form",{onSubmit:d,style:T,children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"64px",width:"64px"}}),e.jsx("h3",{style:{color:"var(--div-text-color)"},children:"Welcome to Matterbridge"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:"20px"},children:[e.jsx("input",{type:"text",name:"username",autoComplete:"username",style:{display:"none"},tabIndex:-1}),e.jsx("input",{type:"password",value:r,onChange:S=>c(S.target.value),style:w,placeholder:"password",autoComplete:"current-password"}),e.jsx("button",{type:"submit",style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",borderColor:"var(--div-bg-color)"},children:"Log in"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",margin:0,height:"30px"},children:t&&e.jsx("p",{style:{color:"red"},children:t})})]})})}function ri(){return e.jsx(ei,{children:e.jsx(ti,{})})}yr.createRoot(document.getElementById("root")).render(e.jsx(jr.StrictMode,{children:e.jsx(ri,{})}));
