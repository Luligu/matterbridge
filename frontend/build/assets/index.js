import{B as e,y as r,S as lt,U as Pr,V as Lr,X as ze,Y as $r,Z as Wr,I as Nr}from"./vendor_node_modules.js";import{u as Fr,S as Tr}from"./vendor_notistack.js";import{D as Te,a as Re,b as He,B as ie,c as _e,F as Ue,C as Ee,d as te,A as Rr,I as Q,e as Hr,f as Or,T as O,g as me,M as Vr,h as Ye,i as D,j as Le,k as ir,l as Er,m as jt,n as Ar,o as le,K as Et,p as At,q as Nt,L as ct,r as ot,s as dt,t as B,W as it,u as pt,H as ut,v as Y,V as _t,w as qt,x as _r,E as qr,Q as sr,R as wt,S as Ur,U as zr,P as Br,y as ar,z as Ft,G as $e,J as Tt,N as lr,O as Ct,X as cr,Y as Qr,Z as dr,_ as Kr,$ as Gr,a0 as Jr,a1 as Ut,a2 as Zr,a3 as Yr,a4 as Xr,a5 as eo,a6 as to,a7 as ro,a8 as oo,a9 as zt,aa as no,ab as io,ac as so,ad as ao,ae as lo,af as co,ag as po,ah as uo,ai as go,aj as mo,ak as ho,al as fo,am as xo,an as bo,ao as vo,ap as Bt,aq as Xe,ar as pr,as as Ce,at as ur,au as St,av as Ae,aw as yo,ax as jo,ay as qe,az as wo,aA as gt,aB as Be,aC as It,aD as Co,aE as So}from"./vendor_mui.js";import{I as ne,m as ko,a as Qt,b as Mo,c as Io,d as Kt,e as Do,f as Po,g as Lo,h as $o,i as Wo,j as No,k as Fo,l as To,n as Ro,o as Ho,p as Oo,q as Vo,r as Gt,s as Eo,t as Ao,u as _o,v as qo,w as Uo,x as zo,y as Bo,z as Qo,A as Jt,B as Ko,C as Go}from"./vendor_mdi.js";import{Q as Jo}from"./vendor_qrcode.js";import{F as Zo,v as Yo,e as Xo,a as en,g as tn,b as rn,c as on,d as Dt,A as nn}from"./vendor_rjsf.js";import"./vendor_lodash.js";import"./vendor_emotion.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const f of a)if(f.type==="childList")for(const h of f.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function l(a){const f={};return a.integrity&&(f.integrity=a.integrity),a.referrerPolicy&&(f.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?f.credentials="include":a.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function i(a){if(a.ep)return;a.ep=!0;const f=l(a);fetch(a.href,f)}})();function sn({open:n,title:c,message:l,onConfirm:i,onCancel:a}){const f=b=>{o&&console.log("Confirmed"),b.preventDefault(),i()},h=b=>{o&&console.log("Canceled"),b.preventDefault(),a()};return e.jsxs(Te,{open:n,children:[e.jsx(Re,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:c})]})}),e.jsxs(He,{children:[e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",margin:"0",marginBottom:"20px",maxHeight:"350px",maxWidth:"350px"},children:e.jsx("p",{style:{flex:1,margin:"0"},children:l})}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-around"},children:[e.jsx(ie,{onClick:f,variant:"contained",color:"primary",size:"small",children:"Confirm"}),e.jsx(ie,{onClick:h,variant:"contained",color:"primary",size:"small",children:"Cancel"})]})]})]})}const an=({open:n,output:c,title:l,_command:i,_packageName:a,onInstall:f,onClose:h})=>{const{installAutoExit:b,setInstallAutoExit:t}=r.useContext(De),M=r.useRef(null),j=w=>{t(w.target.checked),localStorage.setItem("installAutoExit",w.target.checked?"true":"false"),o&&console.log("handleInstallAutoExitChange called with value:",w.target.checked)};return r.useEffect(()=>{o&&console.log(`InstallProgressDialog output effect mounted, scrolling to bottom: ${M.current}`),setTimeout(()=>{o&&console.log("Scrolling to bottom:",M.current),M.current?.scrollIntoView({behavior:"smooth",block:"end"})},0)},[c]),e.jsxs(Te,{open:n,onClose:(w,S)=>{S==="backdropClick"||S==="escapeKeyDown"||h()},slotProps:{paper:{sx:{width:"70vw",maxWidth:"70vw",height:"70vw",maxHeight:"70vh",overflow:"hidden"}}},children:[e.jsx(Re,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:l})]})}),e.jsxs(He,{dividers:!0,style:{overflow:"hidden",display:"flex",flexDirection:"column",height:400,paddingBottom:0},children:[e.jsx("label",{style:{display:"block",marginBottom:"10px",fontSize:"16px",fontWeight:"bold",color:"var(--primary-color)"},children:"Process log"}),e.jsxs("ul",{style:{width:"100%",height:"100%",fontFamily:"monospace",fontSize:"14px",padding:"10px",margin:0,marginBottom:"10px",color:"var(--div-text-color)",background:"var(--div-bg-color)",overflow:"auto",listStyle:"none",boxSizing:"border-box",borderRadius:4,border:"4px solid var(--primary-color)",whiteSpace:"pre-wrap",display:"block"},children:[c.split(`
`).map((w,S)=>e.jsx("li",{style:{padding:0,margin:0,wordBreak:"break-all"},children:w},S)),e.jsx("li",{ref:M,style:{padding:0,margin:0}})]})]}),e.jsxs(_e,{sx:{justifyContent:"space-evenly"},children:[f&&e.jsx(ie,{variant:"contained",onClick:f,children:"Install"}),e.jsx(ie,{onClick:h,children:"Close"}),e.jsx(Ue,{control:e.jsx(Ee,{checked:b,onChange:w=>j(w)}),label:"Close on success",style:{color:"var(--div-text-color)"}})]})]})},mt=[],De=r.createContext(null);function ln({children:n}){const[c,l]=r.useState(!1),[i,a]=r.useState(null),{enqueueSnackbar:f,closeSnackbar:h}=Fr(),b=r.useCallback(C=>{o&&console.log(`UiProvider closeSnackbarMessage: message ${C}`);const L=mt.findIndex(K=>K.message===C);L!==-1&&(h(mt[L].key),mt.splice(L,1),o&&console.log(`UiProvider closeSnackbarMessage: message ${C} removed from persistMessages`))},[h]),t=r.useCallback((C,L,K)=>{o&&console.log(`UiProvider showSnackbarMessage: message ${C} timeout ${L}`);const ae=f(C,{variant:"default",autoHideDuration:L==null||L>0?(L??5)*1e3:null,persist:L===0,content:oe=>e.jsx(te,{sx:{margin:"0",padding:"0",width:"300px",marginRight:"30px"},children:e.jsx(Rr,{severity:K??"info",variant:"filled",sx:{color:"#fff",fontWeight:"normal",width:"100%",cursor:"pointer",padding:"0px 10px"},onClick:()=>h(oe),action:e.jsx(Q,{size:"small",onClick:()=>h(oe),sx:{color:"#fff"},children:e.jsx(Hr,{fontSize:"small"})}),children:C},oe)},oe)});L===0&&(o&&console.log(`UiProvider showSnackbarMessage: message ${C} timeout ${L} - persist key ${ae}`),mt.push({message:C,key:ae}))},[f,h]),[M,j]=r.useState(!1),[w,S]=r.useState(""),[V,A]=r.useState(""),[_,N]=r.useState(""),v=r.useRef(null),p=r.useRef(null),u=()=>{o&&console.log(`UiProvider handle confirm action ${_}`),j(!1),v.current&&v.current(_)},P=()=>{o&&console.log(`UiProvider handle cancel action ${_}`),j(!1),p.current&&p.current(_)},T=r.useCallback((C,L,K,ae,oe)=>{o&&console.log(`UiProvider showConfirmCancelDialog for command ${K}`),S(C),A(L),N(K),v.current=ae,p.current=oe,j(!0)},[]),[y,q]=r.useState(!1),[X,d]=r.useState(""),[s,g]=r.useState(""),[x,H]=r.useState(""),[de,ve]=r.useState(""),[se,ye]=r.useState(localStorage.getItem("installAutoExit")!=="false"),R=r.useCallback((C,L,K)=>{o&&console.log(`UiProvider show install progress for package ${C}`),d(C),g(L),H(K),q(!0)},[]),z=r.useCallback(C=>{o&&console.log(`UiProvider addInstallProgress: output ${C}`),ve(L=>L+C+`
`)},[]),F=r.useCallback(()=>{o&&console.log(`UiProvider exitInstallProgressSuccess: package ${x}`),localStorage.getItem("installAutoExit")!=="false"&&q(!1)},[x]),G=r.useCallback(()=>{o&&console.log(`UiProvider exitInstallProgressError: package ${x}`)},[x]),$=r.useCallback(()=>{o&&console.log("UiProvider hide install progress"),q(!1)},[]),W=()=>{o&&console.log("UiProvider handle install close action"),q(!1),H(""),ve("")},k=r.useMemo(()=>({mobile:c,setMobile:l,currentPage:i,setCurrentPage:a,showSnackbarMessage:t,closeSnackbarMessage:b,closeSnackbar:h,showConfirmCancelDialog:T,showInstallProgress:R,exitInstallProgressSuccess:F,exitInstallProgressError:G,hideInstallProgress:$,addInstallProgress:z,installAutoExit:se,setInstallAutoExit:ye}),[c,i,l,a,t,b,h,T,R,F,G,$,z,se,ye]);return e.jsxs(De.Provider,{value:k,children:[e.jsx(sn,{open:M,title:w,message:V,onConfirm:u,onCancel:P}),e.jsx(an,{open:y,title:X,_command:s,_packageName:x,output:de,onClose:W}),n]})}const gr=r.createContext(null),xe=r.createContext(null);function cn({children:n}){const[c,l]=r.useState([]),[i,a]=r.useState(1e3),[f,h]=r.useState(localStorage.getItem("logFilterLevel")??"info"),[b,t]=r.useState(localStorage.getItem("logFilterSearch")??"*"),[M,j]=r.useState(localStorage.getItem("logAutoScroll")!=="false"),[w,S]=r.useState(!1),{showSnackbarMessage:V,closeSnackbarMessage:A,closeSnackbar:_,showInstallProgress:N,hideInstallProgress:v,exitInstallProgressSuccess:p,exitInstallProgressError:u,addInstallProgress:P}=r.useContext(De),T=r.useRef([]),y=r.useRef(null),q=r.useRef(1),X=r.useRef(Math.floor(Math.random()*999e3)+1e3),d=r.useRef(null),s=r.useRef(null),g=r.useRef(null),x=r.useRef(f),H=r.useRef(b),de=r.useRef(0),ve=r.useRef(null),se=r.useMemo(()=>window.location.href.replace(/^http/,"ws"),[]),ye=r.useMemo(()=>window.location.href.includes("api/hassio_ingress"),[]),R=100,z=60,F=50,G=300,$=10;r.useEffect(()=>(o&&console.log("WebSocket messages started counter interval"),ve.current=setInterval(()=>{de.current>0&&(o&&console.log(`WebSocket messages received in the last ${$} seconds: ${de.current*(60/$)} messages/minute`),de.current=0)},$*1e3),()=>{o&&console.log("WebSocket messages stopped counter interval"),ve.current&&clearInterval(ve.current),ve.current=null}),[]),r.useEffect(()=>{x.current=f},[f]),r.useEffect(()=>{H.current=b},[b]);const W=r.useCallback(()=>Math.floor(Math.random()*999e3)+1e3,[]),k=r.useCallback((I,m)=>{o&&console.log(`WebSocket filterLogMessages called with level "${I}" and search "${m}"...`),l(fe=>fe.filter(ee=>!(["debug","info","notice","warn","error","fatal"].includes(ee.level)&&(I==="info"&&ee.level==="debug"||I==="notice"&&(ee.level==="debug"||ee.level==="info")||I==="warn"&&(ee.level==="debug"||ee.level==="info"||ee.level==="notice")||I==="error"&&(ee.level==="debug"||ee.level==="info"||ee.level==="notice"||ee.level==="warn")||I==="fatal"&&(ee.level==="debug"||ee.level==="info"||ee.level==="notice"||ee.level==="warn"||ee.level==="error"))||m!=="*"&&m!==""&&!ee.message.toLowerCase().includes(m.toLowerCase())&&!ee.name.toLowerCase().includes(m.toLowerCase()))))},[]),C=r.useCallback(I=>{if(y.current&&y.current.readyState===WebSocket.OPEN)try{o&&console.log(`WebSocket sending message with id ${I.id}:`,I),I.id===void 0&&(I.id=X.current);const m=JSON.stringify(I);y.current.send(m),o&&console.log("WebSocket sent message:",I)}catch(m){o&&console.error(`WebSocket error sending message: ${m}`)}else o&&console.error("WebSocket message not sent, WebSocket not connected:",I)},[]),L=r.useCallback((I,m)=>{l(fe=>[...fe,{level:I,time:"",name:"",message:m}])},[]),K=r.useCallback((I,m)=>{o&&console.log(`WebSocket addListener id ${m}:`,I),(m==null||isNaN(m)||m===0)&&console.error("WebSocket addListener called without id, listener not added:",I),T.current=[...T.current,{listener:I,id:m}],o&&console.log("WebSocket addListener total listeners:",T.current.length)},[]),ae=r.useCallback(I=>{o&&console.log("WebSocket removeListener:",I),T.current=T.current.filter(m=>m.listener!==I),o&&console.log("WebSocket removeListener total listeners:",T.current.length)},[]),oe=r.useCallback(()=>{se===""||se===null||se===void 0||(L("WebSocket",`Connecting ${et?"with password":""} to WebSocket: ${se}`),o&&console.log(`WebSocket connecting to: ${se}${et?"?password=[redacted]":""}`),y.current=new WebSocket(se+(et?`?password=${encodeURIComponent(et)}`:"")),y.current.onmessage=I=>{w||S(!0),de.current+=1;try{const m=JSON.parse(I.data);if(m.id===void 0||m.src===void 0||m.dst===void 0){o&&console.error("WebSocket undefined message id/src/dst:",m);return}if(m.src!=="Matterbridge"||m.dst!=="Frontend"){o&&console.error("WebSocket invalid message src/dst:",m);return}if(m.error){o&&console.error("WebSocket error message response:",m);return}if(m.id===X.current&&m.method==="pong"&&m.response==="pong"){o&&console.log(`WebSocket pong response message id ${m.id}:`,m),s.current&&clearTimeout(s.current),s.current=null;return}else if(m.method==="snackbar"&&m.response&&m.response.message){o&&console.log(`WebSocket message id ${m.id} method ${m.method}:`,m),V(m.response.message,m.response.timeout,m.response.severity);return}else if(m.method==="close_snackbar"&&m.response&&m.response.message){o&&console.log(`WebSocket message id ${m.id} method ${m.method}:`,m),A(m.response.message);return}else if(m.method==="log"){if(!m.response||!m.response.level||!m.response.time||!m.response.name||!m.response.message||(m.response.level==="spawn"&&(m.response.name==="Matterbridge:spawn-init"?N(m.response.message,"",""):m.response.name==="Matterbridge:spawn-exit-success"?p():m.response.name==="Matterbridge:spawn-exit-error"?u():P(m.response.message+`
`)),["debug","info","notice","warn","error","fatal"].includes(m.response.level)&&(x.current==="info"&&m.response.level==="debug"||x.current==="notice"&&(m.response.level==="debug"||m.response.level==="info")||x.current==="warn"&&(m.response.level==="debug"||m.response.level==="info"||m.response.level==="notice")||x.current==="error"&&(m.response.level==="debug"||m.response.level==="info"||m.response.level==="notice"||m.response.level==="warn")||x.current==="fatal"&&(m.response.level==="debug"||m.response.level==="info"||m.response.level==="notice"||m.response.level==="warn"||m.response.level==="error")))||H.current!=="*"&&H.current!==""&&!m.response.message.toLowerCase().includes(H.current.toLowerCase())&&!m.response.name.toLowerCase().includes(H.current.toLowerCase())||m.response.name==="Commissioning"&&m.response.message.includes("is uncommissioned"))return;l(ee=>{const he=[...ee,{level:m.response.level,time:m.response.time,name:m.response.name,message:m.response.message}];return he.length>i*2?he.slice(i):he})}else{if(o&&console.log(`WebSocket received message id ${m.id} method ${m.method}:`,m),m.id===0)T.current.forEach(fe=>fe.listener(m));else{const fe=T.current.find(ee=>ee.id===m.id);fe?fe.listener(m):console.warn(`WebSocket no listener found for message id ${m.id}:`,m)}return}}catch(m){console.error(`WebSocket error parsing message: ${m}`,m instanceof Error?m.stack:null)}},y.current.onopen=()=>{o&&console.log(`WebSocket: Connected to WebSocket: ${se}`),L("WebSocket",`Connected to WebSocket: ${se}`),S(!0),_(),q.current=1,g.current=setTimeout(()=>{d.current=setInterval(()=>{C({id:X.current,method:"ping",src:"Frontend",dst:"Matterbridge",params:{}}),s.current&&clearTimeout(s.current),s.current=setTimeout(()=>{o&&console.error(`WebSocketUse: No pong response received from WebSocket: ${se}`),L("WebSocket",`No pong response received from WebSocket: ${se}`),S(!1)},1e3*F)},1e3*z)},1e3*G)},y.current.onclose=()=>{o&&console.error(`WebSocket: Disconnected from WebSocket ${ye?"with Ingress":""}: ${se}`),L("WebSocket",`Disconnected from WebSocket: ${se}`),S(!1),_(),v(),g.current&&clearTimeout(g.current),s.current&&clearTimeout(s.current),d.current&&clearInterval(d.current),L("WebSocket",`Reconnecting (attempt ${q.current} of ${R}) to WebSocket${ye?" (Ingress)":""}: ${se}`),ye?setTimeout(ce,5e3):q.current===1?ce():q.current<R?setTimeout(ce,1e3*q.current):L("WebSocket",`Reconnect attempts exceeded limit of ${R} retries, refresh the page to reconnect to: ${se}`),q.current=q.current+1},y.current.onerror=I=>{o&&console.error(`WebSocket: WebSocket error connecting to ${se}:`,I),L("WebSocket",`WebSocket error connecting to ${se}`)})},[se]),ce=r.useCallback(()=>{o&&console.log(`WebSocket attemptReconnect ${q.current}/${R} to:`,se),oe()},[oe]);r.useEffect(()=>(oe(),()=>{y.current&&y.current.readyState===WebSocket.OPEN&&y.current.close()}),[oe]);const ue=r.useMemo(()=>({messages:c,logMaxMessages:i,logAutoScroll:M,logFilterLevel:f,logFilterSearch:b,setMessages:l,setLogMaxMessages:a,setLogFilterLevel:h,setLogFilterSearch:t,setLogAutoScroll:j,filterLogMessages:k}),[c,i,M,f,b,l,h,t,a,j,k]),pe=r.useMemo(()=>({logMaxMessages:i,logAutoScroll:M,logFilterLevel:f,logFilterSearch:b,setMessages:l,setLogMaxMessages:a,setLogFilterLevel:h,setLogFilterSearch:t,setLogAutoScroll:j,filterLogMessages:k,online:w,retry:q.current,getUniqueId:W,addListener:K,removeListener:ae,sendMessage:C,logMessage:L}),[i,M,l,h,t,a,j,w,q.current,K,ae,C,L]);return e.jsx(gr.Provider,{value:ue,children:e.jsx(xe.Provider,{value:pe,children:n})})}function dn(n){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 296.2 296.2",...n,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"lg1",x1:"16.6",y1:"16.6",x2:"279.6",y2:"279.6",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{offset:"0",stopColor:"#00b48d"}),e.jsx("stop",{offset:".1",stopColor:"#3faa77"}),e.jsx("stop",{offset:".3",stopColor:"#234148"}),e.jsx("stop",{offset:".7",stopColor:"#203b44"}),e.jsx("stop",{offset:".9",stopColor:"#ad2e6e"}),e.jsx("stop",{offset:"1",stopColor:"#c81b74"})]}),e.jsxs("linearGradient",{id:"lg2",x1:"31.1",y1:"31.1",x2:"265.1",y2:"265.1",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{offset:"0",stopColor:"#00b48d"}),e.jsx("stop",{offset:".2",stopColor:"#285251"}),e.jsx("stop",{offset:".4",stopColor:"#234148"}),e.jsx("stop",{offset:".8",stopColor:"#203b44"}),e.jsx("stop",{offset:".9",stopColor:"#a8316c"}),e.jsx("stop",{offset:"1",stopColor:"#c81b74"})]}),e.jsxs("linearGradient",{id:"lg3",x1:"116.2",y1:"143.9",x2:"139.8",y2:"143.9",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{offset:"0",stopColor:"#8bc751"}),e.jsx("stop",{offset:"1",stopColor:"#0db14b"})]}),e.jsx("linearGradient",{id:"lg4",x1:"136.1",y1:"100.8",x2:"159.6",y2:"100.8",xlinkHref:"#lg3"}),e.jsx("linearGradient",{id:"lg5",x1:"155.3",y1:"143.9",x2:"178.9",y2:"143.9",xlinkHref:"#lg3"}),e.jsxs("linearGradient",{id:"lg6",x1:"46.8",y1:"25.7",x2:"89.6",y2:"74.8",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{offset:"0",stopColor:"#b1d34a"}),e.jsx("stop",{offset:"1",stopColor:"#50b848"})]})]}),e.jsx("rect",{width:"296.2",height:"296.2",rx:"56.7",ry:"56.7",style:{fill:"url(#lg1)"}}),e.jsx("rect",{x:"16.3",y:"16.3",width:"263.6",height:"263.6",rx:"50.5",ry:"50.5",style:{fill:"url(#lg2)"}}),e.jsx("circle",{cx:"128",cy:"143.9",r:"11.8",style:{fill:"url(#lg3)"}}),e.jsx("circle",{cx:"147.8",cy:"100.8",r:"11.8",style:{fill:"url(#lg4)"}}),e.jsx("path",{d:"m244.6 114.5.4-.5L160 33a17 17 0 0 0-24.7-.5l-86.4 83.3a15 15 0 0 0 9.2 26.9h19.3v-4.7l-13.7-12.7v-.1l83.7-80.8 84.2 81-13.9 12.8v4.5h19.5a15 15 0 0 0 7.4-28.1Z",style:{fill:"url(#lg3)"}}),e.jsx("circle",{cx:"167.1",cy:"143.9",r:"11.8",style:{fill:"url(#lg5)"}}),e.jsx("path",{fill:"#fff",d:"M219 89.3V35.5a10.5 10.5 0 1 0-21 0v33.7l21 20Z"}),e.jsx("path",{d:"M91.4 73.3H83a37 37 0 0 0-14.5-28.4L65 50.2c.1 0 12.6 9 11.7 25.4-5.3-.4-11.2-1.9-16.3-5.3-11.8-7.8-16-23.7-11.9-46 8.7 1.5 34 7 43 22.8 4.1 7.3 4.1 16.1 0 26.2Z",style:{fill:"url(#lg6)"}}),e.jsx("path",{d:"M65.9 80a49.6 49.6 0 0 0 17.8 2.2l16.6-16c1.6-8.3.5-15.7-3.3-22.4C84.6 22 47.8 17.5 46.2 17.4l-3-.4-.6 3c-3.8 18.4-5.9 50.6 23.2 60ZM48.4 24.4c8.7 1.5 34 7 43 22.8 4.1 7.3 4.1 16.1 0 26.2H83a37 37 0 0 0-14.5-28.4l-3.7 5.3c.1 0 12.6 9 11.7 25.4-5.3-.4-11.2-1.9-16.3-5.3-11.9-7.8-16-23.7-11.9-46Z",fill:"#1e5857"}),e.jsx("path",{fill:"#fff",d:"M250.5 90.5a17.4 17.4 0 1 1 0-34.8 17.4 17.4 0 0 1 0 34.8Zm0-22.7a5.4 5.4 0 0 0 0 10.7 5.3 5.3 0 0 0 0-10.7ZM258.8 148.2a15.9 15.9 0 0 0-9.6 28.5c-.8 4.2-5.4 4.6-5.4 4.6h-26v-43l13.6-13-1.8-2-82.2-79-81.2 78.3-2.5 2.6 13.7 13v42.9H53a21.5 21.5 0 1 0 11.7 15h12.6v18.8c0 7.8 6.4 14.1 14.1 14.1h29.3v14.8H64a10.6 10.6 0 0 0-17.7 8 10.6 10.6 0 0 0 17.6 8h157.6a16.3 16.3 0 1 0 0-16h-84.8V229h66.8c7.8 0 14.2-6.3 14.2-14.1v-19.2h27.6c14.3 0 17.8-12.8 18.5-16.6a15.9 15.9 0 0 0-5-30.9ZM43.7 210.8a10.3 10.3 0 1 1 0-20.6 10.3 10.3 0 0 1 0 20.6Zm192 36a5 5 0 1 1 0 10 5 5 0 0 1 0-10Zm-77-34.8h-22v-34h22v34Zm8.4-79.8c2.7 0 5.2 1 7.2 2.5v-10.4L188 137s2.6 1.3 4.6 1.3h6.7v68c0 3.2-2.6 5.7-5.7 5.7h-19v-34h1.4a7.5 7.5 0 0 0 0-15H120a7.5 7.5 0 0 0 0 15h.7v34h-19.3a5.7 5.7 0 0 1-5.7-5.6v-68.1h6.7c2 0 4.6-1.3 4.6-1.3l13.7-12.7v10.4a11.7 11.7 0 0 1 16 1.6v-13a14.9 14.9 0 0 0-25-10.8s-.1.2-.1.2l-.5.5-6.9 7H92.5l55-53.2 55.1 53.2h-11.8l-7-7c0-.2-.2-.3-.4-.5l-.2-.2a14.8 14.8 0 0 0-25 10.9v12.9c2.2-2.5 5.3-4.1 8.9-4.1Zm91.7 36.7a4.9 4.9 0 1 1 0-9.7 4.9 4.9 0 0 1 0 9.7Z"})]})}function We(){const{retry:n}=r.useContext(xe),c=()=>{window.location.reload()};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100vw",height:"100vh",justifyContent:"center",alignItems:"center",fontSize:"20px",color:"var(--main-text-color)",backgroundColor:"var(--main-bg-color)"},children:[e.jsx(dn,{style:{height:"128px",width:"128px",margin:"10px",marginBottom:"20px"}}),n<100?e.jsxs(e.Fragment,{children:[e.jsx(Or,{style:{color:"var(--primary-color)"}}),e.jsx("div",{style:{marginTop:"20px",color:"var(--primary-color)",textAlign:"center"},children:e.jsxs("span",{children:["Reconnecting to Matterbridge ","(attempt "+n+")","..."]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginTop:"20px",color:"var(--primary-color)",textAlign:"center"},children:[e.jsx("span",{children:"Unable to connect to Matterbridge after multiple attempts."}),e.jsx("br",{}),e.jsx("span",{children:"Please check your network connection."}),e.jsx("br",{})]}),e.jsx(ie,{variant:"contained",color:"primary",onClick:c,style:{marginTop:"20px"},children:"Refresh the Page"})]})]})}function mr({value:n,maxChars:c}){let l=n;if(n.length>c&&c>3){const i=c-3,a=n.substring(0,Math.ceil(i/2)),f=n.substring(n.length-Math.floor(i/2),n.length);l=`${a} â€¦ ${f}`}return n!==l?e.jsx(O,{title:n,placement:"top",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[0,12]}}]}},children:e.jsx("span",{children:l})}):e.jsx("span",{children:l})}function Se({children:n,style:c}){const l={display:"flex",flexDirection:"column",flex:"0 0 auto",width:"100%",overflow:"hidden",margin:"0px",padding:"0px",gap:"0px",backgroundColor:"var(--div-bg-color)",boxShadow:"5px 5px 10px var(--div-shadow-color)",border:"1px solid var(--table-border-color)",borderRadius:"var(--div-border-radius)",boxSizing:"border-box"};return e.jsx("div",{style:{...l,...c},children:n})}function Ie({children:n,style:c}){const l={display:"flex",flexDirection:"row",justifyContent:"space-between",width:"100%",height:"30px",borderBottom:"1px solid var(--table-border-color)",color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color)",margin:"0px",padding:"0px",boxSizing:"border-box"};return e.jsx("div",{style:{...l,...c},children:n})}function ke({children:n,style:c}){const l={color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color)",fontSize:"16px",fontWeight:"bold",margin:"0px",padding:"5px 10px"};return e.jsx("div",{style:{...l,...c},children:n})}function ht({children:n,style:c}){const l={display:"flex",flexDirection:"row",justifyContent:"space-between",width:"100%",height:"30px",color:"var(--footer-text-color)",backgroundColor:"var(--footer-bg-color)",margin:"0px",padding:"0px",boxSizing:"border-box"};return e.jsx("div",{style:{...l,...c},children:n})}function ft({children:n,style:c}){const l={color:"var(--footer-text-color)",backgroundColor:"var(--footer-bg-color)",fontSize:"14px",fontWeight:"bold",margin:"0px",padding:"5px 10px"};return e.jsx("div",{style:{...l,...c},children:n})}function nt({children:n,style:c}){const l={color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",fontSize:"14px",fontWeight:"normal",margin:"0px",padding:"5px 10px"};return e.jsx("div",{style:{...l,...c},children:n})}function Ne({children:n,style:c,onDragOver:l,onDragLeave:i,onDrop:a}){const f={flex:"0 0 auto",display:"flex",flexDirection:"row",overflow:"hidden",alignItems:"start",justifyContent:"space-between",margin:"0px",padding:"10px",gap:"20px"};return e.jsx("div",{style:{...f,...c},onDragOver:l,onDragLeave:i,onDrop:a,children:n})}function tt({children:n,style:c,onClose:l}){const i={display:"flex",flexDirection:"row",margin:"0px",padding:"0px",paddingRight:"10px",gap:"10px"};return e.jsxs("div",{style:{...i,...c},children:[n,ki]})}function pn({systemInfo:n,compact:c}){const{mobile:l}=r.useContext(De),{addListener:i,removeListener:a,getUniqueId:f,sendMessage:h}=r.useContext(xe),[b,t]=r.useState(n),M=r.useRef(f());if(o&&console.log("SystemInfoTable loading with systemInfo:",b,"compact:",c),n&&c&&b.totalMemory&&b.freeMemory){const v=b.totalMemory,p=b.freeMemory;b.freeMemory=`${p} / ${v}`,b.totalMemory=""}if(n&&c&&b.heapTotal&&b.heapUsed){const v=b.heapTotal,p=b.heapUsed;b.heapUsed=`${p} / ${v}`,b.heapTotal=""}if(n&&c&&b.osRelease&&b.osType){const v=b.osType,p=b.osRelease;b.osType=`${v} (${p})`,b.osRelease=""}if(n&&c&&b.osArch&&b.osPlatform){const v=b.osPlatform,p=b.osArch;b.osPlatform=`${v} (${p})`,b.osArch=""}const j=(v,p,u,P,T)=>{t(y=>({...y,totalMemory:v,freeMemory:p,heapTotal:u,heapUsed:P,rss:T}))},w=v=>{t(p=>({...p,cpuUsage:v.toFixed(2)+" %"}))},S=v=>{t(p=>({...p,processCpuUsage:v.toFixed(2)+" %"}))},V=(v,p)=>{t(u=>({...u,systemUptime:v,processUptime:p}))},A=()=>{o&&console.log("SystemInfoTable handleViewHistory clicked"),h({id:M.current,sender:"Header",method:"/api/viewhistorypage",src:"Frontend",dst:"Matterbridge",params:{}})};r.useEffect(()=>{const v=p=>{o&&console.log("SystemInfoTable received WebSocket Message:",p),p.method==="memory_update"&&p.response&&p.response.totalMemory&&p.response.freeMemory&&p.response.heapTotal&&p.response.heapUsed&&p.response.rss?(o&&console.log("SystemInfoTable received memory_update",p),j(p.response.totalMemory,p.response.freeMemory,p.response.heapTotal,p.response.heapUsed,p.response.rss)):p.method==="cpu_update"&&p.response&&p.response.cpuUsage?(o&&console.log("SystemInfoTable received cpu_update",p),w(p.response.cpuUsage),S(p.response.processCpuUsage)):p.method==="uptime_update"&&p.response&&p.response.systemUptime&&p.response.processUptime?(o&&console.log("SystemInfoTable received uptime_update",p),V(p.response.systemUptime,p.response.processUptime)):p.method==="/api/viewhistorypage"&&p.id===M.current&&p.success===!0&&(o&&console.log("SystemInfoTable received /api/viewhistorypage success"),window.open("./api/viewhistory","_blank","noopener,noreferrer"))};return i(v,M.current),o&&console.log(`SystemInfoTable added WebSocket listener id ${M.current}`),()=>{a(v),o&&console.log("SystemInfoTable removed WebSocket listener")}},[i,a]);const[_,N]=r.useState(!1);return!b||_?null:(o&&console.log("SystemInfoTable rendering..."),e.jsxs(Se,{style:l?{flex:"1 1 300px"}:{flex:"0 1 auto",width:"302px",minWidth:"302px"},children:[e.jsxs(Ie,{children:[e.jsx(ke,{children:"System Information"}),e.jsx(tt,{onClose:()=>N(!0),children:e.jsx(Q,{size:"small",sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},onClick:A,children:e.jsx(O,{title:"Open the cpu and memory usage page",arrow:!0,children:e.jsx(ne,{path:ko,size:"22px"})})})})]}),e.jsx(Ne,{style:l?{flex:"1 1 auto",margin:"0px",padding:"0px",gap:"0px"}:{flex:"1 1 auto",overflow:"auto",margin:"0px",padding:"0px",gap:"0px"},children:e.jsxs("table",{style:{border:"none",borderCollapse:"collapse",tableLayout:"fixed"},children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"40%"}}),e.jsx("col",{style:{width:"60%"}})]}),e.jsx("tbody",{style:{border:"none",borderCollapse:"collapse"},children:Object.entries(b).filter(([v,p])=>p!==void 0&&p!=="").map(([v,p],u)=>e.jsxs("tr",{className:u%2===0?"table-content-even":"table-content-odd",style:{border:"none",borderCollapse:"collapse"},children:[e.jsx("td",{style:{border:"none",borderCollapse:"collapse",whiteSpace:"nowrap"},children:v.replace("interfaceName","Interface name").replace("macAddress","Mac address").replace("ipv4Address","IPv4 address").replace("ipv6Address","IPv6 address").replace("nodeVersion","Node version").replace("hostname","Hostname").replace("user","User").replace("osType","Os").replace("osPlatform","Platform").replace("freeMemory","Memory").replace("systemUptime","System uptime").replace("processUptime","Process uptime").replace("cpuUsage","Host CPU").replace("processCpuUsage","Process CPU").replace("rss","Rss").replace("heapUsed","Heap")}),e.jsx("td",{style:{border:"none",borderCollapse:"collapse",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:l?typeof p!="string"?p.toString():p:e.jsx(mr,{value:typeof p!="string"?p.toString():p,maxChars:22})})]},v))})]})})]}))}const Zt=r.memo(pn),Yt={margin:"0px",padding:"0px",color:"var(--div-text-color)",transition:"color 0.2s ease","& svg":{display:"block"},"& svg path":{fill:"var(--div-text-color)",transition:"fill 0.2s ease"},"&:hover":{color:"var(--primary-color)"},"&:hover svg path":{fill:"var(--primary-color)"},"&:focus-visible":{outline:"2px solid var(--primary-color)",outlineOffset:"2px"}},un=n=>{if(!n)return"";const c=n.toString().replace(/[^0-9]/g,"");if(c.length<5)return c;const l=c.slice(0,4),i=c.slice(4,7),a=c.slice(7,11);return[l,i,a].filter(Boolean).join("-")};function gn({id:n}){const{online:c,sendMessage:l,addListener:i,removeListener:a,getUniqueId:f}=r.useContext(xe),[h,b]=r.useState(null),t=r.useRef(null),M=r.useRef(null),j=r.useRef(f()),{mobile:w,showConfirmCancelDialog:S}=r.useContext(De);o&&console.log(`QRDiv loading with id = "${n}" storeId = "${t.current}" timeout = ${M.current} and  matter:`,h),r.useEffect(()=>{o&&console.log(`QRDiv id effect "${n}"`),t.current=n,M.current&&clearTimeout(M.current),M.current=null,n?(o&&console.log(`QRDiv id effect sending data request for storeId "${n}"`),l({id:j.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:n,server:!0}})):(o&&console.log("QRDiv id effect setting matter to null"),b(null))},[n,l]),r.useEffect(()=>{const p=u=>{o&&console.log("QRDiv received WebSocket Message:",u),u.method==="refresh_required"&&u.response.changed==="matter"&&u.response.matter&&(o&&console.log(`QRDiv received refresh_required: changed=${u.response.changed} for storeId "${u.response.matter.id}":`,u.response.matter),t.current===u.response.matter.id&&(o&&console.log(`QRDiv received refresh_required/matter: setting matter data for storeId "${u.response.matter.id}":`,u.response.matter),M.current&&clearTimeout(M.current),u.response.matter.advertising&&u.response.matter.advertiseTime&&u.response.matter.advertiseTime+9e5<=Date.now()&&(u.response.matter.advertising=!1),b(u.response.matter),u.response.matter.advertising&&(o&&console.log(`QRDiv setting matter advertise timeout for storeId "${u.response.matter.id}":`,u.response.matter.advertiseTime+9e5-Date.now()),M.current=setTimeout(()=>{M.current&&clearTimeout(M.current),o&&console.log(`QRDiv clearing advertising state for storeId "${t.current}" after 15 minutes`),b(P=>P&&{...P,advertising:!1})},u.response.matter.advertiseTime+9e5-Date.now()))))};return i(p,j.current),o&&console.log("QRDiv webSocket effect mounted"),()=>{a(p),M.current&&clearTimeout(M.current),M.current=null,o&&console.log("QRDiv webSocket effect unmounted")}},[i,a]);const V=()=>{o&&console.log(`QRDiv sent matter startCommission for node "${h?.id}"`),h&&l({id:j.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:h.id,startCommission:!0}})},A=()=>{o&&console.log(`QRDiv sent matter stopCommission for node "${h?.id}"`),h&&l({id:j.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:h.id,stopCommission:!0}})},_=()=>{o&&console.log(`QRDiv sent matter advertise for node "${h?.id}"`),h&&l({id:j.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:h.id,advertise:!0}})},N=p=>{o&&console.log(`QRDiv sent matter removeFabric for node "${h?.id}" and fabricIndex ${p}`),h&&l({id:j.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:h.id,removeFabric:p}})},v=async()=>{if(!h||!h.manualPairingCode)return;const p=h.manualPairingCode.toString();try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(p);else{const u=document.createElement("textarea");u.value=p,u.style.position="fixed",u.style.opacity="0",document.body.appendChild(u),u.focus(),u.select(),document.execCommand("copy"),document.body.removeChild(u)}o&&console.log("Manual pairing code copied to clipboard")}catch(u){console.error("Failed to copy manual pairing code",u)}};return!h||!c?(o&&console.log("QRDiv rendering undefined state"),null):h.online?h.advertising&&h.qrPairingCode&&h.manualPairingCode?(o&&console.log("QRDiv rendering advertising state"),e.jsxs(Se,{style:w?{flex:"1 1 300px",alignItems:"center"}:{alignItems:"center",width:"302px",minWidth:"302px"},children:[e.jsxs(Ie,{children:[e.jsx(ke,{children:"QR pairing code"}),e.jsxs(tt,{children:[e.jsx(Q,{"aria-label":"send advertising",size:"small",onClick:_,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(O,{title:"Send again the mDNS advertisement",arrow:!0,children:e.jsx(ne,{path:Qt,size:"22px"})})}),e.jsx(Q,{"aria-label":"stop pairing",size:"small",onClick:A,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(O,{title:"Turn off pairing",arrow:!0,children:e.jsx(ne,{path:Mo,size:"22px"})})})]})]}),e.jsx(nt,{style:{maxWidth:"280px",fontWeight:"bold",color:"var(--secondary-color)"},children:t.current}),e.jsx(Jo,{value:h.qrPairingCode,size:256,level:"M",fgColor:"var(--div-text-color)",bgColor:"var(--div-bg-color)",style:{margin:"20px"}}),e.jsxs(ht,{style:{justifyContent:"space-between"},children:[e.jsxs(ft,{style:{fontWeight:"normal",color:"var(--div-text-color)"},children:["Manual pairing code: ",un(h.manualPairingCode)]}),e.jsx(tt,{children:e.jsx(O,{title:"Copy manual pairing code",arrow:!0,children:e.jsx(Q,{"aria-label":"copy manual pairing code",size:"small",onClick:v,sx:Yt,children:e.jsx(ne,{path:Io,size:.85})})})})]})]})):h.commissioned&&h.fabricInformations&&h.sessionInformations?(o&&console.log("QRDiv rendering commissioned state"),e.jsxs(Se,{style:w?{flex:"1 1 300px",alignItems:"center"}:{alignItems:"center",width:"302px",minWidth:"302px",overflow:"hidden"},children:[e.jsxs(Ie,{children:[e.jsx(ke,{children:"Paired fabrics"}),e.jsxs(tt,{children:[e.jsx(Q,{"aria-label":"send advertising",size:"small",onClick:_,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(O,{title:"Send again the mDNS advertisement",arrow:!0,children:e.jsx(ne,{path:Qt,size:"22px"})})}),e.jsx(Q,{"aria-label":"start pairing",size:"small",onClick:V,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(O,{title:"Turn on pairing",arrow:!0,children:e.jsx(ne,{path:Kt,size:"22px"})})})]})]}),e.jsx(nt,{style:{maxWidth:"280px",fontWeight:"bold",color:"var(--secondary-color)"},children:t.current}),e.jsx(Ne,{style:{flexDirection:"column",flex:"1 1 auto",overflow:"auto",margin:"0px",padding:"0px 0px 10px 0px",gap:"0px"},children:h.fabricInformations.map((p,u)=>e.jsxs("div",{style:{margin:"0px",padding:"10px",gap:"0px",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",textAlign:"left",fontSize:"14px"},children:[e.jsxs("div",{style:{marginLeft:"20px",marginBottom:"10px",display:"flex",flexDirection:"row",justifyContent:"space-between",gap:"20px",alignItems:"center"},children:[e.jsxs("p",{className:"status-blue",style:{margin:"0px",padding:"3px 10px",width:"200px",fontSize:"14px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},children:["Fabric: ",p.fabricIndex]}),e.jsx(O,{title:"Remove the fabric. You will also need to remove it from the controller.",arrow:!0,children:e.jsx(Q,{"aria-label":"remove the fabric",size:"small",onClick:()=>S("Remove fabric","Are you sure you want to remove this fabric? You will also need to remove it from the controller.","RemoveFabric",()=>N(p.fabricIndex),()=>{}),sx:{...Yt,padding:"2px"},children:e.jsx(ne,{path:Do,size:1})})})]}),e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Vendor: ",p.rootVendorId," ",p.rootVendorName]}),p.label!==""&&e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Label: ",p.label]}),e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Sessions: ",h.sessionInformations?h.sessionInformations.filter(P=>P.fabric?.fabricIndex===p.fabricIndex&&P.isPeerActive===!0).length:"0"," ","subscriptions: ",h.sessionInformations?h.sessionInformations.filter(P=>P.fabric?.fabricIndex===p.fabricIndex&&P.isPeerActive===!0&&P.numberOfActiveSubscriptions>0).length:"0"]})]},u))}),e.jsx(ht,{style:{justifyContent:"center"},children:e.jsxs(ft,{style:{fontWeight:"normal"},children:["Serial number: ",h.serialNumber]})})]})):!h.commissioned&&!h.advertising?(o&&console.log("QRDiv rendering not commissioned and not advertising state"),e.jsxs(Se,{style:w?{flex:"1 1 300px",alignItems:"center"}:{alignItems:"center",width:"302px",minWidth:"302px"},children:[e.jsx(Ie,{children:e.jsx(ke,{children:"QR pairing code"})}),e.jsx(nt,{style:{maxWidth:"280px",fontWeight:"bold",color:"var(--secondary-color)"},children:t.current}),e.jsx(ie,{onClick:V,endIcon:e.jsx(ne,{path:Kt,size:1}),style:{margin:"20px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:"Turn on pairing"}),e.jsx(ht,{style:{justifyContent:"center"},children:e.jsxs(ft,{style:{fontWeight:"normal"},children:["Serial number: ",h.serialNumber]})})]})):(o&&console.log("QRDiv rendering unknown state"),null):(o&&console.log("QRDiv rendering offline state"),e.jsxs(Se,{style:w?{flex:"1 1 300px",alignItems:"center"}:{alignItems:"center",width:"302px",minWidth:"302px"},children:[e.jsx(Ie,{style:{height:"30px",justifyContent:"space-between"},children:e.jsx(ke,{children:"Server node"})}),e.jsx(nt,{style:{maxWidth:"280px",fontWeight:"bold",color:"var(--secondary-color)"},children:t.current}),e.jsx(nt,{style:{fontWeight:"bold"},children:"Server offline"}),e.jsx(ht,{style:{justifyContent:"center"},children:e.jsxs(ft,{style:{fontWeight:"normal"},children:["Serial number: ",h.serialNumber]})})]}))}const Xt=r.memo(gn);function mn(){const{mobile:n}=r.useContext(De),{logMessage:c,sendMessage:l,getUniqueId:i}=r.useContext(xe),[a,f]=r.useState("matterbridge-"),[h,b]=r.useState(!1),[t,M]=r.useState(null),j=r.useRef(i()),w=d=>{d.preventDefault(),b(!0)},S=()=>{b(!1)},V=d=>{d.preventDefault(),b(!1);const s=d.dataTransfer.files[0];if(s){c("Plugins",`Installing package ${s.name}. Please wait...`);const g=new FormData;g.append("file",s),g.append("filename",s.name),fetch("./api/uploadpackage",{method:"POST",body:g}).then(x=>x.text()).then(x=>{c("Plugins",`Server response: ${x}`)}).catch(x=>{console.error("Error uploading plugin file:",x),c("Plugins",`Error installing package ${x}`)})}},A=d=>{const s=d.target.files&&d.target.files[0];if(s){c("Plugins",`Uploading package ${s.name}`);const g=new FormData;g.append("file",s),g.append("filename",s.name),fetch("./api/uploadpackage",{method:"POST",body:g}).then(x=>x.text()).then(x=>{c("Plugins",`Server response: ${x}`)}).catch(x=>{console.error("Error uploading plugin file:",x),c("Plugins",`Error uploading package ${x}`)})}},_=()=>{l({id:j.current,sender:"InstallPlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:a,restart:!1}})},N=()=>{l({id:j.current,sender:"InstallPlugins",method:"/api/uninstall",src:"Frontend",dst:"Matterbridge",params:{packageName:a}})},v=()=>{document.getElementById("file-upload")?.click()},p=()=>{l({id:j.current,sender:"InstallPlugins",method:"/api/addplugin",src:"Frontend",dst:"Matterbridge",params:{pluginNameOrPath:a}})},u=d=>{d.preventDefault(),console.log("Right-clicked Upload button")},P=d=>{d.preventDefault(),console.log("Right-clicked Add button")},T=d=>{M(d.currentTarget)},y=d=>{d!==""&&f(d),M(null)},[q,X]=r.useState(!1);return o&&console.log("HomeInstallAddPlugins rendering..."),q?null:e.jsxs(Se,{children:[e.jsxs(Ie,{children:[e.jsx(ke,{children:"Install plugins"}),e.jsx(tt,{onClose:()=>X(!0)})]}),e.jsxs(Ne,{onDragOver:w,onDragLeave:S,onDrop:V,style:n?{flexWrap:"wrap",alignItems:"center",gap:"10px"}:{flexWrap:"wrap",alignItems:"center",gap:"20px"},children:[e.jsxs("div",{style:{flex:"1 1 auto",display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx(me,{value:a,onChange:d=>{f(d.target.value)},size:"small",id:"plugin-name",label:"Plugin name or plugin path",variant:"outlined",fullWidth:!0}),e.jsx(Q,{onClick:T,children:e.jsx(Vr,{})}),e.jsxs(Ye,{id:"simple-menu",anchorEl:t,keepMounted:!0,open:!!t,onClose:()=>y(""),children:[e.jsx(D,{onClick:()=>y("matterbridge-zigbee2mqtt"),children:"matterbridge-zigbee2mqtt"}),e.jsx(D,{onClick:()=>y("matterbridge-somfy-tahoma"),children:"matterbridge-somfy-tahoma"}),e.jsx(D,{onClick:()=>y("matterbridge-shelly"),children:"matterbridge-shelly"}),e.jsx(D,{onClick:()=>y("matterbridge-hass"),children:"matterbridge-hass"}),e.jsx(D,{onClick:()=>y("matterbridge-webhooks"),children:"matterbridge-webhooks"}),e.jsx(D,{onClick:()=>y("matterbridge-bthome"),children:"matterbridge-bthome"}),e.jsx(D,{onClick:()=>y("matterbridge-test"),children:"matterbridge-test"}),e.jsx(D,{onClick:()=>y("matterbridge-example-accessory-platform"),children:"matterbridge-example-accessory-platform"}),e.jsx(D,{onClick:()=>y("matterbridge-example-dynamic-platform"),children:"matterbridge-example-dynamic-platform"}),e.jsx(D,{onClick:()=>y("matterbridge-eve-door"),children:"matterbridge-eve-door"}),e.jsx(D,{onClick:()=>y("matterbridge-eve-motion"),children:"matterbridge-eve-motion"}),e.jsx(D,{onClick:()=>y("matterbridge-eve-energy"),children:"matterbridge-eve-energy"}),e.jsx(D,{onClick:()=>y("matterbridge-eve-weather"),children:"matterbridge-eve-weather"}),e.jsx(D,{onClick:()=>y("matterbridge-eve-room"),children:"matterbridge-eve-room"})]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"center",gap:"10px"},children:[e.jsx(O,{title:"Install or update a plugin from npm",children:e.jsxs(ie,{onClick:_,endIcon:e.jsx(Le,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:[" ","Install"]})}),e.jsx(O,{title:"Uninstall and remove a plugin",children:e.jsxs(ie,{onClick:N,endIcon:e.jsx(ir,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:[" ","Uninstall"]})}),e.jsx(O,{title:"Upload and install a plugin from a tarball",children:e.jsxs(ie,{onClick:v,onContextMenu:u,endIcon:e.jsx(Er,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:[" ","Upload"]})}),e.jsx(O,{title:"Add an installed plugin",children:e.jsxs(ie,{onClick:p,onContextMenu:P,endIcon:e.jsx(jt,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:[" ","Add"]})}),e.jsx("input",{id:"file-upload",type:"file",accept:".tgz",style:{display:"none"},onChange:A})]})]})]})}const hn=r.memo(mn);function Qe({status:n,enabledText:c="Enabled",disabledText:l=void 0,tooltipText:i=void 0,onClick:a}){if(n===void 0)return null;{const f=e.jsx("div",{className:n?"status-enabled":"status-disabled",style:{cursor:"default"},onClick:a,children:n?c:l??c});return i!==void 0?e.jsx(O,{title:i,children:f}):f}}function fn(n,c,l){const i=n?.[l],a=c?.[l];return i==null&&a==null?0:i==null?-1:a==null?1:typeof i=="boolean"&&typeof a=="boolean"?i===a?0:i?1:-1:typeof i=="number"&&typeof a=="number"?i-a:String(i).localeCompare(String(a))}function xn({name:n,title:c,columns:l,rows:i,getRowKey:a,footerLeft:f,footerRight:h,onRowClick:b}){const t=r.useRef(new WeakMap),M=r.useRef(1),j=d=>{if(typeof a=="string"&&d&&d[a]!=null)return d[a];if(typeof a=="function"){const x=a(d);if(x!=null)return x}const s=l?.[0]?.id;if(s&&d&&d[s]!=null)return d[s];console.warn(`MbfTable(${n}): using fallback stable row key; consider providing getRowKey prop for better React performance`);let g=t.current.get(d);return g||(g=`rk_${M.current++}`,t.current.set(d,g)),g},[w,S]=r.useState(localStorage.getItem(`${n}_table_order_by`)||null),[V,A]=r.useState(localStorage.getItem(`${n}_table_order`)||null),[_,N]=r.useState(!1),[v,p]=r.useState(()=>{try{const d=localStorage.getItem(`${n}_column_visibility`);if(d)return JSON.parse(d)}catch{}return{}}),u=r.useMemo(()=>{const d={};for(const s of l)s.hidden||(d[s.id]=s.required?!0:v[s.id]!==!1);return d},[l,v]),P=r.useMemo(()=>{if(!w||!V)return i;const d=l.find(g=>g.id===w);if(!d||d.noSort)return i;const s=i.map((g,x)=>({el:g,index:x}));return s.sort((g,x)=>{let H;return typeof d.comparator=="function"?H=d.comparator(g.el,x.el):H=fn(g.el,x.el,w),H!==0?V==="asc"?H:-H:g.index-x.index}),s.map(g=>g.el)},[i,w,V,l]),T=d=>{if(w!==d||!w){S(d),A("asc"),localStorage.setItem(`${n}_table_order_by`,d),localStorage.setItem(`${n}_table_order`,"asc");return}if(V==="asc"){A("desc"),localStorage.setItem(`${n}_table_order`,"desc");return}S(null),A(null),localStorage.removeItem(`${n}_table_order_by`),localStorage.removeItem(`${n}_table_order`)},y=()=>{N(!_)},q=d=>{p(s=>{const g=l.find(de=>de.id===d);if(g&&g.required)return s;const x=u[d]!==!1,H={...s};x?H[d]=!1:delete H[d];try{localStorage.setItem(`${n}_column_visibility`,JSON.stringify(H))}catch{}return H})},X=()=>{p({});try{localStorage.removeItem(`${n}_column_visibility`)}catch{}N(!1)};return o&&console.log(`Rendering table ${n}${w&&V?` ordered by ${w}:${V}`:""}`),e.jsxs("div",{style:{display:"flex",flexDirection:"column",margin:"0",padding:"0",gap:"0",width:"100%",flex:"1 1 auto",height:"100%",minHeight:0,overflow:"hidden"},children:[e.jsxs(Te,{open:_,onClose:(d,s)=>{s==="backdropClick"||s==="escapeKeyDown"||y()},disableEscapeKeyDown:!0,disableRestoreFocus:!0,children:[e.jsx(Re,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:`Configure ${n} columns`})]})}),e.jsx(He,{children:e.jsx(Ar,{children:l.filter(d=>!d.hidden).map(d=>e.jsx(Ue,{control:e.jsx(Ee,{disabled:!!d.required,checked:d.required?!0:u[d.id]!==!1,onChange:()=>q(d.id)}),label:d.label},d.id))})}),e.jsxs(_e,{children:[e.jsx(ie,{onClick:X,children:"Reset"}),e.jsx(ie,{variant:"contained",onClick:d=>{if(d?.currentTarget&&typeof d.currentTarget.blur=="function")try{d.currentTarget.blur()}catch{}const s=document.activeElement;if(s&&s instanceof HTMLElement&&typeof s.blur=="function")try{s.blur()}catch{}y()},children:"Close"})]})]}),e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",minHeight:"30px",justifyContent:"space-between",borderBottom:"none"},children:[e.jsx("p",{className:"MbfWindowHeaderText",children:n}),c&&e.jsx("p",{className:"MbfWindowHeaderText",children:c}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(Q,{onClick:d=>{if(d?.currentTarget?.blur)try{d.currentTarget.blur()}catch{}y()},"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(O,{title:`Configure ${n} columns`,children:e.jsx(ne,{path:Po,size:"20px",color:"var(--header-text-color)"})})})})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",flex:"1 1 auto",minHeight:0,width:"100%",overflow:"auto",margin:"0px",padding:"0px",gap:"0"},children:e.jsxs("table",{"aria-label":`${n} table`,style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,border:"none",color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color"},children:e.jsx("tr",{style:{height:"30px",minHeight:"30px"},children:l.map(d=>{if(d.hidden||!d.required&&u[d.id]===!1)return null;const s=!d.noSort,g=s&&w===d.id&&!!V;return e.jsxs("th",{onClick:s?()=>T(d.id):void 0,style:{margin:"0",padding:"5px 10px",position:"sticky",top:0,minWidth:d.minWidth,maxWidth:d.maxWidth,textAlign:d.align||"left",cursor:s?"pointer":"default",border:"none",color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color)",whiteSpace:d.maxWidth?"nowrap":void 0,overflow:d.maxWidth?"hidden":void 0,textOverflow:d.maxWidth?"ellipsis":void 0},"aria-sort":s?g?V==="asc"?"ascending":"descending":"none":void 0,children:[d.label,g&&e.jsxs("span",{style:{marginLeft:6},children:[V==="asc"&&e.jsx(ne,{path:Lo,size:"15px"}),V==="desc"&&e.jsx(ne,{path:$o,size:"15px"})]})]},d.id)})})}),e.jsx("tbody",{children:P.map((d,s)=>{const g=j(d);return e.jsx("tr",{className:s%2===0?"table-content-even":"table-content-odd",onClick:b?x=>b(d,g,x):void 0,style:{height:"30px",minHeight:"30px",border:"none",borderCollapse:"collapse",cursor:b?"pointer":void 0},children:l.map(x=>{if(x.hidden||!x.required&&u[x.id]===!1)return null;const H=d[x.id];return e.jsx("td",{style:{border:"none",borderCollapse:"collapse",textAlign:x.align||"left",padding:"5px 10px",margin:"0",maxWidth:x.maxWidth,whiteSpace:x.maxWidth?"nowrap":void 0,overflow:x.maxWidth?"hidden":void 0,textOverflow:x.maxWidth?"ellipsis":void 0},children:typeof x.render=="function"?x.render(H,g,d,x):typeof H=="boolean"?e.jsx(Ee,{checked:H,disabled:!0,size:"small",sx:{m:0,p:0,color:"var(--table-text-color)","&.Mui-disabled":{color:"var(--table-text-color)",opacity:.7}}}):x.format&&typeof H=="number"?x.format(H):H!=null?String(H):null},x.id)})},g)})})]})}),(f||h)&&e.jsxs("div",{className:"MbfWindowFooter",style:{height:"30px",minHeight:"30px",justifyContent:"space-between",border:"none"},children:[e.jsx("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)"},children:f}),e.jsx("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)"},children:h})]})]})}function bn(n){return r.memo(n)}const kt=bn(xn);function er(n){return n.id!==0&&n.src==="Matterbridge"&&n.dst==="Frontend"}const Ke={fontSize:"16px",fontWeight:"bold",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},Ge={fontSize:"12px",fontWeight:"normal",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},vn={fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)",backgroundColor:"var(--div-bg-color)"},yn={fontSize:"16px",fontWeight:"bold",backgroundColor:"var(--div-bg-color)"},Ve={padding:"0px",margin:"0px"},jn="5px 10px 5px 10px",xt={},we={},bt={},vt={};let Je=[],Pt=[];const wn=({open:n,onClose:c,plugin:l})=>{const{sendMessage:i,addListener:a,removeListener:f,getUniqueId:h}=r.useContext(xe),b=r.useRef(h()),[t,M]=r.useState(l.configJson),[j,w]=r.useState(null),[S,V]=r.useState({"ui:submitButtonOptions":{submitText:"Confirm"},"ui:globalOptions":{orderable:!0}}),[A,_]=r.useState("");let N={};r.useEffect(()=>{const W=k=>{k.src==="Matterbridge"&&k.dst==="Frontend"&&(er(k)&&k.id===b.current&&k.method==="/api/select/devices"&&k.response&&(o&&console.log(`ConfigPluginDialog (id: ${k.id}) received ${k.response.length} /api/select/devices:`,k.response),Je=k.response),er(k)&&k.id===b.current&&k.method==="/api/select/entities"&&k.response&&(o&&console.log(`ConfigPluginDialog (id: ${k.id}) received ${k.response.length} /api/select/entities:`,k.response),Pt=k.response))};return a(W,b.current),o&&console.log("ConfigPluginDialog added WebSocket listener id:",b.current),t&&j&&j.properties&&(Object.keys(j.properties).forEach(k=>{Object.keys(j.properties[k]).forEach(C=>{C.startsWith("ui:")&&(S[k]={},S[k][C]=j.properties[k][C],delete j.properties[k][C])})}),V(S)),l.name&&l.configJson&&l.schemaJson&&(M(l.configJson),w(l.schemaJson),i({id:b.current,sender:"ConfigPlugin",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:l.name}}),i({id:b.current,sender:"ConfigPlugin",method:"/api/select/entities",src:"Frontend",dst:"Matterbridge",params:{plugin:l.name}}),o&&console.log('HomePlugins sent "/api/select/devices" and "/api/select/entities" for plugin:',l.name)),()=>{f(W),o&&console.log("ConfigPluginDialog removed WebSocket listener")}},[a,t,l,f,j,i,S]);const v=(W,k)=>{N=W.formData},p=W=>{o&&console.log("ConfigPluginDialog handleSaveChanges:",W.formData),M(W.formData),l.configJson=W.formData,l.restartRequired=!0,i({id:b.current,sender:"ConfigPlugin",method:"/api/savepluginconfig",src:"Frontend",dst:"Matterbridge",params:{pluginName:W.formData.name,formData:W.formData}}),c()};function u(W){const{id:k,label:C,onKeyChange:L,onDropPropertyClick:K,disabled:ae,schema:oe,children:ce,registry:ue,readonly:pe,required:I}=W,{templates:m}=ue,{RemoveButton:fe}=m.ButtonTemplates;if(!(nn in oe))return e.jsx(te,{sx:{display:"flex",flexDirection:"column",flexGrow:1,padding:0,margin:0,border:"none"},children:ce});const he=({target:Z})=>L(Z&&Z.value);return e.jsxs(te,{sx:{display:"flex",flexDirection:"row",flexGrow:1,padding:0,margin:0,border:"none"},children:[e.jsx(me,{id:`${k}-key`,name:`${k}-key`,required:I,disabled:ae||pe,defaultValue:C,onBlur:pe?void 0:he,type:"text",variant:"outlined",sx:{width:"250px",minWidth:"250px",maxWidth:"250px",marginRight:"20px"}}),e.jsx(te,{sx:{flex:1},children:ce}),e.jsx(fe,{disabled:ae||pe,onClick:K(C),registry:ue})]})}function P(W){const{children:k,description:C,displayLabel:L,errors:K,help:ae,hidden:oe,registry:ce,uiSchema:ue}=W,pe=rn(ue),I=on("WrapIfAdditionalTemplate",ce,pe);return oe?e.jsx("div",{style:{display:"none"},children:k}):e.jsx(te,{sx:{display:"flex",flexDirection:"column",flexGrow:1,padding:0,margin:0,border:"none"},children:e.jsxs(I,{...W,children:[L===!0&&C,k,K,ae]})})}function T(W){const{description:k}=W;return k?e.jsx(le,{sx:Ge,children:k}):null}function y(W){const{required:k,title:C}=W;return C?e.jsx(te,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:e.jsxs(le,{sx:Ke,children:["Title ",C," ",k&&e.jsx("mark",{children:"***"})]})}):null}function q(W){const{help:k}=W;return k?e.jsx(te,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:e.jsx(le,{sx:vn,children:k})}):null}function X(W){const{errors:k}=W;return k?e.jsxs(te,{sx:{padding:"10px",margin:"10px",border:"1px solid grey"},children:[e.jsx(le,{color:"error",sx:yn,children:"Please fix the following errors:"}),e.jsx(ot,{children:k.map((C,L)=>e.jsxs(_r,{children:[e.jsx(B,{children:e.jsx(qr,{color:"error"})}),e.jsx(Y,{primary:C.stack})]},L))})]}):null}function d(W){const{errors:k}=W;return k?e.jsx(te,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:k.map((C,L)=>e.jsxs(le,{color:"error",variant:"body2",sx:{marginLeft:1},children:["This field ",C]},L))}):null}function s(W){const{id:k,name:C,_schema:L,_uiSchema:K,value:ae,options:oe,label:ce,type:ue,placeholder:pe,required:I,disabled:m,readonly:fe,autofocus:ee,onChange:he,onChangeOverride:Z,onBlur:ge,onFocus:be,_rawErrors:rt,_hideError:Fe,_registry:U,_formContext:E}=W,re=({target:{value:Pe}})=>he(Pe===""?oe.emptyValue:Pe),je=({target:Pe})=>ge(k,Pe&&Pe.value),at=({target:Pe})=>be(k,Pe&&Pe.value);return e.jsx(te,{sx:{padding:"0px",margin:"0px"},children:e.jsx(me,{id:k,name:k,label:pe&&pe!==""?ce:void 0,variant:"outlined",placeholder:pe&&pe!==""?pe:ce,required:I,disabled:m||fe,autoFocus:ee,value:ae||ae===0?ae:"",type:ue,autoComplete:ue==="password"?"current-password":C,onChange:Z||re,onBlur:je,onFocus:at,fullWidth:!0})})}function g(W){return console.log("ArrayFieldTitleTemplate:",W),null}function x(W){return console.log("ArrayFieldDescriptionTemplate:",W),null}function H(W){return console.log("ArrayFieldItemTemplate:",W),null}function de(W){const{canAdd:k,onAddClick:C,schema:L,title:K}=W,[ae,oe]=r.useState(!1),[ce,ue]=r.useState(!1),[pe,I]=r.useState(!1),[m,fe]=r.useState(""),ee=U=>{fe(U.target.value)},he=()=>{o&&console.log("ArrayFieldTemplate: handleDialogDeviceToggle filter:",m,"selectDevices:",Je),oe(!ae)},Z=()=>{o&&console.log("ArrayFieldTemplate: handleDialogEntityToggle filter:",m,"selectEntities:",Pt),ue(!ce)},ge=()=>{o&&console.log("ArrayFieldTemplate: handleDialogDeviceEntityToggle filter:",m,"selectDevices:",Je),I(!pe)},be=U=>{oe(!1),L.selectFrom==="serial"?L.items.default=U.serial:L.selectFrom==="name"&&(L.items.default=U.name),C()},rt=U=>{ue(!1),L.selectEntityFrom==="name"?L.items.default=U.name:L.selectEntityFrom==="description"&&(L.items.default=U.description),C()},Fe=U=>{I(!1),L.selectDeviceEntityFrom==="name"?L.items.default=U.name:L.selectDeviceEntityFrom==="description"&&(L.items.default=U.description),C()};return e.jsxs(te,{sx:{margin:"0px",padding:"5px 10px 5px 10px",border:"1px solid grey"},children:[K&&e.jsxs(te,{sx:{margin:"0px",padding:"0px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[K&&e.jsx(le,{sx:Ke,children:K}),k&&e.jsxs(te,{sx:{margin:"0px",padding:"0px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[L.selectFrom&&e.jsx(O,{title:"Add a device from the list",children:e.jsx(Q,{onClick:he,size:"small",color:"primary",sx:Ve,children:e.jsx(ct,{})})}),L.selectEntityFrom&&e.jsx(O,{title:"Add an entity from the list",children:e.jsx(Q,{onClick:Z,size:"small",color:"primary",sx:Ve,children:e.jsx(ct,{})})}),L.selectDeviceEntityFrom&&e.jsx(O,{title:"Add a device entity from the list",children:e.jsx(Q,{onClick:ge,size:"small",color:"primary",sx:Ve,children:e.jsx(ct,{})})}),e.jsx(O,{title:"Add a new item",children:e.jsx(Q,{onClick:C,size:"small",color:"primary",sx:Ve,children:e.jsx(jt,{})})})]})]}),L.description&&e.jsx(le,{sx:Ge,children:L.description}),W.items.map(U=>e.jsxs(te,{sx:{margin:"2px 0px",padding:"0px",display:"flex",alignItems:"center"},children:[e.jsx(te,{sx:{flexGrow:1,marginRight:"10px"},children:U.children}),e.jsx(Q,{disabled:!U.hasMoveUp,onClick:U.onReorderClick(U.index,U.index-1),size:"small",color:"primary",sx:Ve,children:e.jsx(At,{})}),e.jsx(Q,{disabled:!U.hasMoveDown,onClick:U.onReorderClick(U.index,U.index+1),size:"small",color:"primary",sx:Ve,children:e.jsx(Et,{})}),e.jsx(Q,{onClick:U.onDropIndexClick(U.index),size:"small",color:"primary",sx:Ve,children:e.jsx(Nt,{})})]},U.index)),e.jsxs(Te,{open:ae,onClose:he,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(Re,{children:"Select a device"}),e.jsxs(He,{children:[e.jsxs(te,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(le,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(me,{fullWidth:!0,variant:"outlined",value:m,onChange:ee,placeholder:"Enter serial or name"})]}),e.jsx(ot,{dense:!0,children:Je.filter(U=>U.serial.toLowerCase().includes(m.toLowerCase())||U.name.toLowerCase().includes(m.toLowerCase())).map((U,E)=>e.jsxs(dt,{onClick:()=>be(U),sx:xt,children:[U.icon==="wifi"&&e.jsx(B,{children:e.jsx(it,{style:we})}),U.icon==="ble"&&e.jsx(B,{children:e.jsx(pt,{style:we})}),U.icon==="hub"&&e.jsx(B,{children:e.jsx(ut,{style:we})}),e.jsx(Y,{primary:U.name,secondary:U.serial,primaryTypographyProps:{style:bt},secondaryTypographyProps:{style:vt}})]},E))})]}),e.jsx(_e,{children:e.jsx(ie,{onClick:he,children:"Close"})})]}),e.jsxs(Te,{open:ce,onClose:Z,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(Re,{children:"Select an entity"}),e.jsxs(He,{children:[e.jsxs(te,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(le,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(me,{fullWidth:!0,variant:"outlined",value:m,onChange:ee,placeholder:"Enter name or description"})]}),e.jsx(ot,{dense:!0,children:Pt.filter(U=>U.name.toLowerCase().includes(m.toLowerCase())||U.description.toLowerCase().includes(m.toLowerCase())).map((U,E)=>e.jsxs(dt,{onClick:()=>rt(U),sx:xt,children:[U.icon==="wifi"&&e.jsx(B,{children:e.jsx(it,{style:we})}),U.icon==="ble"&&e.jsx(B,{children:e.jsx(pt,{style:we})}),U.icon==="hub"&&e.jsx(B,{children:e.jsx(ut,{style:we})}),U.icon==="component"&&e.jsx(B,{children:e.jsx(_t,{style:we})}),U.icon==="matter"&&e.jsx(B,{children:e.jsx(qt,{style:we})}),e.jsx(Y,{primary:U.name,secondary:U.description,primaryTypographyProps:{style:bt},secondaryTypographyProps:{style:vt}})]},E))})]}),e.jsx(_e,{children:e.jsx(ie,{onClick:Z,children:"Close"})})]}),e.jsxs(Te,{open:pe,onClose:ge,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsxs(Re,{children:["Select an entity for ",K]}),e.jsx(He,{children:e.jsx(ot,{dense:!0,children:Je.filter(U=>U.serial===K||U.name===K).map(U=>U.entities?.map((E,re)=>e.jsxs(dt,{onClick:()=>Fe(E),sx:xt,children:[E.icon==="wifi"&&e.jsx(B,{children:e.jsx(it,{style:we})}),E.icon==="ble"&&e.jsx(B,{children:e.jsx(pt,{style:we})}),E.icon==="hub"&&e.jsx(B,{children:e.jsx(ut,{style:we})}),E.icon==="component"&&e.jsx(B,{children:e.jsx(_t,{style:we})}),E.icon==="matter"&&e.jsx(B,{children:e.jsx(qt,{style:we})}),e.jsx(Y,{primary:E.name,secondary:E.description,primaryTypographyProps:{style:bt},secondaryTypographyProps:{style:vt}})]},re)))})}),e.jsx(_e,{children:e.jsx(ie,{onClick:ge,children:"Close"})})]})]})}function ve(W){const{onAddClick:k,schema:C,properties:L,title:K,description:ae}=W,[oe,ce]=r.useState(!1),[ue,pe]=r.useState(""),I=Z=>{pe(Z.target.value)},m=()=>{ce(!oe)},fe=Z=>{o&&console.log(`ObjectFieldTemplate: handleSelectValue value "${Z.serial}" for schema "${C.selectFrom}"`),ce(!1);let ge="";C.selectFrom==="serial"?ge=Z.serial:C.selectFrom==="name"&&(ge=Z.name),_(ge),o&&console.log(`ObjectFieldTemplate: handleSelectValue newkey "${ge}"`),k(C)()},ee=()=>{k(C)()},he=!C.additionalProperties;return o&&console.log(`ObjectFieldTemplate: isRoot ${he} newkey "${A}"`),!he&&A!==""&&(o&&console.log("ObjectFieldTemplate: newkey",A,"properties",L),L.forEach(Z=>{if(Z.name==="newKey"&&Z.content.key==="newKey"&&Z.content.props.name==="newKey"&&Z.content.props.onKeyChange&&A!==""){o&&console.log("ObjectFieldTemplate: newkey onKeyChange",A);const ge=A;_(""),Z.content.props.onKeyChange(ge)}})),e.jsxs(te,{sx:{margin:"0px",padding:he?"10px":"5px 10px 0px 10px",border:he?"none":"1px solid grey"},children:[C.title&&he&&e.jsx(te,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px",marginBottom:"10px"},children:e.jsx(le,{sx:Ke,children:C.title})}),K&&!he&&e.jsxs(te,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px"},children:[e.jsx(le,{sx:Ke,children:K}),e.jsxs(te,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px"},children:[C.selectFrom&&e.jsx(O,{title:"Add a device from the list",children:e.jsx(Q,{onClick:m,size:"small",color:"primary",sx:Ve,children:e.jsx(ct,{})})}),e.jsx(O,{title:"Add a new item",children:e.jsx(Q,{onClick:ee,size:"small",color:"primary",sx:Ve,children:e.jsx(jt,{})})})]})]}),C.description&&e.jsx(te,{sx:{padding:"0px",margin:"0px",marginBottom:"10px"},children:e.jsx(le,{sx:Ge,children:C.description})}),L.map(({content:Z,name:ge,hidden:be})=>!be&&e.jsxs(te,{sx:{margin:"0px",marginBottom:"10px",padding:["object","array","boolean"].includes(C.properties[ge].type)?"0px":jn,border:["object","array","boolean"].includes(C.properties[ge].type)?"none":"1px solid grey"},children:[!["object","array","boolean"].includes(C.properties[ge].type)&&e.jsx(le,{sx:Ke,children:ge}),e.jsx(te,{sx:{flexGrow:1,padding:"0px",margin:"0px"},children:Z})]},ge)),e.jsxs(Te,{open:oe,onClose:m,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(Re,{children:"Select a device"}),e.jsxs(He,{children:[e.jsxs(te,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(le,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(me,{fullWidth:!0,variant:"outlined",value:ue,onChange:I,placeholder:"Enter serial or name"})]}),e.jsx(ot,{dense:!0,children:Je.filter(Z=>Z.serial.toLowerCase().includes(ue.toLowerCase())||Z.name.toLowerCase().includes(ue.toLowerCase())).map((Z,ge)=>e.jsxs(dt,{onClick:()=>fe(Z),sx:xt,children:[Z.icon==="wifi"&&e.jsx(B,{children:e.jsx(it,{style:we})}),Z.icon==="ble"&&e.jsx(B,{children:e.jsx(pt,{style:we})}),Z.icon==="hub"&&e.jsx(B,{children:e.jsx(ut,{style:we})}),e.jsx(Y,{primary:Z.name,secondary:Z.serial,primaryTypographyProps:{style:bt},secondaryTypographyProps:{style:vt}})]},ge))})]}),e.jsx(_e,{children:e.jsx(ie,{onClick:m,children:"Close"})})]})]})}function se(W){const{uiSchema:k}=W,{submitText:C,norender:L}=tn(k);return L?null:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",margin:"10px",padding:"0px",gap:"20px"},children:[e.jsx(ie,{type:"submit",variant:"contained",color:"primary",children:C}),e.jsx(ie,{variant:"contained",color:"primary",onClick:c,children:"Cancel"})]})}function ye(W){const{className:k,disabled:C,onClick:L,registry:K,style:ae,uiSchema:oe,...ce}=W;return e.jsx(O,{title:"Remove the item",children:e.jsx(Q,{disabled:C,size:"small",color:"primary",onClick:L,children:e.jsx(Nt,{})})})}function R(W){const{className:k,disabled:C,onClick:L,registry:K,uiSchema:ae,...oe}=W;return e.jsx(O,{title:"Add an item",children:e.jsx(Q,{size:"small",color:"primary",onClick:L,children:e.jsx(jt,{})})})}function z(W){const{disabled:k,onClick:C,registry:L,style:K,uiSchema:ae,...oe}=W;return e.jsx(O,{title:"Move up the item",children:e.jsx(Q,{size:"small",color:"primary",onClick:C,children:e.jsx(At,{})})})}function F(W){const{disabled:k,onClick:C,registry:L,style:K,uiSchema:ae,...oe}=W;return e.jsx(O,{title:"Move down the item",children:e.jsx(Q,{size:"small",color:"primary",onClick:C,children:e.jsx(Et,{})})})}function G(W){const{id:k,name:C,value:L,schema:K,readonly:ae,onChange:oe}=W,[ce,ue]=r.useState(),pe=m=>{o&&console.log(`CheckboxWidget ${C} onChangeField:`,m),ue(m&&m!==""?m:void 0)},I=()=>{o&&console.log(`CheckboxWidget onClick plugin="${l.name}" action="${C}" value="${ce}"`),i({id:b.current,sender:"ConfigPlugin",method:"/api/action",src:"Frontend",dst:"Matterbridge",params:{plugin:l.name,action:C,value:ce,formData:N,id:k}}),K.buttonClose===!0?c():K.buttonSave===!0&&p({formData:t})};return K.buttonText&&K.description?e.jsxs(te,{sx:{margin:"0px",padding:"10px",border:"1px solid grey",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(le,{sx:Ge,children:K.description}),e.jsx(ie,{variant:"contained",color:"primary",onClick:()=>I(),children:K.buttonText})]}):K.buttonField&&K.description?e.jsxs(te,{sx:{margin:"0px",padding:"10px",gap:"20px",border:"1px solid grey",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(le,{sx:Ge,children:K.description}),e.jsx(me,{id:C+"-input",name:C,label:K.textLabel,placeholder:K.textPlaceholder,onChange:m=>pe(m.target.value),sx:{width:"250px",minWidth:"250px",maxWidth:"250px"}}),e.jsx(ie,{id:C+"-button",variant:"contained",color:"primary",disabled:ce===void 0,onClick:()=>I(),children:K.buttonField})]}):e.jsxs(te,{sx:{margin:"0px",padding:"5px 10px",border:"1px solid grey"},children:[C&&e.jsxs(te,{sx:{margin:"0px",padding:"0px",gap:"10px",display:"flex",justifyContent:"flex-start",alignItems:"center"},children:[e.jsx(le,{sx:Ke,children:C}),e.jsx(Ee,{checked:L,readOnly:ae,onChange:()=>oe(!L),sx:{padding:"0px",margin:"0px"}})]}),K.description&&e.jsx(le,{sx:Ge,children:K.description})]})}function $({schema:W,id:k,name:C,options:L,label:K,hideLabel:ae,required:oe,disabled:ce,placeholder:ue,readonly:pe,value:I,multiple:m,autofocus:fe,onChange:ee,onBlur:he,onFocus:Z,errorSchema:ge,rawErrors:be=[],registry:rt,uiSchema:Fe,hideError:U,formContext:E,...re}){const{enumOptions:je,enumDisabled:at,emptyValue:Pe}=L;m=typeof m>"u"?!1:!!m;const Rt=m?[]:"",Ht=typeof I>"u"||m&&I.length<1||!m&&I===Rt,vr=({target:{value:Oe}})=>ee(Dt(Oe,je,Pe)),yr=({target:Oe})=>he(k,Dt(Oe&&Oe.value,je,Pe)),jr=({target:Oe})=>Z(k,Dt(Oe&&Oe.value,je,Pe)),Ot=Xo(I,je,m),{InputLabelProps:wr,SelectProps:Cr,autocomplete:Sr,...kr}=re,Mr=!m&&W.default===void 0;return e.jsxs(me,{id:k,name:k,value:!Ht&&typeof Ot<"u"?Ot:Rt,required:oe,disabled:ce||pe,autoFocus:fe,autoComplete:Sr,placeholder:ue,error:be.length>0,onChange:vr,onBlur:yr,onFocus:jr,...kr,select:!0,InputLabelProps:{...wr,shrink:!Ht},SelectProps:{...Cr,multiple:m},"aria-describedby":en(k),children:[Mr&&e.jsx(D,{value:"",children:ue}),Array.isArray(je)&&je.map(({value:Oe,label:Ir},Vt)=>{const Dr=Array.isArray(at)&&at.indexOf(Oe)!==-1;return e.jsx(D,{value:String(Vt),disabled:Dr,children:Ir},Vt)})]})}return o&&console.log("ConfigPluginDialog rendering..."),!n||!j||!t?null:e.jsxs(Te,{open:n,onClose:c,slotProps:{paper:{sx:{maxWidth:"800px"}}},children:[e.jsx(Re,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h3",{children:"Matterbridge plugin configuration"})]})}),e.jsx(He,{style:{padding:"0px",margin:"0px",width:"800px",height:"600px",overflow:"auto"},children:e.jsx(Zo,{schema:j,formData:t,uiSchema:S,validator:Yo,templates:{FieldTemplate:P,BaseInputTemplate:s,TitleFieldTemplate:y,DescriptionFieldTemplate:T,FieldHelpTemplate:q,FieldErrorTemplate:d,ErrorListTemplate:X,WrapIfAdditionalTemplate:u,ArrayFieldTitleTemplate:g,ArrayFieldDescriptionTemplate:x,ArrayFieldItemTemplate:H,ArrayFieldTemplate:de,ObjectFieldTemplate:ve,ButtonTemplates:{SubmitButton:se,RemoveButton:ye,AddButton:R,MoveUpButton:z,MoveDownButton:F}},widgets:{CheckboxWidget:G,SelectWidget:$},onChange:v,onSubmit:p})})]})};function hr(n){if(o&&console.log(`getQRColor (id: ${n?.id}) received matter:`,n??"undefined"),n===void 0||!n.online||!n.qrPairingCode&&!n.manualPairingCode&&!n.fabricInformations&&!n.sessionInformations)return"red";if(n.commissioned===!1&&n.qrPairingCode&&n.manualPairingCode)return"var(--primary-color)";let c=0,l=0;for(const i of n.sessionInformations??[])i.fabric&&i.isPeerActive===!0&&c++,i.numberOfActiveSubscriptions>0&&(l+=i.numberOfActiveSubscriptions);return n.commissioned===!0&&n.fabricInformations&&n.sessionInformations&&(c===0||l===0)?"var(--secondary-color)":"var(--div-text-color)"}function Cn({storeId:n,setStoreId:c}){const{online:l,sendMessage:i,addListener:a,removeListener:f,getUniqueId:h}=r.useContext(xe),{showConfirmCancelDialog:b}=r.useContext(De),t=r.useRef(h()),[M,j]=r.useState(null),[w,S]=r.useState(null),[V,A]=r.useState([]),_=[{label:"Name",id:"name",required:!0,render:(F,G,$,W)=>e.jsx(O,{title:`Plugin path ${$.path}`,children:e.jsx("span",{style:{cursor:"pointer"},onClick:()=>d($),children:$.name})})},{label:"Description",id:"description",render:(F,G,$,W)=>e.jsx(O,{title:"Open the plugin homepage",children:e.jsx("span",{style:{cursor:"pointer"},onClick:()=>d($),children:$.description})})},{label:"Version",id:"version",render:(F,G,$,W)=>e.jsx(e.Fragment,{children:e.jsx(O,{title:`Plugin v.${$.version}`,children:e.jsx("span",{children:$.version.split("-dev-")[0]+($.version.includes("-dev-")?"@dev":"")})})})},{label:"Author",id:"author",render:(F,G,$,W)=>e.jsx(e.Fragment,{children:$.author?$.author.replace("https://github.com/",""):"Unknown"})},{label:"Type",id:"type",render:(F,G,$,W)=>e.jsx(e.Fragment,{children:$.type?$.type.replace("Platform",""):"Unknown"})},{label:"Devices",id:"registeredDevices"},{label:"Actions",id:"actions",required:!0,noSort:!0,render:(F,G,$,W)=>e.jsxs("div",{style:{margin:"0px",padding:"0px",gap:"4px",display:"flex",flexDirection:"row"},children:[w&&w.bridgeMode==="childbridge"&&!$.error&&$.enabled&&e.jsx(O,{title:"Shows the QRCode or the fabrics",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0",padding:"0",width:"19px",height:"19px",color:hr($.matter)},onClick:()=>{$.matter?.id&&c($.matter?.id)},size:"small",children:e.jsx(sr,{})})}),w&&w.bridgeMode==="childbridge"&&!$.error&&$.enabled&&e.jsx(O,{title:"Restart the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0",padding:"0",width:"19px",height:"19px"},onClick:()=>q($),size:"small",children:e.jsx(wt,{})})}),e.jsx(O,{title:"Plugin config",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{disabled:$.restartRequired===!0,style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>ye($),size:"small",children:e.jsx(Ur,{})})}),w&&!w.readOnly&&e.jsx(O,{title:"Remove the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>{v("Remove plugin","Are you sure? This will also remove all devices and configuration from the controller.","remove",$)},size:"small",children:e.jsx(ir,{})})}),$.enabled?e.jsx(O,{title:"Disable the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>{v("Disable plugin","Are you sure? This will also remove all devices and configuration from the controller.","disable",$)},size:"small",children:e.jsx(zr,{})})}):e.jsx(e.Fragment,{}),$.enabled?e.jsx(e.Fragment,{}):e.jsx(O,{title:"Enable the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>X($),size:"small",children:e.jsx(Br,{})})}),e.jsx(O,{title:"Open the plugin help",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0px 2px",padding:"0px",width:"19px",height:"19px"},onClick:()=>g($),size:"small",children:e.jsx(ar,{})})}),e.jsx(O,{title:"Open the plugin version history",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0px 2px",padding:"0px",width:"19px",height:"19px"},onClick:()=>x($),size:"small",children:e.jsx(Ft,{})})}),$.latestVersion!==void 0&&$.latestVersion!==$.version&&w&&!w.readOnly&&e.jsx(O,{title:"Update the plugin to the latest version",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{color:"var(--primary-color)",margin:"0px 2px",padding:"0px",width:"19px",height:"19px"},onClick:()=>P($),size:"small",children:e.jsx($e,{})})}),$.version.includes("-dev-")&&$.devVersion!==void 0&&$.devVersion!==$.version&&w&&!w.readOnly&&e.jsx(O,{title:"Update the plugin to the latest dev version",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{color:"var(--primary-color)",margin:"0px 2px",padding:"0px",width:"19px",height:"19px"},onClick:()=>T($),size:"small",children:e.jsx($e,{})})}),w&&!w.readOnly&&e.jsx(O,{title:"Sponsor the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0",padding:"0",width:"19px",height:"19px",color:"#b6409c"},onClick:()=>s($),size:"small",children:e.jsx(Tt,{})})})]})},{label:"Status",id:"status",required:!0,noSort:!0,render:(F,G,$,W)=>e.jsx("div",{style:{display:"flex",flexDirection:"row",flex:"1 1 auto",margin:"0",padding:"0",gap:"5px",width:"auto",maxWidth:"max-content"},children:$.error?e.jsx(e.Fragment,{children:e.jsx(Qe,{status:!1,enabledText:"Error",disabledText:"Error",tooltipText:"The plugin is in error state. Check the log!"})}):e.jsx(e.Fragment,{children:$.enabled===!1?e.jsx(e.Fragment,{children:e.jsx(Qe,{status:$.enabled,enabledText:"Enabled",disabledText:"Disabled",tooltipText:"Whether the plugin is enable or disabled"})}):e.jsx(e.Fragment,{children:$.loaded&&$.started&&$.configured?e.jsx(e.Fragment,{children:e.jsx(Qe,{status:$.loaded,enabledText:"Running",tooltipText:"Whether the plugin is running"})}):e.jsxs(e.Fragment,{children:[e.jsx(Qe,{status:$.loaded,enabledText:"Loaded",tooltipText:"Whether the plugin has been loaded"}),e.jsx(Qe,{status:$.started,enabledText:"Started",tooltipText:"Whether the plugin started"}),e.jsx(Qe,{status:$.configured,enabledText:"Configured",tooltipText:"Whether the plugin has been configured"})]})})})})}];r.useEffect(()=>{const F=G=>{o&&console.log("HomePlugins received WebSocket Message:",G),G.method==="refresh_required"&&G.response.changed==="plugins"?(o&&console.log(`HomePlugins received refresh_required: changed=${G.response.changed} and sending /api/plugins request`),i({id:t.current,sender:"HomePlugins",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})):G.method==="refresh_required"&&G.response.changed==="matter"?(o&&console.log(`HomePlugins received refresh_required: changed=${G.response.changed} and setting matter id ${G.response.matter?.id}`),A($=>{const W=$.findIndex(C=>C.matter?.id===G.response.matter?.id);if(W<0)return o&&console.log(`HomePlugins received refresh_required: changed=${G.response.changed} and matter id ${G.response.matter?.id} not found`),$;o&&console.log(`HomePlugins received refresh_required: changed=${G.response.changed} set matter id ${G.response.matter?.id}`);const k=[...$];return k[W]={...k[W],matter:G.response.matter},k})):G.method==="refresh_required"&&G.response.changed==="settings"&&(o&&console.log(`HomePlugins received refresh_required: changed=${G.response.changed} and sending /api/settings request`),i({id:t.current,sender:"HomePlugins",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),G.id===t.current&&G.method==="/api/settings"?(o&&console.log(`HomePlugins (id: ${G.id}) received settings:`,G.response),j(G.response.systemInformation),S(G.response.matterbridgeInformation)):G.id===t.current&&G.method==="/api/plugins"&&(o&&console.log(`HomePlugins (id: ${G.id}) received ${G.response.length} plugins:`,G.response),A(G.response))};return a(F,t.current),o&&console.log("HomePlugins added WebSocket listener id:",t.current),()=>{f(F),o&&console.log("HomePlugins removed WebSocket listener")}},[a,f,i]),r.useEffect(()=>{l&&(o&&console.log("HomePlugins sending api requests"),i({id:t.current,sender:"HomePlugins",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),i({id:t.current,sender:"HomePlugins",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[l,i]);const N=r.useRef(null),v=(F,G,$,W)=>{o&&console.log(`handleActionWithConfirmCancel ${$} ${W.name}`),N.current=W,b(F,G,$,p,u)},p=F=>{o&&console.log(`handleConfirm action confirmed ${F} ${N.current?.name}`),F==="remove"&&N.current?y(N.current):F==="disable"&&N.current&&X(N.current),N.current=null},u=F=>{o&&console.log(`handleCancel action canceled ${F} ${N.current?.name}`),N.current=null},P=F=>{o&&console.log("handleUpdatePlugin plugin:",F.name),i({id:t.current,sender:"HomePlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:F.name,restart:!1}})},T=F=>{o&&console.log("handleUpdateDevPlugin plugin:",F.name),i({id:t.current,sender:"HomePlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:F.name+"@dev",restart:!1}})},y=F=>{o&&console.log("handleRemovePlugin plugin:",F.name),i({id:t.current,sender:"HomePlugins",method:"/api/removeplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:F.name}})},q=F=>{o&&console.log("handleRestartPlugin plugin:",F.name),i({id:t.current,sender:"HomePlugins",method:"/api/restartplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:F.name}})},X=F=>{o&&console.log("handleEnableDisablePlugin plugin:",F.name,"enabled:",F.enabled),F.enabled===!0?(F.enabled=!1,i({id:t.current,sender:"HomePlugins",method:"/api/disableplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:F.name}})):(F.enabled=!0,i({id:t.current,sender:"HomePlugins",method:"/api/enableplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:F.name}}))},d=F=>{o&&console.log(`handleHomepagePlugin plugin: ${F.name} homepage: ${F.homepage}`),F.homepage&&window.open(F.homepage,"_blank")},s=F=>{o&&console.log("handleSponsorPlugin plugin:",F.name,"funding:",F.funding),F.funding&&window.open(F.funding,"_blank")},g=F=>{o&&console.log("handleHelpPlugin plugin:",F.name,"help:",F.help),F.help&&window.open(F.help,"_blank")},x=F=>{o&&console.log("handleChangelogPlugin plugin:",F.name,"changelog:",F.changelog),F.changelog&&window.open(F.changelog,"_blank")},[H,de]=r.useState(),[ve,se]=r.useState(!1),ye=F=>{o&&console.log("handleConfigPlugin plugin:",F.name),i({id:t.current,sender:"HomePlugins",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:F.name}}),i({id:t.current,sender:"HomePlugins",method:"/api/select/entities",src:"Frontend",dst:"Matterbridge",params:{plugin:F.name}}),de(F),R()},R=()=>{se(!0)},z=()=>{se(!1)};return o&&console.log("HomePlugins rendering..."),l?e.jsxs(Se,{children:[H&&e.jsx(wn,{open:ve,onClose:z,plugin:H}),e.jsx(kt,{name:"Plugins",columns:_,rows:V,footerRight:"",footerLeft:""})]}):e.jsx(We,{})}const Sn=r.memo(Cn),kn=n=>`${n.pluginName}::${n.serial}`;function Mn({storeId:n,setStoreId:c}){const{online:l,sendMessage:i,addListener:a,removeListener:f,getUniqueId:h}=r.useContext(xe),[b,t]=r.useState(!1),[M,j]=r.useState(!0),[w,S]=r.useState(null),[V,A]=r.useState([]),[_,N]=r.useState([]),[v,p]=r.useState([]),[u,P]=r.useState([]),T=r.useRef(h()),y=[{label:"Plugin",id:"pluginName"},{label:"Name",id:"name",required:!0},{label:"Serial",id:"serial"},{label:"Availability",id:"availability",render:(d,s,g,x)=>g.reachable===!0?"Online":g.reachable===!1?e.jsx("span",{style:{color:"red"},children:"Offline"}):"",comparator:(d,s)=>{const g=d.reachable===!0?1:d.reachable===!1?0:-1,x=s.reachable===!0?1:s.reachable===!1?0:-1;return g-x}},{label:"Power",id:"powerSource",render:(d,s,g,x)=>g.powerSource==="ac"||g.powerSource==="dc"?e.jsx(lr,{fontSize:"small",sx:{color:"var(--primary-color)"}}):g.powerSource==="ok"?e.jsx(Ct,{fontSize:"small",sx:{color:"green"}}):g.powerSource==="warning"?e.jsx(Ct,{fontSize:"small",sx:{color:"yellow"}}):g.powerSource==="critical"?e.jsx(Ct,{fontSize:"small",sx:{color:"red"}}):e.jsx("span",{})},{label:"Actions",id:"selected",required:!0,render:(d,s,g,x)=>e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[g.matter!==void 0?e.jsx(O,{title:"Show the QRCode or the fabrics",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{onClick:()=>c(n===g.matter?.id?w?.matterbridgeInformation.bridgeMode==="bridge"?"Matterbridge":null:g.matter?.id||null),"aria-label":"Show the QRCode",sx:{margin:0,padding:0,color:hr(g.matter)},children:e.jsx(sr,{fontSize:"small"})})}):e.jsx("div",{style:{width:"20px",height:"20px"}}),g.configUrl?e.jsx(O,{title:"Open the configuration page",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{onClick:()=>window.open(g.configUrl,"_blank"),"aria-label":"Open config url",sx:{margin:0,padding:0},children:e.jsx(cr,{fontSize:"small"})})}):e.jsx("div",{style:{width:"20px",height:"20px"}}),g.selected!==void 0?e.jsx(O,{title:"Select/unselect the device",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Ee,{checked:g.selected,onChange:H=>X(H,g),sx:{margin:"0",marginLeft:"8px",padding:"0"},size:"small"})}):e.jsx("div",{style:{width:"20px",height:"20px"}})]})}],q=r.useCallback(d=>{d.selected=void 0;const s=V.find(H=>H.name===d.pluginName);if(!s)return console.error(`HomeDevices isSelected: plugin ${d.pluginName} not found for device ${d.name} `),d.selected;const g=s.schemaJson?.properties?.whiteList?.selectFrom;let x=s.configJson.postfix;return x===""&&(x=void 0),s.hasWhiteList===!0&&s.hasBlackList===!0&&g&&(d.selected=!0,g==="serial"&&s.configJson.whiteList&&s.configJson.whiteList.length>0&&s.configJson.whiteList.includes(x?d.serial.replace("-"+x,""):d.serial)&&(d.selected=!0),g==="serial"&&s.configJson.whiteList&&s.configJson.whiteList.length>0&&!s.configJson.whiteList.includes(x?d.serial.replace("-"+x,""):d.serial)&&(d.selected=!1),g==="serial"&&s.configJson.blackList&&s.configJson.blackList.length>0&&s.configJson.blackList.includes(x?d.serial.replace("-"+x,""):d.serial)&&(d.selected=!1),g==="name"&&s.configJson.whiteList&&s.configJson.whiteList.length>0&&s.configJson.whiteList.includes(d.name)&&(d.selected=!0),g==="name"&&s.configJson.whiteList&&s.configJson.whiteList.length>0&&!s.configJson.whiteList.includes(d.name)&&(d.selected=!1),g==="name"&&s.configJson.blackList&&s.configJson.blackList.length>0&&s.configJson.blackList.includes(d.name)&&(d.selected=!1)),d.selected},[V]);r.useEffect(()=>{const d=s=>{if(o&&console.log("HomeDevices received WebSocket Message:",s),s.method==="refresh_required"&&s.response.changed!=="matter"?(o&&console.log(`HomeDevices received refresh_required: changed=${s.response.changed} and sending /api/plugins request`),i({id:T.current,sender:"HomeDevices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})):s.method==="refresh_required"&&s.response.changed==="matter"?(o&&console.log(`HomeDevices received refresh_required: changed=${s.response.changed} and setting matter id ${s.response.matter?.id}`),P(g=>{const x=g.findIndex(de=>de.name.replaceAll(" ","")===s.response.matter?.id);if(x<0)return o&&console.debug(`HomeDevices: matter id ${s.response.matter?.id} not found`),g;const H=[...g];return H[x]={...H[x],matter:s.response.matter},o&&console.log(`HomeDevices received refresh_required: changed=${s.response.changed} and set matter id ${s.response.matter?.id}`),H})):s.method==="restart_required"?(o&&console.log("HomeDevices received restart_required"),t(!0)):s.method==="restart_not_required"?(o&&console.log("HomeDevices received restart_not_required"),t(!1)):s.method==="state_update"&&s.response.plugin&&s.response.serialNumber&&s.response.cluster.includes("BasicInformation")&&s.response.attribute==="reachable"&&(o&&console.log(`HomeDevices updating device reachability for plugin ${s.response.plugin} serial ${s.response.serialNumber} value ${s.response.value}`),N(g=>{const x=g.findIndex(H=>H.pluginName===s.response.plugin&&H.serial===s.response.serialNumber);return x<0?(o&&console.warn(`HomeDevices: device to update not found for plugin ${s.response.plugin} serial ${s.response.serialNumber}`),g):(g[x]={...g[x],reachable:s.response.value},[...g])})),s.id===T.current&&s.method==="/api/settings")o&&console.log(`HomeDevices (id: ${s.id}) received settings:`,s.response),S(s.response),t(s.response.matterbridgeInformation.restartRequired||s.response.matterbridgeInformation.fixedRestartRequired);else if(s.id===T.current&&s.method==="/api/plugins"){if(o&&console.log(`HomeDevices (id: ${s.id}) received ${s.response?.length} plugins:`,s.response),s.response){let g=!0;for(const x of s.response)x.enabled===!0&&(x.loaded!==!0||x.started!==!0||x.error===!0)&&(g=!1);if(!g)return;o&&console.log("HomeDevices reset plugins, devices and selectDevices"),j(!1),A(s.response),N([]),p([]),i({id:T.current,sender:"HomeDevices",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}}),o&&console.log("HomeDevices sent /api/devices");for(const x of s.response)x.enabled===!0&&x.loaded===!0&&x.started===!0&&x.error!==!0&&(i({id:T.current,sender:"HomeDevices",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:x.name}}),o&&console.log(`HomeDevices sent /api/select/devices for plugin: ${x.name}`))}}else if(s.id===T.current&&s.method==="/api/devices"){if(o&&console.log(`HomeDevices (id: ${s.id}) received ${s.response?.length} devices:`,s.response),s.response){for(const g of s.response)g.selected=q(g);N(s.response)}}else s.id===T.current&&s.method==="/api/select/devices"&&(o&&console.log(`HomeDevices (id: ${s.id}) received ${s.response?.length} selectDevices for plugin ${s.response&&s.response.length>0?s.response[0].pluginName:"without select devices"}:`,s.response),s.response&&s.response.length>0&&p(g=>{const x=g.filter(de=>de.pluginName!==s.response[0].pluginName),H=s.response.map(de=>({...de,selected:q(de)}));return[...x,...H]}))};return a(d,T.current),o&&console.log(`HomeDevices added WebSocket listener id ${T.current}`),()=>{f(d),o&&console.log("HomeDevices removed WebSocket listener")}},[V,a,f,i,q]),r.useEffect(()=>{if(_.length===0&&v.length===0){P([]);return}o&&console.log(`HomeDevices mixing devices (${_.length}) and selectDevices (${v.length})`);const d=[];for(const s of _)d.push(s);for(const s of v)_.find(g=>g.pluginName===s.pluginName&&g.serial.includes(s.serial))||d.push(s);d.length>0&&(P(d),o&&console.log(`HomeDevices mixed ${d.length} devices and selectDevices`))},[V,_,v,P]),r.useEffect(()=>{l&&(o&&console.log("HomeDevices sending /api/settings and /api/plugins requests"),i({id:T.current,sender:"HomeDevices",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),i({id:T.current,sender:"HomeDevices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[l,i]);const X=(d,s)=>{o&&console.log(`handleCheckboxChange: checkbox changed to ${d.target.checked} for device ${s.name} serial ${s.serial}`),_.findIndex(g=>g.pluginName===s.pluginName&&g.serial===s.serial)<0?(o&&console.warn(`handleCheckboxChange: device ${s.name} serial ${s.serial} not found in devices, trying in mixedDevices`),P(g=>{const x=g.findIndex(H=>H.pluginName===s.pluginName&&H.serial===s.serial);return x<0?(console.error(`handleCheckboxChange: device ${s.name} serial ${s.serial} not found in mixedDevices`),g):(g[x]={...g[x],selected:d.target.checked},[...g])})):N(g=>{const x=g.findIndex(H=>H.pluginName===s.pluginName&&H.serial===s.serial);return x<0?(console.error(`handleCheckboxChange: device ${s.name} serial ${s.serial} not found in devices`),g):(g[x]={...g[x],selected:d.target.checked},[...g])}),d.target.checked?i({id:T.current,sender:"HomeDevices",method:"/api/command",src:"Frontend",dst:"Matterbridge",params:{command:"selectdevice",plugin:s.pluginName,serial:s.serial,name:s.name}}):i({id:T.current,sender:"HomeDevices",method:"/api/command",src:"Frontend",dst:"Matterbridge",params:{command:"unselectdevice",plugin:s.pluginName,serial:s.serial,name:s.name}})};return o&&console.log("HomeDevices rendering..."),l?e.jsx(Se,{style:{flex:"1 1 auto"},children:e.jsx(kt,{name:"Devices",getRowKey:kn,rows:u,columns:y,footerLeft:M?"Waiting for the plugins to fully load...":`Registered devices: ${_.length.toString()}/${u.length.toString()}`,footerRight:b?"Restart required":""})}):e.jsx(We,{})}const In=r.memo(Mn);function st({children:n,style:c,name:l}){const{setCurrentPage:i}=r.useContext(De);i(l),o&&console.log(`MbfPage: current page set to ${l}`);const a={display:"flex",flexDirection:"column",width:"100%",height:"100%",margin:"0px",padding:"0px",gap:"20px"};return e.jsx("div",{style:{...a,...c},children:n})}const Dn=()=>"ontouchstart"in window||typeof window.DocumentTouch<"u"&&document instanceof window.DocumentTouch?(o&&console.log("WebSocketLogs detectTouchscreen = true"),!0):(o&&console.log("WebSocketLogs detectTouchscreen = false"),!1);function Pn(){const{messages:n,logAutoScroll:c}=r.useContext(gr),[l,i]=r.useState(!1),a=r.useRef(null),f=r.useRef(0),h=r.useRef(null),b=r.useMemo(()=>Dn(),[]),t=S=>i(!0),M=S=>i(!1);r.useEffect(()=>{if(o&&console.log(`WebSocketLogs logAutoScroll: ${c} isHovering: ${l}`),c&&!l&&!b){const S=Date.now();S-f.current>=500?(o&&console.log("WebSocketLogs auto-scroll to bottom"),f.current=S,a.current?.scrollIntoView({behavior:"smooth",block:"end"})):(o&&console.log("WebSocketLogs auto-scroll skipped to avoid flicker"),h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{a.current?.scrollIntoView({behavior:"smooth"}),f.current=Date.now()},1e3))}},[n,c,l,b]);const j=S=>{switch(S.toLowerCase()){case"debug":return"gray";case"info":return"#267fb7";case"notice":return"green";case"warn":return"#e9db18";case"error":return"red";case"fatal":return"#ff0000";case"spawn":return"#ff00d0";default:return"#5c0e91"}},w=S=>{switch(S.toLowerCase()){case"warn":return"black";default:return"white"}};return e.jsx("div",{style:{margin:"0px",padding:"0px"},children:e.jsxs("ul",{style:{margin:"0px",padding:"0px"},onMouseEnter:t,onMouseLeave:M,children:[n.map((S,V)=>e.jsxs("li",{style:{wordWrap:"break-word",maxHeight:"200px",overflow:"hidden"},children:[e.jsx("span",{style:{marginRight:"5px",padding:"1px 5px",backgroundColor:j(S.level),color:w(S.level),fontSize:"12px",borderRadius:"3px",textAlign:"center"},children:S.level}),S.time&&e.jsx("span",{style:{marginRight:"3px",color:"#505050"},children:"["+S.time+"]"}),S.name&&e.jsx("span",{style:{marginRight:"3px",color:"#09516d"},children:"["+S.name+"]"}),e.jsx("span",{style:{color:"var(--main-log-color)"},children:S.message})]},V)),e.jsx("div",{ref:a})]})})}const fr=r.memo(Pn);function Ln(){const[n,c]=r.useState(localStorage.getItem("logFilterLevel")??"info"),[l,i]=r.useState(localStorage.getItem("logFilterSearch")??"*"),[a,f]=r.useState(localStorage.getItem("logAutoScroll")!=="false"),{online:h}=r.useContext(xe);return o&&console.log("HomeLogs rendering..."),h?e.jsxs(Se,{style:{flex:"1 1 auto"},children:[e.jsxs(Ie,{children:[e.jsx(ke,{children:"Logs"}),e.jsxs(ke,{style:{fontWeight:"normal",fontSize:"12px",marginTop:"2px"},children:['Filter: logger level "',n,'" and search "',l,'" Scroll: ',a?"auto":"manual"]})]}),e.jsx(Ne,{style:{flex:"1 1 auto",overflow:"auto",margin:"0px",padding:"10px",alignItems:"start"},children:e.jsx(fr,{})})]}):e.jsx(We,{})}const $n=r.memo(Ln);function Wn(){const{online:n}=r.useContext(xe);return o&&console.log("HomeBrowserRefresh rendering..."),n?e.jsxs(Se,{children:[e.jsx(Ie,{children:e.jsx(ke,{children:"Frontend Update"})}),e.jsxs(Ne,{style:{flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between"},children:[e.jsx("h4",{style:{margin:0},children:"The frontend has been updated. You are viewing an outdated web UI. Please refresh the page now."}),e.jsx("div",{children:e.jsx(ie,{onClick:()=>window.location.reload(),endIcon:e.jsx(Qr,{}),style:{marginLeft:"10px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Refresh"})})]})]}):e.jsx(We,{})}const Nn=r.memo(Wn);function Fn({changelog:n}){const{online:c}=r.useContext(xe);return o&&console.log("HomeShowChangelog rendering..."),c?e.jsxs(Se,{children:[e.jsx(Ie,{children:e.jsx(ke,{children:"Matterbridge Update"})}),e.jsxs(Ne,{style:{flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between"},children:[e.jsx("h4",{style:{margin:0},children:"Matterbridge has been updated."}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",gap:"10px"},children:[e.jsx(ie,{onClick:()=>window.open("https://github.com/Luligu/matterbridge","_blank"),endIcon:e.jsx(dr,{style:{color:"#FFD700"}}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Star"}),e.jsx(ie,{onClick:()=>window.open("https://www.buymeacoffee.com/luligugithub","_blank"),endIcon:e.jsx(Tt,{style:{color:"#b6409c"}}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Sponsor"}),e.jsx(ie,{onClick:()=>window.open(n,"_blank"),endIcon:e.jsx(Ft,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Changelog"}),e.jsx(ie,{onClick:()=>window.location.reload(),endIcon:e.jsx(Kr,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Close"})]})]})]}):e.jsx(We,{})}const Tn=r.memo(Fn);function Rn({matterbridgeInfo:n}){const{mobile:c}=r.useContext(De);o&&console.log("MatterbridgeInfoTable:",n);const l=["matterbridgeLatestVersion","matterbridgeDevVersion","--matterFileLogger","--fileLogger","--matterLoggerLevel","--loggerLevel","--virtualMode","--bridgeMode","--restartMode","--restartRequired","fixedRestartRequired","--updateRequired","matterMdnsInterface","matterIpv4Address","matterIpv6Address","readOnly","shellyBoard","shellySysUpdate","shellyMainUpdate","matterPort","matterDiscriminator","matterPasscode"],[i,a]=r.useState(!1);return!n||i?null:(o&&console.log("MatterbridgeInfoTable rendering..."),e.jsxs(Se,{style:c?{flex:"1 1 300px"}:{flex:"0 1 auto",width:"302px",minWidth:"302px"},children:[e.jsxs(Ie,{children:[e.jsx(ke,{children:"Matterbridge Information"}),e.jsx(tt,{onClose:()=>a(!0)})]}),e.jsx(Ne,{style:c?{flex:"1 1 auto",margin:"0px",padding:"0px",gap:"0px"}:{flex:"1 1 auto",overflow:"auto",margin:"0px",padding:"0px",gap:"0px"},children:e.jsxs("table",{style:{border:"none",borderCollapse:"collapse",tableLayout:"fixed"},children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"40%"}}),e.jsx("col",{style:{width:"60%"}})]}),e.jsx("tbody",{style:{border:"none",borderCollapse:"collapse"},children:Object.entries(n).filter(([f,h])=>!l.includes(f)&&h!==null&&h!==void 0&&h!=="").map(([f,h],b)=>e.jsxs("tr",{className:b%2===0?"table-content-even":"table-content-odd",style:{border:"none",borderCollapse:"collapse"},children:[e.jsx("td",{style:{border:"none",borderCollapse:"collapse",whiteSpace:"nowrap"},children:f.replace("matterbridgeVersion","Matterbridge version").replace("matterbridgeLatestVersion","Matterbridge latest v.").replace("matterbridgeDevVersion","Matterbridge dev v.").replace("frontendVersion","Frontend version").replace("homeDirectory","Home").replace("rootDirectory","Root").replace("matterbridgeDirectory","Storage").replace("matterbridgeCertDirectory","Cert").replace("matterbridgePluginDirectory","Plugins").replace("globalModulesDirectory","Modules").replace("bridgeMode","Bridge mode").replace("virtualMode","Virtual mode").replace("loggerLevel","Logger level").replace("fileLogger","File logger").replace("loggerLevel","Logger level").replace("fileLogger","File logger").replace("matterLoggerLevel","Matter logger level").replace("matterFileLogger","Matter file logger").replace("restartRequired","Restart required").replace("updateRequired","Update required")}),e.jsx("td",{style:{border:"none",borderCollapse:"collapse",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:c?typeof h!="string"?h.toString():h:e.jsx(mr,{value:typeof h!="string"?h.toString():h,maxChars:24})})]},f))})]})})]}))}const Hn=r.memo(Rn);function On(){const[n,c]=r.useState(null),[l,i]=r.useState(null),[a,f]=r.useState([]),[h]=r.useState(localStorage.getItem("homePagePlugins")!=="false"),[b,t]=r.useState(localStorage.getItem("homePageMode")??"devices"),[M,j]=r.useState(""),[w,S]=r.useState(!1),[V,A]=r.useState(!1),[_,N]=r.useState(null),{mobile:v}=r.useContext(De),{addListener:p,removeListener:u,online:P,sendMessage:T,getUniqueId:y}=r.useContext(xe),q=r.useRef(y());return r.useEffect(()=>{const X=d=>{o&&console.log("Home received WebSocket Message:",d),d.method==="refresh_required"&&d.response.changed==="settings"&&(o&&console.log(`Home received refresh_required: changed=${d.response.changed} and sending /api/settings request`),N(null),f([]),T({id:q.current,sender:"Home",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),T({id:q.current,sender:"Home",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})),d.method==="/api/settings"&&d.id===q.current&&(o&&console.log("Home received settings:",d.response),c(d.response.systemInformation),i(d.response.matterbridgeInformation),d.response.matterbridgeInformation.matterbridgeVersion&&j(`https://github.com/Luligu/matterbridge/blob/${d.response.matterbridgeInformation.matterbridgeVersion.includes("-dev-")?"dev":"main"}/CHANGELOG.md`),localStorage.getItem("frontendVersion")===null&&d.response.matterbridgeInformation.frontendVersion?localStorage.setItem("frontendVersion",d.response.matterbridgeInformation.frontendVersion):d.response.matterbridgeInformation.frontendVersion!==localStorage.getItem("frontendVersion")&&d.response.matterbridgeInformation.frontendVersion&&(localStorage.setItem("frontendVersion",d.response.matterbridgeInformation.frontendVersion),A(!0)),localStorage.getItem("matterbridgeVersion")===null?localStorage.setItem("matterbridgeVersion",d.response.matterbridgeInformation.matterbridgeVersion):d.response.matterbridgeInformation.matterbridgeVersion!==localStorage.getItem("matterbridgeVersion")&&(localStorage.setItem("matterbridgeVersion",d.response.matterbridgeInformation.matterbridgeVersion),S(!0)),d.response.matterbridgeInformation.shellyBoard&&(localStorage.getItem("homePageMode")||(localStorage.setItem("homePageMode","devices"),t("devices")))),d.method==="/api/plugins"&&d.id===q.current&&(o&&console.log("Home received plugins:",d.response),f(d.response))};return p(X,q.current),o&&console.log(`Home added WebSocket listener id ${q.current}`),()=>{u(X),o&&console.log("Home removed WebSocket listener")}},[p,u,T]),r.useEffect(()=>{if(o&&console.log(`Home storeId effect with storeId ${_}`),l?.bridgeMode==="bridge"&&!_&&(o&&console.log("Home storeId effect set storeId to Matterbridge"),N("Matterbridge")),l?.bridgeMode==="childbridge"&&!_&&a){for(const X of a)if(X.matter?.id){o&&console.log(`Home storeId effect set storeId to ${X.matter.id}`),N(X.matter.id);break}}},[l,a,_]),r.useEffect(()=>{P&&(o&&console.log("Home online effect, sending /api/settings and /api/plugins requests"),T({id:q.current,sender:"Home",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),T({id:q.current,sender:"Home",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[P,T]),o&&console.log("Home rendering..."),!P||!n||!l?e.jsx(We,{}):e.jsxs(st,{name:"Home",style:v?{alignItems:"center",gap:"10px"}:{flexDirection:"row"},children:[(!v||!1)&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",width:"302px",minWidth:"302px",gap:"20px"},children:[e.jsx(Xt,{id:_}),e.jsx(Zt,{systemInfo:n,compact:!0})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",width:"100%",gap:v?"10px":"20px"},children:[V&&e.jsx(Nn,{}),w&&e.jsx(Tn,{changelog:M}),v&&e.jsxs("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",gap:"10px"},children:[e.jsx(Xt,{id:_}),e.jsx(Zt,{systemInfo:n,compact:!0}),e.jsx(Hn,{matterbridgeInfo:l})]}),h&&!l.readOnly&&e.jsx(hn,{}),h&&e.jsx(Sn,{storeId:_,setStoreId:N}),b==="devices"&&e.jsx(In,{storeId:_,setStoreId:N}),b==="logs"&&e.jsx($n,{})]})]})}const Vn=r.memo(On),yt=!1,tr={display:"flex",gap:"2px",justifyContent:"space-evenly",width:"100%",height:"40px"},En={margin:"0",padding:"0",fontSize:"36px",fontWeight:"medium",color:"var(--primary-color)"},An={margin:"0",padding:"0",fontSize:"20px",fontWeight:"medium",color:"var(--div-text-color)",textAlign:"center"},rr={margin:"0",padding:"0",paddingBottom:"2px",fontSize:"16px",fontWeight:"medium",color:"var(--div-text-color)",textAlign:"center"},_n={display:"flex",gap:"2px",justifyContent:"center",width:"100%",height:"18px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},qn={margin:"0",padding:"0",fontSize:"12px",fontWeight:"normal",color:"var(--div-text-color)"},Un={display:"flex",justifyContent:"center",width:"100%",height:"52px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},zn={margin:"0",padding:"0",fontSize:"14px",fontWeight:"bold",color:"var(--div-text-color)"},Bn={display:"flex",gap:"4px",justifyContent:"center",width:"100%",height:"15px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},Lt={margin:"0",padding:"0px 4px",borderRadius:"5px",textAlign:"center",fontSize:"12px",fontWeight:"normal",color:"var(--secondary-color)"},Qn=[256,257,268,269],Kn=[266,267],Gn=[259,260,261,271,272],Jn=[256,257,268,269,266,267,259,260,261,272];function J({icon:n,iconColor:c,cluster:l,value:i,unit:a,prefix:f}){return o&&console.log(`Render cluster "${l.clusterName}.${l.attributeName}" value(${typeof i}-${isNaN(i)}) "${i}" unit "${a}"`),f=f??!1,e.jsxs(te,{sx:tr,children:[n&&r.cloneElement(n,{key:`${l.clusterId}-${l.attributeId}-icon`,sx:{...En,color:c??"var(--primary-color)"}}),e.jsxs(te,{sx:{...tr,gap:"4px",alignContent:"center",alignItems:"end",justifyContent:"center"},children:[a&&f===!0&&e.jsx(le,{sx:rr,children:a},`${l.clusterId}-${l.attributeId}-unit`),e.jsx(le,{sx:An,children:i==null||typeof i=="number"&&isNaN(i)||i==="NaN"?"---":i},`${l.clusterId}-${l.attributeId}-value`),a&&f===!1&&e.jsx(le,{sx:rr,children:a},`${l.clusterId}-${l.attributeId}-unit`)]},`${l.clusterId}-${l.attributeId}-valueunitbox`)]},`${l.clusterId}-${l.attributeId}-box`)}function Zn({device:n,endpoint:c,id:l,deviceType:i,clusters:a}){const f=["Unknown","Good","Fair","Moderate","Poor","VeryPoor","Ext.Poor"];let h="";o&&console.log(`Device "${n.name}" endpoint "${c}" id "${l}" deviceType "0x${i.toString(16).padStart(4,"0")}" clusters (${a?.length})`);const b=a.find(t=>t.clusterName==="Descriptor"&&t.attributeName==="tagList")?.attributeLocalValue;if(b){let t="";b.map(M=>{M.label&&(t+=M.label+" ")}),h=t.trim()}if(i===17&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="batVoltage").map(t=>h=`${t.attributeLocalValue} mV`),Jn.includes(i)&&a.filter(t=>t.clusterName==="LevelControl"&&t.attributeName==="currentLevel").map(t=>h=`Level ${t.attributeValue}`),i===514&&a.filter(t=>t.clusterName==="WindowCovering"&&t.attributeName==="currentPositionLiftPercent100ths").map(t=>h=`Position ${t.attributeLocalValue/100}%`),i===769&&a.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="occupiedHeatingSetpoint").map(t=>h=`Heat ${t.attributeLocalValue/100}Â°C `),i===769&&a.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="occupiedCoolingSetpoint").map(t=>h=h+`Cool ${t.attributeLocalValue/100}Â°C`),i===118&&a.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="coState").map(t=>h=`${t.attributeLocalValue===0?"No CO detected":"CO alarm!"}`),i===1296&&a.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="voltage").map(t=>h=`${t.attributeLocalValue/1e3} V, `),i===1296&&a.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="activeCurrent").map(t=>h=h+`${t.attributeLocalValue/1e3} A, `),i===1296&&a.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="activePower").map(t=>h=h+`${t.attributeLocalValue/1e3} W`),i===39){const t=a.find(j=>j.clusterName==="ModeSelect"&&j.attributeName==="currentMode")?.attributeLocalValue;h=a.find(j=>j.clusterName==="ModeSelect"&&j.attributeName==="supportedModes")?.attributeLocalValue?.find(j=>j.mode===t)?.label||"Unknown"}if(i===116){const t=a.find(j=>j.clusterName==="RvcRunMode"&&j.attributeName==="currentMode")?.attributeLocalValue;h=a.find(j=>j.clusterName==="RvcRunMode"&&j.attributeName==="supportedModes")?.attributeLocalValue?.find(j=>j.mode===t)?.label||"Unknown"}return e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0px",padding:"5px",width:"150px",height:"150px",borderColor:"var(--div-bg-color)",borderRadius:"5px",justifyContent:"space-between"},children:[i===19&&a.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(J,{icon:t.attributeLocalValue===!0?e.jsx(it,{}):e.jsx(Gr,{}),iconColor:t.attributeLocalValue===!0?"green":"red",cluster:t,value:t.attributeLocalValue===!0?"Online":"Offline"})),i===17&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="batPercentRemaining").map(t=>e.jsx(J,{icon:e.jsx(Ct,{}),cluster:t,value:t.attributeLocalValue/2,unit:"%"})),i===17&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="wiredCurrentType").map(t=>e.jsx(J,{icon:e.jsx(lr,{}),cluster:t,value:t.attributeLocalValue===0?"AC":"DC"})),i===1293&&a.filter(t=>t.clusterName==="DeviceEnergyManagement"&&t.attributeName==="esaState").map(t=>e.jsx(J,{icon:e.jsx(ne,{path:Wo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Offline":"Online"})),Qn.includes(i)&&a.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(J,{icon:e.jsx(Jr,{}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),Kn.includes(i)&&a.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(J,{icon:e.jsx(ne,{path:No,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),Gn.includes(i)&&a.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(J,{icon:e.jsx(ne,{path:Fo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),i===115&&a.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(J,{icon:e.jsx(ne,{path:To,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),i===124&&a.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(J,{icon:e.jsx(ne,{path:Ro,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),i===117&&a.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(J,{icon:e.jsx(ne,{path:Ho,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),i===123&&a.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(J,{icon:e.jsx(Ut,{}),cluster:t,value:"Oven"})),i===112&&a.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(J,{icon:e.jsx(Zr,{}),cluster:t,value:"Fridge"})),i===113&&a.filter(t=>t.clusterName==="TemperatureControl"&&t.attributeName==="selectedTemperatureLevel").map(t=>e.jsx(J,{icon:e.jsx(ne,{path:Oo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),i===121&&a.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(J,{icon:e.jsx(Ut,{}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),i===122&&a.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="fanMode").map(t=>e.jsx(J,{icon:e.jsx(ne,{path:Vo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),i===120&&a.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(J,{icon:e.jsx(ne,{path:Gt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Cooktop"})),i===119&&a.filter(t=>t.clusterName==="TemperatureControl"&&t.attributeName==="selectedTemperatureLevel").map(t=>e.jsx(J,{icon:e.jsx(ne,{path:Gt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),i===514&&a.filter(t=>t.clusterName==="WindowCovering"&&t.attributeName==="currentPositionLiftPercent100ths").map(t=>e.jsx(J,{icon:e.jsx(Yr,{}),cluster:t,value:t.attributeLocalValue/100,unit:"%"})),i===769&&a.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="localTemperature").map(t=>e.jsx(J,{icon:e.jsx(ne,{path:Eo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:(t.attributeLocalValue??0)/100,unit:"Â°C"})),i===10&&a.filter(t=>t.clusterName==="DoorLock"&&t.attributeName==="lockState").map(t=>e.jsx(J,{icon:t.attributeValue==="1"?e.jsx(Xr,{}):e.jsx(eo,{}),cluster:t,value:t.attributeValue==="1"?"Locked":"Unlocked"})),i===43&&a.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="percentCurrent").map(t=>e.jsx(J,{icon:e.jsx(to,{}),cluster:t,value:t.attributeValue,unit:"%"})),i===15&&a.filter(t=>t.clusterName==="Switch"&&t.attributeName==="currentPosition").map(t=>e.jsx(J,{icon:e.jsx(ne,{path:Ao,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeValue,unit:"pos",prefix:!0})),i===39&&a.filter(t=>t.clusterName==="ModeSelect"&&t.attributeName==="currentMode").map(t=>e.jsx(J,{icon:e.jsx(ro,{}),cluster:t,value:t.attributeValue,unit:"Mode",prefix:!0})),i===771&&a.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(J,{icon:e.jsx(oo,{}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),i===45&&a.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="percentCurrent").map(t=>e.jsx(J,{icon:e.jsx(zt,{}),cluster:t,value:t.attributeValue,unit:"%"})),i===114&&a.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="localTemperature").map(t=>e.jsx(J,{icon:e.jsx(zt,{}),cluster:t,value:(t.attributeLocalValue??0)/100,unit:"Â°C"})),i===67&&a.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(J,{icon:e.jsx(no,{}),cluster:t,value:t.attributeLocalValue===!0?"Leak":"No leak"})),i===65&&a.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(J,{icon:e.jsx(io,{}),cluster:t,value:t.attributeLocalValue===!0?"Freeze":"No freeze"})),i===68&&a.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(J,{icon:e.jsx(so,{}),cluster:t,value:t.attributeLocalValue===!0?"Rain":"No rain"})),i===116&&a.filter(t=>t.clusterName==="RvcRunMode"&&t.attributeName==="currentMode").map(t=>e.jsx(J,{icon:e.jsx(ne,{path:_o,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeValue,unit:"Run mode",prefix:!0})),i===1292&&a.filter(t=>t.clusterName==="EnergyEvse"&&t.attributeName==="state").map(t=>e.jsx(J,{icon:e.jsx(ne,{path:qo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Free":"In use"})),i===1295&&a.filter(t=>t.clusterName==="WaterHeaterManagement"&&t.attributeName==="tankPercentage").map(t=>e.jsx(J,{icon:e.jsx(ne,{path:Uo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Tank "+(t.attributeLocalValue??0)+"%"})),i===777&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="featureMap").map(t=>e.jsx(J,{icon:e.jsx(ne,{path:zo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"HeatPump"})),i===23&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="featureMap").map(t=>e.jsx(J,{icon:e.jsx(ne,{path:Bo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Solar"})),i===24&&a.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="featureMap").map(t=>e.jsx(J,{icon:e.jsx(ne,{path:Qo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Inverter"})),i===118&&a.find(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="featureMap"&&t.attributeLocalValue.smokeAlarm===!0)&&a.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="smokeState").map(t=>e.jsx(J,{icon:e.jsx(ne,{path:Jt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"No smoke":"Smoke!"})),i===118&&a.find(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="featureMap"&&t.attributeLocalValue.smokeAlarm===!1)&&a.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="coState").map(t=>e.jsx(J,{icon:e.jsx(ne,{path:Jt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"No Co":"Co!"})),i===66&&a.filter(t=>t.clusterName==="ValveConfigurationAndControl"&&t.attributeName==="currentState").map(t=>e.jsx(J,{icon:e.jsx(ao,{}),cluster:t,value:t.attributeLocalValue===0?"Closed":"Opened"})),i===44&&a.filter(t=>t.clusterName==="AirQuality"&&t.attributeName==="airQuality").map(t=>e.jsx(J,{icon:e.jsx(ne,{path:Ko,size:"40px",color:"var(--primary-color)"}),cluster:t,value:f[t.attributeLocalValue??0]})),i===770&&a.filter(t=>t.clusterName==="TemperatureMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(J,{icon:e.jsx(lo,{}),cluster:t,value:t.attributeLocalValue/100,unit:"Â°C"})),i===775&&a.filter(t=>t.clusterName==="RelativeHumidityMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(J,{icon:e.jsx(ne,{path:Go,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue/100,unit:"%"})),i===774&&a.filter(t=>t.clusterName==="FlowMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(J,{icon:e.jsx(co,{}),cluster:t,value:t.attributeLocalValue,unit:"l/h"})),i===773&&a.filter(t=>t.clusterName==="PressureMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(J,{icon:e.jsx(po,{}),cluster:t,value:t.attributeLocalValue,unit:"hPa"})),i===21&&a.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(J,{icon:t.attributeValue==="true"?e.jsx(uo,{}):e.jsx(go,{}),cluster:t,value:t.attributeValue==="true"?"Closed":"Opened"})),i===263&&a.filter(t=>t.clusterName==="OccupancySensing"&&t.attributeName==="occupancy").map(t=>e.jsx(J,{icon:t.attributeValue==="{ occupied: true }"?e.jsx(mo,{}):e.jsx(ho,{}),cluster:t,value:t.attributeValue==="{ occupied: true }"?"Occupied":"Unocc."})),i===262&&a.filter(t=>t.clusterName==="IlluminanceMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(J,{icon:e.jsx(fo,{}),cluster:t,value:Math.round(Math.pow(10,t.attributeLocalValue/1e4)),unit:"lx"})),i===1296&&a.filter(t=>t.clusterName==="ElectricalEnergyMeasurement"&&t.attributeName==="cumulativeEnergyImported").map(t=>e.jsx(J,{icon:e.jsx(xo,{}),cluster:t,value:Math.round(t.attributeLocalValue?.energy/1e6),unit:"kwh"})),e.jsx(te,{sx:_n,children:e.jsx(le,{sx:qn,children:h})}),e.jsx(te,{sx:Un,children:e.jsx(le,{sx:zn,children:n.name})}),e.jsxs(te,{sx:Bn,children:[o&&e.jsx(le,{sx:Lt,children:c}),e.jsx(le,{sx:Lt,children:l}),o&&e.jsxs(le,{sx:Lt,children:["0x",i.toString(16).padStart(4,"0")]})]})]})}function Yn({filter:n}){const{online:c,sendMessage:l,addListener:i,removeListener:a,getUniqueId:f}=r.useContext(xe),[h,b]=r.useState([]),[t,M]=r.useState({}),[j,w]=r.useState({}),[S,V]=r.useState({}),A=r.useRef(f()),_=r.useCallback(p=>{(o||yt)&&console.log(`DevicesIcons received state_update "${p.response.cluster}.${p.response.attribute}" for "${p.response.id}:${p.response.number}": "${p.response.value}"`,p.response);const u=h.find(T=>T.pluginName===p.response.plugin&&T.serial===p.response.serialNumber);if(!u){(o||yt)&&console.warn(`DevicesIcons updater device of plugin "${p.response.plugin}" serial "${p.response.serialNumber}" number "${p.response.number}" id "${p.response.id}" not found in devices(${h.length})`);return}const P=S[u.serial]?.find(T=>T.endpoint===p.response.number.toString()&&T.clusterName===p.response.cluster&&T.attributeName===p.response.attribute);if(!P){(o||yt)&&console.warn(`DevicesIcons updater device "${u.name}" serial "${u.serial}" cluster "${p.response.cluster}" attribute "${p.response.attribute}" not found in clusters(${S[u.serial]?.length})`);return}P.attributeValue=String(p.response.value),P.attributeLocalValue=p.response.value,V({...S}),(o||yt)&&console.log(`DevicesIcons updated "${P.clusterName}.${P.attributeName}" for device "${u.name}" serial "${u.serial}" to "${P.attributeValue}"`)},[S,h]),N=r.useCallback(p=>{if(o&&console.log(`DevicesIcons received for device "${p.response.deviceName}" serial "${p.response.serialNumber}" deviceTypes (${p.response.deviceTypes.length}) "${p.response.deviceTypes.join(",")}" clusters (${p.response.clusters.length}):`,p.response),p.response.clusters.length===0)return;const u=p.response.serialNumber;t[u]=[],j[u]=p.response.deviceTypes,S[u]=[];for(const P of p.response.clusters)t[u].find(T=>T.endpoint===P.endpoint)||t[u].push({endpoint:P.endpoint,id:P.id,deviceTypes:P.deviceTypes}),!["FixedLabel","Identify","Groups","PowerTopology"].includes(P.clusterName)&&S[u].push(P);M({...t}),w({...j}),V({...S}),o&&console.log(`DevicesIcons endpoints for "${u}":`,t[u]),o&&console.log(`DevicesIcons deviceTypes for "${u}":`,j[u]),o&&console.log(`DevicesIcons clusters for "${u}":`,S[u])},[S,j,t]);r.useEffect(()=>{const p=u=>{if(o&&console.log("DevicesIcons received WebSocket Message:",u),u.method==="refresh_required")o&&console.log(`DevicesIcons received refresh_required: changed=${u.response.changed} and sending api requests`),l({id:A.current,sender:"DevicesIcons",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}});else if(u.method==="state_update"&&u.response)_(u);else if(u.method==="/api/devices"&&u.response){o&&console.log(`DevicesIcons received ${u.response.length} devices:`,u.response),b(u.response),M({}),w({}),V({});for(const P of u.response)o&&console.log("DevicesIcons sending /api/clusters"),l({id:A.current,sender:"DevicesIcons",method:"/api/clusters",src:"Frontend",dst:"Matterbridge",params:{plugin:P.pluginName,endpoint:P.endpoint||0}})}else u.method==="/api/clusters"&&u.response&&N(u)};return i(p,A.current),o&&console.log("DevicesIcons WebSocket effect mounted"),()=>{a(p),o&&console.log("DevicesIcons WebSocket effect unmounted")}},[h]),r.useEffect(()=>(o&&console.log("DevicesIcons useEffect online mounting"),c&&(o&&console.log("DevicesIcons useEffect online sending api requests"),l({id:A.current,sender:"DevicesIcons",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}})),o&&console.log("DevicesIcons useEffect online mounted"),()=>{o&&console.log("DevicesIcons useEffect online unmounted")}),[c,l]);const v=r.memo(Zn);return o&&console.log("DevicesIcons rendering..."),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",paddingBottom:"5px",gap:"20px",width:"100%",overflow:"auto"},children:h.filter(p=>p.name.toLowerCase().includes(n)||p.serial.toLowerCase().includes(n)).map(p=>t[p.serial]&&t[p.serial].map(u=>u.deviceTypes.map(P=>e.jsx(v,{device:p,endpoint:u.endpoint,id:u.id,deviceType:P,clusters:S[p.serial].filter(T=>T.endpoint===u.endpoint)},`${p.pluginName}-${p.uniqueId}-${u.endpoint}-${u.id}-${P.toString()}`))))})}const Xn=r.memo(Yn),ei=[{label:"Plugin name",id:"pluginName",required:!0},{label:"Device type",id:"type"},{label:"Endpoint",id:"endpoint",align:"right"},{label:"Name",id:"name",required:!0},{label:"Serial number",id:"serial"},{label:"Unique ID",id:"uniqueId"},{label:"Url",id:"configUrl"},{label:"Config",id:"configButton",noSort:!0,render:(n,c,l,i)=>l.configUrl?e.jsx(Q,{onClick:()=>window.open(l.configUrl,"_blank"),"aria-label":"Open Config",sx:{margin:0,padding:0},children:e.jsx(cr,{fontSize:"small"})}):null},{label:"Cluster",id:"cluster"}],ti=[{label:"Endpoint",id:"endpoint",required:!0},{label:"Id",id:"id"},{label:"Device Types",id:"deviceTypes",render:(n,c,l,i)=>Array.isArray(n)?e.jsx(e.Fragment,{children:n.map(a=>`0x${a.toString(16).padStart(4,"0")}`).join(", ")}):e.jsx(e.Fragment,{children:n})},{label:"Cluster Name",id:"clusterName",required:!0},{label:"Cluster ID",id:"clusterId"},{label:"Attribute Name",id:"attributeName",required:!0},{label:"Attribute ID",id:"attributeId"},{label:"Attribute Value",id:"attributeValue",required:!0,render:(n,c,l,i)=>e.jsx(O,{title:String(n),componentsProps:{tooltip:{sx:{fontSize:"14px",fontWeight:"normal",color:"#ffffff",backgroundColor:"var(--primary-color)"}}},children:e.jsx("div",{style:{maxWidth:"500px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:String(n)})})}],ri=n=>`${n.pluginName}::${n.uniqueId}`,oi=n=>`${n.endpoint}::${n.clusterName}::${n.attributeName}`;function ni({filter:n}){const{online:c,sendMessage:l,addListener:i,removeListener:a,getUniqueId:f}=r.useContext(xe),[h,b]=r.useState([]),[t,M]=r.useState(h),[j,w]=r.useState([]),[S,V]=r.useState(0),[A,_]=r.useState(null),[N,v]=r.useState(null),[p,u]=r.useState(null),[P,T]=r.useState(null),y=r.useRef(f()),q=r.useRef(t),X=r.useCallback(s=>{o&&console.log(`DevicesTable received state_update "${s.response.cluster}.${s.response.attribute}" for "${s.response.id}:${s.response.number}": "${s.response.value}"`,s.response);const g=q.current.find(x=>x.pluginName===s.response.plugin&&x.uniqueId===s.response.uniqueId);if(!g){o&&console.warn(`DevicesTable updater device of plugin "${s.response.plugin}" serial "${s.response.serialNumber}" not found in filteredDevicesRef.current`);return}if(A&&N&&g.pluginName===A&&g.uniqueId===P&&s.response.number.toString()===N){const x=j.find(H=>H.endpoint===s.response.number.toString()&&H.clusterName===s.response.cluster&&H.attributeName===s.response.attribute);if(!x){o&&console.warn(`DevicesTable updater cluster ${s.response.cluster}.${s.response.attribute} for device "${g.name}" serial "${g.serial}" not found in clusters`);return}x.attributeValue=typeof s.response.value=="object"?JSON.stringify(s.response.value,void 0,1).replaceAll('"',""):String(s.response.value),x.attributeLocalValue=s.response.value,w([...j]),o&&console.log(`DevicesTable updated attribute ${x.clusterName}.${x.attributeName} for device "${g.name}" serial "${g.serial}" to "${x.attributeValue}"`)}},[j,N,A,P]);r.useEffect(()=>{const s=g=>{if(o&&console.log("DevicesTable received WebSocket Message:",g),g.method==="refresh_required"&&g.response.changed==="devices")o&&console.log(`DevicesTable received refresh_required: changed=${g.response.changed} and sending /api/devices request`),l({id:y.current,sender:"DevicesTable",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}});else if(g.method==="state_update"&&g.response)X(g);else if(g.method==="/api/devices")o&&console.log(`DevicesTable received ${g.response.length} devices:`,g.response),b(g.response);else if(g.method==="/api/clusters"){o&&console.log(`DevicesTable received ${g.response.clusters.length} clusters for plugin ${g.response.plugin}:`,g.response),w(g.response.clusters);const x={};for(const H of g.response.clusters)o&&console.log("Cluster:",H.endpoint),x[H.endpoint]?x[H.endpoint]++:x[H.endpoint]=1;V(Object.keys(x).length)}};return i(s,y.current),o&&console.log("DevicesTable added WebSocket listener"),()=>{a(s),o&&console.log("DevicesTable removed WebSocket listener")}},[l,i,a,X]),r.useEffect(()=>{c&&(o&&console.log("DevicesTable sending api requests with id ",y.current),l({id:y.current,sender:"DevicesTable",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),l({id:y.current,sender:"DevicesTable",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),l({id:y.current,sender:"DevicesTable",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}}))},[c,l]),r.useEffect(()=>{A&&N&&(o&&console.log("DevicesTable sending /api/clusters"),l({id:y.current,sender:"DevicesTable",method:"/api/clusters",src:"Frontend",dst:"Matterbridge",params:{plugin:A,endpoint:Number(N)}}))},[A,N,l]),r.useEffect(()=>{if(n===""){M(h),q.current=h;return}const s=h.filter(g=>g.name.toLowerCase().includes(n)||g.serial.toLowerCase().includes(n));M(s),q.current=s},[h,n]);const d=s=>{if(s.uniqueId===P){T(null),_(null),v(null),u(null);return}T(s.uniqueId),_(s.pluginName),v(s.endpoint?s.endpoint.toString():null),u(s.name)};return o&&console.log("DevicesTable rendering..."),c?e.jsxs("div",{style:{display:"flex",flexDirection:"column",margin:"0px",padding:"0px",gap:"20px",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowDiv",style:{margin:"0px",padding:"0px",gap:"0px",width:"100%",maxHeight:`${A&&N?"30%":"100%"}`,flex:"1 1 auto",overflow:"hidden"},children:e.jsx(kt,{name:"Registered devices",getRowKey:ri,onRowClick:d,rows:t,columns:ei,footerLeft:`Total devices: ${t.length.toString()}`})}),A&&N&&e.jsx("div",{className:"MbfWindowDiv",style:{margin:"0px",padding:"0px",gap:"0px",width:"100%",height:"70%",maxHeight:"70%",flex:"1 1 auto",overflow:"hidden"},children:e.jsx(kt,{name:"Clusters",title:p||"",getRowKey:oi,rows:j,columns:ti,footerLeft:`Total child endpoints: ${S-1}`})})]}):e.jsx(We,{})}const ii=r.memo(ni);function si(){const{online:n}=r.useContext(xe),[c,l]=r.useState(""),[i,a]=r.useState("icon");r.useEffect(()=>{const b=localStorage.getItem("devicesFilter");b&&l(b)},[]),r.useEffect(()=>{const b=localStorage.getItem("devicesViewMode");b&&a(b)},[]);const f=b=>{l(b.target.value.toLowerCase()),localStorage.setItem("devicesFilter",b.target.value.toLowerCase())},h=b=>{a(b),localStorage.setItem("devicesViewMode",b)};return o&&console.log("Devices rendering..."),n?e.jsxs(st,{name:"Devices",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between",padding:0,margin:0,gap:"20px",width:"100%"},children:[e.jsxs(te,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx(le,{sx:{fontSize:"16px",fontWeight:"normal",color:"var(--div-text-color)",marginLeft:"5px",whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(me,{variant:"outlined",value:c,onChange:f,placeholder:"Enter the device name or serial",sx:{width:"260px"},InputProps:{style:{backgroundColor:"var(--main-bg-color)"}}})]}),e.jsxs(te,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx(le,{sx:{fontSize:"16px",fontWeight:"normal",color:"var(--div-text-color)",marginLeft:"5px",whiteSpace:"nowrap"},children:"View mode:"}),e.jsx(Q,{onClick:()=>h("table"),"aria-label":"Table View",disabled:i==="table",children:e.jsx(O,{title:"Table View",children:e.jsx(bo,{style:{color:i==="table"?"var(--main-icon-color)":"var(--primary-color)"}})})}),e.jsx(Q,{onClick:()=>h("icon"),"aria-label":"Icon View",disabled:i==="icon",children:e.jsx(O,{title:"Icon View (beta)",children:e.jsx(vo,{style:{color:i==="icon"?"var(--main-icon-color)":"var(--primary-color)"}})})})]})]}),i==="table"&&e.jsx(ii,{filter:c}),i==="icon"&&e.jsx(Xn,{filter:c})]}):e.jsx(We,{})}const ai=r.memo(si);function li(){const[n,c]=r.useState(localStorage.getItem("logFilterLevel")??"info"),[l,i]=r.useState(localStorage.getItem("logFilterSearch")??"*"),[a,f]=r.useState(localStorage.getItem("logAutoScroll")!=="false"),{setMessages:h,setLogFilterLevel:b,setLogFilterSearch:t,online:M,setLogAutoScroll:j,filterLogMessages:w}=r.useContext(xe),S=N=>{c(N.target.value),b(N.target.value),w(N.target.value,l),localStorage.setItem("logFilterLevel",N.target.value),o&&console.log("handleChangeLevel called with value:",N.target.value)},V=N=>{i(N.target.value),t(N.target.value),w(n,N.target.value),localStorage.setItem("logFilterSearch",N.target.value),o&&console.log("handleChangeSearch called with value:",N.target.value)},A=N=>{f(N.target.checked),j(N.target.checked),w(n,l),localStorage.setItem("logAutoScroll",N.target.checked?"true":"false"),o&&console.log("handleAutoScrollChange called with value:",N.target.checked)},_=()=>{o&&console.log("handleClearLogsClick called"),h([])};return o&&console.log("Logs rendering..."),M?e.jsxs(st,{name:"Logs",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between",alignItems:"center",margin:"0px",padding:"0px",gap:"10px"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"center",gap:"10px"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx(Bt,{id:"select-level",style:{color:"var(--div-text-color)"},children:"Filter log by level:"}),e.jsxs(Xe,{style:{height:"30px",backgroundColor:"var(--main-bg-color)"},labelId:"select-level",id:"debug-level",value:n,onChange:S,children:[e.jsx(D,{value:"debug",children:"Debug"}),e.jsx(D,{value:"info",children:"Info"}),e.jsx(D,{value:"notice",children:"Notice"}),e.jsx(D,{value:"warn",children:"Warn"}),e.jsx(D,{value:"error",children:"Error"}),e.jsx(D,{value:"fatal",children:"Fatal"})]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"5px"},children:[e.jsx(Bt,{id:"search",style:{color:"var(--div-text-color)"},children:"Filter log by text:"}),e.jsx(me,{style:{width:"210px"},size:"small",id:"logsearch",variant:"outlined",value:l,onChange:V,slotProps:{input:{style:{height:"30px",padding:"0 0px",backgroundColor:"var(--main-bg-color)"}}}})]}),e.jsx(Ue,{control:e.jsx(Ee,{checked:a,onChange:A}),label:"Auto scroll",style:{color:"var(--div-text-color)"}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:e.jsx(O,{title:"Clear the logs",children:e.jsx(ie,{onClick:_,endIcon:e.jsx(Nt,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Clear"})})})]}),e.jsx("div",{style:{flex:"1",overflow:"auto",margin:"0px",padding:"0px"},children:e.jsx(fr,{})})]}):e.jsx(We,{})}const ci=r.memo(li),di=({open:n,ip:c,onClose:l,onSave:i})=>{const a=c?c.split(".").slice(0,3).join(".")+".1":"",[f,h]=r.useState("dhcp"),[b,t]=r.useState({ip:c??"",subnet:"255.255.255.0",gateway:a,dns:a}),M=S=>V=>{t({...b,[S]:V.target.value})},j=()=>{l()},w=()=>{i({type:f,...b}),l()};return e.jsxs(Te,{open:n,onClose:(S,V)=>{V==="backdropClick"||V==="escapeKeyDown"||l()},maxWidth:"sm",style:{maxWidth:"550px",margin:"auto"},children:[e.jsx(Re,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:"Network Configuration"})]})}),e.jsxs(He,{dividers:!0,children:[e.jsxs(pr,{component:"fieldset",fullWidth:!0,children:[e.jsx(Ce,{component:"legend",children:"Select IP Configuration"}),e.jsxs(ur,{row:!0,value:f,onChange:S=>h(S.target.value),children:[e.jsx(Ue,{value:"dhcp",control:e.jsx(St,{}),label:"DHCP"}),e.jsx(Ue,{value:"static",control:e.jsx(St,{}),label:"Static"})]})]}),f==="static"&&e.jsxs(Ae,{container:!0,spacing:2,sx:{mt:2},children:[e.jsx(Ae,{size:6,children:e.jsx(me,{label:"IP Address",fullWidth:!0,value:b.ip,onChange:M("ip")})}),e.jsx(Ae,{size:6,children:e.jsx(me,{label:"Subnet Mask",fullWidth:!0,value:b.subnet,onChange:M("subnet")})}),e.jsx(Ae,{size:6,children:e.jsx(me,{label:"Gateway",fullWidth:!0,value:b.gateway,onChange:M("gateway")})}),e.jsx(Ae,{size:6,children:e.jsx(me,{label:"DNS Server",fullWidth:!0,value:b.dns,onChange:M("dns")})})]})]}),e.jsxs(_e,{children:[e.jsx(ie,{onClick:j,children:"Cancel"}),e.jsx(ie,{variant:"contained",onClick:w,children:"Save"})]})]})},pi=({open:n,onClose:c,onSave:l})=>{const[i,a]=r.useState(""),[f,h]=r.useState(""),b=V=>{a(V.target.value)},t=V=>{h(V.target.value)},M=i.length>0&&i===f,j=()=>{c()},w=()=>{M&&(l(i),c())},S=()=>{l(""),c()};return e.jsxs(Te,{open:n,onClose:(V,A)=>{A==="backdropClick"||A==="escapeKeyDown"||c()},maxWidth:"sm",style:{maxWidth:"500px",margin:"auto"},disableEscapeKeyDown:!0,children:[e.jsx(Re,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:"Change Password"})]})}),e.jsx(He,{dividers:!0,children:e.jsx(pr,{component:"fieldset",fullWidth:!0,sx:{margin:0,padding:0,gap:"20px"},children:e.jsxs(Ae,{container:!0,spacing:2,sx:{mt:2},children:[e.jsx(Ae,{size:12,children:e.jsx(me,{type:"password",autoComplete:"new-password",label:"New Password",size:"small",variant:"outlined",fullWidth:!0,value:i,onChange:b})}),e.jsx(Ae,{size:12,children:e.jsx(me,{type:"password",autoComplete:"new-password",label:"Confirm Password",size:"small",variant:"outlined",fullWidth:!0,value:f,onChange:t,error:f!==""&&i!==f,helperText:f!==""&&i!==f?"Passwords do not match":""})})]})})}),e.jsxs(_e,{children:[e.jsx(ie,{onClick:j,children:"Cancel"}),e.jsx(ie,{variant:"contained",onClick:w,disabled:!M,children:"Change"}),e.jsx(ie,{variant:"contained",onClick:S,children:"Reset"})]})]})};function Ze(n=1e3){let c=null;const l=(i=>{c!==null&&window.clearTimeout(c),c=window.setTimeout(()=>{i(),c=null},n)});return l.cancel=()=>{c!==null&&(window.clearTimeout(c),c=null)},l}const Mt=330;function ui(){const{online:n,addListener:c,removeListener:l,sendMessage:i,getUniqueId:a}=r.useContext(xe),[f,h]=r.useState(null),[b,t]=r.useState(null),M=r.useRef(a());return r.useEffect(()=>{const j=w=>{o&&console.log("Settings received WebSocket Message:",w),w.method==="refresh_required"&&w.response.changed==="settings"?(o&&console.log(`Settings received refresh_required: changed=${w.response.changed} and sending /api/settings request`),i({id:M.current,sender:"Settings",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})):w.method==="/api/settings"&&(o&&console.log("Settings received /api/settings:",w.response),h(w.response.matterbridgeInformation),t(w.response.systemInformation))};return c(j,M.current),o&&console.log("Settings added WebSocket listener"),()=>{l(j),o&&console.log("Settings removed WebSocket listener")}},[c,l,i]),r.useEffect(()=>{n&&(o&&console.log("Settings received online"),i({id:M.current,sender:"Settings",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}))},[n,i]),o&&console.log("Settings rendering..."),!n||!f||!b?e.jsx(We,{}):e.jsx(st,{name:"Settings",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",width:"100%",gap:"20px"},children:[e.jsx(gi,{matterbridgeInfo:f,systemInfo:b}),e.jsx(mi,{matterbridgeInfo:f}),e.jsx(hi,{matterbridgeInfo:f}),e.jsx(fi,{systemInfo:b})]})})}function gi({matterbridgeInfo:n,systemInfo:c}){const{sendMessage:l,getUniqueId:i}=r.useContext(xe),[a,f]=r.useState("bridge"),[h,b]=r.useState("Info"),[t,M]=r.useState(!1),[j,w]=r.useState("dark"),[S,V]=r.useState(localStorage.getItem("homePagePlugins")!=="false"),[A,_]=r.useState(localStorage.getItem("homePageMode")??"devices"),[N,v]=r.useState(localStorage.getItem("virtualMode")??"outlet"),p=r.useRef(i()),[u,P]=r.useState(!1),T=()=>P(!1),y=R=>{o&&console.log("handleSaveNetConfig called with config:",R),l({id:p.current,sender:"Settings",method:"/api/shellynetconfig",src:"Frontend",dst:"Matterbridge",params:R})},[q,X]=r.useState(!1),d=()=>X(!1),s=R=>{o&&console.log("handleSaveChangePassword called with password:",R),l({id:p.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setpassword",value:R}}),Mi(R)};r.useEffect(()=>{n&&(f(n.bridgeMode==="bridge"?"bridge":"childbridge"),b(n.loggerLevel.charAt(0).toUpperCase()+n.loggerLevel.slice(1)),M(n.fileLogger),v(n.virtualMode))},[n]),r.useEffect(()=>{const R=localStorage.getItem("frontendTheme");R&&w(R)},[]);const g=R=>{o&&console.log("handleChangeBridgeMode called with value:",R.target.value),f(R.target.value),l({id:p.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setbridgemode",value:R.target.value}})},x=R=>{o&&console.log("handleChangeMbLoggerLevel called with value:",R.target.value),b(R.target.value),l({id:p.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmbloglevel",value:R.target.value}})},H=R=>{o&&console.log("handleLogOnFileMbChange called with value:",R.target.checked),M(R.target.checked),l({id:p.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmblogfile",value:R.target.checked}})},de=R=>{const z=R.target.value;o&&console.log("handleChangeTheme called with value:",z),w(z),localStorage.setItem("frontendTheme",z),document.body.setAttribute("frontend-theme",z)},ve=R=>{const z=R.target.checked;o&&console.log("handleChangeHomePagePlugins called with value:",z),V(z),localStorage.setItem("homePagePlugins",z?"true":"false")},se=R=>{const z=R.target.value;o&&console.log("handleChangeHomePageMode called with value:",z),_(z),localStorage.setItem("homePageMode",z)},ye=R=>{const z=R.target.value;o&&console.log("handleChangeVirtualMode called with value:",z),v(z),localStorage.setItem("virtualMode",z),l({id:p.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setvirtualmode",value:z}})};return!n||!c?null:e.jsxs(Se,{style:{flex:`1 1 ${Mt}px`},children:[e.jsx(Ie,{children:e.jsx(ke,{children:"Matterbridge settings"})}),e.jsx(di,{open:u,ip:c.ipv4Address,onClose:T,onSave:y}),e.jsx(pi,{open:q,onClose:d,onSave:s}),e.jsxs(Ne,{style:{flexDirection:"column",padding:"10px",gap:"0px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px"},id:"matterbridgeInfo-mode",children:"Mode:"}),e.jsxs(ur,{row:!0,name:"mode-buttons-group",value:a,onChange:g,children:[e.jsx(Ue,{value:"bridge",control:e.jsx(St,{}),label:"Bridge",disabled:n.readOnly===!0}),e.jsx(Ue,{value:"childbridge",control:e.jsx(St,{}),label:"Childbridge",disabled:n.readOnly===!0})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px"},id:"mblogger-level-label",children:"Logger level:"}),e.jsxs(Xe,{style:{height:"30px"},labelId:"mblogger-level-label",id:"mblogger-level",value:h,onChange:x,children:[e.jsx(D,{value:"Debug",children:"Debug"}),e.jsx(D,{value:"Info",children:"Info"}),e.jsx(D,{value:"Notice",children:"Notice"}),e.jsx(D,{value:"Warn",children:"Warn"}),e.jsx(D,{value:"Error",children:"Error"}),e.jsx(D,{value:"Fatal",children:"Fatal"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px"},id:"mblogger-file-label",children:"Log on file:"}),e.jsx(Ee,{checked:t,onChange:H,id:"mblogger-file",name:"logOnFileMb"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px"},id:"frontend-theme-label",children:"Frontend theme:"}),e.jsxs(Xe,{style:{height:"30px"},labelId:"frontend-theme-label",id:"frontend-theme",value:j,onChange:de,children:[e.jsx(D,{value:"classic",children:"Classic"}),e.jsx(D,{value:"light",children:"Light"}),e.jsx(D,{value:"dark",children:"Dark"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px"},id:"frontend-home-plugin-label",children:"Home page plugins:"}),e.jsx(Ee,{checked:S,onChange:ve,name:"showPlugins"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px"},id:"frontend-home-label",children:"Home page bottom panel:"}),e.jsxs(Xe,{style:{height:"30px"},labelId:"frontend-home-label",id:"frontend-home",value:A,onChange:se,children:[e.jsx(D,{value:"logs",children:"Logs"}),e.jsx(D,{value:"devices",children:"Devices"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"10px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px"},id:"frontend-virtual-label",children:"Virtual devices:"}),e.jsxs(Xe,{style:{height:"30px"},labelId:"frontend-virtual-label",id:"frontend-virtual",value:N,onChange:ye,children:[e.jsx(D,{value:"disabled",children:"Disabled"}),e.jsx(D,{value:"outlet",children:"Outlet"}),e.jsx(D,{value:"light",children:"Light"}),e.jsx(D,{value:"switch",children:"Switch"}),e.jsx(D,{value:"mounted_switch",children:"Mounted Switch"})]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"20px"},children:e.jsx(ie,{variant:"contained",color:"primary",onClick:()=>X(!0),children:"Change password"})}),n.shellyBoard&&e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"20px"},children:e.jsx(ie,{variant:"contained",color:"primary",onClick:()=>P(!0),children:"Configure IP"})})]})]})}function mi({matterbridgeInfo:n}){const{sendMessage:c,getUniqueId:l}=r.useContext(xe),[i,a]=r.useState("Info"),[f,h]=r.useState(!1),[b,t]=r.useState(""),[M,j]=r.useState(""),[w,S]=r.useState(""),[V,A]=r.useState(""),[_,N]=r.useState(""),[v,p]=r.useState(""),u=r.useRef(l()),P=r.useMemo(()=>Ze(1e3),[]),T=r.useMemo(()=>Ze(1e3),[]),y=r.useMemo(()=>Ze(1e3),[]),q=r.useMemo(()=>Ze(1e3),[]),X=r.useMemo(()=>Ze(1e3),[]),d=r.useMemo(()=>Ze(1e3),[]);r.useEffect(()=>{n&&(a(["Debug","Info","Notice","Warn","Error","Fatal"][n.matterLoggerLevel]),h(n.matterFileLogger),t(n.matterMdnsInterface||""),j(n.matterIpv4Address||""),S(n.matterIpv6Address||""),A(n.matterPort?n.matterPort.toString():""),N(n.matterDiscriminator?n.matterDiscriminator.toString():""),p(n.matterPasscode?n.matterPasscode.toString():""))},[n]),r.useEffect(()=>()=>P.cancel(),[P]),r.useEffect(()=>()=>T.cancel(),[T]),r.useEffect(()=>()=>y.cancel(),[y]),r.useEffect(()=>()=>q.cancel(),[q]),r.useEffect(()=>()=>X.cancel(),[X]),r.useEffect(()=>()=>d.cancel(),[d]);const s=R=>{o&&console.log("handleChangeMjLoggerLevel called with value:",R.target.value),a(R.target.value),c({id:u.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmjloglevel",value:R.target.value}})},g=R=>{o&&console.log("handleLogOnFileMjChange called with value:",R.target.checked),h(R.target.checked),c({id:u.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmjlogfile",value:R.target.checked}})},x=R=>{o&&console.log("handleChangeMdnsInterface called with value:",R.target.value);const z=R.target.value;t(z),P(()=>{o&&console.log("debounced sendMessage setmdnsinterface with value:",z),c({id:u.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmdnsinterface",value:z}})})},H=R=>{o&&console.log("handleChangeIpv4Address called with value:",R.target.value);const z=R.target.value;j(z),T(()=>{o&&console.log("debounced sendMessage setipv4address with value:",z),c({id:u.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setipv4address",value:z}})})},de=R=>{o&&console.log("handleChangeIpv6Address called with value:",R.target.value);const z=R.target.value;S(z),y(()=>{o&&console.log("debounced sendMessage setipv6address with value:",z),c({id:u.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setipv6address",value:z}})})},ve=R=>{o&&console.log("handleChangeMatterPort called with value:",R.target.value);const z=R.target.value;A(z),q(()=>{o&&console.log("debounced sendMessage setmatterport with value:",z),c({id:u.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterport",value:z}})})},se=R=>{o&&console.log("handleChangeMatterDiscriminator called with value:",R.target.value);const z=R.target.value;N(z),X(()=>{o&&console.log("debounced sendMessage setmatterdiscriminator with value:",z),c({id:u.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterdiscriminator",value:z}})})},ye=R=>{o&&console.log("handleChangemMatterPasscode called with value:",R.target.value);const z=R.target.value;p(z),d(()=>{o&&console.log("debounced sendMessage setmatterpasscode with value:",z),c({id:u.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterpasscode",value:z}})})};return n?e.jsxs(Se,{style:{flex:`1 1 ${Mt}px`},children:[e.jsx(Ie,{children:e.jsx(ke,{children:"Matter settings"})}),e.jsxs(Ne,{style:{flexDirection:"column",padding:"10px",gap:"0px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"5px",gap:"15px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px"},id:"mjlogger-level-label",children:"Logger level:"}),e.jsxs(Xe,{style:{height:"30px"},labelId:"mjlogger-level-label",id:"mjlogger-level",value:i,onChange:s,children:[e.jsx(D,{value:"Debug",children:"Debug"}),e.jsx(D,{value:"Info",children:"Info"}),e.jsx(D,{value:"Notice",children:"Notice"}),e.jsx(D,{value:"Warn",children:"Warn"}),e.jsx(D,{value:"Error",children:"Error"}),e.jsx(D,{value:"Fatal",children:"Fatal"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"5px",gap:"10px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px"},id:"mjlogger-file-label",children:"Log on file:"}),e.jsx(Ee,{checked:f,onChange:g,id:"mjlogger-file",name:"logOnFileMj"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%",marginBottom:"10px",gap:"15px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px",textWrap:"nowrap"},children:"Mdns interface:"}),e.jsx(me,{value:b,onChange:x,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%",marginBottom:"10px",gap:"15px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px",textWrap:"nowrap"},children:"Ipv4 address:"}),e.jsx(me,{value:M,onChange:H,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%",marginBottom:"10px",gap:"15px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px",textWrap:"nowrap"},children:"Ipv6 address:"}),e.jsx(me,{value:w,onChange:de,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%",marginBottom:"10px",gap:"15px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px",textWrap:"nowrap"},children:"Commissioning port:"}),e.jsx(me,{value:V,onChange:ve,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%",marginBottom:"10px",gap:"15px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px",textWrap:"nowrap"},children:"Commissioning discriminator:"}),e.jsx(me,{value:_,onChange:se,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%",marginBottom:"10px",gap:"15px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px",textWrap:"nowrap"},children:"Commissioning passcode:"}),e.jsx(me,{value:v,onChange:ye,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]})]})]}):null}function hi({matterbridgeInfo:n}){return n?e.jsxs(Se,{style:{flex:`1 1 ${Mt}px`},children:[e.jsx(Ie,{children:e.jsx(ke,{children:"Matterbridge info"})}),e.jsxs(Ne,{style:{flexDirection:"column",padding:"10px",gap:"5px"},children:[e.jsx(Me,{value:n.matterbridgeVersion,label:"Current Version"}),e.jsx(Me,{value:n.matterbridgeLatestVersion,label:"Latest Version"}),e.jsx(Me,{value:n.rootDirectory,label:"Root Directory"}),e.jsx(Me,{value:n.homeDirectory,label:"Home Directory"}),e.jsx(Me,{value:n.matterbridgeDirectory,label:"Matterbridge Storage Directory"}),e.jsx(Me,{value:n.matterbridgePluginDirectory,label:"Matterbridge Plugin Directory"}),e.jsx(Me,{value:n.globalModulesDirectory,label:"Global Module Directory"})]})]}):null}function fi({systemInfo:n}){return n?e.jsxs(Se,{style:{flex:`1 1 ${Mt}px`},children:[e.jsx(Ie,{children:e.jsx(ke,{children:"System info"})}),e.jsxs(Ne,{style:{flexDirection:"column",padding:"10px",gap:"5px"},children:[e.jsx(Me,{value:n.interfaceName,label:"Interface name"}),e.jsx(Me,{value:n.macAddress,label:"MAC Address"}),e.jsx(Me,{value:n.ipv4Address,label:"IPv4 Address"}),e.jsx(Me,{value:n.ipv6Address,label:"IPv6 Address"}),e.jsx(Me,{value:n.nodeVersion,label:"Node Version"}),e.jsx(Me,{value:n.hostname,label:"Hostname"}),e.jsx(Me,{value:n.user,label:"User"})]})]}):null}function Me({value:n,label:c,width:l}){return e.jsx(me,{focused:!0,value:n,size:"small",label:c,variant:"standard",sx:{width:l?`${l-20}px`:"100%","& .MuiInput-underline:before":{borderBottomColor:"var(--main-label-color)",borderBottomWidth:"1px",opacity:.5},"& .MuiInput-underline:hover:not(.Mui-disabled):before":{borderBottomColor:"var(--main-label-color)",borderBottomWidth:"1px",opacity:.5},"& .MuiInput-underline.Mui-focused:after":{borderBottomColor:"var(--main-label-color)",borderBottomWidth:"1px",opacity:.5}},slotProps:{input:{readOnly:!0,sx:{color:"var(--div-text-color)","&:before":{borderBottomColor:"var(--main-label-color)"},"&:after":{borderBottomColor:"var(--main-label-color)"}}},inputLabel:{sx:{marginTop:"3px",color:"var(--main-label-color)","&.Mui-focused":{color:"var(--main-label-color)"}}}}})}const xi=r.memo(ui);function bi(){const{online:n,sendMessage:c,addListener:l,removeListener:i,getUniqueId:a}=r.useContext(xe),{showSnackbarMessage:f}=r.useContext(De),[h,b]=r.useState(null),[t,M]=r.useState([]),[j,w]=r.useState([]),[S,V]=r.useState(null),[A,_]=r.useState({cpuUsage:0}),[N,v]=r.useState({totalMemory:"",freeMemory:"",heapTotal:"",heapUsed:"",external:"",arrayBuffers:"",rss:""}),[p,u]=r.useState({systemUptime:"",processUptime:""}),P=r.useRef(a());return o&&console.log("Test uniqueId:",P),r.useEffect(()=>{o&&console.log("Test useEffect WebSocketMessage mounting");const T=y=>{if(y.method==="restart_required")o&&console.log("Test received restart_required"),f("Restart required",0);else if(y.method==="refresh_required")o&&console.log(`Test received refresh_required: changed=${y.response.changed} and sending api requests`),f("Refresh required",0),c({id:P.current,method:"/api/settings",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:P.current,method:"/api/plugins",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:P.current,method:"/api/devices",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}});else if(y.method==="memory_update")o&&console.log("Test received memory_update",y),v(y.response);else if(y.method==="cpu_update")o&&console.log("Test received cpu_update",y),_(y.response);else if(y.method==="uptime_update")o&&console.log("Test received uptime_update",y),u(y.response);else if(y.method==="/api/settings"&&y.response)o&&console.log("Test received /api/settings:",y.response),f("Test received /api/settings",0),b(y.response);else if(y.method==="/api/plugins"&&y.response)o&&console.log(`Test received ${y.response.length} plugins:`,y.response),f("Test received /api/plugins",0),M(y.response);else if(y.method==="/api/devices"&&y.response){o&&console.log(`Test received ${y.response.length} devices:`,y.response),f("Test received /api/devices",0),w(y.response);for(const q of y.response)o&&console.log("Test sending /api/clusters for device:",q.pluginName,q.name,q.endpoint),c({id:P.current,method:"/api/clusters",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{plugin:q.pluginName,endpoint:q.endpoint||0}})}else y.method==="/api/clusters"&&y.response&&(o&&console.log(`Test received ${y.response.clusters.length} clusters for device ${y.response.deviceName} endpoint ${y.response.id}:${y.response.number}:`,y),f(`Test received /api/clusters for ${y.response.plugin}::${y.response.deviceName}`,0),V(y.response))};return l(T,P.current),o&&console.log("Test useEffect WebSocketMessage mounted"),()=>{o&&console.log("Test useEffect WebSocketMessage unmounting"),i(T),o&&console.log("Test useEffect WebSocketMessage unmounted")}},[l,i,c,f]),r.useEffect(()=>(o&&console.log("Test useEffect online mounting"),n&&o&&console.log("Test useEffect online received online"),o&&console.log("Test useEffect online mounted"),()=>{o&&console.log("Test useEffect online unmounted")}),[n,c,f]),o&&console.log("Test rendering..."),n?e.jsx(st,{name:"Test",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",alignContent:"center",gap:"20px",height:"100vh",width:"100vw"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"256px",width:"256px",margin:"10px"}}),e.jsx("p",{children:"Welcome to the Test page of the Matterbridge frontend"})]})}):e.jsx(We,{})}const vi=r.memo(bi);function yi(n,c){o&&console.log("getCssVariable:",n,"defaultValue",c);const l=getComputedStyle(document.body).getPropertyValue(n).trim();return l||console.error("getCssVariable: undefined",l),l||c}function ji(n){return yo({palette:{primary:{main:n},action:{disabled:"var(--main-label-color)"},text:{disabled:"var(--main-label-color)"}},typography:{fontFamily:"Roboto, Helvetica, Arial, sans-serif"},components:{MuiDialog:{styleOverrides:{paper:{color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",border:"2px solid var(--div-border-color)",borderRadius:"var(--div-border-radius)",boxShadow:"2px 2px 5px var(--div-shadow-color)"}}},MuiTooltip:{defaultProps:{placement:"top-start",arrow:!0}},MuiButton:{styleOverrides:{root:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)","&:hover":{backgroundColor:"var(--main-button-bg-color)"},"&.Mui-disabled":{color:"var(--main-button-color)",backgroundColor:"var(--main-grey-color)"}},contained:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},outlined:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},text:{color:"var(--main-button-color)"}},defaultProps:{variant:"contained",size:"small"}},MuiIconButton:{styleOverrides:{root:{color:"var(--main-icon-color)","&:hover .MuiSvgIcon-root":{color:"var(--primary-color)"}}}},MuiCheckbox:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-checked":{color:"var(--primary-color)"}}}},MuiTextField:{defaultProps:{size:"small",variant:"outlined",fullWidth:!0}},MuiOutlinedInput:{styleOverrides:{root:{backgroundColor:"var(--div-bg-color)","& .MuiOutlinedInput-notchedOutline":{borderColor:"var(--main-label-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--main-text-color)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"var(--primary-color)"},padding:"0px"},input:{color:"var(--div-text-color)",padding:"4px 8px"}}},MuiInputLabel:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-focused":{color:"var(--primary-color)"}}}},MuiFormLabel:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-focused":{color:"var(--main-label-color)"}}}},MuiFormControl:{styleOverrides:{root:{color:"var(--main-grey-color)"}}},MuiRadio:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-checked":{color:"var(--primary-color)"}}}},MuiSelect:{styleOverrides:{root:{backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)",height:"30px","&:hover":{borderColor:"var(--main-text-color)"},"&.Mui-focused":{borderColor:"var(--primary-color)"}}}},MuiMenu:{styleOverrides:{paper:{backgroundColor:"var(--main-menu-bg-color)",padding:"0px",margin:"0px"},list:{padding:"0px"}}},MuiMenuItem:{styleOverrides:{root:{color:"var(--main-menu-color)",backgroundColor:"var(--main-menu-bg-color)","&:hover":{backgroundColor:"var(--main-menu-hover-color)"},"&.Mui-selected":{color:"var(--main-menu-color)",backgroundColor:"var(--main-menu-bg-color)"},"&.Mui-selected:hover":{backgroundColor:"var(--main-menu-hover-color)"}}}},MuiListItemButton:{styleOverrides:{root:{cursor:"pointer","&:hover":{backgroundColor:"var(--main-bg-color)"}}}},MuiListItemIcon:{styleOverrides:{root:{color:"var(--div-text-color)"}}},MuiListItemText:{styleOverrides:{primary:{fontSize:"16px",fontWeight:"bold",color:"var(--div-text-color)"},secondary:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"}}}}})}function wi(){const{mobile:n,showSnackbarMessage:c,showConfirmCancelDialog:l}=r.useContext(De),{online:i,sendMessage:a,logMessage:f,addListener:h,removeListener:b,getUniqueId:t}=r.useContext(xe),[M,j]=r.useState(!1),[w,S]=r.useState(!1),[V,A]=r.useState(!1),[_,N]=r.useState(!1),[v,p]=r.useState(null),u=r.useRef(t()),[P,T]=r.useState(null),[y,q]=r.useState(null),[X,d]=r.useState(null),[s,g]=r.useState(null),[x,H]=r.useState(null),de=()=>{window.open("https://www.buymeacoffee.com/luligugithub","_blank")},ve=()=>{window.open("https://matterbridge.io/")},se=()=>{window.open("https://matterbridge.io/README.html")},ye=()=>{window.open("https://matterbridge.io/CHANGELOG.html")},R=()=>{window.open("https://discord.gg/QX58CDe6hd","_blank")},z=()=>{window.open("https://github.com/Luligu/matterbridge","_blank")},F=()=>{a({id:u.current,sender:"Header",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:"matterbridge",restart:!0}})},G=()=>{a({id:u.current,sender:"Header",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:"matterbridge@dev",restart:!0}})},$=()=>{a({id:u.current,sender:"Header",method:"/api/checkupdates",src:"Frontend",dst:"Matterbridge",params:{}})},W=()=>{o&&console.log("Header: handleShellySystemUpdateClick"),f("Matterbridge","Installing system updates..."),a({id:u.current,sender:"Header",method:"/api/shellysysupdate",src:"Frontend",dst:"Matterbridge",params:{}})},k=()=>{o&&console.log("Header: handleShellyMainUpdateClick"),f("Matterbridge","Installing software updates..."),a({id:u.current,sender:"Header",method:"/api/shellymainupdate",src:"Frontend",dst:"Matterbridge",params:{}})},C=()=>{o&&console.log("Header: handleShellyCreateSystemLog"),a({id:u.current,sender:"Header",method:"/api/shellycreatesystemlog",src:"Frontend",dst:"Matterbridge",params:{}})},L=()=>{o&&console.log("Header: handleShellyDownloadSystemLog"),f("Matterbridge","Downloading Shelly system log..."),c("Downloading Shelly system log...",5),window.location.href="./api/shellydownloadsystemlog"},K=()=>{v?.matterbridgeInformation.restartMode===""?a({id:u.current,sender:"Header",method:"/api/restart",src:"Frontend",dst:"Matterbridge",params:{}}):a({id:u.current,sender:"Header",method:"/api/shutdown",src:"Frontend",dst:"Matterbridge",params:{}})},ae=()=>{a({id:u.current,sender:"Header",method:"/api/shutdown",src:"Frontend",dst:"Matterbridge",params:{}})},oe=()=>{a({id:u.current,sender:"Header",method:"/api/reboot",src:"Frontend",dst:"Matterbridge",params:{}})},ce=()=>{a({id:u.current,sender:"Header",method:"/api/softreset",src:"Frontend",dst:"Matterbridge",params:{}})},ue=()=>{a({id:u.current,sender:"Header",method:"/api/hardreset",src:"Frontend",dst:"Matterbridge",params:{}})},pe=E=>{T(E.currentTarget)},I=E=>{o&&console.log("Header: handleMenuClose",E),T(null),E==="download-mblog"?(f("Matterbridge","Downloading matterbridge log..."),c("Downloading matterbridge log...",5),window.location.href="./api/download-mblog"):E==="download-mjlog"?(f("Matterbridge","Downloading matter log..."),c("Downloading matter log...",5),window.location.href="./api/download-mjlog"):E==="view-mblog"?(f("Matterbridge","Loading matterbridge log..."),c("Loading matterbridge log...",5),window.open("./api/view-mblog","_blank","noopener,noreferrer")):E==="view-mjlog"?(f("Matterbridge","Loading matter log..."),c("Loading matter log...",5),window.open("./api/view-mjlog","_blank","noopener,noreferrer")):E==="view-diagnostic"?(f("Matterbridge","Loading diagnostic log..."),c("Loading diagnostic log...",5),window.open("./api/view-diagnostic","_blank","noopener,noreferrer")):E==="download-diagnostic"?(f("Matterbridge","Downloading diagnostic log..."),c("Downloading diagnostic log...",5),window.location.href="./api/download-diagnostic"):E==="view-history"?a({id:u.current,sender:"Header",method:"/api/viewhistorypage",src:"Frontend",dst:"Matterbridge",params:{}}):E==="download-history"?a({id:u.current,sender:"Header",method:"/api/downloadhistorypage",src:"Frontend",dst:"Matterbridge",params:{}}):E==="view-shellylog"?(f("Matterbridge","Loading shelly system log..."),c("Loading shelly system log...",5),window.location.href="./api/shellyviewsystemlog"):E==="download-mbstorage"?(f("Matterbridge","Downloading matterbridge storage..."),c("Downloading matterbridge storage...",5),window.location.href="./api/download-mbstorage"):E==="download-pluginstorage"?(f("Matterbridge","Downloading matterbridge plugins storage..."),c("Downloading matterbridge plugins storage...",5),window.location.href="./api/download-pluginstorage"):E==="download-pluginconfig"?(f("Matterbridge","Downloading matterbridge plugins config..."),c("Downloading matterbridge plugins config...",5),window.location.href="./api/download-pluginconfig"):E==="download-mjstorage"?(f("Matterbridge","Downloading matter storage..."),c("Downloading matter storage...",5),window.location.href="./api/download-mjstorage"):E==="download-backup"?(f("Matterbridge","Downloading backup..."),c("Downloading backup...",10),window.location.href="./api/download-backup"):E==="update"?F():E==="updatedev"?G():E==="updatecheck"?$():E==="shelly-sys-update"?W():E==="shelly-main-update"?k():E==="shelly-create-system-log"?C():E==="shelly-download-system-log"?L():E==="softreset"?ce():E==="hardreset"?ue():E==="restart"?K():E==="shutdown"?ae():E==="reboot"?oe():E==="create-backup"?a({id:u.current,sender:"Header",method:"/api/create-backup",src:"Frontend",dst:"Matterbridge",params:{}}):E==="unregister"?a({id:u.current,sender:"Header",method:"/api/unregister",src:"Frontend",dst:"Matterbridge",params:{}}):E==="reset"?a({id:u.current,sender:"Header",method:"/api/reset",src:"Frontend",dst:"Matterbridge",params:{}}):E==="factoryreset"&&a({id:u.current,sender:"Header",method:"/api/factoryreset",src:"Frontend",dst:"Matterbridge",params:{}})},m=E=>{o&&console.log("Header: handleMenuCloseCancel:",E),T(null)},fe=E=>{q(E.currentTarget)},ee=()=>{q(null)},he=E=>{d(E.currentTarget)},Z=()=>{d(null)},ge=E=>{g(E.currentTarget)},be=()=>{g(null)},rt=E=>{H(E.currentTarget)},Fe=()=>{H(null)},U=()=>{Si(),o&&console.log("Matterbridge logo clicked: debug is now",o)};return r.useEffect(()=>{const E=re=>{o&&console.log("Header received WebSocket Message:",re),re.method==="/api/settings"&&re.id===u.current?(o&&console.log("Header received settings:",re.response),p(re.response),j(re.response.matterbridgeInformation.restartRequired||re.response.matterbridgeInformation.fixedRestartRequired),S(re.response.matterbridgeInformation.fixedRestartRequired),A(re.response.matterbridgeInformation.updateRequired)):re.method==="refresh_required"&&re.response.changed==="settings"?(o&&console.log(`Header received refresh_required: changed=${re.response.changed} and sending /api/settings request`),a({id:u.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})):re.method==="restart_required"?(o&&console.log(`Header received restart_required with fixed: ${re.response.fixed}`),j(!0),re.response.fixed===!0&&S(!0)):re.method==="restart_not_required"?(o&&console.log("Header received restart_not_required"),j(!1)):re.method==="update_required"?(o&&console.log("Header received update_required"),re.response.devVersion===!0?N(!0):A(!0),a({id:u.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})):re.method==="shelly_sys_update"?(o&&console.log("Header received WS_ID_SHELLY_SYS_UPDATE:"),p(je=>je?{matterbridgeInformation:{...je.matterbridgeInformation,shellySysUpdate:re.response.available},systemInformation:je.systemInformation}:null)):re.method==="shelly_main_update"?(o&&console.log("Header received WS_ID_SHELLY_MAIN_UPDATE:"),p(je=>je?{matterbridgeInformation:{...je.matterbridgeInformation,shellyMainUpdate:re.response.available},systemInformation:je.systemInformation}:null)):re.method==="/api/viewhistorypage"&&re.id===u.current&&re.success===!0?(o&&console.log("Header received /api/viewhistorypage success"),window.open("./api/viewhistory","_blank","noopener,noreferrer")):re.method==="/api/downloadhistorypage"&&re.id===u.current&&re.success===!0&&(o&&console.log("Header received /api/downloadhistorypage success"),window.location.href="./api/downloadhistory")};return h(E,u.current),o&&console.log(`Header added WebSocket listener id ${u.current}`),()=>{b(E),o&&console.log("Header removed WebSocket listener")}},[h,b,a,c]),r.useEffect(()=>{i&&(o&&console.log("Header sending /api/settings and /api/checkupdates requests"),a({id:u.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),a({id:u.current,sender:"Header",method:"/api/checkupdates",src:"Frontend",dst:"Matterbridge",params:{}}))},[i,a]),o&&console.log("Header rendering... mobile %s",n),!i||!v?null:e.jsxs("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between",alignItems:"center",width:"100%",gap:"10px"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"center",gap:"10px"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"30px"},onClick:U}),e.jsx("h2",{style:{fontSize:"22px",color:"var(--main-icon-color)",margin:"0px"},children:"Matterbridge"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:e.jsxs("nav",{children:[e.jsx(lt,{to:"/",className:"nav-link",children:"Home"}),e.jsx(lt,{to:"/devices",className:"nav-link",children:"Devices"}),e.jsx(lt,{to:"/log",className:"nav-link",children:"Logs"}),e.jsx(lt,{to:"/settings",className:"nav-link",children:"Settings"})]})})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"center",gap:"10px"},children:[!v.matterbridgeInformation.readOnly&&e.jsx(O,{title:`Matterbridge v.${v.matterbridgeInformation.matterbridgeVersion}`,children:e.jsxs("span",{className:"status-information",style:{cursor:"default"},children:["v.",v.matterbridgeInformation.matterbridgeVersion.split("-dev-")[0]+(v.matterbridgeInformation.matterbridgeVersion.includes("-dev-")?"@dev":"")]})}),v.matterbridgeInformation.shellyBoard&&e.jsx("img",{src:"Shelly.svg",alt:"Shelly Icon",style:{height:"30px",padding:"0px",margin:"0px",marginRight:"30px"}}),v.matterbridgeInformation.bridgeMode!==""&&v.matterbridgeInformation.readOnly===!1?e.jsx(O,{title:"Bridge mode",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:v.matterbridgeInformation.bridgeMode})}):null,v.matterbridgeInformation.restartMode!==""&&v.matterbridgeInformation.readOnly===!1?e.jsx(O,{title:"Restart mode",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:v.matterbridgeInformation.restartMode})}):null,v.matterbridgeInformation.profile&&v.matterbridgeInformation.profile!==""&&v.matterbridgeInformation.readOnly===!1?e.jsx(O,{title:"Current profile",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:v.matterbridgeInformation.profile})}):null]}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"center",gap:"5px"},children:[v.matterbridgeInformation.readOnly===!1?e.jsx(O,{title:"Matterbridge discord group",children:e.jsx("img",{src:"discord.svg",alt:"Discord Logo",style:{cursor:"pointer",height:"25px"},onClick:R})}):null,v.matterbridgeInformation.readOnly===!1?e.jsx(O,{title:"Give a star to Matterbridge",children:e.jsx(Q,{style:{color:"#FFD700",margin:"0",padding:"0"},onClick:z,children:e.jsx(dr,{})})}):null,v.matterbridgeInformation.readOnly===!1?e.jsx(O,{title:"Sponsor Matterbridge",children:e.jsx(Q,{style:{color:"#b6409c",margin:"0",padding:"0"},onClick:de,children:e.jsx(Tt,{})})}):null,e.jsx(O,{title:"Matterbridge homepage",children:e.jsx(Q,{style:{color:"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:ve,children:e.jsx(jo,{})})}),e.jsx(O,{title:"Matterbridge help",children:e.jsx(Q,{style:{color:"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:se,children:e.jsx(ar,{})})}),e.jsx(O,{title:"Matterbridge changelog",children:e.jsx(Q,{style:{color:"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:ye,children:e.jsx(Ft,{})})}),v.matterbridgeInformation&&!v.matterbridgeInformation.readOnly&&V&&e.jsx(O,{title:`Update matterbridge to latest version v.${v.matterbridgeInformation.matterbridgeLatestVersion}`,children:e.jsx(Q,{style:{color:V?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:F,children:e.jsx($e,{})})}),v.matterbridgeInformation&&!v.matterbridgeInformation.readOnly&&_&&e.jsx(O,{title:`Update matterbridge to latest dev version v.${v.matterbridgeInformation.matterbridgeDevVersion}`,children:e.jsx(Q,{style:{color:_?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:G,children:e.jsx($e,{})})}),v.matterbridgeInformation&&v.matterbridgeInformation.shellyBoard&&v.matterbridgeInformation.shellySysUpdate&&e.jsx(O,{title:"Shelly system update",children:e.jsx(Q,{style:{color:"var(--primary-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:W,children:e.jsx($e,{})})}),v.matterbridgeInformation&&v.matterbridgeInformation.shellyBoard&&v.matterbridgeInformation.shellyMainUpdate&&e.jsx(O,{title:"Shelly software update",children:e.jsx(Q,{style:{color:"var(--primary-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:k,children:e.jsx($e,{})})}),e.jsx(O,{title:"Restart matterbridge",children:e.jsx(Q,{style:{color:M||w?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:K,children:e.jsx(wt,{})})}),v.matterbridgeInformation.restartMode===""?e.jsx(O,{title:"Shut down matterbridge",children:e.jsx(Q,{style:{color:M||w?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:ae,children:e.jsx(qe,{})})}):null,e.jsx(O,{title:"Download, backup and more",children:e.jsx(Q,{onClick:pe,children:e.jsx(wo,{style:{color:"var(--main-icon-color)"}})})}),e.jsxs(Ye,{id:"command-menu",anchorEl:P,keepMounted:!0,open:!!P,onClose:()=>I(""),children:[v.matterbridgeInformation&&!v.matterbridgeInformation.readOnly&&e.jsxs(D,{onClick:()=>I("update"),children:[e.jsx(B,{children:e.jsx($e,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Install latest stable",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),v.matterbridgeInformation&&!v.matterbridgeInformation.readOnly&&e.jsxs(D,{onClick:()=>I("updatedev"),children:[e.jsx(B,{children:e.jsx($e,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Install latest dev",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),v.matterbridgeInformation&&!v.matterbridgeInformation.readOnly&&e.jsxs(D,{onClick:()=>I("updatecheck"),children:[e.jsx(B,{children:e.jsx($e,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Check for updates",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),v.matterbridgeInformation&&v.matterbridgeInformation.shellyBoard&&v.matterbridgeInformation.shellySysUpdate&&e.jsxs(D,{onClick:()=>I("shelly-sys-update"),children:[e.jsx(B,{children:e.jsx($e,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Shelly system update",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),v.matterbridgeInformation&&v.matterbridgeInformation.shellyBoard&&v.matterbridgeInformation.shellyMainUpdate&&e.jsxs(D,{onClick:()=>I("shelly-main-update"),children:[e.jsx(B,{children:e.jsx($e,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Shelly software update",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(D,{onClick:()=>I("restart"),children:[e.jsx(B,{children:e.jsx(wt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Restart",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),v.matterbridgeInformation.restartMode===""?e.jsxs(D,{onClick:()=>I("shutdown"),children:[e.jsx(B,{children:e.jsx(qe,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Shutdown",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}):null,v.matterbridgeInformation&&v.matterbridgeInformation.shellyBoard&&e.jsxs(D,{onClick:()=>{l("Reboot","Are you sure you want to reboot the Shelly board?","reboot",I,m)},children:[e.jsx(B,{children:e.jsx(wt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Reboot...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsx(gt,{}),e.jsxs(D,{onClick:he,children:[e.jsx(B,{children:e.jsx(Be,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"View",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(Ye,{id:"sub-menu-view",anchorEl:X,keepMounted:!0,open:!!X,onClose:Z,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(D,{onClick:()=>{I("view-mblog"),Z()},children:[e.jsx(B,{children:e.jsx(Be,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Matterbridge log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(D,{onClick:()=>{I("view-mjlog"),Z()},children:[e.jsx(B,{children:e.jsx(Be,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Matter log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(D,{onClick:()=>{I("view-diagnostic"),Z()},children:[e.jsx(B,{children:e.jsx(Be,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Matterbridge diagnostic log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(D,{onClick:()=>{I("view-history"),Z()},children:[e.jsx(B,{children:e.jsx(Be,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Matterbridge system history",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),v.matterbridgeInformation&&v.matterbridgeInformation.shellyBoard&&e.jsxs(D,{onClick:()=>{I("view-shellylog"),Z()},children:[e.jsx(B,{children:e.jsx(Be,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(gt,{}),e.jsxs(D,{onClick:ge,children:[e.jsx(B,{children:e.jsx(Le,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Download",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(Ye,{id:"sub-menu-download",anchorEl:s,keepMounted:!0,open:!!s,onClose:be,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(D,{onClick:()=>{I("download-mbstorage"),be()},children:[e.jsx(B,{children:e.jsx(Le,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Matterbridge storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(D,{onClick:()=>{I("download-pluginstorage"),be()},children:[e.jsx(B,{children:e.jsx(Le,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Matterbridge plugins storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(D,{onClick:()=>{I("download-pluginconfig"),be()},children:[e.jsx(B,{children:e.jsx(Le,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Matterbridge plugins config",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(D,{onClick:()=>{I("download-mblog"),be()},children:[e.jsx(B,{children:e.jsx(Le,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Matterbridge log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(D,{onClick:()=>{I("download-mjstorage"),be()},children:[e.jsx(B,{children:e.jsx(Le,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Matter storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(D,{onClick:()=>{I("download-mjlog"),be()},children:[e.jsx(B,{children:e.jsx(Le,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Matter log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(D,{onClick:()=>{I("download-diagnostic"),be()},children:[e.jsx(B,{children:e.jsx(Le,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Matterbridge diagnostic log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(D,{onClick:()=>{I("download-history"),be()},children:[e.jsx(B,{children:e.jsx(Le,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Matterbridge system history",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),v.matterbridgeInformation&&v.matterbridgeInformation.shellyBoard&&e.jsxs(D,{onClick:()=>{I("shelly-create-system-log"),be()},children:[e.jsx(B,{children:e.jsx(Le,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Create Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),v.matterbridgeInformation&&v.matterbridgeInformation.shellyBoard&&e.jsxs(D,{onClick:()=>{I("shelly-download-system-log"),be()},children:[e.jsx(B,{children:e.jsx(Le,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Download Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(gt,{}),e.jsxs(D,{onClick:fe,children:[e.jsx(B,{children:e.jsx(It,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(Ye,{id:"sub-menu-backup",anchorEl:y,keepMounted:!0,open:!!y,onClose:ee,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(D,{onClick:()=>{I("create-backup"),ee()},children:[e.jsx(B,{children:e.jsx(It,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Create backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(D,{onClick:()=>{I("download-backup"),ee()},children:[e.jsx(B,{children:e.jsx(It,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Download backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(gt,{}),e.jsxs(D,{onClick:rt,children:[e.jsx(B,{children:e.jsx(Co,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Reset",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(Ye,{id:"sub-menu-reset",anchorEl:x,keepMounted:!0,open:!!x,onClose:Fe,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(D,{onClick:()=>{Fe(),l("Reset all devices and shutdown","Are you sure you want to unregister all devices? This will temporarily remove all devices from the controller and you may loose the controller configuration.","unregister",I,m)},children:[e.jsx(B,{children:e.jsx(qe,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Reset all devices...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(D,{onClick:()=>{Fe(),l("Reset commissioning and shutdown","Are you sure you want to reset the commissioning? You will have to manually remove Matterbridge from the controller.","reset",I,m)},children:[e.jsx(B,{children:e.jsx(qe,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Reset commissioning...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),!v.matterbridgeInformation.readOnly&&e.jsxs(D,{onClick:()=>{Fe(),l("Factory reset and shutdown","Are you sure you want to factory reset Matterbridge? You will have to manually remove Matterbridge from the controller.","factoryreset",I,m)},children:[e.jsx(B,{children:e.jsx(qe,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Factory reset...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),v.matterbridgeInformation&&v.matterbridgeInformation.shellyBoard&&e.jsxs(D,{onClick:()=>{Fe(),l("Network reset","Are you sure you want to factory reset the network parameters?","softreset",I,m)},children:[e.jsx(B,{children:e.jsx(qe,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Reset network...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),v.matterbridgeInformation&&v.matterbridgeInformation.shellyBoard&&e.jsxs(D,{onClick:()=>{Fe(),l("Factory reset","Are you sure you want to factory reset Matterbridge? You will have to manually remove Matterbridge from the controller.","hardreset",I,m)},children:[e.jsx(B,{children:e.jsx(qe,{style:{color:"var(--main-icon-color)"}})}),e.jsx(Y,{primary:"Factory reset...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]})]})]})]})}const or=r.memo(wi),xr=1200,br=900;let $t,Wt;function nr(){if(typeof window<"u"){$t=Math.floor(window.visualViewport?.width??window.innerWidth),Wt=Math.floor(window.visualViewport?.height??window.innerHeight);const n=$t<xr||Wt<br;return o&&console.log("Visual viewport (%s) width %i height %i mobile %s",window.visualViewport!==void 0,$t,Wt,n),n}return!1}function Ci({children:n}){const{mobile:c,setMobile:l}=r.useContext(De);return r.useEffect(()=>{function i(){l(nr())}return window.addEventListener("resize",i),l(nr()),()=>window.removeEventListener("resize",i)},[l]),o&&console.log("MbfScreen rendering... mobile %s",c),c?e.jsxs("div",{style:{display:"flex",flexDirection:"column",overflow:"visible",margin:"0px",padding:"10px",gap:"10px"},children:[e.jsx(or,{}),e.jsx("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%",margin:"0px",padding:"0px",gap:"10px"},children:n})]}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",overflow:"hidden",width:c?`${xr}px`:"calc(100vw - 40px)",height:c?`${br}px`:"calc(100vh - 40px)",margin:"0px",padding:"20px",gap:"20px"},children:[e.jsx(or,{}),e.jsx("div",{style:{display:"flex",flexDirection:"row",width:"100%",height:"calc(100% - 60px)",margin:"0px",padding:"0px",gap:"20px"},children:n})]})}let o=!1;const Si=()=>{o=!o},ki=!1;let et;const Mi=n=>{et=n};function Ii({setLoggedIn:n}){const[c,l]=r.useState(""),[i,a]=r.useState(""),f={display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",backgroundColor:"var(--main-bg-color)"},h={display:"flex",flexDirection:"column",maxWidth:"400px",margin:"0 auto",padding:"20px",gap:"20px",border:"1px solid var(--div-border-color)",borderRadius:"var(--div-border-radius)",boxShadow:"2px 2px 5px var(--div-shadow-color)",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},b={margin:"10px 0",padding:"3px 3px",fontSize:"14px",width:"230px",border:"1px solid var(--main-label-color)",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},t=async j=>{try{const w=await fetch("./api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:j})});if(w.ok){const{valid:S}=await w.json();S?(n(!0),j!==""&&(et=j)):j!==""&&a("Incorrect password!")}else console.error("Failed to log in:",w.statusText)}catch(w){console.error("Failed to log in:",w)}},M=j=>{j.preventDefault(),t(c)};return t(""),e.jsx("div",{style:f,children:e.jsxs("form",{onSubmit:M,style:h,children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"64px",width:"64px"}}),e.jsx("h3",{style:{color:"var(--div-text-color)"},children:"Welcome to Matterbridge"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:"20px"},children:[e.jsx("input",{type:"text",name:"username",autoComplete:"username",style:{display:"none"},tabIndex:-1}),e.jsx("input",{type:"password",value:c,onChange:j=>l(j.target.value),style:b,placeholder:"password",autoComplete:"current-password"}),e.jsx("button",{type:"submit",style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",borderColor:"var(--div-bg-color)"},children:"Log in"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",margin:0,height:"30px"},children:i&&e.jsx("p",{style:{color:"red"},children:i})})]})})}function Di(){const[n,c]=r.useState(!1),l=localStorage.getItem("frontendTheme")||"dark";o&&console.log('Setting frontend theme "%s"',l),document.body.setAttribute("frontend-theme",l);const i=yi("--primary-color","#1976d2");o&&console.log('Primary color from CSS "%s"',i);const a=ji(i);window.location.href.includes("/api/hassio_ingress/");const f=window.location.pathname.includes("/matterbridge/")?"/matterbridge":window.location.href.includes("/api/hassio_ingress/")?window.location.pathname:"/";return o&&(console.log("Loading App..."),console.log(`- with href = "${window.location.href}"`),console.log(`- pathname = "${window.location.pathname}"`),console.log(`- baseName = "${f}"`)),n?e.jsx(So,{theme:a,children:e.jsx(Tr,{dense:!0,maxSnack:10,preventDuplicate:!0,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(ln,{children:e.jsx(cn,{children:e.jsx(Pr,{basename:f,children:e.jsx(Ci,{children:e.jsxs(Lr,{children:[e.jsx(ze,{path:"/",element:e.jsx(Vn,{})}),e.jsx(ze,{path:"/devices",element:e.jsx(ai,{})}),e.jsx(ze,{path:"/log",element:e.jsx(ci,{})}),e.jsx(ze,{path:"/settings",element:e.jsx(xi,{})}),e.jsx(ze,{path:"/test",element:e.jsx(vi,{})}),e.jsx(ze,{path:"*",element:e.jsx($r,{to:"/"})})]})})})})})})}):e.jsx(Ii,{setLoggedIn:c})}Wr.createRoot(document.getElementById("root")).render(e.jsx(Nr.StrictMode,{children:e.jsx(Di,{})}));
