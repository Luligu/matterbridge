import{B as e,y as r,S as et,U as mr,V as hr,X as Ae,Y as fr,Z as xr,I as br}from"./vendor_node_modules.js";import{u as vr,S as yr}from"./vendor_notistack.js";import{D as De,a as Pe,b as Ne,B as ie,c as He,d as X,A as jr,I as K,C as wr,e as Cr,T as R,f as me,M as Sr,g as Ue,h as I,i as Ie,F as Mr,j as ut,k as ae,l as Oe,K as Wt,m as $t,n as ht,L as tt,o as Ze,p as rt,q as B,W as Ye,r as ot,H as nt,s as re,V as Lt,t as Ft,u as kr,E as Ir,v as Dr,w as Re,Q as Qt,R as gt,S as kt,U as Pr,P as Nr,x as Wr,y as $r,z as Gt,G as Kt,J as mt,N as Lr,O as Jt,X as Fr,Y as Tr,Z as Hr,_ as Tt,$ as Rr,a0 as Or,a1 as Vr,a2 as Er,a3 as Ar,a4 as _r,a5 as zr,a6 as Ht,a7 as qr,a8 as Br,a9 as Ur,aa as Qr,ab as Gr,ac as Kr,ad as Jr,ae as Zr,af as Yr,ag as Xr,ah as eo,ai as to,aj as ro,ak as oo,al as no,am as Rt,an as Qe,ao as Zt,ap as Ce,aq as Yt,ar as ft,as as Te,at as io,au as so,av as ao,aw as Fe,ax as Ee,ay as lo,az as it,aA as st,aB as vt,aC as co,aD as po}from"./vendor_mui.js";import{Q as uo}from"./vendor_qrcode.js";import{I as ne,m as Ot,a as go,b as mo,c as Vt,d as ho,e as fo,f as xo,g as bo,h as vo,i as yo,j as jo,k as wo,l as Co,n as So,o as Mo,p as ko,q as Et,r as Io,s as Do,t as Po,u as No,v as Wo,w as $o,x as Lo,y as Fo,z as At,A as To,B as Ho}from"./vendor_mdi.js";import{F as Ro,v as Oo,e as Vo,a as Eo,g as Ao,b as _o,c as zo,d as yt,A as qo}from"./vendor_rjsf.js";import"./vendor_lodash.js";import"./vendor_emotion.js";(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const m of a)if(m.type==="childList")for(const h of m.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function d(a){const m={};return a.integrity&&(m.integrity=a.integrity),a.referrerPolicy&&(m.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?m.credentials="include":a.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function s(a){if(a.ep)return;a.ep=!0;const m=d(a);fetch(a.href,m)}})();function Bo({open:n,title:p,message:d,onConfirm:s,onCancel:a}){const m=t=>{o&&console.log("Confirmed"),t.preventDefault(),s()},h=t=>{o&&console.log("Canceled"),t.preventDefault(),a()};return e.jsxs(De,{open:n,children:[e.jsx(Pe,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:p})]})}),e.jsxs(Ne,{children:[e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",margin:"0",marginBottom:"20px",maxHeight:"350px",maxWidth:"350px"},children:e.jsx("p",{style:{flex:1,margin:"0"},children:d})}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-around"},children:[e.jsx(ie,{onClick:m,variant:"contained",color:"primary",size:"small",children:"Confirm"}),e.jsx(ie,{onClick:h,variant:"contained",color:"primary",size:"small",children:"Cancel"})]})]})]})}const Uo=({open:n,output:p,packageName:d,onInstall:s,onClose:a})=>{const m=r.useRef(null);return r.useEffect(()=>{o&&console.log(`InstallProgressDialog output effect mounted, scrolling to bottom: ${m.current}`),setTimeout(()=>{o&&console.log("Scrolling to bottom:",m.current),m.current?.scrollIntoView({behavior:"smooth"})},0)},[p]),e.jsxs(De,{open:n,onClose:(h,t)=>{t==="backdropClick"||t==="escapeKeyDown"||a()},slotProps:{paper:{sx:{width:"70vw",maxWidth:"70vw",height:"70vw",maxHeight:"70vh",overflow:"hidden"}}},children:[e.jsx(Pe,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsxs("h4",{style:{margin:0},children:["Install",s?"":"ing"," package ",d]})]})}),e.jsxs(Ne,{dividers:!0,style:{overflow:"hidden",display:"flex",flexDirection:"column",height:400,paddingBottom:0},children:[e.jsx("label",{style:{display:"block",marginBottom:"10px",fontSize:"16px",fontWeight:"bold",color:"var(--primary-color)"},children:"Install log"}),e.jsxs("ul",{style:{width:"100%",height:"100%",fontFamily:"monospace",fontSize:"14px",padding:"10px",margin:0,marginBottom:"10px",color:"var(--div-text-color)",background:"var(--div-bg-color)",overflow:"auto",listStyle:"none",boxSizing:"border-box",borderRadius:4,border:"4px solid var(--primary-color)",whiteSpace:"pre-wrap",display:"block"},children:[p.split(`
`).map((h,t)=>e.jsx("li",{style:{padding:0,margin:0,wordBreak:"break-all"},children:h},t)),e.jsx("li",{ref:m,style:{padding:0,margin:0}})]})]}),e.jsxs(He,{children:[s&&e.jsx(ie,{variant:"contained",onClick:s,children:"Install"}),e.jsx(ie,{onClick:a,children:"Close"})]})]})},at=[],Ge=r.createContext(null);function Qo({children:n}){const{enqueueSnackbar:p,closeSnackbar:d}=vr(),s=r.useCallback(te=>{o&&console.log(`UiProvider closeSnackbarMessage: message ${te}`);const Y=at.findIndex(ve=>ve.message===te);Y!==-1&&(d(at[Y].key),at.splice(Y,1),o&&console.log(`UiProvider closeSnackbarMessage: message ${te} removed from persistMessages`))},[d]),a=r.useCallback((te,Y,ve)=>{o&&console.log(`UiProvider showSnackbarMessage: message ${te} timeout ${Y}`);const U=p(te,{variant:"default",autoHideDuration:Y==null||Y>0?(Y??5)*1e3:null,persist:Y===0,content:oe=>e.jsx(X,{sx:{margin:"0",padding:"0",width:"300px",marginRight:"30px"},children:e.jsx(jr,{severity:ve??"info",variant:"filled",sx:{color:"#fff",fontWeight:"normal",width:"100%",cursor:"pointer",padding:"0px 10px"},onClick:()=>d(oe),action:e.jsx(K,{size:"small",onClick:()=>d(oe),sx:{color:"#fff"},children:e.jsx(wr,{fontSize:"small"})}),children:te},oe)},oe)});Y===0&&(o&&console.log(`UiProvider showSnackbarMessage: message ${te} timeout ${Y} - persist key ${U}`),at.push({message:te,key:U}))},[p,d]),[m,h]=r.useState(!1),[t,S]=r.useState(""),[L,j]=r.useState(""),[b,y]=r.useState(""),H=r.useRef(null),D=r.useRef(null),z=()=>{o&&console.log(`UiProvider handle confirm action ${b}`),h(!1),H.current&&H.current(b)},f=()=>{o&&console.log(`UiProvider handle cancel action ${b}`),h(!1),D.current&&D.current(b)},V=r.useCallback((te,Y,ve,U,oe)=>{o&&console.log(`UiProvider showConfirmCancelDialog for command ${ve}`),S(te),j(Y),y(ve),H.current=U,D.current=oe,h(!0)},[]),[x,W]=r.useState(!1),[F,O]=r.useState(""),[v,E]=r.useState(""),w=r.useCallback(te=>{o&&console.log(`UiProvider show install progress for package ${te}`),O(te),E(`Starting installation of ${te}...
`),W(!0)},[]),l=r.useCallback(te=>{o&&console.log(`UiProvider addInstallProgress: output ${te}`),E(Y=>Y+te+`
`)},[]),i=r.useCallback(()=>{o&&console.log(`UiProvider exitInstallProgressSuccess: package ${F}`),E(te=>te+`Successfully installed ${F}
`)},[F]),c=r.useCallback(()=>{o&&console.log(`UiProvider exitInstallProgressError: package ${F}`),E(te=>te+`Failed to install ${F}
`)},[F]),u=r.useCallback(()=>{o&&console.log("UiProvider hide install progress"),W(!1)},[]),T=()=>{o&&console.log("UiProvider handle install close action"),W(!1),O(""),E("")},ue=r.useMemo(()=>({showSnackbarMessage:a,closeSnackbarMessage:s,closeSnackbar:d,showConfirmCancelDialog:V,showInstallProgress:w,exitInstallProgressSuccess:i,exitInstallProgressError:c,hideInstallProgress:u,addInstallProgress:l}),[a,s,d,V,w,i,c,u,l]);return e.jsxs(Ge.Provider,{value:ue,children:[e.jsx(Bo,{open:m,title:t,message:L,onConfirm:z,onCancel:f}),e.jsx(Uo,{open:x,packageName:F,output:v,onClose:T}),n]})}const Xt=r.createContext(null),xe=r.createContext(null);function Go({children:n}){const[p,d]=r.useState(localStorage.getItem("logFilterLevel")??"info"),[s,a]=r.useState(localStorage.getItem("logFilterSearch")??"*"),[m,h]=r.useState([]),[t,S]=r.useState(1e3),[L,j]=r.useState(!0),[b,y]=r.useState(!1),{showSnackbarMessage:H,closeSnackbarMessage:D,closeSnackbar:z,showInstallProgress:f,hideInstallProgress:V,exitInstallProgressSuccess:x,exitInstallProgressError:W,addInstallProgress:F}=r.useContext(Ge),O=r.useRef([]),v=r.useRef(null),E=r.useRef(1),w=r.useRef(Math.floor(Math.random()*999e3)+1e3),l=r.useRef(null),i=r.useRef(null),c=r.useRef(null),u=r.useRef(p),T=r.useRef(s),ue=r.useRef(0),te=r.useRef(null),Y=r.useMemo(()=>window.location.href.replace(/^http/,"ws"),[]),ve=r.useMemo(()=>window.location.href.includes("api/hassio_ingress"),[]),U=100,oe=60,$=50,Q=300,P=10;r.useEffect(()=>(o&&console.log("WebSocket messages started counter interval"),te.current=setInterval(()=>{ue.current>0&&(o&&console.log(`WebSocket messages received in the last ${P} seconds: ${ue.current*(60/P)} messages/minute`),ue.current=0)},P*1e3),()=>{o&&console.log("WebSocket messages stopped counter interval"),te.current&&clearInterval(te.current),te.current=null}),[]),r.useEffect(()=>{u.current=p},[p]),r.useEffect(()=>{T.current=s},[s]);const N=r.useCallback(()=>Math.floor(Math.random()*999e3)+1e3,[]),C=r.useCallback(Z=>{if(v.current&&v.current.readyState===WebSocket.OPEN)try{o&&console.log(`WebSocket sending message with id ${Z.id}:`,Z),Z.id===void 0&&(Z.id=w.current);const g=JSON.stringify(Z);v.current.send(g),o&&console.log("WebSocket sent message:",Z)}catch(g){o&&console.error(`WebSocket error sending message: ${g}`)}else o&&console.error("WebSocket message not sent, WebSocket not connected:",Z)},[]),k=r.useCallback((Z,g)=>{h(be=>[...be,{level:Z,time:"",name:"",message:g}])},[]),A=r.useCallback((Z,g)=>{d(Z),a(g),k("WebSocket",`Filtering by log level "${Z}" and log search "${g}"`)},[k]),ee=r.useCallback((Z,g)=>{o&&console.log(`WebSocket addListener id ${g}:`,Z),(g==null||isNaN(g)||g===0)&&console.error("WebSocket addListener called without id, listener not added:",Z),O.current=[...O.current,{listener:Z,id:g}],o&&console.log("WebSocket addListener total listeners:",O.current.length)},[]),ce=r.useCallback(Z=>{o&&console.log("WebSocket removeListener:",Z),O.current=O.current.filter(g=>g.listener!==Z),o&&console.log("WebSocket removeListener total listeners:",O.current.length)},[]),le=r.useCallback(()=>{Y===""||Y===null||Y===void 0||(k("WebSocket",`Connecting to WebSocket: ${Y}`),v.current=new WebSocket(Y),v.current.onmessage=Z=>{b||y(!0),ue.current+=1;try{const g=JSON.parse(Z.data);if(g.id===void 0||g.src===void 0||g.dst===void 0){o&&console.error("WebSocket undefined message id/src/dst:",g);return}if(g.src!=="Matterbridge"||g.dst!=="Frontend"){o&&console.error("WebSocket invalid message src/dst:",g);return}if(g.error){o&&console.error("WebSocket error message response:",g);return}if(g.id===w.current&&g.method==="pong"&&g.response==="pong"){o&&console.log(`WebSocket pong response message id ${g.id}:`,g),i.current&&clearTimeout(i.current),i.current=null;return}else if(g.method==="snackbar"&&g.response&&g.response.message){o&&console.log(`WebSocket message id ${g.id} method ${g.method}:`,g),H(g.response.message,g.response.timeout,g.response.severity);return}else if(g.method==="close_snackbar"&&g.response&&g.response.message){o&&console.log(`WebSocket message id ${g.id} method ${g.method}:`,g),D(g.response.message);return}else if(g.method==="log"){if(!g.response||!g.response.level||!g.response.time||!g.response.name||!g.response.message||(g.response.level==="spawn"&&(g.response.name==="Matterbridge:spawn-init"?f(g.response.message):g.response.name==="Matterbridge:spawn-exit-success"?x():g.response.name==="Matterbridge:spawn-exit-error"?W():F(g.response.message+`
`)),["debug","info","notice","warn","error","fatal"].includes(g.response.level)&&(u.current==="info"&&g.response.level==="debug"||u.current==="notice"&&(g.response.level==="debug"||g.response.level==="info")||u.current==="warn"&&(g.response.level==="debug"||g.response.level==="info"||g.response.level==="notice")||u.current==="error"&&(g.response.level==="debug"||g.response.level==="info"||g.response.level==="notice"||g.response.level==="warn")||u.current==="fatal"&&(g.response.level==="debug"||g.response.level==="info"||g.response.level==="notice"||g.response.level==="warn"||g.response.level==="error")))||T.current!=="*"&&T.current!==""&&!g.response.message.toLowerCase().includes(T.current.toLowerCase())&&!g.response.name.toLowerCase().includes(T.current.toLowerCase())||g.response.name==="Commissioning"&&g.response.message.includes("is uncommissioned"))return;h(ye=>{const he=[...ye,{level:g.response.level,time:g.response.time,name:g.response.name,message:g.response.message}];return he.length>t*2?he.slice(t):he})}else{if(o&&console.log(`WebSocket received message id ${g.id} method ${g.method}:`,g),g.id===0)O.current.forEach(be=>be.listener(g));else{const be=O.current.find(ye=>ye.id===g.id);be?be.listener(g):o&&console.debug(`WebSocket no listener found for message id ${g.id}:`,g)}return}}catch(g){console.error(`WebSocketUse error parsing message: ${g}`)}},v.current.onopen=()=>{o&&console.log(`WebSocket: Connected to WebSocket: ${Y}`),k("WebSocket",`Connected to WebSocket: ${Y}`),y(!0),z(),E.current=1,c.current=setTimeout(()=>{l.current=setInterval(()=>{C({id:w.current,method:"ping",src:"Frontend",dst:"Matterbridge",params:{}}),i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{o&&console.error(`WebSocketUse: No pong response received from WebSocket: ${Y}`),k("WebSocket",`No pong response received from WebSocket: ${Y}`),y(!1)},1e3*$)},1e3*oe)},1e3*Q)},v.current.onclose=()=>{o&&console.error(`WebSocket: Disconnected from WebSocket ${ve?"with Ingress":""}: ${Y}`),k("WebSocket",`Disconnected from WebSocket: ${Y}`),y(!1),z(),V(),c.current&&clearTimeout(c.current),i.current&&clearTimeout(i.current),l.current&&clearInterval(l.current),k("WebSocket",`Reconnecting (attempt ${E.current} of ${U}) to WebSocket${ve?" (Ingress)":""}: ${Y}`),ve?setTimeout(de,5e3):E.current===1?de():E.current<U?setTimeout(de,1e3*E.current):k("WebSocket",`Reconnect attempts exceeded limit of ${U} retries, refresh the page to reconnect to: ${Y}`),E.current=E.current+1},v.current.onerror=Z=>{o&&console.error(`WebSocket: WebSocket error connecting to ${Y}:`,Z),k("WebSocket",`WebSocket error connecting to ${Y}`)})},[Y]),de=r.useCallback(()=>{o&&console.log(`WebSocket attemptReconnect ${E.current}/${U} to:`,Y),le()},[le]);r.useEffect(()=>(le(),()=>{v.current&&v.current.readyState===WebSocket.OPEN&&v.current.close()}),[le]);const _=r.useMemo(()=>({messages:m,maxMessages:t,autoScroll:L,setMessages:h,setLogFilters:A,setMaxMessages:S,setAutoScroll:j}),[m,h,A]),se=r.useMemo(()=>({maxMessages:t,autoScroll:L,logFilterLevel:p,logFilterSearch:s,setMessages:h,setLogFilters:A,setMaxMessages:S,setAutoScroll:j,online:b,retry:E.current,getUniqueId:N,addListener:ee,removeListener:ce,sendMessage:C,logMessage:k}),[t,L,h,A,S,j,b,E.current,ee,ce,C,k]);return e.jsx(Xt.Provider,{value:_,children:e.jsx(xe.Provider,{value:se,children:n})})}function Ko(n){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 296.2 296.2",...n,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"lg1",x1:"16.6",y1:"16.6",x2:"279.6",y2:"279.6",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{offset:"0",stopColor:"#00b48d"}),e.jsx("stop",{offset:".1",stopColor:"#3faa77"}),e.jsx("stop",{offset:".3",stopColor:"#234148"}),e.jsx("stop",{offset:".7",stopColor:"#203b44"}),e.jsx("stop",{offset:".9",stopColor:"#ad2e6e"}),e.jsx("stop",{offset:"1",stopColor:"#c81b74"})]}),e.jsxs("linearGradient",{id:"lg2",x1:"31.1",y1:"31.1",x2:"265.1",y2:"265.1",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{offset:"0",stopColor:"#00b48d"}),e.jsx("stop",{offset:".2",stopColor:"#285251"}),e.jsx("stop",{offset:".4",stopColor:"#234148"}),e.jsx("stop",{offset:".8",stopColor:"#203b44"}),e.jsx("stop",{offset:".9",stopColor:"#a8316c"}),e.jsx("stop",{offset:"1",stopColor:"#c81b74"})]}),e.jsxs("linearGradient",{id:"lg3",x1:"116.2",y1:"143.9",x2:"139.8",y2:"143.9",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{offset:"0",stopColor:"#8bc751"}),e.jsx("stop",{offset:"1",stopColor:"#0db14b"})]}),e.jsx("linearGradient",{id:"lg4",x1:"136.1",y1:"100.8",x2:"159.6",y2:"100.8",xlinkHref:"#lg3"}),e.jsx("linearGradient",{id:"lg5",x1:"155.3",y1:"143.9",x2:"178.9",y2:"143.9",xlinkHref:"#lg3"}),e.jsxs("linearGradient",{id:"lg6",x1:"46.8",y1:"25.7",x2:"89.6",y2:"74.8",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{offset:"0",stopColor:"#b1d34a"}),e.jsx("stop",{offset:"1",stopColor:"#50b848"})]})]}),e.jsx("rect",{width:"296.2",height:"296.2",rx:"56.7",ry:"56.7",style:{fill:"url(#lg1)"}}),e.jsx("rect",{x:"16.3",y:"16.3",width:"263.6",height:"263.6",rx:"50.5",ry:"50.5",style:{fill:"url(#lg2)"}}),e.jsx("circle",{cx:"128",cy:"143.9",r:"11.8",style:{fill:"url(#lg3)"}}),e.jsx("circle",{cx:"147.8",cy:"100.8",r:"11.8",style:{fill:"url(#lg4)"}}),e.jsx("path",{d:"m244.6 114.5.4-.5L160 33a17 17 0 0 0-24.7-.5l-86.4 83.3a15 15 0 0 0 9.2 26.9h19.3v-4.7l-13.7-12.7v-.1l83.7-80.8 84.2 81-13.9 12.8v4.5h19.5a15 15 0 0 0 7.4-28.1Z",style:{fill:"url(#lg3)"}}),e.jsx("circle",{cx:"167.1",cy:"143.9",r:"11.8",style:{fill:"url(#lg5)"}}),e.jsx("path",{fill:"#fff",d:"M219 89.3V35.5a10.5 10.5 0 1 0-21 0v33.7l21 20Z"}),e.jsx("path",{d:"M91.4 73.3H83a37 37 0 0 0-14.5-28.4L65 50.2c.1 0 12.6 9 11.7 25.4-5.3-.4-11.2-1.9-16.3-5.3-11.8-7.8-16-23.7-11.9-46 8.7 1.5 34 7 43 22.8 4.1 7.3 4.1 16.1 0 26.2Z",style:{fill:"url(#lg6)"}}),e.jsx("path",{d:"M65.9 80a49.6 49.6 0 0 0 17.8 2.2l16.6-16c1.6-8.3.5-15.7-3.3-22.4C84.6 22 47.8 17.5 46.2 17.4l-3-.4-.6 3c-3.8 18.4-5.9 50.6 23.2 60ZM48.4 24.4c8.7 1.5 34 7 43 22.8 4.1 7.3 4.1 16.1 0 26.2H83a37 37 0 0 0-14.5-28.4l-3.7 5.3c.1 0 12.6 9 11.7 25.4-5.3-.4-11.2-1.9-16.3-5.3-11.9-7.8-16-23.7-11.9-46Z",fill:"#1e5857"}),e.jsx("path",{fill:"#fff",d:"M250.5 90.5a17.4 17.4 0 1 1 0-34.8 17.4 17.4 0 0 1 0 34.8Zm0-22.7a5.4 5.4 0 0 0 0 10.7 5.3 5.3 0 0 0 0-10.7ZM258.8 148.2a15.9 15.9 0 0 0-9.6 28.5c-.8 4.2-5.4 4.6-5.4 4.6h-26v-43l13.6-13-1.8-2-82.2-79-81.2 78.3-2.5 2.6 13.7 13v42.9H53a21.5 21.5 0 1 0 11.7 15h12.6v18.8c0 7.8 6.4 14.1 14.1 14.1h29.3v14.8H64a10.6 10.6 0 0 0-17.7 8 10.6 10.6 0 0 0 17.6 8h157.6a16.3 16.3 0 1 0 0-16h-84.8V229h66.8c7.8 0 14.2-6.3 14.2-14.1v-19.2h27.6c14.3 0 17.8-12.8 18.5-16.6a15.9 15.9 0 0 0-5-30.9ZM43.7 210.8a10.3 10.3 0 1 1 0-20.6 10.3 10.3 0 0 1 0 20.6Zm192 36a5 5 0 1 1 0 10 5 5 0 0 1 0-10Zm-77-34.8h-22v-34h22v34Zm8.4-79.8c2.7 0 5.2 1 7.2 2.5v-10.4L188 137s2.6 1.3 4.6 1.3h6.7v68c0 3.2-2.6 5.7-5.7 5.7h-19v-34h1.4a7.5 7.5 0 0 0 0-15H120a7.5 7.5 0 0 0 0 15h.7v34h-19.3a5.7 5.7 0 0 1-5.7-5.6v-68.1h6.7c2 0 4.6-1.3 4.6-1.3l13.7-12.7v10.4a11.7 11.7 0 0 1 16 1.6v-13a14.9 14.9 0 0 0-25-10.8s-.1.2-.1.2l-.5.5-6.9 7H92.5l55-53.2 55.1 53.2h-11.8l-7-7c0-.2-.2-.3-.4-.5l-.2-.2a14.8 14.8 0 0 0-25 10.9v12.9c2.2-2.5 5.3-4.1 8.9-4.1Zm91.7 36.7a4.9 4.9 0 1 1 0-9.7 4.9 4.9 0 0 1 0 9.7Z"})]})}function ke(){const{retry:n}=r.useContext(xe),p=()=>{window.location.reload()};return e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",fontSize:"20px",flexDirection:"column",color:"var(--main-text-color)",height:"100vh",backgroundColor:"var(--main-bg-color)"},children:e.jsxs(X,{sx:{display:"flex",alignItems:"center",flexDirection:"column"},children:[e.jsx(Ko,{style:{height:"128px",width:"128px",margin:"10px",marginBottom:"20px"}}),n<100?e.jsxs(e.Fragment,{children:[e.jsx(Cr,{style:{color:"var(--primary-color)"}}),e.jsx("div",{style:{marginTop:"20px",color:"var(--primary-color)",textAlign:"center"},children:e.jsxs("span",{children:["Reconnecting to Matterbridge ","(attempt "+n+")","..."]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginTop:"20px",color:"var(--primary-color)",textAlign:"center"},children:[e.jsx("span",{children:"Unable to connect to Matterbridge after multiple attempts."}),e.jsx("br",{}),e.jsx("span",{children:"Please check your network connection."}),e.jsx("br",{})]}),e.jsx(ie,{variant:"contained",color:"primary",onClick:p,style:{marginTop:"20px"},children:"Refresh the Page"})]})]})})}function Jo({value:n,maxChars:p}){let d=n;if(n.length>p&&p>3){const s=p-3,a=n.substring(0,Math.ceil(s/2)),m=n.substring(n.length-Math.floor(s/2),n.length);d=`${a} â€¦ ${m}`}return n!==d?e.jsx(R,{title:n,placement:"top",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[0,12]}}]}},children:e.jsx("span",{children:d})}):e.jsx("span",{children:d})}function Ve({children:n,style:p}){const d={display:"flex",flexDirection:"column",flex:"0 0 auto",width:"100%",overflow:"hidden",margin:"0px",padding:"0px",gap:"0px",backgroundColor:"var(--div-bg-color)",boxShadow:"5px 5px 10px var(--div-shadow-color)",border:"1px solid var(--table-border-color)",borderRadius:"var(--div-border-radius)",boxSizing:"border-box"};return e.jsx("div",{style:{...d,...p},children:n})}function Zo({systemInfo:n,compact:p}){const{addListener:d,removeListener:s,getUniqueId:a}=r.useContext(xe),[m,h]=r.useState(n),t=r.useRef(a());if(o&&console.log("SystemInfoTable loading with systemInfo:",m,"compact:",p),n&&p&&m.totalMemory&&m.freeMemory){const b=m.totalMemory,y=m.freeMemory;m.freeMemory=`${y} / ${b}`,m.totalMemory=""}if(n&&p&&m.heapTotal&&m.heapUsed){const b=m.heapTotal,y=m.heapUsed;m.heapUsed=`${y} / ${b}`,m.heapTotal=""}if(n&&p&&m.osRelease&&m.osType){const b=m.osType,y=m.osRelease;m.osType=`${b} (${y})`,m.osRelease=""}if(n&&p&&m.osArch&&m.osPlatform){const b=m.osPlatform,y=m.osArch;m.osPlatform=`${b} (${y})`,m.osArch=""}const S=(b,y,H,D,z)=>{h(f=>({...f,totalMemory:b,freeMemory:y,heapTotal:H,heapUsed:D,rss:z}))},L=b=>{h(y=>({...y,cpuUsage:b.toFixed(2)+" %"}))},j=(b,y)=>{h(H=>({...H,systemUptime:b,processUptime:y}))};return r.useEffect(()=>{const b=y=>{y.method==="memory_update"&&y.response&&y.response.totalMemory&&y.response.freeMemory&&y.response.heapTotal&&y.response.heapUsed&&y.response.rss?(o&&console.log("SystemInfoTable received memory_update",y),S(y.response.totalMemory,y.response.freeMemory,y.response.heapTotal,y.response.heapUsed,y.response.rss)):y.method==="cpu_update"&&y.response&&y.response.cpuUsage?(o&&console.log("SystemInfoTable received cpu_update",y),L(y.response.cpuUsage)):y.method==="uptime_update"&&y.response&&y.response.systemUptime&&y.response.processUptime&&(o&&console.log("SystemInfoTable received uptime_update",y),j(y.response.systemUptime,y.response.processUptime))};return d(b,t.current),o&&console.log(`SystemInfoTable added WebSocket listener id ${t.current}`),()=>{s(b),o&&console.log("SystemInfoTable removed WebSocket listener")}},[d,s]),m?(o&&console.log("SystemInfoTable rendering..."),e.jsxs(Ve,{style:{width:"302px",minWidth:"302px"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"System Information"})}),e.jsx("div",{className:"MbfWindowDivTable",children:e.jsx("table",{style:{border:"none",borderCollapse:"collapse"},children:e.jsx("tbody",{style:{border:"none",borderCollapse:"collapse"},children:Object.entries(m).filter(([b,y])=>y!==void 0&&y!=="").map(([b,y],H)=>e.jsxs("tr",{className:H%2===0?"table-content-even":"table-content-odd",style:{border:"none",borderCollapse:"collapse"},children:[e.jsx("td",{style:{border:"none",borderCollapse:"collapse"},children:b}),e.jsx("td",{style:{border:"none",borderCollapse:"collapse"},children:e.jsx(Jo,{value:typeof y!="string"?y.toString():y,maxChars:24})})]},b))})})})]})):null}const Yo=r.memo(Zo),_t={margin:"0px",padding:"0px",color:"var(--div-text-color)",transition:"color 0.2s ease","& svg":{display:"block"},"& svg path":{fill:"var(--div-text-color)",transition:"fill 0.2s ease"},"&:hover":{color:"var(--primary-color)"},"&:hover svg path":{fill:"var(--primary-color)"},"&:focus-visible":{outline:"2px solid var(--primary-color)",outlineOffset:"2px"}},Xo=n=>{if(!n)return"";const p=n.toString().replace(/[^0-9]/g,"");if(p.length<5)return p;const d=p.slice(0,4),s=p.slice(4,7),a=p.slice(7,11);return[d,s,a].filter(Boolean).join("-")};function en({id:n}){const{online:p,sendMessage:d,addListener:s,removeListener:a,getUniqueId:m}=r.useContext(xe),[h,t]=r.useState(null),S=r.useRef(null),L=r.useRef(null),j=r.useRef(m()),{showConfirmCancelDialog:b}=r.useContext(Ge);o&&console.log(`QRDiv loading with id = "${n}" storeId = "${S.current}" timeout = ${L.current} and  matter:`,h),r.useEffect(()=>{o&&console.log(`QRDiv id effect "${n}"`),S.current=n,L.current&&clearTimeout(L.current),L.current=null,n?(o&&console.log(`QRDiv id effect sending data request for storeId "${n}"`),d({id:j.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:n,server:!0}})):(o&&console.log("QRDiv id effect setting matter to null"),t(null))},[n,d]),r.useEffect(()=>{const V=x=>{x.method==="refresh_required"&&x.response.changed==="matter"&&x.response.matter&&(o&&console.log(`QRDiv received refresh_required: changed=${x.response.changed} for storeId "${x.response.matter.id}":`,x.response.matter),S.current===x.response.matter.id&&(o&&console.log(`QRDiv received refresh_required/matter: setting matter data for storeId "${x.response.matter.id}":`,x.response.matter),L.current&&clearTimeout(L.current),x.response.matter.advertising&&x.response.matter.advertiseTime&&x.response.matter.advertiseTime+9e5<=Date.now()&&(x.response.matter.advertising=!1),t(x.response.matter),x.response.matter.advertising&&(o&&console.log(`QRDiv setting matter advertise timeout for storeId "${x.response.matter.id}":`,x.response.matter.advertiseTime+9e5-Date.now()),L.current=setTimeout(()=>{L.current&&clearTimeout(L.current),o&&console.log(`QRDiv clearing advertising state for storeId "${S.current}" after 15 minutes`),t(W=>W&&{...W,advertising:!1})},x.response.matter.advertiseTime+9e5-Date.now()))))};return s(V,j.current),o&&console.log("QRDiv webSocket effect mounted"),()=>{a(V),L.current&&clearTimeout(L.current),L.current=null,o&&console.log("QRDiv webSocket effect unmounted")}},[s,a]);const y=()=>{o&&console.log(`QRDiv sent matter startCommission for node "${h?.id}"`),h&&d({id:j.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:h.id,startCommission:!0}})},H=()=>{o&&console.log(`QRDiv sent matter stopCommission for node "${h?.id}"`),h&&d({id:j.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:h.id,stopCommission:!0}})},D=()=>{o&&console.log(`QRDiv sent matter advertise for node "${h?.id}"`),h&&d({id:j.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:h.id,advertise:!0}})},z=V=>{o&&console.log(`QRDiv sent matter removeFabric for node "${h?.id}" and fabricIndex ${V}`),h&&d({id:j.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:h.id,removeFabric:V}})},f=async()=>{if(!h||!h.manualPairingCode)return;const V=h.manualPairingCode.toString();try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(V);else{const x=document.createElement("textarea");x.value=V,x.style.position="fixed",x.style.opacity="0",document.body.appendChild(x),x.focus(),x.select(),document.execCommand("copy"),document.body.removeChild(x)}o&&console.log("Manual pairing code copied to clipboard")}catch(x){console.error("Failed to copy manual pairing code",x)}};return!h||!p?(o&&console.log("QRDiv rendering undefined state"),null):h.online?h.advertising&&h.qrPairingCode&&h.manualPairingCode?(o&&console.log("QRDiv rendering advertising state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"QR pairing code"}),e.jsxs("div",{className:"MbfWindowHeaderFooterIcons",children:[e.jsx(K,{"aria-label":"send advertising",size:"small",onClick:D,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(R,{title:"Send again the mDNS advertisement",arrow:!0,children:e.jsx(ne,{path:Ot,size:"22px"})})}),e.jsx(K,{"aria-label":"stop pairing",size:"small",onClick:H,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(R,{title:"Turn off pairing",arrow:!0,children:e.jsx(ne,{path:go,size:"22px"})})})]})]}),e.jsx("p",{className:"MbfWindowHeaderText",style:{maxWidth:"280px",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:S.current}),e.jsx(uo,{value:h.qrPairingCode,size:256,level:"M",fgColor:"var(--div-text-color)",bgColor:"var(--div-bg-color)",style:{margin:"20px"}}),e.jsxs("div",{className:"MbfWindowFooter",style:{justifyContent:"space-between"},children:[e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Manual pairing code: ",Xo(h.manualPairingCode)]}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(R,{title:"Copy manual pairing code",arrow:!0,children:e.jsx(K,{"aria-label":"copy manual pairing code",size:"small",onClick:f,sx:_t,children:e.jsx(ne,{path:mo,size:.85})})})})]})]})):h.commissioned&&h.fabricInformations&&h.sessionInformations?(o&&console.log("QRDiv rendering commissioned state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px",overflow:"hidden"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Paired fabrics"}),e.jsxs("div",{className:"MbfWindowHeaderFooterIcons",children:[e.jsx(K,{"aria-label":"send advertising",size:"small",onClick:D,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(R,{title:"Send again the mDNS advertisement",arrow:!0,children:e.jsx(ne,{path:Ot,size:"22px"})})}),e.jsx(K,{"aria-label":"start pairing",size:"small",onClick:y,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(R,{title:"Turn on pairing",arrow:!0,children:e.jsx(ne,{path:Vt,size:"22px"})})})]})]}),e.jsxs("div",{className:"MbfWindowBodyColumn",style:{paddingTop:"0px"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{maxWidth:"280px",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:S.current}),h.fabricInformations.map((V,x)=>e.jsxs("div",{style:{margin:"0px",padding:"10px",gap:"0px",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",textAlign:"left",fontSize:"14px"},children:[e.jsxs("div",{style:{marginLeft:"20px",marginBottom:"10px",display:"flex",flexDirection:"row",justifyContent:"space-between",gap:"20px",alignItems:"center"},children:[e.jsxs("p",{className:"status-blue",style:{margin:"0px",padding:"3px 10px",width:"200px",fontSize:"14px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},children:["Fabric: ",V.fabricIndex]}),e.jsx(R,{title:"Remove the fabric. You will also need to remove it from the controller.",arrow:!0,children:e.jsx(K,{"aria-label":"remove the fabric",size:"small",onClick:()=>b("Remove fabric","Are you sure you want to remove this fabric? You will also need to remove it from the controller.","RemoveFabric",()=>z(V.fabricIndex),()=>{}),sx:{..._t,padding:"2px"},children:e.jsx(ne,{path:ho,size:1})})})]}),e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Vendor: ",V.rootVendorId," ",V.rootVendorName]}),V.label!==""&&e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Label: ",V.label]}),e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Sessions: ",h.sessionInformations?h.sessionInformations.filter(W=>W.fabric?.fabricIndex===V.fabricIndex&&W.isPeerActive===!0).length:"0"," ","subscriptions: ",h.sessionInformations?h.sessionInformations.filter(W=>W.fabric?.fabricIndex===V.fabricIndex&&W.isPeerActive===!0&&W.numberOfActiveSubscriptions>0).length:"0"]})]},x))]}),e.jsx("div",{className:"MbfWindowFooter",children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Serial number: ",h.serialNumber]})})]})):!h.commissioned&&!h.advertising?(o&&console.log("QRDiv rendering not commissioned and not advertising state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px"},children:[e.jsx("div",{className:"MbfWindowHeader",style:{height:"30px"},children:e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"QR pairing code"})}),e.jsx("p",{className:"MbfWindowHeaderText",style:{maxWidth:"280px",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:S.current}),e.jsx(ie,{onClick:y,endIcon:e.jsx(ne,{path:Vt,size:1}),style:{margin:"20px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:"Turn on pairing"}),e.jsx("div",{className:"MbfWindowFooter",children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Serial number: ",h.serialNumber]})})]})):(o&&console.log("QRDiv rendering unknown state"),null):(o&&console.log("QRDiv rendering offline state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Server node"}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons"})]}),e.jsx("p",{className:"MbfWindowHeaderText",style:{maxWidth:"280px",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:S.current}),e.jsx("p",{style:{textAlign:"center",fontSize:"14px",fontWeight:"normal"},children:"Server offline"}),e.jsx("div",{className:"MbfWindowFooter",children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Serial number: ",h.serialNumber]})})]}))}const tn=r.memo(en);function rn(){const{logMessage:n,sendMessage:p,getUniqueId:d}=r.useContext(xe),[s,a]=r.useState("matterbridge-"),[m,h]=r.useState(!1),[t,S]=r.useState(null),L=r.useRef(d()),j=W=>{W.preventDefault(),h(!0)},b=()=>{h(!1)},y=W=>{W.preventDefault(),h(!1);const F=W.dataTransfer.files[0];if(F){n("Plugins",`Installing package ${F.name}. Please wait...`);const O=new FormData;O.append("file",F),O.append("filename",F.name),fetch("./api/uploadpackage",{method:"POST",body:O}).then(v=>v.text()).then(v=>{n("Plugins",`Server response: ${v}`)}).catch(v=>{console.error("Error uploading plugin file:",v),n("Plugins",`Error installing package ${v}`)})}},H=W=>{const F=W.target.files&&W.target.files[0];if(F){n("Plugins",`Uploading package ${F.name}`);const O=new FormData;O.append("file",F),O.append("filename",F.name),fetch("./api/uploadpackage",{method:"POST",body:O}).then(v=>v.text()).then(v=>{n("Plugins",`Server response: ${v}`)}).catch(v=>{console.error("Error uploading plugin file:",v),n("Plugins",`Error uploading package ${v}`)})}},D=()=>{p({id:L.current,sender:"InstallPlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:s,restart:!1}})},z=()=>{document.getElementById("file-upload")?.click()},f=()=>{p({id:L.current,sender:"InstallPlugins",method:"/api/addplugin",src:"Frontend",dst:"Matterbridge",params:{pluginNameOrPath:s}})},V=W=>{S(W.currentTarget)},x=W=>{W!==""&&a(W),S(null)};return o&&console.log("HomeInstallAddPlugins rendering..."),e.jsxs(Ve,{children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Install plugins"})}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",flex:"1 1 auto",alignItems:"center",justifyContent:"space-between",margin:"0px",padding:"10px",gap:"20px"},onDragOver:j,onDragLeave:b,onDrop:y,children:[e.jsx(me,{value:s,onChange:W=>{a(W.target.value)},size:"small",id:"plugin-name",label:"Plugin name or plugin path",variant:"outlined",fullWidth:!0}),e.jsx(K,{onClick:V,children:e.jsx(Sr,{})}),e.jsxs(Ue,{id:"simple-menu",anchorEl:t,keepMounted:!0,open:!!t,onClose:()=>x(""),children:[e.jsx(I,{onClick:()=>x("matterbridge-zigbee2mqtt"),children:"matterbridge-zigbee2mqtt"}),e.jsx(I,{onClick:()=>x("matterbridge-somfy-tahoma"),children:"matterbridge-somfy-tahoma"}),e.jsx(I,{onClick:()=>x("matterbridge-shelly"),children:"matterbridge-shelly"}),e.jsx(I,{onClick:()=>x("matterbridge-hass"),children:"matterbridge-hass"}),e.jsx(I,{onClick:()=>x("matterbridge-webhooks"),children:"matterbridge-webhooks"}),e.jsx(I,{onClick:()=>x("matterbridge-bthome"),children:"matterbridge-bthome"}),e.jsx(I,{onClick:()=>x("matterbridge-test"),children:"matterbridge-test"}),e.jsx(I,{onClick:()=>x("matterbridge-example-accessory-platform"),children:"matterbridge-example-accessory-platform"}),e.jsx(I,{onClick:()=>x("matterbridge-example-dynamic-platform"),children:"matterbridge-example-dynamic-platform"}),e.jsx(I,{onClick:()=>x("matterbridge-eve-door"),children:"matterbridge-eve-door"}),e.jsx(I,{onClick:()=>x("matterbridge-eve-motion"),children:"matterbridge-eve-motion"}),e.jsx(I,{onClick:()=>x("matterbridge-eve-energy"),children:"matterbridge-eve-energy"}),e.jsx(I,{onClick:()=>x("matterbridge-eve-weather"),children:"matterbridge-eve-weather"}),e.jsx(I,{onClick:()=>x("matterbridge-eve-room"),children:"matterbridge-eve-room"})]}),e.jsx(R,{title:"Install or update a plugin from npm",children:e.jsx(ie,{onClick:D,endIcon:e.jsx(Ie,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Install"})}),e.jsx(R,{title:"Upload and install a plugin from a tarball",children:e.jsx(ie,{onClick:z,endIcon:e.jsx(Mr,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Upload"})}),e.jsx(R,{title:"Add an installed plugin",children:e.jsx(ie,{onClick:f,endIcon:e.jsx(ut,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Add"})}),e.jsx("input",{id:"file-upload",type:"file",accept:".tgz",style:{display:"none"},onChange:H})]})]})}const on=r.memo(rn);function _e({status:n,enabledText:p="Enabled",disabledText:d=void 0,tooltipText:s=void 0,onClick:a}){if(n===void 0)return null;{const m=e.jsx("div",{className:n?"status-enabled":"status-disabled",style:{cursor:"default"},onClick:a,children:n?p:d??p});return s!==void 0?e.jsx(R,{title:s,children:m}):m}}function zt(n){return n.id!==0&&n.src==="Matterbridge"&&n.dst==="Frontend"}const ze={fontSize:"16px",fontWeight:"bold",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},qe={fontSize:"12px",fontWeight:"normal",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},nn={fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)",backgroundColor:"var(--div-bg-color)"},sn={fontSize:"16px",fontWeight:"bold",backgroundColor:"var(--div-bg-color)"},$e={padding:"0px",margin:"0px"},an="5px 10px 5px 10px",lt={},je={},dt={},ct={};let Be=[],jt=[];const ln=({open:n,onClose:p,plugin:d})=>{const{sendMessage:s,addListener:a,removeListener:m,getUniqueId:h}=r.useContext(xe),t=r.useRef(h()),[S,L]=r.useState(d.configJson),[j,b]=r.useState(null),[y,H]=r.useState({"ui:submitButtonOptions":{submitText:"Confirm"},"ui:globalOptions":{orderable:!0}}),[D,z]=r.useState("");let f={};r.useEffect(()=>{const N=C=>{C.src==="Matterbridge"&&C.dst==="Frontend"&&(zt(C)&&C.id===t.current&&C.method==="/api/select/devices"&&C.response&&(o&&console.log(`ConfigPluginDialog (id: ${C.id}) received ${C.response.length} /api/select/devices:`,C.response),Be=C.response),zt(C)&&C.id===t.current&&C.method==="/api/select/entities"&&C.response&&(o&&console.log(`ConfigPluginDialog (id: ${C.id}) received ${C.response.length} /api/select/entities:`,C.response),jt=C.response))};return a(N,t.current),o&&console.log("ConfigPluginDialog added WebSocket listener id:",t.current),S&&j&&j.properties&&(Object.keys(j.properties).forEach(C=>{Object.keys(j.properties[C]).forEach(k=>{k.startsWith("ui:")&&(y[C]={},y[C][k]=j.properties[C][k],delete j.properties[C][k])})}),H(y)),d.name&&d.configJson&&d.schemaJson&&(L(d.configJson),b(d.schemaJson),s({id:t.current,sender:"ConfigPlugin",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:d.name}}),s({id:t.current,sender:"ConfigPlugin",method:"/api/select/entities",src:"Frontend",dst:"Matterbridge",params:{plugin:d.name}}),o&&console.log('HomePlugins sent "/api/select/devices" and "/api/select/entities" for plugin:',d.name)),()=>{m(N),o&&console.log("ConfigPluginDialog removed WebSocket listener")}},[a,S,d,m,j,s,y]);const V=(N,C)=>{f=N.formData},x=N=>{o&&console.log("ConfigPluginDialog handleSaveChanges:",N.formData),L(N.formData),d.configJson=N.formData,d.restartRequired=!0,s({id:t.current,sender:"ConfigPlugin",method:"/api/savepluginconfig",src:"Frontend",dst:"Matterbridge",params:{pluginName:N.formData.name,formData:N.formData}}),p()};function W(N){const{id:C,label:k,onKeyChange:A,onDropPropertyClick:ee,disabled:ce,schema:le,children:de,registry:_,readonly:se,required:Z}=N,{templates:g}=_,{RemoveButton:be}=g.ButtonTemplates;if(!(qo in le))return e.jsx(X,{sx:{display:"flex",flexDirection:"column",flexGrow:1,padding:0,margin:0,border:"none"},children:de});const he=({target:J})=>A(J&&J.value);return e.jsxs(X,{sx:{display:"flex",flexDirection:"row",flexGrow:1,padding:0,margin:0,border:"none"},children:[e.jsx(me,{id:`${C}-key`,name:`${C}-key`,required:Z,disabled:ce||se,defaultValue:k,onBlur:se?void 0:he,type:"text",variant:"outlined",sx:{width:"250px",minWidth:"250px",maxWidth:"250px",marginRight:"20px"}}),e.jsx(X,{sx:{flex:1},children:de}),e.jsx(be,{disabled:ce||se,onClick:ee(k),registry:_})]})}function F(N){const{children:C,description:k,displayLabel:A,errors:ee,help:ce,hidden:le,registry:de,uiSchema:_}=N,se=_o(_),Z=zo("WrapIfAdditionalTemplate",de,se);return le?e.jsx("div",{style:{display:"none"},children:C}):e.jsx(X,{sx:{display:"flex",flexDirection:"column",flexGrow:1,padding:0,margin:0,border:"none"},children:e.jsxs(Z,{...N,children:[A===!0&&k,C,ee,ce]})})}function O(N){const{description:C}=N;return C?e.jsx(ae,{sx:qe,children:C}):null}function v(N){const{required:C,title:k}=N;return k?e.jsx(X,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:e.jsxs(ae,{sx:ze,children:["Title ",k," ",C&&e.jsx("mark",{children:"***"})]})}):null}function E(N){const{help:C}=N;return C?e.jsx(X,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:e.jsx(ae,{sx:nn,children:C})}):null}function w(N){const{errors:C}=N;return C?e.jsxs(X,{sx:{padding:"10px",margin:"10px",border:"1px solid grey"},children:[e.jsx(ae,{color:"error",sx:sn,children:"Please fix the following errors:"}),e.jsx(Ze,{children:C.map((k,A)=>e.jsxs(kr,{children:[e.jsx(B,{children:e.jsx(Ir,{color:"error"})}),e.jsx(re,{primary:k.stack})]},A))})]}):null}function l(N){const{errors:C}=N;return C?e.jsx(X,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:C.map((k,A)=>e.jsxs(ae,{color:"error",variant:"body2",sx:{marginLeft:1},children:["This field ",k]},A))}):null}function i(N){const{id:C,name:k,_schema:A,_uiSchema:ee,value:ce,options:le,label:de,type:_,placeholder:se,required:Z,disabled:g,readonly:be,autofocus:ye,onChange:he,onChangeOverride:J,onBlur:ge,onFocus:we,_rawErrors:Ke,_hideError:G,_registry:M,_formContext:fe}=N,Je=({target:{value:Me}})=>he(Me===""?le.emptyValue:Me),Le=({target:Me})=>ge(C,Me&&Me.value),Xe=({target:Me})=>we(C,Me&&Me.value);return e.jsx(X,{sx:{padding:"0px",margin:"0px"},children:e.jsx(me,{id:C,name:C,label:se&&se!==""?de:void 0,variant:"outlined",placeholder:se&&se!==""?se:de,required:Z,disabled:g||be,autoFocus:ye,value:ce||ce===0?ce:"",type:_,autoComplete:_==="password"?"current-password":k,onChange:J||Je,onBlur:Le,onFocus:Xe,fullWidth:!0})})}function c(N){return console.log("ArrayFieldTitleTemplate:",N),null}function u(N){return console.log("ArrayFieldDescriptionTemplate:",N),null}function T(N){return console.log("ArrayFieldItemTemplate:",N),null}function ue(N){const{canAdd:C,onAddClick:k,schema:A,title:ee}=N,[ce,le]=r.useState(!1),[de,_]=r.useState(!1),[se,Z]=r.useState(!1),[g,be]=r.useState(""),ye=M=>{be(M.target.value)},he=()=>{o&&console.log("ArrayFieldTemplate: handleDialogDeviceToggle filter:",g,"selectDevices:",Be),le(!ce)},J=()=>{o&&console.log("ArrayFieldTemplate: handleDialogEntityToggle filter:",g,"selectEntities:",jt),_(!de)},ge=()=>{o&&console.log("ArrayFieldTemplate: handleDialogDeviceEntityToggle filter:",g,"selectDevices:",Be),Z(!se)},we=M=>{le(!1),A.selectFrom==="serial"?A.items.default=M.serial:A.selectFrom==="name"&&(A.items.default=M.name),k()},Ke=M=>{_(!1),A.selectEntityFrom==="name"?A.items.default=M.name:A.selectEntityFrom==="description"&&(A.items.default=M.description),k()},G=M=>{Z(!1),A.selectDeviceEntityFrom==="name"?A.items.default=M.name:A.selectDeviceEntityFrom==="description"&&(A.items.default=M.description),k()};return e.jsxs(X,{sx:{margin:"0px",padding:"5px 10px 5px 10px",border:"1px solid grey"},children:[ee&&e.jsxs(X,{sx:{margin:"0px",padding:"0px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[ee&&e.jsx(ae,{sx:ze,children:ee}),C&&e.jsxs(X,{sx:{margin:"0px",padding:"0px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[A.selectFrom&&e.jsx(R,{title:"Add a device from the list",children:e.jsx(K,{onClick:he,size:"small",color:"primary",sx:$e,children:e.jsx(tt,{})})}),A.selectEntityFrom&&e.jsx(R,{title:"Add an entity from the list",children:e.jsx(K,{onClick:J,size:"small",color:"primary",sx:$e,children:e.jsx(tt,{})})}),A.selectDeviceEntityFrom&&e.jsx(R,{title:"Add a device entity from the list",children:e.jsx(K,{onClick:ge,size:"small",color:"primary",sx:$e,children:e.jsx(tt,{})})}),e.jsx(R,{title:"Add a new item",children:e.jsx(K,{onClick:k,size:"small",color:"primary",sx:$e,children:e.jsx(ut,{})})})]})]}),A.description&&e.jsx(ae,{sx:qe,children:A.description}),N.items.map(M=>e.jsxs(X,{sx:{margin:"2px 0px",padding:"0px",display:"flex",alignItems:"center"},children:[e.jsx(X,{sx:{flexGrow:1,marginRight:"10px"},children:M.children}),e.jsx(K,{disabled:!M.hasMoveUp,onClick:M.onReorderClick(M.index,M.index-1),size:"small",color:"primary",sx:$e,children:e.jsx($t,{})}),e.jsx(K,{disabled:!M.hasMoveDown,onClick:M.onReorderClick(M.index,M.index+1),size:"small",color:"primary",sx:$e,children:e.jsx(Wt,{})}),e.jsx(K,{onClick:M.onDropIndexClick(M.index),size:"small",color:"primary",sx:$e,children:e.jsx(ht,{})})]},M.index)),e.jsxs(De,{open:ce,onClose:he,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(Pe,{children:"Select a device"}),e.jsxs(Ne,{children:[e.jsxs(X,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(ae,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(me,{fullWidth:!0,variant:"outlined",value:g,onChange:ye,placeholder:"Enter serial or name"})]}),e.jsx(Ze,{dense:!0,children:Be.filter(M=>M.serial.toLowerCase().includes(g.toLowerCase())||M.name.toLowerCase().includes(g.toLowerCase())).map((M,fe)=>e.jsxs(rt,{onClick:()=>we(M),sx:lt,children:[M.icon==="wifi"&&e.jsx(B,{children:e.jsx(Ye,{style:je})}),M.icon==="ble"&&e.jsx(B,{children:e.jsx(ot,{style:je})}),M.icon==="hub"&&e.jsx(B,{children:e.jsx(nt,{style:je})}),e.jsx(re,{primary:M.name,secondary:M.serial,primaryTypographyProps:{style:dt},secondaryTypographyProps:{style:ct}})]},fe))})]}),e.jsx(He,{children:e.jsx(ie,{onClick:he,children:"Close"})})]}),e.jsxs(De,{open:de,onClose:J,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(Pe,{children:"Select an entity"}),e.jsxs(Ne,{children:[e.jsxs(X,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(ae,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(me,{fullWidth:!0,variant:"outlined",value:g,onChange:ye,placeholder:"Enter name or description"})]}),e.jsx(Ze,{dense:!0,children:jt.filter(M=>M.name.toLowerCase().includes(g.toLowerCase())||M.description.toLowerCase().includes(g.toLowerCase())).map((M,fe)=>e.jsxs(rt,{onClick:()=>Ke(M),sx:lt,children:[M.icon==="wifi"&&e.jsx(B,{children:e.jsx(Ye,{style:je})}),M.icon==="ble"&&e.jsx(B,{children:e.jsx(ot,{style:je})}),M.icon==="hub"&&e.jsx(B,{children:e.jsx(nt,{style:je})}),M.icon==="component"&&e.jsx(B,{children:e.jsx(Lt,{style:je})}),M.icon==="matter"&&e.jsx(B,{children:e.jsx(Ft,{style:je})}),e.jsx(re,{primary:M.name,secondary:M.description,primaryTypographyProps:{style:dt},secondaryTypographyProps:{style:ct}})]},fe))})]}),e.jsx(He,{children:e.jsx(ie,{onClick:J,children:"Close"})})]}),e.jsxs(De,{open:se,onClose:ge,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsxs(Pe,{children:["Select an entity for ",ee]}),e.jsx(Ne,{children:e.jsx(Ze,{dense:!0,children:Be.filter(M=>M.serial===ee||M.name===ee).map(M=>M.entities?.map((fe,Je)=>e.jsxs(rt,{onClick:()=>G(fe),sx:lt,children:[fe.icon==="wifi"&&e.jsx(B,{children:e.jsx(Ye,{style:je})}),fe.icon==="ble"&&e.jsx(B,{children:e.jsx(ot,{style:je})}),fe.icon==="hub"&&e.jsx(B,{children:e.jsx(nt,{style:je})}),fe.icon==="component"&&e.jsx(B,{children:e.jsx(Lt,{style:je})}),fe.icon==="matter"&&e.jsx(B,{children:e.jsx(Ft,{style:je})}),e.jsx(re,{primary:fe.name,secondary:fe.description,primaryTypographyProps:{style:dt},secondaryTypographyProps:{style:ct}})]},Je)))})}),e.jsx(He,{children:e.jsx(ie,{onClick:ge,children:"Close"})})]})]})}function te(N){const{onAddClick:C,schema:k,properties:A,title:ee,description:ce}=N,[le,de]=r.useState(!1),[_,se]=r.useState(""),Z=J=>{se(J.target.value)},g=()=>{de(!le)},be=J=>{o&&console.log(`ObjectFieldTemplate: handleSelectValue value "${J.serial}" for schema "${k.selectFrom}"`),de(!1);let ge="";k.selectFrom==="serial"?ge=J.serial:k.selectFrom==="name"&&(ge=J.name),z(ge),o&&console.log(`ObjectFieldTemplate: handleSelectValue newkey "${ge}"`),C(k)()},ye=()=>{C(k)()},he=!k.additionalProperties;return o&&console.log(`ObjectFieldTemplate: isRoot ${he} newkey "${D}"`),!he&&D!==""&&(o&&console.log("ObjectFieldTemplate: newkey",D,"properties",A),A.forEach(J=>{if(J.name==="newKey"&&J.content.key==="newKey"&&J.content.props.name==="newKey"&&J.content.props.onKeyChange&&D!==""){o&&console.log("ObjectFieldTemplate: newkey onKeyChange",D);const ge=D;z(""),J.content.props.onKeyChange(ge)}})),e.jsxs(X,{sx:{margin:"0px",padding:he?"10px":"5px 10px 0px 10px",border:he?"none":"1px solid grey"},children:[k.title&&he&&e.jsx(X,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px",marginBottom:"10px"},children:e.jsx(ae,{sx:ze,children:k.title})}),ee&&!he&&e.jsxs(X,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px"},children:[e.jsx(ae,{sx:ze,children:ee}),e.jsxs(X,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px"},children:[k.selectFrom&&e.jsx(R,{title:"Add a device from the list",children:e.jsx(K,{onClick:g,size:"small",color:"primary",sx:$e,children:e.jsx(tt,{})})}),e.jsx(R,{title:"Add a new item",children:e.jsx(K,{onClick:ye,size:"small",color:"primary",sx:$e,children:e.jsx(ut,{})})})]})]}),k.description&&e.jsx(X,{sx:{padding:"0px",margin:"0px",marginBottom:"10px"},children:e.jsx(ae,{sx:qe,children:k.description})}),A.map(({content:J,name:ge,hidden:we})=>!we&&e.jsxs(X,{sx:{margin:"0px",marginBottom:"10px",padding:["object","array","boolean"].includes(k.properties[ge].type)?"0px":an,border:["object","array","boolean"].includes(k.properties[ge].type)?"none":"1px solid grey"},children:[!["object","array","boolean"].includes(k.properties[ge].type)&&e.jsx(ae,{sx:ze,children:ge}),e.jsx(X,{sx:{flexGrow:1,padding:"0px",margin:"0px"},children:J})]},ge)),e.jsxs(De,{open:le,onClose:g,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(Pe,{children:"Select a device"}),e.jsxs(Ne,{children:[e.jsxs(X,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(ae,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(me,{fullWidth:!0,variant:"outlined",value:_,onChange:Z,placeholder:"Enter serial or name"})]}),e.jsx(Ze,{dense:!0,children:Be.filter(J=>J.serial.toLowerCase().includes(_.toLowerCase())||J.name.toLowerCase().includes(_.toLowerCase())).map((J,ge)=>e.jsxs(rt,{onClick:()=>be(J),sx:lt,children:[J.icon==="wifi"&&e.jsx(B,{children:e.jsx(Ye,{style:je})}),J.icon==="ble"&&e.jsx(B,{children:e.jsx(ot,{style:je})}),J.icon==="hub"&&e.jsx(B,{children:e.jsx(nt,{style:je})}),e.jsx(re,{primary:J.name,secondary:J.serial,primaryTypographyProps:{style:dt},secondaryTypographyProps:{style:ct}})]},ge))})]}),e.jsx(He,{children:e.jsx(ie,{onClick:g,children:"Close"})})]})]})}function Y(N){const{uiSchema:C}=N,{submitText:k,norender:A}=Ao(C);return A?null:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",margin:"10px",padding:"0px",gap:"20px"},children:[e.jsx(ie,{type:"submit",variant:"contained",color:"primary",children:k}),e.jsx(ie,{variant:"contained",color:"primary",onClick:p,children:"Cancel"})]})}function ve(N){const{className:C,disabled:k,onClick:A,registry:ee,style:ce,uiSchema:le,...de}=N;return e.jsx(R,{title:"Remove the item",children:e.jsx(K,{disabled:k,size:"small",color:"primary",onClick:A,children:e.jsx(ht,{})})})}function U(N){const{className:C,disabled:k,onClick:A,registry:ee,uiSchema:ce,...le}=N;return e.jsx(R,{title:"Add an item",children:e.jsx(K,{size:"small",color:"primary",onClick:A,children:e.jsx(ut,{})})})}function oe(N){const{disabled:C,onClick:k,registry:A,style:ee,uiSchema:ce,...le}=N;return e.jsx(R,{title:"Move up the item",children:e.jsx(K,{size:"small",color:"primary",onClick:k,children:e.jsx($t,{})})})}function $(N){const{disabled:C,onClick:k,registry:A,style:ee,uiSchema:ce,...le}=N;return e.jsx(R,{title:"Move down the item",children:e.jsx(K,{size:"small",color:"primary",onClick:k,children:e.jsx(Wt,{})})})}function Q(N){const{id:C,name:k,value:A,schema:ee,readonly:ce,onChange:le}=N,[de,_]=r.useState(),se=g=>{o&&console.log(`CheckboxWidget ${k} onChangeField:`,g),_(g&&g!==""?g:void 0)},Z=()=>{o&&console.log(`CheckboxWidget onClick plugin="${d.name}" action="${k}" value="${de}"`),s({id:t.current,sender:"ConfigPlugin",method:"/api/action",src:"Frontend",dst:"Matterbridge",params:{plugin:d.name,action:k,value:de,formData:f,id:C}}),ee.buttonClose===!0?p():ee.buttonSave===!0&&x({formData:S})};return ee.buttonText&&ee.description?e.jsxs(X,{sx:{margin:"0px",padding:"10px",border:"1px solid grey",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(ae,{sx:qe,children:ee.description}),e.jsx(ie,{variant:"contained",color:"primary",onClick:()=>Z(),children:ee.buttonText})]}):ee.buttonField&&ee.description?e.jsxs(X,{sx:{margin:"0px",padding:"10px",gap:"20px",border:"1px solid grey",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(ae,{sx:qe,children:ee.description}),e.jsx(me,{id:k+"-input",name:k,label:ee.textLabel,placeholder:ee.textPlaceholder,onChange:g=>se(g.target.value),sx:{width:"250px",minWidth:"250px",maxWidth:"250px"}}),e.jsx(ie,{id:k+"-button",variant:"contained",color:"primary",disabled:de===void 0,onClick:()=>Z(),children:ee.buttonField})]}):e.jsxs(X,{sx:{margin:"0px",padding:"5px 10px",border:"1px solid grey"},children:[k&&e.jsxs(X,{sx:{margin:"0px",padding:"0px",gap:"10px",display:"flex",justifyContent:"flex-start",alignItems:"center"},children:[e.jsx(ae,{sx:ze,children:k}),e.jsx(Oe,{checked:A,readOnly:ce,onChange:()=>le(!A),sx:{padding:"0px",margin:"0px"}})]}),ee.description&&e.jsx(ae,{sx:qe,children:ee.description})]})}function P({schema:N,id:C,name:k,options:A,label:ee,hideLabel:ce,required:le,disabled:de,placeholder:_,readonly:se,value:Z,multiple:g,autofocus:be,onChange:ye,onBlur:he,onFocus:J,errorSchema:ge,rawErrors:we=[],registry:Ke,uiSchema:G,hideError:M,formContext:fe,...Je}){const{enumOptions:Le,enumDisabled:Xe,emptyValue:Me}=A;g=typeof g>"u"?!1:!!g;const It=g?[]:"",Dt=typeof Z>"u"||g&&Z.length<1||!g&&Z===It,nr=({target:{value:We}})=>ye(yt(We,Le,Me)),ir=({target:We})=>he(C,yt(We&&We.value,Le,Me)),sr=({target:We})=>J(C,yt(We&&We.value,Le,Me)),Pt=Vo(Z,Le,g),{InputLabelProps:ar,SelectProps:lr,autocomplete:dr,...cr}=Je,pr=!g&&N.default===void 0;return e.jsxs(me,{id:C,name:C,value:!Dt&&typeof Pt<"u"?Pt:It,required:le,disabled:de||se,autoFocus:be,autoComplete:dr,placeholder:_,error:we.length>0,onChange:nr,onBlur:ir,onFocus:sr,...cr,select:!0,InputLabelProps:{...ar,shrink:!Dt},SelectProps:{...lr,multiple:g},"aria-describedby":Eo(C),children:[pr&&e.jsx(I,{value:"",children:_}),Array.isArray(Le)&&Le.map(({value:We,label:ur},Nt)=>{const gr=Array.isArray(Xe)&&Xe.indexOf(We)!==-1;return e.jsx(I,{value:String(Nt),disabled:gr,children:ur},Nt)})]})}return o&&console.log("ConfigPluginDialog rendering..."),!n||!j||!S?null:e.jsxs(De,{open:n,onClose:p,slotProps:{paper:{sx:{maxWidth:"800px"}}},children:[e.jsx(Pe,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h3",{children:"Matterbridge plugin configuration"})]})}),e.jsx(Ne,{style:{padding:"0px",margin:"0px",width:"800px",height:"600px",overflow:"auto"},children:e.jsx(Ro,{schema:j,formData:S,uiSchema:y,validator:Oo,templates:{FieldTemplate:F,BaseInputTemplate:i,TitleFieldTemplate:v,DescriptionFieldTemplate:O,FieldHelpTemplate:E,FieldErrorTemplate:l,ErrorListTemplate:w,WrapIfAdditionalTemplate:W,ArrayFieldTitleTemplate:c,ArrayFieldDescriptionTemplate:u,ArrayFieldItemTemplate:T,ArrayFieldTemplate:ue,ObjectFieldTemplate:te,ButtonTemplates:{SubmitButton:Y,RemoveButton:ve,AddButton:U,MoveUpButton:oe,MoveDownButton:$}},widgets:{CheckboxWidget:Q,SelectWidget:P},onChange:V,onSubmit:x})})]})};function er(n){if(o&&console.log(`getQRColor (id: ${n?.id}) received matter:`,n??"undefined"),n===void 0||!n.online||!n.qrPairingCode&&!n.manualPairingCode&&!n.fabricInformations&&!n.sessionInformations)return"red";if(n.commissioned===!1&&n.qrPairingCode&&n.manualPairingCode)return"var(--primary-color)";let p=0,d=0;for(const s of n.sessionInformations??[])s.fabric&&s.isPeerActive===!0&&p++,s.numberOfActiveSubscriptions>0&&(d+=s.numberOfActiveSubscriptions);return n.commissioned===!0&&n.fabricInformations&&n.sessionInformations&&(p===0||d===0)?"var(--secondary-color)":"var(--div-text-color)"}function dn(n,p,d){const s=n?.[d],a=p?.[d];return s==null&&a==null?0:s==null?-1:a==null?1:typeof s=="boolean"&&typeof a=="boolean"?s===a?0:s?1:-1:typeof s=="number"&&typeof a=="number"?s-a:String(s).localeCompare(String(a))}function cn({name:n,title:p,columns:d,rows:s,getRowKey:a,footerLeft:m,footerRight:h,onRowClick:t}){const S=r.useRef(new WeakMap),L=r.useRef(1),j=l=>{if(typeof a=="string"&&l&&l[a]!=null)return l[a];if(typeof a=="function"){const u=a(l);if(u!=null)return u}const i=d?.[0]?.id;if(i&&l&&l[i]!=null)return l[i];console.warn(`MbfTable(${n}): using fallback stable row key; consider providing getRowKey prop for better React performance`);let c=S.current.get(l);return c||(c=`rk_${L.current++}`,S.current.set(l,c)),c},[b,y]=r.useState(localStorage.getItem(`${n}_table_order_by`)||null),[H,D]=r.useState(localStorage.getItem(`${n}_table_order`)||null),[z,f]=r.useState(!1),[V,x]=r.useState(()=>{try{const l=localStorage.getItem(`${n}_column_visibility`);if(l)return JSON.parse(l)}catch{}return{}}),W=r.useMemo(()=>{const l={};for(const i of d)i.hidden||(l[i.id]=i.required?!0:V[i.id]!==!1);return l},[d,V]),F=r.useMemo(()=>{if(!b||!H)return s;const l=d.find(c=>c.id===b);if(!l||l.noSort)return s;const i=s.map((c,u)=>({el:c,index:u}));return i.sort((c,u)=>{let T;return typeof l.comparator=="function"?T=l.comparator(c.el,u.el):T=dn(c.el,u.el,b),T!==0?H==="asc"?T:-T:c.index-u.index}),i.map(c=>c.el)},[s,b,H,d]),O=l=>{if(b!==l||!b){y(l),D("asc"),localStorage.setItem(`${n}_table_order_by`,l),localStorage.setItem(`${n}_table_order`,"asc");return}if(H==="asc"){D("desc"),localStorage.setItem(`${n}_table_order`,"desc");return}y(null),D(null),localStorage.removeItem(`${n}_table_order_by`),localStorage.removeItem(`${n}_table_order`)},v=()=>{f(!z)},E=l=>{x(i=>{const c=d.find(ue=>ue.id===l);if(c&&c.required)return i;const u=W[l]!==!1,T={...i};u?T[l]=!1:delete T[l];try{localStorage.setItem(`${n}_column_visibility`,JSON.stringify(T))}catch{}return T})},w=()=>{x({});try{localStorage.removeItem(`${n}_column_visibility`)}catch{}f(!1)};return o&&console.log(`Rendering table ${n}${b&&H?` ordered by ${b}:${H}`:""}`),e.jsxs("div",{style:{display:"flex",flexDirection:"column",margin:"0",padding:"0",gap:"0",width:"100%",flex:"1 1 auto",height:"100%",minHeight:0,overflow:"hidden"},children:[e.jsxs(De,{open:z,onClose:(l,i)=>{i==="backdropClick"||i==="escapeKeyDown"||v()},disableEscapeKeyDown:!0,disableRestoreFocus:!0,children:[e.jsx(Pe,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:`Configure ${n} columns`})]})}),e.jsx(Ne,{children:e.jsx(Dr,{children:d.filter(l=>!l.hidden).map(l=>e.jsx(Re,{control:e.jsx(Oe,{disabled:!!l.required,checked:l.required?!0:W[l.id]!==!1,onChange:()=>E(l.id)}),label:l.label},l.id))})}),e.jsxs(He,{children:[e.jsx(ie,{onClick:w,children:"Reset"}),e.jsx(ie,{variant:"contained",onClick:l=>{if(l?.currentTarget&&typeof l.currentTarget.blur=="function")try{l.currentTarget.blur()}catch{}const i=document.activeElement;if(i&&i instanceof HTMLElement&&typeof i.blur=="function")try{i.blur()}catch{}v()},children:"Close"})]})]}),e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",minHeight:"30px",justifyContent:"space-between",borderBottom:"none"},children:[e.jsx("p",{className:"MbfWindowHeaderText",children:n}),p&&e.jsx("p",{className:"MbfWindowHeaderText",children:p}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(K,{onClick:l=>{if(l?.currentTarget?.blur)try{l.currentTarget.blur()}catch{}v()},"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(R,{title:`Configure ${n} columns`,children:e.jsx(ne,{path:fo,size:"20px",color:"var(--header-text-color)"})})})})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",flex:"1 1 auto",minHeight:0,width:"100%",overflow:"auto",margin:"0px",padding:"0px",gap:"0"},children:e.jsxs("table",{"aria-label":`${n} table`,style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,border:"none",color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color"},children:e.jsx("tr",{style:{height:"30px",minHeight:"30px"},children:d.map(l=>{if(l.hidden||!l.required&&W[l.id]===!1)return null;const i=!l.noSort,c=i&&b===l.id&&!!H;return e.jsxs("th",{onClick:i?()=>O(l.id):void 0,style:{margin:"0",padding:"5px 10px",position:"sticky",top:0,minWidth:l.minWidth,maxWidth:l.maxWidth,textAlign:l.align||"left",cursor:i?"pointer":"default",border:"none",color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color)",whiteSpace:l.maxWidth?"nowrap":void 0,overflow:l.maxWidth?"hidden":void 0,textOverflow:l.maxWidth?"ellipsis":void 0},"aria-sort":i?c?H==="asc"?"ascending":"descending":"none":void 0,children:[l.label,c&&e.jsxs("span",{style:{marginLeft:6},children:[H==="asc"&&e.jsx(ne,{path:xo,size:"15px"}),H==="desc"&&e.jsx(ne,{path:bo,size:"15px"})]})]},l.id)})})}),e.jsx("tbody",{children:F.map((l,i)=>{const c=j(l);return e.jsx("tr",{className:i%2===0?"table-content-even":"table-content-odd",onClick:t?u=>t(l,c,u):void 0,style:{height:"30px",minHeight:"30px",border:"none",borderCollapse:"collapse",cursor:t?"pointer":void 0},children:d.map(u=>{if(u.hidden||!u.required&&W[u.id]===!1)return null;const T=l[u.id];return e.jsx("td",{style:{border:"none",borderCollapse:"collapse",textAlign:u.align||"left",padding:"5px 10px",margin:"0",maxWidth:u.maxWidth,whiteSpace:u.maxWidth?"nowrap":void 0,overflow:u.maxWidth?"hidden":void 0,textOverflow:u.maxWidth?"ellipsis":void 0},children:typeof u.render=="function"?u.render(T,c,l,u):typeof T=="boolean"?e.jsx(Oe,{checked:T,disabled:!0,size:"small",sx:{m:0,p:0,color:"var(--table-text-color)","&.Mui-disabled":{color:"var(--table-text-color)",opacity:.7}}}):u.format&&typeof T=="number"?u.format(T):T!=null?String(T):null},u.id)})},c)})})]})}),(m||h)&&e.jsxs("div",{className:"MbfWindowFooter",style:{height:"30px",minHeight:"30px",justifyContent:"space-between",border:"none"},children:[e.jsx("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)"},children:m}),e.jsx("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)"},children:h})]})]})}function pn(n){return r.memo(n)}const xt=pn(cn);function un({storeId:n,setStoreId:p}){const{online:d,sendMessage:s,addListener:a,removeListener:m,getUniqueId:h}=r.useContext(xe),{showConfirmCancelDialog:t}=r.useContext(Ge),S=r.useRef(h()),[L,j]=r.useState(null),[b,y]=r.useState(null),[H,D]=r.useState([]),z=[{label:"Name",id:"name",required:!0,render:($,Q,P,N)=>e.jsx(R,{title:"Open the plugin homepage",children:e.jsx("span",{style:{cursor:"pointer"},onClick:()=>l(P),children:P.name})})},{label:"Description",id:"description",render:($,Q,P,N)=>e.jsx(R,{title:"Open the plugin homepage",children:e.jsx("span",{style:{cursor:"pointer"},onClick:()=>l(P),children:P.description})})},{label:"Version",id:"version",render:($,Q,P,N)=>e.jsxs(e.Fragment,{children:[P.latestVersion!==void 0&&P.latestVersion!==P.version&&b&&!b.readOnly&&e.jsx(R,{title:"New plugin stable version available, click to install",children:e.jsxs("span",{className:"status-warning",style:{marginRight:"10px"},onClick:()=>F(P),children:["Update to v.",P.latestVersion]})}),P.version.includes("-dev-")&&P.devVersion!==void 0&&P.devVersion!==P.version&&b&&!b.readOnly&&e.jsx(R,{title:"New plugin dev version available, click to install",children:e.jsxs("span",{className:"status-warning",style:{marginRight:"10px"},onClick:()=>O(P),children:["Update to new dev v.",P.devVersion.split("-dev-")[0]]})}),e.jsx(R,{title:"Plugin version",children:e.jsx("span",{children:P.version})})]})},{label:"Author",id:"author",render:($,Q,P,N)=>e.jsx(e.Fragment,{children:P.author?P.author.replace("https://github.com/",""):"Unknown"})},{label:"Type",id:"type",render:($,Q,P,N)=>e.jsx(e.Fragment,{children:P.type?P.type.replace("Platform",""):"Unknown"})},{label:"Devices",id:"registeredDevices"},{label:"Actions",id:"actions",required:!0,noSort:!0,render:($,Q,P,N)=>e.jsxs("div",{style:{margin:"0px",padding:"0px",gap:"4px",display:"flex",flexDirection:"row"},children:[b&&b.bridgeMode==="childbridge"&&!P.error&&P.enabled&&e.jsx(R,{title:"Shows the QRCode or the fabrics",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(K,{style:{margin:"0",padding:"0",width:"19px",height:"19px",color:er(P.matter)},onClick:()=>{P.matter?.id&&p(P.matter?.id)},size:"small",children:e.jsx(Qt,{})})}),b&&b.bridgeMode==="childbridge"&&!P.error&&P.enabled&&e.jsx(R,{title:"Restart the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(K,{style:{margin:"0",padding:"0",width:"19px",height:"19px"},onClick:()=>E(P),size:"small",children:e.jsx(gt,{})})}),e.jsx(R,{title:"Plugin config",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(K,{disabled:P.restartRequired===!0,style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>ve(P),size:"small",children:e.jsx(kt,{})})}),b&&!b.readOnly&&e.jsx(R,{title:"Remove the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(K,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>{V("Remove plugin","Are you sure? This will also remove all devices and configuration from the controller.","remove",P)},size:"small",children:e.jsx(ht,{})})}),P.enabled?e.jsx(R,{title:"Disable the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(K,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>{V("Disable plugin","Are you sure? This will also remove all devices and configuration from the controller.","disable",P)},size:"small",children:e.jsx(Pr,{})})}):e.jsx(e.Fragment,{}),P.enabled?e.jsx(e.Fragment,{}):e.jsx(R,{title:"Enable the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(K,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>w(P),size:"small",children:e.jsx(Nr,{})})}),e.jsx(R,{title:"Open the plugin help",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(K,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>c(P),size:"small",children:e.jsx(Wr,{})})}),e.jsx(R,{title:"Open the plugin version history",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(K,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>u(P),size:"small",children:e.jsx($r,{})})}),b&&!b.readOnly&&e.jsx(R,{title:"Sponsor the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(K,{style:{margin:"0",padding:"0",width:"19px",height:"19px",color:"#b6409c"},onClick:()=>i(P),size:"small",children:e.jsx(Gt,{})})})]})},{label:"Status",id:"status",required:!0,noSort:!0,render:($,Q,P,N)=>e.jsx("div",{style:{display:"flex",flexDirection:"row",flex:"1 1 auto",margin:"0",padding:"0",gap:"5px",width:"auto",maxWidth:"max-content"},children:P.error?e.jsx(e.Fragment,{children:e.jsx(_e,{status:!1,enabledText:"Error",disabledText:"Error",tooltipText:"The plugin is in error state. Check the log!"})}):e.jsx(e.Fragment,{children:P.enabled===!1?e.jsx(e.Fragment,{children:e.jsx(_e,{status:P.enabled,enabledText:"Enabled",disabledText:"Disabled",tooltipText:"Whether the plugin is enable or disabled"})}):e.jsx(e.Fragment,{children:P.loaded&&P.started&&P.configured?e.jsx(e.Fragment,{children:e.jsx(_e,{status:P.loaded,enabledText:"Running",tooltipText:"Whether the plugin is running"})}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{status:P.loaded,enabledText:"Loaded",tooltipText:"Whether the plugin has been loaded"}),e.jsx(_e,{status:P.started,enabledText:"Started",tooltipText:"Whether the plugin started"}),e.jsx(_e,{status:P.configured,enabledText:"Configured",tooltipText:"Whether the plugin has been configured"})]})})})})}];r.useEffect(()=>{const $=Q=>{Q.src==="Matterbridge"&&Q.dst==="Frontend"&&(Q.method==="refresh_required"&&Q.response.changed==="plugins"&&(o&&console.log(`HomePlugins received refresh_required: changed=${Q.response.changed} and sending /api/plugins request`),s({id:S.current,sender:"HomePlugins",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})),Q.method==="refresh_required"&&Q.response.changed==="matter"&&(o&&console.log(`HomePlugins received refresh_required: changed=${Q.response.changed} and setting matter id ${Q.response.matter?.id}`),D(P=>{const N=P.findIndex(k=>k.matter?.id===Q.response.matter?.id);if(N<0)return o&&console.log(`HomePlugins received refresh_required: changed=${Q.response.changed} and matter id ${Q.response.matter?.id} not found`),P;o&&console.log(`HomePlugins received refresh_required: changed=${Q.response.changed} set matter id ${Q.response.matter?.id}`);const C=[...P];return C[N]={...C[N],matter:Q.response.matter},C})),Q.method==="refresh_required"&&Q.response.changed==="settings"&&(o&&console.log(`HomePlugins received refresh_required: changed=${Q.response.changed} and sending /api/settings request`),s({id:S.current,sender:"HomePlugins",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),Q.id===S.current&&Q.method==="/api/settings"&&(o&&console.log(`HomePlugins (id: ${Q.id}) received settings:`,Q.response),j(Q.response.systemInformation),y(Q.response.matterbridgeInformation)),Q.id===S.current&&Q.method==="/api/plugins"&&(o&&console.log(`HomePlugins (id: ${Q.id}) received ${Q.response.length} plugins:`,Q.response),D(Q.response)))};return a($,S.current),o&&console.log("HomePlugins added WebSocket listener id:",S.current),()=>{m($),o&&console.log("HomePlugins removed WebSocket listener")}},[a,m,s]),r.useEffect(()=>{d&&(o&&console.log("HomePlugins sending api requests"),s({id:S.current,sender:"HomePlugins",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),s({id:S.current,sender:"HomePlugins",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[d,s]);const f=r.useRef(null),V=($,Q,P,N)=>{o&&console.log(`handleActionWithConfirmCancel ${P} ${N.name}`),f.current=N,t($,Q,P,x,W)},x=$=>{o&&console.log(`handleConfirm action confirmed ${$} ${f.current?.name}`),$==="remove"&&f.current?v(f.current):$==="disable"&&f.current&&w(f.current),f.current=null},W=$=>{o&&console.log(`handleCancel action canceled ${$} ${f.current?.name}`),f.current=null},F=$=>{o&&console.log("handleUpdatePlugin plugin:",$.name),s({id:S.current,sender:"HomePlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:$.name,restart:!1}})},O=$=>{o&&console.log("handleUpdateDevPlugin plugin:",$.name),s({id:S.current,sender:"HomePlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:$.name+"@dev",restart:!1}})},v=$=>{o&&console.log("handleRemovePlugin plugin:",$.name),s({id:S.current,sender:"HomePlugins",method:"/api/removeplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:$.name}})},E=$=>{o&&console.log("handleRestartPlugin plugin:",$.name),s({id:S.current,sender:"HomePlugins",method:"/api/restartplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:$.name}})},w=$=>{o&&console.log("handleEnableDisablePlugin plugin:",$.name,"enabled:",$.enabled),$.enabled===!0?($.enabled=!1,s({id:S.current,sender:"HomePlugins",method:"/api/disableplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:$.name}})):($.enabled=!0,s({id:S.current,sender:"HomePlugins",method:"/api/enableplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:$.name}}))},l=$=>{o&&console.log(`handleHomepagePlugin plugin: ${$.name} homepage: ${$.homepage}`),$.homepage&&window.open($.homepage,"_blank")},i=$=>{o&&console.log("handleSponsorPlugin plugin:",$.name,"funding:",$.funding),$.funding&&window.open($.funding,"_blank")},c=$=>{o&&console.log("handleHelpPlugin plugin:",$.name,"help:",$.help),$.help&&window.open($.help,"_blank")},u=$=>{o&&console.log("handleChangelogPlugin plugin:",$.name,"changelog:",$.changelog),$.changelog&&window.open($.changelog,"_blank")},[T,ue]=r.useState(),[te,Y]=r.useState(!1),ve=$=>{o&&console.log("handleConfigPlugin plugin:",$.name),s({id:S.current,sender:"HomePlugins",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:$.name}}),s({id:S.current,sender:"HomePlugins",method:"/api/select/entities",src:"Frontend",dst:"Matterbridge",params:{plugin:$.name}}),ue($),U()},U=()=>{Y(!0)},oe=()=>{Y(!1)};return o&&console.log("HomePlugins rendering..."),d?e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",width:"100%",flex:"0 0 auto",overflow:"hidden"},children:[T&&e.jsx(ln,{open:te,onClose:oe,plugin:T}),e.jsx(xt,{name:"Plugins",columns:z,rows:H,footerRight:"",footerLeft:""})]}):e.jsx(ke,{})}const gn=r.memo(un),mn=n=>`${n.pluginName}::${n.serial}`;function hn({storeId:n,setStoreId:p}){const{online:d,sendMessage:s,addListener:a,removeListener:m,getUniqueId:h}=r.useContext(xe),[t,S]=r.useState(!1),[L,j]=r.useState(!0),[b,y]=r.useState(null),[H,D]=r.useState([]),[z,f]=r.useState([]),[V,x]=r.useState([]),[W,F]=r.useState([]),O=r.useRef(h()),v=[{label:"Plugin",id:"pluginName"},{label:"Name",id:"name",required:!0},{label:"Serial",id:"serial"},{label:"Availability",id:"availability",render:(l,i,c,u)=>c.reachable===!0?"Online":c.reachable===!1?e.jsx("span",{style:{color:"red"},children:"Offline"}):"",comparator:(l,i)=>{const c=l.reachable===!0?1:l.reachable===!1?0:-1,u=i.reachable===!0?1:i.reachable===!1?0:-1;return c-u}},{label:"Power",id:"powerSource",render:(l,i,c,u)=>c.powerSource==="ac"||c.powerSource==="dc"?e.jsx(Kt,{fontSize:"small",sx:{color:"var(--primary-color)"}}):c.powerSource==="ok"?e.jsx(mt,{fontSize:"small",sx:{color:"green"}}):c.powerSource==="warning"?e.jsx(mt,{fontSize:"small",sx:{color:"yellow"}}):c.powerSource==="critical"?e.jsx(mt,{fontSize:"small",sx:{color:"red"}}):e.jsx("span",{})},{label:"Url",id:"configUrl"},{label:"Actions",id:"selected",required:!0,render:(l,i,c,u)=>e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[c.matter!==void 0?e.jsx(R,{title:"Show the QRCode or the fabrics",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(K,{onClick:()=>p(n===c.matter?.id?b?.matterbridgeInformation.bridgeMode==="bridge"?"Matterbridge":null:c.matter?.id||null),"aria-label":"Show the QRCode",sx:{margin:0,padding:0,color:er(c.matter)},children:e.jsx(Qt,{fontSize:"small"})})}):e.jsx("div",{style:{width:"20px",height:"20px"}}),c.configUrl?e.jsx(R,{title:"Open the configuration page",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(K,{onClick:()=>window.open(c.configUrl,"_blank"),"aria-label":"Open config url",sx:{margin:0,padding:0},children:e.jsx(kt,{fontSize:"small"})})}):e.jsx("div",{style:{width:"20px",height:"20px"}}),c.selected!==void 0?e.jsx(R,{title:"Select/unselect the device",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Oe,{checked:c.selected,onChange:T=>w(T,c),sx:{margin:"0",marginLeft:"8px",padding:"0"},size:"small"})}):e.jsx("div",{style:{width:"20px",height:"20px"}})]})}],E=r.useCallback(l=>{l.selected=void 0;const i=H.find(T=>T.name===l.pluginName);if(!i)return console.error(`HomeDevices isSelected: plugin ${l.pluginName} not found for device ${l.name} `),l.selected;const c=i.schemaJson?.properties?.whiteList?.selectFrom;let u=i.configJson.postfix;return u===""&&(u=void 0),i.hasWhiteList===!0&&i.hasBlackList===!0&&c&&(l.selected=!0,c==="serial"&&i.configJson.whiteList&&i.configJson.whiteList.length>0&&i.configJson.whiteList.includes(u?l.serial.replace("-"+u,""):l.serial)&&(l.selected=!0),c==="serial"&&i.configJson.whiteList&&i.configJson.whiteList.length>0&&!i.configJson.whiteList.includes(u?l.serial.replace("-"+u,""):l.serial)&&(l.selected=!1),c==="serial"&&i.configJson.blackList&&i.configJson.blackList.length>0&&i.configJson.blackList.includes(u?l.serial.replace("-"+u,""):l.serial)&&(l.selected=!1),c==="name"&&i.configJson.whiteList&&i.configJson.whiteList.length>0&&i.configJson.whiteList.includes(l.name)&&(l.selected=!0),c==="name"&&i.configJson.whiteList&&i.configJson.whiteList.length>0&&!i.configJson.whiteList.includes(l.name)&&(l.selected=!1),c==="name"&&i.configJson.blackList&&i.configJson.blackList.length>0&&i.configJson.blackList.includes(l.name)&&(l.selected=!1)),l.selected},[H]);r.useEffect(()=>{const l=i=>{if(i.method==="refresh_required"&&i.response.changed!=="matter"?(o&&console.log(`HomeDevices received refresh_required: changed=${i.response.changed} and sending /api/plugins request`),s({id:O.current,sender:"HomeDevices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})):i.method==="refresh_required"&&i.response.changed==="matter"?(o&&console.log(`HomeDevices received refresh_required: changed=${i.response.changed} and setting matter id ${i.response.matter?.id}`),F(c=>{const u=c.findIndex(ue=>ue.name.replaceAll(" ","")===i.response.matter?.id);if(u<0)return o&&console.debug(`HomeDevices: matter id ${i.response.matter?.id} not found`),c;const T=[...c];return T[u]={...T[u],matter:i.response.matter},o&&console.log(`HomeDevices received refresh_required: changed=${i.response.changed} and set matter id ${i.response.matter?.id}`),T})):i.method==="restart_required"?(o&&console.log("HomeDevices received restart_required"),S(!0)):i.method==="restart_not_required"?(o&&console.log("HomeDevices received restart_not_required"),S(!1)):i.method==="state_update"&&i.response.plugin&&i.response.serialNumber&&i.response.cluster.includes("BasicInformation")&&i.response.attribute==="reachable"&&(o&&console.log(`HomeDevices updating device reachability for plugin ${i.response.plugin} serial ${i.response.serialNumber} value ${i.response.value}`),f(c=>{const u=c.findIndex(T=>T.pluginName===i.response.plugin&&T.serial===i.response.serialNumber);return u<0?(o&&console.warn(`HomeDevices: device to update not found for plugin ${i.response.plugin} serial ${i.response.serialNumber}`),c):(c[u]={...c[u],reachable:i.response.value},[...c])})),i.id===O.current&&i.method==="/api/settings")o&&console.log(`HomeDevices (id: ${i.id}) received settings:`,i.response),y(i.response),S(i.response.matterbridgeInformation.restartRequired||i.response.matterbridgeInformation.fixedRestartRequired);else if(i.id===O.current&&i.method==="/api/plugins"){if(o&&console.log(`HomeDevices (id: ${i.id}) received ${i.response?.length} plugins:`,i.response),i.response){let c=!0;for(const u of i.response)u.enabled===!0&&(u.loaded!==!0||u.started!==!0||u.error===!0)&&(c=!1);if(!c)return;o&&console.log("HomeDevices reset plugins, devices and selectDevices"),j(!1),D(i.response),f([]),x([]),s({id:O.current,sender:"HomeDevices",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}}),o&&console.log("HomeDevices sent /api/devices");for(const u of i.response)u.enabled===!0&&u.loaded===!0&&u.started===!0&&u.error!==!0&&(s({id:O.current,sender:"HomeDevices",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:u.name}}),o&&console.log(`HomeDevices sent /api/select/devices for plugin: ${u.name}`))}}else if(i.id===O.current&&i.method==="/api/devices"){if(o&&console.log(`HomeDevices (id: ${i.id}) received ${i.response?.length} devices:`,i.response),i.response){for(const c of i.response)c.selected=E(c);f(i.response)}}else i.id===O.current&&i.method==="/api/select/devices"&&(o&&console.log(`HomeDevices (id: ${i.id}) received ${i.response?.length} selectDevices for plugin ${i.response&&i.response.length>0?i.response[0].pluginName:"without select devices"}:`,i.response),i.response&&i.response.length>0&&x(c=>{const u=c.filter(ue=>ue.pluginName!==i.response[0].pluginName),T=i.response.map(ue=>({...ue,selected:E(ue)}));return[...u,...T]}))};return a(l,O.current),o&&console.log(`HomeDevices added WebSocket listener id ${O.current}`),()=>{m(l),o&&console.log("HomeDevices removed WebSocket listener")}},[H,a,m,s,E]),r.useEffect(()=>{if(z.length===0&&V.length===0){F([]);return}o&&console.log(`HomeDevices mixing devices (${z.length}) and selectDevices (${V.length})`);const l=[];for(const i of z)l.push(i);for(const i of V)z.find(c=>c.pluginName===i.pluginName&&c.serial.includes(i.serial))||l.push(i);l.length>0&&(F(l),o&&console.log(`HomeDevices mixed ${l.length} devices and selectDevices`))},[H,z,V,F]),r.useEffect(()=>{d&&(o&&console.log("HomeDevices sending /api/settings and /api/plugins requests"),s({id:O.current,sender:"HomeDevices",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),s({id:O.current,sender:"HomeDevices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[d,s]);const w=(l,i)=>{o&&console.log(`handleCheckboxChange: checkbox changed to ${l.target.checked} for device ${i.name} serial ${i.serial}`),z.findIndex(c=>c.pluginName===i.pluginName&&c.serial===i.serial)<0?(o&&console.warn(`handleCheckboxChange: device ${i.name} serial ${i.serial} not found in devices, trying in mixedDevices`),F(c=>{const u=c.findIndex(T=>T.pluginName===i.pluginName&&T.serial===i.serial);return u<0?(console.error(`handleCheckboxChange: device ${i.name} serial ${i.serial} not found in mixedDevices`),c):(c[u]={...c[u],selected:l.target.checked},[...c])})):f(c=>{const u=c.findIndex(T=>T.pluginName===i.pluginName&&T.serial===i.serial);return u<0?(console.error(`handleCheckboxChange: device ${i.name} serial ${i.serial} not found in devices`),c):(c[u]={...c[u],selected:l.target.checked},[...c])}),l.target.checked?s({id:O.current,sender:"HomeDevices",method:"/api/command",src:"Frontend",dst:"Matterbridge",params:{command:"selectdevice",plugin:i.pluginName,serial:i.serial,name:i.name}}):s({id:O.current,sender:"HomeDevices",method:"/api/command",src:"Frontend",dst:"Matterbridge",params:{command:"unselectdevice",plugin:i.pluginName,serial:i.serial,name:i.name}})};return o&&console.log("HomeDevices rendering..."),d?e.jsx("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",width:"100%",flex:"1 1 auto",overflow:"hidden"},children:e.jsx(xt,{name:"Devices",getRowKey:mn,rows:W,columns:v,footerLeft:L?"Waiting for the plugins to fully load...":`Registered devices: ${z.length.toString()}/${W.length.toString()}`,footerRight:t?"Restart required":""})}):e.jsx(ke,{})}const fn=r.memo(hn);function bt({children:n,style:p}){const d={display:"flex",flexDirection:"column",width:"100%",height:"100%",margin:"0px",padding:"0px",gap:"20px"};return e.jsx("div",{style:{...d,...p},children:n})}const xn=()=>"ontouchstart"in window||typeof window.DocumentTouch<"u"&&document instanceof window.DocumentTouch?(o&&console.log("WebSocketLogs detectTouchscreen = true"),!0):(o&&console.log("WebSocketLogs detectTouchscreen = false"),!1);function bn(){const{messages:n,autoScroll:p}=r.useContext(Xt),[d,s]=r.useState(!1),a=r.useRef(null),m=r.useMemo(()=>xn(),[]),h=j=>s(!0),t=j=>s(!1);r.useEffect(()=>{o&&console.log(`WebSocketLogs autoScroll: ${p} isHovering: ${d}`),p&&!d&&!m&&a.current?.scrollIntoView({behavior:"smooth"})},[n,d,p,m]);const S=j=>{switch(j.toLowerCase()){case"debug":return"gray";case"info":return"#267fb7";case"notice":return"green";case"warn":return"#e9db18";case"error":return"red";case"fatal":return"#ff0000";case"spawn":return"#ff00d0";default:return"#5c0e91"}},L=j=>{switch(j.toLowerCase()){case"warn":return"black";default:return"white"}};return e.jsx("div",{style:{margin:"0px",padding:"0px"},children:e.jsxs("ul",{style:{margin:"0px",padding:"0px"},onMouseEnter:h,onMouseLeave:t,children:[n.map((j,b)=>e.jsxs("li",{style:{wordWrap:"break-word",maxHeight:"200px",overflow:"hidden"},children:[e.jsx("span",{style:{marginRight:"5px",padding:"1px 5px",backgroundColor:S(j.level),color:L(j.level),fontSize:"12px",borderRadius:"3px",textAlign:"center"},children:j.level}),j.time&&e.jsx("span",{style:{marginRight:"3px",color:"#505050"},children:"["+j.time+"]"}),j.name&&e.jsx("span",{style:{marginRight:"3px",color:"#09516d"},children:"["+j.name+"]"}),e.jsx("span",{style:{color:"var(--main-log-color)"},children:j.message})]},b)),e.jsx("div",{ref:a})]})})}const tr=r.memo(bn);function vn(){const{logFilterLevel:n,logFilterSearch:p,autoScroll:d,online:s}=r.useContext(xe);return o&&console.log("HomeLogs rendering..."),s?e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"1 1 auto",width:"100%",overflow:"hidden"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",minHeight:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",children:"Logs"}),e.jsx("div",{className:"MbfWindowHeaderText",style:{display:"flex",justifyContent:"space-between"},children:e.jsxs("span",{style:{fontWeight:"normal",fontSize:"12px",marginTop:"2px"},children:['Filter: logger level "',n,'" and search "',p,'" Scroll: ',d?"auto":"manual"]})})]}),e.jsx("div",{style:{flex:"1 1 auto",margin:"0px",padding:"10px",overflow:"auto"},children:e.jsx(tr,{})})]}):e.jsx(ke,{})}const yn=r.memo(vn);function jn(){const{online:n}=r.useContext(xe);return o&&console.log("HomeBrowserRefresh rendering..."),n?e.jsxs(Ve,{children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Frontend Update"})}),e.jsxs("div",{className:"MbfWindowBody",style:{flexDirection:"row",justifyContent:"space-between"},children:[e.jsx("h4",{style:{margin:0},children:"The frontend has been updated. You are viewing an outdated web UI. Please refresh the page now."}),e.jsx("div",{children:e.jsx(ie,{onClick:()=>window.location.reload(),endIcon:e.jsx(Lr,{}),style:{marginLeft:"10px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Refresh"})})]})]}):e.jsx(ke,{})}const wn=r.memo(jn);function Cn({changelog:n}){const{online:p}=r.useContext(xe);return o&&console.log("HomeShowChangelog rendering..."),p?e.jsxs(Ve,{children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge Update"})}),e.jsxs("div",{className:"MbfWindowBody",style:{flexDirection:"row",justifyContent:"space-between"},children:[e.jsx("h4",{style:{margin:0},children:"Matterbridge has been updated."}),e.jsxs("div",{children:[e.jsx(ie,{onClick:()=>window.open(n,"_blank"),endIcon:e.jsx(Jt,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Changelog"}),e.jsx(ie,{onClick:()=>window.location.reload(),endIcon:e.jsx(Fr,{}),style:{marginLeft:"10px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Close"})]})]})]}):e.jsx(ke,{})}const Sn=r.memo(Cn);function Mn(){const[n,p]=r.useState(null),[d,s]=r.useState(null),[a,m]=r.useState([]),[h]=r.useState(localStorage.getItem("homePagePlugins")!=="false"),[t,S]=r.useState(localStorage.getItem("homePageMode")??"devices"),[L,j]=r.useState(""),[b,y]=r.useState(!1),[H,D]=r.useState(!1),[z,f]=r.useState(null),{addListener:V,removeListener:x,online:W,sendMessage:F,getUniqueId:O}=r.useContext(xe),v=r.useRef(O());return r.useEffect(()=>{const E=w=>{w.method==="refresh_required"&&w.response.changed==="settings"&&(o&&console.log(`Home received refresh_required: changed=${w.response.changed} and sending /api/settings request`),f(null),m([]),F({id:v.current,sender:"Home",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),F({id:v.current,sender:"Home",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})),w.method==="/api/settings"&&w.id===v.current&&(o&&console.log("Home received settings:",w.response),p(w.response.systemInformation),s(w.response.matterbridgeInformation),w.response.matterbridgeInformation.matterbridgeVersion&&j(`https://github.com/Luligu/matterbridge/blob/${w.response.matterbridgeInformation.matterbridgeVersion.includes("-dev-")?"dev":"main"}/CHANGELOG.md`),localStorage.getItem("frontendVersion")===null&&w.response.matterbridgeInformation.frontendVersion?localStorage.setItem("frontendVersion",w.response.matterbridgeInformation.frontendVersion):w.response.matterbridgeInformation.frontendVersion!==localStorage.getItem("frontendVersion")&&w.response.matterbridgeInformation.frontendVersion&&(localStorage.setItem("frontendVersion",w.response.matterbridgeInformation.frontendVersion),D(!0)),localStorage.getItem("matterbridgeVersion")===null?localStorage.setItem("matterbridgeVersion",w.response.matterbridgeInformation.matterbridgeVersion):w.response.matterbridgeInformation.matterbridgeVersion!==localStorage.getItem("matterbridgeVersion")&&(localStorage.setItem("matterbridgeVersion",w.response.matterbridgeInformation.matterbridgeVersion),y(!0)),w.response.matterbridgeInformation.shellyBoard&&(localStorage.getItem("homePageMode")||(localStorage.setItem("homePageMode","devices"),S("devices")))),w.method==="/api/plugins"&&w.id===v.current&&(o&&console.log("Home received plugins:",w.response),m(w.response))};return V(E,v.current),o&&console.log(`Home added WebSocket listener id ${v.current}`),()=>{x(E),o&&console.log("Home removed WebSocket listener")}},[V,x,F]),r.useEffect(()=>{if(o&&console.log(`Home storeId effect with storeId ${z}`),d?.bridgeMode==="bridge"&&!z&&(o&&console.log("Home storeId effect set storeId to Matterbridge"),f("Matterbridge")),d?.bridgeMode==="childbridge"&&!z&&a){for(const E of a)if(E.matter?.id){o&&console.log(`Home storeId effect set storeId to ${E.matter.id}`),f(E.matter.id);break}}},[d,a,z]),r.useEffect(()=>{W&&(o&&console.log("Home online effect, sending /api/settings and /api/plugins requests"),F({id:v.current,sender:"Home",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),F({id:v.current,sender:"Home",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[W,F]),o&&console.log("Home rendering..."),!W||!n||!d?e.jsx(ke,{}):e.jsxs(bt,{style:{flexDirection:"row"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",width:"302px",minWidth:"302px",gap:"20px"},children:[e.jsx(tn,{id:z}),e.jsx(Yo,{systemInfo:n,compact:!0})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",width:"100%",gap:"20px"},children:[H&&e.jsx(wn,{}),b&&e.jsx(Sn,{changelog:L}),h&&!d.readOnly&&e.jsx(on,{}),h&&e.jsx(gn,{storeId:z,setStoreId:f}),t==="devices"&&e.jsx(fn,{storeId:z,setStoreId:f}),t==="logs"&&e.jsx(yn,{})]})]})}const kn=r.memo(Mn),qt={display:"flex",gap:"2px",justifyContent:"space-evenly",width:"100%",height:"40px"},In={margin:"0",padding:"0",fontSize:"36px",fontWeight:"medium",color:"var(--primary-color)"},Dn={margin:"0",padding:"0",fontSize:"20px",fontWeight:"medium",color:"var(--div-text-color)",textAlign:"center"},Bt={margin:"0",padding:"0",paddingBottom:"2px",fontSize:"16px",fontWeight:"medium",color:"var(--div-text-color)",textAlign:"center"},Pn={display:"flex",gap:"2px",justifyContent:"center",width:"100%",height:"18px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},Nn={margin:"0",padding:"0",fontSize:"12px",fontWeight:"normal",color:"var(--div-text-color)"},Wn={display:"flex",justifyContent:"center",width:"100%",height:"52px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},$n={margin:"0",padding:"0",fontSize:"14px",fontWeight:"bold",color:"var(--div-text-color)"},Ln={display:"flex",gap:"4px",justifyContent:"center",width:"100%",height:"15px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},wt={margin:"0",padding:"0px 4px",borderRadius:"5px",textAlign:"center",fontSize:"12px",fontWeight:"normal",color:"var(--secondary-color)"},Fn=[256,257,268,269],Tn=[266,267],Hn=[259,260,261,271,272],Rn=[256,257,268,269,266,267,259,260,261,272];function q({icon:n,iconColor:p,cluster:d,value:s,unit:a,prefix:m}){return o&&console.log(`Render cluster "${d.clusterName}.${d.attributeName}" value(${typeof s}-${isNaN(s)}) "${s}" unit "${a}"`),m=m??!1,e.jsxs(X,{sx:qt,children:[n&&r.cloneElement(n,{key:`${d.clusterId}-${d.attributeId}-icon`,sx:{...In,color:p??"var(--primary-color)"}}),e.jsxs(X,{sx:{...qt,gap:"4px",alignContent:"center",alignItems:"end",justifyContent:"center"},children:[a&&m===!0&&e.jsx(ae,{sx:Bt,children:a},`${d.clusterId}-${d.attributeId}-unit`),e.jsx(ae,{sx:Dn,children:s==null||typeof s=="number"&&isNaN(s)||s==="NaN"?"---":s},`${d.clusterId}-${d.attributeId}-value`),a&&m===!1&&e.jsx(ae,{sx:Bt,children:a},`${d.clusterId}-${d.attributeId}-unit`)]},`${d.clusterId}-${d.attributeId}-valueunitbox`)]},`${d.clusterId}-${d.attributeId}-box`)}function On({device:n,endpoint:p,id:d,deviceType:s,clusters:a}){const m=["Unknown","Good","Fair","Moderate","Poor","VeryPoor","Ext.Poor"];let h="";return o&&console.log(`Device "${n.name}" endpoint "${p}" id "${d}" deviceType "0x${s.toString(16).padStart(4,"0")}" clusters (${a?.length}):`,a),s===17&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="batVoltage").map(t=>h=`${t.attributeLocalValue} mV`),Rn.includes(s)&&a.filter(t=>t.clusterName==="LevelControl"&&t.attributeName==="currentLevel").map(t=>h=`Level ${t.attributeValue}`),s===514&&a.filter(t=>t.clusterName==="WindowCovering"&&t.attributeName==="currentPositionLiftPercent100ths").map(t=>h=`Position ${t.attributeLocalValue/100}%`),s===769&&a.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="occupiedHeatingSetpoint").map(t=>h=`Heat ${t.attributeLocalValue/100}Â°C `),s===769&&a.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="occupiedCoolingSetpoint").map(t=>h=h+`Cool ${t.attributeLocalValue/100}Â°C`),s===118&&a.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="coState").map(t=>h=`${t.attributeLocalValue===0?"No CO detected":"CO alarm!"}`),s===1296&&a.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="voltage").map(t=>h=`${t.attributeLocalValue/1e3} V, `),s===1296&&a.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="activeCurrent").map(t=>h=h+`${t.attributeLocalValue/1e3} A, `),s===1296&&a.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="activePower").map(t=>h=h+`${t.attributeLocalValue/1e3} W`),e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0px",padding:"5px",width:"150px",height:"150px",borderColor:"var(--div-bg-color)",borderRadius:"5px",justifyContent:"space-between"},children:[s===19&&a.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(q,{icon:t.attributeLocalValue===!0?e.jsx(Ye,{}):e.jsx(Tr,{}),iconColor:t.attributeLocalValue===!0?"green":"red",cluster:t,value:t.attributeLocalValue===!0?"Online":"Offline"})),s===17&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="batPercentRemaining").map(t=>e.jsx(q,{icon:e.jsx(mt,{}),cluster:t,value:t.attributeLocalValue/2,unit:"%"})),s===17&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="wiredCurrentType").map(t=>e.jsx(q,{icon:e.jsx(Kt,{}),cluster:t,value:t.attributeLocalValue===0?"AC":"DC"})),s===1293&&a.filter(t=>t.clusterName==="DeviceEnergyManagement"&&t.attributeName==="esaState").map(t=>e.jsx(q,{icon:e.jsx(ne,{path:vo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Offline":"Online"})),Fn.includes(s)&&a.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(q,{icon:e.jsx(Hr,{}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),Tn.includes(s)&&a.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(q,{icon:e.jsx(ne,{path:yo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),Hn.includes(s)&&a.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(q,{icon:e.jsx(ne,{path:jo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),s===115&&a.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(q,{icon:e.jsx(ne,{path:wo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),s===124&&a.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(q,{icon:e.jsx(ne,{path:Co,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),s===117&&a.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(q,{icon:e.jsx(ne,{path:So,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),s===123&&a.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(q,{icon:e.jsx(Tt,{}),cluster:t,value:"Oven"})),s===112&&a.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(q,{icon:e.jsx(Rr,{}),cluster:t,value:"Fridge"})),s===113&&a.filter(t=>t.clusterName==="TemperatureControl"&&t.attributeName==="selectedTemperatureLevel").map(t=>e.jsx(q,{icon:e.jsx(ne,{path:Mo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),s===121&&a.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(q,{icon:e.jsx(Tt,{}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),s===122&&a.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="fanMode").map(t=>e.jsx(q,{icon:e.jsx(ne,{path:ko,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),s===120&&a.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(q,{icon:e.jsx(ne,{path:Et,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Cooktop"})),s===119&&a.filter(t=>t.clusterName==="TemperatureControl"&&t.attributeName==="selectedTemperatureLevel").map(t=>e.jsx(q,{icon:e.jsx(ne,{path:Et,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),s===116&&a.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(q,{icon:e.jsx(ne,{path:Io,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Robot"})),s===514&&a.filter(t=>t.clusterName==="WindowCovering"&&t.attributeName==="currentPositionLiftPercent100ths").map(t=>e.jsx(q,{icon:e.jsx(Or,{}),cluster:t,value:t.attributeLocalValue/100,unit:"%"})),s===769&&a.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="localTemperature").map(t=>e.jsx(q,{icon:e.jsx(ne,{path:Do,size:"40px",color:"var(--primary-color)"}),cluster:t,value:(t.attributeLocalValue??0)/100,unit:"Â°C"})),s===10&&a.filter(t=>t.clusterName==="DoorLock"&&t.attributeName==="lockState").map(t=>e.jsx(q,{icon:t.attributeValue==="1"?e.jsx(Vr,{}):e.jsx(Er,{}),cluster:t,value:t.attributeValue==="1"?"Locked":"Unlocked"})),s===43&&a.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="percentCurrent").map(t=>e.jsx(q,{icon:e.jsx(Ar,{}),cluster:t,value:t.attributeValue,unit:"%"})),s===15&&a.filter(t=>t.clusterName==="Switch"&&t.attributeName==="currentPosition").map(t=>e.jsx(q,{icon:e.jsx(ne,{path:Po,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeValue,unit:"pos",prefix:!0})),s===39&&a.filter(t=>t.clusterName==="ModeSelect"&&t.attributeName==="currentMode").map(t=>e.jsx(q,{icon:e.jsx(_r,{}),cluster:t,value:t.attributeValue,unit:"mode",prefix:!0})),s===771&&a.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(q,{icon:e.jsx(zr,{}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),s===45&&a.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="percentCurrent").map(t=>e.jsx(q,{icon:e.jsx(Ht,{}),cluster:t,value:t.attributeValue,unit:"%"})),s===114&&a.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="localTemperature").map(t=>e.jsx(q,{icon:e.jsx(Ht,{}),cluster:t,value:(t.attributeLocalValue??0)/100,unit:"Â°C"})),s===67&&a.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(q,{icon:e.jsx(qr,{}),cluster:t,value:t.attributeLocalValue===!0?"Leak":"No leak"})),s===65&&a.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(q,{icon:e.jsx(Br,{}),cluster:t,value:t.attributeLocalValue===!0?"Freeze":"No freeze"})),s===68&&a.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(q,{icon:e.jsx(Ur,{}),cluster:t,value:t.attributeLocalValue===!0?"Rain":"No rain"})),s===1292&&a.filter(t=>t.clusterName==="EnergyEvse"&&t.attributeName==="state").map(t=>e.jsx(q,{icon:e.jsx(ne,{path:No,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Free":"In use"})),s===1295&&a.filter(t=>t.clusterName==="WaterHeaterManagement"&&t.attributeName==="tankPercentage").map(t=>e.jsx(q,{icon:e.jsx(ne,{path:Wo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Tank "+(t.attributeLocalValue??0)+"%"})),s===777&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="featureMap").map(t=>e.jsx(q,{icon:e.jsx(ne,{path:$o,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"HeatPump"})),s===23&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="featureMap").map(t=>e.jsx(q,{icon:e.jsx(ne,{path:Lo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Solar"})),s===24&&a.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="featureMap").map(t=>e.jsx(q,{icon:e.jsx(ne,{path:Fo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Inverter"})),s===118&&a.find(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="featureMap"&&t.attributeLocalValue.smokeAlarm===!0)&&a.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="smokeState").map(t=>e.jsx(q,{icon:e.jsx(ne,{path:At,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"No smoke":"Smoke!"})),s===118&&a.find(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="featureMap"&&t.attributeLocalValue.smokeAlarm===!1)&&a.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="coState").map(t=>e.jsx(q,{icon:e.jsx(ne,{path:At,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"No Co":"Co!"})),s===66&&a.filter(t=>t.clusterName==="ValveConfigurationAndControl"&&t.attributeName==="currentState").map(t=>e.jsx(q,{icon:e.jsx(Qr,{}),cluster:t,value:t.attributeLocalValue===0?"Closed":"Opened"})),s===44&&a.filter(t=>t.clusterName==="AirQuality"&&t.attributeName==="airQuality").map(t=>e.jsx(q,{icon:e.jsx(ne,{path:To,size:"40px",color:"var(--primary-color)"}),cluster:t,value:m[t.attributeLocalValue??0]})),s===770&&a.filter(t=>t.clusterName==="TemperatureMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(q,{icon:e.jsx(Gr,{}),cluster:t,value:t.attributeLocalValue/100,unit:"Â°C"})),s===775&&a.filter(t=>t.clusterName==="RelativeHumidityMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(q,{icon:e.jsx(ne,{path:Ho,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue/100,unit:"%"})),s===774&&a.filter(t=>t.clusterName==="FlowMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(q,{icon:e.jsx(Kr,{}),cluster:t,value:t.attributeLocalValue,unit:"l/h"})),s===773&&a.filter(t=>t.clusterName==="PressureMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(q,{icon:e.jsx(Jr,{}),cluster:t,value:t.attributeLocalValue,unit:"hPa"})),s===21&&a.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(q,{icon:t.attributeValue==="true"?e.jsx(Zr,{}):e.jsx(Yr,{}),cluster:t,value:t.attributeValue==="true"?"Closed":"Opened"})),s===263&&a.filter(t=>t.clusterName==="OccupancySensing"&&t.attributeName==="occupancy").map(t=>e.jsx(q,{icon:t.attributeValue==="{ occupied: true }"?e.jsx(Xr,{}):e.jsx(eo,{}),cluster:t,value:t.attributeValue==="{ occupied: true }"?"Occupied":"Unocc."})),s===262&&a.filter(t=>t.clusterName==="IlluminanceMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(q,{icon:e.jsx(to,{}),cluster:t,value:Math.round(Math.pow(10,t.attributeLocalValue/1e4)),unit:"lx"})),s===1296&&a.filter(t=>t.clusterName==="ElectricalEnergyMeasurement"&&t.attributeName==="cumulativeEnergyImported").map(t=>e.jsx(q,{icon:e.jsx(ro,{}),cluster:t,value:Math.round(t.attributeLocalValue?.energy/1e6),unit:"kwh"})),e.jsx(X,{sx:Pn,children:e.jsx(ae,{sx:Nn,children:h})}),e.jsx(X,{sx:Wn,children:e.jsx(ae,{sx:$n,children:n.name})}),e.jsxs(X,{sx:Ln,children:[o&&e.jsx(ae,{sx:wt,children:p}),e.jsx(ae,{sx:wt,children:d}),o&&e.jsxs(ae,{sx:wt,children:["0x",s.toString(16).padStart(4,"0")]})]})]})}function Vn({filter:n}){const{online:p,sendMessage:d,addListener:s,removeListener:a,getUniqueId:m}=r.useContext(xe),[h,t]=r.useState(null),[S,L]=r.useState([]),[j,b]=r.useState([]),[y,H]=r.useState(j),[D,z]=r.useState({}),[f,V]=r.useState({}),[x,W]=r.useState({}),F=r.useRef(m()),O=r.useRef(y),v=r.useCallback(w=>{o&&console.log(`DevicesIcons received state_update "${w.response.cluster}.${w.response.attribute}" for "${w.response.id}:${w.response.number}": "${w.response.value}"`,w.response);const l=O.current.find(c=>c.pluginName===w.response.plugin&&c.uniqueId===w.response.uniqueId);if(!l){o&&console.warn(`DevicesIcons updater device of plugin "${w.response.plugin}" serial "${w.response.serialNumber}" not found in filteredDevicesRef.current`);return}const i=x[l.serial].find(c=>c.endpoint===w.response.number.toString()&&c.clusterName===w.response.cluster&&c.attributeName===w.response.attribute);if(!i){o&&console.warn(`DevicesIcons updater device "${l.name}" serial "${l.serial}" cluster "${w.response.cluster}" attribute "${w.response.attribute}" not found in clusters`);return}i.attributeValue=String(w.response.value),i.attributeLocalValue=w.response.value,W({...x}),o&&console.log(`DevicesIcons updated "${i.clusterName}.${i.attributeName}" for device "${l.name}" serial "${l.serial}" to "${i.attributeValue}"`)},[x]);r.useEffect(()=>{const w=l=>{if(l.method==="refresh_required")o&&console.log(`DevicesIcons received refresh_required: changed=${l.response.changed} and sending api requests`),d({id:F.current,sender:"Icons",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),d({id:F.current,sender:"Icons",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),d({id:F.current,sender:"Icons",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}});else if(l.method==="state_update"&&l.response)v(l);else if(l.method==="/api/settings"&&l.response)o&&console.log("DevicesIcons received settings:",l.response),t(l.response);else if(l.method==="/api/plugins"&&l.response)o&&console.log("DevicesIcons received plugins:",l.response),L(l.response);else if(l.method==="/api/devices"&&l.response){o&&console.log(`DevicesIcons received ${l.response.length} devices:`,l.response),b(l.response);for(const i of l.response)o&&console.log("DevicesIcons sending /api/clusters"),d({id:F.current,sender:"DevicesIcons",method:"/api/clusters",src:"Frontend",dst:"Matterbridge",params:{plugin:i.pluginName,endpoint:i.endpoint||0}})}else if(l.method==="/api/clusters"&&l.response){if(o&&console.log(`DevicesIcons received for device "${l.response.deviceName}" serial "${l.response.serialNumber}" deviceTypes (${l.response.deviceTypes.length}) "${l.response.deviceTypes.join(",")}" clusters (${l.response.clusters.length}):`,l.response),l.response.clusters.length===0)return;const i=l.response.serialNumber;D[i]=[],f[i]=l.response.deviceTypes,x[i]=[];for(const c of l.response.clusters)D[i].find(u=>u.endpoint===c.endpoint)||D[i].push({endpoint:c.endpoint,id:c.id,deviceTypes:c.deviceTypes}),!["FixedLabel","Descriptor","Identify","Groups","PowerTopology"].includes(c.clusterName)&&x[i].push(c);z({...D}),V({...f}),W({...x}),o&&console.log(`DevicesIcons endpoints for "${i}":`,D[i]),o&&console.log(`DevicesIcons deviceTypes for "${i}":`,f[i]),o&&console.log(`DevicesIcons clusters for "${i}":`,x[i])}};return s(w,F.current),o&&console.log("DevicesIcons useEffect webSocket mounted"),()=>{a(w),o&&console.log("DevicesIcons useEffect webSocket unmounted")}},[]),r.useEffect(()=>(o&&console.log("DevicesIcons useEffect online mounting"),p&&(o&&console.log("DevicesIcons useEffect online sending api requests"),d({id:F.current,sender:"DevicesIcons",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),d({id:F.current,sender:"DevicesIcons",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),d({id:F.current,sender:"DevicesIcons",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}})),o&&console.log("DevicesIcons useEffect online mounted"),()=>{o&&console.log("DevicesIcons useEffect online unmounted")}),[p,d]),r.useEffect(()=>{if(n===""){H(j),O.current=j;return}const w=j.filter(l=>l.name.toLowerCase().includes(n)||l.serial.toLowerCase().includes(n));H(w),O.current=w},[j,n]);const E=r.memo(On);return o&&console.log("DevicesIcons rendering..."),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",paddingBottom:"5px",gap:"20px",width:"100%",overflow:"auto"},children:y.map(w=>D[w.serial]&&D[w.serial].map(l=>l.deviceTypes.map(i=>e.jsx(E,{device:w,endpoint:l.endpoint,id:l.id,deviceType:i,clusters:x[w.serial].filter(c=>c.endpoint===l.endpoint)},`${w.pluginName}-${w.uniqueId}-${l.id}-${i.toString()}`))))})}const En=r.memo(Vn),An=[{label:"Plugin name",id:"pluginName",required:!0},{label:"Device type",id:"type"},{label:"Endpoint",id:"endpoint",align:"right"},{label:"Name",id:"name",required:!0},{label:"Serial number",id:"serial"},{label:"Unique ID",id:"uniqueId"},{label:"Url",id:"configUrl"},{label:"Config",id:"configButton",noSort:!0,render:(n,p,d,s)=>d.configUrl?e.jsx(K,{onClick:()=>window.open(d.configUrl,"_blank"),"aria-label":"Open Config",sx:{margin:0,padding:0},children:e.jsx(kt,{fontSize:"small"})}):null},{label:"Cluster",id:"cluster"}],_n=[{label:"Endpoint",id:"endpoint",required:!0},{label:"Id",id:"id"},{label:"Device Types",id:"deviceTypes",render:(n,p,d,s)=>Array.isArray(n)?e.jsx(e.Fragment,{children:n.map(a=>`0x${a.toString(16).padStart(4,"0")}`).join(", ")}):e.jsx(e.Fragment,{children:n})},{label:"Cluster Name",id:"clusterName",required:!0},{label:"Cluster ID",id:"clusterId"},{label:"Attribute Name",id:"attributeName",required:!0},{label:"Attribute ID",id:"attributeId"},{label:"Attribute Value",id:"attributeValue",required:!0,render:(n,p,d,s)=>e.jsx(R,{title:String(n),componentsProps:{tooltip:{sx:{fontSize:"14px",fontWeight:"normal",color:"#ffffff",backgroundColor:"var(--primary-color)"}}},children:e.jsx("div",{style:{maxWidth:"500px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:String(n)})})}],zn=n=>`${n.pluginName}::${n.uniqueId}`,qn=n=>`${n.endpoint}::${n.clusterName}::${n.attributeName}`;function Bn({filter:n}){const{online:p,sendMessage:d,addListener:s,removeListener:a,getUniqueId:m}=r.useContext(xe),[h,t]=r.useState([]),[S,L]=r.useState(h),[j,b]=r.useState([]),[y,H]=r.useState(0),[D,z]=r.useState(null),[f,V]=r.useState(null),[x,W]=r.useState(null),[F,O]=r.useState(null),v=r.useRef(m()),E=r.useRef(S),w=r.useCallback(i=>{o&&console.log(`DevicesTable received state_update "${i.response.cluster}.${i.response.attribute}" for "${i.response.id}:${i.response.number}": "${i.response.value}"`,i.response);const c=E.current.find(u=>u.pluginName===i.response.plugin&&u.uniqueId===i.response.uniqueId);if(!c){o&&console.warn(`DevicesTable updater device of plugin "${i.response.plugin}" serial "${i.response.serialNumber}" not found in filteredDevicesRef.current`);return}if(D&&f&&c.pluginName===D&&c.uniqueId===F&&i.response.number.toString()===f){const u=j.find(T=>T.endpoint===i.response.number.toString()&&T.clusterName===i.response.cluster&&T.attributeName===i.response.attribute);if(!u){o&&console.warn(`DevicesTable updater cluster ${i.response.cluster}.${i.response.attribute} for device "${c.name}" serial "${c.serial}" not found in clusters`);return}u.attributeValue=String(i.response.value),u.attributeLocalValue=i.response.value,b([...j]),o&&console.log(`DevicesTable updated attribute ${u.clusterName}.${u.attributeName} for device "${c.name}" serial "${c.serial}" to "${u.attributeValue}"`)}},[j,f,D,F]);r.useEffect(()=>{const i=c=>{if(o&&console.log("DevicesTable received WebSocket Message:",c),c.method==="refresh_required"&&c.response.changed==="devices")o&&console.log(`DevicesTable received refresh_required: changed=${c.response.changed} and sending /api/devices request`),d({id:v.current,sender:"DevicesTable",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}});else if(c.method==="state_update"&&c.response)w(c);else if(c.method==="/api/devices")o&&console.log(`DevicesTable received ${c.response.length} devices:`,c.response),t(c.response);else if(c.method==="/api/clusters"){o&&console.log(`DevicesTable received ${c.response.clusters.length} clusters for plugin ${c.response.plugin}:`,c.response),b(c.response.clusters);const u={};for(const T of c.response.clusters)o&&console.log("Cluster:",T.endpoint),u[T.endpoint]?u[T.endpoint]++:u[T.endpoint]=1;H(Object.keys(u).length)}};return s(i,v.current),o&&console.log("DevicesTable added WebSocket listener"),()=>{a(i),o&&console.log("DevicesTable removed WebSocket listener")}},[d,s,a,w]),r.useEffect(()=>{p&&(o&&console.log("DevicesTable sending api requests with id ",v.current),d({id:v.current,sender:"DevicesTable",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),d({id:v.current,sender:"DevicesTable",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),d({id:v.current,sender:"DevicesTable",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}}))},[p,d]),r.useEffect(()=>{D&&f&&(o&&console.log("DevicesTable sending /api/clusters"),d({id:v.current,sender:"DevicesTable",method:"/api/clusters",src:"Frontend",dst:"Matterbridge",params:{plugin:D,endpoint:Number(f)}}))},[D,f,d]),r.useEffect(()=>{if(n===""){L(h),E.current=h;return}const i=h.filter(c=>c.name.toLowerCase().includes(n)||c.serial.toLowerCase().includes(n));L(i),E.current=i},[h,n]);const l=i=>{if(i.uniqueId===F){O(null),z(null),V(null),W(null);return}O(i.uniqueId),z(i.pluginName),V(i.endpoint?i.endpoint.toString():null),W(i.name)};return o&&console.log("DevicesTable rendering..."),p?e.jsxs("div",{style:{display:"flex",flexDirection:"column",margin:"0px",padding:"0px",gap:"20px",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowDiv",style:{margin:"0px",padding:"0px",gap:"0px",maxHeight:`${D&&f?"30%":"100%"}`,width:"100%",flex:"1 1 auto",overflow:"hidden"},children:e.jsx(xt,{name:"Registered devices",getRowKey:zn,onRowClick:l,rows:S,columns:An,footerLeft:`Total devices: ${S.length.toString()}`})}),D&&f&&e.jsx("div",{className:"MbfWindowDiv",style:{margin:"0px",padding:"0px",gap:"0px",height:"50%",maxHeight:"70%",width:"100%",flex:"1 1 auto",overflow:"hidden"},children:e.jsx(xt,{name:"Clusters",title:x||"",getRowKey:qn,rows:j,columns:_n,footerLeft:`Total child endpoints: ${y-1}`})})]}):e.jsx(ke,{})}const Un=r.memo(Bn);function Qn(){const{online:n}=r.useContext(xe),[p,d]=r.useState(""),[s,a]=r.useState("icon");r.useEffect(()=>{const t=localStorage.getItem("devicesFilter");t&&d(t)},[]),r.useEffect(()=>{const t=localStorage.getItem("devicesViewMode");t&&a(t)},[]);const m=t=>{d(t.target.value.toLowerCase()),localStorage.setItem("devicesFilter",t.target.value.toLowerCase())},h=t=>{a(t),localStorage.setItem("devicesViewMode",t)};return o&&console.log("Devices rendering..."),n?e.jsxs(bt,{children:[e.jsxs("div",{className:"MbfWindowBodyRow",style:{justifyContent:"space-between",padding:0,gap:"20px",width:"100%",height:"45px",minHeight:"45px",maxHeight:"45px"},children:[e.jsxs(X,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx(ae,{sx:{fontSize:"16px",fontWeight:"normal",color:"var(--div-text-color)",marginLeft:"5px",whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(me,{variant:"outlined",value:p,onChange:m,placeholder:"Enter the device name or serial number",sx:{width:"320px"},InputProps:{style:{backgroundColor:"var(--main-bg-color)"}}})]}),e.jsxs(X,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx(ae,{sx:{fontSize:"16px",fontWeight:"normal",color:"var(--div-text-color)",marginLeft:"5px",whiteSpace:"nowrap"},children:"View mode:"}),e.jsx(K,{onClick:()=>h("table"),"aria-label":"Table View",disabled:s==="table",children:e.jsx(R,{title:"Table View",children:e.jsx(oo,{style:{color:s==="table"?"var(--main-icon-color)":"var(--primary-color)"}})})}),e.jsx(K,{onClick:()=>h("icon"),"aria-label":"Icon View",disabled:s==="icon",children:e.jsx(R,{title:"Icon View (beta)",children:e.jsx(no,{style:{color:s==="icon"?"var(--main-icon-color)":"var(--primary-color)"}})})})]})]}),s==="table"&&e.jsx(Un,{filter:p}),s==="icon"&&e.jsx(En,{filter:p})]}):e.jsx(ke,{})}const Gn=r.memo(Qn);function Kn(){const[n,p]=r.useState(localStorage.getItem("logFilterLevel")??"info"),[d,s]=r.useState(localStorage.getItem("logFilterSearch")??"*"),[a,m]=r.useState(localStorage.getItem("logAutoScroll")!=="false"),{setMessages:h,setLogFilters:t,online:S,setAutoScroll:L}=r.useContext(xe),j=D=>{p(D.target.value),t(D.target.value,d),localStorage.setItem("logFilterLevel",D.target.value),o&&console.log("handleChangeLevel called with value:",D.target.value)},b=D=>{s(D.target.value),t(n,D.target.value),localStorage.setItem("logFilterSearch",D.target.value),o&&console.log("handleChangeSearch called with value:",D.target.value)},y=D=>{m(D.target.checked),L(D.target.checked),localStorage.setItem("logAutoScroll",D.target.value?"true":"false"),o&&console.log("handleAutoScrollChange called with value:",D.target.checked)},H=()=>{o&&console.log("handleClearLogsClick called"),h([])};return o&&console.log("Logs rendering..."),S?e.jsxs(bt,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",margin:"0px",padding:"0px",gap:"10px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Rt,{id:"select-level",style:{color:"var(--div-text-color)"},children:"Filter log by level:"}),e.jsxs(Qe,{style:{height:"30px",backgroundColor:"var(--main-bg-color)"},labelId:"select-level",id:"debug-level",value:n,onChange:j,children:[e.jsx(I,{value:"debug",children:"Debug"}),e.jsx(I,{value:"info",children:"Info"}),e.jsx(I,{value:"notice",children:"Notice"}),e.jsx(I,{value:"warn",children:"Warn"}),e.jsx(I,{value:"error",children:"Error"}),e.jsx(I,{value:"fatal",children:"Fatal"})]}),e.jsx(Rt,{id:"search",style:{color:"var(--div-text-color)"},children:"Filter log by text:"}),e.jsx(me,{style:{width:"300px"},size:"small",id:"logsearch",variant:"outlined",value:d,onChange:b,InputProps:{style:{height:"30px",padding:"0 0px",backgroundColor:"var(--main-bg-color)"}}}),e.jsx(Re,{control:e.jsx(Oe,{checked:a,onChange:y}),label:"Auto scroll",style:{color:"var(--div-text-color)"}})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:e.jsx(R,{title:"Clear the logs",children:e.jsx(ie,{onClick:H,endIcon:e.jsx(ht,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Clear"})})})]}),e.jsx("div",{style:{flex:"1",overflow:"auto",margin:"0px",padding:"0px"},children:e.jsx(tr,{})})]}):e.jsx(ke,{})}const Jn=r.memo(Kn),Zn=({open:n,ip:p,onClose:d,onSave:s})=>{const a=p?p.split(".").slice(0,3).join(".")+".1":"",[m,h]=r.useState("dhcp"),[t,S]=r.useState({ip:p??"",subnet:"255.255.255.0",gateway:a,dns:a}),L=y=>H=>{S({...t,[y]:H.target.value})},j=()=>{d()},b=()=>{s({type:m,...t}),d()};return e.jsxs(De,{open:n,onClose:(y,H)=>{H==="backdropClick"||H==="escapeKeyDown"||d()},maxWidth:"sm",style:{maxWidth:"550px",margin:"auto"},children:[e.jsx(Pe,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:"Network Configuration"})]})}),e.jsxs(Ne,{dividers:!0,children:[e.jsxs(Zt,{component:"fieldset",fullWidth:!0,children:[e.jsx(Ce,{component:"legend",children:"Select IP Configuration"}),e.jsxs(Yt,{row:!0,value:m,onChange:y=>h(y.target.value),children:[e.jsx(Re,{value:"dhcp",control:e.jsx(ft,{}),label:"DHCP"}),e.jsx(Re,{value:"static",control:e.jsx(ft,{}),label:"Static"})]})]}),m==="static"&&e.jsxs(Te,{container:!0,spacing:2,sx:{mt:2},children:[e.jsx(Te,{size:6,children:e.jsx(me,{label:"IP Address",fullWidth:!0,value:t.ip,onChange:L("ip")})}),e.jsx(Te,{size:6,children:e.jsx(me,{label:"Subnet Mask",fullWidth:!0,value:t.subnet,onChange:L("subnet")})}),e.jsx(Te,{size:6,children:e.jsx(me,{label:"Gateway",fullWidth:!0,value:t.gateway,onChange:L("gateway")})}),e.jsx(Te,{size:6,children:e.jsx(me,{label:"DNS Server",fullWidth:!0,value:t.dns,onChange:L("dns")})})]})]}),e.jsxs(He,{children:[e.jsx(ie,{onClick:j,children:"Cancel"}),e.jsx(ie,{variant:"contained",onClick:b,children:"Save"})]})]})},Yn=({open:n,onClose:p,onSave:d})=>{const[s,a]=r.useState(""),[m,h]=r.useState(""),t=H=>{a(H.target.value)},S=H=>{h(H.target.value)},L=s.length>0&&s===m,j=()=>{p()},b=()=>{L&&(d(s),p())},y=()=>{d(""),p()};return e.jsxs(De,{open:n,onClose:(H,D)=>{D==="backdropClick"||D==="escapeKeyDown"||p()},maxWidth:"sm",style:{maxWidth:"500px",margin:"auto"},disableEscapeKeyDown:!0,children:[e.jsx(Pe,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:"Change Password"})]})}),e.jsx(Ne,{dividers:!0,children:e.jsx(Zt,{component:"fieldset",fullWidth:!0,sx:{margin:0,padding:0,gap:"20px"},children:e.jsxs(Te,{container:!0,spacing:2,sx:{mt:2},children:[e.jsx(Te,{size:12,children:e.jsx(me,{type:"password",autoComplete:"new-password",label:"New Password",size:"small",variant:"outlined",fullWidth:!0,value:s,onChange:t})}),e.jsx(Te,{size:12,children:e.jsx(me,{type:"password",autoComplete:"new-password",label:"Confirm Password",size:"small",variant:"outlined",fullWidth:!0,value:m,onChange:S,error:m!==""&&s!==m,helperText:m!==""&&s!==m?"Passwords do not match":""})})]})})}),e.jsxs(He,{children:[e.jsx(ie,{onClick:j,children:"Cancel"}),e.jsx(ie,{variant:"contained",onClick:b,disabled:!L,children:"Change"}),e.jsx(ie,{variant:"contained",onClick:y,children:"Reset"})]})]})},pe=500;function Xn(){const{online:n,addListener:p,removeListener:d,sendMessage:s,getUniqueId:a}=r.useContext(xe),[m,h]=r.useState(null),[t,S]=r.useState(null),L=r.useRef(a());return r.useEffect(()=>{const j=b=>{b.src==="Matterbridge"&&b.dst==="Frontend"&&(b.method==="refresh_required"&&b.response.changed==="settings"&&(o&&console.log(`Settings received refresh_required: changed=${b.response.changed} and sending /api/settings request`),s({id:L.current,sender:"Settings",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),b.method==="/api/settings"&&(o&&console.log("Settings received /api/settings:",b.response),h(b.response.matterbridgeInformation),S(b.response.systemInformation)))};return p(j,L.current),o&&console.log("Settings added WebSocket listener"),()=>{d(j),o&&console.log("Settings removed WebSocket listener")}},[p,d,s]),r.useEffect(()=>{n&&(o&&console.log("Settings received online"),s({id:L.current,sender:"Settings",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}))},[n,s]),o&&console.log("Settings rendering..."),!n||!m||!t?e.jsx(ke,{}):e.jsx(bt,{children:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"20px",width:"100%"},children:[e.jsx(ei,{matterbridgeInfo:m,systemInfo:t}),e.jsx(ti,{matterbridgeInfo:m}),e.jsx(ri,{matterbridgeInfo:m}),e.jsx(oi,{systemInfo:t})]})})}function ei({matterbridgeInfo:n,systemInfo:p}){const{sendMessage:d,getUniqueId:s}=r.useContext(xe),[a,m]=r.useState("bridge"),[h,t]=r.useState("Info"),[S,L]=r.useState(!1),[j,b]=r.useState("dark"),[y,H]=r.useState(localStorage.getItem("homePagePlugins")!=="false"),[D,z]=r.useState(localStorage.getItem("homePageMode")??"devices"),[f,V]=r.useState(localStorage.getItem("virtualMode")??"outlet"),x=r.useRef(s()),[W,F]=r.useState(!1),O=()=>F(!1),v=U=>{o&&console.log("handleSaveNetConfig called with config:",U),d({id:x.current,sender:"Settings",method:"/api/shellynetconfig",src:"Frontend",dst:"Matterbridge",params:U})},[E,w]=r.useState(!1),l=()=>w(!1),i=U=>{o&&console.log("handleSaveChangePassword called with password:",U),d({id:x.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setpassword",value:U}})};r.useEffect(()=>{n&&(m(n.bridgeMode==="bridge"?"bridge":"childbridge"),t(n.loggerLevel.charAt(0).toUpperCase()+n.loggerLevel.slice(1)),L(n.fileLogger),V(n.virtualMode))},[n]),r.useEffect(()=>{const U=localStorage.getItem("frontendTheme");U&&b(U)},[]);const c=U=>{o&&console.log("handleChangeBridgeMode called with value:",U.target.value),m(U.target.value),d({id:x.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setbridgemode",value:U.target.value}})},u=U=>{o&&console.log("handleChangeMbLoggerLevel called with value:",U.target.value),t(U.target.value),d({id:x.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmbloglevel",value:U.target.value}})},T=U=>{o&&console.log("handleLogOnFileMbChange called with value:",U.target.checked),L(U.target.checked),d({id:x.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmblogfile",value:U.target.checked}})},ue=U=>{const oe=U.target.value;o&&console.log("handleChangeTheme called with value:",oe),b(oe),localStorage.setItem("frontendTheme",oe),document.body.setAttribute("frontend-theme",oe)},te=U=>{const oe=U.target.checked;o&&console.log("handleChangeHomePagePlugins called with value:",oe),H(oe),localStorage.setItem("homePagePlugins",oe?"true":"false")},Y=U=>{const oe=U.target.value;o&&console.log("handleChangeHomePageMode called with value:",oe),z(oe),localStorage.setItem("homePageMode",oe)},ve=U=>{const oe=U.target.value;o&&console.log("handleChangeVirtualMode called with value:",oe),V(oe),localStorage.setItem("virtualMode",oe),d({id:x.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setvirtualmode",value:oe}})};return!n||!p?null:e.jsxs(Ve,{style:{width:`${pe}px`,maxWidth:`${pe}px`},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge settings"})}),e.jsx(Zn,{open:W,ip:p.ipv4Address,onClose:O,onSave:v}),e.jsx(Yn,{open:E,onClose:l,onSave:i}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(X,{sx:{gap:"10px",margin:"0px",padding:"10px",width:`${pe-20}px`,backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px"},id:"matterbridgeInfo-mode",children:"Matterbridge mode:"}),e.jsxs(Yt,{row:!0,name:"mode-buttons-group",value:a,onChange:c,children:[e.jsx(Re,{value:"bridge",control:e.jsx(ft,{}),label:"Bridge",disabled:n.readOnly===!0}),e.jsx(Re,{value:"childbridge",control:e.jsx(ft,{}),label:"Childbridge",disabled:n.readOnly===!0})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px"},id:"mblogger-level-label",children:"Logger level:"}),e.jsxs(Qe,{style:{height:"30px"},labelId:"mblogger-level-label",id:"mblogger-level",value:h,onChange:u,children:[e.jsx(I,{value:"Debug",children:"Debug"}),e.jsx(I,{value:"Info",children:"Info"}),e.jsx(I,{value:"Notice",children:"Notice"}),e.jsx(I,{value:"Warn",children:"Warn"}),e.jsx(I,{value:"Error",children:"Error"}),e.jsx(I,{value:"Fatal",children:"Fatal"})]}),e.jsx(Re,{style:{padding:"0px",margin:"0px"},control:e.jsx(Oe,{checked:S,onChange:T,name:"logOnFileMb"}),label:"Log on file:",labelPlacement:"start"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px"},id:"frontend-theme-label",children:"Frontend theme:"}),e.jsxs(Qe,{style:{height:"30px"},labelId:"frontend-theme-label",id:"frontend-theme",value:j,onChange:ue,children:[e.jsx(I,{value:"classic",children:"Classic"}),e.jsx(I,{value:"light",children:"Light"}),e.jsx(I,{value:"dark",children:"Dark"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px"},id:"frontend-home-plugin-label",children:"Home page plugins:"}),e.jsx(Oe,{checked:y,onChange:te,name:"showPlugins"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px"},id:"frontend-home-label",children:"Home page bottom panel:"}),e.jsxs(Qe,{style:{height:"30px"},labelId:"frontend-home-label",id:"frontend-home",value:D,onChange:Y,children:[e.jsx(I,{value:"logs",children:"Logs"}),e.jsx(I,{value:"devices",children:"Devices"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"10px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px"},id:"frontend-virtual-label",children:"Virtual devices:"}),e.jsxs(Qe,{style:{height:"30px"},labelId:"frontend-virtual-label",id:"frontend-virtual",value:f,onChange:ve,children:[e.jsx(I,{value:"disabled",children:"Disabled"}),e.jsx(I,{value:"outlet",children:"Outlet"}),e.jsx(I,{value:"light",children:"Light"}),e.jsx(I,{value:"switch",children:"Switch"}),e.jsx(I,{value:"mounted_switch",children:"Mounted Switch"})]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"20px"},children:e.jsx(ie,{variant:"contained",color:"primary",onClick:()=>w(!0),children:"Change password"})}),n.shellyBoard&&e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"20px"},children:e.jsx(ie,{variant:"contained",color:"primary",onClick:()=>F(!0),children:"Configure IP"})})]})})]})}function ti({matterbridgeInfo:n}){const{sendMessage:p,getUniqueId:d}=r.useContext(xe),[s,a]=r.useState("Info"),[m,h]=r.useState(!1),[t,S]=r.useState(""),[L,j]=r.useState(""),[b,y]=r.useState(""),[H,D]=r.useState(""),[z,f]=r.useState(""),[V,x]=r.useState(""),W=r.useRef(d());r.useEffect(()=>{n&&(a(["Debug","Info","Notice","Warn","Error","Fatal"][n.matterLoggerLevel]),h(n.matterFileLogger),S(n.matterMdnsInterface||""),j(n.matterIpv4Address||""),y(n.matterIpv6Address||""),D(n.matterPort?n.matterPort.toString():""),f(n.matterDiscriminator?n.matterDiscriminator.toString():""),x(n.matterPasscode?n.matterPasscode.toString():""))},[n]);const F=u=>{o&&console.log("handleChangeMjLoggerLevel called with value:",u.target.value),a(u.target.value),p({id:W.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmjloglevel",value:u.target.value}})},O=u=>{o&&console.log("handleLogOnFileMjChange called with value:",u.target.checked),h(u.target.checked),p({id:W.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmjlogfile",value:u.target.checked}})},v=u=>{o&&console.log("handleChangeMdnsInterface called with value:",u.target.value),S(u.target.value),p({id:W.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmdnsinterface",value:u.target.value}})},E=u=>{o&&console.log("handleChangeIpv4Address called with value:",u.target.value),j(u.target.value),p({id:W.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setipv4address",value:u.target.value}})},w=u=>{o&&console.log("handleChangeIpv6Address called with value:",u.target.value),y(u.target.value),p({id:W.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setipv6address",value:u.target.value}})},l=u=>{o&&console.log("handleChangeMatterPort called with value:",u.target.value),D(u.target.value),p({id:W.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterport",value:u.target.value}})},i=u=>{o&&console.log("handleChangeMatterDiscriminator called with value:",u.target.value),f(u.target.value),p({id:W.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterdiscriminator",value:u.target.value}})},c=u=>{o&&console.log("handleChangemMatterPasscode called with value:",u.target.value),x(u.target.value),p({id:W.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterpasscode",value:u.target.value}})};return n?e.jsxs(Ve,{style:{width:`${pe}px`,maxWidth:`${pe}px`},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matter settings"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(X,{sx:{gap:"20px",margin:"0px",padding:"10px",width:`${pe-20}px`,backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"5px",gap:"15px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px"},id:"mjdebug-info",children:"Logger level:"}),e.jsxs(Qe,{style:{height:"30px"},labelId:"select-mjlevel",id:"mjdebug-level",value:s,onChange:F,children:[e.jsx(I,{value:"Debug",children:"Debug"}),e.jsx(I,{value:"Info",children:"Info"}),e.jsx(I,{value:"Notice",children:"Notice"}),e.jsx(I,{value:"Warn",children:"Warn"}),e.jsx(I,{value:"Error",children:"Error"}),e.jsx(I,{value:"Fatal",children:"Fatal"})]}),e.jsx(Re,{style:{padding:"0px",margin:"0px"},control:e.jsx(Oe,{checked:m,onChange:O,name:"logOnFileMj"}),label:"Log on file:",labelPlacement:"start"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px",gap:"15px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px",textWrap:"nowrap"},children:"Mdns interface:"}),e.jsx(me,{value:t,onChange:v,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px",gap:"15px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px",textWrap:"nowrap"},children:"Ipv4 address:"}),e.jsx(me,{value:L,onChange:E,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px",gap:"15px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px",textWrap:"nowrap"},children:"Ipv6 address:"}),e.jsx(me,{value:b,onChange:w,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px",gap:"15px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px",textWrap:"nowrap"},children:"Commissioning port:"}),e.jsx(me,{value:H,onChange:l,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px",gap:"15px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px",textWrap:"nowrap"},children:"Commissioning discriminator:"}),e.jsx(me,{value:z,onChange:i,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px",gap:"15px"},children:[e.jsx(Ce,{style:{padding:"0px",margin:"0px",textWrap:"nowrap"},children:"Commissioning passcode:"}),e.jsx(me,{value:V,onChange:c,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]})]})})]}):null}function ri({matterbridgeInfo:n}){return n?e.jsxs(Ve,{style:{width:`${pe}px`,maxWidth:`${pe}px`},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge info"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(X,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsx(Se,{value:n.matterbridgeVersion,label:"Current Version",width:pe}),e.jsx(Se,{value:n.matterbridgeLatestVersion,label:"Latest Version",width:pe}),e.jsx(Se,{value:n.homeDirectory,label:"Home Directory",width:pe}),e.jsx(Se,{value:n.rootDirectory,label:"Root Directory",width:pe}),e.jsx(Se,{value:n.matterbridgeDirectory,label:"Matterbridge Storage Directory",width:pe}),e.jsx(Se,{value:n.matterbridgePluginDirectory,label:"Matterbridge Plugin Directory",width:pe}),e.jsx(Se,{value:n.globalModulesDirectory,label:"Global Module Directory",width:pe})]})})]}):null}function oi({systemInfo:n}){return n?e.jsxs(Ve,{style:{width:`${pe}px`,maxWidth:`${pe}px`},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"System info"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(X,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsx(Se,{value:n.interfaceName,label:"Interface name",width:pe}),e.jsx(Se,{value:n.macAddress,label:"MAC Address",width:pe}),e.jsx(Se,{value:n.ipv4Address,label:"IPv4 Address",width:pe}),e.jsx(Se,{value:n.ipv6Address,label:"IPv6 Address",width:pe}),e.jsx(Se,{value:n.nodeVersion,label:"Node Version",width:pe}),e.jsx(Se,{value:n.hostname,label:"Hostname",width:pe}),e.jsx(Se,{value:n.user,label:"User",width:pe})]})})]}):null}function Se({value:n,label:p,width:d}){return e.jsx(me,{focused:!0,value:n,size:"small",label:p,variant:"standard",sx:{width:d?`${d-20}px`:"400px"},InputProps:{readOnly:!0,sx:{color:"var(--div-text-color)","&:before":{borderBottomColor:"var(--main-label-color)"},"&:after":{borderBottomColor:"var(--main-label-color)"}}},InputLabelProps:{sx:{marginTop:"3px",color:"var(--main-label-color)","&.Mui-focused":{color:"var(--main-label-color)"}}}})}const ni=r.memo(Xn);function ii(){const{online:n,sendMessage:p,addListener:d,removeListener:s,getUniqueId:a}=r.useContext(xe),{showSnackbarMessage:m}=r.useContext(Ge),[h,t]=r.useState(null),[S,L]=r.useState([]),[j,b]=r.useState([]),[y,H]=r.useState(null),[D,z]=r.useState({cpuUsage:0}),[f,V]=r.useState({totalMemory:"",freeMemory:"",heapTotal:"",heapUsed:"",external:"",arrayBuffers:"",rss:""}),[x,W]=r.useState({systemUptime:"",processUptime:""}),F=r.useRef(a());return o&&console.log("Test uniqueId:",F),r.useEffect(()=>{o&&console.log("Test useEffect WebSocketMessage mounting");const O=v=>{if(v.method==="restart_required")o&&console.log("Test received restart_required"),m("Restart required",0);else if(v.method==="refresh_required")o&&console.log(`Test received refresh_required: changed=${v.response.changed} and sending api requests`),m("Refresh required",0),p({id:F.current,method:"/api/settings",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),p({id:F.current,method:"/api/plugins",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),p({id:F.current,method:"/api/devices",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}});else if(v.method==="memory_update")o&&console.log("Test received memory_update",v),V(v.response);else if(v.method==="cpu_update")o&&console.log("Test received cpu_update",v),z(v.response);else if(v.method==="uptime_update")o&&console.log("Test received uptime_update",v),W(v.response);else if(v.method==="/api/settings"&&v.response)o&&console.log("Test received /api/settings:",v.response),m("Test received /api/settings",0),t(v.response);else if(v.method==="/api/plugins"&&v.response)o&&console.log(`Test received ${v.response.length} plugins:`,v.response),m("Test received /api/plugins",0),L(v.response);else if(v.method==="/api/devices"&&v.response){o&&console.log(`Test received ${v.response.length} devices:`,v.response),m("Test received /api/devices",0),b(v.response);for(const E of v.response)o&&console.log("Test sending /api/clusters for device:",E.pluginName,E.name,E.endpoint),p({id:F.current,method:"/api/clusters",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{plugin:E.pluginName,endpoint:E.endpoint||0}})}else v.method==="/api/clusters"&&v.response&&(o&&console.log(`Test received ${v.response.clusters.length} clusters for device ${v.response.deviceName} endpoint ${v.response.id}:${v.response.number}:`,v),m(`Test received /api/clusters for ${v.response.plugin}::${v.response.deviceName}`,0),H(v.response))};return d(O,F.current),o&&console.log("Test useEffect WebSocketMessage mounted"),()=>{o&&console.log("Test useEffect WebSocketMessage unmounting"),s(O),o&&console.log("Test useEffect WebSocketMessage unmounted")}},[d,s,p,m]),r.useEffect(()=>(o&&console.log("Test useEffect online mounting"),n&&o&&console.log("Test useEffect online received online"),o&&console.log("Test useEffect online mounted"),()=>{o&&console.log("Test useEffect online unmounted")}),[n,p,m]),o&&console.log("Test rendering..."),n?e.jsx("div",{className:"MbfPageDiv",style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"20px",width:"100%"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"256px",width:"256px",margin:"10px"}}),e.jsx("p",{children:"Welcome to the Test page of the Matterbridge frontend"})]})}):e.jsx(ke,{})}const si=r.memo(ii);function ai(n,p){o&&console.log("getCssVariable:",n,"defaultValue",p);const d=getComputedStyle(document.body).getPropertyValue(n).trim();return d||console.error("getCssVariable: undefined",d),d||p}function li(n){return io({palette:{primary:{main:n},action:{disabled:"var(--main-label-color)"},text:{disabled:"var(--main-label-color)"}},typography:{fontFamily:"Roboto, Helvetica, Arial, sans-serif"},components:{MuiDialog:{styleOverrides:{paper:{color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",border:"2px solid var(--div-border-color)",borderRadius:"var(--div-border-radius)",boxShadow:"2px 2px 5px var(--div-shadow-color)"}}},MuiTooltip:{defaultProps:{placement:"top-start",arrow:!0}},MuiButton:{styleOverrides:{root:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)","&:hover":{backgroundColor:"var(--main-button-bg-color)"},"&.Mui-disabled":{color:"var(--main-button-color)",backgroundColor:"var(--main-grey-color)"}},contained:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},outlined:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},text:{color:"var(--main-button-color)"}},defaultProps:{variant:"contained",size:"small"}},MuiIconButton:{styleOverrides:{root:{color:"var(--main-icon-color)","&:hover .MuiSvgIcon-root":{color:"var(--primary-color)"}}}},MuiCheckbox:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-checked":{color:"var(--primary-color)"}}}},MuiTextField:{defaultProps:{size:"small",variant:"outlined",fullWidth:!0}},MuiOutlinedInput:{styleOverrides:{root:{backgroundColor:"var(--div-bg-color)","& .MuiOutlinedInput-notchedOutline":{borderColor:"var(--main-label-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--main-text-color)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"var(--primary-color)"},padding:"0px"},input:{color:"var(--div-text-color)",padding:"4px 8px"}}},MuiInputLabel:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-focused":{color:"var(--primary-color)"}}}},MuiFormLabel:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-focused":{color:"var(--main-label-color)"}}}},MuiFormControl:{styleOverrides:{root:{color:"var(--main-grey-color)"}}},MuiRadio:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-checked":{color:"var(--primary-color)"}}}},MuiSelect:{styleOverrides:{root:{backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)",height:"30px","&:hover":{borderColor:"var(--main-text-color)"},"&.Mui-focused":{borderColor:"var(--primary-color)"}}}},MuiMenu:{styleOverrides:{paper:{backgroundColor:"var(--main-menu-bg-color)",padding:"0px",margin:"0px"},list:{padding:"0px"}}},MuiMenuItem:{styleOverrides:{root:{color:"var(--main-menu-color)",backgroundColor:"var(--main-menu-bg-color)","&:hover":{backgroundColor:"var(--main-menu-hover-color)"},"&.Mui-selected":{color:"var(--main-menu-color)",backgroundColor:"var(--main-menu-bg-color)"},"&.Mui-selected:hover":{backgroundColor:"var(--main-menu-hover-color)"}}}},MuiListItemButton:{styleOverrides:{root:{cursor:"pointer","&:hover":{backgroundColor:"var(--main-bg-color)"}}}},MuiListItemIcon:{styleOverrides:{root:{color:"var(--div-text-color)"}}},MuiListItemText:{styleOverrides:{primary:{fontSize:"16px",fontWeight:"bold",color:"var(--div-text-color)"},secondary:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"}}}}})}function di(){const{showSnackbarMessage:n,showConfirmCancelDialog:p}=r.useContext(Ge),{online:d,sendMessage:s,logMessage:a,addListener:m,removeListener:h,getUniqueId:t}=r.useContext(xe),[S,L]=r.useState(!1),[j,b]=r.useState(!1),[y,H]=r.useState(!1),[D,z]=r.useState(!1),[f,V]=r.useState(null),x=r.useRef(t()),[W,F]=r.useState(null),[O,v]=r.useState(null),[E,w]=r.useState(null),[l,i]=r.useState(null),[c,u]=r.useState(null),T=()=>{window.open("https://www.buymeacoffee.com/luligugithub","_blank")},ue=()=>{window.open("https://github.com/Luligu/matterbridge/blob/main/README.md","_blank")},te=()=>{f?.matterbridgeInformation.matterbridgeVersion.includes("-dev-")?window.open("https://github.com/Luligu/matterbridge/blob/dev/CHANGELOG.md","_blank"):window.open("https://github.com/Luligu/matterbridge/blob/main/CHANGELOG.md","_blank")},Y=()=>{window.open("https://discord.gg/QX58CDe6hd","_blank")},ve=()=>{window.open("https://github.com/Luligu/matterbridge","_blank")},U=()=>{s({id:x.current,sender:"Header",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:"matterbridge",restart:!0}})},oe=()=>{s({id:x.current,sender:"Header",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:"matterbridge@dev",restart:!0}})},$=()=>{s({id:x.current,sender:"Header",method:"/api/checkupdates",src:"Frontend",dst:"Matterbridge",params:{}})},Q=()=>{o&&console.log("Header: handleShellySystemUpdateClick"),a("Matterbridge","Installing system updates..."),s({id:x.current,sender:"Header",method:"/api/shellysysupdate",src:"Frontend",dst:"Matterbridge",params:{}})},P=()=>{o&&console.log("Header: handleShellyMainUpdateClick"),a("Matterbridge","Installing software updates..."),s({id:x.current,sender:"Header",method:"/api/shellymainupdate",src:"Frontend",dst:"Matterbridge",params:{}})},N=()=>{o&&console.log("Header: handleShellyCreateSystemLog"),s({id:x.current,sender:"Header",method:"/api/shellycreatesystemlog",src:"Frontend",dst:"Matterbridge",params:{}})},C=()=>{o&&console.log("Header: handleShellyDownloadSystemLog"),a("Matterbridge","Downloading Shelly system log..."),n("Downloading Shelly system log...",5),window.location.href="./api/shellydownloadsystemlog"},k=()=>{f?.matterbridgeInformation.restartMode===""?s({id:x.current,sender:"Header",method:"/api/restart",src:"Frontend",dst:"Matterbridge",params:{}}):s({id:x.current,sender:"Header",method:"/api/shutdown",src:"Frontend",dst:"Matterbridge",params:{}})},A=()=>{s({id:x.current,sender:"Header",method:"/api/shutdown",src:"Frontend",dst:"Matterbridge",params:{}})},ee=()=>{s({id:x.current,sender:"Header",method:"/api/reboot",src:"Frontend",dst:"Matterbridge",params:{}})},ce=()=>{s({id:x.current,sender:"Header",method:"/api/softreset",src:"Frontend",dst:"Matterbridge",params:{}})},le=()=>{s({id:x.current,sender:"Header",method:"/api/hardreset",src:"Frontend",dst:"Matterbridge",params:{}})},de=G=>{F(G.currentTarget)},_=G=>{o&&console.log("Header: handleMenuClose",G),F(null),G==="download-mblog"?(a("Matterbridge","Downloading matterbridge log..."),n("Downloading matterbridge log...",5),window.location.href="./api/download-mblog"):G==="download-mjlog"?(a("Matterbridge","Downloading matter log..."),n("Downloading matter log...",5),window.location.href="./api/download-mjlog"):G==="view-mblog"?(a("Matterbridge","Loading matterbridge log..."),n("Loading matterbridge log...",5),window.location.href="./api/view-mblog"):G==="view-mjlog"?(a("Matterbridge","Loading matter log..."),n("Loading matter log...",5),window.location.href="./api/view-mjlog"):G==="view-shellylog"?(a("Matterbridge","Loading shelly system log..."),n("Loading shelly system log...",5),window.location.href="./api/shellyviewsystemlog"):G==="download-mbstorage"?(a("Matterbridge","Downloading matterbridge storage..."),n("Downloading matterbridge storage...",5),window.location.href="./api/download-mbstorage"):G==="download-pluginstorage"?(a("Matterbridge","Downloading matterbridge plugins storage..."),n("Downloading matterbridge plugins storage...",5),window.location.href="./api/download-pluginstorage"):G==="download-pluginconfig"?(a("Matterbridge","Downloading matterbridge plugins config..."),n("Downloading matterbridge plugins config...",5),window.location.href="./api/download-pluginconfig"):G==="download-mjstorage"?(a("Matterbridge","Downloading matter storage..."),n("Downloading matter storage...",5),window.location.href="./api/download-mjstorage"):G==="download-backup"?(a("Matterbridge","Downloading backup..."),n("Downloading backup...",10),window.location.href="./api/download-backup"):G==="update"?U():G==="updatedev"?oe():G==="updatecheck"?$():G==="shelly-sys-update"?Q():G==="shelly-main-update"?P():G==="shelly-create-system-log"?N():G==="shelly-download-system-log"?C():G==="softreset"?ce():G==="hardreset"?le():G==="restart"?k():G==="shutdown"?A():G==="reboot"?ee():G==="create-backup"?s({id:x.current,sender:"Header",method:"/api/create-backup",src:"Frontend",dst:"Matterbridge",params:{}}):G==="unregister"?s({id:x.current,sender:"Header",method:"/api/unregister",src:"Frontend",dst:"Matterbridge",params:{}}):G==="reset"?s({id:x.current,sender:"Header",method:"/api/reset",src:"Frontend",dst:"Matterbridge",params:{}}):G==="factoryreset"&&s({id:x.current,sender:"Header",method:"/api/factoryreset",src:"Frontend",dst:"Matterbridge",params:{}})},se=G=>{o&&console.log("Header: handleMenuCloseCancel:",G),F(null)},Z=G=>{v(G.currentTarget)},g=()=>{v(null)},be=G=>{w(G.currentTarget)},ye=()=>{w(null)},he=G=>{i(G.currentTarget)},J=()=>{i(null)},ge=G=>{u(G.currentTarget)},we=()=>{u(null)},Ke=()=>{ui(),o&&console.log("Matterbridge logo clicked: debug is now",o)};return r.useEffect(()=>{const G=M=>{o&&console.log("Header received WebSocket Message:",M),M.method==="/api/settings"&&M.id===x.current?(o&&console.log("Header received settings:",M.response),V(M.response),L(M.response.matterbridgeInformation.restartRequired||M.response.matterbridgeInformation.fixedRestartRequired),b(M.response.matterbridgeInformation.fixedRestartRequired),H(M.response.matterbridgeInformation.updateRequired)):M.method==="refresh_required"&&M.response.changed==="settings"?(o&&console.log(`Header received refresh_required: changed=${M.response.changed} and sending /api/settings request`),s({id:x.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})):M.method==="restart_required"?(o&&console.log(`Header received restart_required with fixed: ${M.response.fixed}`),L(!0),M.response.fixed===!0&&b(!0)):M.method==="restart_not_required"?(o&&console.log("Header received restart_not_required"),L(!1)):M.method==="update_required"?(o&&console.log("Header received update_required"),M.response.devVersion===!0?z(!0):H(!0),s({id:x.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})):M.method==="shelly_sys_update"?(o&&console.log("Header received WS_ID_SHELLY_SYS_UPDATE:"),V(fe=>fe?{matterbridgeInformation:{...fe.matterbridgeInformation,shellySysUpdate:M.response.available},systemInformation:fe.systemInformation}:null)):M.method==="shelly_main_update"&&(o&&console.log("Header received WS_ID_SHELLY_MAIN_UPDATE:"),V(fe=>fe?{matterbridgeInformation:{...fe.matterbridgeInformation,shellyMainUpdate:M.response.available},systemInformation:fe.systemInformation}:null))};return m(G,x.current),o&&console.log(`Header added WebSocket listener id ${x.current}`),()=>{h(G),o&&console.log("Header removed WebSocket listener")}},[m,h,s,n]),r.useEffect(()=>{d&&(o&&console.log("Header sending /api/settings requests"),s({id:x.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}))},[d,s]),o&&console.log("Header rendering..."),!d||!f?null:e.jsxs("div",{className:"header",children:[e.jsxs("div",{className:"sub-header",children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"30px"},onClick:Ke}),e.jsx("h2",{style:{fontSize:"22px",color:"var(--main-icon-color)",margin:"0px"},children:"Matterbridge"}),e.jsxs("nav",{children:[e.jsx(et,{to:"/",className:"nav-link",children:"Home"}),e.jsx(et,{to:"/devices",className:"nav-link",children:"Devices"}),e.jsx(et,{to:"/log",className:"nav-link",children:"Logs"}),e.jsx(et,{to:"/settings",className:"nav-link",children:"Settings"})]})]}),e.jsxs("div",{className:"sub-header",children:[!f.matterbridgeInformation.readOnly&&y&&e.jsx(R,{title:"New Matterbridge version available, click to install",children:e.jsxs("span",{className:"status-warning",onClick:U,children:["Update to v.",f.matterbridgeInformation.matterbridgeLatestVersion]})}),!f.matterbridgeInformation.readOnly&&D&&e.jsx(R,{title:"New Matterbridge dev version available, click to install",children:e.jsxs("span",{className:"status-warning",onClick:oe,children:["Update to new dev v.",f.matterbridgeInformation.matterbridgeDevVersion.split("-dev-")[0]]})}),!f.matterbridgeInformation.readOnly&&e.jsx(R,{title:"Matterbridge version, click to see the changelog",children:e.jsxs("span",{className:"status-information",onClick:te,children:["v.",f.matterbridgeInformation.matterbridgeVersion]})}),f.matterbridgeInformation.shellyBoard&&e.jsx("img",{src:"Shelly.svg",alt:"Shelly Icon",style:{height:"30px",padding:"0px",margin:"0px",marginRight:"30px"}}),f.matterbridgeInformation.bridgeMode!==""&&f.matterbridgeInformation.readOnly===!1?e.jsx(R,{title:"Bridge mode",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:f.matterbridgeInformation.bridgeMode})}):null,f.matterbridgeInformation.restartMode!==""&&f.matterbridgeInformation.readOnly===!1?e.jsx(R,{title:"Restart mode",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:f.matterbridgeInformation.restartMode})}):null,f.matterbridgeInformation.profile&&f.matterbridgeInformation.profile!==""&&f.matterbridgeInformation.readOnly===!1?e.jsx(R,{title:"Current profile",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:f.matterbridgeInformation.profile})}):null]}),e.jsxs("div",{className:"sub-header",style:{gap:"5px"},children:[f.matterbridgeInformation.readOnly===!1?e.jsx(R,{title:"Matterbridge discord group",children:e.jsx("img",{src:"discord.svg",alt:"Discord Logo",style:{cursor:"pointer",height:"25px"},onClick:Y})}):null,f.matterbridgeInformation.readOnly===!1?e.jsx(R,{title:"Give a star to Matterbridge",children:e.jsx(K,{style:{color:"#FFD700",margin:"0",padding:"0"},onClick:ve,children:e.jsx(so,{})})}):null,f.matterbridgeInformation.readOnly===!1?e.jsx(R,{title:"Sponsor Matterbridge",children:e.jsx(K,{style:{color:"#b6409c",margin:"0",padding:"0"},onClick:T,children:e.jsx(Gt,{})})}):null,e.jsx(R,{title:"Matterbridge help",children:e.jsx(K,{style:{color:"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:ue,children:e.jsx(ao,{})})}),e.jsx(R,{title:"Matterbridge changelog",children:e.jsx(K,{style:{color:"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:te,children:e.jsx(Jt,{})})}),f.matterbridgeInformation&&!f.matterbridgeInformation.readOnly&&e.jsx(R,{title:"Update matterbridge to latest version",children:e.jsx(K,{style:{color:y?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:U,children:e.jsx(Fe,{})})}),f.matterbridgeInformation&&f.matterbridgeInformation.shellyBoard&&f.matterbridgeInformation.shellySysUpdate&&e.jsx(R,{title:"Shelly system update",children:e.jsx(K,{style:{color:"var(--primary-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:Q,children:e.jsx(Fe,{})})}),f.matterbridgeInformation&&f.matterbridgeInformation.shellyBoard&&f.matterbridgeInformation.shellyMainUpdate&&e.jsx(R,{title:"Shelly software update",children:e.jsx(K,{style:{color:"var(--primary-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:P,children:e.jsx(Fe,{})})}),e.jsx(R,{title:"Restart matterbridge",children:e.jsx(K,{style:{color:S||j?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:k,children:e.jsx(gt,{})})}),f.matterbridgeInformation.restartMode===""?e.jsx(R,{title:"Shut down matterbridge",children:e.jsx(K,{style:{color:S||j?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:A,children:e.jsx(Ee,{})})}):null,e.jsx(R,{title:"Download, backup and more",children:e.jsx(K,{onClick:de,children:e.jsx(lo,{style:{color:"var(--main-icon-color)"}})})}),e.jsxs(Ue,{id:"command-menu",anchorEl:W,keepMounted:!0,open:!!W,onClose:()=>_(""),children:[f.matterbridgeInformation&&!f.matterbridgeInformation.readOnly&&e.jsxs(I,{onClick:()=>_("update"),children:[e.jsx(B,{children:e.jsx(Fe,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Install latest stable",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),f.matterbridgeInformation&&!f.matterbridgeInformation.readOnly&&e.jsxs(I,{onClick:()=>_("updatedev"),children:[e.jsx(B,{children:e.jsx(Fe,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Install latest dev",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),f.matterbridgeInformation&&!f.matterbridgeInformation.readOnly&&e.jsxs(I,{onClick:()=>_("updatecheck"),children:[e.jsx(B,{children:e.jsx(Fe,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Check for updates",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),f.matterbridgeInformation&&f.matterbridgeInformation.shellyBoard&&f.matterbridgeInformation.shellySysUpdate&&e.jsxs(I,{onClick:()=>_("shelly-sys-update"),children:[e.jsx(B,{children:e.jsx(Fe,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Shelly system update",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),f.matterbridgeInformation&&f.matterbridgeInformation.shellyBoard&&f.matterbridgeInformation.shellyMainUpdate&&e.jsxs(I,{onClick:()=>_("shelly-main-update"),children:[e.jsx(B,{children:e.jsx(Fe,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Shelly software update",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(I,{onClick:()=>_("restart"),children:[e.jsx(B,{children:e.jsx(gt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Restart",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),f.matterbridgeInformation.restartMode===""?e.jsxs(I,{onClick:()=>_("shutdown"),children:[e.jsx(B,{children:e.jsx(Ee,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Shutdown",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}):null,f.matterbridgeInformation&&f.matterbridgeInformation.shellyBoard&&e.jsxs(I,{onClick:()=>{p("Reboot","Are you sure you want to reboot the Shelly board?","reboot",_,se)},children:[e.jsx(B,{children:e.jsx(gt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Reboot...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsx(it,{}),e.jsxs(I,{onClick:be,children:[e.jsx(B,{children:e.jsx(st,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"View",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(Ue,{id:"sub-menu-view",anchorEl:E,keepMounted:!0,open:!!E,onClose:ye,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(I,{onClick:()=>{_("view-mblog"),ye()},children:[e.jsx(B,{children:e.jsx(st,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matterbridge log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(I,{onClick:()=>{_("view-mjlog"),ye()},children:[e.jsx(B,{children:e.jsx(st,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matter log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),f.matterbridgeInformation&&f.matterbridgeInformation.shellyBoard&&e.jsxs(I,{onClick:()=>{_("view-shellylog"),ye()},children:[e.jsx(B,{children:e.jsx(st,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(it,{}),e.jsxs(I,{onClick:he,children:[e.jsx(B,{children:e.jsx(Ie,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Download",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(Ue,{id:"sub-menu-download",anchorEl:l,keepMounted:!0,open:!!l,onClose:J,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(I,{onClick:()=>{_("download-mbstorage"),J()},children:[e.jsx(B,{children:e.jsx(Ie,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matterbridge storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(I,{onClick:()=>{_("download-pluginstorage"),J()},children:[e.jsx(B,{children:e.jsx(Ie,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matterbridge plugins storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(I,{onClick:()=>{_("download-pluginconfig"),J()},children:[e.jsx(B,{children:e.jsx(Ie,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matterbridge plugins config",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(I,{onClick:()=>{_("download-mblog"),J()},children:[e.jsx(B,{children:e.jsx(Ie,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matterbridge log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(I,{onClick:()=>{_("download-mjstorage"),J()},children:[e.jsx(B,{children:e.jsx(Ie,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matter storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(I,{onClick:()=>{_("download-mjlog"),J()},children:[e.jsx(B,{children:e.jsx(Ie,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Matter log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),f.matterbridgeInformation&&f.matterbridgeInformation.shellyBoard&&e.jsxs(I,{onClick:()=>{_("shelly-create-system-log"),J()},children:[e.jsx(B,{children:e.jsx(Ie,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Create Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),f.matterbridgeInformation&&f.matterbridgeInformation.shellyBoard&&e.jsxs(I,{onClick:()=>{_("shelly-download-system-log"),J()},children:[e.jsx(B,{children:e.jsx(Ie,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Download Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(it,{}),e.jsxs(I,{onClick:Z,children:[e.jsx(B,{children:e.jsx(vt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(Ue,{id:"sub-menu-backup",anchorEl:O,keepMounted:!0,open:!!O,onClose:g,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(I,{onClick:()=>{_("create-backup"),g()},children:[e.jsx(B,{children:e.jsx(vt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Create backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(I,{onClick:()=>{_("download-backup"),g()},children:[e.jsx(B,{children:e.jsx(vt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Download backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(it,{}),e.jsxs(I,{onClick:ge,children:[e.jsx(B,{children:e.jsx(co,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Reset",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(Ue,{id:"sub-menu-reset",anchorEl:c,keepMounted:!0,open:!!c,onClose:we,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(I,{onClick:()=>{we(),p("Reset all devices and shutdown","Are you sure you want to unregister all devices? This will temporarily remove all devices from the controller and you may loose the controller configuration.","unregister",_,se)},children:[e.jsx(B,{children:e.jsx(Ee,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Reset all devices...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(I,{onClick:()=>{we(),p("Reset commissioning and shutdown","Are you sure you want to reset the commissioning? You will have to manually remove Matterbridge from the controller.","reset",_,se)},children:[e.jsx(B,{children:e.jsx(Ee,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Reset commissioning...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),!f.matterbridgeInformation.readOnly&&e.jsxs(I,{onClick:()=>{we(),p("Factory reset and shutdown","Are you sure you want to factory reset Matterbridge? You will have to manually remove Matterbridge from the controller.","factoryreset",_,se)},children:[e.jsx(B,{children:e.jsx(Ee,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Factory reset...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),f.matterbridgeInformation&&f.matterbridgeInformation.shellyBoard&&e.jsxs(I,{onClick:()=>{we(),p("Network reset","Are you sure you want to factory reset the network parameters?","softreset",_,se)},children:[e.jsx(B,{children:e.jsx(Ee,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Reset network...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),f.matterbridgeInformation&&f.matterbridgeInformation.shellyBoard&&e.jsxs(I,{onClick:()=>{we(),p("Factory reset","Are you sure you want to factory reset Matterbridge? You will have to manually remove Matterbridge from the controller.","hardreset",_,se)},children:[e.jsx(B,{children:e.jsx(Ee,{style:{color:"var(--main-icon-color)"}})}),e.jsx(re,{primary:"Factory reset...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]})]})]})]})}const ci=r.memo(di),rr=1300,or=1024;let Ct,St,pt,Mt;function Ut(){return typeof window<"u"?(Ct=Math.floor(window.visualViewport?.width??window.innerWidth),St=Math.floor(window.visualViewport?.height??window.innerHeight),o&&console.log("Visual viewport width %i height %i",Ct,St),pt=Ct<rr||St<or,Mt=!pt,o&&console.log("Mobile %s desktop %s",pt,Mt),pt):!1}function pi({children:n}){const[p,d]=r.useState(Ut());return r.useEffect(()=>{function s(){d(Ut())}return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),o&&console.log("MbfScreen rendering... mobile %s desktop %s",p,Mt),e.jsxs("div",{style:{display:"flex",flexDirection:"column",overflow:"hidden",width:p?`${rr}px`:"calc(100vw - 40px)",height:p?`${or}px`:"calc(100vh - 40px)",margin:"0px",padding:"20px",gap:"20px"},children:[e.jsx(ci,{}),e.jsx("div",{style:{display:"flex",flexDirection:"row",width:"100%",height:"calc(100% - 60px)",margin:"0px",padding:"0px",gap:"20px"},children:n})]})}let o=!1;const ui=()=>{o=!o};function gi({setLoggedIn:n}){const[p,d]=r.useState(""),[s,a]=r.useState(""),m={display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",backgroundColor:"var(--main-bg-color)"},h={display:"flex",flexDirection:"column",maxWidth:"400px",margin:"0 auto",padding:"20px",gap:"20px",border:"1px solid var(--div-border-color)",borderRadius:"var(--div-border-radius)",boxShadow:"2px 2px 5px var(--div-shadow-color)",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},t={margin:"10px 0",padding:"3px 3px",fontSize:"14px",width:"230px",border:"1px solid var(--main-label-color)",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},S=async j=>{try{const b=await fetch("./api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:j})});if(b.ok){const{valid:y}=await b.json();y?n(!0):j!==""&&a("Incorrect password!")}else console.error("Failed to log in:",b.statusText)}catch(b){console.error("Failed to log in:",b)}},L=j=>{j.preventDefault(),S(p)};return S(""),e.jsx("div",{style:m,children:e.jsxs("form",{onSubmit:L,style:h,children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"64px",width:"64px"}}),e.jsx("h3",{style:{color:"var(--div-text-color)"},children:"Welcome to Matterbridge"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:"20px"},children:[e.jsx("input",{type:"text",name:"username",autoComplete:"username",style:{display:"none"},tabIndex:-1}),e.jsx("input",{type:"password",value:p,onChange:j=>d(j.target.value),style:t,placeholder:"password",autoComplete:"current-password"}),e.jsx("button",{type:"submit",style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",borderColor:"var(--div-bg-color)"},children:"Log in"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",margin:0,height:"30px"},children:s&&e.jsx("p",{style:{color:"red"},children:s})})]})})}function mi(){const[n,p]=r.useState(!1),d=localStorage.getItem("frontendTheme")||"dark";o&&console.log('Setting frontend theme "%s"',d),document.body.setAttribute("frontend-theme",d);const s=ai("--primary-color","#1976d2");o&&console.log('Primary color from CSS "%s"',s);const a=li(s),m=window.location.pathname.includes("/matterbridge/")?"/matterbridge":window.location.href.includes("/api/hassio_ingress/")?window.location.pathname:"/";return o&&(console.log("Loading App..."),console.log(`- with href = "${window.location.href}"`),console.log(`- pathname = "${window.location.pathname}"`),console.log(`- baseName = "${m}"`)),n?e.jsx(po,{theme:a,children:e.jsx(yr,{dense:!0,maxSnack:10,preventDuplicate:!0,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(Qo,{children:e.jsx(Go,{children:e.jsx(mr,{basename:m,children:e.jsx(pi,{children:e.jsxs(hr,{children:[e.jsx(Ae,{path:"/",element:e.jsx(kn,{})}),e.jsx(Ae,{path:"/devices",element:e.jsx(Gn,{})}),e.jsx(Ae,{path:"/log",element:e.jsx(Jn,{})}),e.jsx(Ae,{path:"/settings",element:e.jsx(ni,{})}),e.jsx(Ae,{path:"/test",element:e.jsx(si,{})}),e.jsx(Ae,{path:"*",element:e.jsx(fr,{to:"/"})})]})})})})})})}):e.jsx(gi,{setLoggedIn:p})}xr.createRoot(document.getElementById("root")).render(e.jsx(br.StrictMode,{children:e.jsx(mi,{})}));
