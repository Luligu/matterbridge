import{B as e,y as r,S as at,U as wr,V as Cr,X as qe,Y as Sr,Z as kr,I as Mr}from"./vendor_node_modules.js";import{u as Ir,S as Dr}from"./vendor_notistack.js";import{D as $e,a as Ne,b as We,B as ie,c as Oe,d as X,A as Pr,I as Q,C as Lr,e as $r,T as A,f as me,M as Nr,g as Ye,h as L,i as Me,F as Wr,j as yt,k as Tr,l as Ee,m as Ae,n as se,K as Vt,o as Et,p as Wt,L as lt,q as rt,r as dt,s as B,W as nt,t as ct,H as pt,u as ee,V as At,v as _t,w as Fr,E as Rr,Q as er,R as jt,S as Hr,x as Or,U as Vr,P as Er,y as tr,z as Tt,G as Ie,J as rr,N as or,O as wt,X as nr,Y as Ar,Z as _r,_ as zr,$ as Ur,a0 as zt,a1 as qr,a2 as Br,a3 as Qr,a4 as Gr,a5 as Kr,a6 as Jr,a7 as Zr,a8 as Ut,a9 as Yr,aa as Xr,ab as eo,ac as to,ad as ro,ae as oo,af as no,ag as io,ah as so,ai as ao,aj as lo,ak as co,al as po,am as uo,an as go,ao as qt,ap as Xe,aq as ir,ar as we,as as sr,at as Ct,au as He,av as mo,aw as ho,ax as ze,ay as fo,az as ut,aA as Be,aB as It,aC as xo,aD as bo}from"./vendor_mui.js";import{I as oe,m as vo,a as Bt,b as yo,c as jo,d as Qt,e as wo,f as Co,g as So,h as ko,i as Mo,j as Io,k as Do,l as Po,n as Lo,o as $o,p as No,q as Wo,r as Gt,s as To,t as Fo,u as Ro,v as Ho,w as Oo,x as Vo,y as Eo,z as Ao,A as Kt,B as _o,C as zo}from"./vendor_mdi.js";import{Q as Uo}from"./vendor_qrcode.js";import{F as qo,v as Bo,e as Qo,a as Go,g as Ko,b as Jo,c as Zo,d as Dt,A as Yo}from"./vendor_rjsf.js";import"./vendor_lodash.js";import"./vendor_emotion.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const m of a)if(m.type==="childList")for(const p of m.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&i(p)}).observe(document,{childList:!0,subtree:!0});function l(a){const m={};return a.integrity&&(m.integrity=a.integrity),a.referrerPolicy&&(m.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?m.credentials="include":a.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function i(a){if(a.ep)return;a.ep=!0;const m=l(a);fetch(a.href,m)}})();function Xo({open:n,title:d,message:l,onConfirm:i,onCancel:a}){const m=v=>{o&&console.log("Confirmed"),v.preventDefault(),i()},p=v=>{o&&console.log("Canceled"),v.preventDefault(),a()};return e.jsxs($e,{open:n,children:[e.jsx(Ne,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:d})]})}),e.jsxs(We,{children:[e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",margin:"0",marginBottom:"20px",maxHeight:"350px",maxWidth:"350px"},children:e.jsx("p",{style:{flex:1,margin:"0"},children:l})}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-around"},children:[e.jsx(ie,{onClick:m,variant:"contained",color:"primary",size:"small",children:"Confirm"}),e.jsx(ie,{onClick:p,variant:"contained",color:"primary",size:"small",children:"Cancel"})]})]})]})}const en=({open:n,output:d,title:l,_command:i,_packageName:a,onInstall:m,onClose:p})=>{const v=r.useRef(null);return r.useEffect(()=>{o&&console.log(`InstallProgressDialog output effect mounted, scrolling to bottom: ${v.current}`),setTimeout(()=>{o&&console.log("Scrolling to bottom:",v.current),v.current?.scrollIntoView({behavior:"smooth"})},0)},[d]),e.jsxs($e,{open:n,onClose:(t,M)=>{M==="backdropClick"||M==="escapeKeyDown"||p()},slotProps:{paper:{sx:{width:"70vw",maxWidth:"70vw",height:"70vw",maxHeight:"70vh",overflow:"hidden"}}},children:[e.jsx(Ne,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:l})]})}),e.jsxs(We,{dividers:!0,style:{overflow:"hidden",display:"flex",flexDirection:"column",height:400,paddingBottom:0},children:[e.jsx("label",{style:{display:"block",marginBottom:"10px",fontSize:"16px",fontWeight:"bold",color:"var(--primary-color)"},children:"Process log"}),e.jsxs("ul",{style:{width:"100%",height:"100%",fontFamily:"monospace",fontSize:"14px",padding:"10px",margin:0,marginBottom:"10px",color:"var(--div-text-color)",background:"var(--div-bg-color)",overflow:"auto",listStyle:"none",boxSizing:"border-box",borderRadius:4,border:"4px solid var(--primary-color)",whiteSpace:"pre-wrap",display:"block"},children:[d.split(`
`).map((t,M)=>e.jsx("li",{style:{padding:0,margin:0,wordBreak:"break-all"},children:t},M)),e.jsx("li",{ref:v,style:{padding:0,margin:0}})]})]}),e.jsxs(Oe,{sx:{justifyContent:"center"},children:[m&&e.jsx(ie,{variant:"contained",onClick:m,children:"Install"}),e.jsx(ie,{onClick:p,children:"Close"})]})]})},gt=[],_e=r.createContext(null);function tn({children:n}){const[d,l]=r.useState(!1),[i,a]=r.useState(null),{enqueueSnackbar:m,closeSnackbar:p}=Ir(),v=r.useCallback(S=>{o&&console.log(`UiProvider closeSnackbarMessage: message ${S}`);const j=gt.findIndex(k=>k.message===S);j!==-1&&(p(gt[j].key),gt.splice(j,1),o&&console.log(`UiProvider closeSnackbarMessage: message ${S} removed from persistMessages`))},[p]),t=r.useCallback((S,j,k)=>{o&&console.log(`UiProvider showSnackbarMessage: message ${S} timeout ${j}`);const z=m(S,{variant:"default",autoHideDuration:j==null||j>0?(j??5)*1e3:null,persist:j===0,content:G=>e.jsx(X,{sx:{margin:"0",padding:"0",width:"300px",marginRight:"30px"},children:e.jsx(Pr,{severity:k??"info",variant:"filled",sx:{color:"#fff",fontWeight:"normal",width:"100%",cursor:"pointer",padding:"0px 10px"},onClick:()=>p(G),action:e.jsx(Q,{size:"small",onClick:()=>p(G),sx:{color:"#fff"},children:e.jsx(Lr,{fontSize:"small"})}),children:S},G)},G)});j===0&&(o&&console.log(`UiProvider showSnackbarMessage: message ${S} timeout ${j} - persist key ${z}`),gt.push({message:S,key:z}))},[m,p]),[M,w]=r.useState(!1),[I,D]=r.useState(""),[E,_]=r.useState(""),[V,$]=r.useState(""),c=r.useRef(null),f=r.useRef(null),h=()=>{o&&console.log(`UiProvider handle confirm action ${V}`),w(!1),c.current&&c.current(V)},O=()=>{o&&console.log(`UiProvider handle cancel action ${V}`),w(!1),f.current&&f.current(V)},P=r.useCallback((S,j,k,z,G)=>{o&&console.log(`UiProvider showConfirmCancelDialog for command ${k}`),D(S),_(j),$(k),c.current=z,f.current=G,w(!0)},[]),[C,q]=r.useState(!1),[N,g]=r.useState(""),[s,u]=r.useState(""),[b,H]=r.useState(""),[le,fe]=r.useState(""),ne=r.useCallback((S,j,k)=>{o&&console.log(`UiProvider show install progress for package ${S}`),g(S),u(j),H(k),q(!0)},[]),be=r.useCallback(S=>{o&&console.log(`UiProvider addInstallProgress: output ${S}`),fe(j=>j+S+`
`)},[]),R=r.useCallback(()=>{o&&console.log(`UiProvider exitInstallProgressSuccess: package ${b}`)},[b]),U=r.useCallback(()=>{o&&console.log(`UiProvider exitInstallProgressError: package ${b}`)},[b]),F=r.useCallback(()=>{o&&console.log("UiProvider hide install progress"),q(!1)},[]),J=()=>{o&&console.log("UiProvider handle install close action"),q(!1),H(""),fe("")},W=r.useMemo(()=>({mobile:d,setMobile:l,currentPage:i,setCurrentPage:a,showSnackbarMessage:t,closeSnackbarMessage:v,closeSnackbar:p,showConfirmCancelDialog:P,showInstallProgress:ne,exitInstallProgressSuccess:R,exitInstallProgressError:U,hideInstallProgress:F,addInstallProgress:be}),[d,i,l,a,t,v,p,P,ne,R,U,F,be]);return e.jsxs(_e.Provider,{value:W,children:[e.jsx(Xo,{open:M,title:I,message:E,onConfirm:h,onCancel:O}),e.jsx(en,{open:C,title:N,_command:s,_packageName:b,output:le,onClose:J}),n]})}const ar=r.createContext(null),he=r.createContext(null);function rn({children:n}){const[d,l]=r.useState([]),[i,a]=r.useState(1e3),[m,p]=r.useState(localStorage.getItem("logFilterLevel")??"info"),[v,t]=r.useState(localStorage.getItem("logFilterSearch")??"*"),[M,w]=r.useState(localStorage.getItem("logAutoScroll")!=="false"),[I,D]=r.useState(!1),{showSnackbarMessage:E,closeSnackbarMessage:_,closeSnackbar:V,showInstallProgress:$,hideInstallProgress:c,exitInstallProgressSuccess:f,exitInstallProgressError:h,addInstallProgress:O}=r.useContext(_e),P=r.useRef([]),C=r.useRef(null),q=r.useRef(1),N=r.useRef(Math.floor(Math.random()*999e3)+1e3),g=r.useRef(null),s=r.useRef(null),u=r.useRef(null),b=r.useRef(m),H=r.useRef(v),le=r.useRef(0),fe=r.useRef(null),ne=r.useMemo(()=>window.location.href.replace(/^http/,"ws"),[]),be=r.useMemo(()=>window.location.href.includes("api/hassio_ingress"),[]),R=100,U=60,F=50,J=300,W=10;r.useEffect(()=>(o&&console.log("WebSocket messages started counter interval"),fe.current=setInterval(()=>{le.current>0&&(o&&console.log(`WebSocket messages received in the last ${W} seconds: ${le.current*(60/W)} messages/minute`),le.current=0)},W*1e3),()=>{o&&console.log("WebSocket messages stopped counter interval"),fe.current&&clearInterval(fe.current),fe.current=null}),[]),r.useEffect(()=>{b.current=m},[m]),r.useEffect(()=>{H.current=v},[v]);const S=r.useCallback(()=>Math.floor(Math.random()*999e3)+1e3,[]),j=r.useCallback(T=>{if(C.current&&C.current.readyState===WebSocket.OPEN)try{o&&console.log(`WebSocket sending message with id ${T.id}:`,T),T.id===void 0&&(T.id=N.current);const x=JSON.stringify(T);C.current.send(x),o&&console.log("WebSocket sent message:",T)}catch(x){o&&console.error(`WebSocket error sending message: ${x}`)}else o&&console.error("WebSocket message not sent, WebSocket not connected:",T)},[]),k=r.useCallback((T,x)=>{l(Z=>[...Z,{level:T,time:"",name:"",message:x}])},[]),z=r.useCallback((T,x)=>{o&&console.log(`WebSocket addListener id ${x}:`,T),(x==null||isNaN(x)||x===0)&&console.error("WebSocket addListener called without id, listener not added:",T),P.current=[...P.current,{listener:T,id:x}],o&&console.log("WebSocket addListener total listeners:",P.current.length)},[]),G=r.useCallback(T=>{o&&console.log("WebSocket removeListener:",T),P.current=P.current.filter(x=>x.listener!==T),o&&console.log("WebSocket removeListener total listeners:",P.current.length)},[]),ae=r.useCallback(()=>{ne===""||ne===null||ne===void 0||(k("WebSocket",`Connecting ${et?"with password":""} to WebSocket: ${ne}`),o&&console.log(`WebSocket connecting to: ${ne}${et?"?password=[redacted]":""}`),C.current=new WebSocket(ne+(et?`?password=${encodeURIComponent(et)}`:"")),C.current.onmessage=T=>{I||D(!0),le.current+=1;try{const x=JSON.parse(T.data);if(x.id===void 0||x.src===void 0||x.dst===void 0){o&&console.error("WebSocket undefined message id/src/dst:",x);return}if(x.src!=="Matterbridge"||x.dst!=="Frontend"){o&&console.error("WebSocket invalid message src/dst:",x);return}if(x.error){o&&console.error("WebSocket error message response:",x);return}if(x.id===N.current&&x.method==="pong"&&x.response==="pong"){o&&console.log(`WebSocket pong response message id ${x.id}:`,x),s.current&&clearTimeout(s.current),s.current=null;return}else if(x.method==="snackbar"&&x.response&&x.response.message){o&&console.log(`WebSocket message id ${x.id} method ${x.method}:`,x),E(x.response.message,x.response.timeout,x.response.severity);return}else if(x.method==="close_snackbar"&&x.response&&x.response.message){o&&console.log(`WebSocket message id ${x.id} method ${x.method}:`,x),_(x.response.message);return}else if(x.method==="log"){if(!x.response||!x.response.level||!x.response.time||!x.response.name||!x.response.message||(x.response.level==="spawn"&&(x.response.name==="Matterbridge:spawn-init"?$(x.response.message,"",""):x.response.name==="Matterbridge:spawn-exit-success"?f():x.response.name==="Matterbridge:spawn-exit-error"?h():O(x.response.message+`
`)),["debug","info","notice","warn","error","fatal"].includes(x.response.level)&&(b.current==="info"&&x.response.level==="debug"||b.current==="notice"&&(x.response.level==="debug"||x.response.level==="info")||b.current==="warn"&&(x.response.level==="debug"||x.response.level==="info"||x.response.level==="notice")||b.current==="error"&&(x.response.level==="debug"||x.response.level==="info"||x.response.level==="notice"||x.response.level==="warn")||b.current==="fatal"&&(x.response.level==="debug"||x.response.level==="info"||x.response.level==="notice"||x.response.level==="warn"||x.response.level==="error")))||H.current!=="*"&&H.current!==""&&!x.response.message.toLowerCase().includes(H.current.toLowerCase())&&!x.response.name.toLowerCase().includes(H.current.toLowerCase())||x.response.name==="Commissioning"&&x.response.message.includes("is uncommissioned"))return;l(xe=>{const ye=[...xe,{level:x.response.level,time:x.response.time,name:x.response.name,message:x.response.message}];return ye.length>i*2?ye.slice(i):ye})}else{if(o&&console.log(`WebSocket received message id ${x.id} method ${x.method}:`,x),x.id===0)P.current.forEach(Z=>Z.listener(x));else{const Z=P.current.find(xe=>xe.id===x.id);Z?Z.listener(x):console.warn(`WebSocket no listener found for message id ${x.id}:`,x)}return}}catch(x){console.error(`WebSocket error parsing message: ${x}`,x instanceof Error?x.stack:null)}},C.current.onopen=()=>{o&&console.log(`WebSocket: Connected to WebSocket: ${ne}`),k("WebSocket",`Connected to WebSocket: ${ne}`),D(!0),V(),q.current=1,u.current=setTimeout(()=>{g.current=setInterval(()=>{j({id:N.current,method:"ping",src:"Frontend",dst:"Matterbridge",params:{}}),s.current&&clearTimeout(s.current),s.current=setTimeout(()=>{o&&console.error(`WebSocketUse: No pong response received from WebSocket: ${ne}`),k("WebSocket",`No pong response received from WebSocket: ${ne}`),D(!1)},1e3*F)},1e3*U)},1e3*J)},C.current.onclose=()=>{o&&console.error(`WebSocket: Disconnected from WebSocket ${be?"with Ingress":""}: ${ne}`),k("WebSocket",`Disconnected from WebSocket: ${ne}`),D(!1),V(),c(),u.current&&clearTimeout(u.current),s.current&&clearTimeout(s.current),g.current&&clearInterval(g.current),k("WebSocket",`Reconnecting (attempt ${q.current} of ${R}) to WebSocket${be?" (Ingress)":""}: ${ne}`),be?setTimeout(de,5e3):q.current===1?de():q.current<R?setTimeout(de,1e3*q.current):k("WebSocket",`Reconnect attempts exceeded limit of ${R} retries, refresh the page to reconnect to: ${ne}`),q.current=q.current+1},C.current.onerror=T=>{o&&console.error(`WebSocket: WebSocket error connecting to ${ne}:`,T),k("WebSocket",`WebSocket error connecting to ${ne}`)})},[ne]),de=r.useCallback(()=>{o&&console.log(`WebSocket attemptReconnect ${q.current}/${R} to:`,ne),ae()},[ae]);r.useEffect(()=>(ae(),()=>{C.current&&C.current.readyState===WebSocket.OPEN&&C.current.close()}),[ae]);const ce=r.useMemo(()=>({messages:d,logMaxMessages:i,logAutoScroll:M,logFilterLevel:m,logFilterSearch:v,setMessages:l,setLogMaxMessages:a,setLogFilterLevel:p,setLogFilterSearch:t,setLogAutoScroll:w}),[d,i,M,m,v,l,p,t,a,w]),ue=r.useMemo(()=>({logMaxMessages:i,logAutoScroll:M,logFilterLevel:m,logFilterSearch:v,setMessages:l,setLogMaxMessages:a,setLogFilterLevel:p,setLogFilterSearch:t,setLogAutoScroll:w,online:I,retry:q.current,getUniqueId:S,addListener:z,removeListener:G,sendMessage:j,logMessage:k}),[i,M,l,p,t,a,w,I,q.current,z,G,j,k]);return e.jsx(ar.Provider,{value:ce,children:e.jsx(he.Provider,{value:ue,children:n})})}function on(n){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 296.2 296.2",...n,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"lg1",x1:"16.6",y1:"16.6",x2:"279.6",y2:"279.6",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{offset:"0",stopColor:"#00b48d"}),e.jsx("stop",{offset:".1",stopColor:"#3faa77"}),e.jsx("stop",{offset:".3",stopColor:"#234148"}),e.jsx("stop",{offset:".7",stopColor:"#203b44"}),e.jsx("stop",{offset:".9",stopColor:"#ad2e6e"}),e.jsx("stop",{offset:"1",stopColor:"#c81b74"})]}),e.jsxs("linearGradient",{id:"lg2",x1:"31.1",y1:"31.1",x2:"265.1",y2:"265.1",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{offset:"0",stopColor:"#00b48d"}),e.jsx("stop",{offset:".2",stopColor:"#285251"}),e.jsx("stop",{offset:".4",stopColor:"#234148"}),e.jsx("stop",{offset:".8",stopColor:"#203b44"}),e.jsx("stop",{offset:".9",stopColor:"#a8316c"}),e.jsx("stop",{offset:"1",stopColor:"#c81b74"})]}),e.jsxs("linearGradient",{id:"lg3",x1:"116.2",y1:"143.9",x2:"139.8",y2:"143.9",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{offset:"0",stopColor:"#8bc751"}),e.jsx("stop",{offset:"1",stopColor:"#0db14b"})]}),e.jsx("linearGradient",{id:"lg4",x1:"136.1",y1:"100.8",x2:"159.6",y2:"100.8",xlinkHref:"#lg3"}),e.jsx("linearGradient",{id:"lg5",x1:"155.3",y1:"143.9",x2:"178.9",y2:"143.9",xlinkHref:"#lg3"}),e.jsxs("linearGradient",{id:"lg6",x1:"46.8",y1:"25.7",x2:"89.6",y2:"74.8",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{offset:"0",stopColor:"#b1d34a"}),e.jsx("stop",{offset:"1",stopColor:"#50b848"})]})]}),e.jsx("rect",{width:"296.2",height:"296.2",rx:"56.7",ry:"56.7",style:{fill:"url(#lg1)"}}),e.jsx("rect",{x:"16.3",y:"16.3",width:"263.6",height:"263.6",rx:"50.5",ry:"50.5",style:{fill:"url(#lg2)"}}),e.jsx("circle",{cx:"128",cy:"143.9",r:"11.8",style:{fill:"url(#lg3)"}}),e.jsx("circle",{cx:"147.8",cy:"100.8",r:"11.8",style:{fill:"url(#lg4)"}}),e.jsx("path",{d:"m244.6 114.5.4-.5L160 33a17 17 0 0 0-24.7-.5l-86.4 83.3a15 15 0 0 0 9.2 26.9h19.3v-4.7l-13.7-12.7v-.1l83.7-80.8 84.2 81-13.9 12.8v4.5h19.5a15 15 0 0 0 7.4-28.1Z",style:{fill:"url(#lg3)"}}),e.jsx("circle",{cx:"167.1",cy:"143.9",r:"11.8",style:{fill:"url(#lg5)"}}),e.jsx("path",{fill:"#fff",d:"M219 89.3V35.5a10.5 10.5 0 1 0-21 0v33.7l21 20Z"}),e.jsx("path",{d:"M91.4 73.3H83a37 37 0 0 0-14.5-28.4L65 50.2c.1 0 12.6 9 11.7 25.4-5.3-.4-11.2-1.9-16.3-5.3-11.8-7.8-16-23.7-11.9-46 8.7 1.5 34 7 43 22.8 4.1 7.3 4.1 16.1 0 26.2Z",style:{fill:"url(#lg6)"}}),e.jsx("path",{d:"M65.9 80a49.6 49.6 0 0 0 17.8 2.2l16.6-16c1.6-8.3.5-15.7-3.3-22.4C84.6 22 47.8 17.5 46.2 17.4l-3-.4-.6 3c-3.8 18.4-5.9 50.6 23.2 60ZM48.4 24.4c8.7 1.5 34 7 43 22.8 4.1 7.3 4.1 16.1 0 26.2H83a37 37 0 0 0-14.5-28.4l-3.7 5.3c.1 0 12.6 9 11.7 25.4-5.3-.4-11.2-1.9-16.3-5.3-11.9-7.8-16-23.7-11.9-46Z",fill:"#1e5857"}),e.jsx("path",{fill:"#fff",d:"M250.5 90.5a17.4 17.4 0 1 1 0-34.8 17.4 17.4 0 0 1 0 34.8Zm0-22.7a5.4 5.4 0 0 0 0 10.7 5.3 5.3 0 0 0 0-10.7ZM258.8 148.2a15.9 15.9 0 0 0-9.6 28.5c-.8 4.2-5.4 4.6-5.4 4.6h-26v-43l13.6-13-1.8-2-82.2-79-81.2 78.3-2.5 2.6 13.7 13v42.9H53a21.5 21.5 0 1 0 11.7 15h12.6v18.8c0 7.8 6.4 14.1 14.1 14.1h29.3v14.8H64a10.6 10.6 0 0 0-17.7 8 10.6 10.6 0 0 0 17.6 8h157.6a16.3 16.3 0 1 0 0-16h-84.8V229h66.8c7.8 0 14.2-6.3 14.2-14.1v-19.2h27.6c14.3 0 17.8-12.8 18.5-16.6a15.9 15.9 0 0 0-5-30.9ZM43.7 210.8a10.3 10.3 0 1 1 0-20.6 10.3 10.3 0 0 1 0 20.6Zm192 36a5 5 0 1 1 0 10 5 5 0 0 1 0-10Zm-77-34.8h-22v-34h22v34Zm8.4-79.8c2.7 0 5.2 1 7.2 2.5v-10.4L188 137s2.6 1.3 4.6 1.3h6.7v68c0 3.2-2.6 5.7-5.7 5.7h-19v-34h1.4a7.5 7.5 0 0 0 0-15H120a7.5 7.5 0 0 0 0 15h.7v34h-19.3a5.7 5.7 0 0 1-5.7-5.6v-68.1h6.7c2 0 4.6-1.3 4.6-1.3l13.7-12.7v10.4a11.7 11.7 0 0 1 16 1.6v-13a14.9 14.9 0 0 0-25-10.8s-.1.2-.1.2l-.5.5-6.9 7H92.5l55-53.2 55.1 53.2h-11.8l-7-7c0-.2-.2-.3-.4-.5l-.2-.2a14.8 14.8 0 0 0-25 10.9v12.9c2.2-2.5 5.3-4.1 8.9-4.1Zm91.7 36.7a4.9 4.9 0 1 1 0-9.7 4.9 4.9 0 0 1 0 9.7Z"})]})}function De(){const{retry:n}=r.useContext(he),d=()=>{window.location.reload()};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100vw",height:"100vh",justifyContent:"center",alignItems:"center",fontSize:"20px",color:"var(--main-text-color)",backgroundColor:"var(--main-bg-color)"},children:[e.jsx(on,{style:{height:"128px",width:"128px",margin:"10px",marginBottom:"20px"}}),n<100?e.jsxs(e.Fragment,{children:[e.jsx($r,{style:{color:"var(--primary-color)"}}),e.jsx("div",{style:{marginTop:"20px",color:"var(--primary-color)",textAlign:"center"},children:e.jsxs("span",{children:["Reconnecting to Matterbridge ","(attempt "+n+")","..."]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginTop:"20px",color:"var(--primary-color)",textAlign:"center"},children:[e.jsx("span",{children:"Unable to connect to Matterbridge after multiple attempts."}),e.jsx("br",{}),e.jsx("span",{children:"Please check your network connection."}),e.jsx("br",{})]}),e.jsx(ie,{variant:"contained",color:"primary",onClick:d,style:{marginTop:"20px"},children:"Refresh the Page"})]})]})}function nn({value:n,maxChars:d}){let l=n;if(n.length>d&&d>3){const i=d-3,a=n.substring(0,Math.ceil(i/2)),m=n.substring(n.length-Math.floor(i/2),n.length);l=`${a} â€¦ ${m}`}return n!==l?e.jsx(A,{title:n,placement:"top",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[0,12]}}]}},children:e.jsx("span",{children:l})}):e.jsx("span",{children:l})}function je({children:n,style:d}){const l={display:"flex",flexDirection:"column",flex:"0 0 auto",width:"100%",overflow:"hidden",margin:"0px",padding:"0px",gap:"0px",backgroundColor:"var(--div-bg-color)",boxShadow:"5px 5px 10px var(--div-shadow-color)",border:"1px solid var(--table-border-color)",borderRadius:"var(--div-border-radius)",boxSizing:"border-box"};return e.jsx("div",{style:{...l,...d},children:n})}function Ue({children:n,style:d}){const l={display:"flex",flexDirection:"row",justifyContent:"space-between",width:"100%",height:"30px",borderBottom:"1px solid var(--table-border-color)",color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color)",margin:"0px",padding:"0px",boxSizing:"border-box"};return e.jsx("div",{style:{...l,...d},children:n})}function Ve({children:n,style:d}){const l={color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color)",fontSize:"16px",fontWeight:"bold",margin:"0px",padding:"5px 10px"};return e.jsx("div",{style:{...l,...d},children:n})}function mt({children:n,style:d}){const l={display:"flex",flexDirection:"row",justifyContent:"space-between",width:"100%",height:"30px",color:"var(--footer-text-color)",backgroundColor:"var(--footer-bg-color)",margin:"0px",padding:"0px",boxSizing:"border-box"};return e.jsx("div",{style:{...l,...d},children:n})}function ht({children:n,style:d}){const l={color:"var(--footer-text-color)",backgroundColor:"var(--footer-bg-color)",fontSize:"14px",fontWeight:"bold",margin:"0px",padding:"5px 10px"};return e.jsx("div",{style:{...l,...d},children:n})}function ot({children:n,style:d}){const l={color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",fontSize:"14px",fontWeight:"normal",margin:"0px",padding:"5px 10px"};return e.jsx("div",{style:{...l,...d},children:n})}function kt({children:n,style:d,onDragOver:l,onDragLeave:i,onDrop:a}){const m={display:"flex",flexDirection:"row",flex:"0 0 auto",overflow:"hidden",alignItems:"center",justifyContent:"space-between",margin:"0px",padding:"10px",gap:"20px"};return e.jsx("div",{style:{...m,...d},onDragOver:l,onDragLeave:i,onDrop:a,children:n})}function it({children:n,style:d,onClose:l}){const i={display:"flex",flexDirection:"row",margin:"0px",padding:"0px",paddingRight:"10px",gap:"10px"};return e.jsxs("div",{style:{...i,...d},children:[n,wi]})}function sn({systemInfo:n,compact:d}){const{addListener:l,removeListener:i,getUniqueId:a,sendMessage:m}=r.useContext(he),[p,v]=r.useState(n),t=r.useRef(a());if(o&&console.log("SystemInfoTable loading with systemInfo:",p,"compact:",d),n&&d&&p.totalMemory&&p.freeMemory){const $=p.totalMemory,c=p.freeMemory;p.freeMemory=`${c} / ${$}`,p.totalMemory=""}if(n&&d&&p.heapTotal&&p.heapUsed){const $=p.heapTotal,c=p.heapUsed;p.heapUsed=`${c} / ${$}`,p.heapTotal=""}if(n&&d&&p.osRelease&&p.osType){const $=p.osType,c=p.osRelease;p.osType=`${$} (${c})`,p.osRelease=""}if(n&&d&&p.osArch&&p.osPlatform){const $=p.osPlatform,c=p.osArch;p.osPlatform=`${$} (${c})`,p.osArch=""}const M=($,c,f,h,O)=>{v(P=>({...P,totalMemory:$,freeMemory:c,heapTotal:f,heapUsed:h,rss:O}))},w=$=>{v(c=>({...c,cpuUsage:$.toFixed(2)+" %"}))},I=$=>{v(c=>({...c,processCpuUsage:$.toFixed(2)+" %"}))},D=($,c)=>{v(f=>({...f,systemUptime:$,processUptime:c}))},E=()=>{o&&console.log("SystemInfoTable handleViewHistory clicked"),m({id:t.current,sender:"Header",method:"/api/viewhistorypage",src:"Frontend",dst:"Matterbridge",params:{}})};r.useEffect(()=>{const $=c=>{o&&console.log("SystemInfoTable received WebSocket Message:",c),c.method==="memory_update"&&c.response&&c.response.totalMemory&&c.response.freeMemory&&c.response.heapTotal&&c.response.heapUsed&&c.response.rss?(o&&console.log("SystemInfoTable received memory_update",c),M(c.response.totalMemory,c.response.freeMemory,c.response.heapTotal,c.response.heapUsed,c.response.rss)):c.method==="cpu_update"&&c.response&&c.response.cpuUsage?(o&&console.log("SystemInfoTable received cpu_update",c),w(c.response.cpuUsage),I(c.response.processCpuUsage)):c.method==="uptime_update"&&c.response&&c.response.systemUptime&&c.response.processUptime?(o&&console.log("SystemInfoTable received uptime_update",c),D(c.response.systemUptime,c.response.processUptime)):c.method==="/api/viewhistorypage"&&c.id===t.current&&c.success===!0&&(o&&console.log("SystemInfoTable received /api/viewhistorypage success"),window.open("./api/viewhistory","_blank","noopener,noreferrer"))};return l($,t.current),o&&console.log(`SystemInfoTable added WebSocket listener id ${t.current}`),()=>{i($),o&&console.log("SystemInfoTable removed WebSocket listener")}},[l,i]);const[_,V]=r.useState(!1);return!p||_?null:(o&&console.log("SystemInfoTable rendering..."),e.jsxs(je,{style:{flex:"0 1 auto",width:"302px",minWidth:"302px"},children:[e.jsxs(Ue,{children:[e.jsx(Ve,{children:"System Information"}),e.jsx(it,{onClose:()=>V(!0),children:e.jsx(Q,{size:"small",sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},onClick:E,children:e.jsx(A,{title:"Open the cpu and memory usage page",arrow:!0,children:e.jsx(oe,{path:vo,size:"22px"})})})})]}),e.jsx(kt,{style:{flex:"1 1 auto",overflow:"auto",margin:"0px",padding:"0px",gap:"0px"},children:e.jsx("table",{style:{border:"none",borderCollapse:"collapse"},children:e.jsx("tbody",{style:{border:"none",borderCollapse:"collapse"},children:Object.entries(p).filter(([$,c])=>c!==void 0&&c!=="").map(([$,c],f)=>e.jsxs("tr",{className:f%2===0?"table-content-even":"table-content-odd",style:{border:"none",borderCollapse:"collapse"},children:[e.jsx("td",{style:{border:"none",borderCollapse:"collapse"},children:$.replace("interfaceName","Interface name").replace("macAddress","Mac address").replace("ipv4Address","IPv4 address").replace("ipv6Address","IPv6 address").replace("nodeVersion","Node version").replace("hostname","Hostname").replace("user","User").replace("osType","Os").replace("osPlatform","Platform").replace("freeMemory","Memory").replace("systemUptime","System uptime").replace("processUptime","Process uptime").replace("cpuUsage","Host CPU").replace("processCpuUsage","Process CPU").replace("rss","Rss").replace("heapUsed","Heap")}),e.jsx("td",{style:{border:"none",borderCollapse:"collapse"},children:e.jsx(nn,{value:typeof c!="string"?c.toString():c,maxChars:24})})]},$))})})})]}))}const an=r.memo(sn),Jt={margin:"0px",padding:"0px",color:"var(--div-text-color)",transition:"color 0.2s ease","& svg":{display:"block"},"& svg path":{fill:"var(--div-text-color)",transition:"fill 0.2s ease"},"&:hover":{color:"var(--primary-color)"},"&:hover svg path":{fill:"var(--primary-color)"},"&:focus-visible":{outline:"2px solid var(--primary-color)",outlineOffset:"2px"}},ln=n=>{if(!n)return"";const d=n.toString().replace(/[^0-9]/g,"");if(d.length<5)return d;const l=d.slice(0,4),i=d.slice(4,7),a=d.slice(7,11);return[l,i,a].filter(Boolean).join("-")};function dn({id:n}){const{online:d,sendMessage:l,addListener:i,removeListener:a,getUniqueId:m}=r.useContext(he),[p,v]=r.useState(null),t=r.useRef(null),M=r.useRef(null),w=r.useRef(m()),{showConfirmCancelDialog:I}=r.useContext(_e);o&&console.log(`QRDiv loading with id = "${n}" storeId = "${t.current}" timeout = ${M.current} and  matter:`,p),r.useEffect(()=>{o&&console.log(`QRDiv id effect "${n}"`),t.current=n,M.current&&clearTimeout(M.current),M.current=null,n?(o&&console.log(`QRDiv id effect sending data request for storeId "${n}"`),l({id:w.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:n,server:!0}})):(o&&console.log("QRDiv id effect setting matter to null"),v(null))},[n,l]),r.useEffect(()=>{const c=f=>{o&&console.log("QRDiv received WebSocket Message:",f),f.method==="refresh_required"&&f.response.changed==="matter"&&f.response.matter&&(o&&console.log(`QRDiv received refresh_required: changed=${f.response.changed} for storeId "${f.response.matter.id}":`,f.response.matter),t.current===f.response.matter.id&&(o&&console.log(`QRDiv received refresh_required/matter: setting matter data for storeId "${f.response.matter.id}":`,f.response.matter),M.current&&clearTimeout(M.current),f.response.matter.advertising&&f.response.matter.advertiseTime&&f.response.matter.advertiseTime+9e5<=Date.now()&&(f.response.matter.advertising=!1),v(f.response.matter),f.response.matter.advertising&&(o&&console.log(`QRDiv setting matter advertise timeout for storeId "${f.response.matter.id}":`,f.response.matter.advertiseTime+9e5-Date.now()),M.current=setTimeout(()=>{M.current&&clearTimeout(M.current),o&&console.log(`QRDiv clearing advertising state for storeId "${t.current}" after 15 minutes`),v(h=>h&&{...h,advertising:!1})},f.response.matter.advertiseTime+9e5-Date.now()))))};return i(c,w.current),o&&console.log("QRDiv webSocket effect mounted"),()=>{a(c),M.current&&clearTimeout(M.current),M.current=null,o&&console.log("QRDiv webSocket effect unmounted")}},[i,a]);const D=()=>{o&&console.log(`QRDiv sent matter startCommission for node "${p?.id}"`),p&&l({id:w.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:p.id,startCommission:!0}})},E=()=>{o&&console.log(`QRDiv sent matter stopCommission for node "${p?.id}"`),p&&l({id:w.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:p.id,stopCommission:!0}})},_=()=>{o&&console.log(`QRDiv sent matter advertise for node "${p?.id}"`),p&&l({id:w.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:p.id,advertise:!0}})},V=c=>{o&&console.log(`QRDiv sent matter removeFabric for node "${p?.id}" and fabricIndex ${c}`),p&&l({id:w.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:p.id,removeFabric:c}})},$=async()=>{if(!p||!p.manualPairingCode)return;const c=p.manualPairingCode.toString();try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(c);else{const f=document.createElement("textarea");f.value=c,f.style.position="fixed",f.style.opacity="0",document.body.appendChild(f),f.focus(),f.select(),document.execCommand("copy"),document.body.removeChild(f)}o&&console.log("Manual pairing code copied to clipboard")}catch(f){console.error("Failed to copy manual pairing code",f)}};return!p||!d?(o&&console.log("QRDiv rendering undefined state"),null):p.online?p.advertising&&p.qrPairingCode&&p.manualPairingCode?(o&&console.log("QRDiv rendering advertising state"),e.jsxs(je,{style:{alignItems:"center",minWidth:"302px"},children:[e.jsxs(Ue,{children:[e.jsx(Ve,{children:"QR pairing code"}),e.jsxs(it,{children:[e.jsx(Q,{"aria-label":"send advertising",size:"small",onClick:_,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(A,{title:"Send again the mDNS advertisement",arrow:!0,children:e.jsx(oe,{path:Bt,size:"22px"})})}),e.jsx(Q,{"aria-label":"stop pairing",size:"small",onClick:E,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(A,{title:"Turn off pairing",arrow:!0,children:e.jsx(oe,{path:yo,size:"22px"})})})]})]}),e.jsx(ot,{style:{maxWidth:"280px",fontWeight:"bold",color:"var(--secondary-color)"},children:t.current}),e.jsx(Uo,{value:p.qrPairingCode,size:256,level:"M",fgColor:"var(--div-text-color)",bgColor:"var(--div-bg-color)",style:{margin:"20px"}}),e.jsxs(mt,{style:{justifyContent:"space-between"},children:[e.jsxs(ht,{style:{fontWeight:"normal",color:"var(--div-text-color)"},children:["Manual pairing code: ",ln(p.manualPairingCode)]}),e.jsx(it,{children:e.jsx(A,{title:"Copy manual pairing code",arrow:!0,children:e.jsx(Q,{"aria-label":"copy manual pairing code",size:"small",onClick:$,sx:Jt,children:e.jsx(oe,{path:jo,size:.85})})})})]})]})):p.commissioned&&p.fabricInformations&&p.sessionInformations?(o&&console.log("QRDiv rendering commissioned state"),e.jsxs(je,{style:{alignItems:"center",minWidth:"302px",overflow:"hidden"},children:[e.jsxs(Ue,{children:[e.jsx(Ve,{children:"Paired fabrics"}),e.jsxs(it,{children:[e.jsx(Q,{"aria-label":"send advertising",size:"small",onClick:_,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(A,{title:"Send again the mDNS advertisement",arrow:!0,children:e.jsx(oe,{path:Bt,size:"22px"})})}),e.jsx(Q,{"aria-label":"start pairing",size:"small",onClick:D,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(A,{title:"Turn on pairing",arrow:!0,children:e.jsx(oe,{path:Qt,size:"22px"})})})]})]}),e.jsx(ot,{style:{maxWidth:"280px",fontWeight:"bold",color:"var(--secondary-color)"},children:t.current}),e.jsx(kt,{style:{flexDirection:"column",flex:"1 1 auto",overflow:"auto",margin:"0px",padding:"0px 0px 10px 0px",gap:"0px"},children:p.fabricInformations.map((c,f)=>e.jsxs("div",{style:{margin:"0px",padding:"10px",gap:"0px",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",textAlign:"left",fontSize:"14px"},children:[e.jsxs("div",{style:{marginLeft:"20px",marginBottom:"10px",display:"flex",flexDirection:"row",justifyContent:"space-between",gap:"20px",alignItems:"center"},children:[e.jsxs("p",{className:"status-blue",style:{margin:"0px",padding:"3px 10px",width:"200px",fontSize:"14px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},children:["Fabric: ",c.fabricIndex]}),e.jsx(A,{title:"Remove the fabric. You will also need to remove it from the controller.",arrow:!0,children:e.jsx(Q,{"aria-label":"remove the fabric",size:"small",onClick:()=>I("Remove fabric","Are you sure you want to remove this fabric? You will also need to remove it from the controller.","RemoveFabric",()=>V(c.fabricIndex),()=>{}),sx:{...Jt,padding:"2px"},children:e.jsx(oe,{path:wo,size:1})})})]}),e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Vendor: ",c.rootVendorId," ",c.rootVendorName]}),c.label!==""&&e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Label: ",c.label]}),e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Sessions: ",p.sessionInformations?p.sessionInformations.filter(h=>h.fabric?.fabricIndex===c.fabricIndex&&h.isPeerActive===!0).length:"0"," ","subscriptions: ",p.sessionInformations?p.sessionInformations.filter(h=>h.fabric?.fabricIndex===c.fabricIndex&&h.isPeerActive===!0&&h.numberOfActiveSubscriptions>0).length:"0"]})]},f))}),e.jsx(mt,{style:{justifyContent:"center"},children:e.jsxs(ht,{style:{fontWeight:"normal"},children:["Serial number: ",p.serialNumber]})})]})):!p.commissioned&&!p.advertising?(o&&console.log("QRDiv rendering not commissioned and not advertising state"),e.jsxs(je,{style:{alignItems:"center",minWidth:"302px"},children:[e.jsx(Ue,{children:e.jsx(Ve,{children:"QR pairing code"})}),e.jsx(ot,{style:{maxWidth:"280px",fontWeight:"bold",color:"var(--secondary-color)"},children:t.current}),e.jsx(ie,{onClick:D,endIcon:e.jsx(oe,{path:Qt,size:1}),style:{margin:"20px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:"Turn on pairing"}),e.jsx(mt,{style:{justifyContent:"center"},children:e.jsxs(ht,{style:{fontWeight:"normal"},children:["Serial number: ",p.serialNumber]})})]})):(o&&console.log("QRDiv rendering unknown state"),null):(o&&console.log("QRDiv rendering offline state"),e.jsxs(je,{style:{alignItems:"center",minWidth:"302px"},children:[e.jsx(Ue,{style:{height:"30px",justifyContent:"space-between"},children:e.jsx(Ve,{children:"Server node"})}),e.jsx(ot,{style:{maxWidth:"280px",fontWeight:"bold",color:"var(--secondary-color)"},children:t.current}),e.jsx(ot,{style:{fontWeight:"bold"},children:"Server offline"}),e.jsx(mt,{style:{justifyContent:"center"},children:e.jsxs(ht,{style:{fontWeight:"normal"},children:["Serial number: ",p.serialNumber]})})]}))}const cn=r.memo(dn);function pn(){const{logMessage:n,sendMessage:d,getUniqueId:l}=r.useContext(he),[i,a]=r.useState("matterbridge-"),[m,p]=r.useState(!1),[v,t]=r.useState(null),M=r.useRef(l()),w=N=>{N.preventDefault(),p(!0)},I=()=>{p(!1)},D=N=>{N.preventDefault(),p(!1);const g=N.dataTransfer.files[0];if(g){n("Plugins",`Installing package ${g.name}. Please wait...`);const s=new FormData;s.append("file",g),s.append("filename",g.name),fetch("./api/uploadpackage",{method:"POST",body:s}).then(u=>u.text()).then(u=>{n("Plugins",`Server response: ${u}`)}).catch(u=>{console.error("Error uploading plugin file:",u),n("Plugins",`Error installing package ${u}`)})}},E=N=>{const g=N.target.files&&N.target.files[0];if(g){n("Plugins",`Uploading package ${g.name}`);const s=new FormData;s.append("file",g),s.append("filename",g.name),fetch("./api/uploadpackage",{method:"POST",body:s}).then(u=>u.text()).then(u=>{n("Plugins",`Server response: ${u}`)}).catch(u=>{console.error("Error uploading plugin file:",u),n("Plugins",`Error uploading package ${u}`)})}},_=()=>{d({id:M.current,sender:"InstallPlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:i,restart:!1}})},V=()=>{document.getElementById("file-upload")?.click()},$=()=>{d({id:M.current,sender:"InstallPlugins",method:"/api/addplugin",src:"Frontend",dst:"Matterbridge",params:{pluginNameOrPath:i}})},c=N=>{N.preventDefault(),d({id:M.current,sender:"InstallPlugins",method:"/api/uninstall",src:"Frontend",dst:"Matterbridge",params:{packageName:i}})},f=N=>{N.preventDefault(),console.log("Right-clicked Upload button")},h=N=>{N.preventDefault(),console.log("Right-clicked Add button")},O=N=>{t(N.currentTarget)},P=N=>{N!==""&&a(N),t(null)},[C,q]=r.useState(!1);return o&&console.log("HomeInstallAddPlugins rendering..."),C?null:e.jsxs(je,{children:[e.jsxs(Ue,{children:[e.jsx(Ve,{children:"Install plugins"}),e.jsx(it,{onClose:()=>q(!0)})]}),e.jsxs(kt,{onDragOver:w,onDragLeave:I,onDrop:D,children:[e.jsx(me,{value:i,onChange:N=>{a(N.target.value)},size:"small",id:"plugin-name",label:"Plugin name or plugin path",variant:"outlined",fullWidth:!0}),e.jsx(Q,{onClick:O,children:e.jsx(Nr,{})}),e.jsxs(Ye,{id:"simple-menu",anchorEl:v,keepMounted:!0,open:!!v,onClose:()=>P(""),children:[e.jsx(L,{onClick:()=>P("matterbridge-zigbee2mqtt"),children:"matterbridge-zigbee2mqtt"}),e.jsx(L,{onClick:()=>P("matterbridge-somfy-tahoma"),children:"matterbridge-somfy-tahoma"}),e.jsx(L,{onClick:()=>P("matterbridge-shelly"),children:"matterbridge-shelly"}),e.jsx(L,{onClick:()=>P("matterbridge-hass"),children:"matterbridge-hass"}),e.jsx(L,{onClick:()=>P("matterbridge-webhooks"),children:"matterbridge-webhooks"}),e.jsx(L,{onClick:()=>P("matterbridge-bthome"),children:"matterbridge-bthome"}),e.jsx(L,{onClick:()=>P("matterbridge-test"),children:"matterbridge-test"}),e.jsx(L,{onClick:()=>P("matterbridge-example-accessory-platform"),children:"matterbridge-example-accessory-platform"}),e.jsx(L,{onClick:()=>P("matterbridge-example-dynamic-platform"),children:"matterbridge-example-dynamic-platform"}),e.jsx(L,{onClick:()=>P("matterbridge-eve-door"),children:"matterbridge-eve-door"}),e.jsx(L,{onClick:()=>P("matterbridge-eve-motion"),children:"matterbridge-eve-motion"}),e.jsx(L,{onClick:()=>P("matterbridge-eve-energy"),children:"matterbridge-eve-energy"}),e.jsx(L,{onClick:()=>P("matterbridge-eve-weather"),children:"matterbridge-eve-weather"}),e.jsx(L,{onClick:()=>P("matterbridge-eve-room"),children:"matterbridge-eve-room"})]}),e.jsx(A,{title:"Install or update a plugin from npm",children:e.jsxs(ie,{onClick:_,onContextMenu:c,endIcon:e.jsx(Me,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:[" ","Install"]})}),e.jsx(A,{title:"Upload and install a plugin from a tarball",children:e.jsxs(ie,{onClick:V,onContextMenu:f,endIcon:e.jsx(Wr,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:[" ","Upload"]})}),e.jsx(A,{title:"Add an installed plugin",children:e.jsxs(ie,{onClick:$,onContextMenu:h,endIcon:e.jsx(yt,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:[" ","Add"]})}),e.jsx("input",{id:"file-upload",type:"file",accept:".tgz",style:{display:"none"},onChange:E})]})]})}const un=r.memo(pn);function Qe({status:n,enabledText:d="Enabled",disabledText:l=void 0,tooltipText:i=void 0,onClick:a}){if(n===void 0)return null;{const m=e.jsx("div",{className:n?"status-enabled":"status-disabled",style:{cursor:"default"},onClick:a,children:n?d:l??d});return i!==void 0?e.jsx(A,{title:i,children:m}):m}}function gn(n,d,l){const i=n?.[l],a=d?.[l];return i==null&&a==null?0:i==null?-1:a==null?1:typeof i=="boolean"&&typeof a=="boolean"?i===a?0:i?1:-1:typeof i=="number"&&typeof a=="number"?i-a:String(i).localeCompare(String(a))}function mn({name:n,title:d,columns:l,rows:i,getRowKey:a,footerLeft:m,footerRight:p,onRowClick:v}){const t=r.useRef(new WeakMap),M=r.useRef(1),w=g=>{if(typeof a=="string"&&g&&g[a]!=null)return g[a];if(typeof a=="function"){const b=a(g);if(b!=null)return b}const s=l?.[0]?.id;if(s&&g&&g[s]!=null)return g[s];console.warn(`MbfTable(${n}): using fallback stable row key; consider providing getRowKey prop for better React performance`);let u=t.current.get(g);return u||(u=`rk_${M.current++}`,t.current.set(g,u)),u},[I,D]=r.useState(localStorage.getItem(`${n}_table_order_by`)||null),[E,_]=r.useState(localStorage.getItem(`${n}_table_order`)||null),[V,$]=r.useState(!1),[c,f]=r.useState(()=>{try{const g=localStorage.getItem(`${n}_column_visibility`);if(g)return JSON.parse(g)}catch{}return{}}),h=r.useMemo(()=>{const g={};for(const s of l)s.hidden||(g[s.id]=s.required?!0:c[s.id]!==!1);return g},[l,c]),O=r.useMemo(()=>{if(!I||!E)return i;const g=l.find(u=>u.id===I);if(!g||g.noSort)return i;const s=i.map((u,b)=>({el:u,index:b}));return s.sort((u,b)=>{let H;return typeof g.comparator=="function"?H=g.comparator(u.el,b.el):H=gn(u.el,b.el,I),H!==0?E==="asc"?H:-H:u.index-b.index}),s.map(u=>u.el)},[i,I,E,l]),P=g=>{if(I!==g||!I){D(g),_("asc"),localStorage.setItem(`${n}_table_order_by`,g),localStorage.setItem(`${n}_table_order`,"asc");return}if(E==="asc"){_("desc"),localStorage.setItem(`${n}_table_order`,"desc");return}D(null),_(null),localStorage.removeItem(`${n}_table_order_by`),localStorage.removeItem(`${n}_table_order`)},C=()=>{$(!V)},q=g=>{f(s=>{const u=l.find(le=>le.id===g);if(u&&u.required)return s;const b=h[g]!==!1,H={...s};b?H[g]=!1:delete H[g];try{localStorage.setItem(`${n}_column_visibility`,JSON.stringify(H))}catch{}return H})},N=()=>{f({});try{localStorage.removeItem(`${n}_column_visibility`)}catch{}$(!1)};return o&&console.log(`Rendering table ${n}${I&&E?` ordered by ${I}:${E}`:""}`),e.jsxs("div",{style:{display:"flex",flexDirection:"column",margin:"0",padding:"0",gap:"0",width:"100%",flex:"1 1 auto",height:"100%",minHeight:0,overflow:"hidden"},children:[e.jsxs($e,{open:V,onClose:(g,s)=>{s==="backdropClick"||s==="escapeKeyDown"||C()},disableEscapeKeyDown:!0,disableRestoreFocus:!0,children:[e.jsx(Ne,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:`Configure ${n} columns`})]})}),e.jsx(We,{children:e.jsx(Tr,{children:l.filter(g=>!g.hidden).map(g=>e.jsx(Ee,{control:e.jsx(Ae,{disabled:!!g.required,checked:g.required?!0:h[g.id]!==!1,onChange:()=>q(g.id)}),label:g.label},g.id))})}),e.jsxs(Oe,{children:[e.jsx(ie,{onClick:N,children:"Reset"}),e.jsx(ie,{variant:"contained",onClick:g=>{if(g?.currentTarget&&typeof g.currentTarget.blur=="function")try{g.currentTarget.blur()}catch{}const s=document.activeElement;if(s&&s instanceof HTMLElement&&typeof s.blur=="function")try{s.blur()}catch{}C()},children:"Close"})]})]}),e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",minHeight:"30px",justifyContent:"space-between",borderBottom:"none"},children:[e.jsx("p",{className:"MbfWindowHeaderText",children:n}),d&&e.jsx("p",{className:"MbfWindowHeaderText",children:d}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(Q,{onClick:g=>{if(g?.currentTarget?.blur)try{g.currentTarget.blur()}catch{}C()},"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(A,{title:`Configure ${n} columns`,children:e.jsx(oe,{path:Co,size:"20px",color:"var(--header-text-color)"})})})})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",flex:"1 1 auto",minHeight:0,width:"100%",overflow:"auto",margin:"0px",padding:"0px",gap:"0"},children:e.jsxs("table",{"aria-label":`${n} table`,style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,border:"none",color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color"},children:e.jsx("tr",{style:{height:"30px",minHeight:"30px"},children:l.map(g=>{if(g.hidden||!g.required&&h[g.id]===!1)return null;const s=!g.noSort,u=s&&I===g.id&&!!E;return e.jsxs("th",{onClick:s?()=>P(g.id):void 0,style:{margin:"0",padding:"5px 10px",position:"sticky",top:0,minWidth:g.minWidth,maxWidth:g.maxWidth,textAlign:g.align||"left",cursor:s?"pointer":"default",border:"none",color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color)",whiteSpace:g.maxWidth?"nowrap":void 0,overflow:g.maxWidth?"hidden":void 0,textOverflow:g.maxWidth?"ellipsis":void 0},"aria-sort":s?u?E==="asc"?"ascending":"descending":"none":void 0,children:[g.label,u&&e.jsxs("span",{style:{marginLeft:6},children:[E==="asc"&&e.jsx(oe,{path:So,size:"15px"}),E==="desc"&&e.jsx(oe,{path:ko,size:"15px"})]})]},g.id)})})}),e.jsx("tbody",{children:O.map((g,s)=>{const u=w(g);return e.jsx("tr",{className:s%2===0?"table-content-even":"table-content-odd",onClick:v?b=>v(g,u,b):void 0,style:{height:"30px",minHeight:"30px",border:"none",borderCollapse:"collapse",cursor:v?"pointer":void 0},children:l.map(b=>{if(b.hidden||!b.required&&h[b.id]===!1)return null;const H=g[b.id];return e.jsx("td",{style:{border:"none",borderCollapse:"collapse",textAlign:b.align||"left",padding:"5px 10px",margin:"0",maxWidth:b.maxWidth,whiteSpace:b.maxWidth?"nowrap":void 0,overflow:b.maxWidth?"hidden":void 0,textOverflow:b.maxWidth?"ellipsis":void 0},children:typeof b.render=="function"?b.render(H,u,g,b):typeof H=="boolean"?e.jsx(Ae,{checked:H,disabled:!0,size:"small",sx:{m:0,p:0,color:"var(--table-text-color)","&.Mui-disabled":{color:"var(--table-text-color)",opacity:.7}}}):b.format&&typeof H=="number"?b.format(H):H!=null?String(H):null},b.id)})},u)})})]})}),(m||p)&&e.jsxs("div",{className:"MbfWindowFooter",style:{height:"30px",minHeight:"30px",justifyContent:"space-between",border:"none"},children:[e.jsx("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)"},children:m}),e.jsx("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)"},children:p})]})]})}function hn(n){return r.memo(n)}const St=hn(mn);function Zt(n){return n.id!==0&&n.src==="Matterbridge"&&n.dst==="Frontend"}const Ge={fontSize:"16px",fontWeight:"bold",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},Ke={fontSize:"12px",fontWeight:"normal",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},fn={fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)",backgroundColor:"var(--div-bg-color)"},xn={fontSize:"16px",fontWeight:"bold",backgroundColor:"var(--div-bg-color)"},Fe={padding:"0px",margin:"0px"},bn="5px 10px 5px 10px",ft={},ve={},xt={},bt={};let Je=[],Pt=[];const vn=({open:n,onClose:d,plugin:l})=>{const{sendMessage:i,addListener:a,removeListener:m,getUniqueId:p}=r.useContext(he),v=r.useRef(p()),[t,M]=r.useState(l.configJson),[w,I]=r.useState(null),[D,E]=r.useState({"ui:submitButtonOptions":{submitText:"Confirm"},"ui:globalOptions":{orderable:!0}}),[_,V]=r.useState("");let $={};r.useEffect(()=>{const S=j=>{j.src==="Matterbridge"&&j.dst==="Frontend"&&(Zt(j)&&j.id===v.current&&j.method==="/api/select/devices"&&j.response&&(o&&console.log(`ConfigPluginDialog (id: ${j.id}) received ${j.response.length} /api/select/devices:`,j.response),Je=j.response),Zt(j)&&j.id===v.current&&j.method==="/api/select/entities"&&j.response&&(o&&console.log(`ConfigPluginDialog (id: ${j.id}) received ${j.response.length} /api/select/entities:`,j.response),Pt=j.response))};return a(S,v.current),o&&console.log("ConfigPluginDialog added WebSocket listener id:",v.current),t&&w&&w.properties&&(Object.keys(w.properties).forEach(j=>{Object.keys(w.properties[j]).forEach(k=>{k.startsWith("ui:")&&(D[j]={},D[j][k]=w.properties[j][k],delete w.properties[j][k])})}),E(D)),l.name&&l.configJson&&l.schemaJson&&(M(l.configJson),I(l.schemaJson),i({id:v.current,sender:"ConfigPlugin",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:l.name}}),i({id:v.current,sender:"ConfigPlugin",method:"/api/select/entities",src:"Frontend",dst:"Matterbridge",params:{plugin:l.name}}),o&&console.log('HomePlugins sent "/api/select/devices" and "/api/select/entities" for plugin:',l.name)),()=>{m(S),o&&console.log("ConfigPluginDialog removed WebSocket listener")}},[a,t,l,m,w,i,D]);const c=(S,j)=>{$=S.formData},f=S=>{o&&console.log("ConfigPluginDialog handleSaveChanges:",S.formData),M(S.formData),l.configJson=S.formData,l.restartRequired=!0,i({id:v.current,sender:"ConfigPlugin",method:"/api/savepluginconfig",src:"Frontend",dst:"Matterbridge",params:{pluginName:S.formData.name,formData:S.formData}}),d()};function h(S){const{id:j,label:k,onKeyChange:z,onDropPropertyClick:G,disabled:ae,schema:de,children:ce,registry:ue,readonly:T,required:x}=S,{templates:Z}=ue,{RemoveButton:xe}=Z.ButtonTemplates;if(!(Yo in de))return e.jsx(X,{sx:{display:"flex",flexDirection:"column",flexGrow:1,padding:0,margin:0,border:"none"},children:ce});const ge=({target:te})=>z(te&&te.value);return e.jsxs(X,{sx:{display:"flex",flexDirection:"row",flexGrow:1,padding:0,margin:0,border:"none"},children:[e.jsx(me,{id:`${j}-key`,name:`${j}-key`,required:x,disabled:ae||T,defaultValue:k,onBlur:T?void 0:ge,type:"text",variant:"outlined",sx:{width:"250px",minWidth:"250px",maxWidth:"250px",marginRight:"20px"}}),e.jsx(X,{sx:{flex:1},children:ce}),e.jsx(xe,{disabled:ae||T,onClick:G(k),registry:ue})]})}function O(S){const{children:j,description:k,displayLabel:z,errors:G,help:ae,hidden:de,registry:ce,uiSchema:ue}=S,T=Jo(ue),x=Zo("WrapIfAdditionalTemplate",ce,T);return de?e.jsx("div",{style:{display:"none"},children:j}):e.jsx(X,{sx:{display:"flex",flexDirection:"column",flexGrow:1,padding:0,margin:0,border:"none"},children:e.jsxs(x,{...S,children:[z===!0&&k,j,G,ae]})})}function P(S){const{description:j}=S;return j?e.jsx(se,{sx:Ke,children:j}):null}function C(S){const{required:j,title:k}=S;return k?e.jsx(X,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:e.jsxs(se,{sx:Ge,children:["Title ",k," ",j&&e.jsx("mark",{children:"***"})]})}):null}function q(S){const{help:j}=S;return j?e.jsx(X,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:e.jsx(se,{sx:fn,children:j})}):null}function N(S){const{errors:j}=S;return j?e.jsxs(X,{sx:{padding:"10px",margin:"10px",border:"1px solid grey"},children:[e.jsx(se,{color:"error",sx:xn,children:"Please fix the following errors:"}),e.jsx(rt,{children:j.map((k,z)=>e.jsxs(Fr,{children:[e.jsx(B,{children:e.jsx(Rr,{color:"error"})}),e.jsx(ee,{primary:k.stack})]},z))})]}):null}function g(S){const{errors:j}=S;return j?e.jsx(X,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:j.map((k,z)=>e.jsxs(se,{color:"error",variant:"body2",sx:{marginLeft:1},children:["This field ",k]},z))}):null}function s(S){const{id:j,name:k,_schema:z,_uiSchema:G,value:ae,options:de,label:ce,type:ue,placeholder:T,required:x,disabled:Z,readonly:xe,autofocus:ye,onChange:ge,onChangeOverride:te,onBlur:re,onFocus:Pe,_rawErrors:Le,_hideError:tt,_registry:y,_formContext:Y}=S,Se=({target:{value:ke}})=>ge(ke===""?de.emptyValue:ke),Re=({target:ke})=>re(j,ke&&ke.value),st=({target:ke})=>Pe(j,ke&&ke.value);return e.jsx(X,{sx:{padding:"0px",margin:"0px"},children:e.jsx(me,{id:j,name:j,label:T&&T!==""?ce:void 0,variant:"outlined",placeholder:T&&T!==""?T:ce,required:x,disabled:Z||xe,autoFocus:ye,value:ae||ae===0?ae:"",type:ue,autoComplete:ue==="password"?"current-password":k,onChange:te||Se,onBlur:Re,onFocus:st,fullWidth:!0})})}function u(S){return console.log("ArrayFieldTitleTemplate:",S),null}function b(S){return console.log("ArrayFieldDescriptionTemplate:",S),null}function H(S){return console.log("ArrayFieldItemTemplate:",S),null}function le(S){const{canAdd:j,onAddClick:k,schema:z,title:G}=S,[ae,de]=r.useState(!1),[ce,ue]=r.useState(!1),[T,x]=r.useState(!1),[Z,xe]=r.useState(""),ye=y=>{xe(y.target.value)},ge=()=>{o&&console.log("ArrayFieldTemplate: handleDialogDeviceToggle filter:",Z,"selectDevices:",Je),de(!ae)},te=()=>{o&&console.log("ArrayFieldTemplate: handleDialogEntityToggle filter:",Z,"selectEntities:",Pt),ue(!ce)},re=()=>{o&&console.log("ArrayFieldTemplate: handleDialogDeviceEntityToggle filter:",Z,"selectDevices:",Je),x(!T)},Pe=y=>{de(!1),z.selectFrom==="serial"?z.items.default=y.serial:z.selectFrom==="name"&&(z.items.default=y.name),k()},Le=y=>{ue(!1),z.selectEntityFrom==="name"?z.items.default=y.name:z.selectEntityFrom==="description"&&(z.items.default=y.description),k()},tt=y=>{x(!1),z.selectDeviceEntityFrom==="name"?z.items.default=y.name:z.selectDeviceEntityFrom==="description"&&(z.items.default=y.description),k()};return e.jsxs(X,{sx:{margin:"0px",padding:"5px 10px 5px 10px",border:"1px solid grey"},children:[G&&e.jsxs(X,{sx:{margin:"0px",padding:"0px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[G&&e.jsx(se,{sx:Ge,children:G}),j&&e.jsxs(X,{sx:{margin:"0px",padding:"0px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[z.selectFrom&&e.jsx(A,{title:"Add a device from the list",children:e.jsx(Q,{onClick:ge,size:"small",color:"primary",sx:Fe,children:e.jsx(lt,{})})}),z.selectEntityFrom&&e.jsx(A,{title:"Add an entity from the list",children:e.jsx(Q,{onClick:te,size:"small",color:"primary",sx:Fe,children:e.jsx(lt,{})})}),z.selectDeviceEntityFrom&&e.jsx(A,{title:"Add a device entity from the list",children:e.jsx(Q,{onClick:re,size:"small",color:"primary",sx:Fe,children:e.jsx(lt,{})})}),e.jsx(A,{title:"Add a new item",children:e.jsx(Q,{onClick:k,size:"small",color:"primary",sx:Fe,children:e.jsx(yt,{})})})]})]}),z.description&&e.jsx(se,{sx:Ke,children:z.description}),S.items.map(y=>e.jsxs(X,{sx:{margin:"2px 0px",padding:"0px",display:"flex",alignItems:"center"},children:[e.jsx(X,{sx:{flexGrow:1,marginRight:"10px"},children:y.children}),e.jsx(Q,{disabled:!y.hasMoveUp,onClick:y.onReorderClick(y.index,y.index-1),size:"small",color:"primary",sx:Fe,children:e.jsx(Et,{})}),e.jsx(Q,{disabled:!y.hasMoveDown,onClick:y.onReorderClick(y.index,y.index+1),size:"small",color:"primary",sx:Fe,children:e.jsx(Vt,{})}),e.jsx(Q,{onClick:y.onDropIndexClick(y.index),size:"small",color:"primary",sx:Fe,children:e.jsx(Wt,{})})]},y.index)),e.jsxs($e,{open:ae,onClose:ge,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(Ne,{children:"Select a device"}),e.jsxs(We,{children:[e.jsxs(X,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(se,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(me,{fullWidth:!0,variant:"outlined",value:Z,onChange:ye,placeholder:"Enter serial or name"})]}),e.jsx(rt,{dense:!0,children:Je.filter(y=>y.serial.toLowerCase().includes(Z.toLowerCase())||y.name.toLowerCase().includes(Z.toLowerCase())).map((y,Y)=>e.jsxs(dt,{onClick:()=>Pe(y),sx:ft,children:[y.icon==="wifi"&&e.jsx(B,{children:e.jsx(nt,{style:ve})}),y.icon==="ble"&&e.jsx(B,{children:e.jsx(ct,{style:ve})}),y.icon==="hub"&&e.jsx(B,{children:e.jsx(pt,{style:ve})}),e.jsx(ee,{primary:y.name,secondary:y.serial,primaryTypographyProps:{style:xt},secondaryTypographyProps:{style:bt}})]},Y))})]}),e.jsx(Oe,{children:e.jsx(ie,{onClick:ge,children:"Close"})})]}),e.jsxs($e,{open:ce,onClose:te,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(Ne,{children:"Select an entity"}),e.jsxs(We,{children:[e.jsxs(X,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(se,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(me,{fullWidth:!0,variant:"outlined",value:Z,onChange:ye,placeholder:"Enter name or description"})]}),e.jsx(rt,{dense:!0,children:Pt.filter(y=>y.name.toLowerCase().includes(Z.toLowerCase())||y.description.toLowerCase().includes(Z.toLowerCase())).map((y,Y)=>e.jsxs(dt,{onClick:()=>Le(y),sx:ft,children:[y.icon==="wifi"&&e.jsx(B,{children:e.jsx(nt,{style:ve})}),y.icon==="ble"&&e.jsx(B,{children:e.jsx(ct,{style:ve})}),y.icon==="hub"&&e.jsx(B,{children:e.jsx(pt,{style:ve})}),y.icon==="component"&&e.jsx(B,{children:e.jsx(At,{style:ve})}),y.icon==="matter"&&e.jsx(B,{children:e.jsx(_t,{style:ve})}),e.jsx(ee,{primary:y.name,secondary:y.description,primaryTypographyProps:{style:xt},secondaryTypographyProps:{style:bt}})]},Y))})]}),e.jsx(Oe,{children:e.jsx(ie,{onClick:te,children:"Close"})})]}),e.jsxs($e,{open:T,onClose:re,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsxs(Ne,{children:["Select an entity for ",G]}),e.jsx(We,{children:e.jsx(rt,{dense:!0,children:Je.filter(y=>y.serial===G||y.name===G).map(y=>y.entities?.map((Y,Se)=>e.jsxs(dt,{onClick:()=>tt(Y),sx:ft,children:[Y.icon==="wifi"&&e.jsx(B,{children:e.jsx(nt,{style:ve})}),Y.icon==="ble"&&e.jsx(B,{children:e.jsx(ct,{style:ve})}),Y.icon==="hub"&&e.jsx(B,{children:e.jsx(pt,{style:ve})}),Y.icon==="component"&&e.jsx(B,{children:e.jsx(At,{style:ve})}),Y.icon==="matter"&&e.jsx(B,{children:e.jsx(_t,{style:ve})}),e.jsx(ee,{primary:Y.name,secondary:Y.description,primaryTypographyProps:{style:xt},secondaryTypographyProps:{style:bt}})]},Se)))})}),e.jsx(Oe,{children:e.jsx(ie,{onClick:re,children:"Close"})})]})]})}function fe(S){const{onAddClick:j,schema:k,properties:z,title:G,description:ae}=S,[de,ce]=r.useState(!1),[ue,T]=r.useState(""),x=te=>{T(te.target.value)},Z=()=>{ce(!de)},xe=te=>{o&&console.log(`ObjectFieldTemplate: handleSelectValue value "${te.serial}" for schema "${k.selectFrom}"`),ce(!1);let re="";k.selectFrom==="serial"?re=te.serial:k.selectFrom==="name"&&(re=te.name),V(re),o&&console.log(`ObjectFieldTemplate: handleSelectValue newkey "${re}"`),j(k)()},ye=()=>{j(k)()},ge=!k.additionalProperties;return o&&console.log(`ObjectFieldTemplate: isRoot ${ge} newkey "${_}"`),!ge&&_!==""&&(o&&console.log("ObjectFieldTemplate: newkey",_,"properties",z),z.forEach(te=>{if(te.name==="newKey"&&te.content.key==="newKey"&&te.content.props.name==="newKey"&&te.content.props.onKeyChange&&_!==""){o&&console.log("ObjectFieldTemplate: newkey onKeyChange",_);const re=_;V(""),te.content.props.onKeyChange(re)}})),e.jsxs(X,{sx:{margin:"0px",padding:ge?"10px":"5px 10px 0px 10px",border:ge?"none":"1px solid grey"},children:[k.title&&ge&&e.jsx(X,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px",marginBottom:"10px"},children:e.jsx(se,{sx:Ge,children:k.title})}),G&&!ge&&e.jsxs(X,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px"},children:[e.jsx(se,{sx:Ge,children:G}),e.jsxs(X,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px"},children:[k.selectFrom&&e.jsx(A,{title:"Add a device from the list",children:e.jsx(Q,{onClick:Z,size:"small",color:"primary",sx:Fe,children:e.jsx(lt,{})})}),e.jsx(A,{title:"Add a new item",children:e.jsx(Q,{onClick:ye,size:"small",color:"primary",sx:Fe,children:e.jsx(yt,{})})})]})]}),k.description&&e.jsx(X,{sx:{padding:"0px",margin:"0px",marginBottom:"10px"},children:e.jsx(se,{sx:Ke,children:k.description})}),z.map(({content:te,name:re,hidden:Pe})=>!Pe&&e.jsxs(X,{sx:{margin:"0px",marginBottom:"10px",padding:["object","array","boolean"].includes(k.properties[re].type)?"0px":bn,border:["object","array","boolean"].includes(k.properties[re].type)?"none":"1px solid grey"},children:[!["object","array","boolean"].includes(k.properties[re].type)&&e.jsx(se,{sx:Ge,children:re}),e.jsx(X,{sx:{flexGrow:1,padding:"0px",margin:"0px"},children:te})]},re)),e.jsxs($e,{open:de,onClose:Z,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(Ne,{children:"Select a device"}),e.jsxs(We,{children:[e.jsxs(X,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(se,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(me,{fullWidth:!0,variant:"outlined",value:ue,onChange:x,placeholder:"Enter serial or name"})]}),e.jsx(rt,{dense:!0,children:Je.filter(te=>te.serial.toLowerCase().includes(ue.toLowerCase())||te.name.toLowerCase().includes(ue.toLowerCase())).map((te,re)=>e.jsxs(dt,{onClick:()=>xe(te),sx:ft,children:[te.icon==="wifi"&&e.jsx(B,{children:e.jsx(nt,{style:ve})}),te.icon==="ble"&&e.jsx(B,{children:e.jsx(ct,{style:ve})}),te.icon==="hub"&&e.jsx(B,{children:e.jsx(pt,{style:ve})}),e.jsx(ee,{primary:te.name,secondary:te.serial,primaryTypographyProps:{style:xt},secondaryTypographyProps:{style:bt}})]},re))})]}),e.jsx(Oe,{children:e.jsx(ie,{onClick:Z,children:"Close"})})]})]})}function ne(S){const{uiSchema:j}=S,{submitText:k,norender:z}=Ko(j);return z?null:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",margin:"10px",padding:"0px",gap:"20px"},children:[e.jsx(ie,{type:"submit",variant:"contained",color:"primary",children:k}),e.jsx(ie,{variant:"contained",color:"primary",onClick:d,children:"Cancel"})]})}function be(S){const{className:j,disabled:k,onClick:z,registry:G,style:ae,uiSchema:de,...ce}=S;return e.jsx(A,{title:"Remove the item",children:e.jsx(Q,{disabled:k,size:"small",color:"primary",onClick:z,children:e.jsx(Wt,{})})})}function R(S){const{className:j,disabled:k,onClick:z,registry:G,uiSchema:ae,...de}=S;return e.jsx(A,{title:"Add an item",children:e.jsx(Q,{size:"small",color:"primary",onClick:z,children:e.jsx(yt,{})})})}function U(S){const{disabled:j,onClick:k,registry:z,style:G,uiSchema:ae,...de}=S;return e.jsx(A,{title:"Move up the item",children:e.jsx(Q,{size:"small",color:"primary",onClick:k,children:e.jsx(Et,{})})})}function F(S){const{disabled:j,onClick:k,registry:z,style:G,uiSchema:ae,...de}=S;return e.jsx(A,{title:"Move down the item",children:e.jsx(Q,{size:"small",color:"primary",onClick:k,children:e.jsx(Vt,{})})})}function J(S){const{id:j,name:k,value:z,schema:G,readonly:ae,onChange:de}=S,[ce,ue]=r.useState(),T=Z=>{o&&console.log(`CheckboxWidget ${k} onChangeField:`,Z),ue(Z&&Z!==""?Z:void 0)},x=()=>{o&&console.log(`CheckboxWidget onClick plugin="${l.name}" action="${k}" value="${ce}"`),i({id:v.current,sender:"ConfigPlugin",method:"/api/action",src:"Frontend",dst:"Matterbridge",params:{plugin:l.name,action:k,value:ce,formData:$,id:j}}),G.buttonClose===!0?d():G.buttonSave===!0&&f({formData:t})};return G.buttonText&&G.description?e.jsxs(X,{sx:{margin:"0px",padding:"10px",border:"1px solid grey",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(se,{sx:Ke,children:G.description}),e.jsx(ie,{variant:"contained",color:"primary",onClick:()=>x(),children:G.buttonText})]}):G.buttonField&&G.description?e.jsxs(X,{sx:{margin:"0px",padding:"10px",gap:"20px",border:"1px solid grey",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(se,{sx:Ke,children:G.description}),e.jsx(me,{id:k+"-input",name:k,label:G.textLabel,placeholder:G.textPlaceholder,onChange:Z=>T(Z.target.value),sx:{width:"250px",minWidth:"250px",maxWidth:"250px"}}),e.jsx(ie,{id:k+"-button",variant:"contained",color:"primary",disabled:ce===void 0,onClick:()=>x(),children:G.buttonField})]}):e.jsxs(X,{sx:{margin:"0px",padding:"5px 10px",border:"1px solid grey"},children:[k&&e.jsxs(X,{sx:{margin:"0px",padding:"0px",gap:"10px",display:"flex",justifyContent:"flex-start",alignItems:"center"},children:[e.jsx(se,{sx:Ge,children:k}),e.jsx(Ae,{checked:z,readOnly:ae,onChange:()=>de(!z),sx:{padding:"0px",margin:"0px"}})]}),G.description&&e.jsx(se,{sx:Ke,children:G.description})]})}function W({schema:S,id:j,name:k,options:z,label:G,hideLabel:ae,required:de,disabled:ce,placeholder:ue,readonly:T,value:x,multiple:Z,autofocus:xe,onChange:ye,onBlur:ge,onFocus:te,errorSchema:re,rawErrors:Pe=[],registry:Le,uiSchema:tt,hideError:y,formContext:Y,...Se}){const{enumOptions:Re,enumDisabled:st,emptyValue:ke}=z;Z=typeof Z>"u"?!1:!!Z;const Ft=Z?[]:"",Rt=typeof x>"u"||Z&&x.length<1||!Z&&x===Ft,ur=({target:{value:Te}})=>ye(Dt(Te,Re,ke)),gr=({target:Te})=>ge(j,Dt(Te&&Te.value,Re,ke)),mr=({target:Te})=>te(j,Dt(Te&&Te.value,Re,ke)),Ht=Qo(x,Re,Z),{InputLabelProps:hr,SelectProps:fr,autocomplete:xr,...br}=Se,vr=!Z&&S.default===void 0;return e.jsxs(me,{id:j,name:j,value:!Rt&&typeof Ht<"u"?Ht:Ft,required:de,disabled:ce||T,autoFocus:xe,autoComplete:xr,placeholder:ue,error:Pe.length>0,onChange:ur,onBlur:gr,onFocus:mr,...br,select:!0,InputLabelProps:{...hr,shrink:!Rt},SelectProps:{...fr,multiple:Z},"aria-describedby":Go(j),children:[vr&&e.jsx(L,{value:"",children:ue}),Array.isArray(Re)&&Re.map(({value:Te,label:yr},Ot)=>{const jr=Array.isArray(st)&&st.indexOf(Te)!==-1;return e.jsx(L,{value:String(Ot),disabled:jr,children:yr},Ot)})]})}return o&&console.log("ConfigPluginDialog rendering..."),!n||!w||!t?null:e.jsxs($e,{open:n,onClose:d,slotProps:{paper:{sx:{maxWidth:"800px"}}},children:[e.jsx(Ne,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h3",{children:"Matterbridge plugin configuration"})]})}),e.jsx(We,{style:{padding:"0px",margin:"0px",width:"800px",height:"600px",overflow:"auto"},children:e.jsx(qo,{schema:w,formData:t,uiSchema:D,validator:Bo,templates:{FieldTemplate:O,BaseInputTemplate:s,TitleFieldTemplate:C,DescriptionFieldTemplate:P,FieldHelpTemplate:q,FieldErrorTemplate:g,ErrorListTemplate:N,WrapIfAdditionalTemplate:h,ArrayFieldTitleTemplate:u,ArrayFieldDescriptionTemplate:b,ArrayFieldItemTemplate:H,ArrayFieldTemplate:le,ObjectFieldTemplate:fe,ButtonTemplates:{SubmitButton:ne,RemoveButton:be,AddButton:R,MoveUpButton:U,MoveDownButton:F}},widgets:{CheckboxWidget:J,SelectWidget:W},onChange:c,onSubmit:f})})]})};function lr(n){if(o&&console.log(`getQRColor (id: ${n?.id}) received matter:`,n??"undefined"),n===void 0||!n.online||!n.qrPairingCode&&!n.manualPairingCode&&!n.fabricInformations&&!n.sessionInformations)return"red";if(n.commissioned===!1&&n.qrPairingCode&&n.manualPairingCode)return"var(--primary-color)";let d=0,l=0;for(const i of n.sessionInformations??[])i.fabric&&i.isPeerActive===!0&&d++,i.numberOfActiveSubscriptions>0&&(l+=i.numberOfActiveSubscriptions);return n.commissioned===!0&&n.fabricInformations&&n.sessionInformations&&(d===0||l===0)?"var(--secondary-color)":"var(--div-text-color)"}function yn({storeId:n,setStoreId:d}){const{online:l,sendMessage:i,addListener:a,removeListener:m,getUniqueId:p}=r.useContext(he),{showConfirmCancelDialog:v}=r.useContext(_e),t=r.useRef(p()),[M,w]=r.useState(null),[I,D]=r.useState(null),[E,_]=r.useState([]),V=[{label:"Name",id:"name",required:!0,render:(F,J,W,S)=>e.jsx(A,{title:`Plugin path ${W.path}`,children:e.jsx("span",{style:{cursor:"pointer"},onClick:()=>g(W),children:W.name})})},{label:"Description",id:"description",render:(F,J,W,S)=>e.jsx(A,{title:"Open the plugin homepage",children:e.jsx("span",{style:{cursor:"pointer"},onClick:()=>g(W),children:W.description})})},{label:"Version",id:"version",render:(F,J,W,S)=>e.jsx(e.Fragment,{children:e.jsx(A,{title:`Plugin v.${W.version}`,children:e.jsx("span",{children:W.version.split("-dev-")[0]+(W.version.includes("-dev-")?"@dev":"")})})})},{label:"Author",id:"author",render:(F,J,W,S)=>e.jsx(e.Fragment,{children:W.author?W.author.replace("https://github.com/",""):"Unknown"})},{label:"Type",id:"type",render:(F,J,W,S)=>e.jsx(e.Fragment,{children:W.type?W.type.replace("Platform",""):"Unknown"})},{label:"Devices",id:"registeredDevices"},{label:"Actions",id:"actions",required:!0,noSort:!0,render:(F,J,W,S)=>e.jsxs("div",{style:{margin:"0px",padding:"0px",gap:"4px",display:"flex",flexDirection:"row"},children:[I&&I.bridgeMode==="childbridge"&&!W.error&&W.enabled&&e.jsx(A,{title:"Shows the QRCode or the fabrics",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0",padding:"0",width:"19px",height:"19px",color:lr(W.matter)},onClick:()=>{W.matter?.id&&d(W.matter?.id)},size:"small",children:e.jsx(er,{})})}),I&&I.bridgeMode==="childbridge"&&!W.error&&W.enabled&&e.jsx(A,{title:"Restart the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0",padding:"0",width:"19px",height:"19px"},onClick:()=>q(W),size:"small",children:e.jsx(jt,{})})}),e.jsx(A,{title:"Plugin config",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{disabled:W.restartRequired===!0,style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>be(W),size:"small",children:e.jsx(Hr,{})})}),I&&!I.readOnly&&e.jsx(A,{title:"Remove the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>{c("Remove plugin","Are you sure? This will also remove all devices and configuration from the controller.","remove",W)},size:"small",children:e.jsx(Or,{})})}),W.enabled?e.jsx(A,{title:"Disable the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>{c("Disable plugin","Are you sure? This will also remove all devices and configuration from the controller.","disable",W)},size:"small",children:e.jsx(Vr,{})})}):e.jsx(e.Fragment,{}),W.enabled?e.jsx(e.Fragment,{}):e.jsx(A,{title:"Enable the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>N(W),size:"small",children:e.jsx(Er,{})})}),e.jsx(A,{title:"Open the plugin help",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0px 2px",padding:"0px",width:"19px",height:"19px"},onClick:()=>u(W),size:"small",children:e.jsx(tr,{})})}),e.jsx(A,{title:"Open the plugin version history",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0px 2px",padding:"0px",width:"19px",height:"19px"},onClick:()=>b(W),size:"small",children:e.jsx(Tt,{})})}),W.latestVersion!==void 0&&W.latestVersion!==W.version&&I&&!I.readOnly&&e.jsx(A,{title:"Update the plugin to the latest version",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{color:"var(--primary-color)",margin:"0px 2px",padding:"0px",width:"19px",height:"19px"},onClick:()=>O(W),size:"small",children:e.jsx(Ie,{})})}),W.version.includes("-dev-")&&W.devVersion!==void 0&&W.devVersion!==W.version&&I&&!I.readOnly&&e.jsx(A,{title:"Update the plugin to the latest dev version",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{color:"var(--primary-color)",margin:"0px 2px",padding:"0px",width:"19px",height:"19px"},onClick:()=>P(W),size:"small",children:e.jsx(Ie,{})})}),I&&!I.readOnly&&e.jsx(A,{title:"Sponsor the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0",padding:"0",width:"19px",height:"19px",color:"#b6409c"},onClick:()=>s(W),size:"small",children:e.jsx(rr,{})})})]})},{label:"Status",id:"status",required:!0,noSort:!0,render:(F,J,W,S)=>e.jsx("div",{style:{display:"flex",flexDirection:"row",flex:"1 1 auto",margin:"0",padding:"0",gap:"5px",width:"auto",maxWidth:"max-content"},children:W.error?e.jsx(e.Fragment,{children:e.jsx(Qe,{status:!1,enabledText:"Error",disabledText:"Error",tooltipText:"The plugin is in error state. Check the log!"})}):e.jsx(e.Fragment,{children:W.enabled===!1?e.jsx(e.Fragment,{children:e.jsx(Qe,{status:W.enabled,enabledText:"Enabled",disabledText:"Disabled",tooltipText:"Whether the plugin is enable or disabled"})}):e.jsx(e.Fragment,{children:W.loaded&&W.started&&W.configured?e.jsx(e.Fragment,{children:e.jsx(Qe,{status:W.loaded,enabledText:"Running",tooltipText:"Whether the plugin is running"})}):e.jsxs(e.Fragment,{children:[e.jsx(Qe,{status:W.loaded,enabledText:"Loaded",tooltipText:"Whether the plugin has been loaded"}),e.jsx(Qe,{status:W.started,enabledText:"Started",tooltipText:"Whether the plugin started"}),e.jsx(Qe,{status:W.configured,enabledText:"Configured",tooltipText:"Whether the plugin has been configured"})]})})})})}];r.useEffect(()=>{const F=J=>{o&&console.log("HomePlugins received WebSocket Message:",J),J.method==="refresh_required"&&J.response.changed==="plugins"?(o&&console.log(`HomePlugins received refresh_required: changed=${J.response.changed} and sending /api/plugins request`),i({id:t.current,sender:"HomePlugins",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})):J.method==="refresh_required"&&J.response.changed==="matter"?(o&&console.log(`HomePlugins received refresh_required: changed=${J.response.changed} and setting matter id ${J.response.matter?.id}`),_(W=>{const S=W.findIndex(k=>k.matter?.id===J.response.matter?.id);if(S<0)return o&&console.log(`HomePlugins received refresh_required: changed=${J.response.changed} and matter id ${J.response.matter?.id} not found`),W;o&&console.log(`HomePlugins received refresh_required: changed=${J.response.changed} set matter id ${J.response.matter?.id}`);const j=[...W];return j[S]={...j[S],matter:J.response.matter},j})):J.method==="refresh_required"&&J.response.changed==="settings"&&(o&&console.log(`HomePlugins received refresh_required: changed=${J.response.changed} and sending /api/settings request`),i({id:t.current,sender:"HomePlugins",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),J.id===t.current&&J.method==="/api/settings"?(o&&console.log(`HomePlugins (id: ${J.id}) received settings:`,J.response),w(J.response.systemInformation),D(J.response.matterbridgeInformation)):J.id===t.current&&J.method==="/api/plugins"&&(o&&console.log(`HomePlugins (id: ${J.id}) received ${J.response.length} plugins:`,J.response),_(J.response))};return a(F,t.current),o&&console.log("HomePlugins added WebSocket listener id:",t.current),()=>{m(F),o&&console.log("HomePlugins removed WebSocket listener")}},[a,m,i]),r.useEffect(()=>{l&&(o&&console.log("HomePlugins sending api requests"),i({id:t.current,sender:"HomePlugins",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),i({id:t.current,sender:"HomePlugins",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[l,i]);const $=r.useRef(null),c=(F,J,W,S)=>{o&&console.log(`handleActionWithConfirmCancel ${W} ${S.name}`),$.current=S,v(F,J,W,f,h)},f=F=>{o&&console.log(`handleConfirm action confirmed ${F} ${$.current?.name}`),F==="remove"&&$.current?C($.current):F==="disable"&&$.current&&N($.current),$.current=null},h=F=>{o&&console.log(`handleCancel action canceled ${F} ${$.current?.name}`),$.current=null},O=F=>{o&&console.log("handleUpdatePlugin plugin:",F.name),i({id:t.current,sender:"HomePlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:F.name,restart:!1}})},P=F=>{o&&console.log("handleUpdateDevPlugin plugin:",F.name),i({id:t.current,sender:"HomePlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:F.name+"@dev",restart:!1}})},C=F=>{o&&console.log("handleRemovePlugin plugin:",F.name),i({id:t.current,sender:"HomePlugins",method:"/api/removeplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:F.name}})},q=F=>{o&&console.log("handleRestartPlugin plugin:",F.name),i({id:t.current,sender:"HomePlugins",method:"/api/restartplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:F.name}})},N=F=>{o&&console.log("handleEnableDisablePlugin plugin:",F.name,"enabled:",F.enabled),F.enabled===!0?(F.enabled=!1,i({id:t.current,sender:"HomePlugins",method:"/api/disableplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:F.name}})):(F.enabled=!0,i({id:t.current,sender:"HomePlugins",method:"/api/enableplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:F.name}}))},g=F=>{o&&console.log(`handleHomepagePlugin plugin: ${F.name} homepage: ${F.homepage}`),F.homepage&&window.open(F.homepage,"_blank")},s=F=>{o&&console.log("handleSponsorPlugin plugin:",F.name,"funding:",F.funding),F.funding&&window.open(F.funding,"_blank")},u=F=>{o&&console.log("handleHelpPlugin plugin:",F.name,"help:",F.help),F.help&&window.open(F.help,"_blank")},b=F=>{o&&console.log("handleChangelogPlugin plugin:",F.name,"changelog:",F.changelog),F.changelog&&window.open(F.changelog,"_blank")},[H,le]=r.useState(),[fe,ne]=r.useState(!1),be=F=>{o&&console.log("handleConfigPlugin plugin:",F.name),i({id:t.current,sender:"HomePlugins",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:F.name}}),i({id:t.current,sender:"HomePlugins",method:"/api/select/entities",src:"Frontend",dst:"Matterbridge",params:{plugin:F.name}}),le(F),R()},R=()=>{ne(!0)},U=()=>{ne(!1)};return o&&console.log("HomePlugins rendering..."),l?e.jsxs(je,{children:[H&&e.jsx(vn,{open:fe,onClose:U,plugin:H}),e.jsx(St,{name:"Plugins",columns:V,rows:E,footerRight:"",footerLeft:""})]}):e.jsx(De,{})}const jn=r.memo(yn),wn=n=>`${n.pluginName}::${n.serial}`;function Cn({storeId:n,setStoreId:d}){const{online:l,sendMessage:i,addListener:a,removeListener:m,getUniqueId:p}=r.useContext(he),[v,t]=r.useState(!1),[M,w]=r.useState(!0),[I,D]=r.useState(null),[E,_]=r.useState([]),[V,$]=r.useState([]),[c,f]=r.useState([]),[h,O]=r.useState([]),P=r.useRef(p()),C=[{label:"Plugin",id:"pluginName"},{label:"Name",id:"name",required:!0},{label:"Serial",id:"serial"},{label:"Availability",id:"availability",render:(g,s,u,b)=>u.reachable===!0?"Online":u.reachable===!1?e.jsx("span",{style:{color:"red"},children:"Offline"}):"",comparator:(g,s)=>{const u=g.reachable===!0?1:g.reachable===!1?0:-1,b=s.reachable===!0?1:s.reachable===!1?0:-1;return u-b}},{label:"Power",id:"powerSource",render:(g,s,u,b)=>u.powerSource==="ac"||u.powerSource==="dc"?e.jsx(or,{fontSize:"small",sx:{color:"var(--primary-color)"}}):u.powerSource==="ok"?e.jsx(wt,{fontSize:"small",sx:{color:"green"}}):u.powerSource==="warning"?e.jsx(wt,{fontSize:"small",sx:{color:"yellow"}}):u.powerSource==="critical"?e.jsx(wt,{fontSize:"small",sx:{color:"red"}}):e.jsx("span",{})},{label:"Url",id:"configUrl",maxWidth:150},{label:"Actions",id:"selected",required:!0,render:(g,s,u,b)=>e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[u.matter!==void 0?e.jsx(A,{title:"Show the QRCode or the fabrics",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{onClick:()=>d(n===u.matter?.id?I?.matterbridgeInformation.bridgeMode==="bridge"?"Matterbridge":null:u.matter?.id||null),"aria-label":"Show the QRCode",sx:{margin:0,padding:0,color:lr(u.matter)},children:e.jsx(er,{fontSize:"small"})})}):e.jsx("div",{style:{width:"20px",height:"20px"}}),u.configUrl?e.jsx(A,{title:"Open the configuration page",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{onClick:()=>window.open(u.configUrl,"_blank"),"aria-label":"Open config url",sx:{margin:0,padding:0},children:e.jsx(nr,{fontSize:"small"})})}):e.jsx("div",{style:{width:"20px",height:"20px"}}),u.selected!==void 0?e.jsx(A,{title:"Select/unselect the device",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Ae,{checked:u.selected,onChange:H=>N(H,u),sx:{margin:"0",marginLeft:"8px",padding:"0"},size:"small"})}):e.jsx("div",{style:{width:"20px",height:"20px"}})]})}],q=r.useCallback(g=>{g.selected=void 0;const s=E.find(H=>H.name===g.pluginName);if(!s)return console.error(`HomeDevices isSelected: plugin ${g.pluginName} not found for device ${g.name} `),g.selected;const u=s.schemaJson?.properties?.whiteList?.selectFrom;let b=s.configJson.postfix;return b===""&&(b=void 0),s.hasWhiteList===!0&&s.hasBlackList===!0&&u&&(g.selected=!0,u==="serial"&&s.configJson.whiteList&&s.configJson.whiteList.length>0&&s.configJson.whiteList.includes(b?g.serial.replace("-"+b,""):g.serial)&&(g.selected=!0),u==="serial"&&s.configJson.whiteList&&s.configJson.whiteList.length>0&&!s.configJson.whiteList.includes(b?g.serial.replace("-"+b,""):g.serial)&&(g.selected=!1),u==="serial"&&s.configJson.blackList&&s.configJson.blackList.length>0&&s.configJson.blackList.includes(b?g.serial.replace("-"+b,""):g.serial)&&(g.selected=!1),u==="name"&&s.configJson.whiteList&&s.configJson.whiteList.length>0&&s.configJson.whiteList.includes(g.name)&&(g.selected=!0),u==="name"&&s.configJson.whiteList&&s.configJson.whiteList.length>0&&!s.configJson.whiteList.includes(g.name)&&(g.selected=!1),u==="name"&&s.configJson.blackList&&s.configJson.blackList.length>0&&s.configJson.blackList.includes(g.name)&&(g.selected=!1)),g.selected},[E]);r.useEffect(()=>{const g=s=>{if(o&&console.log("HomeDevices received WebSocket Message:",s),s.method==="refresh_required"&&s.response.changed!=="matter"?(o&&console.log(`HomeDevices received refresh_required: changed=${s.response.changed} and sending /api/plugins request`),i({id:P.current,sender:"HomeDevices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})):s.method==="refresh_required"&&s.response.changed==="matter"?(o&&console.log(`HomeDevices received refresh_required: changed=${s.response.changed} and setting matter id ${s.response.matter?.id}`),O(u=>{const b=u.findIndex(le=>le.name.replaceAll(" ","")===s.response.matter?.id);if(b<0)return o&&console.debug(`HomeDevices: matter id ${s.response.matter?.id} not found`),u;const H=[...u];return H[b]={...H[b],matter:s.response.matter},o&&console.log(`HomeDevices received refresh_required: changed=${s.response.changed} and set matter id ${s.response.matter?.id}`),H})):s.method==="restart_required"?(o&&console.log("HomeDevices received restart_required"),t(!0)):s.method==="restart_not_required"?(o&&console.log("HomeDevices received restart_not_required"),t(!1)):s.method==="state_update"&&s.response.plugin&&s.response.serialNumber&&s.response.cluster.includes("BasicInformation")&&s.response.attribute==="reachable"&&(o&&console.log(`HomeDevices updating device reachability for plugin ${s.response.plugin} serial ${s.response.serialNumber} value ${s.response.value}`),$(u=>{const b=u.findIndex(H=>H.pluginName===s.response.plugin&&H.serial===s.response.serialNumber);return b<0?(o&&console.warn(`HomeDevices: device to update not found for plugin ${s.response.plugin} serial ${s.response.serialNumber}`),u):(u[b]={...u[b],reachable:s.response.value},[...u])})),s.id===P.current&&s.method==="/api/settings")o&&console.log(`HomeDevices (id: ${s.id}) received settings:`,s.response),D(s.response),t(s.response.matterbridgeInformation.restartRequired||s.response.matterbridgeInformation.fixedRestartRequired);else if(s.id===P.current&&s.method==="/api/plugins"){if(o&&console.log(`HomeDevices (id: ${s.id}) received ${s.response?.length} plugins:`,s.response),s.response){let u=!0;for(const b of s.response)b.enabled===!0&&(b.loaded!==!0||b.started!==!0||b.error===!0)&&(u=!1);if(!u)return;o&&console.log("HomeDevices reset plugins, devices and selectDevices"),w(!1),_(s.response),$([]),f([]),i({id:P.current,sender:"HomeDevices",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}}),o&&console.log("HomeDevices sent /api/devices");for(const b of s.response)b.enabled===!0&&b.loaded===!0&&b.started===!0&&b.error!==!0&&(i({id:P.current,sender:"HomeDevices",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:b.name}}),o&&console.log(`HomeDevices sent /api/select/devices for plugin: ${b.name}`))}}else if(s.id===P.current&&s.method==="/api/devices"){if(o&&console.log(`HomeDevices (id: ${s.id}) received ${s.response?.length} devices:`,s.response),s.response){for(const u of s.response)u.selected=q(u);$(s.response)}}else s.id===P.current&&s.method==="/api/select/devices"&&(o&&console.log(`HomeDevices (id: ${s.id}) received ${s.response?.length} selectDevices for plugin ${s.response&&s.response.length>0?s.response[0].pluginName:"without select devices"}:`,s.response),s.response&&s.response.length>0&&f(u=>{const b=u.filter(le=>le.pluginName!==s.response[0].pluginName),H=s.response.map(le=>({...le,selected:q(le)}));return[...b,...H]}))};return a(g,P.current),o&&console.log(`HomeDevices added WebSocket listener id ${P.current}`),()=>{m(g),o&&console.log("HomeDevices removed WebSocket listener")}},[E,a,m,i,q]),r.useEffect(()=>{if(V.length===0&&c.length===0){O([]);return}o&&console.log(`HomeDevices mixing devices (${V.length}) and selectDevices (${c.length})`);const g=[];for(const s of V)g.push(s);for(const s of c)V.find(u=>u.pluginName===s.pluginName&&u.serial.includes(s.serial))||g.push(s);g.length>0&&(O(g),o&&console.log(`HomeDevices mixed ${g.length} devices and selectDevices`))},[E,V,c,O]),r.useEffect(()=>{l&&(o&&console.log("HomeDevices sending /api/settings and /api/plugins requests"),i({id:P.current,sender:"HomeDevices",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),i({id:P.current,sender:"HomeDevices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[l,i]);const N=(g,s)=>{o&&console.log(`handleCheckboxChange: checkbox changed to ${g.target.checked} for device ${s.name} serial ${s.serial}`),V.findIndex(u=>u.pluginName===s.pluginName&&u.serial===s.serial)<0?(o&&console.warn(`handleCheckboxChange: device ${s.name} serial ${s.serial} not found in devices, trying in mixedDevices`),O(u=>{const b=u.findIndex(H=>H.pluginName===s.pluginName&&H.serial===s.serial);return b<0?(console.error(`handleCheckboxChange: device ${s.name} serial ${s.serial} not found in mixedDevices`),u):(u[b]={...u[b],selected:g.target.checked},[...u])})):$(u=>{const b=u.findIndex(H=>H.pluginName===s.pluginName&&H.serial===s.serial);return b<0?(console.error(`handleCheckboxChange: device ${s.name} serial ${s.serial} not found in devices`),u):(u[b]={...u[b],selected:g.target.checked},[...u])}),g.target.checked?i({id:P.current,sender:"HomeDevices",method:"/api/command",src:"Frontend",dst:"Matterbridge",params:{command:"selectdevice",plugin:s.pluginName,serial:s.serial,name:s.name}}):i({id:P.current,sender:"HomeDevices",method:"/api/command",src:"Frontend",dst:"Matterbridge",params:{command:"unselectdevice",plugin:s.pluginName,serial:s.serial,name:s.name}})};return o&&console.log("HomeDevices rendering..."),l?e.jsx(je,{style:{flex:"1 1 auto"},children:e.jsx(St,{name:"Devices",getRowKey:wn,rows:h,columns:C,footerLeft:M?"Waiting for the plugins to fully load...":`Registered devices: ${V.length.toString()}/${h.length.toString()}`,footerRight:v?"Restart required":""})}):e.jsx(De,{})}const Sn=r.memo(Cn);function Mt({children:n,style:d,name:l}){const{setCurrentPage:i}=r.useContext(_e);i(l),o&&console.log(`MbfPage: current page set to ${l}`);const a={display:"flex",flexDirection:"column",width:"100%",height:"100%",margin:"0px",padding:"0px",gap:"20px"};return e.jsx("div",{style:{...a,...d},children:n})}const kn=()=>"ontouchstart"in window||typeof window.DocumentTouch<"u"&&document instanceof window.DocumentTouch?(o&&console.log("WebSocketLogs detectTouchscreen = true"),!0):(o&&console.log("WebSocketLogs detectTouchscreen = false"),!1);function Mn(){const{messages:n,logAutoScroll:d}=r.useContext(ar),[l,i]=r.useState(!1),a=r.useRef(null),m=r.useRef(0),p=r.useRef(null),v=r.useMemo(()=>kn(),[]),t=D=>i(!0),M=D=>i(!1);r.useEffect(()=>{if(o&&console.log(`WebSocketLogs logAutoScroll: ${d} isHovering: ${l}`),d&&!l&&!v){const D=Date.now();D-m.current>=500?(m.current=D,a.current?.scrollIntoView({behavior:"smooth"})):(o&&console.log("WebSocketLogs auto-scroll skipped to avoid flicker"),p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{a.current?.scrollIntoView({behavior:"smooth"}),m.current=Date.now()},1e3))}},[n,l,d,v]);const w=D=>{switch(D.toLowerCase()){case"debug":return"gray";case"info":return"#267fb7";case"notice":return"green";case"warn":return"#e9db18";case"error":return"red";case"fatal":return"#ff0000";case"spawn":return"#ff00d0";default:return"#5c0e91"}},I=D=>{switch(D.toLowerCase()){case"warn":return"black";default:return"white"}};return e.jsx("div",{style:{margin:"0px",padding:"0px"},children:e.jsxs("ul",{style:{margin:"0px",padding:"0px"},onMouseEnter:t,onMouseLeave:M,children:[n.map((D,E)=>e.jsxs("li",{style:{wordWrap:"break-word",maxHeight:"200px",overflow:"hidden"},children:[e.jsx("span",{style:{marginRight:"5px",padding:"1px 5px",backgroundColor:w(D.level),color:I(D.level),fontSize:"12px",borderRadius:"3px",textAlign:"center"},children:D.level}),D.time&&e.jsx("span",{style:{marginRight:"3px",color:"#505050"},children:"["+D.time+"]"}),D.name&&e.jsx("span",{style:{marginRight:"3px",color:"#09516d"},children:"["+D.name+"]"}),e.jsx("span",{style:{color:"var(--main-log-color)"},children:D.message})]},E)),e.jsx("div",{ref:a})]})})}const dr=r.memo(Mn);function In(){const{logFilterLevel:n,logFilterSearch:d,logAutoScroll:l,online:i}=r.useContext(he);return r.useEffect(()=>{o&&console.log(`HomeLogs logFilterLevel: ${n}, logFilterSearch: ${d}, logAutoScroll: ${l}`)},[n,d,l]),o&&console.log("HomeLogs rendering..."),i?e.jsxs(je,{style:{flex:"1 1 auto"},children:[e.jsxs(Ue,{children:[e.jsx(Ve,{children:"Logs"}),e.jsxs(Ve,{style:{fontWeight:"normal",fontSize:"12px",marginTop:"2px"},children:['Filter: logger level "',n,'" and search "',d,'" Scroll: ',l?"auto":"manual"]})]}),e.jsx(kt,{style:{flex:"1 1 auto",overflow:"auto",margin:"0px",padding:"10px",alignItems:"start"},children:e.jsx(dr,{})})]}):e.jsx(De,{})}const Dn=r.memo(In);function Pn(){const{online:n}=r.useContext(he);return o&&console.log("HomeBrowserRefresh rendering..."),n?e.jsxs(je,{children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Frontend Update"})}),e.jsxs("div",{className:"MbfWindowBody",style:{flexDirection:"row",justifyContent:"space-between"},children:[e.jsx("h4",{style:{margin:0},children:"The frontend has been updated. You are viewing an outdated web UI. Please refresh the page now."}),e.jsx("div",{children:e.jsx(ie,{onClick:()=>window.location.reload(),endIcon:e.jsx(Ar,{}),style:{marginLeft:"10px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Refresh"})})]})]}):e.jsx(De,{})}const Ln=r.memo(Pn);function $n({changelog:n}){const{online:d}=r.useContext(he);return o&&console.log("HomeShowChangelog rendering..."),d?e.jsxs(je,{children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge Update"})}),e.jsxs("div",{className:"MbfWindowBody",style:{flexDirection:"row",justifyContent:"space-between"},children:[e.jsx("h4",{style:{margin:0},children:"Matterbridge has been updated."}),e.jsxs("div",{children:[e.jsx(ie,{onClick:()=>window.open(n,"_blank"),endIcon:e.jsx(Tt,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Changelog"}),e.jsx(ie,{onClick:()=>window.location.reload(),endIcon:e.jsx(_r,{}),style:{marginLeft:"10px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Close"})]})]})]}):e.jsx(De,{})}const Nn=r.memo($n);function Wn(){const[n,d]=r.useState(null),[l,i]=r.useState(null),[a,m]=r.useState([]),[p]=r.useState(localStorage.getItem("homePagePlugins")!=="false"),[v,t]=r.useState(localStorage.getItem("homePageMode")??"devices"),[M,w]=r.useState(""),[I,D]=r.useState(!1),[E,_]=r.useState(!1),[V,$]=r.useState(null),{addListener:c,removeListener:f,online:h,sendMessage:O,getUniqueId:P}=r.useContext(he),C=r.useRef(P());return r.useEffect(()=>{const q=N=>{o&&console.log("Home received WebSocket Message:",N),N.method==="refresh_required"&&N.response.changed==="settings"&&(o&&console.log(`Home received refresh_required: changed=${N.response.changed} and sending /api/settings request`),$(null),m([]),O({id:C.current,sender:"Home",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),O({id:C.current,sender:"Home",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})),N.method==="/api/settings"&&N.id===C.current&&(o&&console.log("Home received settings:",N.response),d(N.response.systemInformation),i(N.response.matterbridgeInformation),N.response.matterbridgeInformation.matterbridgeVersion&&w(`https://github.com/Luligu/matterbridge/blob/${N.response.matterbridgeInformation.matterbridgeVersion.includes("-dev-")?"dev":"main"}/CHANGELOG.md`),localStorage.getItem("frontendVersion")===null&&N.response.matterbridgeInformation.frontendVersion?localStorage.setItem("frontendVersion",N.response.matterbridgeInformation.frontendVersion):N.response.matterbridgeInformation.frontendVersion!==localStorage.getItem("frontendVersion")&&N.response.matterbridgeInformation.frontendVersion&&(localStorage.setItem("frontendVersion",N.response.matterbridgeInformation.frontendVersion),_(!0)),localStorage.getItem("matterbridgeVersion")===null?localStorage.setItem("matterbridgeVersion",N.response.matterbridgeInformation.matterbridgeVersion):N.response.matterbridgeInformation.matterbridgeVersion!==localStorage.getItem("matterbridgeVersion")&&(localStorage.setItem("matterbridgeVersion",N.response.matterbridgeInformation.matterbridgeVersion),D(!0)),N.response.matterbridgeInformation.shellyBoard&&(localStorage.getItem("homePageMode")||(localStorage.setItem("homePageMode","devices"),t("devices")))),N.method==="/api/plugins"&&N.id===C.current&&(o&&console.log("Home received plugins:",N.response),m(N.response))};return c(q,C.current),o&&console.log(`Home added WebSocket listener id ${C.current}`),()=>{f(q),o&&console.log("Home removed WebSocket listener")}},[c,f,O]),r.useEffect(()=>{if(o&&console.log(`Home storeId effect with storeId ${V}`),l?.bridgeMode==="bridge"&&!V&&(o&&console.log("Home storeId effect set storeId to Matterbridge"),$("Matterbridge")),l?.bridgeMode==="childbridge"&&!V&&a){for(const q of a)if(q.matter?.id){o&&console.log(`Home storeId effect set storeId to ${q.matter.id}`),$(q.matter.id);break}}},[l,a,V]),r.useEffect(()=>{h&&(o&&console.log("Home online effect, sending /api/settings and /api/plugins requests"),O({id:C.current,sender:"Home",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),O({id:C.current,sender:"Home",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[h,O]),o&&console.log("Home rendering..."),!h||!n||!l?e.jsx(De,{}):e.jsxs(Mt,{name:"Home",style:{flexDirection:"row"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",width:"302px",minWidth:"302px",gap:"20px"},children:[e.jsx(cn,{id:V}),e.jsx(an,{systemInfo:n,compact:!0})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",width:"100%",gap:"20px"},children:[E&&e.jsx(Ln,{}),I&&e.jsx(Nn,{changelog:M}),p&&!l.readOnly&&e.jsx(un,{}),p&&e.jsx(jn,{storeId:V,setStoreId:$}),v==="devices"&&e.jsx(Sn,{storeId:V,setStoreId:$}),v==="logs"&&e.jsx(Dn,{})]})]})}const Tn=r.memo(Wn),vt=!1,Yt={display:"flex",gap:"2px",justifyContent:"space-evenly",width:"100%",height:"40px"},Fn={margin:"0",padding:"0",fontSize:"36px",fontWeight:"medium",color:"var(--primary-color)"},Rn={margin:"0",padding:"0",fontSize:"20px",fontWeight:"medium",color:"var(--div-text-color)",textAlign:"center"},Xt={margin:"0",padding:"0",paddingBottom:"2px",fontSize:"16px",fontWeight:"medium",color:"var(--div-text-color)",textAlign:"center"},Hn={display:"flex",gap:"2px",justifyContent:"center",width:"100%",height:"18px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},On={margin:"0",padding:"0",fontSize:"12px",fontWeight:"normal",color:"var(--div-text-color)"},Vn={display:"flex",justifyContent:"center",width:"100%",height:"52px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},En={margin:"0",padding:"0",fontSize:"14px",fontWeight:"bold",color:"var(--div-text-color)"},An={display:"flex",gap:"4px",justifyContent:"center",width:"100%",height:"15px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},Lt={margin:"0",padding:"0px 4px",borderRadius:"5px",textAlign:"center",fontSize:"12px",fontWeight:"normal",color:"var(--secondary-color)"},_n=[256,257,268,269],zn=[266,267],Un=[259,260,261,271,272],qn=[256,257,268,269,266,267,259,260,261,272];function K({icon:n,iconColor:d,cluster:l,value:i,unit:a,prefix:m}){return o&&console.log(`Render cluster "${l.clusterName}.${l.attributeName}" value(${typeof i}-${isNaN(i)}) "${i}" unit "${a}"`),m=m??!1,e.jsxs(X,{sx:Yt,children:[n&&r.cloneElement(n,{key:`${l.clusterId}-${l.attributeId}-icon`,sx:{...Fn,color:d??"var(--primary-color)"}}),e.jsxs(X,{sx:{...Yt,gap:"4px",alignContent:"center",alignItems:"end",justifyContent:"center"},children:[a&&m===!0&&e.jsx(se,{sx:Xt,children:a},`${l.clusterId}-${l.attributeId}-unit`),e.jsx(se,{sx:Rn,children:i==null||typeof i=="number"&&isNaN(i)||i==="NaN"?"---":i},`${l.clusterId}-${l.attributeId}-value`),a&&m===!1&&e.jsx(se,{sx:Xt,children:a},`${l.clusterId}-${l.attributeId}-unit`)]},`${l.clusterId}-${l.attributeId}-valueunitbox`)]},`${l.clusterId}-${l.attributeId}-box`)}function Bn({device:n,endpoint:d,id:l,deviceType:i,clusters:a}){const m=["Unknown","Good","Fair","Moderate","Poor","VeryPoor","Ext.Poor"];let p="";o&&console.log(`Device "${n.name}" endpoint "${d}" id "${l}" deviceType "0x${i.toString(16).padStart(4,"0")}" clusters (${a?.length})`);const v=a.find(t=>t.clusterName==="Descriptor"&&t.attributeName==="tagList")?.attributeLocalValue;if(v){let t="";v.map(M=>{M.label&&(t+=M.label+" ")}),p=t.trim()}if(i===17&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="batVoltage").map(t=>p=`${t.attributeLocalValue} mV`),qn.includes(i)&&a.filter(t=>t.clusterName==="LevelControl"&&t.attributeName==="currentLevel").map(t=>p=`Level ${t.attributeValue}`),i===514&&a.filter(t=>t.clusterName==="WindowCovering"&&t.attributeName==="currentPositionLiftPercent100ths").map(t=>p=`Position ${t.attributeLocalValue/100}%`),i===769&&a.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="occupiedHeatingSetpoint").map(t=>p=`Heat ${t.attributeLocalValue/100}Â°C `),i===769&&a.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="occupiedCoolingSetpoint").map(t=>p=p+`Cool ${t.attributeLocalValue/100}Â°C`),i===118&&a.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="coState").map(t=>p=`${t.attributeLocalValue===0?"No CO detected":"CO alarm!"}`),i===1296&&a.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="voltage").map(t=>p=`${t.attributeLocalValue/1e3} V, `),i===1296&&a.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="activeCurrent").map(t=>p=p+`${t.attributeLocalValue/1e3} A, `),i===1296&&a.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="activePower").map(t=>p=p+`${t.attributeLocalValue/1e3} W`),i===39){const t=a.find(w=>w.clusterName==="ModeSelect"&&w.attributeName==="currentMode")?.attributeLocalValue;p=a.find(w=>w.clusterName==="ModeSelect"&&w.attributeName==="supportedModes")?.attributeLocalValue?.find(w=>w.mode===t)?.label||"Unknown"}if(i===116){const t=a.find(w=>w.clusterName==="RvcRunMode"&&w.attributeName==="currentMode")?.attributeLocalValue;p=a.find(w=>w.clusterName==="RvcRunMode"&&w.attributeName==="supportedModes")?.attributeLocalValue?.find(w=>w.mode===t)?.label||"Unknown"}return e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0px",padding:"5px",width:"150px",height:"150px",borderColor:"var(--div-bg-color)",borderRadius:"5px",justifyContent:"space-between"},children:[i===19&&a.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(K,{icon:t.attributeLocalValue===!0?e.jsx(nt,{}):e.jsx(zr,{}),iconColor:t.attributeLocalValue===!0?"green":"red",cluster:t,value:t.attributeLocalValue===!0?"Online":"Offline"})),i===17&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="batPercentRemaining").map(t=>e.jsx(K,{icon:e.jsx(wt,{}),cluster:t,value:t.attributeLocalValue/2,unit:"%"})),i===17&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="wiredCurrentType").map(t=>e.jsx(K,{icon:e.jsx(or,{}),cluster:t,value:t.attributeLocalValue===0?"AC":"DC"})),i===1293&&a.filter(t=>t.clusterName==="DeviceEnergyManagement"&&t.attributeName==="esaState").map(t=>e.jsx(K,{icon:e.jsx(oe,{path:Mo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Offline":"Online"})),_n.includes(i)&&a.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(K,{icon:e.jsx(Ur,{}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),zn.includes(i)&&a.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(K,{icon:e.jsx(oe,{path:Io,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),Un.includes(i)&&a.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(K,{icon:e.jsx(oe,{path:Do,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),i===115&&a.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(K,{icon:e.jsx(oe,{path:Po,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),i===124&&a.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(K,{icon:e.jsx(oe,{path:Lo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),i===117&&a.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(K,{icon:e.jsx(oe,{path:$o,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),i===123&&a.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(K,{icon:e.jsx(zt,{}),cluster:t,value:"Oven"})),i===112&&a.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(K,{icon:e.jsx(qr,{}),cluster:t,value:"Fridge"})),i===113&&a.filter(t=>t.clusterName==="TemperatureControl"&&t.attributeName==="selectedTemperatureLevel").map(t=>e.jsx(K,{icon:e.jsx(oe,{path:No,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),i===121&&a.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(K,{icon:e.jsx(zt,{}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),i===122&&a.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="fanMode").map(t=>e.jsx(K,{icon:e.jsx(oe,{path:Wo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),i===120&&a.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(K,{icon:e.jsx(oe,{path:Gt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Cooktop"})),i===119&&a.filter(t=>t.clusterName==="TemperatureControl"&&t.attributeName==="selectedTemperatureLevel").map(t=>e.jsx(K,{icon:e.jsx(oe,{path:Gt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),i===514&&a.filter(t=>t.clusterName==="WindowCovering"&&t.attributeName==="currentPositionLiftPercent100ths").map(t=>e.jsx(K,{icon:e.jsx(Br,{}),cluster:t,value:t.attributeLocalValue/100,unit:"%"})),i===769&&a.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="localTemperature").map(t=>e.jsx(K,{icon:e.jsx(oe,{path:To,size:"40px",color:"var(--primary-color)"}),cluster:t,value:(t.attributeLocalValue??0)/100,unit:"Â°C"})),i===10&&a.filter(t=>t.clusterName==="DoorLock"&&t.attributeName==="lockState").map(t=>e.jsx(K,{icon:t.attributeValue==="1"?e.jsx(Qr,{}):e.jsx(Gr,{}),cluster:t,value:t.attributeValue==="1"?"Locked":"Unlocked"})),i===43&&a.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="percentCurrent").map(t=>e.jsx(K,{icon:e.jsx(Kr,{}),cluster:t,value:t.attributeValue,unit:"%"})),i===15&&a.filter(t=>t.clusterName==="Switch"&&t.attributeName==="currentPosition").map(t=>e.jsx(K,{icon:e.jsx(oe,{path:Fo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeValue,unit:"pos",prefix:!0})),i===39&&a.filter(t=>t.clusterName==="ModeSelect"&&t.attributeName==="currentMode").map(t=>e.jsx(K,{icon:e.jsx(Jr,{}),cluster:t,value:t.attributeValue,unit:"Mode",prefix:!0})),i===771&&a.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(K,{icon:e.jsx(Zr,{}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),i===45&&a.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="percentCurrent").map(t=>e.jsx(K,{icon:e.jsx(Ut,{}),cluster:t,value:t.attributeValue,unit:"%"})),i===114&&a.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="localTemperature").map(t=>e.jsx(K,{icon:e.jsx(Ut,{}),cluster:t,value:(t.attributeLocalValue??0)/100,unit:"Â°C"})),i===67&&a.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(K,{icon:e.jsx(Yr,{}),cluster:t,value:t.attributeLocalValue===!0?"Leak":"No leak"})),i===65&&a.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(K,{icon:e.jsx(Xr,{}),cluster:t,value:t.attributeLocalValue===!0?"Freeze":"No freeze"})),i===68&&a.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(K,{icon:e.jsx(eo,{}),cluster:t,value:t.attributeLocalValue===!0?"Rain":"No rain"})),i===116&&a.filter(t=>t.clusterName==="RvcRunMode"&&t.attributeName==="currentMode").map(t=>e.jsx(K,{icon:e.jsx(oe,{path:Ro,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeValue,unit:"Run mode",prefix:!0})),i===1292&&a.filter(t=>t.clusterName==="EnergyEvse"&&t.attributeName==="state").map(t=>e.jsx(K,{icon:e.jsx(oe,{path:Ho,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Free":"In use"})),i===1295&&a.filter(t=>t.clusterName==="WaterHeaterManagement"&&t.attributeName==="tankPercentage").map(t=>e.jsx(K,{icon:e.jsx(oe,{path:Oo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Tank "+(t.attributeLocalValue??0)+"%"})),i===777&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="featureMap").map(t=>e.jsx(K,{icon:e.jsx(oe,{path:Vo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"HeatPump"})),i===23&&a.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="featureMap").map(t=>e.jsx(K,{icon:e.jsx(oe,{path:Eo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Solar"})),i===24&&a.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="featureMap").map(t=>e.jsx(K,{icon:e.jsx(oe,{path:Ao,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Inverter"})),i===118&&a.find(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="featureMap"&&t.attributeLocalValue.smokeAlarm===!0)&&a.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="smokeState").map(t=>e.jsx(K,{icon:e.jsx(oe,{path:Kt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"No smoke":"Smoke!"})),i===118&&a.find(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="featureMap"&&t.attributeLocalValue.smokeAlarm===!1)&&a.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="coState").map(t=>e.jsx(K,{icon:e.jsx(oe,{path:Kt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"No Co":"Co!"})),i===66&&a.filter(t=>t.clusterName==="ValveConfigurationAndControl"&&t.attributeName==="currentState").map(t=>e.jsx(K,{icon:e.jsx(to,{}),cluster:t,value:t.attributeLocalValue===0?"Closed":"Opened"})),i===44&&a.filter(t=>t.clusterName==="AirQuality"&&t.attributeName==="airQuality").map(t=>e.jsx(K,{icon:e.jsx(oe,{path:_o,size:"40px",color:"var(--primary-color)"}),cluster:t,value:m[t.attributeLocalValue??0]})),i===770&&a.filter(t=>t.clusterName==="TemperatureMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(K,{icon:e.jsx(ro,{}),cluster:t,value:t.attributeLocalValue/100,unit:"Â°C"})),i===775&&a.filter(t=>t.clusterName==="RelativeHumidityMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(K,{icon:e.jsx(oe,{path:zo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue/100,unit:"%"})),i===774&&a.filter(t=>t.clusterName==="FlowMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(K,{icon:e.jsx(oo,{}),cluster:t,value:t.attributeLocalValue,unit:"l/h"})),i===773&&a.filter(t=>t.clusterName==="PressureMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(K,{icon:e.jsx(no,{}),cluster:t,value:t.attributeLocalValue,unit:"hPa"})),i===21&&a.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(K,{icon:t.attributeValue==="true"?e.jsx(io,{}):e.jsx(so,{}),cluster:t,value:t.attributeValue==="true"?"Closed":"Opened"})),i===263&&a.filter(t=>t.clusterName==="OccupancySensing"&&t.attributeName==="occupancy").map(t=>e.jsx(K,{icon:t.attributeValue==="{ occupied: true }"?e.jsx(ao,{}):e.jsx(lo,{}),cluster:t,value:t.attributeValue==="{ occupied: true }"?"Occupied":"Unocc."})),i===262&&a.filter(t=>t.clusterName==="IlluminanceMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(K,{icon:e.jsx(co,{}),cluster:t,value:Math.round(Math.pow(10,t.attributeLocalValue/1e4)),unit:"lx"})),i===1296&&a.filter(t=>t.clusterName==="ElectricalEnergyMeasurement"&&t.attributeName==="cumulativeEnergyImported").map(t=>e.jsx(K,{icon:e.jsx(po,{}),cluster:t,value:Math.round(t.attributeLocalValue?.energy/1e6),unit:"kwh"})),e.jsx(X,{sx:Hn,children:e.jsx(se,{sx:On,children:p})}),e.jsx(X,{sx:Vn,children:e.jsx(se,{sx:En,children:n.name})}),e.jsxs(X,{sx:An,children:[o&&e.jsx(se,{sx:Lt,children:d}),e.jsx(se,{sx:Lt,children:l}),o&&e.jsxs(se,{sx:Lt,children:["0x",i.toString(16).padStart(4,"0")]})]})]})}function Qn({filter:n}){const{online:d,sendMessage:l,addListener:i,removeListener:a,getUniqueId:m}=r.useContext(he),[p,v]=r.useState([]),[t,M]=r.useState({}),[w,I]=r.useState({}),[D,E]=r.useState({}),_=r.useRef(m()),V=r.useCallback(f=>{(o||vt)&&console.log(`DevicesIcons received state_update "${f.response.cluster}.${f.response.attribute}" for "${f.response.id}:${f.response.number}": "${f.response.value}"`,f.response);const h=p.find(P=>P.pluginName===f.response.plugin&&P.serial===f.response.serialNumber);if(!h){(o||vt)&&console.warn(`DevicesIcons updater device of plugin "${f.response.plugin}" serial "${f.response.serialNumber}" number "${f.response.number}" id "${f.response.id}" not found in devices(${p.length})`);return}const O=D[h.serial]?.find(P=>P.endpoint===f.response.number.toString()&&P.clusterName===f.response.cluster&&P.attributeName===f.response.attribute);if(!O){(o||vt)&&console.warn(`DevicesIcons updater device "${h.name}" serial "${h.serial}" cluster "${f.response.cluster}" attribute "${f.response.attribute}" not found in clusters(${D[h.serial]?.length})`);return}O.attributeValue=String(f.response.value),O.attributeLocalValue=f.response.value,E({...D}),(o||vt)&&console.log(`DevicesIcons updated "${O.clusterName}.${O.attributeName}" for device "${h.name}" serial "${h.serial}" to "${O.attributeValue}"`)},[D,p]),$=r.useCallback(f=>{if(o&&console.log(`DevicesIcons received for device "${f.response.deviceName}" serial "${f.response.serialNumber}" deviceTypes (${f.response.deviceTypes.length}) "${f.response.deviceTypes.join(",")}" clusters (${f.response.clusters.length}):`,f.response),f.response.clusters.length===0)return;const h=f.response.serialNumber;t[h]=[],w[h]=f.response.deviceTypes,D[h]=[];for(const O of f.response.clusters)t[h].find(P=>P.endpoint===O.endpoint)||t[h].push({endpoint:O.endpoint,id:O.id,deviceTypes:O.deviceTypes}),!["FixedLabel","Identify","Groups","PowerTopology"].includes(O.clusterName)&&D[h].push(O);M({...t}),I({...w}),E({...D}),o&&console.log(`DevicesIcons endpoints for "${h}":`,t[h]),o&&console.log(`DevicesIcons deviceTypes for "${h}":`,w[h]),o&&console.log(`DevicesIcons clusters for "${h}":`,D[h])},[D,w,t]);r.useEffect(()=>{const f=h=>{if(o&&console.log("DevicesIcons received WebSocket Message:",h),h.method==="refresh_required")o&&console.log(`DevicesIcons received refresh_required: changed=${h.response.changed} and sending api requests`),l({id:_.current,sender:"DevicesIcons",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}});else if(h.method==="state_update"&&h.response)V(h);else if(h.method==="/api/devices"&&h.response){o&&console.log(`DevicesIcons received ${h.response.length} devices:`,h.response),v(h.response),M({}),I({}),E({});for(const O of h.response)o&&console.log("DevicesIcons sending /api/clusters"),l({id:_.current,sender:"DevicesIcons",method:"/api/clusters",src:"Frontend",dst:"Matterbridge",params:{plugin:O.pluginName,endpoint:O.endpoint||0}})}else h.method==="/api/clusters"&&h.response&&$(h)};return i(f,_.current),o&&console.log("DevicesIcons WebSocket effect mounted"),()=>{a(f),o&&console.log("DevicesIcons WebSocket effect unmounted")}},[p]),r.useEffect(()=>(o&&console.log("DevicesIcons useEffect online mounting"),d&&(o&&console.log("DevicesIcons useEffect online sending api requests"),l({id:_.current,sender:"DevicesIcons",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}})),o&&console.log("DevicesIcons useEffect online mounted"),()=>{o&&console.log("DevicesIcons useEffect online unmounted")}),[d,l]);const c=r.memo(Bn);return o&&console.log("DevicesIcons rendering..."),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",paddingBottom:"5px",gap:"20px",width:"100%",overflow:"auto"},children:p.filter(f=>f.name.toLowerCase().includes(n)||f.serial.toLowerCase().includes(n)).map(f=>t[f.serial]&&t[f.serial].map(h=>h.deviceTypes.map(O=>e.jsx(c,{device:f,endpoint:h.endpoint,id:h.id,deviceType:O,clusters:D[f.serial].filter(P=>P.endpoint===h.endpoint)},`${f.pluginName}-${f.uniqueId}-${h.endpoint}-${h.id}-${O.toString()}`))))})}const Gn=r.memo(Qn),Kn=[{label:"Plugin name",id:"pluginName",required:!0},{label:"Device type",id:"type"},{label:"Endpoint",id:"endpoint",align:"right"},{label:"Name",id:"name",required:!0},{label:"Serial number",id:"serial"},{label:"Unique ID",id:"uniqueId"},{label:"Url",id:"configUrl"},{label:"Config",id:"configButton",noSort:!0,render:(n,d,l,i)=>l.configUrl?e.jsx(Q,{onClick:()=>window.open(l.configUrl,"_blank"),"aria-label":"Open Config",sx:{margin:0,padding:0},children:e.jsx(nr,{fontSize:"small"})}):null},{label:"Cluster",id:"cluster"}],Jn=[{label:"Endpoint",id:"endpoint",required:!0},{label:"Id",id:"id"},{label:"Device Types",id:"deviceTypes",render:(n,d,l,i)=>Array.isArray(n)?e.jsx(e.Fragment,{children:n.map(a=>`0x${a.toString(16).padStart(4,"0")}`).join(", ")}):e.jsx(e.Fragment,{children:n})},{label:"Cluster Name",id:"clusterName",required:!0},{label:"Cluster ID",id:"clusterId"},{label:"Attribute Name",id:"attributeName",required:!0},{label:"Attribute ID",id:"attributeId"},{label:"Attribute Value",id:"attributeValue",required:!0,render:(n,d,l,i)=>e.jsx(A,{title:String(n),componentsProps:{tooltip:{sx:{fontSize:"14px",fontWeight:"normal",color:"#ffffff",backgroundColor:"var(--primary-color)"}}},children:e.jsx("div",{style:{maxWidth:"500px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:String(n)})})}],Zn=n=>`${n.pluginName}::${n.uniqueId}`,Yn=n=>`${n.endpoint}::${n.clusterName}::${n.attributeName}`;function Xn({filter:n}){const{online:d,sendMessage:l,addListener:i,removeListener:a,getUniqueId:m}=r.useContext(he),[p,v]=r.useState([]),[t,M]=r.useState(p),[w,I]=r.useState([]),[D,E]=r.useState(0),[_,V]=r.useState(null),[$,c]=r.useState(null),[f,h]=r.useState(null),[O,P]=r.useState(null),C=r.useRef(m()),q=r.useRef(t),N=r.useCallback(s=>{o&&console.log(`DevicesTable received state_update "${s.response.cluster}.${s.response.attribute}" for "${s.response.id}:${s.response.number}": "${s.response.value}"`,s.response);const u=q.current.find(b=>b.pluginName===s.response.plugin&&b.uniqueId===s.response.uniqueId);if(!u){o&&console.warn(`DevicesTable updater device of plugin "${s.response.plugin}" serial "${s.response.serialNumber}" not found in filteredDevicesRef.current`);return}if(_&&$&&u.pluginName===_&&u.uniqueId===O&&s.response.number.toString()===$){const b=w.find(H=>H.endpoint===s.response.number.toString()&&H.clusterName===s.response.cluster&&H.attributeName===s.response.attribute);if(!b){o&&console.warn(`DevicesTable updater cluster ${s.response.cluster}.${s.response.attribute} for device "${u.name}" serial "${u.serial}" not found in clusters`);return}b.attributeValue=typeof s.response.value=="object"?JSON.stringify(s.response.value,void 0,1).replaceAll('"',""):String(s.response.value),b.attributeLocalValue=s.response.value,I([...w]),o&&console.log(`DevicesTable updated attribute ${b.clusterName}.${b.attributeName} for device "${u.name}" serial "${u.serial}" to "${b.attributeValue}"`)}},[w,$,_,O]);r.useEffect(()=>{const s=u=>{if(o&&console.log("DevicesTable received WebSocket Message:",u),u.method==="refresh_required"&&u.response.changed==="devices")o&&console.log(`DevicesTable received refresh_required: changed=${u.response.changed} and sending /api/devices request`),l({id:C.current,sender:"DevicesTable",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}});else if(u.method==="state_update"&&u.response)N(u);else if(u.method==="/api/devices")o&&console.log(`DevicesTable received ${u.response.length} devices:`,u.response),v(u.response);else if(u.method==="/api/clusters"){o&&console.log(`DevicesTable received ${u.response.clusters.length} clusters for plugin ${u.response.plugin}:`,u.response),I(u.response.clusters);const b={};for(const H of u.response.clusters)o&&console.log("Cluster:",H.endpoint),b[H.endpoint]?b[H.endpoint]++:b[H.endpoint]=1;E(Object.keys(b).length)}};return i(s,C.current),o&&console.log("DevicesTable added WebSocket listener"),()=>{a(s),o&&console.log("DevicesTable removed WebSocket listener")}},[l,i,a,N]),r.useEffect(()=>{d&&(o&&console.log("DevicesTable sending api requests with id ",C.current),l({id:C.current,sender:"DevicesTable",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),l({id:C.current,sender:"DevicesTable",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),l({id:C.current,sender:"DevicesTable",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}}))},[d,l]),r.useEffect(()=>{_&&$&&(o&&console.log("DevicesTable sending /api/clusters"),l({id:C.current,sender:"DevicesTable",method:"/api/clusters",src:"Frontend",dst:"Matterbridge",params:{plugin:_,endpoint:Number($)}}))},[_,$,l]),r.useEffect(()=>{if(n===""){M(p),q.current=p;return}const s=p.filter(u=>u.name.toLowerCase().includes(n)||u.serial.toLowerCase().includes(n));M(s),q.current=s},[p,n]);const g=s=>{if(s.uniqueId===O){P(null),V(null),c(null),h(null);return}P(s.uniqueId),V(s.pluginName),c(s.endpoint?s.endpoint.toString():null),h(s.name)};return o&&console.log("DevicesTable rendering..."),d?e.jsxs("div",{style:{display:"flex",flexDirection:"column",margin:"0px",padding:"0px",gap:"20px",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowDiv",style:{margin:"0px",padding:"0px",gap:"0px",width:"100%",maxHeight:`${_&&$?"30%":"100%"}`,flex:"1 1 auto",overflow:"hidden"},children:e.jsx(St,{name:"Registered devices",getRowKey:Zn,onRowClick:g,rows:t,columns:Kn,footerLeft:`Total devices: ${t.length.toString()}`})}),_&&$&&e.jsx("div",{className:"MbfWindowDiv",style:{margin:"0px",padding:"0px",gap:"0px",width:"100%",height:"70%",maxHeight:"70%",flex:"1 1 auto",overflow:"hidden"},children:e.jsx(St,{name:"Clusters",title:f||"",getRowKey:Yn,rows:w,columns:Jn,footerLeft:`Total child endpoints: ${D-1}`})})]}):e.jsx(De,{})}const ei=r.memo(Xn);function ti(){const{online:n}=r.useContext(he),[d,l]=r.useState(""),[i,a]=r.useState("icon");r.useEffect(()=>{const v=localStorage.getItem("devicesFilter");v&&l(v)},[]),r.useEffect(()=>{const v=localStorage.getItem("devicesViewMode");v&&a(v)},[]);const m=v=>{l(v.target.value.toLowerCase()),localStorage.setItem("devicesFilter",v.target.value.toLowerCase())},p=v=>{a(v),localStorage.setItem("devicesViewMode",v)};return o&&console.log("Devices rendering..."),n?e.jsxs(Mt,{name:"Devices",children:[e.jsxs("div",{className:"MbfWindowBodyRow",style:{justifyContent:"space-between",padding:0,gap:"20px",width:"100%",height:"45px",minHeight:"45px",maxHeight:"45px"},children:[e.jsxs(X,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx(se,{sx:{fontSize:"16px",fontWeight:"normal",color:"var(--div-text-color)",marginLeft:"5px",whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(me,{variant:"outlined",value:d,onChange:m,placeholder:"Enter the device name or serial number",sx:{width:"320px"},InputProps:{style:{backgroundColor:"var(--main-bg-color)"}}})]}),e.jsxs(X,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx(se,{sx:{fontSize:"16px",fontWeight:"normal",color:"var(--div-text-color)",marginLeft:"5px",whiteSpace:"nowrap"},children:"View mode:"}),e.jsx(Q,{onClick:()=>p("table"),"aria-label":"Table View",disabled:i==="table",children:e.jsx(A,{title:"Table View",children:e.jsx(uo,{style:{color:i==="table"?"var(--main-icon-color)":"var(--primary-color)"}})})}),e.jsx(Q,{onClick:()=>p("icon"),"aria-label":"Icon View",disabled:i==="icon",children:e.jsx(A,{title:"Icon View (beta)",children:e.jsx(go,{style:{color:i==="icon"?"var(--main-icon-color)":"var(--primary-color)"}})})})]})]}),i==="table"&&e.jsx(ei,{filter:d}),i==="icon"&&e.jsx(Gn,{filter:d})]}):e.jsx(De,{})}const ri=r.memo(ti);function oi(){const[n,d]=r.useState(localStorage.getItem("logFilterLevel")??"info"),[l,i]=r.useState(localStorage.getItem("logFilterSearch")??"*"),[a,m]=r.useState(localStorage.getItem("logAutoScroll")!=="false"),{setMessages:p,setLogFilterLevel:v,setLogFilterSearch:t,online:M,setLogAutoScroll:w}=r.useContext(he),I=V=>{d(V.target.value),v(V.target.value),localStorage.setItem("logFilterLevel",V.target.value),o&&console.log("handleChangeLevel called with value:",V.target.value)},D=V=>{i(V.target.value),t(V.target.value),localStorage.setItem("logFilterSearch",V.target.value),o&&console.log("handleChangeSearch called with value:",V.target.value)},E=V=>{m(V.target.checked),w(V.target.checked),localStorage.setItem("logAutoScroll",V.target.checked?"true":"false"),o&&console.log("handleAutoScrollChange called with value:",V.target.checked)},_=()=>{o&&console.log("handleClearLogsClick called"),p([])};return o&&console.log("Logs rendering..."),M?e.jsxs(Mt,{name:"Logs",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",margin:"0px",padding:"0px",gap:"10px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(qt,{id:"select-level",style:{color:"var(--div-text-color)"},children:"Filter log by level:"}),e.jsxs(Xe,{style:{height:"30px",backgroundColor:"var(--main-bg-color)"},labelId:"select-level",id:"debug-level",value:n,onChange:I,children:[e.jsx(L,{value:"debug",children:"Debug"}),e.jsx(L,{value:"info",children:"Info"}),e.jsx(L,{value:"notice",children:"Notice"}),e.jsx(L,{value:"warn",children:"Warn"}),e.jsx(L,{value:"error",children:"Error"}),e.jsx(L,{value:"fatal",children:"Fatal"})]}),e.jsx(qt,{id:"search",style:{color:"var(--div-text-color)"},children:"Filter log by text:"}),e.jsx(me,{style:{width:"300px"},size:"small",id:"logsearch",variant:"outlined",value:l,onChange:D,InputProps:{style:{height:"30px",padding:"0 0px",backgroundColor:"var(--main-bg-color)"}}}),e.jsx(Ee,{control:e.jsx(Ae,{checked:a,onChange:E}),label:"Auto scroll",style:{color:"var(--div-text-color)"}})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:e.jsx(A,{title:"Clear the logs",children:e.jsx(ie,{onClick:_,endIcon:e.jsx(Wt,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Clear"})})})]}),e.jsx("div",{style:{flex:"1",overflow:"auto",margin:"0px",padding:"0px"},children:e.jsx(dr,{})})]}):e.jsx(De,{})}const ni=r.memo(oi),ii=({open:n,ip:d,onClose:l,onSave:i})=>{const a=d?d.split(".").slice(0,3).join(".")+".1":"",[m,p]=r.useState("dhcp"),[v,t]=r.useState({ip:d??"",subnet:"255.255.255.0",gateway:a,dns:a}),M=D=>E=>{t({...v,[D]:E.target.value})},w=()=>{l()},I=()=>{i({type:m,...v}),l()};return e.jsxs($e,{open:n,onClose:(D,E)=>{E==="backdropClick"||E==="escapeKeyDown"||l()},maxWidth:"sm",style:{maxWidth:"550px",margin:"auto"},children:[e.jsx(Ne,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:"Network Configuration"})]})}),e.jsxs(We,{dividers:!0,children:[e.jsxs(ir,{component:"fieldset",fullWidth:!0,children:[e.jsx(we,{component:"legend",children:"Select IP Configuration"}),e.jsxs(sr,{row:!0,value:m,onChange:D=>p(D.target.value),children:[e.jsx(Ee,{value:"dhcp",control:e.jsx(Ct,{}),label:"DHCP"}),e.jsx(Ee,{value:"static",control:e.jsx(Ct,{}),label:"Static"})]})]}),m==="static"&&e.jsxs(He,{container:!0,spacing:2,sx:{mt:2},children:[e.jsx(He,{size:6,children:e.jsx(me,{label:"IP Address",fullWidth:!0,value:v.ip,onChange:M("ip")})}),e.jsx(He,{size:6,children:e.jsx(me,{label:"Subnet Mask",fullWidth:!0,value:v.subnet,onChange:M("subnet")})}),e.jsx(He,{size:6,children:e.jsx(me,{label:"Gateway",fullWidth:!0,value:v.gateway,onChange:M("gateway")})}),e.jsx(He,{size:6,children:e.jsx(me,{label:"DNS Server",fullWidth:!0,value:v.dns,onChange:M("dns")})})]})]}),e.jsxs(Oe,{children:[e.jsx(ie,{onClick:w,children:"Cancel"}),e.jsx(ie,{variant:"contained",onClick:I,children:"Save"})]})]})},si=({open:n,onClose:d,onSave:l})=>{const[i,a]=r.useState(""),[m,p]=r.useState(""),v=E=>{a(E.target.value)},t=E=>{p(E.target.value)},M=i.length>0&&i===m,w=()=>{d()},I=()=>{M&&(l(i),d())},D=()=>{l(""),d()};return e.jsxs($e,{open:n,onClose:(E,_)=>{_==="backdropClick"||_==="escapeKeyDown"||d()},maxWidth:"sm",style:{maxWidth:"500px",margin:"auto"},disableEscapeKeyDown:!0,children:[e.jsx(Ne,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:"Change Password"})]})}),e.jsx(We,{dividers:!0,children:e.jsx(ir,{component:"fieldset",fullWidth:!0,sx:{margin:0,padding:0,gap:"20px"},children:e.jsxs(He,{container:!0,spacing:2,sx:{mt:2},children:[e.jsx(He,{size:12,children:e.jsx(me,{type:"password",autoComplete:"new-password",label:"New Password",size:"small",variant:"outlined",fullWidth:!0,value:i,onChange:v})}),e.jsx(He,{size:12,children:e.jsx(me,{type:"password",autoComplete:"new-password",label:"Confirm Password",size:"small",variant:"outlined",fullWidth:!0,value:m,onChange:t,error:m!==""&&i!==m,helperText:m!==""&&i!==m?"Passwords do not match":""})})]})})}),e.jsxs(Oe,{children:[e.jsx(ie,{onClick:w,children:"Cancel"}),e.jsx(ie,{variant:"contained",onClick:I,disabled:!M,children:"Change"}),e.jsx(ie,{variant:"contained",onClick:D,children:"Reset"})]})]})};function Ze(n=1e3){let d=null;const l=(i=>{d!==null&&window.clearTimeout(d),d=window.setTimeout(()=>{i(),d=null},n)});return l.cancel=()=>{d!==null&&(window.clearTimeout(d),d=null)},l}const pe=500;function ai(){const{online:n,addListener:d,removeListener:l,sendMessage:i,getUniqueId:a}=r.useContext(he),[m,p]=r.useState(null),[v,t]=r.useState(null),M=r.useRef(a());return r.useEffect(()=>{const w=I=>{o&&console.log("Settings received WebSocket Message:",I),I.method==="refresh_required"&&I.response.changed==="settings"?(o&&console.log(`Settings received refresh_required: changed=${I.response.changed} and sending /api/settings request`),i({id:M.current,sender:"Settings",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})):I.method==="/api/settings"&&(o&&console.log("Settings received /api/settings:",I.response),p(I.response.matterbridgeInformation),t(I.response.systemInformation))};return d(w,M.current),o&&console.log("Settings added WebSocket listener"),()=>{l(w),o&&console.log("Settings removed WebSocket listener")}},[d,l,i]),r.useEffect(()=>{n&&(o&&console.log("Settings received online"),i({id:M.current,sender:"Settings",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}))},[n,i]),o&&console.log("Settings rendering..."),!n||!m||!v?e.jsx(De,{}):e.jsx(Mt,{name:"Settings",children:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"20px",width:"100%"},children:[e.jsx(li,{matterbridgeInfo:m,systemInfo:v}),e.jsx(di,{matterbridgeInfo:m}),e.jsx(ci,{matterbridgeInfo:m}),e.jsx(pi,{systemInfo:v})]})})}function li({matterbridgeInfo:n,systemInfo:d}){const{sendMessage:l,getUniqueId:i}=r.useContext(he),[a,m]=r.useState("bridge"),[p,v]=r.useState("Info"),[t,M]=r.useState(!1),[w,I]=r.useState("dark"),[D,E]=r.useState(localStorage.getItem("homePagePlugins")!=="false"),[_,V]=r.useState(localStorage.getItem("homePageMode")??"devices"),[$,c]=r.useState(localStorage.getItem("virtualMode")??"outlet"),f=r.useRef(i()),[h,O]=r.useState(!1),P=()=>O(!1),C=R=>{o&&console.log("handleSaveNetConfig called with config:",R),l({id:f.current,sender:"Settings",method:"/api/shellynetconfig",src:"Frontend",dst:"Matterbridge",params:R})},[q,N]=r.useState(!1),g=()=>N(!1),s=R=>{o&&console.log("handleSaveChangePassword called with password:",R),l({id:f.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setpassword",value:R}}),Ci(R)};r.useEffect(()=>{n&&(m(n.bridgeMode==="bridge"?"bridge":"childbridge"),v(n.loggerLevel.charAt(0).toUpperCase()+n.loggerLevel.slice(1)),M(n.fileLogger),c(n.virtualMode))},[n]),r.useEffect(()=>{const R=localStorage.getItem("frontendTheme");R&&I(R)},[]);const u=R=>{o&&console.log("handleChangeBridgeMode called with value:",R.target.value),m(R.target.value),l({id:f.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setbridgemode",value:R.target.value}})},b=R=>{o&&console.log("handleChangeMbLoggerLevel called with value:",R.target.value),v(R.target.value),l({id:f.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmbloglevel",value:R.target.value}})},H=R=>{o&&console.log("handleLogOnFileMbChange called with value:",R.target.checked),M(R.target.checked),l({id:f.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmblogfile",value:R.target.checked}})},le=R=>{const U=R.target.value;o&&console.log("handleChangeTheme called with value:",U),I(U),localStorage.setItem("frontendTheme",U),document.body.setAttribute("frontend-theme",U)},fe=R=>{const U=R.target.checked;o&&console.log("handleChangeHomePagePlugins called with value:",U),E(U),localStorage.setItem("homePagePlugins",U?"true":"false")},ne=R=>{const U=R.target.value;o&&console.log("handleChangeHomePageMode called with value:",U),V(U),localStorage.setItem("homePageMode",U)},be=R=>{const U=R.target.value;o&&console.log("handleChangeVirtualMode called with value:",U),c(U),localStorage.setItem("virtualMode",U),l({id:f.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setvirtualmode",value:U}})};return!n||!d?null:e.jsxs(je,{style:{width:`${pe}px`,maxWidth:`${pe}px`},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge settings"})}),e.jsx(ii,{open:h,ip:d.ipv4Address,onClose:P,onSave:C}),e.jsx(si,{open:q,onClose:g,onSave:s}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(X,{sx:{gap:"10px",margin:"0px",padding:"10px",width:`${pe-20}px`,backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(we,{style:{padding:"0px",margin:"0px"},id:"matterbridgeInfo-mode",children:"Matterbridge mode:"}),e.jsxs(sr,{row:!0,name:"mode-buttons-group",value:a,onChange:u,children:[e.jsx(Ee,{value:"bridge",control:e.jsx(Ct,{}),label:"Bridge",disabled:n.readOnly===!0}),e.jsx(Ee,{value:"childbridge",control:e.jsx(Ct,{}),label:"Childbridge",disabled:n.readOnly===!0})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(we,{style:{padding:"0px",margin:"0px"},id:"mblogger-level-label",children:"Logger level:"}),e.jsxs(Xe,{style:{height:"30px"},labelId:"mblogger-level-label",id:"mblogger-level",value:p,onChange:b,children:[e.jsx(L,{value:"Debug",children:"Debug"}),e.jsx(L,{value:"Info",children:"Info"}),e.jsx(L,{value:"Notice",children:"Notice"}),e.jsx(L,{value:"Warn",children:"Warn"}),e.jsx(L,{value:"Error",children:"Error"}),e.jsx(L,{value:"Fatal",children:"Fatal"})]}),e.jsx(Ee,{style:{padding:"0px",margin:"0px"},control:e.jsx(Ae,{checked:t,onChange:H,name:"logOnFileMb"}),label:"Log on file:",labelPlacement:"start"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(we,{style:{padding:"0px",margin:"0px"},id:"frontend-theme-label",children:"Frontend theme:"}),e.jsxs(Xe,{style:{height:"30px"},labelId:"frontend-theme-label",id:"frontend-theme",value:w,onChange:le,children:[e.jsx(L,{value:"classic",children:"Classic"}),e.jsx(L,{value:"light",children:"Light"}),e.jsx(L,{value:"dark",children:"Dark"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(we,{style:{padding:"0px",margin:"0px"},id:"frontend-home-plugin-label",children:"Home page plugins:"}),e.jsx(Ae,{checked:D,onChange:fe,name:"showPlugins"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(we,{style:{padding:"0px",margin:"0px"},id:"frontend-home-label",children:"Home page bottom panel:"}),e.jsxs(Xe,{style:{height:"30px"},labelId:"frontend-home-label",id:"frontend-home",value:_,onChange:ne,children:[e.jsx(L,{value:"logs",children:"Logs"}),e.jsx(L,{value:"devices",children:"Devices"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"10px"},children:[e.jsx(we,{style:{padding:"0px",margin:"0px"},id:"frontend-virtual-label",children:"Virtual devices:"}),e.jsxs(Xe,{style:{height:"30px"},labelId:"frontend-virtual-label",id:"frontend-virtual",value:$,onChange:be,children:[e.jsx(L,{value:"disabled",children:"Disabled"}),e.jsx(L,{value:"outlet",children:"Outlet"}),e.jsx(L,{value:"light",children:"Light"}),e.jsx(L,{value:"switch",children:"Switch"}),e.jsx(L,{value:"mounted_switch",children:"Mounted Switch"})]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"20px"},children:e.jsx(ie,{variant:"contained",color:"primary",onClick:()=>N(!0),children:"Change password"})}),n.shellyBoard&&e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"20px"},children:e.jsx(ie,{variant:"contained",color:"primary",onClick:()=>O(!0),children:"Configure IP"})})]})})]})}function di({matterbridgeInfo:n}){const{sendMessage:d,getUniqueId:l}=r.useContext(he),[i,a]=r.useState("Info"),[m,p]=r.useState(!1),[v,t]=r.useState(""),[M,w]=r.useState(""),[I,D]=r.useState(""),[E,_]=r.useState(""),[V,$]=r.useState(""),[c,f]=r.useState(""),h=r.useRef(l()),O=r.useMemo(()=>Ze(1e3),[]),P=r.useMemo(()=>Ze(1e3),[]),C=r.useMemo(()=>Ze(1e3),[]),q=r.useMemo(()=>Ze(1e3),[]),N=r.useMemo(()=>Ze(1e3),[]),g=r.useMemo(()=>Ze(1e3),[]);r.useEffect(()=>{n&&(a(["Debug","Info","Notice","Warn","Error","Fatal"][n.matterLoggerLevel]),p(n.matterFileLogger),t(n.matterMdnsInterface||""),w(n.matterIpv4Address||""),D(n.matterIpv6Address||""),_(n.matterPort?n.matterPort.toString():""),$(n.matterDiscriminator?n.matterDiscriminator.toString():""),f(n.matterPasscode?n.matterPasscode.toString():""))},[n]),r.useEffect(()=>()=>O.cancel(),[O]),r.useEffect(()=>()=>P.cancel(),[P]),r.useEffect(()=>()=>C.cancel(),[C]),r.useEffect(()=>()=>q.cancel(),[q]),r.useEffect(()=>()=>N.cancel(),[N]),r.useEffect(()=>()=>g.cancel(),[g]);const s=R=>{o&&console.log("handleChangeMjLoggerLevel called with value:",R.target.value),a(R.target.value),d({id:h.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmjloglevel",value:R.target.value}})},u=R=>{o&&console.log("handleLogOnFileMjChange called with value:",R.target.checked),p(R.target.checked),d({id:h.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmjlogfile",value:R.target.checked}})},b=R=>{o&&console.log("handleChangeMdnsInterface called with value:",R.target.value);const U=R.target.value;t(U),O(()=>{o&&console.log("debounced sendMessage setmdnsinterface with value:",U),d({id:h.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmdnsinterface",value:U}})})},H=R=>{o&&console.log("handleChangeIpv4Address called with value:",R.target.value);const U=R.target.value;w(U),P(()=>{o&&console.log("debounced sendMessage setipv4address with value:",U),d({id:h.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setipv4address",value:U}})})},le=R=>{o&&console.log("handleChangeIpv6Address called with value:",R.target.value);const U=R.target.value;D(U),C(()=>{o&&console.log("debounced sendMessage setipv6address with value:",U),d({id:h.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setipv6address",value:U}})})},fe=R=>{o&&console.log("handleChangeMatterPort called with value:",R.target.value);const U=R.target.value;_(U),q(()=>{o&&console.log("debounced sendMessage setmatterport with value:",U),d({id:h.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterport",value:U}})})},ne=R=>{o&&console.log("handleChangeMatterDiscriminator called with value:",R.target.value);const U=R.target.value;$(U),N(()=>{o&&console.log("debounced sendMessage setmatterdiscriminator with value:",U),d({id:h.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterdiscriminator",value:U}})})},be=R=>{o&&console.log("handleChangemMatterPasscode called with value:",R.target.value);const U=R.target.value;f(U),g(()=>{o&&console.log("debounced sendMessage setmatterpasscode with value:",U),d({id:h.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterpasscode",value:U}})})};return n?e.jsxs(je,{style:{width:`${pe}px`,maxWidth:`${pe}px`},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matter settings"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(X,{sx:{gap:"20px",margin:"0px",padding:"10px",width:`${pe-20}px`,backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"5px",gap:"15px"},children:[e.jsx(we,{style:{padding:"0px",margin:"0px"},id:"mjdebug-info",children:"Logger level:"}),e.jsxs(Xe,{style:{height:"30px"},labelId:"select-mjlevel",id:"mjdebug-level",value:i,onChange:s,children:[e.jsx(L,{value:"Debug",children:"Debug"}),e.jsx(L,{value:"Info",children:"Info"}),e.jsx(L,{value:"Notice",children:"Notice"}),e.jsx(L,{value:"Warn",children:"Warn"}),e.jsx(L,{value:"Error",children:"Error"}),e.jsx(L,{value:"Fatal",children:"Fatal"})]}),e.jsx(Ee,{style:{padding:"0px",margin:"0px"},control:e.jsx(Ae,{checked:m,onChange:u,name:"logOnFileMj"}),label:"Log on file:",labelPlacement:"start"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px",gap:"15px"},children:[e.jsx(we,{style:{padding:"0px",margin:"0px",textWrap:"nowrap"},children:"Mdns interface:"}),e.jsx(me,{value:v,onChange:b,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px",gap:"15px"},children:[e.jsx(we,{style:{padding:"0px",margin:"0px",textWrap:"nowrap"},children:"Ipv4 address:"}),e.jsx(me,{value:M,onChange:H,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px",gap:"15px"},children:[e.jsx(we,{style:{padding:"0px",margin:"0px",textWrap:"nowrap"},children:"Ipv6 address:"}),e.jsx(me,{value:I,onChange:le,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px",gap:"15px"},children:[e.jsx(we,{style:{padding:"0px",margin:"0px",textWrap:"nowrap"},children:"Commissioning port:"}),e.jsx(me,{value:E,onChange:fe,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px",gap:"15px"},children:[e.jsx(we,{style:{padding:"0px",margin:"0px",textWrap:"nowrap"},children:"Commissioning discriminator:"}),e.jsx(me,{value:V,onChange:ne,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px",gap:"15px"},children:[e.jsx(we,{style:{padding:"0px",margin:"0px",textWrap:"nowrap"},children:"Commissioning passcode:"}),e.jsx(me,{value:c,onChange:be,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:n.readOnly===!0,style:{height:"30px",padding:"0"}}})]})]})})]}):null}function ci({matterbridgeInfo:n}){return n?e.jsxs(je,{style:{width:`${pe}px`,maxWidth:`${pe}px`},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge info"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(X,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsx(Ce,{value:n.matterbridgeVersion,label:"Current Version",width:pe}),e.jsx(Ce,{value:n.matterbridgeLatestVersion,label:"Latest Version",width:pe}),e.jsx(Ce,{value:n.rootDirectory,label:"Root Directory",width:pe}),e.jsx(Ce,{value:n.homeDirectory,label:"Home Directory",width:pe}),e.jsx(Ce,{value:n.matterbridgeDirectory,label:"Matterbridge Storage Directory",width:pe}),e.jsx(Ce,{value:n.matterbridgePluginDirectory,label:"Matterbridge Plugin Directory",width:pe}),e.jsx(Ce,{value:n.globalModulesDirectory,label:"Global Module Directory",width:pe})]})})]}):null}function pi({systemInfo:n}){return n?e.jsxs(je,{style:{width:`${pe}px`,maxWidth:`${pe}px`},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"System info"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(X,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsx(Ce,{value:n.interfaceName,label:"Interface name",width:pe}),e.jsx(Ce,{value:n.macAddress,label:"MAC Address",width:pe}),e.jsx(Ce,{value:n.ipv4Address,label:"IPv4 Address",width:pe}),e.jsx(Ce,{value:n.ipv6Address,label:"IPv6 Address",width:pe}),e.jsx(Ce,{value:n.nodeVersion,label:"Node Version",width:pe}),e.jsx(Ce,{value:n.hostname,label:"Hostname",width:pe}),e.jsx(Ce,{value:n.user,label:"User",width:pe})]})})]}):null}function Ce({value:n,label:d,width:l}){return e.jsx(me,{focused:!0,value:n,size:"small",label:d,variant:"standard",sx:{width:l?`${l-20}px`:"400px","& .MuiInput-underline:before":{borderBottomColor:"var(--main-label-color)",borderBottomWidth:"1px",opacity:.5},"& .MuiInput-underline:hover:not(.Mui-disabled):before":{borderBottomColor:"var(--main-label-color)",borderBottomWidth:"1px",opacity:.5},"& .MuiInput-underline.Mui-focused:after":{borderBottomColor:"var(--main-label-color)",borderBottomWidth:"1px",opacity:.5}},slotProps:{input:{readOnly:!0,sx:{color:"var(--div-text-color)","&:before":{borderBottomColor:"var(--main-label-color)"},"&:after":{borderBottomColor:"var(--main-label-color)"}}},inputLabel:{sx:{marginTop:"3px",color:"var(--main-label-color)","&.Mui-focused":{color:"var(--main-label-color)"}}}}})}const ui=r.memo(ai);function gi(){const{online:n,sendMessage:d,addListener:l,removeListener:i,getUniqueId:a}=r.useContext(he),{showSnackbarMessage:m}=r.useContext(_e),[p,v]=r.useState(null),[t,M]=r.useState([]),[w,I]=r.useState([]),[D,E]=r.useState(null),[_,V]=r.useState({cpuUsage:0}),[$,c]=r.useState({totalMemory:"",freeMemory:"",heapTotal:"",heapUsed:"",external:"",arrayBuffers:"",rss:""}),[f,h]=r.useState({systemUptime:"",processUptime:""}),O=r.useRef(a());return o&&console.log("Test uniqueId:",O),r.useEffect(()=>{o&&console.log("Test useEffect WebSocketMessage mounting");const P=C=>{if(C.method==="restart_required")o&&console.log("Test received restart_required"),m("Restart required",0);else if(C.method==="refresh_required")o&&console.log(`Test received refresh_required: changed=${C.response.changed} and sending api requests`),m("Refresh required",0),d({id:O.current,method:"/api/settings",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),d({id:O.current,method:"/api/plugins",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),d({id:O.current,method:"/api/devices",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}});else if(C.method==="memory_update")o&&console.log("Test received memory_update",C),c(C.response);else if(C.method==="cpu_update")o&&console.log("Test received cpu_update",C),V(C.response);else if(C.method==="uptime_update")o&&console.log("Test received uptime_update",C),h(C.response);else if(C.method==="/api/settings"&&C.response)o&&console.log("Test received /api/settings:",C.response),m("Test received /api/settings",0),v(C.response);else if(C.method==="/api/plugins"&&C.response)o&&console.log(`Test received ${C.response.length} plugins:`,C.response),m("Test received /api/plugins",0),M(C.response);else if(C.method==="/api/devices"&&C.response){o&&console.log(`Test received ${C.response.length} devices:`,C.response),m("Test received /api/devices",0),I(C.response);for(const q of C.response)o&&console.log("Test sending /api/clusters for device:",q.pluginName,q.name,q.endpoint),d({id:O.current,method:"/api/clusters",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{plugin:q.pluginName,endpoint:q.endpoint||0}})}else C.method==="/api/clusters"&&C.response&&(o&&console.log(`Test received ${C.response.clusters.length} clusters for device ${C.response.deviceName} endpoint ${C.response.id}:${C.response.number}:`,C),m(`Test received /api/clusters for ${C.response.plugin}::${C.response.deviceName}`,0),E(C.response))};return l(P,O.current),o&&console.log("Test useEffect WebSocketMessage mounted"),()=>{o&&console.log("Test useEffect WebSocketMessage unmounting"),i(P),o&&console.log("Test useEffect WebSocketMessage unmounted")}},[l,i,d,m]),r.useEffect(()=>(o&&console.log("Test useEffect online mounting"),n&&o&&console.log("Test useEffect online received online"),o&&console.log("Test useEffect online mounted"),()=>{o&&console.log("Test useEffect online unmounted")}),[n,d,m]),o&&console.log("Test rendering..."),n?e.jsx("div",{className:"MbfPageDiv",style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"20px",width:"100%"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"256px",width:"256px",margin:"10px"}}),e.jsx("p",{children:"Welcome to the Test page of the Matterbridge frontend"})]})}):e.jsx(De,{})}const mi=r.memo(gi);function hi(n,d){o&&console.log("getCssVariable:",n,"defaultValue",d);const l=getComputedStyle(document.body).getPropertyValue(n).trim();return l||console.error("getCssVariable: undefined",l),l||d}function fi(n){return mo({palette:{primary:{main:n},action:{disabled:"var(--main-label-color)"},text:{disabled:"var(--main-label-color)"}},typography:{fontFamily:"Roboto, Helvetica, Arial, sans-serif"},components:{MuiDialog:{styleOverrides:{paper:{color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",border:"2px solid var(--div-border-color)",borderRadius:"var(--div-border-radius)",boxShadow:"2px 2px 5px var(--div-shadow-color)"}}},MuiTooltip:{defaultProps:{placement:"top-start",arrow:!0}},MuiButton:{styleOverrides:{root:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)","&:hover":{backgroundColor:"var(--main-button-bg-color)"},"&.Mui-disabled":{color:"var(--main-button-color)",backgroundColor:"var(--main-grey-color)"}},contained:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},outlined:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},text:{color:"var(--main-button-color)"}},defaultProps:{variant:"contained",size:"small"}},MuiIconButton:{styleOverrides:{root:{color:"var(--main-icon-color)","&:hover .MuiSvgIcon-root":{color:"var(--primary-color)"}}}},MuiCheckbox:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-checked":{color:"var(--primary-color)"}}}},MuiTextField:{defaultProps:{size:"small",variant:"outlined",fullWidth:!0}},MuiOutlinedInput:{styleOverrides:{root:{backgroundColor:"var(--div-bg-color)","& .MuiOutlinedInput-notchedOutline":{borderColor:"var(--main-label-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--main-text-color)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"var(--primary-color)"},padding:"0px"},input:{color:"var(--div-text-color)",padding:"4px 8px"}}},MuiInputLabel:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-focused":{color:"var(--primary-color)"}}}},MuiFormLabel:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-focused":{color:"var(--main-label-color)"}}}},MuiFormControl:{styleOverrides:{root:{color:"var(--main-grey-color)"}}},MuiRadio:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-checked":{color:"var(--primary-color)"}}}},MuiSelect:{styleOverrides:{root:{backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)",height:"30px","&:hover":{borderColor:"var(--main-text-color)"},"&.Mui-focused":{borderColor:"var(--primary-color)"}}}},MuiMenu:{styleOverrides:{paper:{backgroundColor:"var(--main-menu-bg-color)",padding:"0px",margin:"0px"},list:{padding:"0px"}}},MuiMenuItem:{styleOverrides:{root:{color:"var(--main-menu-color)",backgroundColor:"var(--main-menu-bg-color)","&:hover":{backgroundColor:"var(--main-menu-hover-color)"},"&.Mui-selected":{color:"var(--main-menu-color)",backgroundColor:"var(--main-menu-bg-color)"},"&.Mui-selected:hover":{backgroundColor:"var(--main-menu-hover-color)"}}}},MuiListItemButton:{styleOverrides:{root:{cursor:"pointer","&:hover":{backgroundColor:"var(--main-bg-color)"}}}},MuiListItemIcon:{styleOverrides:{root:{color:"var(--div-text-color)"}}},MuiListItemText:{styleOverrides:{primary:{fontSize:"16px",fontWeight:"bold",color:"var(--div-text-color)"},secondary:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"}}}}})}function xi(){const{mobile:n,showSnackbarMessage:d,showConfirmCancelDialog:l}=r.useContext(_e),{online:i,sendMessage:a,logMessage:m,addListener:p,removeListener:v,getUniqueId:t}=r.useContext(he),[M,w]=r.useState(!1),[I,D]=r.useState(!1),[E,_]=r.useState(!1),[V,$]=r.useState(!1),[c,f]=r.useState(null),h=r.useRef(t()),[O,P]=r.useState(null),[C,q]=r.useState(null),[N,g]=r.useState(null),[s,u]=r.useState(null),[b,H]=r.useState(null),le=()=>{window.open("https://www.buymeacoffee.com/luligugithub","_blank")},fe=()=>{window.open("https://github.com/Luligu/matterbridge/blob/main/README.md","_blank")},ne=()=>{c?.matterbridgeInformation.matterbridgeVersion.includes("-dev-")?window.open("https://github.com/Luligu/matterbridge/blob/dev/CHANGELOG.md","_blank"):window.open("https://github.com/Luligu/matterbridge/blob/main/CHANGELOG.md","_blank")},be=()=>{window.open("https://discord.gg/QX58CDe6hd","_blank")},R=()=>{window.open("https://github.com/Luligu/matterbridge","_blank")},U=()=>{a({id:h.current,sender:"Header",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:"matterbridge",restart:!0}})},F=()=>{a({id:h.current,sender:"Header",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:"matterbridge@dev",restart:!0}})},J=()=>{a({id:h.current,sender:"Header",method:"/api/checkupdates",src:"Frontend",dst:"Matterbridge",params:{}})},W=()=>{o&&console.log("Header: handleShellySystemUpdateClick"),m("Matterbridge","Installing system updates..."),a({id:h.current,sender:"Header",method:"/api/shellysysupdate",src:"Frontend",dst:"Matterbridge",params:{}})},S=()=>{o&&console.log("Header: handleShellyMainUpdateClick"),m("Matterbridge","Installing software updates..."),a({id:h.current,sender:"Header",method:"/api/shellymainupdate",src:"Frontend",dst:"Matterbridge",params:{}})},j=()=>{o&&console.log("Header: handleShellyCreateSystemLog"),a({id:h.current,sender:"Header",method:"/api/shellycreatesystemlog",src:"Frontend",dst:"Matterbridge",params:{}})},k=()=>{o&&console.log("Header: handleShellyDownloadSystemLog"),m("Matterbridge","Downloading Shelly system log..."),d("Downloading Shelly system log...",5),window.location.href="./api/shellydownloadsystemlog"},z=()=>{c?.matterbridgeInformation.restartMode===""?a({id:h.current,sender:"Header",method:"/api/restart",src:"Frontend",dst:"Matterbridge",params:{}}):a({id:h.current,sender:"Header",method:"/api/shutdown",src:"Frontend",dst:"Matterbridge",params:{}})},G=()=>{a({id:h.current,sender:"Header",method:"/api/shutdown",src:"Frontend",dst:"Matterbridge",params:{}})},ae=()=>{a({id:h.current,sender:"Header",method:"/api/reboot",src:"Frontend",dst:"Matterbridge",params:{}})},de=()=>{a({id:h.current,sender:"Header",method:"/api/softreset",src:"Frontend",dst:"Matterbridge",params:{}})},ce=()=>{a({id:h.current,sender:"Header",method:"/api/hardreset",src:"Frontend",dst:"Matterbridge",params:{}})},ue=y=>{P(y.currentTarget)},T=y=>{o&&console.log("Header: handleMenuClose",y),P(null),y==="download-mblog"?(m("Matterbridge","Downloading matterbridge log..."),d("Downloading matterbridge log...",5),window.location.href="./api/download-mblog"):y==="download-mjlog"?(m("Matterbridge","Downloading matter log..."),d("Downloading matter log...",5),window.location.href="./api/download-mjlog"):y==="view-mblog"?(m("Matterbridge","Loading matterbridge log..."),d("Loading matterbridge log...",5),window.open("./api/view-mblog","_blank","noopener,noreferrer")):y==="view-mjlog"?(m("Matterbridge","Loading matter log..."),d("Loading matter log...",5),window.open("./api/view-mjlog","_blank","noopener,noreferrer")):y==="view-diagnostic"?(m("Matterbridge","Loading diagnostic log..."),d("Loading diagnostic log...",5),window.open("./api/view-diagnostic","_blank","noopener,noreferrer")):y==="download-diagnostic"?(m("Matterbridge","Downloading diagnostic log..."),d("Downloading diagnostic log...",5),window.location.href="./api/download-diagnostic"):y==="view-history"?a({id:h.current,sender:"Header",method:"/api/viewhistorypage",src:"Frontend",dst:"Matterbridge",params:{}}):y==="download-history"?a({id:h.current,sender:"Header",method:"/api/downloadhistorypage",src:"Frontend",dst:"Matterbridge",params:{}}):y==="view-shellylog"?(m("Matterbridge","Loading shelly system log..."),d("Loading shelly system log...",5),window.location.href="./api/shellyviewsystemlog"):y==="download-mbstorage"?(m("Matterbridge","Downloading matterbridge storage..."),d("Downloading matterbridge storage...",5),window.location.href="./api/download-mbstorage"):y==="download-pluginstorage"?(m("Matterbridge","Downloading matterbridge plugins storage..."),d("Downloading matterbridge plugins storage...",5),window.location.href="./api/download-pluginstorage"):y==="download-pluginconfig"?(m("Matterbridge","Downloading matterbridge plugins config..."),d("Downloading matterbridge plugins config...",5),window.location.href="./api/download-pluginconfig"):y==="download-mjstorage"?(m("Matterbridge","Downloading matter storage..."),d("Downloading matter storage...",5),window.location.href="./api/download-mjstorage"):y==="download-backup"?(m("Matterbridge","Downloading backup..."),d("Downloading backup...",10),window.location.href="./api/download-backup"):y==="update"?U():y==="updatedev"?F():y==="updatecheck"?J():y==="shelly-sys-update"?W():y==="shelly-main-update"?S():y==="shelly-create-system-log"?j():y==="shelly-download-system-log"?k():y==="softreset"?de():y==="hardreset"?ce():y==="restart"?z():y==="shutdown"?G():y==="reboot"?ae():y==="create-backup"?a({id:h.current,sender:"Header",method:"/api/create-backup",src:"Frontend",dst:"Matterbridge",params:{}}):y==="unregister"?a({id:h.current,sender:"Header",method:"/api/unregister",src:"Frontend",dst:"Matterbridge",params:{}}):y==="reset"?a({id:h.current,sender:"Header",method:"/api/reset",src:"Frontend",dst:"Matterbridge",params:{}}):y==="factoryreset"&&a({id:h.current,sender:"Header",method:"/api/factoryreset",src:"Frontend",dst:"Matterbridge",params:{}})},x=y=>{o&&console.log("Header: handleMenuCloseCancel:",y),P(null)},Z=y=>{q(y.currentTarget)},xe=()=>{q(null)},ye=y=>{g(y.currentTarget)},ge=()=>{g(null)},te=y=>{u(y.currentTarget)},re=()=>{u(null)},Pe=y=>{H(y.currentTarget)},Le=()=>{H(null)},tt=()=>{ji(),o&&console.log("Matterbridge logo clicked: debug is now",o)};return r.useEffect(()=>{const y=Y=>{o&&console.log("Header received WebSocket Message:",Y),Y.method==="/api/settings"&&Y.id===h.current?(o&&console.log("Header received settings:",Y.response),f(Y.response),w(Y.response.matterbridgeInformation.restartRequired||Y.response.matterbridgeInformation.fixedRestartRequired),D(Y.response.matterbridgeInformation.fixedRestartRequired),_(Y.response.matterbridgeInformation.updateRequired)):Y.method==="refresh_required"&&Y.response.changed==="settings"?(o&&console.log(`Header received refresh_required: changed=${Y.response.changed} and sending /api/settings request`),a({id:h.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})):Y.method==="restart_required"?(o&&console.log(`Header received restart_required with fixed: ${Y.response.fixed}`),w(!0),Y.response.fixed===!0&&D(!0)):Y.method==="restart_not_required"?(o&&console.log("Header received restart_not_required"),w(!1)):Y.method==="update_required"?(o&&console.log("Header received update_required"),Y.response.devVersion===!0?$(!0):_(!0),a({id:h.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})):Y.method==="shelly_sys_update"?(o&&console.log("Header received WS_ID_SHELLY_SYS_UPDATE:"),f(Se=>Se?{matterbridgeInformation:{...Se.matterbridgeInformation,shellySysUpdate:Y.response.available},systemInformation:Se.systemInformation}:null)):Y.method==="shelly_main_update"?(o&&console.log("Header received WS_ID_SHELLY_MAIN_UPDATE:"),f(Se=>Se?{matterbridgeInformation:{...Se.matterbridgeInformation,shellyMainUpdate:Y.response.available},systemInformation:Se.systemInformation}:null)):Y.method==="/api/viewhistorypage"&&Y.id===h.current&&Y.success===!0?(o&&console.log("Header received /api/viewhistorypage success"),window.open("./api/viewhistory","_blank","noopener,noreferrer")):Y.method==="/api/downloadhistorypage"&&Y.id===h.current&&Y.success===!0&&(o&&console.log("Header received /api/downloadhistorypage success"),window.location.href="./api/downloadhistory")};return p(y,h.current),o&&console.log(`Header added WebSocket listener id ${h.current}`),()=>{v(y),o&&console.log("Header removed WebSocket listener")}},[p,v,a,d]),r.useEffect(()=>{i&&(o&&console.log("Header sending /api/settings and /api/checkupdates requests"),a({id:h.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),a({id:h.current,sender:"Header",method:"/api/checkupdates",src:"Frontend",dst:"Matterbridge",params:{}}))},[i,a]),o&&console.log("Header rendering... mobile %s",n),!i||!c?null:e.jsxs("div",{className:"header",style:{},children:[e.jsxs("div",{className:"sub-header",children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"30px"},onClick:tt}),e.jsx("h2",{style:{fontSize:"22px",color:"var(--main-icon-color)",margin:"0px"},children:"Matterbridge"}),e.jsxs("nav",{children:[e.jsx(at,{to:"/",className:"nav-link",children:"Home"}),e.jsx(at,{to:"/devices",className:"nav-link",children:"Devices"}),e.jsx(at,{to:"/log",className:"nav-link",children:"Logs"}),e.jsx(at,{to:"/settings",className:"nav-link",children:"Settings"})]})]}),e.jsxs("div",{className:"sub-header",children:[!c.matterbridgeInformation.readOnly&&e.jsx(A,{title:`Matterbridge v.${c.matterbridgeInformation.matterbridgeVersion}`,children:e.jsxs("span",{className:"status-information",style:{cursor:"default"},children:["v.",c.matterbridgeInformation.matterbridgeVersion.split("-dev-")[0]+(c.matterbridgeInformation.matterbridgeVersion.includes("-dev-")?"@dev":"")]})}),c.matterbridgeInformation.shellyBoard&&e.jsx("img",{src:"Shelly.svg",alt:"Shelly Icon",style:{height:"30px",padding:"0px",margin:"0px",marginRight:"30px"}}),c.matterbridgeInformation.bridgeMode!==""&&c.matterbridgeInformation.readOnly===!1?e.jsx(A,{title:"Bridge mode",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:c.matterbridgeInformation.bridgeMode})}):null,c.matterbridgeInformation.restartMode!==""&&c.matterbridgeInformation.readOnly===!1?e.jsx(A,{title:"Restart mode",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:c.matterbridgeInformation.restartMode})}):null,c.matterbridgeInformation.profile&&c.matterbridgeInformation.profile!==""&&c.matterbridgeInformation.readOnly===!1?e.jsx(A,{title:"Current profile",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:c.matterbridgeInformation.profile})}):null]}),e.jsxs("div",{className:"sub-header",style:{gap:"5px"},children:[c.matterbridgeInformation.readOnly===!1?e.jsx(A,{title:"Matterbridge discord group",children:e.jsx("img",{src:"discord.svg",alt:"Discord Logo",style:{cursor:"pointer",height:"25px"},onClick:be})}):null,c.matterbridgeInformation.readOnly===!1?e.jsx(A,{title:"Give a star to Matterbridge",children:e.jsx(Q,{style:{color:"#FFD700",margin:"0",padding:"0"},onClick:R,children:e.jsx(ho,{})})}):null,c.matterbridgeInformation.readOnly===!1?e.jsx(A,{title:"Sponsor Matterbridge",children:e.jsx(Q,{style:{color:"#b6409c",margin:"0",padding:"0"},onClick:le,children:e.jsx(rr,{})})}):null,e.jsx(A,{title:"Matterbridge help",children:e.jsx(Q,{style:{color:"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:fe,children:e.jsx(tr,{})})}),e.jsx(A,{title:"Matterbridge changelog",children:e.jsx(Q,{style:{color:"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:ne,children:e.jsx(Tt,{})})}),c.matterbridgeInformation&&!c.matterbridgeInformation.readOnly&&E&&e.jsx(A,{title:`Update matterbridge to latest version v.${c.matterbridgeInformation.matterbridgeLatestVersion}`,children:e.jsx(Q,{style:{color:E?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:U,children:e.jsx(Ie,{})})}),c.matterbridgeInformation&&!c.matterbridgeInformation.readOnly&&V&&e.jsx(A,{title:`Update matterbridge to latest dev version v.${c.matterbridgeInformation.matterbridgeDevVersion}`,children:e.jsx(Q,{style:{color:V?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:F,children:e.jsx(Ie,{})})}),c.matterbridgeInformation&&c.matterbridgeInformation.shellyBoard&&c.matterbridgeInformation.shellySysUpdate&&e.jsx(A,{title:"Shelly system update",children:e.jsx(Q,{style:{color:"var(--primary-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:W,children:e.jsx(Ie,{})})}),c.matterbridgeInformation&&c.matterbridgeInformation.shellyBoard&&c.matterbridgeInformation.shellyMainUpdate&&e.jsx(A,{title:"Shelly software update",children:e.jsx(Q,{style:{color:"var(--primary-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:S,children:e.jsx(Ie,{})})}),e.jsx(A,{title:"Restart matterbridge",children:e.jsx(Q,{style:{color:M||I?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:z,children:e.jsx(jt,{})})}),c.matterbridgeInformation.restartMode===""?e.jsx(A,{title:"Shut down matterbridge",children:e.jsx(Q,{style:{color:M||I?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:G,children:e.jsx(ze,{})})}):null,e.jsx(A,{title:"Download, backup and more",children:e.jsx(Q,{onClick:ue,children:e.jsx(fo,{style:{color:"var(--main-icon-color)"}})})}),e.jsxs(Ye,{id:"command-menu",anchorEl:O,keepMounted:!0,open:!!O,onClose:()=>T(""),children:[c.matterbridgeInformation&&!c.matterbridgeInformation.readOnly&&e.jsxs(L,{onClick:()=>T("update"),children:[e.jsx(B,{children:e.jsx(Ie,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Install latest stable",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),c.matterbridgeInformation&&!c.matterbridgeInformation.readOnly&&e.jsxs(L,{onClick:()=>T("updatedev"),children:[e.jsx(B,{children:e.jsx(Ie,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Install latest dev",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),c.matterbridgeInformation&&!c.matterbridgeInformation.readOnly&&e.jsxs(L,{onClick:()=>T("updatecheck"),children:[e.jsx(B,{children:e.jsx(Ie,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Check for updates",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),c.matterbridgeInformation&&c.matterbridgeInformation.shellyBoard&&c.matterbridgeInformation.shellySysUpdate&&e.jsxs(L,{onClick:()=>T("shelly-sys-update"),children:[e.jsx(B,{children:e.jsx(Ie,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Shelly system update",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),c.matterbridgeInformation&&c.matterbridgeInformation.shellyBoard&&c.matterbridgeInformation.shellyMainUpdate&&e.jsxs(L,{onClick:()=>T("shelly-main-update"),children:[e.jsx(B,{children:e.jsx(Ie,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Shelly software update",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(L,{onClick:()=>T("restart"),children:[e.jsx(B,{children:e.jsx(jt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Restart",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),c.matterbridgeInformation.restartMode===""?e.jsxs(L,{onClick:()=>T("shutdown"),children:[e.jsx(B,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Shutdown",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}):null,c.matterbridgeInformation&&c.matterbridgeInformation.shellyBoard&&e.jsxs(L,{onClick:()=>{l("Reboot","Are you sure you want to reboot the Shelly board?","reboot",T,x)},children:[e.jsx(B,{children:e.jsx(jt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Reboot...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsx(ut,{}),e.jsxs(L,{onClick:ye,children:[e.jsx(B,{children:e.jsx(Be,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"View",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(Ye,{id:"sub-menu-view",anchorEl:N,keepMounted:!0,open:!!N,onClose:ge,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(L,{onClick:()=>{T("view-mblog"),ge()},children:[e.jsx(B,{children:e.jsx(Be,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Matterbridge log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(L,{onClick:()=>{T("view-mjlog"),ge()},children:[e.jsx(B,{children:e.jsx(Be,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Matter log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(L,{onClick:()=>{T("view-diagnostic"),ge()},children:[e.jsx(B,{children:e.jsx(Be,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Matterbridge diagnostic log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(L,{onClick:()=>{T("view-history"),ge()},children:[e.jsx(B,{children:e.jsx(Be,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Matterbridge system history",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),c.matterbridgeInformation&&c.matterbridgeInformation.shellyBoard&&e.jsxs(L,{onClick:()=>{T("view-shellylog"),ge()},children:[e.jsx(B,{children:e.jsx(Be,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(ut,{}),e.jsxs(L,{onClick:te,children:[e.jsx(B,{children:e.jsx(Me,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Download",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(Ye,{id:"sub-menu-download",anchorEl:s,keepMounted:!0,open:!!s,onClose:re,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(L,{onClick:()=>{T("download-mbstorage"),re()},children:[e.jsx(B,{children:e.jsx(Me,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Matterbridge storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(L,{onClick:()=>{T("download-pluginstorage"),re()},children:[e.jsx(B,{children:e.jsx(Me,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Matterbridge plugins storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(L,{onClick:()=>{T("download-pluginconfig"),re()},children:[e.jsx(B,{children:e.jsx(Me,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Matterbridge plugins config",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(L,{onClick:()=>{T("download-mblog"),re()},children:[e.jsx(B,{children:e.jsx(Me,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Matterbridge log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(L,{onClick:()=>{T("download-mjstorage"),re()},children:[e.jsx(B,{children:e.jsx(Me,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Matter storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(L,{onClick:()=>{T("download-mjlog"),re()},children:[e.jsx(B,{children:e.jsx(Me,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Matter log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(L,{onClick:()=>{T("download-diagnostic"),re()},children:[e.jsx(B,{children:e.jsx(Me,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Matterbridge diagnostic log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(L,{onClick:()=>{T("download-history"),re()},children:[e.jsx(B,{children:e.jsx(Me,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Matterbridge system history",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),c.matterbridgeInformation&&c.matterbridgeInformation.shellyBoard&&e.jsxs(L,{onClick:()=>{T("shelly-create-system-log"),re()},children:[e.jsx(B,{children:e.jsx(Me,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Create Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),c.matterbridgeInformation&&c.matterbridgeInformation.shellyBoard&&e.jsxs(L,{onClick:()=>{T("shelly-download-system-log"),re()},children:[e.jsx(B,{children:e.jsx(Me,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Download Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(ut,{}),e.jsxs(L,{onClick:Z,children:[e.jsx(B,{children:e.jsx(It,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(Ye,{id:"sub-menu-backup",anchorEl:C,keepMounted:!0,open:!!C,onClose:xe,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(L,{onClick:()=>{T("create-backup"),xe()},children:[e.jsx(B,{children:e.jsx(It,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Create backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(L,{onClick:()=>{T("download-backup"),xe()},children:[e.jsx(B,{children:e.jsx(It,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Download backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(ut,{}),e.jsxs(L,{onClick:Pe,children:[e.jsx(B,{children:e.jsx(xo,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Reset",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(Ye,{id:"sub-menu-reset",anchorEl:b,keepMounted:!0,open:!!b,onClose:Le,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(L,{onClick:()=>{Le(),l("Reset all devices and shutdown","Are you sure you want to unregister all devices? This will temporarily remove all devices from the controller and you may loose the controller configuration.","unregister",T,x)},children:[e.jsx(B,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Reset all devices...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(L,{onClick:()=>{Le(),l("Reset commissioning and shutdown","Are you sure you want to reset the commissioning? You will have to manually remove Matterbridge from the controller.","reset",T,x)},children:[e.jsx(B,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Reset commissioning...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),!c.matterbridgeInformation.readOnly&&e.jsxs(L,{onClick:()=>{Le(),l("Factory reset and shutdown","Are you sure you want to factory reset Matterbridge? You will have to manually remove Matterbridge from the controller.","factoryreset",T,x)},children:[e.jsx(B,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Factory reset...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),c.matterbridgeInformation&&c.matterbridgeInformation.shellyBoard&&e.jsxs(L,{onClick:()=>{Le(),l("Network reset","Are you sure you want to factory reset the network parameters?","softreset",T,x)},children:[e.jsx(B,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Reset network...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),c.matterbridgeInformation&&c.matterbridgeInformation.shellyBoard&&e.jsxs(L,{onClick:()=>{Le(),l("Factory reset","Are you sure you want to factory reset Matterbridge? You will have to manually remove Matterbridge from the controller.","hardreset",T,x)},children:[e.jsx(B,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Factory reset...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]})]})]})]})}const bi=r.memo(xi),cr=1300,pr=1024;let $t,Nt;function vi(){if(typeof window<"u"){$t=Math.floor(window.visualViewport?.width??window.innerWidth),Nt=Math.floor(window.visualViewport?.height??window.innerHeight);const n=$t<cr||Nt<pr;return o&&console.log("Visual viewport width %i height %i mobile %s",$t,Nt,n),n}return!1}function yi({children:n}){const{mobile:d,setMobile:l}=r.useContext(_e);return r.useEffect(()=>{function i(){l(vi())}return window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[l]),o&&console.log("MbfScreen rendering... mobile %s",d),e.jsxs("div",{style:{display:"flex",flexDirection:"column",overflow:"hidden",width:d?`${cr}px`:"calc(100vw - 40px)",height:d?`${pr}px`:"calc(100vh - 40px)",margin:"0px",padding:"20px",gap:"20px"},children:[e.jsx(bi,{}),e.jsx("div",{style:{display:"flex",flexDirection:"row",width:"100%",height:"calc(100% - 60px)",margin:"0px",padding:"0px",gap:"20px"},children:n})]})}let o=!1;const ji=()=>{o=!o},wi=!1;let et;const Ci=n=>{et=n};function Si({setLoggedIn:n}){const[d,l]=r.useState(""),[i,a]=r.useState(""),m={display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",backgroundColor:"var(--main-bg-color)"},p={display:"flex",flexDirection:"column",maxWidth:"400px",margin:"0 auto",padding:"20px",gap:"20px",border:"1px solid var(--div-border-color)",borderRadius:"var(--div-border-radius)",boxShadow:"2px 2px 5px var(--div-shadow-color)",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},v={margin:"10px 0",padding:"3px 3px",fontSize:"14px",width:"230px",border:"1px solid var(--main-label-color)",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},t=async w=>{try{const I=await fetch("./api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:w})});if(I.ok){const{valid:D}=await I.json();D?(n(!0),w!==""&&(et=w)):w!==""&&a("Incorrect password!")}else console.error("Failed to log in:",I.statusText)}catch(I){console.error("Failed to log in:",I)}},M=w=>{w.preventDefault(),t(d)};return t(""),e.jsx("div",{style:m,children:e.jsxs("form",{onSubmit:M,style:p,children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"64px",width:"64px"}}),e.jsx("h3",{style:{color:"var(--div-text-color)"},children:"Welcome to Matterbridge"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:"20px"},children:[e.jsx("input",{type:"text",name:"username",autoComplete:"username",style:{display:"none"},tabIndex:-1}),e.jsx("input",{type:"password",value:d,onChange:w=>l(w.target.value),style:v,placeholder:"password",autoComplete:"current-password"}),e.jsx("button",{type:"submit",style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",borderColor:"var(--div-bg-color)"},children:"Log in"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",margin:0,height:"30px"},children:i&&e.jsx("p",{style:{color:"red"},children:i})})]})})}function ki(){const[n,d]=r.useState(!1),l=localStorage.getItem("frontendTheme")||"dark";o&&console.log('Setting frontend theme "%s"',l),document.body.setAttribute("frontend-theme",l);const i=hi("--primary-color","#1976d2");o&&console.log('Primary color from CSS "%s"',i);const a=fi(i);window.location.href.includes("/api/hassio_ingress/");const m=window.location.pathname.includes("/matterbridge/")?"/matterbridge":window.location.href.includes("/api/hassio_ingress/")?window.location.pathname:"/";return o&&(console.log("Loading App..."),console.log(`- with href = "${window.location.href}"`),console.log(`- pathname = "${window.location.pathname}"`),console.log(`- baseName = "${m}"`)),n?e.jsx(bo,{theme:a,children:e.jsx(Dr,{dense:!0,maxSnack:10,preventDuplicate:!0,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(tn,{children:e.jsx(rn,{children:e.jsx(wr,{basename:m,children:e.jsx(yi,{children:e.jsxs(Cr,{children:[e.jsx(qe,{path:"/",element:e.jsx(Tn,{})}),e.jsx(qe,{path:"/devices",element:e.jsx(ri,{})}),e.jsx(qe,{path:"/log",element:e.jsx(ni,{})}),e.jsx(qe,{path:"/settings",element:e.jsx(ui,{})}),e.jsx(qe,{path:"/test",element:e.jsx(mi,{})}),e.jsx(qe,{path:"*",element:e.jsx(Sr,{to:"/"})})]})})})})})})}):e.jsx(Si,{setLoggedIn:d})}kr.createRoot(document.getElementById("root")).render(e.jsx(Mr.StrictMode,{children:e.jsx(ki,{})}));
