import{B as e,y as o,S as st,U as xr,V as br,X as Ke,Y as vr,Z as yr,I as jr}from"./vendor_node_modules.js";import{u as Cr,S as Sr}from"./vendor_notistack.js";import{D as Ne,a as Pe,b as We,B as ae,c as ee,A as wr,I as J,C as Mr,T as O,S as kr,F as Xt,H as Ir,d as Zt,e as _e,R as vt,P as ze,M as Dr,f as et,g as F,L as K,h as oe,i as lt,V as dt,j as He,k as Nt,l as Nr,m as Pr,n as pe,o as Wr,p as Tr,q as yt,r as le,s as Fe,K as Rt,t as Ht,u as Ct,v as ct,w as it,x as pt,W as at,y as ut,z as mt,E as $e,G as $t,J as Ot,N as Fr,O as Lr,Q as St,U as Te,X as er,Y as rt,Z as Rr,_ as Hr,$ as $r,a0 as Or,a1 as tr,a2 as jt,a3 as Er,a4 as Vr,a5 as _r,a6 as Ar,a7 as Et,a8 as Ur,a9 as zr,aa as qr,ab as Br,ac as Jr,ad as Qr,ae as Gr,af as Vt,ag as Kr,ah as Yr,ai as Xr,aj as Zr,ak as eo,al as to,am as ro,an as oo,ao as no,ap as io,aq as ao,ar as so,as as lo,at as co,au as po,av as _t,aw as tt,ax as rr,ay as Ie,az as or,aA as wt,aB as Ae,aC as uo,aD as mo}from"./vendor_mui.js";import{Q as go}from"./vendor_qrcode.js";import{I as re,m as At,a as ho,b as fo,c as Ut,d as xo,e as bo,f as Tt,g as Ft,h as vo,i as yo,j as jo,k as Co,l as So,n as wo,o as Mo,p as ko,q as zt,r as Io,s as Do,t as No,u as Po,v as Wo,w as To,x as Fo,y as Lo,z as qt,A as Ro,B as Ho}from"./vendor_mdi.js";import{F as $o,v as Oo,e as Eo,a as Vo,g as _o,b as Ao,c as Uo,d as Pt,A as zo}from"./vendor_rjsf.js";import{r as ot}from"./vendor_react_table.js";import"./vendor_lodash.js";import"./vendor_emotion.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const g of s)if(g.type==="childList")for(const y of g.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&n(y)}).observe(document,{childList:!0,subtree:!0});function a(s){const g={};return s.integrity&&(g.integrity=s.integrity),s.referrerPolicy&&(g.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?g.credentials="include":s.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function n(s){if(s.ep)return;s.ep=!0;const g=a(s);fetch(s.href,g)}})();/**
 * This file contains the types for WebSocket messages.
 *
 * @file frontendTypes.ts
 * @author Luca Liguori
 * @created 2025-09-17
 * @version 1.0.0
 * @license Apache-2.0
 *
 * Copyright 2025, 2026, 2027 Luca Liguori.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Me=(r=>(r[r.Log=0]="Log",r[r.RefreshRequired=1]="RefreshRequired",r[r.RestartRequired=2]="RestartRequired",r[r.RestartNotRequired=3]="RestartNotRequired",r[r.CpuUpdate=4]="CpuUpdate",r[r.MemoryUpdate=5]="MemoryUpdate",r[r.UptimeUpdate=6]="UptimeUpdate",r[r.Snackbar=7]="Snackbar",r[r.UpdateRequired=8]="UpdateRequired",r[r.StateUpdate=9]="StateUpdate",r[r.CloseSnackbar=10]="CloseSnackbar",r[r.ShellySysUpdate=100]="ShellySysUpdate",r[r.ShellyMainUpdate=101]="ShellyMainUpdate",r))(Me||{});function xe(r){return r.id>=0&&r.id<=101}function Ve(r){return r.id>101&&r.src==="Matterbridge"&&r.dst==="Frontend"&&("success"in r||"error"in r)}function qo({open:r,title:d,message:a,onConfirm:n,onCancel:s}){const g=t=>{i&&console.log("Confirmed"),t.preventDefault(),n()},y=t=>{i&&console.log("Canceled"),t.preventDefault(),s()};return e.jsxs(Ne,{open:r,children:[e.jsx(Pe,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:d})]})}),e.jsxs(We,{children:[e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",margin:"0",marginBottom:"20px",maxHeight:"350px",maxWidth:"350px"},children:e.jsx("p",{style:{flex:1,margin:"0"},children:a})}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-around"},children:[e.jsx(ae,{onClick:g,variant:"contained",color:"primary",size:"small",children:"Confirm"}),e.jsx(ae,{onClick:y,variant:"contained",color:"primary",size:"small",children:"Cancel"})]})]})]})}const gt=[],nt=o.createContext(null);function Bo({children:r}){const{enqueueSnackbar:d,closeSnackbar:a}=Cr(),n=o.useCallback(x=>{i&&console.log(`UiProvider closeSnackbarMessage: message ${x}`);const N=gt.findIndex($=>$.message===x);N!==-1&&(a(gt[N].key),gt.splice(N,1),i&&console.log(`UiProvider closeSnackbarMessage: message ${x} removed from persistMessages`))},[a]),s=o.useCallback((x,N,$)=>{i&&console.log(`UiProvider showSnackbarMessage: message ${x} timeout ${N}`);const W=d(x,{variant:"default",autoHideDuration:N==null||N>0?(N??5)*1e3:null,persist:N===0,content:m=>e.jsx(ee,{sx:{margin:"0",padding:"0",width:"300px",marginRight:"30px"},children:e.jsx(wr,{severity:$??"info",variant:"filled",sx:{color:"#fff",fontWeight:"normal",width:"100%",cursor:"pointer",padding:"0px 10px"},onClick:()=>a(m),action:e.jsx(J,{size:"small",onClick:()=>a(m),sx:{color:"#fff"},children:e.jsx(Mr,{fontSize:"small"})}),children:x},m)},m)});N===0&&(i&&console.log(`UiProvider showSnackbarMessage: message ${x} timeout ${N} - persist key ${W}`),gt.push({message:x,key:W}))},[d,a]),[g,y]=o.useState(!1),[t,l]=o.useState(""),[D,R]=o.useState(""),[b,L]=o.useState(""),A=o.useRef(null),w=o.useRef(null),E=()=>{i&&console.log(`UiProvider handle confirm action ${b}`),y(!1),A.current&&A.current(b)},c=()=>{i&&console.log(`UiProvider handle cancel action ${b}`),y(!1),w.current&&w.current(b)},z=o.useCallback((x,N,$,W,m)=>{i&&console.log(`UiProvider showConfirmCancelDialog for command ${$}`),l(x),R(N),L($),A.current=W,w.current=m,y(!0)},[]),v=o.useMemo(()=>({showSnackbarMessage:s,closeSnackbarMessage:n,closeSnackbar:a,showConfirmCancelDialog:z}),[s,n,a,z]);return e.jsxs(nt.Provider,{value:v,children:[e.jsx(qo,{open:g,title:t,message:D,onConfirm:E,onCancel:c}),r]})}const nr=o.createContext(null),be=o.createContext(null);function Jo({children:r}){const[d,a]=o.useState(localStorage.getItem("logFilterLevel")??"info"),[n,s]=o.useState(localStorage.getItem("logFilterSearch")??"*"),[g,y]=o.useState([]),[t,l]=o.useState(1e3),[D,R]=o.useState(!0),[b,L]=o.useState(!1),{showSnackbarMessage:A,closeSnackbarMessage:w,closeSnackbar:E}=o.useContext(nt),c=o.useRef([]),z=o.useRef(null),v=o.useRef(1),x=o.useRef(Math.floor(Math.random()*999e3)+1e3),N=o.useRef(null),$=o.useRef(null),W=o.useRef(null),m=o.useRef(d),H=o.useRef(n),C=o.useMemo(()=>window.location.href.replace(/^http/,"ws"),[]),f=o.useMemo(()=>window.location.href.includes("api/hassio_ingress"),[]),M=100,q=60,ce=50,ve=300;o.useEffect(()=>{m.current=d},[d]),o.useEffect(()=>{H.current=n},[n]);const S=o.useCallback(()=>Math.floor(Math.random()*999e3)+1e3,[]),p=o.useCallback(P=>{if(z.current&&z.current.readyState===WebSocket.OPEN)try{P.id===void 0&&(P.id=x.current);const u=JSON.stringify(P);z.current.send(u),i&&console.log("WebSocket sent message:",P)}catch(u){i&&console.error(`WebSocket error sending message: ${u}`)}else i&&console.error("WebSocket message not sent, WebSocket not connected:",P)},[]),V=o.useCallback((P,u)=>{const ie=`<span style="background-color: #5c0e91; color: white; padding: 1px 5px; font-size: 12px; border-radius: 3px;">${P}</span>`;y(Y=>[...Y,ie+' <span style="color: var(--main-log-color);">'+u+"</span>"])},[]),k=o.useCallback((P,u)=>{a(P),s(u),V("WebSocket",`Filtering by log level "${P}" and log search "${u}"`)},[V]),X=o.useCallback(P=>{i&&console.log("WebSocket addListener:",P),c.current=[...c.current,P],i&&console.log("WebSocket addListener total listeners:",c.current.length)},[]),T=o.useCallback(P=>{i&&console.log("WebSocket removeListener:",P),c.current=c.current.filter(u=>u!==P),i&&console.log("WebSocket removeListener total listeners:",c.current.length)},[]),_=o.useCallback(()=>{C===""||C===null||C===void 0||(V("WebSocket",`Connecting to WebSocket: ${C}`),z.current=new WebSocket(C),z.current.onmessage=P=>{b||L(!0);try{const u=JSON.parse(P.data);if(u.id===void 0)return;if(u.error&&i&&console.error("WebSocket error message:",u),u.id===x.current&&u.src==="Matterbridge"&&u.dst==="Frontend"&&u.response==="pong"){i&&console.log("WebSocket pong response message:",u,"listeners:",c.current.length),$.current&&clearTimeout($.current),c.current.forEach(Y=>Y(u));return}if(u.id===Me.RefreshRequired){i&&console.log("WebSocket WS_ID_REFRESH_REQUIRED message:",u,"listeners:",c.current.length),c.current.forEach(Y=>Y(u));return}else if(u.id===Me.RestartRequired){i&&console.log("WebSocket WS_ID_RESTART_REQUIRED message:",u,"listeners:",c.current.length),c.current.forEach(Y=>Y(u));return}else if(u.id===Me.RestartNotRequired){i&&console.log("WebSocket WS_ID_RESTART_NOT_REQUIRED message:",u,"listeners:",c.current.length),c.current.forEach(Y=>Y(u));return}else if(u.id===Me.CpuUpdate){i&&console.log("WebSocket WS_ID_CPU_UPDATE message:",u,"listeners:",c.current.length),c.current.forEach(Y=>Y(u));return}else if(u.id===Me.MemoryUpdate){i&&console.log("WebSocket WS_ID_MEMORY_UPDATE message:",u,"listeners:",c.current.length),c.current.forEach(Y=>Y(u));return}else if(u.id===Me.UptimeUpdate){i&&console.log("WebSocket WS_ID_UPTIME_UPDATE message:",u,"listeners:",c.current.length),c.current.forEach(Y=>Y(u));return}else if(u.id===Me.Snackbar&&u.params&&u.params.message){i&&console.log("WebSocket WS_ID_SNACKBAR message:",u,"listeners:",c.current.length),A(u.params.message,u.params.timeout,u.params.severity);return}else if(u.id===Me.CloseSnackbar&&u.params&&u.params.message){i&&console.log("WebSocket WS_ID_CLOSE_SNACKBAR message:",u,"listeners:",c.current.length),w(u.params.message);return}else if(u.id===Me.ShellySysUpdate){i&&console.log("WebSocket WS_ID_SHELLY_SYS_UPDATE message:",u,"listeners:",c.current.length),c.current.forEach(Y=>Y(u));return}else if(u.id===Me.ShellyMainUpdate){i&&console.log("WebSocket WS_ID_SHELLY_MAIN_UPDATE message:",u,"listeners:",c.current.length),c.current.forEach(Y=>Y(u));return}else if(u.id!==Me.Log){i&&console.log("WebSocket message:",u,"listeners:",c.current.length),c.current.forEach(Y=>Y(u));return}if(!u.params||!u.params.level||!u.params.time||!u.params.name||!u.params.message||["debug","info","notice","warn","error","fatal"].includes(u.params.level)&&(m.current==="info"&&u.params.level==="debug"||m.current==="notice"&&(u.params.level==="debug"||u.params.level==="info")||m.current==="warn"&&(u.params.level==="debug"||u.params.level==="info"||u.params.level==="notice")||m.current==="error"&&(u.params.level==="debug"||u.params.level==="info"||u.params.level==="notice"||u.params.level==="warn")||m.current==="fatal"&&(u.params.level==="debug"||u.params.level==="info"||u.params.level==="notice"||u.params.level==="warn"||u.params.level==="error"))||H.current!=="*"&&H.current!==""&&!u.params.message.toLowerCase().includes(H.current.toLowerCase())&&!u.params.name.toLowerCase().includes(H.current.toLowerCase())||u.params.name==="Commissioning"&&u.params.message.includes("is uncommissioned"))return;y(Y=>{const ue=`<span style="color: #505050;">[${u.params?.time}]</span>`,ge=ye=>{switch(ye?.toLowerCase()){case"debug":return"gray";case"info":return"#267fb7";case"notice":return"green";case"warn":return"#e9db18";case"error":return"red";case"fatal":return"#ff0000";case"spawn":return"#ff00d0";default:return"lightblue"}},B=ye=>{switch(ye?.toLowerCase()){case"warn":return"black";default:return"white"}},he=`${`<span style="background-color: ${ge(u.params?.level)}; color: ${B(u.params?.level)}; padding: 1px 5px; font-size: 12px; border-radius: 3px;">${u.params?.level}</span>`} ${ue} <span style="color: #09516d;">[${u.params?.name}]</span> <span style="color: var(--main-log-color);">${u.params?.message}</span>`,ne=[...Y,he];return ne.length>t?ne.slice(t/10):ne})}catch(u){console.error(`WebSocketUse error parsing message: ${u}`)}},z.current.onopen=()=>{i&&console.log(`WebSocket: Connected to WebSocket: ${C}`),V("WebSocket",`Connected to WebSocket: ${C}`),L(!0),E(),v.current=1,W.current=setTimeout(()=>{N.current=setInterval(()=>{p({id:x.current,method:"ping",src:"Frontend",dst:"Matterbridge",params:{}}),$.current&&clearTimeout($.current),$.current=setTimeout(()=>{i&&console.error(`WebSocketUse: No pong response received from WebSocket: ${C}`),V("WebSocket",`No pong response received from WebSocket: ${C}`),L(!1)},1e3*ce)},1e3*q)},1e3*ve)},z.current.onclose=()=>{i&&console.error(`WebSocket: Disconnected from WebSocket ${f?"with Ingress":""}: ${C}`),V("WebSocket",`Disconnected from WebSocket: ${C}`),L(!1),E(),W.current&&clearTimeout(W.current),$.current&&clearTimeout($.current),N.current&&clearInterval(N.current),V("WebSocket",`Reconnecting (attempt ${v.current} of ${M}) to WebSocket${f?" (Ingress)":""}: ${C}`),f?setTimeout(h,5e3):v.current===1?h():v.current<M?setTimeout(h,1e3*v.current):V("WebSocket",`Reconnect attempts exceeded limit of ${M} retries, refresh the page to reconnect to: ${C}`),v.current=v.current+1},z.current.onerror=P=>{i&&console.error(`WebSocket: WebSocket error connecting to ${C}:`,P),V("WebSocket",`WebSocket error connecting to ${C}`)})},[C]),h=o.useCallback(()=>{i&&console.log(`WebSocket attemptReconnect ${v.current}/${M} to:`,C),_()},[_]);o.useEffect(()=>(_(),()=>{z.current&&z.current.readyState===WebSocket.OPEN&&z.current.close()}),[_]);const j=o.useMemo(()=>({messages:g,maxMessages:t,autoScroll:D,setMessages:y,setLogFilters:k,setMaxMessages:l,setAutoScroll:R}),[g,y,k]),I=o.useMemo(()=>({maxMessages:t,autoScroll:D,logFilterLevel:d,logFilterSearch:n,setMessages:y,setLogFilters:k,setMaxMessages:l,setAutoScroll:R,online:b,retry:v.current,getUniqueId:S,addListener:X,removeListener:T,sendMessage:p,logMessage:V}),[t,D,y,k,l,R,b,v.current,X,T,p,V]);return e.jsx(nr.Provider,{value:j,children:e.jsx(be.Provider,{value:I,children:r})})}function Qo(){const{showSnackbarMessage:r,showConfirmCancelDialog:d}=o.useContext(nt),{online:a,sendMessage:n,logMessage:s,addListener:g,removeListener:y,getUniqueId:t}=o.useContext(be),[l,D]=o.useState(!1),[R,b]=o.useState(!1),[L,A]=o.useState(!1),[w,E]=o.useState(!1),[c,z]=o.useState(null),v=o.useRef(t()),[x,N]=o.useState(null),[$,W]=o.useState(null),[m,H]=o.useState(null),[C,f]=o.useState(null),[M,q]=o.useState(null),ce=()=>{window.open("https://www.buymeacoffee.com/luligugithub","_blank")},ve=()=>{window.open("https://github.com/Luligu/matterbridge/blob/main/README.md","_blank")},S=()=>{c?.matterbridgeInformation.matterbridgeVersion.includes("-dev-")?window.open("https://github.com/Luligu/matterbridge/blob/dev/CHANGELOG.md","_blank"):window.open("https://github.com/Luligu/matterbridge/blob/main/CHANGELOG.md","_blank")},p=()=>{window.open("https://discord.gg/QX58CDe6hd","_blank")},V=()=>{window.open("https://github.com/Luligu/matterbridge","_blank")},k=()=>{n({id:v.current,sender:"Header",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:"matterbridge",restart:!0}})},X=()=>{n({id:v.current,sender:"Header",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:"matterbridge@dev",restart:!0}})},T=()=>{n({id:v.current,sender:"Header",method:"/api/checkupdates",src:"Frontend",dst:"Matterbridge",params:{}})},_=()=>{i&&console.log("Header: handleShellySystemUpdateClick"),s("Matterbridge","Installing system updates..."),n({id:v.current,sender:"Header",method:"/api/shellysysupdate",src:"Frontend",dst:"Matterbridge",params:{}})},h=()=>{i&&console.log("Header: handleShellyMainUpdateClick"),s("Matterbridge","Installing software updates..."),n({id:v.current,sender:"Header",method:"/api/shellymainupdate",src:"Frontend",dst:"Matterbridge",params:{}})},j=()=>{i&&console.log("Header: handleShellyCreateSystemLog"),n({id:v.current,sender:"Header",method:"/api/shellycreatesystemlog",src:"Frontend",dst:"Matterbridge",params:{}})},I=()=>{i&&console.log("Header: handleShellyDownloadSystemLog"),s("Matterbridge","Downloading Shelly system log..."),r("Downloading Shelly system log...",5),window.location.href="./api/shellydownloadsystemlog"},P=()=>{c?.matterbridgeInformation.restartMode===""?n({id:v.current,sender:"Header",method:"/api/restart",src:"Frontend",dst:"Matterbridge",params:{}}):n({id:v.current,sender:"Header",method:"/api/shutdown",src:"Frontend",dst:"Matterbridge",params:{}})},u=()=>{n({id:v.current,sender:"Header",method:"/api/shutdown",src:"Frontend",dst:"Matterbridge",params:{}})},ie=()=>{n({id:v.current,sender:"Header",method:"/api/reboot",src:"Frontend",dst:"Matterbridge",params:{}})},Y=()=>{n({id:v.current,sender:"Header",method:"/api/softreset",src:"Frontend",dst:"Matterbridge",params:{}})},ue=()=>{n({id:v.current,sender:"Header",method:"/api/hardreset",src:"Frontend",dst:"Matterbridge",params:{}})},ge=Q=>{N(Q.currentTarget)},B=Q=>{i&&console.log("Header: handleMenuClose",Q),N(null),Q==="download-mblog"?(s("Matterbridge","Downloading matterbridge log..."),r("Downloading matterbridge log...",5),window.location.href="./api/download-mblog"):Q==="download-mjlog"?(s("Matterbridge","Downloading matter log..."),r("Downloading matter log...",5),window.location.href="./api/download-mjlog"):Q==="view-mblog"?(s("Matterbridge","Loading matterbridge log..."),r("Loading matterbridge log...",5),window.location.href="./api/view-mblog"):Q==="view-mjlog"?(s("Matterbridge","Loading matter log..."),r("Loading matter log...",5),window.location.href="./api/view-mjlog"):Q==="view-shellylog"?(s("Matterbridge","Loading shelly system log..."),r("Loading shelly system log...",5),window.location.href="./api/shellyviewsystemlog"):Q==="download-mbstorage"?(s("Matterbridge","Downloading matterbridge storage..."),r("Downloading matterbridge storage...",5),window.location.href="./api/download-mbstorage"):Q==="download-pluginstorage"?(s("Matterbridge","Downloading matterbridge plugins storage..."),r("Downloading matterbridge plugins storage...",5),window.location.href="./api/download-pluginstorage"):Q==="download-pluginconfig"?(s("Matterbridge","Downloading matterbridge plugins config..."),r("Downloading matterbridge plugins config...",5),window.location.href="./api/download-pluginconfig"):Q==="download-mjstorage"?(s("Matterbridge","Downloading matter storage..."),r("Downloading matter storage...",5),window.location.href="./api/download-mjstorage"):Q==="download-backup"?(s("Matterbridge","Downloading backup..."),r("Downloading backup...",10),window.location.href="./api/download-backup"):Q==="update"?k():Q==="updatedev"?X():Q==="updatecheck"?T():Q==="shelly-sys-update"?_():Q==="shelly-main-update"?h():Q==="shelly-create-system-log"?j():Q==="shelly-download-system-log"?I():Q==="softreset"?Y():Q==="hardreset"?ue():Q==="restart"?P():Q==="shutdown"?u():Q==="reboot"?ie():Q==="create-backup"?n({id:v.current,sender:"Header",method:"/api/create-backup",src:"Frontend",dst:"Matterbridge",params:{}}):Q==="unregister"?n({id:v.current,sender:"Header",method:"/api/unregister",src:"Frontend",dst:"Matterbridge",params:{}}):Q==="reset"?n({id:v.current,sender:"Header",method:"/api/reset",src:"Frontend",dst:"Matterbridge",params:{}}):Q==="factoryreset"&&n({id:v.current,sender:"Header",method:"/api/factoryreset",src:"Frontend",dst:"Matterbridge",params:{}})},de=Q=>{i&&console.log("Header: handleMenuCloseCancel:",Q),N(null)},he=Q=>{W(Q.currentTarget)},ne=()=>{W(null)},ye=Q=>{H(Q.currentTarget)},se=()=>{H(null)},fe=Q=>{f(Q.currentTarget)},Z=()=>{f(null)},me=Q=>{q(Q.currentTarget)},je=()=>{q(null)},Je=()=>{ei(),i&&console.log("Matterbridge logo clicked: debug is now",i)};return o.useEffect(()=>{const Q=te=>{te.src==="Matterbridge"&&te.dst==="Frontend"&&(Ve(te)&&te.method==="/api/settings"&&te.id===v.current&&(i&&console.log("Header received settings:",te.response),z(te.response),D(te.response.matterbridgeInformation.restartRequired||te.response.matterbridgeInformation.fixedRestartRequired),b(te.response.matterbridgeInformation.fixedRestartRequired),A(te.response.matterbridgeInformation.updateRequired)),xe(te)&&te.method==="refresh_required"&&te.params.changed==="settings"&&(i&&console.log(`Header received refresh_required: changed=${te.params.changed} and sending /api/settings request`),n({id:v.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),xe(te)&&te.method==="restart_required"&&(i&&console.log(`Header received restart_required with fixed: ${te.params.fixed}`),D(!0),te.params.fixed===!0&&b(!0)),xe(te)&&te.method==="restart_not_required"&&(i&&console.log("Header received restart_not_required"),D(!1)),xe(te)&&te.method==="update_required"&&(i&&console.log("Header received update_required"),A(!0)),xe(te)&&te.method==="update_required_dev"&&(i&&console.log("Header received update_required_dev"),E(!0)),xe(te)&&te.id===Me.ShellySysUpdate&&(i&&console.log("Header received WS_ID_SHELLY_SYS_UPDATE:"),z(De=>De?{matterbridgeInformation:{...De.matterbridgeInformation,shellySysUpdate:te.params.available},systemInformation:De.systemInformation}:null)),xe(te)&&te.id===Me.ShellyMainUpdate&&(i&&console.log("Header received WS_ID_SHELLY_MAIN_UPDATE:"),z(De=>De?{matterbridgeInformation:{...De.matterbridgeInformation,shellyMainUpdate:te.params.available},systemInformation:De.systemInformation}:null)))};return g(Q),i&&console.log(`Header added WebSocket listener id ${v.current}`),()=>{y(Q),i&&console.log("Header removed WebSocket listener")}},[g,y,n,r]),o.useEffect(()=>{a&&(i&&console.log("Header sending /api/settings requests"),n({id:v.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}))},[a,n]),i&&console.log("Header rendering..."),!a||!c?null:e.jsxs("div",{className:"header",children:[e.jsxs("div",{className:"sub-header",children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"30px"},onClick:Je}),e.jsx("h2",{style:{fontSize:"22px",color:"var(--main-icon-color)",margin:"0px"},children:"Matterbridge"}),e.jsxs("nav",{children:[e.jsx(st,{to:"/",className:"nav-link",children:"Home"}),e.jsx(st,{to:"/devices",className:"nav-link",children:"Devices"}),e.jsx(st,{to:"/log",className:"nav-link",children:"Logs"}),e.jsx(st,{to:"/settings",className:"nav-link",children:"Settings"})]})]}),e.jsxs("div",{className:"sub-header",children:[!c.matterbridgeInformation.readOnly&&L&&e.jsx(O,{title:"New Matterbridge version available, click to install",children:e.jsxs("span",{className:"status-warning",onClick:k,children:["Update to v.",c.matterbridgeInformation.matterbridgeLatestVersion]})}),!c.matterbridgeInformation.readOnly&&w&&e.jsx(O,{title:"New Matterbridge dev version available, click to install",children:e.jsxs("span",{className:"status-warning",onClick:X,children:["Update to new dev v.",c.matterbridgeInformation.matterbridgeDevVersion.split("-dev-")[0]]})}),!c.matterbridgeInformation.readOnly&&e.jsx(O,{title:"Matterbridge version, click to see the changelog",children:e.jsxs("span",{className:"status-information",onClick:S,children:["v.",c.matterbridgeInformation.matterbridgeVersion]})}),c.matterbridgeInformation.shellyBoard&&e.jsx("img",{src:"Shelly.svg",alt:"Shelly Icon",style:{height:"30px",padding:"0px",margin:"0px",marginRight:"30px"}}),c.matterbridgeInformation.bridgeMode!==""&&c.matterbridgeInformation.readOnly===!1?e.jsx(O,{title:"Bridge mode",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:c.matterbridgeInformation.bridgeMode})}):null,c.matterbridgeInformation.restartMode!==""&&c.matterbridgeInformation.readOnly===!1?e.jsx(O,{title:"Restart mode",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:c.matterbridgeInformation.restartMode})}):null,c.matterbridgeInformation.profile&&c.matterbridgeInformation.profile!==""&&c.matterbridgeInformation.readOnly===!1?e.jsx(O,{title:"Current profile",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:c.matterbridgeInformation.profile})}):null]}),e.jsxs("div",{className:"sub-header",style:{gap:"5px"},children:[c.matterbridgeInformation.readOnly===!1?e.jsx(O,{title:"Matterbridge discord group",children:e.jsx("img",{src:"discord.svg",alt:"Discord Logo",style:{cursor:"pointer",height:"25px"},onClick:p})}):null,c.matterbridgeInformation.readOnly===!1?e.jsx(O,{title:"Give a star to Matterbridge",children:e.jsx(J,{style:{color:"#FFD700",margin:"0",padding:"0"},onClick:V,children:e.jsx(kr,{})})}):null,c.matterbridgeInformation.readOnly===!1?e.jsx(O,{title:"Sponsor Matterbridge",children:e.jsx(J,{style:{color:"#b6409c",margin:"0",padding:"0"},onClick:ce,children:e.jsx(Xt,{})})}):null,e.jsx(O,{title:"Matterbridge help",children:e.jsx(J,{style:{color:"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:ve,children:e.jsx(Ir,{})})}),e.jsx(O,{title:"Matterbridge changelog",children:e.jsx(J,{style:{color:"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:S,children:e.jsx(Zt,{})})}),c.matterbridgeInformation&&!c.matterbridgeInformation.readOnly&&e.jsx(O,{title:"Update matterbridge to latest version",children:e.jsx(J,{style:{color:L?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:k,children:e.jsx(_e,{})})}),c.matterbridgeInformation&&c.matterbridgeInformation.shellyBoard&&c.matterbridgeInformation.shellySysUpdate&&e.jsx(O,{title:"Shelly system update",children:e.jsx(J,{style:{color:"var(--primary-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:_,children:e.jsx(_e,{})})}),c.matterbridgeInformation&&c.matterbridgeInformation.shellyBoard&&c.matterbridgeInformation.shellyMainUpdate&&e.jsx(O,{title:"Shelly software update",children:e.jsx(J,{style:{color:"var(--primary-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:h,children:e.jsx(_e,{})})}),e.jsx(O,{title:"Restart matterbridge",children:e.jsx(J,{style:{color:l||R?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:P,children:e.jsx(vt,{})})}),c.matterbridgeInformation.restartMode===""?e.jsx(O,{title:"Shut down matterbridge",children:e.jsx(J,{style:{color:l||R?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:u,children:e.jsx(ze,{})})}):null,e.jsx(O,{title:"Download, backup and more",children:e.jsx(J,{onClick:ge,children:e.jsx(Dr,{style:{color:"var(--main-icon-color)"}})})}),e.jsxs(et,{id:"command-menu",anchorEl:x,keepMounted:!0,open:!!x,onClose:()=>B(""),children:[c.matterbridgeInformation&&!c.matterbridgeInformation.readOnly&&e.jsxs(F,{onClick:()=>B("update"),children:[e.jsx(K,{children:e.jsx(_e,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Install latest stable",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),c.matterbridgeInformation&&!c.matterbridgeInformation.readOnly&&e.jsxs(F,{onClick:()=>B("updatedev"),children:[e.jsx(K,{children:e.jsx(_e,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Install latest dev",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),c.matterbridgeInformation&&!c.matterbridgeInformation.readOnly&&e.jsxs(F,{onClick:()=>B("updatecheck"),children:[e.jsx(K,{children:e.jsx(_e,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Check for updates",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),c.matterbridgeInformation&&c.matterbridgeInformation.shellyBoard&&c.matterbridgeInformation.shellySysUpdate&&e.jsxs(F,{onClick:()=>B("shelly-sys-update"),children:[e.jsx(K,{children:e.jsx(_e,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Shelly system update",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),c.matterbridgeInformation&&c.matterbridgeInformation.shellyBoard&&c.matterbridgeInformation.shellyMainUpdate&&e.jsxs(F,{onClick:()=>B("shelly-main-update"),children:[e.jsx(K,{children:e.jsx(_e,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Shelly software update",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(F,{onClick:()=>B("restart"),children:[e.jsx(K,{children:e.jsx(vt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Restart",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),c.matterbridgeInformation.restartMode===""?e.jsxs(F,{onClick:()=>B("shutdown"),children:[e.jsx(K,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Shutdown",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}):null,c.matterbridgeInformation&&c.matterbridgeInformation.shellyBoard&&e.jsxs(F,{onClick:()=>{d("Reboot","Are you sure you want to reboot the Shelly board?","reboot",B,de)},children:[e.jsx(K,{children:e.jsx(vt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Reboot...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsx(lt,{}),e.jsxs(F,{onClick:ye,children:[e.jsx(K,{children:e.jsx(dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"View",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(et,{id:"sub-menu-view",anchorEl:m,keepMounted:!0,open:!!m,onClose:se,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(F,{onClick:()=>{B("view-mblog"),se()},children:[e.jsx(K,{children:e.jsx(dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Matterbridge log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(F,{onClick:()=>{B("view-mjlog"),se()},children:[e.jsx(K,{children:e.jsx(dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Matter log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),c.matterbridgeInformation&&c.matterbridgeInformation.shellyBoard&&e.jsxs(F,{onClick:()=>{B("view-shellylog"),se()},children:[e.jsx(K,{children:e.jsx(dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(lt,{}),e.jsxs(F,{onClick:fe,children:[e.jsx(K,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Download",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(et,{id:"sub-menu-download",anchorEl:C,keepMounted:!0,open:!!C,onClose:Z,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(F,{onClick:()=>{B("download-mbstorage"),Z()},children:[e.jsx(K,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Matterbridge storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(F,{onClick:()=>{B("download-pluginstorage"),Z()},children:[e.jsx(K,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Matterbridge plugins storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(F,{onClick:()=>{B("download-pluginconfig"),Z()},children:[e.jsx(K,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Matterbridge plugins config",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(F,{onClick:()=>{B("download-mblog"),Z()},children:[e.jsx(K,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Matterbridge log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(F,{onClick:()=>{B("download-mjstorage"),Z()},children:[e.jsx(K,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Matter storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(F,{onClick:()=>{B("download-mjlog"),Z()},children:[e.jsx(K,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Matter log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),c.matterbridgeInformation&&c.matterbridgeInformation.shellyBoard&&e.jsxs(F,{onClick:()=>{B("shelly-create-system-log"),Z()},children:[e.jsx(K,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Create Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),c.matterbridgeInformation&&c.matterbridgeInformation.shellyBoard&&e.jsxs(F,{onClick:()=>{B("shelly-download-system-log"),Z()},children:[e.jsx(K,{children:e.jsx(He,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Download Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(lt,{}),e.jsxs(F,{onClick:he,children:[e.jsx(K,{children:e.jsx(Nt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(et,{id:"sub-menu-backup",anchorEl:$,keepMounted:!0,open:!!$,onClose:ne,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(F,{onClick:()=>{B("create-backup"),ne()},children:[e.jsx(K,{children:e.jsx(Nt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Create backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(F,{onClick:()=>{B("download-backup"),ne()},children:[e.jsx(K,{children:e.jsx(Nt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Download backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(lt,{}),e.jsxs(F,{onClick:me,children:[e.jsx(K,{children:e.jsx(Nr,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Reset",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(et,{id:"sub-menu-reset",anchorEl:M,keepMounted:!0,open:!!M,onClose:je,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(F,{onClick:()=>{je(),d("Reset all devices and shutdown","Are you sure you want to unregister all devices? This will temporarily remove all devices from the controller and you may loose the controller configuration.","unregister",B,de)},children:[e.jsx(K,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Reset all devices...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(F,{onClick:()=>{je(),d("Reset commissioning and shutdown","Are you sure you want to reset the commissioning? You will have to manually remove Matterbridge from the controller.","reset",B,de)},children:[e.jsx(K,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Reset commissioning...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),!c.matterbridgeInformation.readOnly&&e.jsxs(F,{onClick:()=>{je(),d("Factory reset and shutdown","Are you sure you want to factory reset Matterbridge? You will have to manually remove Matterbridge from the controller.","factoryreset",B,de)},children:[e.jsx(K,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Factory reset...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),c.matterbridgeInformation&&c.matterbridgeInformation.shellyBoard&&e.jsxs(F,{onClick:()=>{je(),d("Network reset","Are you sure you want to factory reset the network parameters?","softreset",B,de)},children:[e.jsx(K,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Reset network...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),c.matterbridgeInformation&&c.matterbridgeInformation.shellyBoard&&e.jsxs(F,{onClick:()=>{je(),d("Factory reset","Are you sure you want to factory reset Matterbridge? You will have to manually remove Matterbridge from the controller.","hardreset",B,de)},children:[e.jsx(K,{children:e.jsx(ze,{style:{color:"var(--main-icon-color)"}})}),e.jsx(oe,{primary:"Factory reset...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]})]})]})]})}const Go=o.memo(Qo),Ko=()=>"ontouchstart"in window||typeof window.DocumentTouch<"u"&&document instanceof window.DocumentTouch?(i&&console.log("WebSocketLogs detectTouchscreen = true"),!0):(i&&console.log("WebSocketLogs detectTouchscreen = false"),!1);function Yo(){const{messages:r,autoScroll:d}=o.useContext(nr),[a,n]=o.useState(!1),s=o.useRef(null),g=o.useMemo(()=>Ko(),[]),y=l=>n(!0),t=l=>n(!1);return o.useEffect(()=>{i&&console.log(`WebSocketLogs autoScroll: ${d} isHovering: ${a}`),d&&!a&&!g&&s.current?.scrollIntoView({behavior:"smooth"})},[r,a,d,g]),e.jsx("div",{style:{margin:"0px",padding:"0px"},children:e.jsxs("ul",{style:{margin:"0px",padding:"0px"},onMouseEnter:y,onMouseLeave:t,children:[r.map((l,D)=>e.jsx("li",{style:{wordWrap:"break-word",maxHeight:"200px",overflow:"hidden"},dangerouslySetInnerHTML:{__html:l}},D)),e.jsx("div",{ref:s})]})})}const ir=o.memo(Yo);function Be(){const{retry:r}=o.useContext(be),d=()=>{window.location.reload()};return e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",fontSize:"20px",flexDirection:"column",color:"var(--main-text-color)",height:"100vh",backgroundColor:"var(--main-bg-color)"},children:e.jsx(ee,{sx:{display:"flex",alignItems:"center",flexDirection:"column"},children:r<100?e.jsxs(e.Fragment,{children:[e.jsx(Pr,{style:{color:"var(--primary-color)"}}),e.jsxs("div",{style:{marginTop:"20px",color:"var(--primary-color)"},children:["Reconnecting to Matterbridge ","(attempt "+r+")","..."]})]}):e.jsxs("div",{style:{marginTop:"20px",color:"var(--primary-color)",textAlign:"center"},children:["Unable to connect to Matterbridge after multiple attempts.",e.jsx("br",{}),"Please check your network connection.",e.jsx("br",{}),e.jsx(ae,{variant:"contained",color:"primary",onClick:d,style:{marginTop:"20px"},children:"Refresh the Page"})]})})})}function Xo({value:r,maxChars:d}){let a=r;if(r.length>d&&d>3){const n=d-3,s=r.substring(0,Math.ceil(n/2)),g=r.substring(r.length-Math.floor(n/2),r.length);a=`${s} â€¦ ${g}`}return r!==a?e.jsx(O,{title:r,placement:"top",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[0,12]}}]}},children:e.jsx("span",{children:a})}):e.jsx("span",{children:a})}function Zo({systemInfo:r,compact:d}){const[a,n]=o.useState(r),{sendMessage:s,addListener:g,removeListener:y}=o.useContext(be);if(i&&console.log("SystemInfoTable:",a,"compact:",d),r&&d&&a.totalMemory&&a.freeMemory){const t=a.totalMemory,l=a.freeMemory;a.freeMemory=`${l} / ${t}`,a.totalMemory=""}if(r&&d&&a.heapTotal&&a.heapUsed){const t=a.heapTotal,l=a.heapUsed;a.heapUsed=`${l} / ${t}`,a.heapTotal=""}if(r&&d&&a.osRelease&&a.osType){const t=a.osType,l=a.osRelease;a.osType=`${t} (${l})`,a.osRelease=""}if(r&&d&&a.osArch&&a.osPlatform){const t=a.osPlatform,l=a.osArch;a.osPlatform=`${t} (${l})`,a.osArch=""}return o.useEffect(()=>{const t=l=>{l.src==="Matterbridge"&&l.dst==="Frontend"&&(xe(l)&&l.method==="memory_update"&&l.params&&l.params.totalMemory&&l.params.freeMemory&&l.params.heapTotal&&l.params.heapUsed&&l.params.rss&&(i&&console.log("SystemInfoTable received memory_update",l),(a.totalMemory!==l.params?.totalMemory||a.freeMemory!==l.params?.freeMemory||a.heapTotal!==l.params?.heapTotal||a.heapUsed!==l.params?.heapUsed||a.rss!==l.params?.rss)&&n(D=>({...D,totalMemory:l.params?.totalMemory?l.params.totalMemory:"",freeMemory:l.params?.freeMemory?l.params.freeMemory:"",heapTotal:l.params?.heapTotal?l.params.heapTotal:"",heapUsed:l.params?.heapUsed?l.params.heapUsed:"",rss:l.params?.rss?l.params.rss:""}))),xe(l)&&l.method==="cpu_update"&&l.params&&l.params.cpuUsage&&(i&&console.log("SystemInfoTable received cpu_update",l),a.cpuUsage!==(l.params?.cpuUsage?l.params.cpuUsage.toFixed(2)+" %":"")&&n(D=>({...D,cpuUsage:l.params?.cpuUsage?l.params.cpuUsage.toFixed(2)+" %":""}))),xe(l)&&l.method==="uptime_update"&&l.params&&l.params.systemUptime&&l.params.processUptime&&(i&&console.log("SystemInfoTable received uptime_update",l),(a.systemUptime!==l.params?.systemUptime||a.processUptime!==l.params?.processUptime)&&n(D=>({...D,systemUptime:l.params?.systemUptime?l.params.systemUptime:"",processUptime:l.params?.processUptime?l.params.processUptime:""}))))};return i&&console.log("SystemInfoTable useEffect WebSocketMessage mounting"),g(t),i&&console.log("SystemInfoTable useEffect WebSocketMessage mounted"),()=>{i&&console.log("SystemInfoTable useEffect WebSocketMessage unmounting"),y(t),i&&console.log("SystemInfoTable useEffect WebSocketMessage unmounted")}},[g,a.cpuUsage,a.freeMemory,a.heapTotal,a.heapUsed,a.processUptime,a.rss,a.systemUptime,a.totalMemory,y,s]),a?(i&&console.log("SystemInfoTable rendering..."),e.jsxs("div",{className:"MbfWindowDiv",style:{minWidth:"302px",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"System Information"})}),e.jsx("div",{className:"MbfWindowDivTable",children:e.jsx("table",{style:{border:"none",borderCollapse:"collapse"},children:e.jsx("tbody",{style:{border:"none",borderCollapse:"collapse"},children:Object.entries(a).filter(([t,l])=>l!==void 0&&l!=="").map(([t,l],D)=>e.jsxs("tr",{className:D%2===0?"table-content-even":"table-content-odd",style:{border:"none",borderCollapse:"collapse"},children:[e.jsx("td",{style:{border:"none",borderCollapse:"collapse"},children:t}),e.jsx("td",{style:{border:"none",borderCollapse:"collapse"},children:e.jsx(Xo,{value:typeof l!="string"?l.toString():l,maxChars:25})})]},t))})})})]})):null}const en=o.memo(Zo),Bt={margin:"0px",padding:"0px",color:"var(--div-text-color)",transition:"color 0.2s ease","& svg":{display:"block"},"& svg path":{fill:"var(--div-text-color)",transition:"fill 0.2s ease"},"&:hover":{color:"var(--primary-color)"},"&:hover svg path":{fill:"var(--primary-color)"},"&:focus-visible":{outline:"2px solid var(--primary-color)",outlineOffset:"2px"}},tn=r=>{if(!r)return"";const d=r.toString().replace(/[^0-9]/g,"");if(d.length<5)return d;const a=d.slice(0,4),n=d.slice(4,7),s=d.slice(7,11);return[a,n,s].filter(Boolean).join("-")};function rn({id:r}){const{online:d,sendMessage:a,addListener:n,removeListener:s,getUniqueId:g}=o.useContext(be),[y,t]=o.useState(null),[l,D]=o.useState(null),R=o.useRef(null),b=o.useRef(g()),{showConfirmCancelDialog:L}=o.useContext(nt);o.useEffect(()=>{i&&console.log(`QRDiv received storeId update "${r}"`),r&&(i&&console.log(`QRDiv sending data request for storeId "${r}"`),t(r),a({id:b.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:r,server:!0}}))},[r]),o.useEffect(()=>{const v=x=>{x.src==="Matterbridge"&&x.dst==="Frontend"&&xe(x)&&x.id===Me.RefreshRequired&&x.params.changed==="matter"&&x.params.matter&&(i&&console.log(`QRDiv received refresh_required: changed=${x.params.changed} for storeId "${x.params.matter.id}":`,x.params.matter),y===x.params.matter.id&&(i&&console.log(`QRDiv received refresh_required/matter: setting matter data for storeId "${x.params.matter.id}":`,x.params.matter),R.current&&clearTimeout(R.current),x.params.matter.advertising&&x.params.matter.advertiseTime&&x.params.matter.advertiseTime+9e5<=Date.now()&&(x.params.matter.advertising=!1),D(x.params.matter),x.params.matter.advertising&&(i&&console.log(`QRDiv setting matter advertise timeout for storeId "${x.params.matter.id}":`,x.params.matter.advertiseTime+9e5-Date.now()),R.current=setTimeout(()=>{R.current&&clearTimeout(R.current),i&&console.log(`QRDiv clearing advertising state for storeId "${y}" after 15 minutes`),D(N=>N&&{...N,advertising:!1})},x.params.matter.advertiseTime+9e5-Date.now()))))};return n(v),i&&console.log("QRDiv webSocket effect mounted"),()=>{s(v),R.current&&clearTimeout(R.current),i&&console.log("QRDiv webSocket effect unmounted")}},[y]);const A=()=>{i&&console.log(`QRDiv sent matter startCommission for node "${l?.id}"`),l&&a({id:b.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:l.id,startCommission:!0}})},w=()=>{i&&console.log(`QRDiv sent matter stopCommission for node "${l?.id}"`),l&&a({id:b.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:l.id,stopCommission:!0}})},E=()=>{i&&console.log(`QRDiv sent matter advertise for node "${l?.id}"`),l&&a({id:b.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:l.id,advertise:!0}})},c=v=>{i&&console.log(`QRDiv sent matter removeFabric for node "${l?.id}" and fabricIndex ${v}`),l&&a({id:b.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:l.id,removeFabric:v}})},z=async()=>{if(!l||!l.manualPairingCode)return;const v=l.manualPairingCode.toString();try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(v);else{const x=document.createElement("textarea");x.value=v,x.style.position="fixed",x.style.opacity="0",document.body.appendChild(x),x.focus(),x.select(),document.execCommand("copy"),document.body.removeChild(x)}i&&console.log("Manual pairing code copied to clipboard")}catch(x){console.error("Failed to copy manual pairing code",x)}};return!l||!d?(i&&console.log("QRDiv rendering undefined state"),null):l.online?l.advertising&&l.qrPairingCode&&l.manualPairingCode?(i&&console.log("QRDiv rendering advertising state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"QR pairing code"}),e.jsxs("div",{className:"MbfWindowHeaderFooterIcons",children:[e.jsx(J,{"aria-label":"send advertising",size:"small",onClick:E,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(O,{title:"Send again the mDNS advertisement",arrow:!0,children:e.jsx(re,{path:At,size:"22px"})})}),e.jsx(J,{"aria-label":"stop pairing",size:"small",onClick:w,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(O,{title:"Turn off pairing",arrow:!0,children:e.jsx(re,{path:ho,size:"22px"})})})]})]}),e.jsx("p",{className:"MbfWindowHeaderText",style:{overflow:"hidden",maxWidth:"280px",textOverflow:"ellipsis",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:y}),e.jsx(go,{value:l.qrPairingCode,size:256,level:"M",fgColor:"var(--div-text-color)",bgColor:"var(--div-bg-color)",style:{margin:"20px"}}),e.jsxs("div",{className:"MbfWindowFooter",style:{justifyContent:"space-between"},children:[e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Manual pairing code: ",tn(l.manualPairingCode)]}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(O,{title:"Copy manual pairing code",arrow:!0,children:e.jsx(J,{"aria-label":"copy manual pairing code",size:"small",onClick:z,sx:Bt,children:e.jsx(re,{path:fo,size:.85})})})})]})]})):l.commissioned&&l.fabricInformations&&l.sessionInformations?(i&&console.log("QRDiv rendering commissioned state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px",overflow:"hidden"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Paired fabrics"}),e.jsxs("div",{className:"MbfWindowHeaderFooterIcons",children:[e.jsx(J,{"aria-label":"send advertising",size:"small",onClick:E,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(O,{title:"Send again the mDNS advertisement",arrow:!0,children:e.jsx(re,{path:At,size:"22px"})})}),e.jsx(J,{"aria-label":"start pairing",size:"small",onClick:A,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(O,{title:"Turn on pairing",arrow:!0,children:e.jsx(re,{path:Ut,size:"22px"})})})]})]}),e.jsxs("div",{className:"MbfWindowBodyColumn",style:{paddingTop:"0px"},children:[e.jsx("p",{className:"MbfWindowHeaderText thin-scroll",style:{overflowX:"auto",maxWidth:"280px",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:y}),l.fabricInformations.map((v,x)=>e.jsxs("div",{style:{margin:"0px",padding:"10px",gap:"0px",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",textAlign:"left",fontSize:"14px"},children:[e.jsxs("div",{style:{marginLeft:"20px",marginBottom:"10px",display:"flex",flexDirection:"row",justifyContent:"space-between",gap:"20px",alignItems:"center"},children:[e.jsxs("p",{className:"status-blue",style:{margin:"0px",padding:"3px 10px",width:"200px",fontSize:"14px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},children:["Fabric: ",v.fabricIndex]}),e.jsx(O,{title:"Remove the fabric. You will also need to remove it from the controller.",arrow:!0,children:e.jsx(J,{"aria-label":"remove the fabric",size:"small",onClick:()=>L("Remove fabric","Are you sure you want to remove this fabric? You will also need to remove it from the controller.","RemoveFabric",()=>c(v.fabricIndex),()=>{}),sx:{...Bt,padding:"2px"},children:e.jsx(re,{path:xo,size:1})})})]}),e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Vendor: ",v.rootVendorId," ",v.rootVendorName]}),v.label!==""&&e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Label: ",v.label]}),e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Sessions: ",l.sessionInformations?l.sessionInformations.filter(N=>N.fabric?.fabricIndex===v.fabricIndex&&N.isPeerActive===!0).length:"0"," ","subscriptions: ",l.sessionInformations?l.sessionInformations.filter(N=>N.fabric?.fabricIndex===v.fabricIndex&&N.isPeerActive===!0&&N.numberOfActiveSubscriptions>0).length:"0"]})]},x))]}),e.jsx("div",{className:"MbfWindowFooter",children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Serial number: ",l.serialNumber]})})]})):!l.commissioned&&!l.advertising?(i&&console.log("QRDiv rendering not commissioned and not advertising state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px"},children:[e.jsx("div",{className:"MbfWindowHeader",style:{height:"30px"},children:e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"QR pairing code"})}),e.jsx("p",{className:"MbfWindowHeaderText thin-scroll",style:{overflowX:"auto",maxWidth:"280px",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:y}),e.jsx(ae,{onClick:A,endIcon:e.jsx(re,{path:Ut,size:1}),style:{margin:"20px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:"Turn on pairing"}),e.jsx("div",{className:"MbfWindowFooter",children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Serial number: ",l.serialNumber]})})]})):(i&&console.log("QRDiv rendering unknown state"),null):(i&&console.log("QRDiv rendering offline state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Server node"}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons"})]}),e.jsx("p",{className:"MbfWindowHeaderText",style:{overflow:"hidden",maxWidth:"280px",textOverflow:"ellipsis",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:y}),e.jsx("p",{style:{textAlign:"center",fontSize:"14px",fontWeight:"bold"},children:"Server offline: restart to commission"}),e.jsx("div",{className:"MbfWindowFooter",children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Serial number: ",l.serialNumber]})})]}))}const on=o.memo(rn);function nn(){const{logMessage:r,sendMessage:d,getUniqueId:a}=o.useContext(be),[n,s]=o.useState("matterbridge-"),[g,y]=o.useState(!1),[t,l]=o.useState(null),D=o.useRef(a()),R=x=>{x.preventDefault(),y(!0)},b=()=>{y(!1)},L=x=>{x.preventDefault(),y(!1);const N=x.dataTransfer.files[0];if(N){r("Plugins",`Installing package ${N.name}. Please wait...`);const $=new FormData;$.append("file",N),$.append("filename",N.name),fetch("./api/uploadpackage",{method:"POST",body:$}).then(W=>W.text()).then(W=>{r("Plugins",`Server response: ${W}`)}).catch(W=>{console.error("Error uploading plugin file:",W),r("Plugins",`Error installing package ${W}`)})}},A=x=>{const N=x.target.files&&x.target.files[0];if(N){r("Plugins",`Uploading package ${N.name}`);const $=new FormData;$.append("file",N),$.append("filename",N.name),fetch("./api/uploadpackage",{method:"POST",body:$}).then(W=>W.text()).then(W=>{r("Plugins",`Server response: ${W}`)}).catch(W=>{console.error("Error uploading plugin file:",W),r("Plugins",`Error uploading package ${W}`)})}},w=()=>{d({id:D.current,sender:"InstallPlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:n,restart:!1}})},E=()=>{document.getElementById("file-upload")?.click()},c=()=>{d({id:D.current,sender:"InstallPlugins",method:"/api/addplugin",src:"Frontend",dst:"Matterbridge",params:{pluginNameOrPath:n}})},z=x=>{l(x.currentTarget)},v=x=>{x!==""&&s(x),l(null)};return i&&console.log("AddRemovePlugins rendering..."),e.jsxs("div",{style:{display:"flex",flexDirection:"row",flex:"1 1 auto",alignItems:"center",justifyContent:"space-between",margin:"0px",padding:"10px",gap:"20px"},onDragOver:R,onDragLeave:b,onDrop:L,children:[e.jsx(pe,{value:n,onChange:x=>{s(x.target.value)},size:"small",id:"plugin-name",label:"Plugin name or plugin path",variant:"outlined",fullWidth:!0}),e.jsx(J,{onClick:z,children:e.jsx(Wr,{})}),e.jsxs(et,{id:"simple-menu",anchorEl:t,keepMounted:!0,open:!!t,onClose:()=>v(""),children:[e.jsx(F,{onClick:()=>v("matterbridge-zigbee2mqtt"),children:"matterbridge-zigbee2mqtt"}),e.jsx(F,{onClick:()=>v("matterbridge-somfy-tahoma"),children:"matterbridge-somfy-tahoma"}),e.jsx(F,{onClick:()=>v("matterbridge-shelly"),children:"matterbridge-shelly"}),e.jsx(F,{onClick:()=>v("matterbridge-hass"),children:"matterbridge-hass"}),e.jsx(F,{onClick:()=>v("matterbridge-webhooks"),children:"matterbridge-webhooks"}),e.jsx(F,{onClick:()=>v("matterbridge-bthome"),children:"matterbridge-bthome"}),e.jsx(F,{onClick:()=>v("matterbridge-test"),children:"matterbridge-test"}),e.jsx(F,{onClick:()=>v("matterbridge-example-accessory-platform"),children:"matterbridge-example-accessory-platform"}),e.jsx(F,{onClick:()=>v("matterbridge-example-dynamic-platform"),children:"matterbridge-example-dynamic-platform"}),e.jsx(F,{onClick:()=>v("matterbridge-eve-door"),children:"matterbridge-eve-door"}),e.jsx(F,{onClick:()=>v("matterbridge-eve-motion"),children:"matterbridge-eve-motion"}),e.jsx(F,{onClick:()=>v("matterbridge-eve-energy"),children:"matterbridge-eve-energy"}),e.jsx(F,{onClick:()=>v("matterbridge-eve-weather"),children:"matterbridge-eve-weather"}),e.jsx(F,{onClick:()=>v("matterbridge-eve-room"),children:"matterbridge-eve-room"})]}),e.jsx(O,{title:"Install or update a plugin from npm",children:e.jsx(ae,{onClick:w,endIcon:e.jsx(He,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Install"})}),e.jsx(O,{title:"Upload and install a plugin from a tarball",children:e.jsx(ae,{onClick:E,endIcon:e.jsx(Tr,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Upload"})}),e.jsx(O,{title:"Add an installed plugin",children:e.jsx(ae,{onClick:c,endIcon:e.jsx(yt,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Add"})}),e.jsx("input",{id:"file-upload",type:"file",accept:".tgz",style:{display:"none"},onChange:A})]})}const an=o.memo(nn);function Ye({status:r,enabledText:d="Enabled",disabledText:a=void 0,tooltipText:n=void 0,onClick:s}){if(r===void 0)return null;{const g=e.jsx("div",{className:r?"status-enabled":"status-disabled",style:{cursor:"default"},onClick:s,children:r?d:a??d});return n!==void 0?e.jsx(O,{title:n,children:g}):g}}const Xe={fontSize:"16px",fontWeight:"bold",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},Ze={fontSize:"12px",fontWeight:"normal",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},sn={fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)",backgroundColor:"var(--div-bg-color)"},ln={fontSize:"16px",fontWeight:"bold",backgroundColor:"var(--div-bg-color)"},Ee={padding:"0px",margin:"0px"},dn="5px 10px 5px 10px",ht={},Se={},ft={},xt={};let bt=[],Jt=[];const cn=({open:r,onClose:d,plugin:a})=>{const{sendMessage:n,addListener:s,removeListener:g,getUniqueId:y}=o.useContext(be),t=o.useRef(y()),[l,D]=o.useState(a.configJson),[R,b]=o.useState(a.schemaJson),[L,A]=o.useState({"ui:submitButtonOptions":{submitText:"Confirm"},"ui:globalOptions":{orderable:!0}}),[w,E]=o.useState("");let c={};o.useEffect(()=>{const j=I=>{I.src==="Matterbridge"&&I.dst==="Frontend"&&(I.id===t.current&&I.method==="/api/select/devices"&&(I.response&&(bt=I.response),I.error&&console.error("ConfigPluginDialog received /api/select/devices error:",I.error)),I.id===t.current&&I.method==="/api/select/entities"&&(I.response&&(Jt=I.response),I.error&&console.error("ConfigPluginDialog received /api/select/entities error:",I.error)))};return s(j),l!==void 0&&R!==void 0&&(Object.keys(R.properties).forEach(I=>{Object.keys(R.properties[I]).forEach(P=>{P.startsWith("ui:")&&(L[I]={},L[I][P]=R.properties[I][P],delete R.properties[I][P])})}),A(L)),a.name!==void 0&&a.configJson!==void 0&&a.schemaJson!==void 0&&(D(a.configJson),b(a.schemaJson),n({id:t.current,sender:"ConfigPlugin",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:a.name}}),n({id:t.current,sender:"ConfigPlugin",method:"/api/select/entities",src:"Frontend",dst:"Matterbridge",params:{plugin:a.name}})),()=>{g(j)}},[s,l,a,g,R,n,L]);const z=({formData:j})=>{c=j},v=({formData:j})=>{D(j),a.configJson=j,a.restartRequired=!0,n({id:t.current,sender:"ConfigPlugin",method:"/api/savepluginconfig",src:"Frontend",dst:"Matterbridge",params:{pluginName:j.name,formData:j}}),d()};function x(j){const{id:I,label:P,onKeyChange:u,onDropPropertyClick:ie,disabled:Y,schema:ue,children:ge,registry:B,readonly:de,required:he}=j,{templates:ne}=B,{RemoveButton:ye}=ne.ButtonTemplates;if(!(zo in ue))return e.jsx(ee,{sx:{display:"flex",flexDirection:"column",flexGrow:1,padding:0,margin:0,border:"none"},children:ge});const fe=({target:Z})=>u(Z&&Z.value);return e.jsxs(ee,{sx:{display:"flex",flexDirection:"row",flexGrow:1,padding:0,margin:0,border:"none"},children:[e.jsx(pe,{id:`${I}-key`,name:`${I}-key`,required:he,disabled:Y||de,defaultValue:P,onBlur:de?void 0:fe,type:"text",variant:"outlined",sx:{width:"250px",minWidth:"250px",maxWidth:"250px",marginRight:"20px"}}),e.jsx(ee,{sx:{flex:1},children:ge}),e.jsx(ye,{disabled:Y||de,onClick:ie(P)})]})}function N(j){const{children:I,description:P,displayLabel:u,errors:ie,help:Y,hidden:ue,_id:ge,_label:B,registry:de,uiSchema:he}=j,ne=Ao(he),ye=Uo("WrapIfAdditionalTemplate",de,ne);return ue?e.jsx("div",{style:{display:"none"},children:I}):e.jsx(ee,{sx:{display:"flex",flexDirection:"column",flexGrow:1,padding:0,margin:0,border:"none"},children:e.jsxs(ye,{...j,children:[u===!0&&P,I,ie,Y]})})}function $(j){const{description:I}=j;return I?e.jsx(le,{sx:Ze,children:I}):null}function W(j){const{required:I,title:P}=j;return P?e.jsx(ee,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:e.jsxs(le,{sx:Xe,children:["Title ",P," ",I&&e.jsx("mark",{children:"***"})]})}):null}function m(j){const{help:I,_idSchema:P}=j;return I?e.jsx(ee,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:e.jsx(le,{sx:sn,children:I})}):null}function H(j){const{errors:I}=j;return I?e.jsxs(ee,{sx:{padding:"10px",margin:"10px",border:"1px solid grey"},children:[e.jsx(le,{color:"error",sx:ln,children:"Please fix the following errors:"}),e.jsx(it,{children:I.map((P,u)=>e.jsxs(Fr,{children:[e.jsx(K,{children:e.jsx(Lr,{color:"error"})}),e.jsx(oe,{primary:P.stack})]},u))})]}):null}function C(j){const{errors:I}=j;return I?e.jsx(ee,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:I.map((P,u)=>e.jsxs(le,{color:"error",variant:"body2",sx:{marginLeft:1},children:["This field ",P]},u))}):null}function f(j){const{id:I,name:P,_schema:u,_uiSchema:ie,value:Y,options:ue,label:ge,type:B,placeholder:de,required:he,disabled:ne,readonly:ye,autofocus:se,onChange:fe,onChangeOverride:Z,onBlur:me,onFocus:je,_rawErrors:Je,_hideError:Q,_registry:te,_formContext:De}=j,Le=({target:{value:Ce}})=>fe(Ce===""?ue.emptyValue:Ce),Re=({target:Ce})=>me(I,Ce&&Ce.value),Ue=({target:Ce})=>je(I,Ce&&Ce.value);return e.jsx(ee,{sx:{padding:"0px",margin:"0px"},children:e.jsx(pe,{id:I,name:I,label:de&&de!==""?ge:void 0,variant:"outlined",placeholder:de&&de!==""?de:ge,required:he,disabled:ne||ye,autoFocus:se,value:Y||Y===0?Y:"",type:B,autoComplete:B==="password"?"current-password":P,onChange:Z||Le,onBlur:Re,onFocus:Ue,fullWidth:!0})})}function M(j){return console.log("ArrayFieldTitleTemplate:",j),null}function q(j){return console.log("ArrayFieldDescriptionTemplate:",j),null}function ce(j){return console.log("ArrayFieldItemTemplate:",j),null}function ve(j){const{canAdd:I,_className:P,_disabled:u,_formContext:ie,_formData:Y,_idSchema:ue,_items:ge,onAddClick:B,_rawErrors:de,_readonly:he,_registry:ne,_required:ye,schema:se,title:fe,_uiSchema:Z}=j,[me,je]=o.useState(!1),[Je,Q]=o.useState(!1),[te,De]=o.useState(!1),[Le,Re]=o.useState(""),Ue=U=>{Re(U.target.value)},Ce=()=>{je(!me)},Qe=()=>{Q(!Je)},Ge=()=>{De(!te)},Mt=U=>{je(!1),se.selectFrom==="serial"?se.items.default=U.serial:se.selectFrom==="name"&&(se.items.default=U.name),B()},kt=U=>{Q(!1),se.selectEntityFrom==="name"?se.items.default=U.name:se.selectEntityFrom==="description"&&(se.items.default=U.description),B()},It=U=>{De(!1),se.selectDeviceEntityFrom==="name"?se.items.default=U.name:se.selectDeviceEntityFrom==="description"&&(se.items.default=U.description),B()};return e.jsxs(ee,{sx:{margin:"0px",padding:"5px 10px 5px 10px",border:"1px solid grey"},children:[fe&&e.jsxs(ee,{sx:{margin:"0px",padding:"0px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[fe&&e.jsx(le,{sx:Xe,children:fe}),I&&e.jsxs(ee,{sx:{margin:"0px",padding:"0px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[se.selectFrom&&e.jsx(O,{title:"Add a device from the list",children:e.jsx(J,{onClick:Ce,size:"small",color:"primary",sx:Ee,children:e.jsx(ct,{})})}),se.selectEntityFrom&&e.jsx(O,{title:"Add an entity from the list",children:e.jsx(J,{onClick:Qe,size:"small",color:"primary",sx:Ee,children:e.jsx(ct,{})})}),se.selectDeviceEntityFrom&&e.jsx(O,{title:"Add a device entity from the list",children:e.jsx(J,{onClick:Ge,size:"small",color:"primary",sx:Ee,children:e.jsx(ct,{})})}),e.jsx(O,{title:"Add a new item",children:e.jsx(J,{onClick:B,size:"small",color:"primary",sx:Ee,children:e.jsx(yt,{})})})]})]}),se.description&&e.jsx(le,{sx:Ze,children:se.description}),j.items.map(U=>e.jsxs(ee,{sx:{margin:"2px 0px",padding:"0px",display:"flex",alignItems:"center"},children:[e.jsx(ee,{sx:{flexGrow:1,marginRight:"10px"},children:U.children}),e.jsx(J,{disabled:!U.hasMoveUp,onClick:U.onReorderClick(U.index,U.index-1),size:"small",color:"primary",sx:Ee,children:e.jsx(Ht,{})}),e.jsx(J,{disabled:!U.hasMoveDown,onClick:U.onReorderClick(U.index,U.index+1),size:"small",color:"primary",sx:Ee,children:e.jsx(Rt,{})}),e.jsx(J,{onClick:U.onDropIndexClick(U.index),size:"small",color:"primary",sx:Ee,children:e.jsx(Ct,{})})]},U.index)),e.jsxs(Ne,{open:me,onClose:Ce,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(Pe,{children:"Select a device"}),e.jsxs(We,{children:[e.jsxs(ee,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(le,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(pe,{fullWidth:!0,variant:"outlined",value:Le,onChange:Ue,placeholder:"Enter serial or name"})]}),e.jsx(it,{dense:!0,children:bt.filter(U=>U.serial.toLowerCase().includes(Le.toLowerCase())||U.name.toLowerCase().includes(Le.toLowerCase())).map((U,ke)=>e.jsxs(pt,{onClick:()=>Mt(U),sx:ht,children:[U.icon==="wifi"&&e.jsx(K,{children:e.jsx(at,{style:Se})}),U.icon==="ble"&&e.jsx(K,{children:e.jsx(ut,{style:Se})}),U.icon==="hub"&&e.jsx(K,{children:e.jsx(mt,{style:Se})}),e.jsx(oe,{primary:U.name,secondary:U.serial,primaryTypographyProps:{style:ft},secondaryTypographyProps:{style:xt}})]},ke))})]}),e.jsx($e,{children:e.jsx(ae,{onClick:Ce,children:"Close"})})]}),e.jsxs(Ne,{open:Je,onClose:Qe,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(Pe,{children:"Select an entity"}),e.jsxs(We,{children:[e.jsxs(ee,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(le,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(pe,{fullWidth:!0,variant:"outlined",value:Le,onChange:Ue,placeholder:"Enter name or description"})]}),e.jsx(it,{dense:!0,children:Jt.filter(U=>U.name.toLowerCase().includes(Le.toLowerCase())||U.description.toLowerCase().includes(Le.toLowerCase())).map((U,ke)=>e.jsxs(pt,{onClick:()=>kt(U),sx:ht,children:[U.icon==="wifi"&&e.jsx(K,{children:e.jsx(at,{style:Se})}),U.icon==="ble"&&e.jsx(K,{children:e.jsx(ut,{style:Se})}),U.icon==="hub"&&e.jsx(K,{children:e.jsx(mt,{style:Se})}),U.icon==="component"&&e.jsx(K,{children:e.jsx($t,{style:Se})}),U.icon==="matter"&&e.jsx(K,{children:e.jsx(Ot,{style:Se})}),e.jsx(oe,{primary:U.name,secondary:U.description,primaryTypographyProps:{style:ft},secondaryTypographyProps:{style:xt}})]},ke))})]}),e.jsx($e,{children:e.jsx(ae,{onClick:Qe,children:"Close"})})]}),e.jsxs(Ne,{open:te,onClose:Ge,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsxs(Pe,{children:["Select an entity for ",fe]}),e.jsx(We,{children:e.jsx(it,{dense:!0,children:bt.filter(U=>U.serial===fe||U.name===fe).map(U=>U.entities?.map((ke,Dt)=>e.jsxs(pt,{onClick:()=>It(ke),sx:ht,children:[ke.icon==="wifi"&&e.jsx(K,{children:e.jsx(at,{style:Se})}),ke.icon==="ble"&&e.jsx(K,{children:e.jsx(ut,{style:Se})}),ke.icon==="hub"&&e.jsx(K,{children:e.jsx(mt,{style:Se})}),ke.icon==="component"&&e.jsx(K,{children:e.jsx($t,{style:Se})}),ke.icon==="matter"&&e.jsx(K,{children:e.jsx(Ot,{style:Se})}),e.jsx(oe,{primary:ke.name,secondary:ke.description,primaryTypographyProps:{style:ft},secondaryTypographyProps:{style:xt}})]},Dt)))})}),e.jsx($e,{children:e.jsx(ae,{onClick:Ge,children:"Close"})})]})]})}function S(j){const{onAddClick:I,schema:P,properties:u,title:ie,description:Y}=j,[ue,ge]=o.useState(!1),[B,de]=o.useState(""),he=Z=>{de(Z.target.value)},ne=()=>{ge(!ue)},ye=Z=>{ge(!1);let me="";P.selectFrom==="serial"?me=Z.serial:P.selectFrom==="name"&&(me=Z.name),E(me),I(P)()},se=()=>{I(P)()},fe=!P.additionalProperties;return!fe&&w!==""&&u.forEach(Z=>{if(Z.name==="newKey"&&Z.content.key==="newKey"&&Z.content.props.name==="newKey"&&Z.content.props.onKeyChange&&w!==""){const me=w;E(""),Z.content.props.onKeyChange(me)}}),e.jsxs(ee,{sx:{margin:"0px",padding:fe?"10px":"5px 10px 0px 10px",border:fe?"none":"1px solid grey"},children:[P.title&&fe&&e.jsx(ee,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px",marginBottom:"10px"},children:e.jsx(le,{sx:Xe,children:P.title})}),ie&&!fe&&e.jsxs(ee,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px"},children:[e.jsx(le,{sx:Xe,children:ie}),e.jsxs(ee,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px"},children:[P.selectFrom&&e.jsx(O,{title:"Add a device from the list",children:e.jsx(J,{onClick:ne,size:"small",color:"primary",sx:Ee,children:e.jsx(ct,{})})}),e.jsx(O,{title:"Add a new item",children:e.jsx(J,{onClick:se,size:"small",color:"primary",sx:Ee,children:e.jsx(yt,{})})})]})]}),P.description&&e.jsx(ee,{sx:{padding:"0px",margin:"0px",marginBottom:"10px"},children:e.jsx(le,{sx:Ze,children:P.description})}),u.map(({content:Z,name:me,hidden:je})=>!je&&e.jsxs(ee,{sx:{margin:"0px",marginBottom:"10px",padding:["object","array","boolean"].includes(P.properties[me].type)?"0px":dn,border:["object","array","boolean"].includes(P.properties[me].type)?"none":"1px solid grey"},children:[!["object","array","boolean"].includes(P.properties[me].type)&&e.jsx(le,{sx:Xe,children:me}),e.jsx(ee,{sx:{flexGrow:1,padding:"0px",margin:"0px"},children:Z})]},me)),e.jsxs(Ne,{open:ue,onClose:ne,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(Pe,{children:"Select a device"}),e.jsxs(We,{children:[e.jsxs(ee,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(le,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(pe,{fullWidth:!0,variant:"outlined",value:B,onChange:he,placeholder:"Enter serial or name"})]}),e.jsx(it,{dense:!0,children:bt.filter(Z=>Z.serial.toLowerCase().includes(B.toLowerCase())||Z.name.toLowerCase().includes(B.toLowerCase())).map((Z,me)=>e.jsxs(pt,{onClick:()=>ye(Z),sx:ht,children:[Z.icon==="wifi"&&e.jsx(K,{children:e.jsx(at,{style:Se})}),Z.icon==="ble"&&e.jsx(K,{children:e.jsx(ut,{style:Se})}),Z.icon==="hub"&&e.jsx(K,{children:e.jsx(mt,{style:Se})}),e.jsx(oe,{primary:Z.name,secondary:Z.serial,primaryTypographyProps:{style:ft},secondaryTypographyProps:{style:xt}})]},me))})]}),e.jsx($e,{children:e.jsx(ae,{onClick:ne,children:"Close"})})]})]})}function p(j){const{uiSchema:I}=j,{submitText:P,norender:u}=_o(I);return u?null:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",margin:"10px",padding:"0px",gap:"20px"},children:[e.jsx(ae,{type:"submit",variant:"contained",color:"primary",children:P}),e.jsx(ae,{variant:"contained",color:"primary",onClick:d,children:"Cancel"})]})}function V(j){const{className:I,disabled:P,onClick:u,registry:ie,style:Y,uiSchema:ue,...ge}=j;return e.jsx(O,{title:"Remove the item",children:e.jsx(J,{disabled:P,size:"small",color:"primary",onClick:u,children:e.jsx(Ct,{})})})}function k(j){const{className:I,disabled:P,onClick:u,registry:ie,uiSchema:Y,...ue}=j;return e.jsx(O,{title:"Add an item",children:e.jsx(J,{size:"small",color:"primary",onClick:u,children:e.jsx(yt,{})})})}function X(j){const{disabled:I,onClick:P,registry:u,style:ie,uiSchema:Y,...ue}=j;return e.jsx(O,{title:"Move up the item",children:e.jsx(J,{size:"small",color:"primary",onClick:P,children:e.jsx(Ht,{})})})}function T(j){const{disabled:I,onClick:P,registry:u,style:ie,uiSchema:Y,...ue}=j;return e.jsx(O,{title:"Move down the item",children:e.jsx(J,{size:"small",color:"primary",onClick:P,children:e.jsx(Rt,{})})})}function _(j){const{id:I,name:P,value:u,schema:ie,readonly:Y,onChange:ue}=j,[ge,B]=o.useState(void 0),de=ne=>{B(ne&&ne!==""?ne:void 0)},he=()=>{n({id:t.current,sender:"ConfigPlugin",method:"/api/action",src:"Frontend",dst:"Matterbridge",params:{plugin:a.name,action:P,value:ge,formData:c,id:I}}),ie.buttonClose===!0?d():ie.buttonSave===!0&&v({formData:l})};return ie.buttonText&&ie.description?e.jsxs(ee,{sx:{margin:"0px",padding:"10px",border:"1px solid grey",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(le,{sx:Ze,children:ie.description}),e.jsx(ae,{variant:"contained",color:"primary",onClick:()=>he(),children:ie.buttonText})]}):ie.buttonField&&ie.description?e.jsxs(ee,{sx:{margin:"0px",padding:"10px",gap:"20px",border:"1px solid grey",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(le,{sx:Ze,children:ie.description}),e.jsx(pe,{id:P+"-input",name:P,label:ie.textLabel,placeholder:ie.textPlaceholder,onChange:ne=>de(ne.target.value),sx:{width:"250px",minWidth:"250px",maxWidth:"250px"}}),e.jsx(ae,{id:P+"-button",variant:"contained",color:"primary",disabled:ge===void 0,onClick:()=>he(),children:ie.buttonField})]}):e.jsxs(ee,{sx:{margin:"0px",padding:"5px 10px",border:"1px solid grey"},children:[P&&e.jsxs(ee,{sx:{margin:"0px",padding:"0px",gap:"10px",display:"flex",justifyContent:"flex-start",alignItems:"center"},children:[e.jsx(le,{sx:Xe,children:P}),e.jsx(Fe,{checked:u,readOnly:Y,onChange:()=>ue(!u),sx:{padding:"0px",margin:"0px"}})]}),ie.description&&e.jsx(le,{sx:Ze,children:ie.description})]})}function h({schema:j,id:I,name:P,options:u,label:ie,hideLabel:Y,required:ue,disabled:ge,placeholder:B,readonly:de,value:he,multiple:ne,autofocus:ye,onChange:se,onBlur:fe,onFocus:Z,errorSchema:me,rawErrors:je=[],registry:Je,uiSchema:Q,hideError:te,formContext:De,...Le}){const{enumOptions:Re,enumDisabled:Ue,emptyValue:Ce}=u;ne=typeof ne>"u"?!1:!!ne;const Qe=ne?[]:"",Ge=typeof he>"u"||ne&&he.length<1||!ne&&he===Qe,Mt=({target:{value:Oe}})=>se(Pt(Oe,Re,Ce)),kt=({target:Oe})=>fe(I,Pt(Oe&&Oe.value,Re,Ce)),It=({target:Oe})=>Z(I,Pt(Oe&&Oe.value,Re,Ce)),U=Eo(he,Re,ne),{InputLabelProps:ke,SelectProps:Dt,autocomplete:ur,...mr}=Le,gr=!ne&&j.default===void 0;return e.jsxs(pe,{id:I,name:I,value:!Ge&&typeof U<"u"?U:Qe,required:ue,disabled:ge||de,autoFocus:ye,autoComplete:ur,placeholder:B,error:je.length>0,onChange:Mt,onBlur:kt,onFocus:It,...mr,select:!0,InputLabelProps:{...ke,shrink:!Ge},SelectProps:{...Dt,multiple:ne},"aria-describedby":Vo(I),children:[gr&&e.jsx(F,{value:"",children:B}),Array.isArray(Re)&&Re.map(({value:Oe,label:hr},Lt)=>{const fr=Array.isArray(Ue)&&Ue.indexOf(Oe)!==-1;return e.jsx(F,{value:String(Lt),disabled:fr,children:hr},Lt)})]})}return!r||!R||!l?null:e.jsxs(Ne,{open:r,onClose:d,maxWidth:"800px",children:[e.jsx(Pe,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h3",{children:"Matterbridge plugin configuration"})]})}),e.jsx(We,{style:{padding:"0px",margin:"0px",width:"800px",height:"600px",overflow:"auto"},children:e.jsx($o,{schema:R,formData:l,uiSchema:L,validator:Oo,templates:{FieldTemplate:N,BaseInputTemplate:f,TitleFieldTemplate:W,DescriptionFieldTemplate:$,FieldHelpTemplate:m,FieldErrorTemplate:C,ErrorListTemplate:H,WrapIfAdditionalTemplate:x,ArrayFieldTitleTemplate:M,ArrayFieldDescriptionTemplate:q,ArrayFieldItemTemplate:ce,ArrayFieldTemplate:ve,ObjectFieldTemplate:S,ButtonTemplates:{SubmitButton:p,RemoveButton:V,AddButton:k,MoveUpButton:X,MoveDownButton:T}},widgets:{CheckboxWidget:_,SelectWidget:h},onChange:z,onSubmit:v})})]})};function ar(r){if(i&&console.log(`getQRColor (id: ${r?.id}) received matter:`,r??"undefined"),r===void 0||!r.online||!r.qrPairingCode&&!r.manualPairingCode&&!r.fabricInformations&&!r.sessionInformations)return"red";if(r.commissioned===!1&&r.qrPairingCode&&r.manualPairingCode)return"var(--primary-color)";let d=0,a=0;for(const n of r.sessionInformations??[])n.fabric&&n.isPeerActive===!0&&d++,n.numberOfActiveSubscriptions>0&&(a+=n.numberOfActiveSubscriptions);return r.commissioned===!0&&r.fabricInformations&&r.sessionInformations&&(d===0||a===0)?"var(--secondary-color)":"var(--div-text-color)"}function pn(r,d,a){const n=r?.[a],s=d?.[a];return n==null&&s==null?0:n==null?-1:s==null?1:typeof n=="boolean"&&typeof s=="boolean"?n===s?0:n?1:-1:typeof n=="number"&&typeof s=="number"?n-s:String(n).localeCompare(String(s))}function un({name:r,columns:d,rows:a,getRowKey:n,footerLeft:s,footerRight:g}){const y=o.useRef(new WeakMap),t=o.useRef(1),l=m=>{if(typeof n=="string"&&m&&m[n]!=null)return m[n];if(typeof n=="function"){const f=n(m);if(f!=null)return f}const H=d?.[0]?.id;if(H&&m&&m[H]!=null)return m[H];console.warn(`MbfTable(${r}): using fallback stable row key; consider providing getRowKey prop for better React performance`);let C=y.current.get(m);return C||(C=`rk_${t.current++}`,y.current.set(m,C)),C},[D,R]=o.useState(localStorage.getItem(`${r}_table_order_by`)||null),[b,L]=o.useState(localStorage.getItem(`${r}_table_order`)||null),[A,w]=o.useState(!1),[E,c]=o.useState(()=>{try{const m=localStorage.getItem(`${r}_column_visibility`);if(m)return JSON.parse(m)}catch{}return{}}),z=o.useMemo(()=>{const m={};for(const H of d)H.hidden||(m[H.id]=H.required?!0:E[H.id]!==!1);return m},[d,E]),v=o.useMemo(()=>{if(!D||!b)return a;const m=d.find(C=>C.id===D);if(!m||m.nosort)return a;const H=a.map((C,f)=>({el:C,index:f}));return H.sort((C,f)=>{const M=pn(C.el,f.el,D);return M!==0?b==="asc"?M:-M:C.index-f.index}),H.map(C=>C.el)},[a,D,b,d]),x=m=>{if(D!==m||!D){R(m),L("asc"),localStorage.setItem(`${r}_table_order_by`,m),localStorage.setItem(`${r}_table_order`,"asc");return}if(b==="asc"){L("desc"),localStorage.setItem(`${r}_table_order`,"desc");return}R(null),L(null),localStorage.removeItem(`${r}_table_order_by`),localStorage.removeItem(`${r}_table_order`)},N=()=>{w(!A)},$=m=>{c(H=>{const C=d.find(q=>q.id===m);if(C&&C.required)return H;const f=z[m]!==!1,M={...H};f?M[m]=!1:delete M[m];try{localStorage.setItem(`${r}_column_visibility`,JSON.stringify(M))}catch{}return M})},W=()=>{c({});try{localStorage.removeItem(`${r}_column_visibility`)}catch{}w(!1)};return i&&console.log(`Rendering table ${r}${D&&b?` ordered by ${D}:${b}`:""}`),e.jsxs("div",{style:{display:"flex",flexDirection:"column",margin:"0",padding:"0",gap:"0",width:"100%",flex:"1 1 auto",height:"100%",minHeight:0,overflow:"hidden"},children:[e.jsxs(Ne,{open:A,onClose:(m,H)=>{H==="backdropClick"||H==="escapeKeyDown"||N()},disableEscapeKeyDown:!0,disableRestoreFocus:!0,children:[e.jsx(Pe,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:`Configure ${r} columns`})]})}),e.jsx(We,{children:e.jsx(St,{children:d.filter(m=>!m.hidden).map(m=>e.jsx(Te,{control:e.jsx(Fe,{disabled:!!m.required,checked:m.required?!0:z[m.id]!==!1,onChange:()=>$(m.id)}),label:m.label},m.id))})}),e.jsxs($e,{children:[e.jsx(ae,{onClick:W,children:"Reset"}),e.jsx(ae,{variant:"contained",onClick:m=>{if(m?.currentTarget&&typeof m.currentTarget.blur=="function")try{m.currentTarget.blur()}catch{}const H=document.activeElement;if(H&&H instanceof HTMLElement&&typeof H.blur=="function")try{H.blur()}catch{}N()},children:"Close"})]})]}),e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",minHeight:"30px",justifyContent:"space-between",borderBottom:"none"},children:[e.jsx("p",{className:"MbfWindowHeaderText",children:r}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(J,{onClick:m=>{if(m?.currentTarget?.blur)try{m.currentTarget.blur()}catch{}N()},"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(O,{title:`Configure ${r} columns`,children:e.jsx(re,{path:bo,size:"20px",style:{color:"var(--header-text-color)"}})})})})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",flex:"1 1 auto",minHeight:0,width:"100%",overflow:"auto",margin:"0px",padding:"0px",gap:"0"},children:e.jsxs("table",{"aria-label":`${r} table`,style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,border:"none",color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color"},children:e.jsx("tr",{style:{height:"30px",minHeight:"30px"},children:d.map(m=>{if(m.hidden||!m.required&&z[m.id]===!1)return null;const H=!m.nosort,C=H&&D===m.id&&!!b;return e.jsxs("th",{onClick:H?()=>x(m.id):void 0,style:{margin:"0",padding:"5px 10px",position:"sticky",top:0,minWidth:m.minWidth,maxWidth:m.maxWidth,textAlign:m.align||"left",cursor:H?"pointer":"default",border:"none",color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color)",whiteSpace:m.maxWidth?"nowrap":void 0,overflow:m.maxWidth?"hidden":void 0,textOverflow:m.maxWidth?"ellipsis":void 0},"aria-sort":H?C?b==="asc"?"ascending":"descending":"none":void 0,children:[m.label,C&&e.jsxs("span",{style:{marginLeft:6},children:[b==="asc"&&e.jsx(re,{path:Tt,size:"15px"}),b==="desc"&&e.jsx(re,{path:Ft,size:"15px"})]})]},m.id)})})}),e.jsx("tbody",{children:v.map((m,H)=>{const C=l(m);return e.jsx("tr",{className:H%2===0?"table-content-even":"table-content-odd",style:{height:"30px",minHeight:"30px",border:"none",borderCollapse:"collapse"},children:d.map(f=>{if(f.hidden||!f.required&&z[f.id]===!1)return null;const M=m[f.id];return e.jsx("td",{style:{border:"none",borderCollapse:"collapse",textAlign:f.align||"left",padding:"5px 10px",margin:"0",maxWidth:f.maxWidth,whiteSpace:f.maxWidth?"nowrap":void 0,overflow:f.maxWidth?"hidden":void 0,textOverflow:f.maxWidth?"ellipsis":void 0},children:typeof f.render=="function"?f.render(M,C,m,f):typeof M=="boolean"?e.jsx(Fe,{checked:M,disabled:!0,size:"small",sx:{m:0,p:0,color:"var(--table-text-color)","&.Mui-disabled":{color:"var(--table-text-color)",opacity:.7}}}):f.format&&typeof M=="number"?f.format(M):M!=null?String(M):null},f.id)})},C)})})]})}),(s||g)&&e.jsxs("div",{className:"MbfWindowFooter",style:{height:"30px",minHeight:"30px",justifyContent:"space-between",border:"none"},children:[e.jsx("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)"},children:s}),e.jsx("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)"},children:g})]})]})}function mn(r){return o.memo(r)}const sr=mn(un);function gn({storeId:r,setStoreId:d}){const{online:a,sendMessage:n,addListener:s,removeListener:g,getUniqueId:y}=o.useContext(be),{showConfirmCancelDialog:t}=o.useContext(nt),l=o.useRef(y()),[D,R]=o.useState(null),[b,L]=o.useState(null),[A,w]=o.useState([]),E=[{label:"Name",id:"name",required:!0,render:(T,_,h,j)=>e.jsx(O,{title:"Open the plugin homepage",children:e.jsx("span",{style:{cursor:"pointer"},onClick:()=>C(h),children:h.name})})},{label:"Description",id:"description",render:(T,_,h,j)=>e.jsx(O,{title:"Open the plugin homepage",children:e.jsx("span",{style:{cursor:"pointer"},onClick:()=>C(h),children:h.description})})},{label:"Version",id:"version",render:(T,_,h,j)=>e.jsxs(e.Fragment,{children:[h.latestVersion!==void 0&&h.latestVersion!==h.version&&b&&!b.readOnly&&e.jsx(O,{title:"New plugin stable version available, click to install",children:e.jsxs("span",{className:"status-warning",style:{marginRight:"10px"},onClick:()=>N(h),children:["Update to v.",h.latestVersion]})}),h.version.includes("-dev-")&&h.devVersion!==void 0&&h.devVersion!==h.version&&b&&!b.readOnly&&e.jsx(O,{title:"New plugin dev version available, click to install",children:e.jsxs("span",{className:"status-warning",style:{marginRight:"10px"},onClick:()=>$(h),children:["Update to new dev v.",h.devVersion.split("-dev-")[0]]})}),e.jsx(O,{title:"Plugin version",children:e.jsx("span",{children:h.version})})]})},{label:"Author",id:"author",render:(T,_,h,j)=>e.jsx(e.Fragment,{children:h.author?h.author.replace("https://github.com/",""):"Unknown"})},{label:"Type",id:"type",render:(T,_,h,j)=>e.jsx(e.Fragment,{children:h.type?h.type.replace("Platform",""):"Unknown"})},{label:"Devices",id:"registeredDevices"},{label:"Actions",id:"actions",required:!0,render:(T,_,h,j)=>e.jsxs("div",{style:{margin:"0px",padding:"0px",gap:"4px",display:"flex",flexDirection:"row"},children:[b&&b.bridgeMode==="childbridge"&&!h.error&&h.enabled&&e.jsx(O,{title:"Shows the QRCode or the fabrics",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(J,{style:{margin:"0",padding:"0",width:"19px",height:"19px",color:ar(h.matter)},onClick:()=>{h.matter?.id&&d(h.matter?.id)},size:"small",children:e.jsx(er,{})})}),b&&b.bridgeMode==="childbridge"&&!h.error&&h.enabled&&e.jsx(O,{title:"Restart the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(J,{style:{margin:"0",padding:"0",width:"19px",height:"19px"},onClick:()=>m(h),size:"small",children:e.jsx(vt,{})})}),e.jsx(O,{title:"Plugin config",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(J,{disabled:h.restartRequired===!0,style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>V(h),size:"small",children:e.jsx(rt,{})})}),b&&!b.readOnly&&e.jsx(O,{title:"Remove the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(J,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>{z("Remove plugin","Are you sure? This will also remove all devices and configuration from the controller.","remove",h)},size:"small",children:e.jsx(Ct,{})})}),h.enabled?e.jsx(O,{title:"Disable the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(J,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>{z("Disable plugin","Are you sure? This will also remove all devices and configuration from the controller.","disable",h)},size:"small",children:e.jsx(Rr,{})})}):e.jsx(e.Fragment,{}),h.enabled?e.jsx(e.Fragment,{}):e.jsx(O,{title:"Enable the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(J,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>H(h),size:"small",children:e.jsx(Hr,{})})}),e.jsx(O,{title:"Open the plugin help",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(J,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>M(h),size:"small",children:e.jsx($r,{})})}),e.jsx(O,{title:"Open the plugin version history",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(J,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>q(h),size:"small",children:e.jsx(Or,{})})}),b&&!b.readOnly&&e.jsx(O,{title:"Sponsor the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(J,{style:{margin:"0",padding:"0",width:"19px",height:"19px",color:"#b6409c"},onClick:()=>f(h),size:"small",children:e.jsx(Xt,{})})})]})},{label:"Status",id:"status",required:!0,render:(T,_,h,j)=>e.jsx("div",{style:{display:"flex",flexDirection:"row",flex:"1 1 auto",margin:"0",padding:"0",gap:"5px",width:"auto",maxWidth:"max-content"},children:h.error?e.jsx(e.Fragment,{children:e.jsx(Ye,{status:!1,enabledText:"Error",disabledText:"Error",tooltipText:"The plugin is in error state. Check the log!"})}):e.jsx(e.Fragment,{children:h.enabled===!1?e.jsx(e.Fragment,{children:e.jsx(Ye,{status:h.enabled,enabledText:"Enabled",disabledText:"Disabled",tooltipText:"Whether the plugin is enable or disabled"})}):e.jsx(e.Fragment,{children:h.loaded&&h.started&&h.configured?e.jsx(e.Fragment,{children:e.jsx(Ye,{status:h.loaded,enabledText:"Running",tooltipText:"Whether the plugin is running"})}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{status:h.loaded,enabledText:"Loaded",tooltipText:"Whether the plugin has been loaded"}),e.jsx(Ye,{status:h.started,enabledText:"Started",tooltipText:"Whether the plugin started"}),e.jsx(Ye,{status:h.configured,enabledText:"Configured",tooltipText:"Whether the plugin has been configured"})]})})})})}];o.useEffect(()=>{const T=_=>{_.src==="Matterbridge"&&_.dst==="Frontend"&&(xe(_)&&_.method==="refresh_required"&&_.params.changed==="plugins"&&(i&&console.log(`HomePlugins received refresh_required: changed=${_.params.changed} and sending /api/plugins request`),n({id:l.current,sender:"HomePlugins",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})),xe(_)&&_.method==="refresh_required"&&_.params.changed==="matter"&&(i&&console.log(`HomePlugins received refresh_required: changed=${_.params.changed} and setting matter id ${_.params.matter?.id}`),w(h=>{const j=h.findIndex(P=>P.matter?.id===_.params.matter?.id);if(j<0)return i&&console.log(`HomePlugins received refresh_required: changed=${_.params.changed} and matter id ${_.params.matter?.id} not found`),h;i&&console.log(`HomePlugins received refresh_required: changed=${_.params.changed} set matter id ${_.params.matter?.id}`);const I=[...h];return I[j]={...I[j],matter:_.params.matter},I})),xe(_)&&_.method==="refresh_required"&&_.params.changed==="settings"&&(i&&console.log(`HomePlugins received refresh_required: changed=${_.params.changed} and sending /api/settings request`),n({id:l.current,sender:"HomePlugins",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),Ve(_)&&_.id===l.current&&_.method==="/api/settings"&&(i&&console.log(`HomePlugins (id: ${_.id}) received settings:`,_.response),R(_.response.systemInformation),L(_.response.matterbridgeInformation)),Ve(_)&&_.id===l.current&&_.method==="/api/plugins"&&(i&&console.log(`HomePlugins (id: ${_.id}) received ${_.response.length} plugins:`,_.response),w(_.response)))};return s(T),i&&console.log("HomePlugins added WebSocket listener id:",l.current),()=>{g(T),i&&console.log("HomePlugins removed WebSocket listener")}},[s,g,n]),o.useEffect(()=>{a&&(i&&console.log("HomePlugins sending api requests"),n({id:l.current,sender:"HomePlugins",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),n({id:l.current,sender:"HomePlugins",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[a,n]);const c=o.useRef(null),z=(T,_,h,j)=>{i&&console.log(`handleActionWithConfirmCancel ${h} ${j.name}`),c.current=j,t(T,_,h,v,x)},v=T=>{i&&console.log(`handleConfirm action confirmed ${T} ${c.current?.name}`),T==="remove"&&c.current?W(c.current):T==="disable"&&c.current&&H(c.current),c.current=null},x=T=>{i&&console.log(`handleCancel action canceled ${T} ${c.current?.name}`),c.current=null},N=T=>{i&&console.log("handleUpdatePlugin plugin:",T.name),n({id:l.current,sender:"HomePlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:T.name,restart:!1}})},$=T=>{i&&console.log("handleUpdateDevPlugin plugin:",T.name),n({id:l.current,sender:"HomePlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:T.name+"@dev",restart:!1}})},W=T=>{i&&console.log("handleRemovePlugin plugin:",T.name),n({id:l.current,sender:"HomePlugins",method:"/api/removeplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:T.name}})},m=T=>{i&&console.log("handleRestartPlugin plugin:",T.name),n({id:l.current,sender:"HomePlugins",method:"/api/restartplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:T.name}})},H=T=>{i&&console.log("handleEnableDisablePlugin plugin:",T.name,"enabled:",T.enabled),T.enabled===!0?(T.enabled=!1,n({id:l.current,sender:"HomePlugins",method:"/api/disableplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:T.name}})):(T.enabled=!0,n({id:l.current,sender:"HomePlugins",method:"/api/enableplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:T.name}}))},C=T=>{i&&console.log(`handleHomepagePlugin plugin: ${T.name} homepage: ${T.homepage}`),T.homepage&&window.open(T.homepage,"_blank")},f=T=>{i&&console.log("handleSponsorPlugin plugin:",T.name,"funding:",T.funding),T.funding&&window.open(T.funding,"_blank")},M=T=>{i&&console.log("handleHelpPlugin plugin:",T.name,"help:",T.help),T.help&&window.open(T.help,"_blank")},q=T=>{i&&console.log("handleChangelogPlugin plugin:",T.name,"changelog:",T.changelog),T.changelog&&window.open(T.changelog,"_blank")},[ce,ve]=o.useState({}),[S,p]=o.useState(!1),V=T=>{i&&console.log("handleConfigPlugin plugin:",T.name),n({id:l.current,sender:"HomePlugins",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:T.name}}),n({id:l.current,sender:"HomePlugins",method:"/api/select/entities",src:"Frontend",dst:"Matterbridge",params:{plugin:T.name}}),ve(T),k()},k=()=>{p(!0)},X=()=>{p(!1)};return i&&console.log("HomePlugins rendering..."),a?e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",width:"100%",flex:"0 0 auto",overflow:"hidden"},children:[e.jsx(cn,{open:S,onClose:X,plugin:ce}),e.jsx(sr,{name:"Plugins",columns:E,rows:A,footerRight:"",footerLeft:""})]}):e.jsx(Be,{})}const hn=o.memo(gn),fn=r=>`${r.pluginName}::${r.serial}`;function xn({data:r,columns:d,columnVisibility:a}){const n=o.useMemo(()=>{const b=localStorage.getItem("homeDevicesColumnsSortBy");return b?JSON.parse(b):[{id:"name",desc:!1}]},[d]),s=o.useMemo(()=>d.filter(b=>a[b.accessor]),[a,d]),{getTableProps:g,getTableBodyProps:y,headerGroups:t,rows:l,prepareRow:D,state:{sortBy:R}}=ot.useTable({columns:s,data:r,getRowId:fn,initialState:{sortBy:n}},ot.useSortBy);return o.useEffect(()=>{localStorage.setItem("homeDevicesColumnsSortBy",JSON.stringify(R))},[R]),e.jsxs("table",{...g(),style:{border:"none",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{border:"none",borderCollapse:"collapse"},children:t.map(b=>e.jsx("tr",{...b.getHeaderGroupProps(),style:{border:"none",borderCollapse:"collapse"},children:b.headers.map(L=>e.jsxs("th",{...L.getHeaderProps(L.noSort?void 0:L.getSortByToggleProps()),style:{border:"none",borderCollapse:"collapse",cursor:L.noSort?"default":"pointer"},children:[L.render("Header"),!L.noSort&&e.jsx("span",{style:{margin:"0px",marginLeft:"5px",padding:"0px"},children:L.isSorted?L.isSortedDesc?e.jsx(re,{path:Ft,size:"15px"}):e.jsx(re,{path:Tt,size:"15px"}):null})]}))}))}),e.jsx("tbody",{...y(),style:{border:"none",borderCollapse:"collapse"},children:l.map((b,L)=>(D(b),e.jsx("tr",{className:L%2===0?"table-content-even":"table-content-odd",...b.getRowProps(),style:{border:"none",borderCollapse:"collapse"},children:b.cells.map(A=>e.jsx("td",{...A.getCellProps(),style:{border:"none",borderCollapse:"collapse"},children:A.render("Cell")}))})))})]})}function bn({storeId:r,setStoreId:d}){const{online:a,sendMessage:n,addListener:s,removeListener:g,getUniqueId:y}=o.useContext(be),[t,l]=o.useState(!1),[D,R]=o.useState(!0),[b,L]=o.useState(null),[A,w]=o.useState([]),[E,c]=o.useState([]),[z,v]=o.useState([]),[x,N]=o.useState([]),[$,W]=o.useState(!1),[m,H]=o.useState({pluginName:!0,name:!0,serial:!0,reachable:!0,powerSource:!0,configUrl:!1,actions:!0}),C=o.useRef(y()),f=[{Header:"Plugin",accessor:"pluginName"},{Header:"Name",accessor:"name"},{Header:"Serial",accessor:"serial"},{Header:"Availability",accessor:"reachable",Cell:({row:S})=>S.original.reachable===!0?"Online":S.original.reachable===!1?e.jsx("span",{style:{color:"red"},children:"Offline"}):"",sortType:(S,p)=>{const V=S.original.reachable===!0?1:S.original.reachable===!1?0:-1,k=p.original.reachable===!0?1:p.original.reachable===!1?0:-1;return V-k}},{Header:"Power",accessor:"powerSource",Cell:({row:S})=>S.original.powerSource==="ac"||S.original.powerSource==="dc"?e.jsx(tr,{fontSize:"small",sx:{color:"var(--primary-color)"}}):S.original.powerSource==="ok"?e.jsx(jt,{fontSize:"small",sx:{color:"green"}}):S.original.powerSource==="warning"?e.jsx(jt,{fontSize:"small",sx:{color:"yellow"}}):S.original.powerSource==="critical"?e.jsx(jt,{fontSize:"small",sx:{color:"red"}}):e.jsx("span",{})},{Header:"Url",accessor:"configUrl"},{Header:"Actions",accessor:"actions",noSort:!0,Cell:({row:S})=>e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[S.original.matter!==void 0?e.jsx(O,{title:"Show the QRCode or the fabrics",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(J,{onClick:()=>d(r===S.original.matter.id?b.matterbridgeInformation.bridgeMode==="bridge"?"Matterbridge":null:S.original.matter.id),"aria-label":"Show the QRCode",sx:{margin:0,padding:0,color:ar(S.original.matter)},children:e.jsx(er,{fontSize:"small"})})}):e.jsx("div",{style:{width:"20px",height:"20px"}}),S.original.configUrl?e.jsx(O,{title:"Open the configuration page",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(J,{onClick:()=>window.open(S.original.configUrl,"_blank"),"aria-label":"Open config url",sx:{margin:0,padding:0},children:e.jsx(rt,{fontSize:"small"})})}):e.jsx("div",{style:{width:"20px",height:"20px"}}),S.original.selected!==void 0?e.jsx(O,{title:"Select/unselect the device",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Fe,{checked:S.original.selected,onChange:p=>ve(p,S.original),sx:{margin:"0",marginLeft:"8px",padding:"0"},size:"small"})}):e.jsx("div",{style:{width:"20px",height:"20px"}})]})}],M=o.useCallback(S=>{S.selected=void 0;const p=A.find(X=>X.name===S.pluginName);if(!p)return console.error(`HomeDevices isSelected: plugin ${S.pluginName} not found for device ${S.deviceName} `),S.selected;const V=p.schemaJson?.properties?.whiteList?.selectFrom;let k=p.configJson?.postfix;return k===""&&(k=void 0),p.hasWhiteList===!0&&p.hasBlackList===!0&&V&&(S.selected=!0,V==="serial"&&p.configJson.whiteList&&p.configJson.whiteList.length>0&&p.configJson.whiteList.includes(k?S.serial.replace("-"+k,""):S.serial)&&(S.selected=!0),V==="serial"&&p.configJson.whiteList&&p.configJson.whiteList.length>0&&!p.configJson.whiteList.includes(k?S.serial.replace("-"+k,""):S.serial)&&(S.selected=!1),V==="serial"&&p.configJson.blackList&&p.configJson.blackList.length>0&&p.configJson.blackList.includes(k?S.serial.replace("-"+k,""):S.serial)&&(S.selected=!1),V==="name"&&p.configJson.whiteList&&p.configJson.whiteList.length>0&&p.configJson.whiteList.includes(S.name)&&(S.selected=!0),V==="name"&&p.configJson.whiteList&&p.configJson.whiteList.length>0&&!p.configJson.whiteList.includes(S.name)&&(S.selected=!1),V==="name"&&p.configJson.blackList&&p.configJson.blackList.length>0&&p.configJson.blackList.includes(S.name)&&(S.selected=!1)),S.selected},[A]);o.useEffect(()=>{const S=p=>{if(p.src==="Matterbridge"&&p.dst==="Frontend"){if(p.method==="refresh_required"&&p.params.changed!=="matter"&&(i&&console.log(`HomeDevices received refresh_required: changed=${p.params.changed} and sending /api/plugins request`),n({id:C.current,sender:"HomeDevices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})),p.method==="refresh_required"&&p.params.changed==="matter"&&(i&&console.log(`HomeDevices received refresh_required: changed=${p.params.changed} and setting matter id ${p.params.matter?.id}`),N(V=>{const k=V.findIndex(T=>T.name.replaceAll(" ","")===p.params.matter?.id);if(k<0)return i&&console.debug(`HomeDevices: matter id ${p.params.matter?.id} not found`),V;const X=[...V];return X[k]={...X[k],matter:p.params.matter},i&&console.log(`HomeDevices received refresh_required: changed=${p.params.changed} and set matter id ${p.params.matter?.id}`),X})),p.method==="restart_required"&&(i&&console.log("HomeDevices received restart_required"),l(!0)),p.method==="restart_not_required"&&(i&&console.log("HomeDevices received restart_not_required"),l(!1)),p.method==="state_update"&&p.params.plugin&&p.params.serialNumber&&p.params.cluster.includes("BasicInformationServer")&&p.params.attribute==="reachable"&&(console.log(`HomeDevices updating device reachability for plugin ${p.params.plugin} serial ${p.params.serialNumber} value ${p.params.value}`),c(V=>V.map(k=>k.pluginName===p.params.plugin&&k.serial===p.params.serialNumber?{...k,reachable:p.params.value}:k))),p.id===C.current&&p.method==="/api/settings"&&(i&&console.log(`HomeDevices (id: ${p.id}) received settings:`,p.response),L(p.response),l(p.response.matterbridgeInformation.restartRequired||p.response.matterbridgeInformation.fixedRestartRequired)),p.id===C.current&&p.method==="/api/plugins"&&(i&&console.log(`HomeDevices (id: ${p.id}) received ${p.response?.length} plugins:`,p.response),p.response)){let V=!0;for(const k of p.response)k.enabled===!0&&(k.loaded!==!0||k.started!==!0||k.error===!0)&&(V=!1);if(!V)return;i&&console.log("HomeDevices reset plugins, devices and selectDevices"),R(!1),w(p.response),c([]),v([]),n({id:C.current,sender:"HomeDevices",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}}),i&&console.log("HomeDevices sent /api/devices");for(const k of p.response)k.enabled===!0&&k.loaded===!0&&k.started===!0&&k.error!==!0&&(n({id:C.current,sender:"HomeDevices",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:k.name}}),i&&console.log(`HomeDevices sent /api/select/devices for plugin: ${k.name}`))}if(p.id===C.current&&p.method==="/api/devices"&&(i&&console.log(`HomeDevices (id: ${p.id}) received ${p.response?.length} devices:`,p.response),p.response)){for(const V of p.response)V.selected=M(V);c(p.response)}p.id===C.current&&p.method==="/api/select/devices"&&(i&&console.log(`HomeDevices (id: ${p.id}) received ${p.response?.length} selectDevices for plugin ${p.response&&p.response.length>0?p.response[0].pluginName:"without select devices"}:`,p.response),p.response&&p.response.length>0&&v(V=>{const k=V.filter(T=>T.pluginName!==p.response[0].pluginName),X=p.response.map(T=>({...T,selected:M(T)}));return[...k,...X]}))}};return s(S),i&&console.log(`HomeDevices added WebSocket listener id ${C.current}`),()=>{g(S),i&&console.log("HomeDevices removed WebSocket listener")}},[A,s,g,n,M]),o.useEffect(()=>{if(E.length===0&&z.length===0){N([]);return}i&&console.log(`HomeDevices mixing devices (${E.length}) and selectDevices (${z.length})`);const S=[];for(const p of E)S.push(p);for(const p of z)E.find(V=>V.pluginName===p.pluginName&&V.serial.includes(p.serial))||S.push(p);S.length>0&&(N(S),i&&console.log(`HomeDevices mixed ${S.length} devices and selectDevices`))},[A,E,z,N]),o.useEffect(()=>{a&&(i&&console.log("HomeDevices sending /api/settings and /api/plugins requests"),n({id:C.current,sender:"HomeDevices",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),n({id:C.current,sender:"HomeDevices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[a,n]),o.useEffect(()=>{const S=localStorage.getItem("homeDevicesColumnVisibility");if(S){const p=JSON.parse(S);p.powerSource===void 0&&(p.powerSource=!0),H(p),i&&console.log("HomeDevices loaded column visibility from localStorage")}},[]);const q=S=>{H(p=>{const V={...p,[S]:!p[S]};return localStorage.setItem("homeDevicesColumnVisibility",JSON.stringify(V)),i&&console.log("HomeDevices saved column visibility to localStorage",JSON.stringify(V),V),V})},ce=()=>{W(!$)},ve=(S,p)=>{console.log(`handleCheckboxChange: checkbox changed to ${S.target.checked} for device ${p.name} serial ${p.serial}`),N(V=>{const k=V.findIndex(T=>T.pluginName===p.pluginName&&T.serial===p.serial);if(k<0)return console.error(`handleCheckboxChange: device not found ${p.name} serial ${p.serial} id ${p.id}`),V;const X=[...V];return X[k]={...X[k],selected:S.target.checked},X}),S.target.checked?n({id:C.current,sender:"HomeDevices",method:"/api/command",src:"Frontend",dst:"Matterbridge",params:{command:"selectdevice",plugin:p.pluginName,serial:p.serial,name:p.name}}):n({id:C.current,sender:"HomeDevices",method:"/api/command",src:"Frontend",dst:"Matterbridge",params:{command:"unselectdevice",plugin:p.pluginName,serial:p.serial,name:p.name}})};return i&&console.log("HomeDevices rendering..."),a?e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",width:"100%",flex:"1 1 auto",overflow:"hidden"},children:[e.jsxs(Ne,{open:$,onClose:ce,children:[e.jsx(Pe,{children:"Configure Devices Columns"}),e.jsx(We,{children:e.jsx(St,{children:f.map(S=>e.jsx(Te,{control:e.jsx(Fe,{disabled:["name","actions"].includes(S.accessor),checked:m[S.accessor],onChange:()=>q(S.accessor)}),label:S.Header},S.accessor))})}),e.jsx($e,{children:e.jsx(ae,{onClick:ce,children:"Close"})})]}),e.jsxs("div",{className:"MbfWindowHeader",style:{justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Devices"}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(J,{onClick:ce,"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(O,{title:"Configure columns",children:e.jsx(rt,{style:{color:"var(--header-text-color)",fontSize:"19px"}})})})})]}),e.jsx("div",{className:"MbfWindowBodyColumn",style:{margin:"0px",padding:"0px",gap:"0",overflow:"auto"},children:e.jsx(xn,{data:x,columns:f,columnVisibility:m})}),e.jsxs("div",{className:"MbfWindowFooter",style:{borderTop:"1px solid var(--table-border-color)",justifyContent:"space-between"},children:[D&&e.jsx("p",{className:"MbfWindowFooterText",style:{fontWeight:"normal",fontSize:"14px",color:"var(--secondary-color)"},children:"Waiting for the plugins to fully load..."}),!D&&e.jsxs("p",{className:"MbfWindowFooterText",style:{fontWeight:"normal",fontSize:"14px",color:"var(--secondary-color)"},children:["Registered devices: ",E.length.toString(),"/",x.length.toString()]}),t&&e.jsx("p",{className:"MbfWindowFooterText",style:{fontWeight:"normal",fontSize:"14px",color:"var(--secondary-color)"},children:"Restart required"})]})]}):e.jsx(Be,{})}const vn=o.memo(bn);function yn(){const[r,d]=o.useState(null),[a,n]=o.useState(null),[s,g]=o.useState([]),[y]=o.useState(localStorage.getItem("homePagePlugins")!=="false"),[t,l]=o.useState(localStorage.getItem("homePageMode")??"devices"),[D,R]=o.useState(""),[b,L]=o.useState(!1),[A,w]=o.useState(!1),[E,c]=o.useState(null),{addListener:z,removeListener:v,online:x,sendMessage:N,logFilterLevel:$,logFilterSearch:W,autoScroll:m,getUniqueId:H}=o.useContext(be),C=o.useRef(H());return o.useEffect(()=>{const f=M=>{M.src==="Matterbridge"&&M.dst==="Frontend"&&(xe(M)&&M.method==="refresh_required"&&M.params.changed==="settings"&&(i&&console.log(`Home received refresh_required: changed=${M.params.changed} and sending /api/settings request`),c(null),g([]),N({id:C.current,sender:"Home",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),N({id:C.current,sender:"Home",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})),Ve(M)&&M.method==="/api/settings"&&M.id===C.current&&(i&&console.log("Home received settings:",M.response),d(M.response.systemInformation),n(M.response.matterbridgeInformation),M.response.matterbridgeInformation.bridgeMode==="bridge"&&(E||c("Matterbridge")),M.response.matterbridgeInformation.bridgeMode==="childbridge"&&s.length>0&&E===null&&!E&&s.length>0&&s[0].matter?.id&&c(s[0].matter.id),M.response.matterbridgeInformation.matterbridgeVersion&&R(`https://github.com/Luligu/matterbridge/blob/${M.response.matterbridgeInformation.matterbridgeVersion.includes("-dev-")?"dev":"main"}/CHANGELOG.md`),localStorage.getItem("frontendVersion")===null&&M.response.matterbridgeInformation.frontendVersion?localStorage.setItem("frontendVersion",M.response.matterbridgeInformation.frontendVersion):M.response.matterbridgeInformation.frontendVersion!==localStorage.getItem("frontendVersion")&&M.response.matterbridgeInformation.frontendVersion&&(localStorage.setItem("frontendVersion",M.response.matterbridgeInformation.frontendVersion),w(!0)),localStorage.getItem("matterbridgeVersion")===null?localStorage.setItem("matterbridgeVersion",M.response.matterbridgeInformation.matterbridgeVersion):M.response.matterbridgeInformation.matterbridgeVersion!==localStorage.getItem("matterbridgeVersion")&&(localStorage.setItem("matterbridgeVersion",M.response.matterbridgeInformation.matterbridgeVersion),L(!0)),M.response.matterbridgeInformation.shellyBoard&&(localStorage.getItem("homePageMode")||(localStorage.setItem("homePageMode","devices"),l("devices")))),Ve(M)&&M.method==="/api/plugins"&&M.id===C.current&&(i&&console.log(`Home received plugins (${a?.bridgeMode}):`,M.response),g(M.response),a?.bridgeMode==="childbridge"&&M.response.length>0&&!E&&M.response.length>0&&M.response[0].matter?.id&&c(M.response[0].matter.id)))};return z(f),i&&console.log(`Home added WebSocket listener id ${C.current}`),()=>{v(f),i&&console.log("Home removed WebSocket listener")}},[z,v,N,a,s,E]),o.useEffect(()=>{x&&(i&&console.log("Home received online"),N({id:C.current,sender:"Home",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),N({id:C.current,sender:"Home",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[x,N]),i&&console.log("Home rendering..."),!x||!r||!a?e.jsx(Be,{}):e.jsxs("div",{className:"MbfPageDiv",style:{flexDirection:"row"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",width:"302px",minWidth:"302px",gap:"20px"},children:[e.jsx(on,{id:E}),e.jsx(en,{systemInfo:r,compact:!0})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",width:"100%",gap:"20px"},children:[A&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Frontend Update"})}),e.jsxs("div",{className:"MbfWindowBody",style:{flexDirection:"row",justifyContent:"space-between"},children:[e.jsx("h4",{style:{margin:0},children:"The frontend has been updated. You are viewing an outdated web UI. Please refresh the page now."}),e.jsx("div",{children:e.jsx(ae,{onClick:()=>window.location.reload(),endIcon:e.jsx(Er,{}),style:{marginLeft:"10px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Refresh"})})]})]}),b&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge Update"})}),e.jsxs("div",{className:"MbfWindowBody",style:{flexDirection:"row",justifyContent:"space-between"},children:[e.jsx("h4",{style:{margin:0},children:"Matterbridge has been updated."}),e.jsxs("div",{children:[e.jsx(ae,{onClick:()=>window.open(D,"_blank"),endIcon:e.jsx(Zt,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Changelog"}),e.jsx(ae,{onClick:()=>window.location.reload(),endIcon:e.jsx(Vr,{}),style:{marginLeft:"10px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Close"})]})]})]}),y&&!a.readOnly&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Install plugins"})}),e.jsx(an,{})]}),y&&e.jsx(hn,{storeId:E,setStoreId:c}),t==="devices"&&e.jsx(vn,{storeId:E,setStoreId:c}),t==="logs"&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"1 1 auto",width:"100%",overflow:"hidden"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",minHeight:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",children:"Logs"}),e.jsx("div",{className:"MbfWindowHeaderText",style:{display:"flex",justifyContent:"space-between"},children:e.jsxs("span",{style:{fontWeight:"normal",fontSize:"12px",marginTop:"2px"},children:['Filter: logger level "',$,'" and search "',W,'" Scroll: ',m?"auto":"manual"]})})]}),e.jsx("div",{style:{flex:"1 1 auto",margin:"0px",padding:"10px",overflow:"auto"},children:e.jsx(ir,{})})]})]})]})}const jn=o.memo(yn),Qt={display:"flex",gap:"2px",justifyContent:"space-evenly",width:"100%",height:"40px"},Cn={margin:"0",padding:"0",fontSize:"36px",fontWeight:"medium",color:"var(--primary-color)"},Sn={margin:"0",padding:"0",fontSize:"20px",fontWeight:"medium",color:"var(--div-text-color)",textAlign:"center"},Gt={margin:"0",padding:"0",paddingBottom:"2px",fontSize:"16px",fontWeight:"medium",color:"var(--div-text-color)",textAlign:"center"},wn={display:"flex",gap:"2px",justifyContent:"center",width:"100%",height:"18px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},Mn={margin:"0",padding:"0",fontSize:"12px",fontWeight:"normal",color:"var(--div-text-color)"},kn={display:"flex",justifyContent:"center",width:"100%",height:"52px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},In={margin:"0",padding:"0",fontSize:"14px",fontWeight:"bold",color:"var(--div-text-color)"},Dn={display:"flex",gap:"4px",justifyContent:"center",width:"100%",height:"15px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},Wt={margin:"0",padding:"0px 4px",borderRadius:"5px",textAlign:"center",fontSize:"12px",fontWeight:"normal",color:"var(--secondary-color)"},Nn=[256,257,268,269],Pn=[266,267],Wn=[259,260,261,271,272],Tn=[256,257,268,269,266,267,259,260,261];function G({icon:r,iconColor:d,cluster:a,value:n,unit:s,prefix:g}){return i&&console.log(`Render cluster "${a.clusterName}.${a.attributeName}" value(${typeof n}-${isNaN(n)}) "${n}" unit "${s}"`),g=g??!1,e.jsxs(ee,{sx:Qt,children:[r&&o.cloneElement(r,{key:`${a.clusterId}-${a.attributeId}-icon`,sx:{...Cn,color:d??"var(--primary-color)"}}),e.jsxs(ee,{sx:{...Qt,gap:"4px",alignContent:"center",alignItems:"end",justifyContent:"center"},children:[s&&g===!0&&e.jsx(le,{sx:Gt,children:s},`${a.clusterId}-${a.attributeId}-unit`),e.jsx(le,{sx:Sn,children:n==null||typeof n=="number"&&isNaN(n)||n==="NaN"?"---":n},`${a.clusterId}-${a.attributeId}-value`),s&&g===!1&&e.jsx(le,{sx:Gt,children:s},`${a.clusterId}-${a.attributeId}-unit`)]},`${a.clusterId}-${a.attributeId}-valueunitbox`)]},`${a.clusterId}-${a.attributeId}-box`)}function Fn({device:r,endpoint:d,id:a,deviceType:n,clusters:s}){const g=["Unknown","Good","Fair","Moderate","Poor","VeryPoor","Ext.Poor"];let y="";return i&&console.log(`Device "${r.name}" endpoint "${d}" id "${a}" deviceType "0x${n.toString(16).padStart(4,"0")}" clusters (${s?.length}):`,s),n===17&&s.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="batVoltage").map(t=>y=`${t.attributeLocalValue} mV`),Tn.includes(n)&&s.filter(t=>t.clusterName==="LevelControl"&&t.attributeName==="currentLevel").map(t=>y=`Level ${t.attributeValue}`),n===514&&s.filter(t=>t.clusterName==="WindowCovering"&&t.attributeName==="currentPositionLiftPercent100ths").map(t=>y=`Position ${t.attributeValue/100}%`),n===769&&s.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="occupiedHeatingSetpoint").map(t=>y=`Heat ${t.attributeValue/100}Â°C `),n===769&&s.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="occupiedCoolingSetpoint").map(t=>y=y+`Cool ${t.attributeValue/100}Â°C`),n===118&&s.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="coState").map(t=>y=`${t.attributeLocalValue===0?"No CO detected":"CO alarm!"}`),n===1296&&s.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="voltage").map(t=>y=`${t.attributeLocalValue/1e3} V, `),n===1296&&s.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="activeCurrent").map(t=>y=y+`${t.attributeLocalValue/1e3} A, `),n===1296&&s.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="activePower").map(t=>y=y+`${t.attributeLocalValue/1e3} W`),e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0px",padding:"5px",width:"150px",height:"150px",borderColor:"var(--div-bg-color)",borderRadius:"5px",justifyContent:"space-between"},children:[n===19&&s.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(G,{icon:t.attributeLocalValue===!0?e.jsx(at,{}):e.jsx(_r,{}),iconColor:t.attributeLocalValue===!0?"green":"red",cluster:t,value:t.attributeLocalValue===!0?"Online":"Offline"})),n===17&&s.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="batPercentRemaining").map(t=>e.jsx(G,{icon:e.jsx(jt,{}),cluster:t,value:t.attributeValue/2,unit:"%"})),n===17&&s.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="wiredCurrentType").map(t=>e.jsx(G,{icon:e.jsx(tr,{}),cluster:t,value:t.attributeLocalValue===0?"AC":"DC"})),n===1293&&s.filter(t=>t.clusterName==="DeviceEnergyManagement"&&t.attributeName==="esaState").map(t=>e.jsx(G,{icon:e.jsx(re,{path:vo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Offline":"Online"})),Nn.includes(n)&&s.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(G,{icon:e.jsx(Ar,{}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),Pn.includes(n)&&s.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(G,{icon:e.jsx(re,{path:yo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),Wn.includes(n)&&s.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(G,{icon:e.jsx(re,{path:jo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),n===115&&s.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(G,{icon:e.jsx(re,{path:Co,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),n===124&&s.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(G,{icon:e.jsx(re,{path:So,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),n===117&&s.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(G,{icon:e.jsx(re,{path:wo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),n===123&&s.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(G,{icon:e.jsx(Et,{}),cluster:t,value:"Oven"})),n===112&&s.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(G,{icon:e.jsx(Ur,{}),cluster:t,value:"Fridge"})),n===113&&s.filter(t=>t.clusterName==="TemperatureControl"&&t.attributeName==="selectedTemperatureLevel").map(t=>e.jsx(G,{icon:e.jsx(re,{path:Mo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),n===121&&s.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(G,{icon:e.jsx(Et,{}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),n===122&&s.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="fanMode").map(t=>e.jsx(G,{icon:e.jsx(re,{path:ko,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),n===120&&s.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(G,{icon:e.jsx(re,{path:zt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Cooktop"})),n===119&&s.filter(t=>t.clusterName==="TemperatureControl"&&t.attributeName==="selectedTemperatureLevel").map(t=>e.jsx(G,{icon:e.jsx(re,{path:zt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),n===116&&s.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(G,{icon:e.jsx(re,{path:Io,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Robot"})),n===514&&s.filter(t=>t.clusterName==="WindowCovering"&&t.attributeName==="currentPositionLiftPercent100ths").map(t=>e.jsx(G,{icon:e.jsx(zr,{}),cluster:t,value:t.attributeLocalValue/100,unit:"%"})),n===769&&s.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="localTemperature").map(t=>e.jsx(G,{icon:e.jsx(re,{path:Do,size:"40px",color:"var(--primary-color)"}),cluster:t,value:(t.attributeLocalValue??0)/100,unit:"Â°C"})),n===10&&s.filter(t=>t.clusterName==="DoorLock"&&t.attributeName==="lockState").map(t=>e.jsx(G,{icon:t.attributeValue==="1"?e.jsx(qr,{}):e.jsx(Br,{}),cluster:t,value:t.attributeValue==="1"?"Locked":"Unlocked"})),n===43&&s.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="percentCurrent").map(t=>e.jsx(G,{icon:e.jsx(Jr,{}),cluster:t,value:t.attributeValue,unit:"%"})),n===15&&s.filter(t=>t.clusterName==="Switch"&&t.attributeName==="currentPosition").map(t=>e.jsx(G,{icon:e.jsx(re,{path:No,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeValue,unit:"pos",prefix:!0})),n===39&&s.filter(t=>t.clusterName==="ModeSelect"&&t.attributeName==="currentMode").map(t=>e.jsx(G,{icon:e.jsx(Qr,{}),cluster:t,value:t.attributeValue,unit:"mode",prefix:!0})),n===771&&s.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(G,{icon:e.jsx(Gr,{}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),n===45&&s.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="percentCurrent").map(t=>e.jsx(G,{icon:e.jsx(Vt,{}),cluster:t,value:t.attributeValue,unit:"%"})),n===114&&s.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="localTemperature").map(t=>e.jsx(G,{icon:e.jsx(Vt,{}),cluster:t,value:(t.attributeLocalValue??0)/100,unit:"Â°C"})),n===67&&s.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(G,{icon:e.jsx(Kr,{}),cluster:t,value:t.attributeLocalValue===!0?"Leak":"No leak"})),n===65&&s.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(G,{icon:e.jsx(Yr,{}),cluster:t,value:t.attributeLocalValue===!0?"Freeze":"No freeze"})),n===68&&s.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(G,{icon:e.jsx(Xr,{}),cluster:t,value:t.attributeLocalValue===!0?"Rain":"No rain"})),n===1292&&s.filter(t=>t.clusterName==="EnergyEvse"&&t.attributeName==="state").map(t=>e.jsx(G,{icon:e.jsx(re,{path:Po,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Free":"In use"})),n===1295&&s.filter(t=>t.clusterName==="WaterHeaterManagement"&&t.attributeName==="tankPercentage").map(t=>e.jsx(G,{icon:e.jsx(re,{path:Wo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Tank "+(t.attributeLocalValue??0)+"%"})),n===777&&s.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="featureMap").map(t=>e.jsx(G,{icon:e.jsx(re,{path:To,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"HeatPump"})),n===23&&s.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="featureMap").map(t=>e.jsx(G,{icon:e.jsx(re,{path:Fo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Solar"})),n===24&&s.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="featureMap").map(t=>e.jsx(G,{icon:e.jsx(re,{path:Lo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Inverter"})),n===118&&s.find(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="featureMap"&&t.attributeLocalValue.smokeAlarm===!0)&&s.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="smokeState").map(t=>e.jsx(G,{icon:e.jsx(re,{path:qt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"No smoke":"Smoke!"})),n===118&&s.find(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="featureMap"&&t.attributeLocalValue.smokeAlarm===!1)&&s.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="coState").map(t=>e.jsx(G,{icon:e.jsx(re,{path:qt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"No Co":"Co!"})),n===66&&s.filter(t=>t.clusterName==="ValveConfigurationAndControl"&&t.attributeName==="currentState").map(t=>e.jsx(G,{icon:e.jsx(Zr,{}),cluster:t,value:t.attributeLocalValue===0?"Closed":"Opened"})),n===44&&s.filter(t=>t.clusterName==="AirQuality"&&t.attributeName==="airQuality").map(t=>e.jsx(G,{icon:e.jsx(re,{path:Ro,size:"40px",color:"var(--primary-color)"}),cluster:t,value:g[t.attributeLocalValue??0]})),n===770&&s.filter(t=>t.clusterName==="TemperatureMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(G,{icon:e.jsx(eo,{}),cluster:t,value:t.attributeLocalValue/100,unit:"Â°C"})),n===775&&s.filter(t=>t.clusterName==="RelativeHumidityMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(G,{icon:e.jsx(re,{path:Ho,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue/100,unit:"%"})),n===774&&s.filter(t=>t.clusterName==="FlowMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(G,{icon:e.jsx(to,{}),cluster:t,value:t.attributeLocalValue,unit:"l/h"})),n===773&&s.filter(t=>t.clusterName==="PressureMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(G,{icon:e.jsx(ro,{}),cluster:t,value:t.attributeLocalValue,unit:"hPa"})),n===21&&s.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(G,{icon:t.attributeValue==="true"?e.jsx(oo,{}):e.jsx(no,{}),cluster:t,value:t.attributeValue==="true"?"Closed":"Opened"})),n===263&&s.filter(t=>t.clusterName==="OccupancySensing"&&t.attributeName==="occupancy").map(t=>e.jsx(G,{icon:t.attributeValue==="{ occupied: true }"?e.jsx(io,{}):e.jsx(ao,{}),cluster:t,value:t.attributeValue==="{ occupied: true }"?"Occupied":"Unocc."})),n===262&&s.filter(t=>t.clusterName==="IlluminanceMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(G,{icon:e.jsx(so,{}),cluster:t,value:Math.round(Math.pow(10,t.attributeValue/1e4)),unit:"lx"})),n===1296&&s.filter(t=>t.clusterName==="ElectricalEnergyMeasurement"&&t.attributeName==="cumulativeEnergyImported").map(t=>e.jsx(G,{icon:e.jsx(lo,{}),cluster:t,value:Math.round(t.attributeLocalValue?.energy/1e6),unit:"kwh"})),e.jsx(ee,{sx:wn,children:e.jsx(le,{sx:Mn,children:y})}),e.jsx(ee,{sx:kn,children:e.jsx(le,{sx:In,children:r.name})}),e.jsxs(ee,{sx:Dn,children:[i&&e.jsx(le,{sx:Wt,children:d}),e.jsx(le,{sx:Wt,children:a}),i&&e.jsxs(le,{sx:Wt,children:["0x",n.toString(16).padStart(4,"0")]})]})]})}function Ln({filter:r}){const{online:d,sendMessage:a,addListener:n,removeListener:s,getUniqueId:g}=o.useContext(be),[y,t]=o.useState({}),[l,D]=o.useState([]),[R,b]=o.useState([]),[L,A]=o.useState({}),[w,E]=o.useState({}),[c,z]=o.useState({}),[v,x]=o.useState(R),N=o.useRef(g());return o.useEffect(()=>{const $=W=>{if(W.src==="Matterbridge"&&W.dst==="Frontend"){if(W.method==="refresh_required"&&(i&&console.log(`DevicesIcons received refresh_required: changed=${W.params.changed} and sending api requests`),a({id:N.current,sender:"Icons",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),a({id:N.current,sender:"Icons",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),a({id:N.current,sender:"Icons",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}})),W.method==="/api/settings"&&W.response&&(i&&console.log("DevicesIcons received settings:",W.response),t(W.response)),W.method==="/api/plugins"&&W.response&&(i&&console.log("DevicesIcons received plugins:",W.response),D(W.response)),W.method==="/api/devices"&&W.response){i&&console.log(`DevicesIcons received ${W.response.length} devices:`,W.response),b(W.response);for(let m of W.response)i&&console.log("DevicesIcons sending /api/clusters"),a({id:N.current,sender:"Icons",method:"/api/clusters",src:"Frontend",dst:"Matterbridge",params:{plugin:m.pluginName,endpoint:m.endpoint}})}if(W.method==="/api/clusters"&&W.response){if(console.log(`DevicesIcons received for device "${W.response.deviceName}" serial "${W.response.serialNumber}" deviceType ${W.response.deviceTypes.join(" ")} clusters (${W.response.length}):`,W.response),W.response.length===0)return;const m=W.response.serialNumber;L[m]=[],w[m]=W.response.deviceTypes,c[m]=[];for(let H of W.response.clusters)L[m].find(C=>C.endpoint===H.endpoint)||L[m].push({endpoint:H.endpoint,id:H.id,deviceTypes:H.deviceTypes}),!["FixedLabel","Descriptor","Identify","Groups","PowerTopology"].includes(H.clusterName)&&c[m].push(H);A({...L}),E({...w}),z({...c}),i&&console.log(`DevicesIcons endpoints for "${m}":`,L[m]),i&&console.log(`DevicesIcons deviceTypes for "${m}":`,w[m]),i&&console.log(`DevicesIcons clusters for "${m}":`,c[m])}}};return n($),i&&console.log("DevicesIcons useEffect webSocket mounted"),()=>{s($),i&&console.log("DevicesIcons useEffect webSocket unmounted")}},[n,s,a]),o.useEffect(()=>(i&&console.log("DevicesIcons useEffect online mounting"),d&&(i&&console.log("DevicesIcons useEffect online sending api requests"),a({id:N.current,sender:"Icons",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),a({id:N.current,sender:"Icons",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),a({id:N.current,sender:"Icons",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}})),i&&console.log("DevicesIcons useEffect online mounted"),()=>{i&&console.log("DevicesIcons useEffect online unmounted")}),[d,a]),o.useEffect(()=>{if(r===""){x(R);return}const $=R.filter(W=>W.name.toLowerCase().includes(r)||W.serial.toLowerCase().includes(r));x($)},[R,r]),i&&console.log("DevicesIcons rendering..."),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",paddingBottom:"5px",gap:"20px",width:"100%",overflow:"auto"},children:v.map($=>L[$.serial]&&L[$.serial].map(W=>W.deviceTypes.map(m=>e.jsx(Fn,{device:$,endpoint:W.endpoint,id:W.id,deviceType:m,clusters:c[$.serial].filter(H=>H.endpoint===W.endpoint)}))))})}const Rn=o.memo(Ln),lr=[{Header:"Plugin name",accessor:"pluginName"},{Header:"Device type",accessor:"type"},{Header:"Endpoint",accessor:"endpoint"},{Header:"Name",accessor:"name"},{Header:"Serial number",accessor:"serial"},{Header:"Unique ID",accessor:"uniqueId"},{Header:"Url",accessor:"configUrl"},{Header:"Config",accessor:"configButton",noSort:!0,Cell:({row:r})=>r.original.configUrl?e.jsx(J,{onClick:()=>window.open(r.original.configUrl,"_blank"),"aria-label":"Open Config",sx:{margin:0,padding:0},children:e.jsx(rt,{fontSize:"small"})}):null},{Header:"Cluster",accessor:"cluster"}],dr=[{Header:"Endpoint",accessor:"endpoint"},{Header:"Id",accessor:"id"},{Header:"Device Types",accessor:"deviceTypes",Cell:({value:r})=>Array.isArray(r)?r.map(d=>`0x${d.toString(16).padStart(4,"0")}`).join(", "):r},{Header:"Cluster Name",accessor:"clusterName"},{Header:"Cluster ID",accessor:"clusterId"},{Header:"Attribute Name",accessor:"attributeName"},{Header:"Attribute ID",accessor:"attributeId"},{Header:"Attribute Value",accessor:"attributeValue",Cell:({value:r})=>e.jsx(O,{title:r,componentsProps:{tooltip:{sx:{fontSize:"14px",fontWeight:"normal",color:"#ffffff",backgroundColor:"var(--primary-color)"}}},children:e.jsx("div",{style:{maxWidth:"500px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r})})}],Hn=r=>`${r.pluginName}::${r.uniqueId}`,$n=r=>`${r.endpoint}::${r.clusterName}::${r.attributeName}`;function On({data:r,columnVisibility:d,setPlugin:a,setEndpoint:n,setDeviceName:s}){const[g,y]=o.useState(null),t=o.useMemo(()=>lr.filter(w=>d[w.accessor]),[d]),{getTableProps:l,getTableBodyProps:D,headerGroups:R,rows:b,prepareRow:L}=ot.useTable({columns:t,data:r,getRowId:Hn},ot.useSortBy),A=w=>{if(w.id===g){y(null),a(null),n(null),s(null),i&&console.log("Device unclicked:",w.id,"selectedDeviceIndex:",g);return}y(w.id),a(w.original.pluginName),n(w.original.endpoint),s(w.original.name),i&&console.log("Device clicked:",w.id,"selectedDeviceIndex:",g,"pluginName:",w.original.pluginName,"endpoint:",w.original.endpoint)};return e.jsxs("table",{...l(),style:{margin:"-1px",border:"1px solid var(--table-border-color)"},children:[e.jsx("thead",{children:R.map(w=>e.jsx("tr",{...w.getHeaderGroupProps(),children:w.headers.map(E=>e.jsxs("th",{...E.getHeaderProps(E.noSort?void 0:E.getSortByToggleProps()),children:[E.render("Header"),!E.noSort&&e.jsx("span",{style:{margin:"0px",marginLeft:"5px",padding:"0px"},children:E.isSorted?E.isSortedDesc?e.jsx(re,{path:Ft,size:"15px"}):e.jsx(re,{path:Tt,size:"15px"}):null})]}))}))}),e.jsx("tbody",{...D(),children:b.map((w,E)=>(L(w),e.jsx("tr",{className:E%2===0?"table-content-even":"table-content-odd",...w.getRowProps(),onClick:()=>A(w),style:{backgroundColor:g===w.id?"var(--table-selected-bg-color)":"",cursor:"pointer"},children:w.cells.map(c=>e.jsx("td",{...c.getCellProps(),children:c.render("Cell")}))})))})]})}function En({data:r,columnVisibility:d}){const a=o.useMemo(()=>dr.filter(l=>d[l.accessor]),[d]),{getTableProps:n,getTableBodyProps:s,headerGroups:g,rows:y,prepareRow:t}=ot.useTable({columns:a,data:r,getRowId:$n},ot.useSortBy);return e.jsxs("table",{...n(),style:{margin:"-1px"},children:[e.jsx("thead",{children:g.map(l=>e.jsx("tr",{...l.getHeaderGroupProps(),children:l.headers.map(D=>e.jsx("th",{...D.getHeaderProps(),children:D.render("Header")}))}))}),e.jsx("tbody",{...s(),children:y.map((l,D)=>(t(l),e.jsx("tr",{className:D%2===0?"table-content-even":"table-content-odd",...l.getRowProps(),children:l.cells.map(R=>e.jsx("td",{...R.getCellProps(),children:R.render("Cell")}))})))})]})}function Vn(){const{online:r,sendMessage:d,addListener:a,removeListener:n,getUniqueId:s}=o.useContext(be),[g,y]=o.useState([]),[t,l]=o.useState([]),[D,R]=o.useState(null),[b,L]=o.useState(null),[A,w]=o.useState(null),[E,c]=o.useState(0),[z,v]=o.useState(!1),[x,N]=o.useState({pluginName:!0,type:!0,endpoint:!0,name:!0,serial:!0,uniqueId:!1,configUrl:!1,configButton:!0,cluster:!0}),[$,W]=o.useState(!1),[m,H]=o.useState({endpoint:!0,id:!0,deviceTypes:!0,clusterName:!0,clusterId:!0,attributeName:!0,attributeId:!0,attributeValue:!0}),[C,f]=o.useState(""),[M,q]=o.useState(g),[ce,ve]=o.useState("icon"),S=o.useRef(s());o.useEffect(()=>{const h=j=>{if(i&&console.log("Devices received WebSocket Message:",j),j.src==="Matterbridge"&&j.dst==="Frontend"&&(j.method==="refresh_required"&&j.params.changed==="devices"&&(i&&console.log(`Devices received refresh_required: changed=${j.params.changed} and sending /api/devices request`),d({id:S.current,sender:"Devices",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}})),j.method==="/api/devices"&&(i&&console.log(`Devices received ${j.response.length} devices:`,j.response),y(j.response)),j.method==="/api/clusters")){console.log(`Devices received ${j.response.length} clusters:`,j.response),l(j.response.clusters);const I={};for(const P of j.response.clusters)i&&console.log("Cluster:",P.endpoint),I[P.endpoint]?I[P.endpoint]++:I[P.endpoint]=1;c(Object.keys(I).length)}};return a(h),i&&console.log("Devices added WebSocket listener"),()=>{n(h),i&&console.log("Devices removed WebSocket listener")}},[a,n,d]),o.useEffect(()=>{r&&(i&&console.log("Devices sending api requests"),d({id:S.current,sender:"Devices",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),d({id:S.current,sender:"Devices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),d({id:S.current,sender:"Devices",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}}))},[r,d]),o.useEffect(()=>{D&&b&&(i&&console.log("Devices sending /api/clusters"),d({id:S.current,sender:"Devices",method:"/api/clusters",src:"Frontend",dst:"Matterbridge",params:{plugin:D,endpoint:b}}))},[D,b,d]);const p=()=>{v(!z)},V=h=>{N(j=>{const I={...j,[h]:!j[h]};return localStorage.setItem("devicesColumnVisibility",JSON.stringify(I)),I})};o.useEffect(()=>{const h=localStorage.getItem("devicesColumnVisibility");h&&N(JSON.parse(h))},[]);const k=()=>{W(!$)},X=h=>{H(j=>{const I={...j,[h]:!j[h]};return localStorage.setItem("clustersColumnVisibility",JSON.stringify(I)),I})};o.useEffect(()=>{const h=localStorage.getItem("clustersColumnVisibility");h&&H(JSON.parse(h))},[]);const T=h=>{f(h.target.value.toLowerCase()),localStorage.setItem("devicesFilter",h.target.value.toLowerCase())},_=h=>{ve(h),localStorage.setItem("devicesViewMode",h)};return o.useEffect(()=>{if(C===""){q(g);return}const h=g.filter(j=>j.name.toLowerCase().includes(C)||j.serial.toLowerCase().includes(C));q(h)},[g,C]),o.useEffect(()=>{const h=localStorage.getItem("devicesFilter");h&&f(h)},[]),o.useEffect(()=>{const h=localStorage.getItem("devicesViewMode");h&&ve(h)},[]),i&&console.log("Devices rendering..."),r?e.jsxs("div",{className:"MbfPageDiv",children:[e.jsxs("div",{className:"MbfWindowBodyRow",style:{justifyContent:"space-between",padding:0,gap:"20px",width:"100%",height:"45px",minHeight:"45px",maxHeight:"45px"},children:[e.jsxs(ee,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx(le,{sx:{fontSize:"16px",fontWeight:"normal",color:"var(--div-text-color)",marginLeft:"5px",whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(pe,{variant:"outlined",value:C,onChange:T,placeholder:"Enter the device name or serial number",sx:{width:"320px"},InputProps:{style:{backgroundColor:"var(--main-bg-color)"}}})]}),e.jsxs(ee,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx(le,{sx:{fontSize:"16px",fontWeight:"normal",color:"var(--div-text-color)",marginLeft:"5px",whiteSpace:"nowrap"},children:"View mode:"}),e.jsx(J,{onClick:()=>_("table"),"aria-label":"Table View",disabled:ce==="table",children:e.jsx(O,{title:"Table View",children:e.jsx(co,{style:{color:ce==="table"?"var(--main-icon-color)":"var(--primary-color)"}})})}),e.jsx(J,{onClick:()=>_("icon"),"aria-label":"Icon View",disabled:ce==="icon",children:e.jsx(O,{title:"Icon View (beta)",children:e.jsx(po,{style:{color:ce==="icon"?"var(--main-icon-color)":"var(--primary-color)"}})})})]})]}),e.jsxs(Ne,{open:z,onClose:p,children:[e.jsx(Pe,{children:"Configure Devices Columns"}),e.jsx(We,{children:e.jsx(St,{children:lr.map(h=>e.jsx(Te,{control:e.jsx(Fe,{disabled:["pluginName","name","configButton"].includes(h.accessor),checked:x[h.accessor],onChange:()=>V(h.accessor)}),label:h.Header},h.accessor))})}),e.jsx($e,{children:e.jsx(ae,{onClick:p,children:"Close"})})]}),ce==="table"&&e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",maxHeight:`${D&&b?"50%":"100%"}`,width:"100%",flex:"1 1 auto",overflow:"hidden"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Registered devices"}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(J,{onClick:p,"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(O,{title:"Configure columns",children:e.jsx(rt,{style:{color:"var(--header-text-color)",fontSize:"19px"}})})})})]}),e.jsx("div",{className:"MbfWindowBodyColumn",style:{margin:"0",padding:"0",gap:"0"},children:e.jsx(On,{data:M,columnVisibility:x,setPlugin:R,setEndpoint:L,setDeviceName:w})}),e.jsx("div",{className:"MbfWindowFooter",style:{borderTop:"1px solid var(--table-border-color)",justifyContent:"flex-start"},children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontWeight:"normal",textAlign:"left"},children:["Total devices: ",M.length.toString()]})})]}),e.jsxs(Ne,{open:$,onClose:k,children:[e.jsx(Pe,{children:"Configure Clusters Columns"}),e.jsx(We,{children:e.jsx(St,{children:dr.map(h=>e.jsx(Te,{control:e.jsx(Fe,{disabled:["clusterName","attributeName","attributeValue"].includes(h.accessor),checked:m[h.accessor],onChange:()=>X(h.accessor)}),label:h.Header},h.accessor))})}),e.jsx($e,{children:e.jsx(ae,{onClick:k,children:"Close"})})]}),ce==="table"&&D&&b&&e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",height:"50%",maxHeight:"50%",width:"100%",flex:"1 1 auto",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsxs("div",{className:"MbfWindowHeaderText",style:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[e.jsxs("p",{style:{margin:"0px",padding:"0px"},children:['Clusters for device "',A,'" on endpoint ',b]}),e.jsx(J,{onClick:k,"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(O,{title:"Configure columns",children:e.jsx(rt,{style:{color:"var(--header-text-color)",fontSize:"19px"}})})})]})}),e.jsx("div",{className:"MbfWindowBodyColumn",style:{margin:"0",padding:"0",gap:"0"},children:e.jsx(En,{data:t,columnVisibility:m})}),e.jsx("div",{className:"MbfWindowFooter",style:{borderTop:"1px solid var(--table-border-color)",justifyContent:"flex-start"},children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontWeight:"normal",textAlign:"left"},children:["Total child endpoints: ",E-1]})})]}),ce==="icon"&&e.jsx(Rn,{filter:C,devices:M})]}):e.jsx(Be,{})}const _n=o.memo(Vn);function An(){const[r,d]=o.useState(localStorage.getItem("logFilterLevel")??"info"),[a,n]=o.useState(localStorage.getItem("logFilterSearch")??"*"),[s,g]=o.useState(localStorage.getItem("logAutoScroll")!=="false"),{setMessages:y,setLogFilters:t,online:l,setAutoScroll:D}=o.useContext(be),R=w=>{d(w.target.value),t(w.target.value,a),localStorage.setItem("logFilterLevel",w.target.value),i&&console.log("handleChangeLevel called with value:",w.target.value)},b=w=>{n(w.target.value),t(r,w.target.value),localStorage.setItem("logFilterSearch",w.target.value),i&&console.log("handleChangeSearch called with value:",w.target.value)},L=w=>{g(w.target.checked),D(w.target.checked),localStorage.setItem("logAutoScroll",w.target.value?"true":"false"),i&&console.log("handleAutoScrollChange called with value:",w.target.checked)},A=()=>{i&&console.log("handleClearLogsClick called"),y([])};return i&&console.log("Logs rendering..."),l?e.jsxs("div",{className:"MbfPageDiv",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",margin:"0px",padding:"0px",gap:"10px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(_t,{id:"select-level",style:{color:"var(--div-text-color)"},children:"Filter log by level:"}),e.jsxs(tt,{style:{height:"30px",backgroundColor:"var(--main-bg-color)"},labelId:"select-level",id:"debug-level",value:r,onChange:R,children:[e.jsx(F,{value:"debug",children:"Debug"}),e.jsx(F,{value:"info",children:"Info"}),e.jsx(F,{value:"notice",children:"Notice"}),e.jsx(F,{value:"warn",children:"Warn"}),e.jsx(F,{value:"error",children:"Error"}),e.jsx(F,{value:"fatal",children:"Fatal"})]}),e.jsx(_t,{id:"search",style:{color:"var(--div-text-color)"},children:"Filter log by text:"}),e.jsx(pe,{style:{width:"300px"},size:"small",id:"logsearch",variant:"outlined",value:a,onChange:b,InputProps:{style:{height:"30px",padding:"0 0px",backgroundColor:"var(--main-bg-color)"}}}),e.jsx(Te,{control:e.jsx(Fe,{checked:s,onChange:L}),label:"Auto scroll",style:{color:"var(--div-text-color)"}})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:e.jsx(O,{title:"Clear the logs",children:e.jsx(ae,{onClick:A,endIcon:e.jsx(Ct,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Clear"})})})]}),e.jsx("div",{style:{flex:"1",overflow:"auto",margin:"0px",padding:"0px"},children:e.jsx(ir,{})})]}):e.jsx(Be,{})}const Un=({open:r,ip:d,onClose:a,onSave:n})=>{const s=d?d.split(".").slice(0,3).join(".")+".1":"",[g,y]=o.useState("dhcp"),[t,l]=o.useState({ip:d??"",subnet:"255.255.255.0",gateway:s,dns:s}),D=L=>A=>{l({...t,[L]:A.target.value})},R=()=>{a()},b=()=>{const L=g==="static"?{type:g,...t}:{type:g};n(L),a()};return e.jsxs(Ne,{open:r,onClose:(L,A)=>{A==="backdropClick"||A==="escapeKeyDown"||a()},maxWidth:"sm",style:{maxWidth:"550px",margin:"auto"},children:[e.jsx(Pe,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:"Network Configuration"})]})}),e.jsxs(We,{dividers:!0,children:[e.jsxs(rr,{component:"fieldset",fullWidth:!0,children:[e.jsx(Ie,{component:"legend",children:"Select IP Configuration"}),e.jsxs(or,{row:!0,value:g,onChange:L=>y(L.target.value),children:[e.jsx(Te,{value:"dhcp",control:e.jsx(wt,{}),label:"DHCP"}),e.jsx(Te,{value:"static",control:e.jsx(wt,{}),label:"Static"})]})]}),g==="static"&&e.jsxs(Ae,{container:!0,spacing:2,sx:{mt:2},children:[e.jsx(Ae,{size:6,children:e.jsx(pe,{label:"IP Address",fullWidth:!0,value:t.ip,onChange:D("ip")})}),e.jsx(Ae,{size:6,children:e.jsx(pe,{label:"Subnet Mask",fullWidth:!0,value:t.subnet,onChange:D("subnet")})}),e.jsx(Ae,{size:6,children:e.jsx(pe,{label:"Gateway",fullWidth:!0,value:t.gateway,onChange:D("gateway")})}),e.jsx(Ae,{size:6,children:e.jsx(pe,{label:"DNS Server",fullWidth:!0,value:t.dns,onChange:D("dns")})})]})]}),e.jsxs($e,{children:[e.jsx(ae,{onClick:R,children:"Cancel"}),e.jsx(ae,{variant:"contained",onClick:b,children:"Save"})]})]})},zn=({open:r,onClose:d,onSave:a})=>{const[n,s]=o.useState(""),[g,y]=o.useState(""),t=A=>{s(A.target.value)},l=A=>{y(A.target.value)},D=n.length>0&&n===g,R=()=>{d()},b=()=>{D&&(a(n),d())},L=()=>{a(""),d()};return e.jsxs(Ne,{open:r,onClose:(A,w)=>{w==="backdropClick"||w==="escapeKeyDown"||d()},maxWidth:"sm",style:{maxWidth:"500px",margin:"auto"},disableEscapeKeyDown:!0,children:[e.jsx(Pe,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:"Change Password"})]})}),e.jsx(We,{dividers:!0,children:e.jsx(rr,{component:"fieldset",fullWidth:!0,sx:{margin:0,padding:0,gap:"20px"},children:e.jsxs(Ae,{container:!0,spacing:2,sx:{mt:2},children:[e.jsx(Ae,{size:12,children:e.jsx(pe,{type:"password",autoComplete:"new-password",label:"New Password",size:"small",variant:"outlined",fullWidth:!0,value:n,onChange:t})}),e.jsx(Ae,{size:12,children:e.jsx(pe,{type:"password",autoComplete:"new-password",label:"Confirm Password",size:"small",variant:"outlined",fullWidth:!0,value:g,onChange:l,error:g!==""&&n!==g,helperText:g!==""&&n!==g?"Passwords do not match":""})})]})})}),e.jsxs($e,{children:[e.jsx(ae,{onClick:R,children:"Cancel"}),e.jsx(ae,{variant:"contained",onClick:b,disabled:!D,children:"Change"}),e.jsx(ae,{variant:"contained",onClick:L,children:"Reset"})]})]})};function qn(){const{online:r,addListener:d,removeListener:a,sendMessage:n,getUniqueId:s}=o.useContext(be),[g,y]=o.useState(null),[t,l]=o.useState(null),D=o.useRef(s());return o.useEffect(()=>{const R=b=>{b.src==="Matterbridge"&&b.dst==="Frontend"&&(b.method==="refresh_required"&&b.params.changed==="settings"&&(i&&console.log(`Settings received refresh_required: changed=${b.params.changed} and sending /api/settings request`),n({id:D.current,sender:"Settings",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),b.method==="/api/settings"&&(i&&console.log("Settings received /api/settings:",b.response),y(b.response.matterbridgeInformation),l(b.response.systemInformation)))};return d(R),i&&console.log("Settings added WebSocket listener"),()=>{a(R),i&&console.log("Settings removed WebSocket listener")}},[d,a,n]),o.useEffect(()=>{r&&(i&&console.log("Settings received online"),n({id:D.current,sender:"Settings",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}))},[r,n]),g?(i&&console.log("Settings rendering..."),r?e.jsx("div",{className:"MbfPageDiv",children:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"20px",width:"100%"},children:[e.jsx(Bn,{matterbridgeInfo:g,systemInfo:t}),e.jsx(Jn,{matterbridgeInfo:g}),e.jsx(Qn,{matterbridgeInfo:g})]})}):e.jsx(Be,{})):null}function Bn({matterbridgeInfo:r,systemInfo:d}){const{sendMessage:a,getUniqueId:n}=o.useContext(be),[s,g]=o.useState("bridge"),[y,t]=o.useState("Info"),[l,D]=o.useState(!1),[R,b]=o.useState("dark"),[L,A]=o.useState(localStorage.getItem("homePagePlugins")!=="false"),[w,E]=o.useState(localStorage.getItem("homePageMode")??"logs"),[c,z]=o.useState(localStorage.getItem("virtualMode")??"outlet"),v=o.useRef(n()),[x,N]=o.useState(!1),$=()=>N(!1),W=k=>{i&&console.log("handleSaveNetConfig called with config:",k),a({id:v.current,sender:"Settings",method:"/api/shellynetconfig",src:"Frontend",dst:"Matterbridge",params:k})},[m,H]=o.useState(!1),C=()=>H(!1),f=k=>{i&&console.log("handleSaveChangePassword called with password:",k),a({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setpassword",value:k}})};o.useEffect(()=>{r.bridgeMode!==void 0&&(g(r.bridgeMode==="bridge"?"bridge":"childbridge"),t(r.loggerLevel.charAt(0).toUpperCase()+r.loggerLevel.slice(1)),D(r.fileLogger),z(r.virtualMode))},[r]),o.useEffect(()=>{const k=localStorage.getItem("frontendTheme");k&&b(k)},[]);const M=k=>{i&&console.log("handleChangeBridgeMode called with value:",k.target.value),g(k.target.value),a({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setbridgemode",value:k.target.value}})},q=k=>{i&&console.log("handleChangeMbLoggerLevel called with value:",k.target.value),t(k.target.value),a({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmbloglevel",value:k.target.value}})},ce=k=>{i&&console.log("handleLogOnFileMbChange called with value:",k.target.checked),D(k.target.checked),a({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmblogfile",value:k.target.checked}})},ve=k=>{const X=k.target.value;i&&console.log("handleChangeTheme called with value:",X),b(X),localStorage.setItem("frontendTheme",X),document.body.setAttribute("frontend-theme",X)},S=k=>{const X=k.target.checked;i&&console.log("handleChangeHomePagePlugins called with value:",X),A(X),localStorage.setItem("homePagePlugins",X?"true":"false")},p=k=>{const X=k.target.value;i&&console.log("handleChangeHomePageMode called with value:",X),E(X),localStorage.setItem("homePageMode",X)},V=k=>{const X=k.target.value;i&&console.log("handleChangeVirtualMode called with value:",X),z(X),localStorage.setItem("virtualMode",X),a({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setvirtualmode",value:X}})};return e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge settings"})}),e.jsx(Un,{open:x,ip:d.ipv4Address,onClose:$,onSave:W}),e.jsx(zn,{open:m,onClose:C,onSave:f}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(ee,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},id:"matterbridgeInfo-mode",children:"Matterbridge mode:"}),e.jsxs(or,{row:!0,name:"mode-buttons-group",value:s,onChange:M,children:[e.jsx(Te,{value:"bridge",control:e.jsx(wt,{}),label:"Bridge",disabled:r.readOnly===!0}),e.jsx(Te,{value:"childbridge",control:e.jsx(wt,{}),label:"Childbridge",disabled:r.readOnly===!0})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},id:"mblogger-level-label",children:"Logger level:"}),e.jsxs(tt,{style:{height:"30px"},labelId:"mblogger-level-label",id:"mblogger-level",value:y,onChange:q,children:[e.jsx(F,{value:"Debug",children:"Debug"}),e.jsx(F,{value:"Info",children:"Info"}),e.jsx(F,{value:"Notice",children:"Notice"}),e.jsx(F,{value:"Warn",children:"Warn"}),e.jsx(F,{value:"Error",children:"Error"}),e.jsx(F,{value:"Fatal",children:"Fatal"})]}),e.jsx(Te,{style:{padding:"0px",margin:"0px"},control:e.jsx(Fe,{checked:l,onChange:ce,name:"logOnFileMb"}),label:"Log on file:",labelPlacement:"start"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},id:"frontend-theme-label",children:"Frontend theme:"}),e.jsxs(tt,{style:{height:"30px"},labelId:"frontend-theme-label",id:"frontend-theme",value:R,onChange:ve,children:[e.jsx(F,{value:"classic",children:"Classic"}),e.jsx(F,{value:"light",children:"Light"}),e.jsx(F,{value:"dark",children:"Dark"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},id:"frontend-home-plugin-label",children:"Home page plugins:"}),e.jsx(Fe,{checked:L,onChange:S,name:"showPlugins"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},id:"frontend-home-label",children:"Home page bottom panel:"}),e.jsxs(tt,{style:{height:"30px"},labelId:"frontend-home-label",id:"frontend-home",value:w,onChange:p,children:[e.jsx(F,{value:"logs",children:"Logs"}),e.jsx(F,{value:"devices",children:"Devices"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"10px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},id:"frontend-virtual-label",children:"Virtual devices:"}),e.jsxs(tt,{style:{height:"30px"},labelId:"frontend-virtual-label",id:"frontend-virtual",value:c,onChange:V,children:[e.jsx(F,{value:"disabled",children:"Disabled"}),e.jsx(F,{value:"outlet",children:"Outlet"}),e.jsx(F,{value:"light",children:"Light"}),e.jsx(F,{value:"switch",children:"Switch"}),e.jsx(F,{value:"mounted_switch",children:"Mounted Switch"})]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"20px"},children:e.jsx(ae,{variant:"contained",color:"primary",onClick:()=>H(!0),children:"Change password"})}),r.shellyBoard&&e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"20px"},children:e.jsx(ae,{variant:"contained",color:"primary",onClick:()=>N(!0),children:"Configure IP"})})]})})]})}function Jn({matterbridgeInfo:r}){const{sendMessage:d,getUniqueId:a}=o.useContext(be),[n,s]=o.useState("Info"),[g,y]=o.useState(!1),[t,l]=o.useState(""),[D,R]=o.useState(""),[b,L]=o.useState(""),[A,w]=o.useState(),[E,c]=o.useState(),[z,v]=o.useState(),x=o.useRef(a());o.useEffect(()=>{r.bridgeMode!==void 0&&(s(["Debug","Info","Notice","Warn","Error","Fatal"][r.matterLoggerLevel]),y(r.matterFileLogger),l(r.matterMdnsInterface),R(r.matterIpv4Address),L(r.matterIpv6Address),w(r.matterPort),c(r.matterDiscriminator),v(r.matterPasscode))},[r]);const N=q=>{i&&console.log("handleChangeMjLoggerLevel called with value:",q.target.value),s(q.target.value),d({id:x.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmjloglevel",value:q.target.value}})},$=q=>{i&&console.log("handleLogOnFileMjChange called with value:",q.target.checked),y(q.target.checked),d({id:x.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmjlogfile",value:q.target.checked}})},W=q=>{i&&console.log("handleChangeMdnsInterface called with value:",q.target.value),l(q.target.value),d({id:x.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmdnsinterface",value:q.target.value}})},m=q=>{i&&console.log("handleChangeIpv4Address called with value:",q.target.value),R(q.target.value),d({id:x.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setipv4address",value:q.target.value}})},H=q=>{i&&console.log("handleChangeIpv6Address called with value:",q.target.value),L(q.target.value),d({id:x.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setipv6address",value:q.target.value}})},C=q=>{i&&console.log("handleChangeMatterPort called with value:",q.target.value),w(q.target.value),d({id:x.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterport",value:q.target.value}})},f=q=>{i&&console.log("handleChangeMatterDiscriminator called with value:",q.target.value),c(q.target.value),d({id:x.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterdiscriminator",value:q.target.value}})},M=q=>{i&&console.log("handleChangemMatterPasscode called with value:",q.target.value),v(q.target.value),d({id:x.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterpasscode",value:q.target.value}})};return e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matter settings"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(ee,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},id:"mjdebug-info",children:"Logger level:"}),e.jsxs(tt,{style:{height:"30px"},labelId:"select-mjlevel",id:"mjdebug-level",value:n,onChange:N,children:[e.jsx(F,{value:"Debug",children:"Debug"}),e.jsx(F,{value:"Info",children:"Info"}),e.jsx(F,{value:"Notice",children:"Notice"}),e.jsx(F,{value:"Warn",children:"Warn"}),e.jsx(F,{value:"Error",children:"Error"}),e.jsx(F,{value:"Fatal",children:"Fatal"})]}),e.jsx(Te,{style:{padding:"0px",margin:"0px"},control:e.jsx(Fe,{checked:g,onChange:$,name:"logOnFileMj"}),label:"Log on file:",labelPlacement:"start"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},children:"Mdns interface:"}),e.jsx(pe,{value:t,onChange:W,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:r.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},children:"Ipv4 address:"}),e.jsx(pe,{value:D,onChange:m,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:r.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},children:"Ipv6 address:"}),e.jsx(pe,{value:b,onChange:H,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:r.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},children:"Commissioning port:"}),e.jsx(pe,{value:A,onChange:C,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:r.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},children:"Commissioning discriminator:"}),e.jsx(pe,{value:E,onChange:f,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:r.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Ie,{style:{padding:"0px",margin:"0px"},children:"Commissioning passcode:"}),e.jsx(pe,{value:z,onChange:M,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:r.readOnly===!0,style:{height:"30px",padding:"0"}}})]})]})})]})}function Qn({matterbridgeInfo:r}){return e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge info"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(ee,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:["          ",e.jsx(qe,{value:r.matterbridgeVersion,label:"Current Version"}),e.jsx(qe,{value:r.matterbridgeLatestVersion,label:"Latest Version"}),e.jsx(qe,{value:r.homeDirectory,label:"Home Directory"}),e.jsx(qe,{value:r.rootDirectory,label:"Root Directory"}),e.jsx(qe,{value:r.matterbridgeDirectory,label:"Matterbridge Storage Directory"}),e.jsx(qe,{value:r.matterbridgePluginDirectory,label:"Matterbridge Plugin Directory"}),e.jsx(qe,{value:r.globalModulesDirectory,label:"Global Module Directory"})]})})]})}function qe({value:r,label:d}){return e.jsx(pe,{focused:!0,value:r,size:"small",label:d,variant:"standard",sx:{width:"400px"},InputProps:{readOnly:!0,sx:{color:"var(--div-text-color)","&:before":{borderBottomColor:"var(--main-label-color)"},"&:after":{borderBottomColor:"var(--main-label-color)"}}},InputLabelProps:{sx:{marginTop:"3px",color:"var(--main-label-color)","&.Mui-focused":{color:"var(--main-label-color)"}}}})}function Gn(){const{online:r,sendMessage:d,addListener:a,removeListener:n,getUniqueId:s}=o.useContext(be),{showSnackbarMessage:g,closeSnackbarMessage:y}=o.useContext(nt),[t,l]=o.useState(null),[D,R]=o.useState(null),[b,L]=o.useState(null),[A,w]=o.useState(null),[E,c]=o.useState({cpuUsage:0}),[z,v]=o.useState({totalMemory:"",freeMemory:"",heapTotal:"",heapUsed:"",external:"",arrayBuffers:"",rss:""}),[x,N]=o.useState({systemUptime:"",processUptime:""}),$=o.useRef(-1),[W,m]=o.useState(()=>cr);$.current||($.current=s(),console.log("Test uniqueId:",$)),o.useEffect(()=>{console.log("Test useEffect WebSocketMessage mounting");const C=f=>{if(f.src==="Matterbridge"&&f.dst==="Frontend"){if(xe(f)&&f.method==="restart_required"&&(console.log("Test received restart_required"),g("Restart required",0)),xe(f)&&f.method==="refresh_required"&&(console.log(`Test received refresh_required: changed=${f.params.changed} and sending api requests`),g("Refresh required",0),d({id:$.current,method:"/api/settings",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),d({id:$.current,method:"/api/plugins",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),d({id:$.current,method:"/api/devices",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}})),xe(f)&&f.method==="memory_update"&&(console.log("Test received memory_update",f),v(f.params)),xe(f)&&f.method==="cpu_update"&&(console.log("Test received cpu_update",f),c(f.params)),xe(f)&&f.method==="uptime_update"&&(console.log("Test received uptime_update",f),N(f.params)),Ve(f)&&f.method==="/api/settings"&&f.response&&(console.log("Test received /api/settings:",f.response),g("Test received /api/settings"),l(f.response)),Ve(f)&&f.method==="/api/plugins"&&f.response&&(console.log(`Test received ${f.response.length} plugins:`,f.response),g("Test received /api/plugins"),R(f.response)),Ve(f)&&f.method==="/api/devices"&&f.response){console.log(`Test received ${f.response.length} devices:`,f.response),g("Test received /api/devices"),L(f.response);for(const M of f.response)console.log("Test sending /api/clusters for device:",M.pluginName,M.name,M.endpoint),d({id:$.current,method:"/api/clusters",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{plugin:M.pluginName,endpoint:M.endpoint}})}Ve(f)&&f.method==="/api/clusters"&&f.response&&(console.log(`Test received ${f.response.clusters.length} clusters for device ${f.response.deviceName} endpoint ${f.response.endpoint}:`,f),g("Test received /api/clusters"),w(f.response))}};return a(C),console.log("Test useEffect WebSocketMessage mounted"),()=>{console.log("Test useEffect WebSocketMessage unmounting"),n(C),console.log("Test useEffect WebSocketMessage unmounted")}},[a,n,d,g]),o.useEffect(()=>(console.log("Test useEffect online mounting"),r&&(console.log("Test useEffect online received online"),d({id:$.current,method:"/api/settings",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),d({id:$.current,method:"/api/plugins",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),d({id:$.current,method:"/api/devices",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}})),console.log("Test useEffect online mounted"),()=>{console.log("Test useEffect online unmounted")}),[r,d,g]);const H=o.useCallback(C=>String(C.code),[]);return console.log("Test rendering..."),r?e.jsx("div",{className:"MbfPageDiv",style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"20px",width:"100%"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"256px",width:"256px",margin:"10px"}}),e.jsx("p",{children:"Welcome to the Test page of the Matterbridge frontend"}),e.jsx("div",{style:{margin:"0",padding:"0",gap:"0",width:"1200px",maxWidth:"1200px",height:"600px",maxHeight:"600px",overflow:"hidden",backgroundColor:"var(--div-bg-color)",border:"1px solid #0004ffff"},children:e.jsx(sr,{name:"Test",columns:Yn,rows:W,getRowKey:H,footerLeft:"Left Footer",footerRight:"Right Footer"})}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx(ae,{variant:"contained",color:"primary",onClick:()=>{console.log("Test button clicked"),g("Test button clicked"),y("Refresh required"),y("Restart required"),y("Test permanent message removal")},children:"Test"}),e.jsx(ae,{variant:"outlined",onClick:()=>{m(C=>{const f=C.findIndex(ve=>ve.code==="F123");if(f===-1)return C;const M=C[f],q={...M,population:(M.population||0)+1},ce=C.slice();return ce[f]=q,ce})},children:"Update F123"})]})]})}):e.jsx(Be,{})}const Kn=o.memo(Gn),Yn=[{id:"name",label:"Name",minWidth:50,maxWidth:100,required:!0},{id:"code",label:"ISOÂ Code",minWidth:100,render:(r,d,a,n)=>e.jsx("span",{style:{display:"inline-block",padding:"2px 6px",borderRadius:"8px",backgroundColor:"var(--chip-bg, #e6f4ff)",color:"var(--chip-fg, #0550ae)",fontFamily:'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',fontSize:"0.85em"},children:String(r)})},{id:"isIsland",label:"Island",minWidth:80,align:"center"},{id:"population",label:"Population",minWidth:170,align:"right",format:r=>r.toLocaleString("en-US")},{id:"size",label:"SizeÂ (kmÂ²)",minWidth:170,align:"right",format:r=>r.toLocaleString("en-US")},{id:"density",label:"Density",minWidth:170,align:"right",nosort:!0,format:r=>r.toFixed(2)},{id:"virtual",label:"Virtual",align:"right",required:!0,nosort:!0,render:(r,d,a,n)=>a.isIsland?"ðŸï¸":"ðŸžï¸"}];function we(r,d,a,n,s){const g=a/n;return{name:r,code:d,population:a,size:n,density:g,isIsland:s}}const cr=[we("India","IN",1324171354,3287263,!1),we("China","CN",1403500365,9596961,!1),we("Italy","IT",60483973,301340,!1),we("United States","US",327167434,9833520,!1),we("Canada is a truly wonderful country","CA",37602103,9984670,!1),we("Australia","AU",25475400,7692024,!0),we("Germany","DE",83019200,357578,!1),we("Ireland","IE",4857e3,70273,!0),we("Mexico","MX",126577691,1972550,!1),we("Japan","JP",126317e3,377973,!0),we("France","FR",67022e3,640679,!1),we("United Kingdom","GB",67545757,242495,!0),we("Russia","RU",146793744,17098246,!1),we("Nigeria","NG",200962417,923768,!1),we("Brazil","BR",210147125,8515767,!1)],Kt=["Zor","Eld","Myth","Drak","Lum","Xen","Thal","Quor","Vex","Nyx"],Yt=["aria","dor","mere","land","wyn","gard","heim","quess","tor","vale"];for(let r=0;r<2e3;r++){const d=`${Kt[r%Kt.length]}${Yt[r%Yt.length]} ${r}`,a=`F${r.toString().padStart(3,"0")}`,n=Math.floor(Math.random()*1e9),s=Math.floor(Math.random()*1e7),g=Math.random()<.2;cr.push(we(d,a,n,s,g))}function Xn(r,d){i&&console.log("getCssVariable:",r,"defaultValue",d);const a=getComputedStyle(document.body).getPropertyValue(r).trim();return a||console.error("getCssVariable: undefined",a),a||d}function Zn(r){return uo({palette:{primary:{main:r},action:{disabled:"var(--main-label-color)"},text:{disabled:"var(--main-label-color)"}},typography:{fontFamily:"Roboto, Helvetica, Arial, sans-serif"},components:{MuiDialog:{styleOverrides:{paper:{color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",border:"2px solid var(--div-border-color)",borderRadius:"var(--div-border-radius)",boxShadow:"2px 2px 5px var(--div-shadow-color)"}}},MuiTooltip:{defaultProps:{placement:"top-start",arrow:!0}},MuiButton:{styleOverrides:{root:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)","&:hover":{backgroundColor:"var(--main-button-bg-color)"},"&.Mui-disabled":{color:"var(--main-button-color)",backgroundColor:"var(--main-grey-color)"}},contained:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},outlined:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},text:{color:"var(--main-button-color)"}},defaultProps:{variant:"contained",size:"small"}},MuiIconButton:{styleOverrides:{root:{color:"var(--main-icon-color)","&:hover .MuiSvgIcon-root":{color:"var(--primary-color)"}}}},MuiCheckbox:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-checked":{color:"var(--primary-color)"}}}},MuiTextField:{defaultProps:{size:"small",variant:"outlined",fullWidth:!0}},MuiOutlinedInput:{styleOverrides:{root:{backgroundColor:"var(--div-bg-color)","& .MuiOutlinedInput-notchedOutline":{borderColor:"var(--main-label-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--main-text-color)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"var(--primary-color)"},padding:"0px"},input:{color:"var(--div-text-color)",padding:"4px 8px"}}},MuiInputLabel:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-focused":{color:"var(--primary-color)"}}}},MuiFormLabel:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-focused":{color:"var(--main-label-color)"}}}},MuiFormControl:{styleOverrides:{root:{color:"var(--main-grey-color)"}}},MuiRadio:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-checked":{color:"var(--primary-color)"}}}},MuiSelect:{styleOverrides:{root:{backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)",height:"30px","&:hover":{borderColor:"var(--main-text-color)"},"&.Mui-focused":{borderColor:"var(--primary-color)"}}}},MuiMenu:{styleOverrides:{paper:{backgroundColor:"var(--main-menu-bg-color)",padding:"0px",margin:"0px"},list:{padding:"0px"}}},MuiMenuItem:{styleOverrides:{root:{color:"var(--main-menu-color)",backgroundColor:"var(--main-menu-bg-color)","&:hover":{backgroundColor:"var(--main-menu-hover-color)"},"&.Mui-selected":{color:"var(--main-menu-color)",backgroundColor:"var(--main-menu-bg-color)"},"&.Mui-selected:hover":{backgroundColor:"var(--main-menu-hover-color)"}}}},MuiListItemButton:{styleOverrides:{root:{cursor:"pointer","&:hover":{backgroundColor:"var(--main-bg-color)"}}}},MuiListItemIcon:{styleOverrides:{root:{color:"var(--div-text-color)"}}},MuiListItemText:{styleOverrides:{primary:{fontSize:"16px",fontWeight:"bold",color:"var(--div-text-color)"},secondary:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"}}}}})}let i=!1;const ei=()=>{i=!i},pr=o.createContext(void 0);function ti({children:r}){const[d,a]=o.useState(!1),[n,s]=o.useState(""),g=async y=>{try{const t=await fetch("./api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:y})});if(t.ok){const{valid:l}=await t.json();l?a(!0):y!==""&&s("Incorrect password!")}else console.error("Failed to log in:",t.statusText)}catch(t){console.error("Failed to log in:",t)}};return e.jsx(pr.Provider,{value:{loggedIn:d,logIn:g,errorMessage:n},children:r})}function ri(){const[r,d]=o.useState(""),a=o.useContext(pr),[n,s]=o.useState("#1976d2");if(!a)throw new Error("AuthContext not found");const{loggedIn:g,logIn:y,errorMessage:t}=a,l=w=>{w.preventDefault(),y(r)},D={display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",backgroundColor:"var(--main-bg-color)"},R={display:"flex",flexDirection:"column",maxWidth:"400px",margin:"0 auto",padding:"20px",gap:"20px",border:"1px solid var(--div-border-color)",borderRadius:"var(--div-border-radius)",boxShadow:"2px 2px 5px var(--div-shadow-color)",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},b={margin:"10px 0",padding:"3px 3px",fontSize:"14px",width:"230px",border:"1px solid var(--main-label-color)",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"};o.useEffect(()=>{i&&console.log("Setting frontend theme");const w=localStorage.getItem("frontendTheme");i&&console.log("Saved theme:",w),w?document.body.setAttribute("frontend-theme",w):document.body.setAttribute("frontend-theme","dark");const E=Xn("--primary-color","#1976d2");i&&console.log("Primary color from CSS:",E),s(E)},[]);const L=window.location.pathname.includes("/matterbridge/")?"/matterbridge":window.location.href.includes("/api/hassio_ingress/")?window.location.pathname:"/";i&&(console.log("Loading App..."),console.log("- production mode"),console.log(`- with href = "${window.location.href}"`),console.log(`- pathname = "${window.location.pathname}"`),console.log(`- baseName = "${L}"`));const A=Zn(n);return y(""),g?e.jsx(mo,{theme:A,children:e.jsx(Sr,{dense:!0,maxSnack:10,preventDuplicate:!0,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(Bo,{children:e.jsx(Jo,{children:e.jsx(xr,{basename:L,children:e.jsxs("div",{className:"MbfScreen",children:[e.jsx(Go,{}),e.jsxs(br,{children:[e.jsx(Ke,{path:"/",element:e.jsx(jn,{})}),e.jsx(Ke,{path:"/devices",element:e.jsx(_n,{})}),e.jsx(Ke,{path:"/log",element:e.jsx(An,{})}),e.jsx(Ke,{path:"/settings",element:e.jsx(qn,{})}),e.jsx(Ke,{path:"/test",element:e.jsx(Kn,{})}),e.jsx(Ke,{path:"*",element:e.jsx(vr,{to:"/"})})]})]})})})})})}):e.jsx("div",{style:D,children:e.jsxs("form",{onSubmit:l,style:R,children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"64px",width:"64px"}}),e.jsx("h3",{style:{color:"var(--div-text-color)"},children:"Welcome to Matterbridge"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:"20px"},children:[e.jsx("input",{type:"text",name:"username",autoComplete:"username",style:{display:"none"},tabIndex:-1}),e.jsx("input",{type:"password",value:r,onChange:w=>d(w.target.value),style:b,placeholder:"password",autoComplete:"current-password"}),e.jsx("button",{type:"submit",style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",borderColor:"var(--div-bg-color)"},children:"Log in"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",margin:0,height:"30px"},children:t&&e.jsx("p",{style:{color:"red"},children:t})})]})})}function oi(){return e.jsx(ti,{children:e.jsx(ri,{})})}yr.createRoot(document.getElementById("root")).render(e.jsx(jr.StrictMode,{children:e.jsx(oi,{})}));
