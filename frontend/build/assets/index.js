import{B as e,y as r,Q as Xe,S as nr,U as ir,V as Ve,X as sr,Y as ar,H as lr}from"./vendor_node_modules.js";import{u as dr,S as cr}from"./vendor_notistack.js";import{D as Ie,a as De,b as Ne,B as oe,c as Y,A as pr,I as Q,C as ur,T as R,S as gr,F as Vt,H as mr,d as Et,e as We,R as dt,P as $e,M as hr,f as ze,g as D,L as z,h as ee,i as Ze,V as et,j as Se,k as ht,l as fr,m as xr,n as de,o as br,p as vr,q as ct,r as re,s as Te,K as St,t as Mt,u as ut,v as tt,w as Je,x as rt,W as Ge,y as ot,z as nt,E as He,G as kt,J as It,N as yr,O as jr,Q as Cr,U as Le,X as At,Y as vt,Z as wr,_ as Sr,$ as Mr,a0 as kr,a1 as _t,a2 as pt,a3 as Ir,a4 as Dr,a5 as Nr,a6 as Pr,a7 as Dt,a8 as Wr,a9 as Fr,aa as Lr,ab as Tr,ac as $r,ad as Rr,ae as Hr,af as Nt,ag as Or,ah as Vr,ai as Er,aj as Ar,ak as _r,al as qr,am as zr,an as Ur,ao as Br,ap as Qr,aq as Kr,ar as Jr,as as Gr,at as Yr,au as Xr,av as Pt,aw as Ue,ax as qt,ay as je,az as zt,aA as gt,aB as Fe,aC as Zr,aD as eo}from"./vendor_mui.js";import{Q as to}from"./vendor_qrcode.js";import{I as te,m as Wt,a as ro,b as oo,c as Ft,d as no,e as io,f as so,g as ao,h as lo,i as co,j as po,k as uo,l as go,n as mo,o as ho,p as fo,q as Lt,r as xo,s as bo,t as vo,u as yo,v as jo,w as Co,x as wo,y as So,z as Tt,A as Mo,B as ko}from"./vendor_mdi.js";import{F as Io,v as Do,e as No,a as Po,g as Wo,b as Fo,c as Lo,d as ft,A as To}from"./vendor_rjsf.js";import"./vendor_lodash.js";import"./vendor_emotion.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const y of s)if(y.type==="childList")for(const m of y.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&n(m)}).observe(document,{childList:!0,subtree:!0});function d(s){const y={};return s.integrity&&(y.integrity=s.integrity),s.referrerPolicy&&(y.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?y.credentials="include":s.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function n(s){if(s.ep)return;s.ep=!0;const y=d(s);fetch(s.href,y)}})();function $o({open:o,title:c,message:d,onConfirm:n,onCancel:s}){const y=t=>{i&&console.log("Confirmed"),t.preventDefault(),n()},m=t=>{i&&console.log("Canceled"),t.preventDefault(),s()};return e.jsxs(Ie,{open:o,children:[e.jsx(De,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:c})]})}),e.jsxs(Ne,{children:[e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",margin:"0",marginBottom:"20px",maxHeight:"350px",maxWidth:"350px"},children:e.jsx("p",{style:{flex:1,margin:"0"},children:d})}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-around"},children:[e.jsx(oe,{onClick:y,variant:"contained",color:"primary",size:"small",children:"Confirm"}),e.jsx(oe,{onClick:m,variant:"contained",color:"primary",size:"small",children:"Cancel"})]})]})]})}const it=[],Be=r.createContext(null);function Ro({children:o}){const{enqueueSnackbar:c,closeSnackbar:d}=dr(),n=r.useCallback(v=>{i&&console.log(`UiProvider closeSnackbarMessage: message ${v}`);const w=it.findIndex(H=>H.message===v);w!==-1&&(d(it[w].key),it.splice(w,1),i&&console.log(`UiProvider closeSnackbarMessage: message ${v} removed from persistMessages`))},[d]),s=r.useCallback((v,w,H)=>{i&&console.log(`UiProvider showSnackbarMessage: message ${v} timeout ${w}`);const j=c(v,{variant:"default",autoHideDuration:w==null||w>0?(w??5)*1e3:null,persist:w===0,content:M=>e.jsx(Y,{sx:{margin:"0",padding:"0",width:"300px",marginRight:"30px"},children:e.jsx(pr,{severity:H??"info",variant:"filled",sx:{color:"#fff",fontWeight:"normal",width:"100%",cursor:"pointer",padding:"0px 10px"},onClick:()=>d(M),action:e.jsx(Q,{size:"small",onClick:()=>d(M),sx:{color:"#fff"},children:e.jsx(ur,{fontSize:"small"})}),children:v},M)},M)});w===0&&(i&&console.log(`UiProvider showSnackbarMessage: message ${v} timeout ${w} - persist key ${j}`),it.push({message:v,key:j}))},[c,d]),[y,m]=r.useState(!1),[t,x]=r.useState(""),[W,u]=r.useState(""),[C,E]=r.useState(""),$=r.useRef(null),T=r.useRef(null),V=()=>{i&&console.log(`UiProvider handle confirm action ${C}`),m(!1),$.current&&$.current(C)},f=()=>{i&&console.log(`UiProvider handle cancel action ${C}`),m(!1),T.current&&T.current(C)},O=r.useCallback((v,w,H,j,M)=>{i&&console.log(`UiProvider showConfirmCancelDialog for command ${H}`),x(v),u(w),E(H),$.current=j,T.current=M,m(!0)},[]),b=r.useMemo(()=>({showSnackbarMessage:s,closeSnackbarMessage:n,closeSnackbar:d,showConfirmCancelDialog:O}),[s,n,d,O]);return e.jsxs(Be.Provider,{value:b,children:[e.jsx($o,{open:y,title:t,message:W,onConfirm:V,onCancel:f}),o]})}const Ut=r.createContext(null),fe=r.createContext(null);function Ho({children:o}){const[c,d]=r.useState(localStorage.getItem("logFilterLevel")??"info"),[n,s]=r.useState(localStorage.getItem("logFilterSearch")??"*"),[y,m]=r.useState([]),[t,x]=r.useState(1e3),[W,u]=r.useState(!0),[C,E]=r.useState(!1),{showSnackbarMessage:$,closeSnackbarMessage:T,closeSnackbar:V}=r.useContext(Be),f=r.useRef([]),O=r.useRef(null),b=r.useRef(1),v=r.useRef(Math.floor(Math.random()*999e3)+1e3),w=r.useRef(null),H=r.useRef(null),j=r.useRef(null),M=r.useRef(c),U=r.useRef(n),a=r.useMemo(()=>window.location.href.replace(/^http/,"ws"),[]),l=r.useMemo(()=>window.location.href.includes("api/hassio_ingress"),[]),g=100,h=60,L=50,X=300;r.useEffect(()=>{M.current=c},[c]),r.useEffect(()=>{U.current=n},[n]);const be=r.useCallback(()=>Math.floor(Math.random()*999e3)+1e3,[]),he=r.useCallback(S=>{if(O.current&&O.current.readyState===WebSocket.OPEN)try{i&&console.log(`WebSocket sending message with id ${S.id}:`,S),S.id===void 0&&(S.id=v.current);const p=JSON.stringify(S);O.current.send(p),i&&console.log("WebSocket sent message:",S)}catch(p){i&&console.error(`WebSocket error sending message: ${p}`)}else i&&console.error("WebSocket message not sent, WebSocket not connected:",S)},[]),ge=r.useCallback((S,p)=>{m(J=>[...J,{level:S,time:"",name:"",message:p}])},[]),G=r.useCallback((S,p)=>{d(S),s(p),ge("WebSocket",`Filtering by log level "${S}" and log search "${p}"`)},[ge]),ne=r.useCallback((S,p)=>{i&&console.log(`WebSocket addListener id ${p}:`,S),(p==null||isNaN(p)||p===0)&&console.error("WebSocket addListener called without id, listener not added:",S),f.current=[...f.current,{listener:S,id:p}],i&&console.log("WebSocket addListener total listeners:",f.current.length)},[]),F=r.useCallback(S=>{i&&console.log("WebSocket removeListener:",S),f.current=f.current.filter(p=>p.listener!==S),i&&console.log("WebSocket removeListener total listeners:",f.current.length)},[]),A=r.useCallback(()=>{a===""||a===null||a===void 0||(ge("WebSocket",`Connecting to WebSocket: ${a}`),O.current=new WebSocket(a),O.current.onmessage=S=>{C||E(!0);try{const p=JSON.parse(S.data);if(p.id===void 0||p.src===void 0||p.dst===void 0){console.error("WebSocket undefined message id/src/dst:",p);return}if(p.src!=="Matterbridge"||p.dst!=="Frontend"){console.error("WebSocket invalid message src/dst:",p);return}if(p.error){console.error("WebSocket error message response:",p);return}if(p.id===v.current&&p.method==="pong"&&p.response==="pong"){i&&console.log(`WebSocket pong response message id ${p.id}:`,p),H.current&&clearTimeout(H.current),H.current=null;return}else if(p.method==="snackbar"&&p.response&&p.response.message){i&&console.log(`WebSocket message id ${p.id} method ${p.method}:`,p),$(p.response.message,p.response.timeout,p.response.severity);return}else if(p.method==="close_snackbar"&&p.response&&p.response.message){i&&console.log(`WebSocket message id ${p.id} method ${p.method}:`,p),T(p.response.message);return}else if(p.method==="log"){if(!p.response||!p.response.level||!p.response.time||!p.response.name||!p.response.message||["debug","info","notice","warn","error","fatal"].includes(p.response.level)&&(M.current==="info"&&p.response.level==="debug"||M.current==="notice"&&(p.response.level==="debug"||p.response.level==="info")||M.current==="warn"&&(p.response.level==="debug"||p.response.level==="info"||p.response.level==="notice")||M.current==="error"&&(p.response.level==="debug"||p.response.level==="info"||p.response.level==="notice"||p.response.level==="warn")||M.current==="fatal"&&(p.response.level==="debug"||p.response.level==="info"||p.response.level==="notice"||p.response.level==="warn"||p.response.level==="error"))||U.current!=="*"&&U.current!==""&&!p.response.message.toLowerCase().includes(U.current.toLowerCase())&&!p.response.name.toLowerCase().includes(U.current.toLowerCase())||p.response.name==="Commissioning"&&p.response.message.includes("is uncommissioned"))return;m(se=>{const ae=[...se,{level:p.response.level,time:p.response.time,name:p.response.name,message:p.response.message}];return ae.length>t?ae.slice(t/10):ae})}else{if(i&&console.log(`WebSocket received message id ${p.id} method ${p.method}:`,p),p.id===0)f.current.forEach(J=>J.listener(p));else{const J=f.current.find(se=>se.id===p.id);J?J.listener(p):i&&console.debug(`WebSocket no listener found for message id ${p.id}:`,p)}return}}catch(p){console.error(`WebSocketUse error parsing message: ${p}`)}},O.current.onopen=()=>{i&&console.log(`WebSocket: Connected to WebSocket: ${a}`),ge("WebSocket",`Connected to WebSocket: ${a}`),E(!0),V(),b.current=1,j.current=setTimeout(()=>{w.current=setInterval(()=>{he({id:v.current,method:"ping",src:"Frontend",dst:"Matterbridge",params:{}}),H.current&&clearTimeout(H.current),H.current=setTimeout(()=>{i&&console.error(`WebSocketUse: No pong response received from WebSocket: ${a}`),ge("WebSocket",`No pong response received from WebSocket: ${a}`),E(!1)},1e3*L)},1e3*h)},1e3*X)},O.current.onclose=()=>{i&&console.error(`WebSocket: Disconnected from WebSocket ${l?"with Ingress":""}: ${a}`),ge("WebSocket",`Disconnected from WebSocket: ${a}`),E(!1),V(),j.current&&clearTimeout(j.current),H.current&&clearTimeout(H.current),w.current&&clearInterval(w.current),ge("WebSocket",`Reconnecting (attempt ${b.current} of ${g}) to WebSocket${l?" (Ingress)":""}: ${a}`),l?setTimeout(N,5e3):b.current===1?N():b.current<g?setTimeout(N,1e3*b.current):ge("WebSocket",`Reconnect attempts exceeded limit of ${g} retries, refresh the page to reconnect to: ${a}`),b.current=b.current+1},O.current.onerror=S=>{i&&console.error(`WebSocket: WebSocket error connecting to ${a}:`,S),ge("WebSocket",`WebSocket error connecting to ${a}`)})},[a]),N=r.useCallback(()=>{i&&console.log(`WebSocket attemptReconnect ${b.current}/${g} to:`,a),A()},[A]);r.useEffect(()=>(A(),()=>{O.current&&O.current.readyState===WebSocket.OPEN&&O.current.close()}),[A]);const P=r.useMemo(()=>({messages:y,maxMessages:t,autoScroll:W,setMessages:m,setLogFilters:G,setMaxMessages:x,setAutoScroll:u}),[y,m,G]),k=r.useMemo(()=>({maxMessages:t,autoScroll:W,logFilterLevel:c,logFilterSearch:n,setMessages:m,setLogFilters:G,setMaxMessages:x,setAutoScroll:u,online:C,retry:b.current,getUniqueId:be,addListener:ne,removeListener:F,sendMessage:he,logMessage:ge}),[t,W,m,G,x,u,C,b.current,ne,F,he,ge]);return e.jsx(Ut.Provider,{value:P,children:e.jsx(fe.Provider,{value:k,children:o})})}function Oo(){const{showSnackbarMessage:o,showConfirmCancelDialog:c}=r.useContext(Be),{online:d,sendMessage:n,logMessage:s,addListener:y,removeListener:m,getUniqueId:t}=r.useContext(fe),[x,W]=r.useState(!1),[u,C]=r.useState(!1),[E,$]=r.useState(!1),[T,V]=r.useState(!1),[f,O]=r.useState(null),b=r.useRef(t()),[v,w]=r.useState(null),[H,j]=r.useState(null),[M,U]=r.useState(null),[a,l]=r.useState(null),[g,h]=r.useState(null),L=()=>{window.open("https://www.buymeacoffee.com/luligugithub","_blank")},X=()=>{window.open("https://github.com/Luligu/matterbridge/blob/main/README.md","_blank")},be=()=>{f?.matterbridgeInformation.matterbridgeVersion.includes("-dev-")?window.open("https://github.com/Luligu/matterbridge/blob/dev/CHANGELOG.md","_blank"):window.open("https://github.com/Luligu/matterbridge/blob/main/CHANGELOG.md","_blank")},he=()=>{window.open("https://discord.gg/QX58CDe6hd","_blank")},ge=()=>{window.open("https://github.com/Luligu/matterbridge","_blank")},G=()=>{n({id:b.current,sender:"Header",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:"matterbridge",restart:!0}})},ne=()=>{n({id:b.current,sender:"Header",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:"matterbridge@dev",restart:!0}})},F=()=>{n({id:b.current,sender:"Header",method:"/api/checkupdates",src:"Frontend",dst:"Matterbridge",params:{}})},A=()=>{i&&console.log("Header: handleShellySystemUpdateClick"),s("Matterbridge","Installing system updates..."),n({id:b.current,sender:"Header",method:"/api/shellysysupdate",src:"Frontend",dst:"Matterbridge",params:{}})},N=()=>{i&&console.log("Header: handleShellyMainUpdateClick"),s("Matterbridge","Installing software updates..."),n({id:b.current,sender:"Header",method:"/api/shellymainupdate",src:"Frontend",dst:"Matterbridge",params:{}})},P=()=>{i&&console.log("Header: handleShellyCreateSystemLog"),n({id:b.current,sender:"Header",method:"/api/shellycreatesystemlog",src:"Frontend",dst:"Matterbridge",params:{}})},k=()=>{i&&console.log("Header: handleShellyDownloadSystemLog"),s("Matterbridge","Downloading Shelly system log..."),o("Downloading Shelly system log...",5),window.location.href="./api/shellydownloadsystemlog"},S=()=>{f?.matterbridgeInformation.restartMode===""?n({id:b.current,sender:"Header",method:"/api/restart",src:"Frontend",dst:"Matterbridge",params:{}}):n({id:b.current,sender:"Header",method:"/api/shutdown",src:"Frontend",dst:"Matterbridge",params:{}})},p=()=>{n({id:b.current,sender:"Header",method:"/api/shutdown",src:"Frontend",dst:"Matterbridge",params:{}})},J=()=>{n({id:b.current,sender:"Header",method:"/api/reboot",src:"Frontend",dst:"Matterbridge",params:{}})},se=()=>{n({id:b.current,sender:"Header",method:"/api/softreset",src:"Frontend",dst:"Matterbridge",params:{}})},ae=()=>{n({id:b.current,sender:"Header",method:"/api/hardreset",src:"Frontend",dst:"Matterbridge",params:{}})},ce=B=>{w(B.currentTarget)},_=B=>{i&&console.log("Header: handleMenuClose",B),w(null),B==="download-mblog"?(s("Matterbridge","Downloading matterbridge log..."),o("Downloading matterbridge log...",5),window.location.href="./api/download-mblog"):B==="download-mjlog"?(s("Matterbridge","Downloading matter log..."),o("Downloading matter log...",5),window.location.href="./api/download-mjlog"):B==="view-mblog"?(s("Matterbridge","Loading matterbridge log..."),o("Loading matterbridge log...",5),window.location.href="./api/view-mblog"):B==="view-mjlog"?(s("Matterbridge","Loading matter log..."),o("Loading matter log...",5),window.location.href="./api/view-mjlog"):B==="view-shellylog"?(s("Matterbridge","Loading shelly system log..."),o("Loading shelly system log...",5),window.location.href="./api/shellyviewsystemlog"):B==="download-mbstorage"?(s("Matterbridge","Downloading matterbridge storage..."),o("Downloading matterbridge storage...",5),window.location.href="./api/download-mbstorage"):B==="download-pluginstorage"?(s("Matterbridge","Downloading matterbridge plugins storage..."),o("Downloading matterbridge plugins storage...",5),window.location.href="./api/download-pluginstorage"):B==="download-pluginconfig"?(s("Matterbridge","Downloading matterbridge plugins config..."),o("Downloading matterbridge plugins config...",5),window.location.href="./api/download-pluginconfig"):B==="download-mjstorage"?(s("Matterbridge","Downloading matter storage..."),o("Downloading matter storage...",5),window.location.href="./api/download-mjstorage"):B==="download-backup"?(s("Matterbridge","Downloading backup..."),o("Downloading backup...",10),window.location.href="./api/download-backup"):B==="update"?G():B==="updatedev"?ne():B==="updatecheck"?F():B==="shelly-sys-update"?A():B==="shelly-main-update"?N():B==="shelly-create-system-log"?P():B==="shelly-download-system-log"?k():B==="softreset"?se():B==="hardreset"?ae():B==="restart"?S():B==="shutdown"?p():B==="reboot"?J():B==="create-backup"?n({id:b.current,sender:"Header",method:"/api/create-backup",src:"Frontend",dst:"Matterbridge",params:{}}):B==="unregister"?n({id:b.current,sender:"Header",method:"/api/unregister",src:"Frontend",dst:"Matterbridge",params:{}}):B==="reset"?n({id:b.current,sender:"Header",method:"/api/reset",src:"Frontend",dst:"Matterbridge",params:{}}):B==="factoryreset"&&n({id:b.current,sender:"Header",method:"/api/factoryreset",src:"Frontend",dst:"Matterbridge",params:{}})},ie=B=>{i&&console.log("Header: handleMenuCloseCancel:",B),w(null)},ue=B=>{j(B.currentTarget)},Z=()=>{j(null)},we=B=>{U(B.currentTarget)},ye=()=>{U(null)},me=B=>{l(B.currentTarget)},K=()=>{l(null)},le=B=>{h(B.currentTarget)},ve=()=>{h(null)},Qe=()=>{zn(),i&&console.log("Matterbridge logo clicked: debug is now",i)};return r.useEffect(()=>{const B=I=>{i&&console.log("Header received WebSocket Message:",I),I.method==="/api/settings"&&I.id===b.current?(i&&console.log("Header received settings:",I.response),O(I.response),W(I.response.matterbridgeInformation.restartRequired||I.response.matterbridgeInformation.fixedRestartRequired),C(I.response.matterbridgeInformation.fixedRestartRequired),$(I.response.matterbridgeInformation.updateRequired)):I.method==="refresh_required"&&I.response.changed==="settings"?(i&&console.log(`Header received refresh_required: changed=${I.response.changed} and sending /api/settings request`),n({id:b.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})):I.method==="restart_required"?(i&&console.log(`Header received restart_required with fixed: ${I.response.fixed}`),W(!0),I.response.fixed===!0&&C(!0)):I.method==="restart_not_required"?(i&&console.log("Header received restart_not_required"),W(!1)):I.method==="update_required"?(i&&console.log("Header received update_required"),I.response.devVersion===!0?V(!0):$(!0),n({id:b.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})):I.method==="shelly_sys_update"?(i&&console.log("Header received WS_ID_SHELLY_SYS_UPDATE:"),O(pe=>pe?{matterbridgeInformation:{...pe.matterbridgeInformation,shellySysUpdate:I.response.available},systemInformation:pe.systemInformation}:null)):I.method==="shelly_main_update"&&(i&&console.log("Header received WS_ID_SHELLY_MAIN_UPDATE:"),O(pe=>pe?{matterbridgeInformation:{...pe.matterbridgeInformation,shellyMainUpdate:I.response.available},systemInformation:pe.systemInformation}:null))};return y(B,b.current),i&&console.log(`Header added WebSocket listener id ${b.current}`),()=>{m(B),i&&console.log("Header removed WebSocket listener")}},[y,m,n,o]),r.useEffect(()=>{d&&(i&&console.log("Header sending /api/settings requests"),n({id:b.current,sender:"Header",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}))},[d,n]),i&&console.log("Header rendering..."),!d||!f?null:e.jsxs("div",{className:"header",children:[e.jsxs("div",{className:"sub-header",children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"30px"},onClick:Qe}),e.jsx("h2",{style:{fontSize:"22px",color:"var(--main-icon-color)",margin:"0px"},children:"Matterbridge"}),e.jsxs("nav",{children:[e.jsx(Xe,{to:"/",className:"nav-link",children:"Home"}),e.jsx(Xe,{to:"/devices",className:"nav-link",children:"Devices"}),e.jsx(Xe,{to:"/log",className:"nav-link",children:"Logs"}),e.jsx(Xe,{to:"/settings",className:"nav-link",children:"Settings"})]})]}),e.jsxs("div",{className:"sub-header",children:[!f.matterbridgeInformation.readOnly&&E&&e.jsx(R,{title:"New Matterbridge version available, click to install",children:e.jsxs("span",{className:"status-warning",onClick:G,children:["Update to v.",f.matterbridgeInformation.matterbridgeLatestVersion]})}),!f.matterbridgeInformation.readOnly&&T&&e.jsx(R,{title:"New Matterbridge dev version available, click to install",children:e.jsxs("span",{className:"status-warning",onClick:ne,children:["Update to new dev v.",f.matterbridgeInformation.matterbridgeDevVersion.split("-dev-")[0]]})}),!f.matterbridgeInformation.readOnly&&e.jsx(R,{title:"Matterbridge version, click to see the changelog",children:e.jsxs("span",{className:"status-information",onClick:be,children:["v.",f.matterbridgeInformation.matterbridgeVersion]})}),f.matterbridgeInformation.shellyBoard&&e.jsx("img",{src:"Shelly.svg",alt:"Shelly Icon",style:{height:"30px",padding:"0px",margin:"0px",marginRight:"30px"}}),f.matterbridgeInformation.bridgeMode!==""&&f.matterbridgeInformation.readOnly===!1?e.jsx(R,{title:"Bridge mode",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:f.matterbridgeInformation.bridgeMode})}):null,f.matterbridgeInformation.restartMode!==""&&f.matterbridgeInformation.readOnly===!1?e.jsx(R,{title:"Restart mode",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:f.matterbridgeInformation.restartMode})}):null,f.matterbridgeInformation.profile&&f.matterbridgeInformation.profile!==""&&f.matterbridgeInformation.readOnly===!1?e.jsx(R,{title:"Current profile",children:e.jsx("span",{className:"status-information",style:{cursor:"default"},children:f.matterbridgeInformation.profile})}):null]}),e.jsxs("div",{className:"sub-header",style:{gap:"5px"},children:[f.matterbridgeInformation.readOnly===!1?e.jsx(R,{title:"Matterbridge discord group",children:e.jsx("img",{src:"discord.svg",alt:"Discord Logo",style:{cursor:"pointer",height:"25px"},onClick:he})}):null,f.matterbridgeInformation.readOnly===!1?e.jsx(R,{title:"Give a star to Matterbridge",children:e.jsx(Q,{style:{color:"#FFD700",margin:"0",padding:"0"},onClick:ge,children:e.jsx(gr,{})})}):null,f.matterbridgeInformation.readOnly===!1?e.jsx(R,{title:"Sponsor Matterbridge",children:e.jsx(Q,{style:{color:"#b6409c",margin:"0",padding:"0"},onClick:L,children:e.jsx(Vt,{})})}):null,e.jsx(R,{title:"Matterbridge help",children:e.jsx(Q,{style:{color:"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:X,children:e.jsx(mr,{})})}),e.jsx(R,{title:"Matterbridge changelog",children:e.jsx(Q,{style:{color:"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:be,children:e.jsx(Et,{})})}),f.matterbridgeInformation&&!f.matterbridgeInformation.readOnly&&e.jsx(R,{title:"Update matterbridge to latest version",children:e.jsx(Q,{style:{color:E?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0"},onClick:G,children:e.jsx(We,{})})}),f.matterbridgeInformation&&f.matterbridgeInformation.shellyBoard&&f.matterbridgeInformation.shellySysUpdate&&e.jsx(R,{title:"Shelly system update",children:e.jsx(Q,{style:{color:"var(--primary-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:A,children:e.jsx(We,{})})}),f.matterbridgeInformation&&f.matterbridgeInformation.shellyBoard&&f.matterbridgeInformation.shellyMainUpdate&&e.jsx(R,{title:"Shelly software update",children:e.jsx(Q,{style:{color:"var(--primary-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:N,children:e.jsx(We,{})})}),e.jsx(R,{title:"Restart matterbridge",children:e.jsx(Q,{style:{color:x||u?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:S,children:e.jsx(dt,{})})}),f.matterbridgeInformation.restartMode===""?e.jsx(R,{title:"Shut down matterbridge",children:e.jsx(Q,{style:{color:x||u?"var(--primary-color)":"var(--main-icon-color)",margin:"0",marginLeft:"5px",padding:"0px"},onClick:p,children:e.jsx($e,{})})}):null,e.jsx(R,{title:"Download, backup and more",children:e.jsx(Q,{onClick:ce,children:e.jsx(hr,{style:{color:"var(--main-icon-color)"}})})}),e.jsxs(ze,{id:"command-menu",anchorEl:v,keepMounted:!0,open:!!v,onClose:()=>_(""),children:[f.matterbridgeInformation&&!f.matterbridgeInformation.readOnly&&e.jsxs(D,{onClick:()=>_("update"),children:[e.jsx(z,{children:e.jsx(We,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Install latest stable",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),f.matterbridgeInformation&&!f.matterbridgeInformation.readOnly&&e.jsxs(D,{onClick:()=>_("updatedev"),children:[e.jsx(z,{children:e.jsx(We,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Install latest dev",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),f.matterbridgeInformation&&!f.matterbridgeInformation.readOnly&&e.jsxs(D,{onClick:()=>_("updatecheck"),children:[e.jsx(z,{children:e.jsx(We,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Check for updates",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),f.matterbridgeInformation&&f.matterbridgeInformation.shellyBoard&&f.matterbridgeInformation.shellySysUpdate&&e.jsxs(D,{onClick:()=>_("shelly-sys-update"),children:[e.jsx(z,{children:e.jsx(We,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Shelly system update",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),f.matterbridgeInformation&&f.matterbridgeInformation.shellyBoard&&f.matterbridgeInformation.shellyMainUpdate&&e.jsxs(D,{onClick:()=>_("shelly-main-update"),children:[e.jsx(z,{children:e.jsx(We,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Shelly software update",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(D,{onClick:()=>_("restart"),children:[e.jsx(z,{children:e.jsx(dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Restart",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),f.matterbridgeInformation.restartMode===""?e.jsxs(D,{onClick:()=>_("shutdown"),children:[e.jsx(z,{children:e.jsx($e,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Shutdown",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}):null,f.matterbridgeInformation&&f.matterbridgeInformation.shellyBoard&&e.jsxs(D,{onClick:()=>{c("Reboot","Are you sure you want to reboot the Shelly board?","reboot",_,ie)},children:[e.jsx(z,{children:e.jsx(dt,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Reboot...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsx(Ze,{}),e.jsxs(D,{onClick:we,children:[e.jsx(z,{children:e.jsx(et,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"View",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(ze,{id:"sub-menu-view",anchorEl:M,keepMounted:!0,open:!!M,onClose:ye,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(D,{onClick:()=>{_("view-mblog"),ye()},children:[e.jsx(z,{children:e.jsx(et,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Matterbridge log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(D,{onClick:()=>{_("view-mjlog"),ye()},children:[e.jsx(z,{children:e.jsx(et,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Matter log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),f.matterbridgeInformation&&f.matterbridgeInformation.shellyBoard&&e.jsxs(D,{onClick:()=>{_("view-shellylog"),ye()},children:[e.jsx(z,{children:e.jsx(et,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(Ze,{}),e.jsxs(D,{onClick:me,children:[e.jsx(z,{children:e.jsx(Se,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Download",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(ze,{id:"sub-menu-download",anchorEl:a,keepMounted:!0,open:!!a,onClose:K,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(D,{onClick:()=>{_("download-mbstorage"),K()},children:[e.jsx(z,{children:e.jsx(Se,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Matterbridge storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(D,{onClick:()=>{_("download-pluginstorage"),K()},children:[e.jsx(z,{children:e.jsx(Se,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Matterbridge plugins storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(D,{onClick:()=>{_("download-pluginconfig"),K()},children:[e.jsx(z,{children:e.jsx(Se,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Matterbridge plugins config",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(D,{onClick:()=>{_("download-mblog"),K()},children:[e.jsx(z,{children:e.jsx(Se,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Matterbridge log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(D,{onClick:()=>{_("download-mjstorage"),K()},children:[e.jsx(z,{children:e.jsx(Se,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Matter storage",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(D,{onClick:()=>{_("download-mjlog"),K()},children:[e.jsx(z,{children:e.jsx(Se,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Matter log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),f.matterbridgeInformation&&f.matterbridgeInformation.shellyBoard&&e.jsxs(D,{onClick:()=>{_("shelly-create-system-log"),K()},children:[e.jsx(z,{children:e.jsx(Se,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Create Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),f.matterbridgeInformation&&f.matterbridgeInformation.shellyBoard&&e.jsxs(D,{onClick:()=>{_("shelly-download-system-log"),K()},children:[e.jsx(z,{children:e.jsx(Se,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Download Shelly system log",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(Ze,{}),e.jsxs(D,{onClick:ue,children:[e.jsx(z,{children:e.jsx(ht,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(ze,{id:"sub-menu-backup",anchorEl:H,keepMounted:!0,open:!!H,onClose:Z,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(D,{onClick:()=>{_("create-backup"),Z()},children:[e.jsx(z,{children:e.jsx(ht,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Create backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(D,{onClick:()=>{_("download-backup"),Z()},children:[e.jsx(z,{children:e.jsx(ht,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Download backup",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]}),e.jsx(Ze,{}),e.jsxs(D,{onClick:le,children:[e.jsx(z,{children:e.jsx(fr,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Reset",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(ze,{id:"sub-menu-reset",anchorEl:g,keepMounted:!0,open:!!g,onClose:ve,sx:{"& .MuiPaper-root":{backgroundColor:"#e2e2e2"}},children:[e.jsxs(D,{onClick:()=>{ve(),c("Reset all devices and shutdown","Are you sure you want to unregister all devices? This will temporarily remove all devices from the controller and you may loose the controller configuration.","unregister",_,ie)},children:[e.jsx(z,{children:e.jsx($e,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Reset all devices...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),e.jsxs(D,{onClick:()=>{ve(),c("Reset commissioning and shutdown","Are you sure you want to reset the commissioning? You will have to manually remove Matterbridge from the controller.","reset",_,ie)},children:[e.jsx(z,{children:e.jsx($e,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Reset commissioning...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),!f.matterbridgeInformation.readOnly&&e.jsxs(D,{onClick:()=>{ve(),c("Factory reset and shutdown","Are you sure you want to factory reset Matterbridge? You will have to manually remove Matterbridge from the controller.","factoryreset",_,ie)},children:[e.jsx(z,{children:e.jsx($e,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Factory reset...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),f.matterbridgeInformation&&f.matterbridgeInformation.shellyBoard&&e.jsxs(D,{onClick:()=>{ve(),c("Network reset","Are you sure you want to factory reset the network parameters?","softreset",_,ie)},children:[e.jsx(z,{children:e.jsx($e,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Reset network...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]}),f.matterbridgeInformation&&f.matterbridgeInformation.shellyBoard&&e.jsxs(D,{onClick:()=>{ve(),c("Factory reset","Are you sure you want to factory reset Matterbridge? You will have to manually remove Matterbridge from the controller.","hardreset",_,ie)},children:[e.jsx(z,{children:e.jsx($e,{style:{color:"var(--main-icon-color)"}})}),e.jsx(ee,{primary:"Factory reset...",primaryTypographyProps:{style:{fontWeight:"normal",color:"var(--main-icon-color)"}}})]})]})]})]})]})}const Vo=r.memo(Oo),Eo=()=>"ontouchstart"in window||typeof window.DocumentTouch<"u"&&document instanceof window.DocumentTouch?(i&&console.log("WebSocketLogs detectTouchscreen = true"),!0):(i&&console.log("WebSocketLogs detectTouchscreen = false"),!1);function Ao(){const{messages:o,autoScroll:c}=r.useContext(Ut),[d,n]=r.useState(!1),s=r.useRef(null),y=r.useMemo(()=>Eo(),[]),m=u=>n(!0),t=u=>n(!1);r.useEffect(()=>{i&&console.log(`WebSocketLogs autoScroll: ${c} isHovering: ${d}`),c&&!d&&!y&&s.current?.scrollIntoView({behavior:"smooth"})},[o,d,c,y]);const x=u=>{switch(u.toLowerCase()){case"debug":return"gray";case"info":return"#267fb7";case"notice":return"green";case"warn":return"#e9db18";case"error":return"red";case"fatal":return"#ff0000";case"spawn":return"#ff00d0";default:return"#5c0e91"}},W=u=>{switch(u.toLowerCase()){case"warn":return"black";default:return"white"}};return e.jsx("div",{style:{margin:"0px",padding:"0px"},children:e.jsxs("ul",{style:{margin:"0px",padding:"0px"},onMouseEnter:m,onMouseLeave:t,children:[o.map((u,C)=>e.jsxs("li",{style:{wordWrap:"break-word",maxHeight:"200px",overflow:"hidden"},children:[e.jsx("span",{style:{marginRight:"5px",padding:"1px 5px",backgroundColor:x(u.level),color:W(u.level),fontSize:"12px",borderRadius:"3px",textAlign:"center"},children:u.level}),u.time&&e.jsx("span",{style:{marginRight:"3px",color:"#505050"},children:"["+u.time+"]"}),u.name&&e.jsx("span",{style:{marginRight:"3px",color:"#09516d"},children:"["+u.name+"]"}),e.jsx("span",{style:{color:"var(--main-log-color)"},children:u.message})]},C)),e.jsx("div",{ref:s})]})})}const Bt=r.memo(Ao);function Oe(){const{retry:o}=r.useContext(fe),c=()=>{window.location.reload()};return e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",fontSize:"20px",flexDirection:"column",color:"var(--main-text-color)",height:"100vh",backgroundColor:"var(--main-bg-color)"},children:e.jsx(Y,{sx:{display:"flex",alignItems:"center",flexDirection:"column"},children:o<100?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"256px",width:"256px",margin:"10px",marginBottom:"20px"}}),e.jsx(xr,{style:{color:"var(--primary-color)"}}),e.jsx("div",{style:{marginTop:"20px",color:"var(--primary-color)"},children:e.jsxs("span",{children:["Reconnecting to Matterbridge ","(attempt "+o+")","..."]})})]}):e.jsxs("div",{style:{marginTop:"20px",color:"var(--primary-color)",textAlign:"center"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"256px",width:"256px",margin:"10px",marginBottom:"20px"}}),e.jsx("span",{children:"Unable to connect to Matterbridge after multiple attempts."}),e.jsx("br",{}),e.jsx("span",{children:"Please check your network connection."}),e.jsx("br",{}),e.jsx(oe,{variant:"contained",color:"primary",onClick:c,style:{marginTop:"20px"},children:"Refresh the Page"})]})})})}function _o({value:o,maxChars:c}){let d=o;if(o.length>c&&c>3){const n=c-3,s=o.substring(0,Math.ceil(n/2)),y=o.substring(o.length-Math.floor(n/2),o.length);d=`${s} … ${y}`}return o!==d?e.jsx(R,{title:o,placement:"top",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[0,12]}}]}},children:e.jsx("span",{children:d})}):e.jsx("span",{children:d})}function qo({systemInfo:o,compact:c}){const{sendMessage:d,addListener:n,removeListener:s,getUniqueId:y}=r.useContext(fe),[m,t]=r.useState(o),x=r.useRef(y());if(i&&console.log("SystemInfoTable:",m,"compact:",c),o&&c&&m.totalMemory&&m.freeMemory){const W=m.totalMemory,u=m.freeMemory;m.freeMemory=`${u} / ${W}`,m.totalMemory=""}if(o&&c&&m.heapTotal&&m.heapUsed){const W=m.heapTotal,u=m.heapUsed;m.heapUsed=`${u} / ${W}`,m.heapTotal=""}if(o&&c&&m.osRelease&&m.osType){const W=m.osType,u=m.osRelease;m.osType=`${W} (${u})`,m.osRelease=""}if(o&&c&&m.osArch&&m.osPlatform){const W=m.osPlatform,u=m.osArch;m.osPlatform=`${W} (${u})`,m.osArch=""}return r.useEffect(()=>{const W=u=>{u.src==="Matterbridge"&&u.dst==="Frontend"&&(u.method==="memory_update"&&u.response&&u.response.totalMemory&&u.response.freeMemory&&u.response.heapTotal&&u.response.heapUsed&&u.response.rss&&(i&&console.log("SystemInfoTable received memory_update",u),(m.totalMemory!==u.response.totalMemory||m.freeMemory!==u.response.freeMemory||m.heapTotal!==u.response.heapTotal||m.heapUsed!==u.response.heapUsed||m.rss!==u.response.rss)&&t(C=>({...C,totalMemory:u.response.totalMemory,freeMemory:u.response.freeMemory,heapTotal:u.response.heapTotal,heapUsed:u.response.heapUsed,rss:u.response.rss}))),u.method==="cpu_update"&&u.response&&u.response.cpuUsage&&(i&&console.log("SystemInfoTable received cpu_update",u),m.cpuUsage!==(u.response.cpuUsage?u.response.cpuUsage.toFixed(2)+" %":"")&&t(C=>({...C,cpuUsage:u.response.cpuUsage.toFixed(2)+" %"}))),u.method==="uptime_update"&&u.response&&u.response.systemUptime&&u.response.processUptime&&(i&&console.log("SystemInfoTable received uptime_update",u),(m.systemUptime!==u.response.systemUptime||m.processUptime!==u.response.processUptime)&&t(C=>({...C,systemUptime:u.response.systemUptime,processUptime:u.response.processUptime}))))};return i&&console.log("SystemInfoTable useEffect WebSocketMessage mounting"),n(W,x.current),i&&console.log("SystemInfoTable useEffect WebSocketMessage mounted"),()=>{i&&console.log("SystemInfoTable useEffect WebSocketMessage unmounting"),s(W),i&&console.log("SystemInfoTable useEffect WebSocketMessage unmounted")}},[n,m.cpuUsage,m.freeMemory,m.heapTotal,m.heapUsed,m.processUptime,m.rss,m.systemUptime,m.totalMemory,s,d]),m?(i&&console.log("SystemInfoTable rendering..."),e.jsxs("div",{className:"MbfWindowDiv",style:{minWidth:"302px",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"System Information"})}),e.jsx("div",{className:"MbfWindowDivTable",children:e.jsx("table",{style:{border:"none",borderCollapse:"collapse"},children:e.jsx("tbody",{style:{border:"none",borderCollapse:"collapse"},children:Object.entries(m).filter(([W,u])=>u!==void 0&&u!=="").map(([W,u],C)=>e.jsxs("tr",{className:C%2===0?"table-content-even":"table-content-odd",style:{border:"none",borderCollapse:"collapse"},children:[e.jsx("td",{style:{border:"none",borderCollapse:"collapse"},children:W}),e.jsx("td",{style:{border:"none",borderCollapse:"collapse"},children:e.jsx(_o,{value:typeof u!="string"?u.toString():u,maxChars:25})})]},W))})})})]})):null}const zo=r.memo(qo),$t={margin:"0px",padding:"0px",color:"var(--div-text-color)",transition:"color 0.2s ease","& svg":{display:"block"},"& svg path":{fill:"var(--div-text-color)",transition:"fill 0.2s ease"},"&:hover":{color:"var(--primary-color)"},"&:hover svg path":{fill:"var(--primary-color)"},"&:focus-visible":{outline:"2px solid var(--primary-color)",outlineOffset:"2px"}},Uo=o=>{if(!o)return"";const c=o.toString().replace(/[^0-9]/g,"");if(c.length<5)return c;const d=c.slice(0,4),n=c.slice(4,7),s=c.slice(7,11);return[d,n,s].filter(Boolean).join("-")};function Bo({id:o}){const{online:c,sendMessage:d,addListener:n,removeListener:s,getUniqueId:y}=r.useContext(fe),[m,t]=r.useState(null),[x,W]=r.useState(null),u=r.useRef(null),C=r.useRef(y()),{showConfirmCancelDialog:E}=r.useContext(Be);r.useEffect(()=>{i&&console.log(`QRDiv received storeId update "${o}"`),o&&(i&&console.log(`QRDiv sending data request for storeId "${o}"`),t(o),d({id:C.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:o,server:!0}}))},[o]),r.useEffect(()=>{const b=v=>{v.src==="Matterbridge"&&v.dst==="Frontend"&&v.method==="refresh_required"&&v.response.changed==="matter"&&v.response.matter&&(i&&console.log(`QRDiv received refresh_required: changed=${v.response.changed} for storeId "${v.response.matter.id}":`,v.response.matter),m===v.response.matter.id&&(i&&console.log(`QRDiv received refresh_required/matter: setting matter data for storeId "${v.response.matter.id}":`,v.response.matter),u.current&&clearTimeout(u.current),v.response.matter.advertising&&v.response.matter.advertiseTime&&v.response.matter.advertiseTime+9e5<=Date.now()&&(v.response.matter.advertising=!1),W(v.response.matter),v.response.matter.advertising&&(i&&console.log(`QRDiv setting matter advertise timeout for storeId "${v.response.matter.id}":`,v.response.matter.advertiseTime+9e5-Date.now()),u.current=setTimeout(()=>{u.current&&clearTimeout(u.current),i&&console.log(`QRDiv clearing advertising state for storeId "${m}" after 15 minutes`),W(w=>w&&{...w,advertising:!1})},v.response.matter.advertiseTime+9e5-Date.now()))))};return n(b,C.current),i&&console.log("QRDiv webSocket effect mounted"),()=>{s(b),u.current&&clearTimeout(u.current),u.current=null,i&&console.log("QRDiv webSocket effect unmounted")}},[m]);const $=()=>{i&&console.log(`QRDiv sent matter startCommission for node "${x?.id}"`),x&&d({id:C.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:x.id,startCommission:!0}})},T=()=>{i&&console.log(`QRDiv sent matter stopCommission for node "${x?.id}"`),x&&d({id:C.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:x.id,stopCommission:!0}})},V=()=>{i&&console.log(`QRDiv sent matter advertise for node "${x?.id}"`),x&&d({id:C.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:x.id,advertise:!0}})},f=b=>{i&&console.log(`QRDiv sent matter removeFabric for node "${x?.id}" and fabricIndex ${b}`),x&&d({id:C.current,sender:"QRDiv",method:"/api/matter",src:"Frontend",dst:"Matterbridge",params:{id:x.id,removeFabric:b}})},O=async()=>{if(!x||!x.manualPairingCode)return;const b=x.manualPairingCode.toString();try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(b);else{const v=document.createElement("textarea");v.value=b,v.style.position="fixed",v.style.opacity="0",document.body.appendChild(v),v.focus(),v.select(),document.execCommand("copy"),document.body.removeChild(v)}i&&console.log("Manual pairing code copied to clipboard")}catch(v){console.error("Failed to copy manual pairing code",v)}};return!x||!c?(i&&console.log("QRDiv rendering undefined state"),null):x.online?x.advertising&&x.qrPairingCode&&x.manualPairingCode?(i&&console.log("QRDiv rendering advertising state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"QR pairing code"}),e.jsxs("div",{className:"MbfWindowHeaderFooterIcons",children:[e.jsx(Q,{"aria-label":"send advertising",size:"small",onClick:V,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(R,{title:"Send again the mDNS advertisement",arrow:!0,children:e.jsx(te,{path:Wt,size:"22px"})})}),e.jsx(Q,{"aria-label":"stop pairing",size:"small",onClick:T,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(R,{title:"Turn off pairing",arrow:!0,children:e.jsx(te,{path:ro,size:"22px"})})})]})]}),e.jsx("p",{className:"MbfWindowHeaderText",style:{overflow:"hidden",maxWidth:"280px",textOverflow:"ellipsis",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:m}),e.jsx(to,{value:x.qrPairingCode,size:256,level:"M",fgColor:"var(--div-text-color)",bgColor:"var(--div-bg-color)",style:{margin:"20px"}}),e.jsxs("div",{className:"MbfWindowFooter",style:{justifyContent:"space-between"},children:[e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Manual pairing code: ",Uo(x.manualPairingCode)]}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(R,{title:"Copy manual pairing code",arrow:!0,children:e.jsx(Q,{"aria-label":"copy manual pairing code",size:"small",onClick:O,sx:$t,children:e.jsx(te,{path:oo,size:.85})})})})]})]})):x.commissioned&&x.fabricInformations&&x.sessionInformations?(i&&console.log("QRDiv rendering commissioned state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px",overflow:"hidden"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Paired fabrics"}),e.jsxs("div",{className:"MbfWindowHeaderFooterIcons",children:[e.jsx(Q,{"aria-label":"send advertising",size:"small",onClick:V,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(R,{title:"Send again the mDNS advertisement",arrow:!0,children:e.jsx(te,{path:Wt,size:"22px"})})}),e.jsx(Q,{"aria-label":"start pairing",size:"small",onClick:$,sx:{color:"var(--header-text-color)",margin:"0px",padding:"0px"},children:e.jsx(R,{title:"Turn on pairing",arrow:!0,children:e.jsx(te,{path:Ft,size:"22px"})})})]})]}),e.jsxs("div",{className:"MbfWindowBodyColumn",style:{paddingTop:"0px"},children:[e.jsx("p",{className:"MbfWindowHeaderText thin-scroll",style:{overflowX:"auto",maxWidth:"280px",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:m}),x.fabricInformations.map((b,v)=>e.jsxs("div",{style:{margin:"0px",padding:"10px",gap:"0px",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",textAlign:"left",fontSize:"14px"},children:[e.jsxs("div",{style:{marginLeft:"20px",marginBottom:"10px",display:"flex",flexDirection:"row",justifyContent:"space-between",gap:"20px",alignItems:"center"},children:[e.jsxs("p",{className:"status-blue",style:{margin:"0px",padding:"3px 10px",width:"200px",fontSize:"14px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},children:["Fabric: ",b.fabricIndex]}),e.jsx(R,{title:"Remove the fabric. You will also need to remove it from the controller.",arrow:!0,children:e.jsx(Q,{"aria-label":"remove the fabric",size:"small",onClick:()=>E("Remove fabric","Are you sure you want to remove this fabric? You will also need to remove it from the controller.","RemoveFabric",()=>f(b.fabricIndex),()=>{}),sx:{...$t,padding:"2px"},children:e.jsx(te,{path:no,size:1})})})]}),e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Vendor: ",b.rootVendorId," ",b.rootVendorName]}),b.label!==""&&e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Label: ",b.label]}),e.jsxs("p",{style:{margin:"0px 20px 0px 20px",color:"var(--div-text-color)"},children:["Sessions: ",x.sessionInformations?x.sessionInformations.filter(w=>w.fabric?.fabricIndex===b.fabricIndex&&w.isPeerActive===!0).length:"0"," ","subscriptions: ",x.sessionInformations?x.sessionInformations.filter(w=>w.fabric?.fabricIndex===b.fabricIndex&&w.isPeerActive===!0&&w.numberOfActiveSubscriptions>0).length:"0"]})]},v))]}),e.jsx("div",{className:"MbfWindowFooter",children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Serial number: ",x.serialNumber]})})]})):!x.commissioned&&!x.advertising?(i&&console.log("QRDiv rendering not commissioned and not advertising state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px"},children:[e.jsx("div",{className:"MbfWindowHeader",style:{height:"30px"},children:e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"QR pairing code"})}),e.jsx("p",{className:"MbfWindowHeaderText thin-scroll",style:{overflowX:"auto",maxWidth:"280px",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:m}),e.jsx(oe,{onClick:$,endIcon:e.jsx(te,{path:Ft,size:1}),style:{margin:"20px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:"Turn on pairing"}),e.jsx("div",{className:"MbfWindowFooter",children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Serial number: ",x.serialNumber]})})]})):(i&&console.log("QRDiv rendering unknown state"),null):(i&&console.log("QRDiv rendering offline state"),e.jsxs("div",{className:"MbfWindowDiv",style:{alignItems:"center",minWidth:"302px"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",style:{textAlign:"left"},children:"Server node"}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons"})]}),e.jsx("p",{className:"MbfWindowHeaderText",style:{overflow:"hidden",maxWidth:"280px",textOverflow:"ellipsis",textAlign:"center",fontSize:"14px",fontWeight:"bold",color:"var(--secondary-color)"},children:m}),e.jsx("p",{style:{textAlign:"center",fontSize:"14px",fontWeight:"bold"},children:"Server offline: restart to commission"}),e.jsx("div",{className:"MbfWindowFooter",children:e.jsxs("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"},children:["Serial number: ",x.serialNumber]})})]}))}const Qo=r.memo(Bo);function Ko(){const{logMessage:o,sendMessage:c,getUniqueId:d}=r.useContext(fe),[n,s]=r.useState("matterbridge-"),[y,m]=r.useState(!1),[t,x]=r.useState(null),W=r.useRef(d()),u=v=>{v.preventDefault(),m(!0)},C=()=>{m(!1)},E=v=>{v.preventDefault(),m(!1);const w=v.dataTransfer.files[0];if(w){o("Plugins",`Installing package ${w.name}. Please wait...`);const H=new FormData;H.append("file",w),H.append("filename",w.name),fetch("./api/uploadpackage",{method:"POST",body:H}).then(j=>j.text()).then(j=>{o("Plugins",`Server response: ${j}`)}).catch(j=>{console.error("Error uploading plugin file:",j),o("Plugins",`Error installing package ${j}`)})}},$=v=>{const w=v.target.files&&v.target.files[0];if(w){o("Plugins",`Uploading package ${w.name}`);const H=new FormData;H.append("file",w),H.append("filename",w.name),fetch("./api/uploadpackage",{method:"POST",body:H}).then(j=>j.text()).then(j=>{o("Plugins",`Server response: ${j}`)}).catch(j=>{console.error("Error uploading plugin file:",j),o("Plugins",`Error uploading package ${j}`)})}},T=()=>{c({id:W.current,sender:"InstallPlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:n,restart:!1}})},V=()=>{document.getElementById("file-upload")?.click()},f=()=>{c({id:W.current,sender:"InstallPlugins",method:"/api/addplugin",src:"Frontend",dst:"Matterbridge",params:{pluginNameOrPath:n}})},O=v=>{x(v.currentTarget)},b=v=>{v!==""&&s(v),x(null)};return i&&console.log("AddRemovePlugins rendering..."),e.jsxs("div",{style:{display:"flex",flexDirection:"row",flex:"1 1 auto",alignItems:"center",justifyContent:"space-between",margin:"0px",padding:"10px",gap:"20px"},onDragOver:u,onDragLeave:C,onDrop:E,children:[e.jsx(de,{value:n,onChange:v=>{s(v.target.value)},size:"small",id:"plugin-name",label:"Plugin name or plugin path",variant:"outlined",fullWidth:!0}),e.jsx(Q,{onClick:O,children:e.jsx(br,{})}),e.jsxs(ze,{id:"simple-menu",anchorEl:t,keepMounted:!0,open:!!t,onClose:()=>b(""),children:[e.jsx(D,{onClick:()=>b("matterbridge-zigbee2mqtt"),children:"matterbridge-zigbee2mqtt"}),e.jsx(D,{onClick:()=>b("matterbridge-somfy-tahoma"),children:"matterbridge-somfy-tahoma"}),e.jsx(D,{onClick:()=>b("matterbridge-shelly"),children:"matterbridge-shelly"}),e.jsx(D,{onClick:()=>b("matterbridge-hass"),children:"matterbridge-hass"}),e.jsx(D,{onClick:()=>b("matterbridge-webhooks"),children:"matterbridge-webhooks"}),e.jsx(D,{onClick:()=>b("matterbridge-bthome"),children:"matterbridge-bthome"}),e.jsx(D,{onClick:()=>b("matterbridge-test"),children:"matterbridge-test"}),e.jsx(D,{onClick:()=>b("matterbridge-example-accessory-platform"),children:"matterbridge-example-accessory-platform"}),e.jsx(D,{onClick:()=>b("matterbridge-example-dynamic-platform"),children:"matterbridge-example-dynamic-platform"}),e.jsx(D,{onClick:()=>b("matterbridge-eve-door"),children:"matterbridge-eve-door"}),e.jsx(D,{onClick:()=>b("matterbridge-eve-motion"),children:"matterbridge-eve-motion"}),e.jsx(D,{onClick:()=>b("matterbridge-eve-energy"),children:"matterbridge-eve-energy"}),e.jsx(D,{onClick:()=>b("matterbridge-eve-weather"),children:"matterbridge-eve-weather"}),e.jsx(D,{onClick:()=>b("matterbridge-eve-room"),children:"matterbridge-eve-room"})]}),e.jsx(R,{title:"Install or update a plugin from npm",children:e.jsx(oe,{onClick:T,endIcon:e.jsx(Se,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Install"})}),e.jsx(R,{title:"Upload and install a plugin from a tarball",children:e.jsx(oe,{onClick:V,endIcon:e.jsx(vr,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Upload"})}),e.jsx(R,{title:"Add an installed plugin",children:e.jsx(oe,{onClick:f,endIcon:e.jsx(ct,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px",minWidth:"90px"},children:" Add"})}),e.jsx("input",{id:"file-upload",type:"file",accept:".tgz",style:{display:"none"},onChange:$})]})}const Jo=r.memo(Ko);function Ee({status:o,enabledText:c="Enabled",disabledText:d=void 0,tooltipText:n=void 0,onClick:s}){if(o===void 0)return null;{const y=e.jsx("div",{className:o?"status-enabled":"status-disabled",style:{cursor:"default"},onClick:s,children:o?c:d??c});return n!==void 0?e.jsx(R,{title:n,children:y}):y}}function Rt(o){return o.id!==0&&o.src==="Matterbridge"&&o.dst==="Frontend"&&("success"in o||"error"in o)}const Ae={fontSize:"16px",fontWeight:"bold",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},_e={fontSize:"12px",fontWeight:"normal",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},Go={fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)",backgroundColor:"var(--div-bg-color)"},Yo={fontSize:"16px",fontWeight:"bold",backgroundColor:"var(--div-bg-color)"},ke={padding:"0px",margin:"0px"},Xo="5px 10px 5px 10px",st={},xe={},at={},lt={};let qe=[],xt=[];const Zo=({open:o,onClose:c,plugin:d})=>{const{sendMessage:n,addListener:s,removeListener:y,getUniqueId:m}=r.useContext(fe),t=r.useRef(m()),[x,W]=r.useState(d.configJson),[u,C]=r.useState(null),[E,$]=r.useState({"ui:submitButtonOptions":{submitText:"Confirm"},"ui:globalOptions":{orderable:!0}}),[T,V]=r.useState("");let f={};r.useEffect(()=>{const P=k=>{k.src==="Matterbridge"&&k.dst==="Frontend"&&(Rt(k)&&k.id===t.current&&k.method==="/api/select/devices"&&k.response&&(i&&console.log(`ConfigPluginDialog (id: ${k.id}) received ${k.response.length} /api/select/devices:`,k.response),qe=k.response),Rt(k)&&k.id===t.current&&k.method==="/api/select/entities"&&k.response&&(i&&console.log(`ConfigPluginDialog (id: ${k.id}) received ${k.response.length} /api/select/entities:`,k.response),xt=k.response))};return s(P,t.current),i&&console.log("ConfigPluginDialog added WebSocket listener id:",t.current),x&&u&&u.properties&&(Object.keys(u.properties).forEach(k=>{Object.keys(u.properties[k]).forEach(S=>{S.startsWith("ui:")&&(E[k]={},E[k][S]=u.properties[k][S],delete u.properties[k][S])})}),$(E)),d.name&&d.configJson&&d.schemaJson&&(W(d.configJson),C(d.schemaJson),n({id:t.current,sender:"ConfigPlugin",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:d.name}}),n({id:t.current,sender:"ConfigPlugin",method:"/api/select/entities",src:"Frontend",dst:"Matterbridge",params:{plugin:d.name}}),i&&console.log('HomePlugins sent "/api/select/devices" and "/api/select/entities" for plugin:',d.name)),()=>{y(P),i&&console.log("ConfigPluginDialog removed WebSocket listener")}},[s,x,d,y,u,n,E]);const O=(P,k)=>{f=P.formData},b=P=>{i&&console.log("ConfigPluginDialog handleSaveChanges:",P.formData),W(P.formData),d.configJson=P.formData,d.restartRequired=!0,n({id:t.current,sender:"ConfigPlugin",method:"/api/savepluginconfig",src:"Frontend",dst:"Matterbridge",params:{pluginName:P.formData.name,formData:P.formData}}),c()};function v(P){const{id:k,label:S,onKeyChange:p,onDropPropertyClick:J,disabled:se,schema:ae,children:ce,registry:_,readonly:ie,required:ue}=P,{templates:Z}=_,{RemoveButton:we}=Z.ButtonTemplates;if(!(To in ae))return e.jsx(Y,{sx:{display:"flex",flexDirection:"column",flexGrow:1,padding:0,margin:0,border:"none"},children:ce});const me=({target:K})=>p(K&&K.value);return e.jsxs(Y,{sx:{display:"flex",flexDirection:"row",flexGrow:1,padding:0,margin:0,border:"none"},children:[e.jsx(de,{id:`${k}-key`,name:`${k}-key`,required:ue,disabled:se||ie,defaultValue:S,onBlur:ie?void 0:me,type:"text",variant:"outlined",sx:{width:"250px",minWidth:"250px",maxWidth:"250px",marginRight:"20px"}}),e.jsx(Y,{sx:{flex:1},children:ce}),e.jsx(we,{disabled:se||ie,onClick:J(S),registry:_})]})}function w(P){const{children:k,description:S,displayLabel:p,errors:J,help:se,hidden:ae,registry:ce,uiSchema:_}=P,ie=Fo(_),ue=Lo("WrapIfAdditionalTemplate",ce,ie);return ae?e.jsx("div",{style:{display:"none"},children:k}):e.jsx(Y,{sx:{display:"flex",flexDirection:"column",flexGrow:1,padding:0,margin:0,border:"none"},children:e.jsxs(ue,{...P,children:[p===!0&&S,k,J,se]})})}function H(P){const{description:k}=P;return k?e.jsx(re,{sx:_e,children:k}):null}function j(P){const{required:k,title:S}=P;return S?e.jsx(Y,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:e.jsxs(re,{sx:Ae,children:["Title ",S," ",k&&e.jsx("mark",{children:"***"})]})}):null}function M(P){const{help:k}=P;return k?e.jsx(Y,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:e.jsx(re,{sx:Go,children:k})}):null}function U(P){const{errors:k}=P;return k?e.jsxs(Y,{sx:{padding:"10px",margin:"10px",border:"1px solid grey"},children:[e.jsx(re,{color:"error",sx:Yo,children:"Please fix the following errors:"}),e.jsx(Je,{children:k.map((S,p)=>e.jsxs(yr,{children:[e.jsx(z,{children:e.jsx(jr,{color:"error"})}),e.jsx(ee,{primary:S.stack})]},p))})]}):null}function a(P){const{errors:k}=P;return k?e.jsx(Y,{sx:{padding:"0px",margin:"0px",marginTop:"5px"},children:k.map((S,p)=>e.jsxs(re,{color:"error",variant:"body2",sx:{marginLeft:1},children:["This field ",S]},p))}):null}function l(P){const{id:k,name:S,_schema:p,_uiSchema:J,value:se,options:ae,label:ce,type:_,placeholder:ie,required:ue,disabled:Z,readonly:we,autofocus:ye,onChange:me,onChangeOverride:K,onBlur:le,onFocus:ve,_rawErrors:Qe,_hideError:B,_registry:I,_formContext:pe}=P,Ke=({target:{value:Ce}})=>me(Ce===""?ae.emptyValue:Ce),Pe=({target:Ce})=>le(k,Ce&&Ce.value),Ye=({target:Ce})=>ve(k,Ce&&Ce.value);return e.jsx(Y,{sx:{padding:"0px",margin:"0px"},children:e.jsx(de,{id:k,name:k,label:ie&&ie!==""?ce:void 0,variant:"outlined",placeholder:ie&&ie!==""?ie:ce,required:ue,disabled:Z||we,autoFocus:ye,value:se||se===0?se:"",type:_,autoComplete:_==="password"?"current-password":S,onChange:K||Ke,onBlur:Pe,onFocus:Ye,fullWidth:!0})})}function g(P){return console.log("ArrayFieldTitleTemplate:",P),null}function h(P){return console.log("ArrayFieldDescriptionTemplate:",P),null}function L(P){return console.log("ArrayFieldItemTemplate:",P),null}function X(P){const{canAdd:k,onAddClick:S,schema:p,title:J}=P,[se,ae]=r.useState(!1),[ce,_]=r.useState(!1),[ie,ue]=r.useState(!1),[Z,we]=r.useState(""),ye=I=>{we(I.target.value)},me=()=>{i&&console.log("ArrayFieldTemplate: handleDialogDeviceToggle filter:",Z,"selectDevices:",qe),ae(!se)},K=()=>{i&&console.log("ArrayFieldTemplate: handleDialogEntityToggle filter:",Z,"selectEntities:",xt),_(!ce)},le=()=>{i&&console.log("ArrayFieldTemplate: handleDialogDeviceEntityToggle filter:",Z,"selectDevices:",qe),ue(!ie)},ve=I=>{ae(!1),p.selectFrom==="serial"?p.items.default=I.serial:p.selectFrom==="name"&&(p.items.default=I.name),S()},Qe=I=>{_(!1),p.selectEntityFrom==="name"?p.items.default=I.name:p.selectEntityFrom==="description"&&(p.items.default=I.description),S()},B=I=>{ue(!1),p.selectDeviceEntityFrom==="name"?p.items.default=I.name:p.selectDeviceEntityFrom==="description"&&(p.items.default=I.description),S()};return e.jsxs(Y,{sx:{margin:"0px",padding:"5px 10px 5px 10px",border:"1px solid grey"},children:[J&&e.jsxs(Y,{sx:{margin:"0px",padding:"0px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[J&&e.jsx(re,{sx:Ae,children:J}),k&&e.jsxs(Y,{sx:{margin:"0px",padding:"0px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[p.selectFrom&&e.jsx(R,{title:"Add a device from the list",children:e.jsx(Q,{onClick:me,size:"small",color:"primary",sx:ke,children:e.jsx(tt,{})})}),p.selectEntityFrom&&e.jsx(R,{title:"Add an entity from the list",children:e.jsx(Q,{onClick:K,size:"small",color:"primary",sx:ke,children:e.jsx(tt,{})})}),p.selectDeviceEntityFrom&&e.jsx(R,{title:"Add a device entity from the list",children:e.jsx(Q,{onClick:le,size:"small",color:"primary",sx:ke,children:e.jsx(tt,{})})}),e.jsx(R,{title:"Add a new item",children:e.jsx(Q,{onClick:S,size:"small",color:"primary",sx:ke,children:e.jsx(ct,{})})})]})]}),p.description&&e.jsx(re,{sx:_e,children:p.description}),P.items.map(I=>e.jsxs(Y,{sx:{margin:"2px 0px",padding:"0px",display:"flex",alignItems:"center"},children:[e.jsx(Y,{sx:{flexGrow:1,marginRight:"10px"},children:I.children}),e.jsx(Q,{disabled:!I.hasMoveUp,onClick:I.onReorderClick(I.index,I.index-1),size:"small",color:"primary",sx:ke,children:e.jsx(Mt,{})}),e.jsx(Q,{disabled:!I.hasMoveDown,onClick:I.onReorderClick(I.index,I.index+1),size:"small",color:"primary",sx:ke,children:e.jsx(St,{})}),e.jsx(Q,{onClick:I.onDropIndexClick(I.index),size:"small",color:"primary",sx:ke,children:e.jsx(ut,{})})]},I.index)),e.jsxs(Ie,{open:se,onClose:me,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(De,{children:"Select a device"}),e.jsxs(Ne,{children:[e.jsxs(Y,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(re,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(de,{fullWidth:!0,variant:"outlined",value:Z,onChange:ye,placeholder:"Enter serial or name"})]}),e.jsx(Je,{dense:!0,children:qe.filter(I=>I.serial.toLowerCase().includes(Z.toLowerCase())||I.name.toLowerCase().includes(Z.toLowerCase())).map((I,pe)=>e.jsxs(rt,{onClick:()=>ve(I),sx:st,children:[I.icon==="wifi"&&e.jsx(z,{children:e.jsx(Ge,{style:xe})}),I.icon==="ble"&&e.jsx(z,{children:e.jsx(ot,{style:xe})}),I.icon==="hub"&&e.jsx(z,{children:e.jsx(nt,{style:xe})}),e.jsx(ee,{primary:I.name,secondary:I.serial,primaryTypographyProps:{style:at},secondaryTypographyProps:{style:lt}})]},pe))})]}),e.jsx(He,{children:e.jsx(oe,{onClick:me,children:"Close"})})]}),e.jsxs(Ie,{open:ce,onClose:K,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(De,{children:"Select an entity"}),e.jsxs(Ne,{children:[e.jsxs(Y,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(re,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(de,{fullWidth:!0,variant:"outlined",value:Z,onChange:ye,placeholder:"Enter name or description"})]}),e.jsx(Je,{dense:!0,children:xt.filter(I=>I.name.toLowerCase().includes(Z.toLowerCase())||I.description.toLowerCase().includes(Z.toLowerCase())).map((I,pe)=>e.jsxs(rt,{onClick:()=>Qe(I),sx:st,children:[I.icon==="wifi"&&e.jsx(z,{children:e.jsx(Ge,{style:xe})}),I.icon==="ble"&&e.jsx(z,{children:e.jsx(ot,{style:xe})}),I.icon==="hub"&&e.jsx(z,{children:e.jsx(nt,{style:xe})}),I.icon==="component"&&e.jsx(z,{children:e.jsx(kt,{style:xe})}),I.icon==="matter"&&e.jsx(z,{children:e.jsx(It,{style:xe})}),e.jsx(ee,{primary:I.name,secondary:I.description,primaryTypographyProps:{style:at},secondaryTypographyProps:{style:lt}})]},pe))})]}),e.jsx(He,{children:e.jsx(oe,{onClick:K,children:"Close"})})]}),e.jsxs(Ie,{open:ie,onClose:le,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsxs(De,{children:["Select an entity for ",J]}),e.jsx(Ne,{children:e.jsx(Je,{dense:!0,children:qe.filter(I=>I.serial===J||I.name===J).map(I=>I.entities?.map((pe,Ke)=>e.jsxs(rt,{onClick:()=>B(pe),sx:st,children:[pe.icon==="wifi"&&e.jsx(z,{children:e.jsx(Ge,{style:xe})}),pe.icon==="ble"&&e.jsx(z,{children:e.jsx(ot,{style:xe})}),pe.icon==="hub"&&e.jsx(z,{children:e.jsx(nt,{style:xe})}),pe.icon==="component"&&e.jsx(z,{children:e.jsx(kt,{style:xe})}),pe.icon==="matter"&&e.jsx(z,{children:e.jsx(It,{style:xe})}),e.jsx(ee,{primary:pe.name,secondary:pe.description,primaryTypographyProps:{style:at},secondaryTypographyProps:{style:lt}})]},Ke)))})}),e.jsx(He,{children:e.jsx(oe,{onClick:le,children:"Close"})})]})]})}function be(P){const{onAddClick:k,schema:S,properties:p,title:J,description:se}=P,[ae,ce]=r.useState(!1),[_,ie]=r.useState(""),ue=K=>{ie(K.target.value)},Z=()=>{ce(!ae)},we=K=>{i&&console.log(`ObjectFieldTemplate: handleSelectValue value "${K.serial}" for schema "${S.selectFrom}"`),ce(!1);let le="";S.selectFrom==="serial"?le=K.serial:S.selectFrom==="name"&&(le=K.name),V(le),i&&console.log(`ObjectFieldTemplate: handleSelectValue newkey "${le}"`),k(S)()},ye=()=>{k(S)()},me=!S.additionalProperties;return i&&console.log(`ObjectFieldTemplate: isRoot ${me} newkey "${T}"`),!me&&T!==""&&(i&&console.log("ObjectFieldTemplate: newkey",T,"properties",p),p.forEach(K=>{if(K.name==="newKey"&&K.content.key==="newKey"&&K.content.props.name==="newKey"&&K.content.props.onKeyChange&&T!==""){i&&console.log("ObjectFieldTemplate: newkey onKeyChange",T);const le=T;V(""),K.content.props.onKeyChange(le)}})),e.jsxs(Y,{sx:{margin:"0px",padding:me?"10px":"5px 10px 0px 10px",border:me?"none":"1px solid grey"},children:[S.title&&me&&e.jsx(Y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px",marginBottom:"10px"},children:e.jsx(re,{sx:Ae,children:S.title})}),J&&!me&&e.jsxs(Y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px"},children:[e.jsx(re,{sx:Ae,children:J}),e.jsxs(Y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0px",margin:"0px"},children:[S.selectFrom&&e.jsx(R,{title:"Add a device from the list",children:e.jsx(Q,{onClick:Z,size:"small",color:"primary",sx:ke,children:e.jsx(tt,{})})}),e.jsx(R,{title:"Add a new item",children:e.jsx(Q,{onClick:ye,size:"small",color:"primary",sx:ke,children:e.jsx(ct,{})})})]})]}),S.description&&e.jsx(Y,{sx:{padding:"0px",margin:"0px",marginBottom:"10px"},children:e.jsx(re,{sx:_e,children:S.description})}),p.map(({content:K,name:le,hidden:ve})=>!ve&&e.jsxs(Y,{sx:{margin:"0px",marginBottom:"10px",padding:["object","array","boolean"].includes(S.properties[le].type)?"0px":Xo,border:["object","array","boolean"].includes(S.properties[le].type)?"none":"1px solid grey"},children:[!["object","array","boolean"].includes(S.properties[le].type)&&e.jsx(re,{sx:Ae,children:le}),e.jsx(Y,{sx:{flexGrow:1,padding:"0px",margin:"0px"},children:K})]},le)),e.jsxs(Ie,{open:ae,onClose:Z,PaperProps:{sx:{maxHeight:"50vh",maxWidth:"50vw",overflow:"auto"}},children:[e.jsx(De,{children:"Select a device"}),e.jsxs(Ne,{children:[e.jsxs(Y,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[e.jsx(re,{variant:"subtitle1",sx:{whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(de,{fullWidth:!0,variant:"outlined",value:_,onChange:ue,placeholder:"Enter serial or name"})]}),e.jsx(Je,{dense:!0,children:qe.filter(K=>K.serial.toLowerCase().includes(_.toLowerCase())||K.name.toLowerCase().includes(_.toLowerCase())).map((K,le)=>e.jsxs(rt,{onClick:()=>we(K),sx:st,children:[K.icon==="wifi"&&e.jsx(z,{children:e.jsx(Ge,{style:xe})}),K.icon==="ble"&&e.jsx(z,{children:e.jsx(ot,{style:xe})}),K.icon==="hub"&&e.jsx(z,{children:e.jsx(nt,{style:xe})}),e.jsx(ee,{primary:K.name,secondary:K.serial,primaryTypographyProps:{style:at},secondaryTypographyProps:{style:lt}})]},le))})]}),e.jsx(He,{children:e.jsx(oe,{onClick:Z,children:"Close"})})]})]})}function he(P){const{uiSchema:k}=P,{submitText:S,norender:p}=Wo(k);return p?null:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",margin:"10px",padding:"0px",gap:"20px"},children:[e.jsx(oe,{type:"submit",variant:"contained",color:"primary",children:S}),e.jsx(oe,{variant:"contained",color:"primary",onClick:c,children:"Cancel"})]})}function ge(P){const{className:k,disabled:S,onClick:p,registry:J,style:se,uiSchema:ae,...ce}=P;return e.jsx(R,{title:"Remove the item",children:e.jsx(Q,{disabled:S,size:"small",color:"primary",onClick:p,children:e.jsx(ut,{})})})}function G(P){const{className:k,disabled:S,onClick:p,registry:J,uiSchema:se,...ae}=P;return e.jsx(R,{title:"Add an item",children:e.jsx(Q,{size:"small",color:"primary",onClick:p,children:e.jsx(ct,{})})})}function ne(P){const{disabled:k,onClick:S,registry:p,style:J,uiSchema:se,...ae}=P;return e.jsx(R,{title:"Move up the item",children:e.jsx(Q,{size:"small",color:"primary",onClick:S,children:e.jsx(Mt,{})})})}function F(P){const{disabled:k,onClick:S,registry:p,style:J,uiSchema:se,...ae}=P;return e.jsx(R,{title:"Move down the item",children:e.jsx(Q,{size:"small",color:"primary",onClick:S,children:e.jsx(St,{})})})}function A(P){const{id:k,name:S,value:p,schema:J,readonly:se,onChange:ae}=P,[ce,_]=r.useState(),ie=Z=>{i&&console.log(`CheckboxWidget ${S} onChangeField:`,Z),_(Z&&Z!==""?Z:void 0)},ue=()=>{i&&console.log(`CheckboxWidget onClick plugin="${d.name}" action="${S}" value="${ce}"`),n({id:t.current,sender:"ConfigPlugin",method:"/api/action",src:"Frontend",dst:"Matterbridge",params:{plugin:d.name,action:S,value:ce,formData:f,id:k}}),J.buttonClose===!0?c():J.buttonSave===!0&&b({formData:x})};return J.buttonText&&J.description?e.jsxs(Y,{sx:{margin:"0px",padding:"10px",border:"1px solid grey",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(re,{sx:_e,children:J.description}),e.jsx(oe,{variant:"contained",color:"primary",onClick:()=>ue(),children:J.buttonText})]}):J.buttonField&&J.description?e.jsxs(Y,{sx:{margin:"0px",padding:"10px",gap:"20px",border:"1px solid grey",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(re,{sx:_e,children:J.description}),e.jsx(de,{id:S+"-input",name:S,label:J.textLabel,placeholder:J.textPlaceholder,onChange:Z=>ie(Z.target.value),sx:{width:"250px",minWidth:"250px",maxWidth:"250px"}}),e.jsx(oe,{id:S+"-button",variant:"contained",color:"primary",disabled:ce===void 0,onClick:()=>ue(),children:J.buttonField})]}):e.jsxs(Y,{sx:{margin:"0px",padding:"5px 10px",border:"1px solid grey"},children:[S&&e.jsxs(Y,{sx:{margin:"0px",padding:"0px",gap:"10px",display:"flex",justifyContent:"flex-start",alignItems:"center"},children:[e.jsx(re,{sx:Ae,children:S}),e.jsx(Te,{checked:p,readOnly:se,onChange:()=>ae(!p),sx:{padding:"0px",margin:"0px"}})]}),J.description&&e.jsx(re,{sx:_e,children:J.description})]})}function N({schema:P,id:k,name:S,options:p,label:J,hideLabel:se,required:ae,disabled:ce,placeholder:_,readonly:ie,value:ue,multiple:Z,autofocus:we,onChange:ye,onBlur:me,onFocus:K,errorSchema:le,rawErrors:ve=[],registry:Qe,uiSchema:B,hideError:I,formContext:pe,...Ke}){const{enumOptions:Pe,enumDisabled:Ye,emptyValue:Ce}=p;Z=typeof Z>"u"?!1:!!Z;const yt=Z?[]:"",jt=typeof ue>"u"||Z&&ue.length<1||!Z&&ue===yt,Kt=({target:{value:Me}})=>ye(ft(Me,Pe,Ce)),Jt=({target:Me})=>me(k,ft(Me&&Me.value,Pe,Ce)),Gt=({target:Me})=>K(k,ft(Me&&Me.value,Pe,Ce)),Ct=No(ue,Pe,Z),{InputLabelProps:Yt,SelectProps:Xt,autocomplete:Zt,...er}=Ke,tr=!Z&&P.default===void 0;return e.jsxs(de,{id:k,name:k,value:!jt&&typeof Ct<"u"?Ct:yt,required:ae,disabled:ce||ie,autoFocus:we,autoComplete:Zt,placeholder:_,error:ve.length>0,onChange:Kt,onBlur:Jt,onFocus:Gt,...er,select:!0,InputLabelProps:{...Yt,shrink:!jt},SelectProps:{...Xt,multiple:Z},"aria-describedby":Po(k),children:[tr&&e.jsx(D,{value:"",children:_}),Array.isArray(Pe)&&Pe.map(({value:Me,label:rr},wt)=>{const or=Array.isArray(Ye)&&Ye.indexOf(Me)!==-1;return e.jsx(D,{value:String(wt),disabled:or,children:rr},wt)})]})}return i&&console.log("ConfigPluginDialog rendering..."),!o||!u||!x?null:e.jsxs(Ie,{open:o,onClose:c,slotProps:{paper:{sx:{maxWidth:"800px"}}},children:[e.jsx(De,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h3",{children:"Matterbridge plugin configuration"})]})}),e.jsx(Ne,{style:{padding:"0px",margin:"0px",width:"800px",height:"600px",overflow:"auto"},children:e.jsx(Io,{schema:u,formData:x,uiSchema:E,validator:Do,templates:{FieldTemplate:w,BaseInputTemplate:l,TitleFieldTemplate:j,DescriptionFieldTemplate:H,FieldHelpTemplate:M,FieldErrorTemplate:a,ErrorListTemplate:U,WrapIfAdditionalTemplate:v,ArrayFieldTitleTemplate:g,ArrayFieldDescriptionTemplate:h,ArrayFieldItemTemplate:L,ArrayFieldTemplate:X,ObjectFieldTemplate:be,ButtonTemplates:{SubmitButton:he,RemoveButton:ge,AddButton:G,MoveUpButton:ne,MoveDownButton:F}},widgets:{CheckboxWidget:A,SelectWidget:N},onChange:O,onSubmit:b})})]})};function Qt(o){if(i&&console.log(`getQRColor (id: ${o?.id}) received matter:`,o??"undefined"),o===void 0||!o.online||!o.qrPairingCode&&!o.manualPairingCode&&!o.fabricInformations&&!o.sessionInformations)return"red";if(o.commissioned===!1&&o.qrPairingCode&&o.manualPairingCode)return"var(--primary-color)";let c=0,d=0;for(const n of o.sessionInformations??[])n.fabric&&n.isPeerActive===!0&&c++,n.numberOfActiveSubscriptions>0&&(d+=n.numberOfActiveSubscriptions);return o.commissioned===!0&&o.fabricInformations&&o.sessionInformations&&(c===0||d===0)?"var(--secondary-color)":"var(--div-text-color)"}function en(o,c,d){const n=o?.[d],s=c?.[d];return n==null&&s==null?0:n==null?-1:s==null?1:typeof n=="boolean"&&typeof s=="boolean"?n===s?0:n?1:-1:typeof n=="number"&&typeof s=="number"?n-s:String(n).localeCompare(String(s))}function tn({name:o,title:c,columns:d,rows:n,getRowKey:s,footerLeft:y,footerRight:m,onRowClick:t}){const x=r.useRef(new WeakMap),W=r.useRef(1),u=a=>{if(typeof s=="string"&&a&&a[s]!=null)return a[s];if(typeof s=="function"){const h=s(a);if(h!=null)return h}const l=d?.[0]?.id;if(l&&a&&a[l]!=null)return a[l];console.warn(`MbfTable(${o}): using fallback stable row key; consider providing getRowKey prop for better React performance`);let g=x.current.get(a);return g||(g=`rk_${W.current++}`,x.current.set(a,g)),g},[C,E]=r.useState(localStorage.getItem(`${o}_table_order_by`)||null),[$,T]=r.useState(localStorage.getItem(`${o}_table_order`)||null),[V,f]=r.useState(!1),[O,b]=r.useState(()=>{try{const a=localStorage.getItem(`${o}_column_visibility`);if(a)return JSON.parse(a)}catch{}return{}}),v=r.useMemo(()=>{const a={};for(const l of d)l.hidden||(a[l.id]=l.required?!0:O[l.id]!==!1);return a},[d,O]),w=r.useMemo(()=>{if(!C||!$)return n;const a=d.find(g=>g.id===C);if(!a||a.noSort)return n;const l=n.map((g,h)=>({el:g,index:h}));return l.sort((g,h)=>{let L;return typeof a.comparator=="function"?L=a.comparator(g.el,h.el):L=en(g.el,h.el,C),L!==0?$==="asc"?L:-L:g.index-h.index}),l.map(g=>g.el)},[n,C,$,d]),H=a=>{if(C!==a||!C){E(a),T("asc"),localStorage.setItem(`${o}_table_order_by`,a),localStorage.setItem(`${o}_table_order`,"asc");return}if($==="asc"){T("desc"),localStorage.setItem(`${o}_table_order`,"desc");return}E(null),T(null),localStorage.removeItem(`${o}_table_order_by`),localStorage.removeItem(`${o}_table_order`)},j=()=>{f(!V)},M=a=>{b(l=>{const g=d.find(X=>X.id===a);if(g&&g.required)return l;const h=v[a]!==!1,L={...l};h?L[a]=!1:delete L[a];try{localStorage.setItem(`${o}_column_visibility`,JSON.stringify(L))}catch{}return L})},U=()=>{b({});try{localStorage.removeItem(`${o}_column_visibility`)}catch{}f(!1)};return i&&console.log(`Rendering table ${o}${C&&$?` ordered by ${C}:${$}`:""}`),e.jsxs("div",{style:{display:"flex",flexDirection:"column",margin:"0",padding:"0",gap:"0",width:"100%",flex:"1 1 auto",height:"100%",minHeight:0,overflow:"hidden"},children:[e.jsxs(Ie,{open:V,onClose:(a,l)=>{l==="backdropClick"||l==="escapeKeyDown"||j()},disableEscapeKeyDown:!0,disableRestoreFocus:!0,children:[e.jsx(De,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:`Configure ${o} columns`})]})}),e.jsx(Ne,{children:e.jsx(Cr,{children:d.filter(a=>!a.hidden).map(a=>e.jsx(Le,{control:e.jsx(Te,{disabled:!!a.required,checked:a.required?!0:v[a.id]!==!1,onChange:()=>M(a.id)}),label:a.label},a.id))})}),e.jsxs(He,{children:[e.jsx(oe,{onClick:U,children:"Reset"}),e.jsx(oe,{variant:"contained",onClick:a=>{if(a?.currentTarget&&typeof a.currentTarget.blur=="function")try{a.currentTarget.blur()}catch{}const l=document.activeElement;if(l&&l instanceof HTMLElement&&typeof l.blur=="function")try{l.blur()}catch{}j()},children:"Close"})]})]}),e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",minHeight:"30px",justifyContent:"space-between",borderBottom:"none"},children:[e.jsx("p",{className:"MbfWindowHeaderText",children:o}),c&&e.jsx("p",{className:"MbfWindowHeaderText",children:c}),e.jsx("div",{className:"MbfWindowHeaderFooterIcons",children:e.jsx(Q,{onClick:a=>{if(a?.currentTarget?.blur)try{a.currentTarget.blur()}catch{}j()},"aria-label":"Configure Columns",style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},children:e.jsx(R,{title:`Configure ${o} columns`,children:e.jsx(te,{path:io,size:"20px",color:"var(--header-text-color)"})})})})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",flex:"1 1 auto",minHeight:0,width:"100%",overflow:"auto",margin:"0px",padding:"0px",gap:"0"},children:e.jsxs("table",{"aria-label":`${o} table`,style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{style:{position:"sticky",top:0,zIndex:10,border:"none",color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color"},children:e.jsx("tr",{style:{height:"30px",minHeight:"30px"},children:d.map(a=>{if(a.hidden||!a.required&&v[a.id]===!1)return null;const l=!a.noSort,g=l&&C===a.id&&!!$;return e.jsxs("th",{onClick:l?()=>H(a.id):void 0,style:{margin:"0",padding:"5px 10px",position:"sticky",top:0,minWidth:a.minWidth,maxWidth:a.maxWidth,textAlign:a.align||"left",cursor:l?"pointer":"default",border:"none",color:"var(--header-text-color)",backgroundColor:"var(--header-bg-color)",whiteSpace:a.maxWidth?"nowrap":void 0,overflow:a.maxWidth?"hidden":void 0,textOverflow:a.maxWidth?"ellipsis":void 0},"aria-sort":l?g?$==="asc"?"ascending":"descending":"none":void 0,children:[a.label,g&&e.jsxs("span",{style:{marginLeft:6},children:[$==="asc"&&e.jsx(te,{path:so,size:"15px"}),$==="desc"&&e.jsx(te,{path:ao,size:"15px"})]})]},a.id)})})}),e.jsx("tbody",{children:w.map((a,l)=>{const g=u(a);return e.jsx("tr",{className:l%2===0?"table-content-even":"table-content-odd",onClick:t?h=>t(a,g,h):void 0,style:{height:"30px",minHeight:"30px",border:"none",borderCollapse:"collapse",cursor:t?"pointer":void 0},children:d.map(h=>{if(h.hidden||!h.required&&v[h.id]===!1)return null;const L=a[h.id];return e.jsx("td",{style:{border:"none",borderCollapse:"collapse",textAlign:h.align||"left",padding:"5px 10px",margin:"0",maxWidth:h.maxWidth,whiteSpace:h.maxWidth?"nowrap":void 0,overflow:h.maxWidth?"hidden":void 0,textOverflow:h.maxWidth?"ellipsis":void 0},children:typeof h.render=="function"?h.render(L,g,a,h):typeof L=="boolean"?e.jsx(Te,{checked:L,disabled:!0,size:"small",sx:{m:0,p:0,color:"var(--table-text-color)","&.Mui-disabled":{color:"var(--table-text-color)",opacity:.7}}}):h.format&&typeof L=="number"?h.format(L):L!=null?String(L):null},h.id)})},g)})})]})}),(y||m)&&e.jsxs("div",{className:"MbfWindowFooter",style:{height:"30px",minHeight:"30px",justifyContent:"space-between",border:"none"},children:[e.jsx("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)"},children:y}),e.jsx("p",{className:"MbfWindowFooterText",style:{fontSize:"14px",fontWeight:"normal",color:"var(--secondary-color)"},children:m})]})]})}function rn(o){return r.memo(o)}const mt=rn(tn);function on({storeId:o,setStoreId:c}){const{online:d,sendMessage:n,addListener:s,removeListener:y,getUniqueId:m}=r.useContext(fe),{showConfirmCancelDialog:t}=r.useContext(Be),x=r.useRef(m()),[W,u]=r.useState(null),[C,E]=r.useState(null),[$,T]=r.useState([]),V=[{label:"Name",id:"name",required:!0,render:(F,A,N,P)=>e.jsx(R,{title:"Open the plugin homepage",children:e.jsx("span",{style:{cursor:"pointer"},onClick:()=>a(N),children:N.name})})},{label:"Description",id:"description",render:(F,A,N,P)=>e.jsx(R,{title:"Open the plugin homepage",children:e.jsx("span",{style:{cursor:"pointer"},onClick:()=>a(N),children:N.description})})},{label:"Version",id:"version",render:(F,A,N,P)=>e.jsxs(e.Fragment,{children:[N.latestVersion!==void 0&&N.latestVersion!==N.version&&C&&!C.readOnly&&e.jsx(R,{title:"New plugin stable version available, click to install",children:e.jsxs("span",{className:"status-warning",style:{marginRight:"10px"},onClick:()=>w(N),children:["Update to v.",N.latestVersion]})}),N.version.includes("-dev-")&&N.devVersion!==void 0&&N.devVersion!==N.version&&C&&!C.readOnly&&e.jsx(R,{title:"New plugin dev version available, click to install",children:e.jsxs("span",{className:"status-warning",style:{marginRight:"10px"},onClick:()=>H(N),children:["Update to new dev v.",N.devVersion.split("-dev-")[0]]})}),e.jsx(R,{title:"Plugin version",children:e.jsx("span",{children:N.version})})]})},{label:"Author",id:"author",render:(F,A,N,P)=>e.jsx(e.Fragment,{children:N.author?N.author.replace("https://github.com/",""):"Unknown"})},{label:"Type",id:"type",render:(F,A,N,P)=>e.jsx(e.Fragment,{children:N.type?N.type.replace("Platform",""):"Unknown"})},{label:"Devices",id:"registeredDevices"},{label:"Actions",id:"actions",required:!0,noSort:!0,render:(F,A,N,P)=>e.jsxs("div",{style:{margin:"0px",padding:"0px",gap:"4px",display:"flex",flexDirection:"row"},children:[C&&C.bridgeMode==="childbridge"&&!N.error&&N.enabled&&e.jsx(R,{title:"Shows the QRCode or the fabrics",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0",padding:"0",width:"19px",height:"19px",color:Qt(N.matter)},onClick:()=>{N.matter?.id&&c(N.matter?.id)},size:"small",children:e.jsx(At,{})})}),C&&C.bridgeMode==="childbridge"&&!N.error&&N.enabled&&e.jsx(R,{title:"Restart the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0",padding:"0",width:"19px",height:"19px"},onClick:()=>M(N),size:"small",children:e.jsx(dt,{})})}),e.jsx(R,{title:"Plugin config",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{disabled:N.restartRequired===!0,style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>ge(N),size:"small",children:e.jsx(vt,{})})}),C&&!C.readOnly&&e.jsx(R,{title:"Remove the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>{O("Remove plugin","Are you sure? This will also remove all devices and configuration from the controller.","remove",N)},size:"small",children:e.jsx(ut,{})})}),N.enabled?e.jsx(R,{title:"Disable the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>{O("Disable plugin","Are you sure? This will also remove all devices and configuration from the controller.","disable",N)},size:"small",children:e.jsx(wr,{})})}):e.jsx(e.Fragment,{}),N.enabled?e.jsx(e.Fragment,{}):e.jsx(R,{title:"Enable the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>U(N),size:"small",children:e.jsx(Sr,{})})}),e.jsx(R,{title:"Open the plugin help",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>g(N),size:"small",children:e.jsx(Mr,{})})}),e.jsx(R,{title:"Open the plugin version history",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0px",padding:"0px",width:"19px",height:"19px"},onClick:()=>h(N),size:"small",children:e.jsx(kr,{})})}),C&&!C.readOnly&&e.jsx(R,{title:"Sponsor the plugin",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{style:{margin:"0",padding:"0",width:"19px",height:"19px",color:"#b6409c"},onClick:()=>l(N),size:"small",children:e.jsx(Vt,{})})})]})},{label:"Status",id:"status",required:!0,noSort:!0,render:(F,A,N,P)=>e.jsx("div",{style:{display:"flex",flexDirection:"row",flex:"1 1 auto",margin:"0",padding:"0",gap:"5px",width:"auto",maxWidth:"max-content"},children:N.error?e.jsx(e.Fragment,{children:e.jsx(Ee,{status:!1,enabledText:"Error",disabledText:"Error",tooltipText:"The plugin is in error state. Check the log!"})}):e.jsx(e.Fragment,{children:N.enabled===!1?e.jsx(e.Fragment,{children:e.jsx(Ee,{status:N.enabled,enabledText:"Enabled",disabledText:"Disabled",tooltipText:"Whether the plugin is enable or disabled"})}):e.jsx(e.Fragment,{children:N.loaded&&N.started&&N.configured?e.jsx(e.Fragment,{children:e.jsx(Ee,{status:N.loaded,enabledText:"Running",tooltipText:"Whether the plugin is running"})}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{status:N.loaded,enabledText:"Loaded",tooltipText:"Whether the plugin has been loaded"}),e.jsx(Ee,{status:N.started,enabledText:"Started",tooltipText:"Whether the plugin started"}),e.jsx(Ee,{status:N.configured,enabledText:"Configured",tooltipText:"Whether the plugin has been configured"})]})})})})}];r.useEffect(()=>{const F=A=>{A.src==="Matterbridge"&&A.dst==="Frontend"&&(A.method==="refresh_required"&&A.response.changed==="plugins"&&(i&&console.log(`HomePlugins received refresh_required: changed=${A.response.changed} and sending /api/plugins request`),n({id:x.current,sender:"HomePlugins",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})),A.method==="refresh_required"&&A.response.changed==="matter"&&(i&&console.log(`HomePlugins received refresh_required: changed=${A.response.changed} and setting matter id ${A.response.matter?.id}`),T(N=>{const P=N.findIndex(S=>S.matter?.id===A.response.matter?.id);if(P<0)return i&&console.log(`HomePlugins received refresh_required: changed=${A.response.changed} and matter id ${A.response.matter?.id} not found`),N;i&&console.log(`HomePlugins received refresh_required: changed=${A.response.changed} set matter id ${A.response.matter?.id}`);const k=[...N];return k[P]={...k[P],matter:A.response.matter},k})),A.method==="refresh_required"&&A.response.changed==="settings"&&(i&&console.log(`HomePlugins received refresh_required: changed=${A.response.changed} and sending /api/settings request`),n({id:x.current,sender:"HomePlugins",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),A.id===x.current&&A.method==="/api/settings"&&(i&&console.log(`HomePlugins (id: ${A.id}) received settings:`,A.response),u(A.response.systemInformation),E(A.response.matterbridgeInformation)),A.id===x.current&&A.method==="/api/plugins"&&(i&&console.log(`HomePlugins (id: ${A.id}) received ${A.response.length} plugins:`,A.response),T(A.response)))};return s(F,x.current),i&&console.log("HomePlugins added WebSocket listener id:",x.current),()=>{y(F),i&&console.log("HomePlugins removed WebSocket listener")}},[s,y,n]),r.useEffect(()=>{d&&(i&&console.log("HomePlugins sending api requests"),n({id:x.current,sender:"HomePlugins",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),n({id:x.current,sender:"HomePlugins",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[d,n]);const f=r.useRef(null),O=(F,A,N,P)=>{i&&console.log(`handleActionWithConfirmCancel ${N} ${P.name}`),f.current=P,t(F,A,N,b,v)},b=F=>{i&&console.log(`handleConfirm action confirmed ${F} ${f.current?.name}`),F==="remove"&&f.current?j(f.current):F==="disable"&&f.current&&U(f.current),f.current=null},v=F=>{i&&console.log(`handleCancel action canceled ${F} ${f.current?.name}`),f.current=null},w=F=>{i&&console.log("handleUpdatePlugin plugin:",F.name),n({id:x.current,sender:"HomePlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:F.name,restart:!1}})},H=F=>{i&&console.log("handleUpdateDevPlugin plugin:",F.name),n({id:x.current,sender:"HomePlugins",method:"/api/install",src:"Frontend",dst:"Matterbridge",params:{packageName:F.name+"@dev",restart:!1}})},j=F=>{i&&console.log("handleRemovePlugin plugin:",F.name),n({id:x.current,sender:"HomePlugins",method:"/api/removeplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:F.name}})},M=F=>{i&&console.log("handleRestartPlugin plugin:",F.name),n({id:x.current,sender:"HomePlugins",method:"/api/restartplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:F.name}})},U=F=>{i&&console.log("handleEnableDisablePlugin plugin:",F.name,"enabled:",F.enabled),F.enabled===!0?(F.enabled=!1,n({id:x.current,sender:"HomePlugins",method:"/api/disableplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:F.name}})):(F.enabled=!0,n({id:x.current,sender:"HomePlugins",method:"/api/enableplugin",src:"Frontend",dst:"Matterbridge",params:{pluginName:F.name}}))},a=F=>{i&&console.log(`handleHomepagePlugin plugin: ${F.name} homepage: ${F.homepage}`),F.homepage&&window.open(F.homepage,"_blank")},l=F=>{i&&console.log("handleSponsorPlugin plugin:",F.name,"funding:",F.funding),F.funding&&window.open(F.funding,"_blank")},g=F=>{i&&console.log("handleHelpPlugin plugin:",F.name,"help:",F.help),F.help&&window.open(F.help,"_blank")},h=F=>{i&&console.log("handleChangelogPlugin plugin:",F.name,"changelog:",F.changelog),F.changelog&&window.open(F.changelog,"_blank")},[L,X]=r.useState(),[be,he]=r.useState(!1),ge=F=>{i&&console.log("handleConfigPlugin plugin:",F.name),n({id:x.current,sender:"HomePlugins",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:F.name}}),n({id:x.current,sender:"HomePlugins",method:"/api/select/entities",src:"Frontend",dst:"Matterbridge",params:{plugin:F.name}}),X(F),G()},G=()=>{he(!0)},ne=()=>{he(!1)};return i&&console.log("HomePlugins rendering..."),d?e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",width:"100%",flex:"0 0 auto",overflow:"hidden"},children:[L&&e.jsx(Zo,{open:be,onClose:ne,plugin:L}),e.jsx(mt,{name:"Plugins",columns:V,rows:$,footerRight:"",footerLeft:""})]}):e.jsx(Oe,{})}const nn=r.memo(on),sn=o=>`${o.pluginName}::${o.serial}`;function an({storeId:o,setStoreId:c}){const{online:d,sendMessage:n,addListener:s,removeListener:y,getUniqueId:m}=r.useContext(fe),[t,x]=r.useState(!1),[W,u]=r.useState(!0),[C,E]=r.useState(null),[$,T]=r.useState([]),[V,f]=r.useState([]),[O,b]=r.useState([]),[v,w]=r.useState([]),H=r.useRef(m()),j=[{label:"Plugin",id:"pluginName"},{label:"Name",id:"name",required:!0},{label:"Serial",id:"serial"},{label:"Availability",id:"availability",render:(a,l,g,h)=>g.reachable===!0?"Online":g.reachable===!1?e.jsx("span",{style:{color:"red"},children:"Offline"}):"",comparator:(a,l)=>{const g=a.reachable===!0?1:a.reachable===!1?0:-1,h=l.reachable===!0?1:l.reachable===!1?0:-1;return g-h}},{label:"Power",id:"powerSource",render:(a,l,g,h)=>g.powerSource==="ac"||g.powerSource==="dc"?e.jsx(_t,{fontSize:"small",sx:{color:"var(--primary-color)"}}):g.powerSource==="ok"?e.jsx(pt,{fontSize:"small",sx:{color:"green"}}):g.powerSource==="warning"?e.jsx(pt,{fontSize:"small",sx:{color:"yellow"}}):g.powerSource==="critical"?e.jsx(pt,{fontSize:"small",sx:{color:"red"}}):e.jsx("span",{})},{label:"Url",id:"configUrl"},{label:"Actions",id:"selected",required:!0,render:(a,l,g,h)=>e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[g.matter!==void 0?e.jsx(R,{title:"Show the QRCode or the fabrics",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{onClick:()=>c(o===g.matter?.id?C?.matterbridgeInformation.bridgeMode==="bridge"?"Matterbridge":null:g.matter?.id||null),"aria-label":"Show the QRCode",sx:{margin:0,padding:0,color:Qt(g.matter)},children:e.jsx(At,{fontSize:"small"})})}):e.jsx("div",{style:{width:"20px",height:"20px"}}),g.configUrl?e.jsx(R,{title:"Open the configuration page",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Q,{onClick:()=>window.open(g.configUrl,"_blank"),"aria-label":"Open config url",sx:{margin:0,padding:0},children:e.jsx(vt,{fontSize:"small"})})}):e.jsx("div",{style:{width:"20px",height:"20px"}}),g.selected!==void 0?e.jsx(R,{title:"Select/unselect the device",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[30,15]}}]}},children:e.jsx(Te,{checked:g.selected,onChange:L=>U(L,g),sx:{margin:"0",marginLeft:"8px",padding:"0"},size:"small"})}):e.jsx("div",{style:{width:"20px",height:"20px"}})]})}],M=r.useCallback(a=>{a.selected=void 0;const l=$.find(L=>L.name===a.pluginName);if(!l)return console.error(`HomeDevices isSelected: plugin ${a.pluginName} not found for device ${a.name} `),a.selected;const g=l.schemaJson?.properties?.whiteList?.selectFrom;let h=l.configJson.postfix;return h===""&&(h=void 0),l.hasWhiteList===!0&&l.hasBlackList===!0&&g&&(a.selected=!0,g==="serial"&&l.configJson.whiteList&&l.configJson.whiteList.length>0&&l.configJson.whiteList.includes(h?a.serial.replace("-"+h,""):a.serial)&&(a.selected=!0),g==="serial"&&l.configJson.whiteList&&l.configJson.whiteList.length>0&&!l.configJson.whiteList.includes(h?a.serial.replace("-"+h,""):a.serial)&&(a.selected=!1),g==="serial"&&l.configJson.blackList&&l.configJson.blackList.length>0&&l.configJson.blackList.includes(h?a.serial.replace("-"+h,""):a.serial)&&(a.selected=!1),g==="name"&&l.configJson.whiteList&&l.configJson.whiteList.length>0&&l.configJson.whiteList.includes(a.name)&&(a.selected=!0),g==="name"&&l.configJson.whiteList&&l.configJson.whiteList.length>0&&!l.configJson.whiteList.includes(a.name)&&(a.selected=!1),g==="name"&&l.configJson.blackList&&l.configJson.blackList.length>0&&l.configJson.blackList.includes(a.name)&&(a.selected=!1)),a.selected},[$]);r.useEffect(()=>{const a=l=>{if(l.src==="Matterbridge"&&l.dst==="Frontend"){if(l.method==="refresh_required"&&l.response.changed!=="matter"&&(i&&console.log(`HomeDevices received refresh_required: changed=${l.response.changed} and sending /api/plugins request`),n({id:H.current,sender:"HomeDevices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})),l.method==="refresh_required"&&l.response.changed==="matter"&&(i&&console.log(`HomeDevices received refresh_required: changed=${l.response.changed} and setting matter id ${l.response.matter?.id}`),w(g=>{const h=g.findIndex(X=>X.name.replaceAll(" ","")===l.response.matter?.id);if(h<0)return i&&console.debug(`HomeDevices: matter id ${l.response.matter?.id} not found`),g;const L=[...g];return L[h]={...L[h],matter:l.response.matter},i&&console.log(`HomeDevices received refresh_required: changed=${l.response.changed} and set matter id ${l.response.matter?.id}`),L})),l.method==="restart_required"&&(i&&console.log("HomeDevices received restart_required"),x(!0)),l.method==="restart_not_required"&&(i&&console.log("HomeDevices received restart_not_required"),x(!1)),l.method==="state_update"&&l.response.plugin&&l.response.serialNumber&&l.response.cluster.includes("BasicInformationServer")&&l.response.attribute==="reachable"&&(console.log(`HomeDevices updating device reachability for plugin ${l.response.plugin} serial ${l.response.serialNumber} value ${l.response.value}`),f(g=>g.map(h=>h.pluginName===l.response.plugin&&h.serial===l.response.serialNumber?{...h,reachable:l.response.value}:h))),l.id===H.current&&l.method==="/api/settings"&&(i&&console.log(`HomeDevices (id: ${l.id}) received settings:`,l.response),E(l.response),x(l.response.matterbridgeInformation.restartRequired||l.response.matterbridgeInformation.fixedRestartRequired)),l.id===H.current&&l.method==="/api/plugins"&&(i&&console.log(`HomeDevices (id: ${l.id}) received ${l.response?.length} plugins:`,l.response),l.response)){let g=!0;for(const h of l.response)h.enabled===!0&&(h.loaded!==!0||h.started!==!0||h.error===!0)&&(g=!1);if(!g)return;i&&console.log("HomeDevices reset plugins, devices and selectDevices"),u(!1),T(l.response),f([]),b([]),n({id:H.current,sender:"HomeDevices",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}}),i&&console.log("HomeDevices sent /api/devices");for(const h of l.response)h.enabled===!0&&h.loaded===!0&&h.started===!0&&h.error!==!0&&(n({id:H.current,sender:"HomeDevices",method:"/api/select/devices",src:"Frontend",dst:"Matterbridge",params:{plugin:h.name}}),i&&console.log(`HomeDevices sent /api/select/devices for plugin: ${h.name}`))}if(l.id===H.current&&l.method==="/api/devices"&&(i&&console.log(`HomeDevices (id: ${l.id}) received ${l.response?.length} devices:`,l.response),l.response)){for(const g of l.response)g.selected=M(g);f(l.response)}l.id===H.current&&l.method==="/api/select/devices"&&(i&&console.log(`HomeDevices (id: ${l.id}) received ${l.response?.length} selectDevices for plugin ${l.response&&l.response.length>0?l.response[0].pluginName:"without select devices"}:`,l.response),l.response&&l.response.length>0&&b(g=>{const h=g.filter(X=>X.pluginName!==l.response[0].pluginName),L=l.response.map(X=>({...X,selected:M(X)}));return[...h,...L]}))}};return s(a,H.current),i&&console.log(`HomeDevices added WebSocket listener id ${H.current}`),()=>{y(a),i&&console.log("HomeDevices removed WebSocket listener")}},[$,s,y,n,M]),r.useEffect(()=>{if(V.length===0&&O.length===0){w([]);return}i&&console.log(`HomeDevices mixing devices (${V.length}) and selectDevices (${O.length})`);const a=[];for(const l of V)a.push(l);for(const l of O)V.find(g=>g.pluginName===l.pluginName&&g.serial.includes(l.serial))||a.push(l);a.length>0&&(w(a),i&&console.log(`HomeDevices mixed ${a.length} devices and selectDevices`))},[$,V,O,w]),r.useEffect(()=>{d&&(i&&console.log("HomeDevices sending /api/settings and /api/plugins requests"),n({id:H.current,sender:"HomeDevices",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),n({id:H.current,sender:"HomeDevices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[d,n]);const U=(a,l)=>{console.log(`handleCheckboxChange: checkbox changed to ${a.target.checked} for device ${l.name} serial ${l.serial}`),w(g=>{const h=g.findIndex(X=>X.pluginName===l.pluginName&&X.serial===l.serial);if(h<0)return console.error(`handleCheckboxChange: device not found ${l.name} serial ${l.serial}`),g;const L=[...g];return L[h]={...L[h],selected:a.target.checked},L}),a.target.checked?n({id:H.current,sender:"HomeDevices",method:"/api/command",src:"Frontend",dst:"Matterbridge",params:{command:"selectdevice",plugin:l.pluginName,serial:l.serial,name:l.name}}):n({id:H.current,sender:"HomeDevices",method:"/api/command",src:"Frontend",dst:"Matterbridge",params:{command:"unselectdevice",plugin:l.pluginName,serial:l.serial,name:l.name}})};return i&&console.log("HomeDevices rendering..."),d?e.jsx("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",width:"100%",flex:"1 1 auto",overflow:"hidden"},children:e.jsx(mt,{name:"Devices",getRowKey:sn,rows:v,columns:j,footerLeft:W?"Waiting for the plugins to fully load...":`Registered devices: ${V.length.toString()}/${v.length.toString()}`,footerRight:t?"Restart required":""})}):e.jsx(Oe,{})}const ln=r.memo(an);function dn(){const[o,c]=r.useState(null),[d,n]=r.useState(null),[s,y]=r.useState([]),[m]=r.useState(localStorage.getItem("homePagePlugins")!=="false"),[t,x]=r.useState(localStorage.getItem("homePageMode")??"devices"),[W,u]=r.useState(""),[C,E]=r.useState(!1),[$,T]=r.useState(!1),[V,f]=r.useState(null),{addListener:O,removeListener:b,online:v,sendMessage:w,logFilterLevel:H,logFilterSearch:j,autoScroll:M,getUniqueId:U}=r.useContext(fe),a=r.useRef(U());return r.useEffect(()=>{const l=g=>{g.src==="Matterbridge"&&g.dst==="Frontend"&&(g.method==="refresh_required"&&g.response.changed==="settings"&&(i&&console.log(`Home received refresh_required: changed=${g.response.changed} and sending /api/settings request`),f(null),y([]),w({id:a.current,sender:"Home",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),w({id:a.current,sender:"Home",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}})),g.method==="/api/settings"&&g.id===a.current&&(i&&console.log("Home received settings:",g.response),c(g.response.systemInformation),n(g.response.matterbridgeInformation),g.response.matterbridgeInformation.bridgeMode==="bridge"&&(V||f("Matterbridge")),g.response.matterbridgeInformation.bridgeMode==="childbridge"&&s.length>0&&V===null&&!V&&s.length>0&&s[0].matter?.id&&f(s[0].matter.id),g.response.matterbridgeInformation.matterbridgeVersion&&u(`https://github.com/Luligu/matterbridge/blob/${g.response.matterbridgeInformation.matterbridgeVersion.includes("-dev-")?"dev":"main"}/CHANGELOG.md`),localStorage.getItem("frontendVersion")===null&&g.response.matterbridgeInformation.frontendVersion?localStorage.setItem("frontendVersion",g.response.matterbridgeInformation.frontendVersion):g.response.matterbridgeInformation.frontendVersion!==localStorage.getItem("frontendVersion")&&g.response.matterbridgeInformation.frontendVersion&&(localStorage.setItem("frontendVersion",g.response.matterbridgeInformation.frontendVersion),T(!0)),localStorage.getItem("matterbridgeVersion")===null?localStorage.setItem("matterbridgeVersion",g.response.matterbridgeInformation.matterbridgeVersion):g.response.matterbridgeInformation.matterbridgeVersion!==localStorage.getItem("matterbridgeVersion")&&(localStorage.setItem("matterbridgeVersion",g.response.matterbridgeInformation.matterbridgeVersion),E(!0)),g.response.matterbridgeInformation.shellyBoard&&(localStorage.getItem("homePageMode")||(localStorage.setItem("homePageMode","devices"),x("devices")))),g.method==="/api/plugins"&&g.id===a.current&&(i&&console.log(`Home received plugins (${d?.bridgeMode}):`,g.response),y(g.response),d?.bridgeMode==="childbridge"&&g.response.length>0&&!V&&g.response.length>0&&g.response[0].matter?.id&&f(g.response[0].matter.id)))};return O(l,a.current),i&&console.log(`Home added WebSocket listener id ${a.current}`),()=>{b(l),i&&console.log("Home removed WebSocket listener")}},[O,b,w,d,s,V]),r.useEffect(()=>{v&&(i&&console.log("Home received online"),w({id:a.current,sender:"Home",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),w({id:a.current,sender:"Home",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}))},[v,w]),i&&console.log("Home rendering..."),!v||!o||!d?e.jsx(Oe,{}):e.jsxs("div",{className:"MbfPageDiv",style:{flexDirection:"row"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",width:"302px",minWidth:"302px",gap:"20px"},children:[e.jsx(Qo,{id:V}),e.jsx(zo,{systemInfo:o,compact:!0})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",width:"100%",gap:"20px"},children:[$&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Frontend Update"})}),e.jsxs("div",{className:"MbfWindowBody",style:{flexDirection:"row",justifyContent:"space-between"},children:[e.jsx("h4",{style:{margin:0},children:"The frontend has been updated. You are viewing an outdated web UI. Please refresh the page now."}),e.jsx("div",{children:e.jsx(oe,{onClick:()=>window.location.reload(),endIcon:e.jsx(Ir,{}),style:{marginLeft:"10px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Refresh"})})]})]}),C&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge Update"})}),e.jsxs("div",{className:"MbfWindowBody",style:{flexDirection:"row",justifyContent:"space-between"},children:[e.jsx("h4",{style:{margin:0},children:"Matterbridge has been updated."}),e.jsxs("div",{children:[e.jsx(oe,{onClick:()=>window.open(W,"_blank"),endIcon:e.jsx(Et,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Changelog"}),e.jsx(oe,{onClick:()=>window.location.reload(),endIcon:e.jsx(Dr,{}),style:{marginLeft:"10px",color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Close"})]})]})]}),m&&!d.readOnly&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto",width:"100%",overflow:"hidden"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Install plugins"})}),e.jsx(Jo,{})]}),m&&e.jsx(nn,{storeId:V,setStoreId:f}),t==="devices"&&e.jsx(ln,{storeId:V,setStoreId:f}),t==="logs"&&e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"1 1 auto",width:"100%",overflow:"hidden"},children:[e.jsxs("div",{className:"MbfWindowHeader",style:{height:"30px",minHeight:"30px",justifyContent:"space-between"},children:[e.jsx("p",{className:"MbfWindowHeaderText",children:"Logs"}),e.jsx("div",{className:"MbfWindowHeaderText",style:{display:"flex",justifyContent:"space-between"},children:e.jsxs("span",{style:{fontWeight:"normal",fontSize:"12px",marginTop:"2px"},children:['Filter: logger level "',H,'" and search "',j,'" Scroll: ',M?"auto":"manual"]})})]}),e.jsx("div",{style:{flex:"1 1 auto",margin:"0px",padding:"10px",overflow:"auto"},children:e.jsx(Bt,{})})]})]})]})}const cn=r.memo(dn),Ht={display:"flex",gap:"2px",justifyContent:"space-evenly",width:"100%",height:"40px"},pn={margin:"0",padding:"0",fontSize:"36px",fontWeight:"medium",color:"var(--primary-color)"},un={margin:"0",padding:"0",fontSize:"20px",fontWeight:"medium",color:"var(--div-text-color)",textAlign:"center"},Ot={margin:"0",padding:"0",paddingBottom:"2px",fontSize:"16px",fontWeight:"medium",color:"var(--div-text-color)",textAlign:"center"},gn={display:"flex",gap:"2px",justifyContent:"center",width:"100%",height:"18px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},mn={margin:"0",padding:"0",fontSize:"12px",fontWeight:"normal",color:"var(--div-text-color)"},hn={display:"flex",justifyContent:"center",width:"100%",height:"52px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},fn={margin:"0",padding:"0",fontSize:"14px",fontWeight:"bold",color:"var(--div-text-color)"},xn={display:"flex",gap:"4px",justifyContent:"center",width:"100%",height:"15px",margin:"0",padding:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"normal"},bt={margin:"0",padding:"0px 4px",borderRadius:"5px",textAlign:"center",fontSize:"12px",fontWeight:"normal",color:"var(--secondary-color)"},bn=[256,257,268,269],vn=[266,267],yn=[259,260,261,271,272],jn=[256,257,268,269,266,267,259,260,261];function q({icon:o,iconColor:c,cluster:d,value:n,unit:s,prefix:y}){return i&&console.log(`Render cluster "${d.clusterName}.${d.attributeName}" value(${typeof n}-${isNaN(n)}) "${n}" unit "${s}"`),y=y??!1,e.jsxs(Y,{sx:Ht,children:[o&&r.cloneElement(o,{key:`${d.clusterId}-${d.attributeId}-icon`,sx:{...pn,color:c??"var(--primary-color)"}}),e.jsxs(Y,{sx:{...Ht,gap:"4px",alignContent:"center",alignItems:"end",justifyContent:"center"},children:[s&&y===!0&&e.jsx(re,{sx:Ot,children:s},`${d.clusterId}-${d.attributeId}-unit`),e.jsx(re,{sx:un,children:n==null||typeof n=="number"&&isNaN(n)||n==="NaN"?"---":n},`${d.clusterId}-${d.attributeId}-value`),s&&y===!1&&e.jsx(re,{sx:Ot,children:s},`${d.clusterId}-${d.attributeId}-unit`)]},`${d.clusterId}-${d.attributeId}-valueunitbox`)]},`${d.clusterId}-${d.attributeId}-box`)}function Cn({device:o,endpoint:c,id:d,deviceType:n,clusters:s}){const y=["Unknown","Good","Fair","Moderate","Poor","VeryPoor","Ext.Poor"];let m="";return i&&console.log(`Device "${o.name}" endpoint "${c}" id "${d}" deviceType "0x${n.toString(16).padStart(4,"0")}" clusters (${s?.length}):`,s),n===17&&s.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="batVoltage").map(t=>m=`${t.attributeLocalValue} mV`),jn.includes(n)&&s.filter(t=>t.clusterName==="LevelControl"&&t.attributeName==="currentLevel").map(t=>m=`Level ${t.attributeValue}`),n===514&&s.filter(t=>t.clusterName==="WindowCovering"&&t.attributeName==="currentPositionLiftPercent100ths").map(t=>m=`Position ${t.attributeLocalValue/100}%`),n===769&&s.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="occupiedHeatingSetpoint").map(t=>m=`Heat ${t.attributeLocalValue/100}°C `),n===769&&s.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="occupiedCoolingSetpoint").map(t=>m=m+`Cool ${t.attributeLocalValue/100}°C`),n===118&&s.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="coState").map(t=>m=`${t.attributeLocalValue===0?"No CO detected":"CO alarm!"}`),n===1296&&s.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="voltage").map(t=>m=`${t.attributeLocalValue/1e3} V, `),n===1296&&s.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="activeCurrent").map(t=>m=m+`${t.attributeLocalValue/1e3} A, `),n===1296&&s.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="activePower").map(t=>m=m+`${t.attributeLocalValue/1e3} W`),e.jsxs("div",{className:"MbfWindowDiv",style:{margin:"0px",padding:"5px",width:"150px",height:"150px",borderColor:"var(--div-bg-color)",borderRadius:"5px",justifyContent:"space-between"},children:[n===19&&s.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(q,{icon:t.attributeLocalValue===!0?e.jsx(Ge,{}):e.jsx(Nr,{}),iconColor:t.attributeLocalValue===!0?"green":"red",cluster:t,value:t.attributeLocalValue===!0?"Online":"Offline"})),n===17&&s.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="batPercentRemaining").map(t=>e.jsx(q,{icon:e.jsx(pt,{}),cluster:t,value:t.attributeLocalValue/2,unit:"%"})),n===17&&s.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="wiredCurrentType").map(t=>e.jsx(q,{icon:e.jsx(_t,{}),cluster:t,value:t.attributeLocalValue===0?"AC":"DC"})),n===1293&&s.filter(t=>t.clusterName==="DeviceEnergyManagement"&&t.attributeName==="esaState").map(t=>e.jsx(q,{icon:e.jsx(te,{path:lo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Offline":"Online"})),bn.includes(n)&&s.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(q,{icon:e.jsx(Pr,{}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),vn.includes(n)&&s.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(q,{icon:e.jsx(te,{path:co,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),yn.includes(n)&&s.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(q,{icon:e.jsx(te,{path:po,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),n===115&&s.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(q,{icon:e.jsx(te,{path:uo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),n===124&&s.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(q,{icon:e.jsx(te,{path:go,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),n===117&&s.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(q,{icon:e.jsx(te,{path:mo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),n===123&&s.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(q,{icon:e.jsx(Dt,{}),cluster:t,value:"Oven"})),n===112&&s.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(q,{icon:e.jsx(Wr,{}),cluster:t,value:"Fridge"})),n===113&&s.filter(t=>t.clusterName==="TemperatureControl"&&t.attributeName==="selectedTemperatureLevel").map(t=>e.jsx(q,{icon:e.jsx(te,{path:ho,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),n===121&&s.filter(t=>t.clusterName==="OperationalState"&&t.attributeName==="operationalState").map(t=>e.jsx(q,{icon:e.jsx(Dt,{}),cluster:t,value:t.attributeLocalValue===0?"Normal":"Error"})),n===122&&s.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="fanMode").map(t=>e.jsx(q,{icon:e.jsx(te,{path:fo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),n===120&&s.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(q,{icon:e.jsx(te,{path:Lt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Cooktop"})),n===119&&s.filter(t=>t.clusterName==="TemperatureControl"&&t.attributeName==="selectedTemperatureLevel").map(t=>e.jsx(q,{icon:e.jsx(te,{path:Lt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue,unit:"mode",prefix:!0})),n===116&&s.filter(t=>t.clusterName==="BridgedDeviceBasicInformation"&&t.attributeName==="reachable").map(t=>e.jsx(q,{icon:e.jsx(te,{path:xo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Robot"})),n===514&&s.filter(t=>t.clusterName==="WindowCovering"&&t.attributeName==="currentPositionLiftPercent100ths").map(t=>e.jsx(q,{icon:e.jsx(Fr,{}),cluster:t,value:t.attributeLocalValue/100,unit:"%"})),n===769&&s.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="localTemperature").map(t=>e.jsx(q,{icon:e.jsx(te,{path:bo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:(t.attributeLocalValue??0)/100,unit:"°C"})),n===10&&s.filter(t=>t.clusterName==="DoorLock"&&t.attributeName==="lockState").map(t=>e.jsx(q,{icon:t.attributeValue==="1"?e.jsx(Lr,{}):e.jsx(Tr,{}),cluster:t,value:t.attributeValue==="1"?"Locked":"Unlocked"})),n===43&&s.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="percentCurrent").map(t=>e.jsx(q,{icon:e.jsx($r,{}),cluster:t,value:t.attributeValue,unit:"%"})),n===15&&s.filter(t=>t.clusterName==="Switch"&&t.attributeName==="currentPosition").map(t=>e.jsx(q,{icon:e.jsx(te,{path:vo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeValue,unit:"pos",prefix:!0})),n===39&&s.filter(t=>t.clusterName==="ModeSelect"&&t.attributeName==="currentMode").map(t=>e.jsx(q,{icon:e.jsx(Rr,{}),cluster:t,value:t.attributeValue,unit:"mode",prefix:!0})),n===771&&s.filter(t=>t.clusterName==="OnOff"&&t.attributeName==="onOff").map(t=>e.jsx(q,{icon:e.jsx(Hr,{}),cluster:t,value:t.attributeLocalValue===!0?"On":"Off"})),n===45&&s.filter(t=>t.clusterName==="FanControl"&&t.attributeName==="percentCurrent").map(t=>e.jsx(q,{icon:e.jsx(Nt,{}),cluster:t,value:t.attributeValue,unit:"%"})),n===114&&s.filter(t=>t.clusterName==="Thermostat"&&t.attributeName==="localTemperature").map(t=>e.jsx(q,{icon:e.jsx(Nt,{}),cluster:t,value:(t.attributeLocalValue??0)/100,unit:"°C"})),n===67&&s.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(q,{icon:e.jsx(Or,{}),cluster:t,value:t.attributeLocalValue===!0?"Leak":"No leak"})),n===65&&s.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(q,{icon:e.jsx(Vr,{}),cluster:t,value:t.attributeLocalValue===!0?"Freeze":"No freeze"})),n===68&&s.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(q,{icon:e.jsx(Er,{}),cluster:t,value:t.attributeLocalValue===!0?"Rain":"No rain"})),n===1292&&s.filter(t=>t.clusterName==="EnergyEvse"&&t.attributeName==="state").map(t=>e.jsx(q,{icon:e.jsx(te,{path:yo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"Free":"In use"})),n===1295&&s.filter(t=>t.clusterName==="WaterHeaterManagement"&&t.attributeName==="tankPercentage").map(t=>e.jsx(q,{icon:e.jsx(te,{path:jo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Tank "+(t.attributeLocalValue??0)+"%"})),n===777&&s.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="featureMap").map(t=>e.jsx(q,{icon:e.jsx(te,{path:Co,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"HeatPump"})),n===23&&s.filter(t=>t.clusterName==="PowerSource"&&t.attributeName==="featureMap").map(t=>e.jsx(q,{icon:e.jsx(te,{path:wo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Solar"})),n===24&&s.filter(t=>t.clusterName==="ElectricalPowerMeasurement"&&t.attributeName==="featureMap").map(t=>e.jsx(q,{icon:e.jsx(te,{path:So,size:"40px",color:"var(--primary-color)"}),cluster:t,value:"Inverter"})),n===118&&s.find(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="featureMap"&&t.attributeLocalValue.smokeAlarm===!0)&&s.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="smokeState").map(t=>e.jsx(q,{icon:e.jsx(te,{path:Tt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"No smoke":"Smoke!"})),n===118&&s.find(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="featureMap"&&t.attributeLocalValue.smokeAlarm===!1)&&s.filter(t=>t.clusterName==="SmokeCoAlarm"&&t.attributeName==="coState").map(t=>e.jsx(q,{icon:e.jsx(te,{path:Tt,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue===0?"No Co":"Co!"})),n===66&&s.filter(t=>t.clusterName==="ValveConfigurationAndControl"&&t.attributeName==="currentState").map(t=>e.jsx(q,{icon:e.jsx(Ar,{}),cluster:t,value:t.attributeLocalValue===0?"Closed":"Opened"})),n===44&&s.filter(t=>t.clusterName==="AirQuality"&&t.attributeName==="airQuality").map(t=>e.jsx(q,{icon:e.jsx(te,{path:Mo,size:"40px",color:"var(--primary-color)"}),cluster:t,value:y[t.attributeLocalValue??0]})),n===770&&s.filter(t=>t.clusterName==="TemperatureMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(q,{icon:e.jsx(_r,{}),cluster:t,value:t.attributeLocalValue/100,unit:"°C"})),n===775&&s.filter(t=>t.clusterName==="RelativeHumidityMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(q,{icon:e.jsx(te,{path:ko,size:"40px",color:"var(--primary-color)"}),cluster:t,value:t.attributeLocalValue/100,unit:"%"})),n===774&&s.filter(t=>t.clusterName==="FlowMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(q,{icon:e.jsx(qr,{}),cluster:t,value:t.attributeLocalValue,unit:"l/h"})),n===773&&s.filter(t=>t.clusterName==="PressureMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(q,{icon:e.jsx(zr,{}),cluster:t,value:t.attributeLocalValue,unit:"hPa"})),n===21&&s.filter(t=>t.clusterName==="BooleanState"&&t.attributeName==="stateValue").map(t=>e.jsx(q,{icon:t.attributeValue==="true"?e.jsx(Ur,{}):e.jsx(Br,{}),cluster:t,value:t.attributeValue==="true"?"Closed":"Opened"})),n===263&&s.filter(t=>t.clusterName==="OccupancySensing"&&t.attributeName==="occupancy").map(t=>e.jsx(q,{icon:t.attributeValue==="{ occupied: true }"?e.jsx(Qr,{}):e.jsx(Kr,{}),cluster:t,value:t.attributeValue==="{ occupied: true }"?"Occupied":"Unocc."})),n===262&&s.filter(t=>t.clusterName==="IlluminanceMeasurement"&&t.attributeName==="measuredValue").map(t=>e.jsx(q,{icon:e.jsx(Jr,{}),cluster:t,value:Math.round(Math.pow(10,t.attributeLocalValue/1e4)),unit:"lx"})),n===1296&&s.filter(t=>t.clusterName==="ElectricalEnergyMeasurement"&&t.attributeName==="cumulativeEnergyImported").map(t=>e.jsx(q,{icon:e.jsx(Gr,{}),cluster:t,value:Math.round(t.attributeLocalValue?.energy/1e6),unit:"kwh"})),e.jsx(Y,{sx:gn,children:e.jsx(re,{sx:mn,children:m})}),e.jsx(Y,{sx:hn,children:e.jsx(re,{sx:fn,children:o.name})}),e.jsxs(Y,{sx:xn,children:[i&&e.jsx(re,{sx:bt,children:c}),e.jsx(re,{sx:bt,children:d}),i&&e.jsxs(re,{sx:bt,children:["0x",n.toString(16).padStart(4,"0")]})]})]})}function wn({filter:o}){const{online:c,sendMessage:d,addListener:n,removeListener:s,getUniqueId:y}=r.useContext(fe),[m,t]=r.useState(null),[x,W]=r.useState([]),[u,C]=r.useState([]),[E,$]=r.useState(u),[T,V]=r.useState({}),[f,O]=r.useState({}),[b,v]=r.useState({}),w=r.useRef(y());r.useEffect(()=>{const j=M=>{if(M.src==="Matterbridge"&&M.dst==="Frontend"){if(M.method==="refresh_required"&&(i&&console.log(`DevicesIcons received refresh_required: changed=${M.response.changed} and sending api requests`),d({id:w.current,sender:"Icons",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),d({id:w.current,sender:"Icons",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),d({id:w.current,sender:"Icons",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}})),M.method==="/api/settings"&&M.response&&(i&&console.log("DevicesIcons received settings:",M.response),t(M.response)),M.method==="/api/plugins"&&M.response&&(i&&console.log("DevicesIcons received plugins:",M.response),W(M.response)),M.method==="/api/devices"&&M.response){i&&console.log(`DevicesIcons received ${M.response.length} devices:`,M.response),C(M.response);for(const U of M.response)i&&console.log("DevicesIcons sending /api/clusters"),d({id:w.current,sender:"Icons",method:"/api/clusters",src:"Frontend",dst:"Matterbridge",params:{plugin:U.pluginName,endpoint:U.endpoint||0}})}if(M.method==="/api/clusters"&&M.response){if(i&&console.log(`DevicesIcons received for device "${M.response.deviceName}" serial "${M.response.serialNumber}" deviceType ${M.response.deviceTypes.join(" ")} clusters (${M.response.clusters.length}):`,M.response),M.response.clusters.length===0)return;const U=M.response.serialNumber;T[U]=[],f[U]=M.response.deviceTypes,b[U]=[];for(const a of M.response.clusters)T[U].find(l=>l.endpoint===a.endpoint)||T[U].push({endpoint:a.endpoint,id:a.id,deviceTypes:a.deviceTypes}),!["FixedLabel","Descriptor","Identify","Groups","PowerTopology"].includes(a.clusterName)&&b[U].push(a);V({...T}),O({...f}),v({...b}),i&&console.log(`DevicesIcons endpoints for "${U}":`,T[U]),i&&console.log(`DevicesIcons deviceTypes for "${U}":`,f[U]),i&&console.log(`DevicesIcons clusters for "${U}":`,b[U])}}};return n(j,w.current),i&&console.log("DevicesIcons useEffect webSocket mounted"),()=>{s(j),i&&console.log("DevicesIcons useEffect webSocket unmounted")}},[n,s,d]),r.useEffect(()=>(i&&console.log("DevicesIcons useEffect online mounting"),c&&(i&&console.log("DevicesIcons useEffect online sending api requests"),d({id:w.current,sender:"DevicesIcons",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),d({id:w.current,sender:"DevicesIcons",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),d({id:w.current,sender:"DevicesIcons",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}})),i&&console.log("DevicesIcons useEffect online mounted"),()=>{i&&console.log("DevicesIcons useEffect online unmounted")}),[c,d]),r.useEffect(()=>{if(o===""){$(u);return}const j=u.filter(M=>M.name.toLowerCase().includes(o)||M.serial.toLowerCase().includes(o));$(j)},[u,o]);const H=r.memo(Cn);return i&&console.log("DevicesIcons rendering..."),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",paddingBottom:"5px",gap:"20px",width:"100%",overflow:"auto"},children:E.map(j=>T[j.serial]&&T[j.serial].map(M=>M.deviceTypes.map(U=>e.jsx(H,{device:j,endpoint:M.endpoint,id:M.id,deviceType:U,clusters:b[j.serial].filter(a=>a.endpoint===M.endpoint)},`${j.pluginName}-${j.uniqueId}-${U}`))))})}const Sn=r.memo(wn),Mn=[{label:"Plugin name",id:"pluginName",required:!0},{label:"Device type",id:"type"},{label:"Endpoint",id:"endpoint",align:"right"},{label:"Name",id:"name",required:!0},{label:"Serial number",id:"serial"},{label:"Unique ID",id:"uniqueId"},{label:"Url",id:"configUrl"},{label:"Config",id:"configButton",noSort:!0,render:(o,c,d,n)=>d.configUrl?e.jsx(Q,{onClick:()=>window.open(d.configUrl,"_blank"),"aria-label":"Open Config",sx:{margin:0,padding:0},children:e.jsx(vt,{fontSize:"small"})}):null},{label:"Cluster",id:"cluster"}],kn=[{label:"Endpoint",id:"endpoint",required:!0},{label:"Id",id:"id"},{label:"Device Types",id:"deviceTypes",render:(o,c,d,n)=>Array.isArray(o)?e.jsx(e.Fragment,{children:o.map(s=>`0x${s.toString(16).padStart(4,"0")}`).join(", ")}):e.jsx(e.Fragment,{children:o})},{label:"Cluster Name",id:"clusterName",required:!0},{label:"Cluster ID",id:"clusterId"},{label:"Attribute Name",id:"attributeName",required:!0},{label:"Attribute ID",id:"attributeId"},{label:"Attribute Value",id:"attributeValue",required:!0,render:(o,c,d,n)=>e.jsx(R,{title:String(o),componentsProps:{tooltip:{sx:{fontSize:"14px",fontWeight:"normal",color:"#ffffff",backgroundColor:"var(--primary-color)"}}},children:e.jsx("div",{style:{maxWidth:"500px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:String(o)})})}],In=o=>`${o.pluginName}::${o.uniqueId}`,Dn=o=>`${o.endpoint}::${o.clusterName}::${o.attributeName}`;function Nn(){const{online:o,sendMessage:c,addListener:d,removeListener:n,getUniqueId:s}=r.useContext(fe),[y,m]=r.useState([]),[t,x]=r.useState(y),[W,u]=r.useState([]),[C,E]=r.useState(0),[$,T]=r.useState(""),[V,f]=r.useState("icon"),[O,b]=r.useState(null),[v,w]=r.useState(null),[H,j]=r.useState(null),[M,U]=r.useState(null),a=r.useRef(s());r.useEffect(()=>{const L=X=>{if(i&&console.log("Devices received WebSocket Message:",X),X.method==="refresh_required"&&X.response.changed==="devices")i&&console.log(`Devices received refresh_required: changed=${X.response.changed} and sending /api/devices request`),c({id:a.current,sender:"Devices",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}});else if(X.method==="/api/devices")i&&console.log(`Devices received ${X.response.length} devices:`,X.response),m(X.response);else if(X.method==="/api/clusters"){i&&console.log(`Clusters received ${X.response.clusters.length} clusters for plugin ${X.response.plugin}:`,X.response),u(X.response.clusters);const be={};for(const he of X.response.clusters)i&&console.log("Cluster:",he.endpoint),be[he.endpoint]?be[he.endpoint]++:be[he.endpoint]=1;E(Object.keys(be).length)}};return d(L,a.current),i&&console.log("Devices added WebSocket listener"),()=>{n(L),i&&console.log("Devices removed WebSocket listener")}},[d,n,c]),r.useEffect(()=>{o&&(i&&console.log("Devices sending api requests with id ",a.current),c({id:a.current,sender:"Devices",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:a.current,sender:"Devices",method:"/api/plugins",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:a.current,sender:"Devices",method:"/api/devices",src:"Frontend",dst:"Matterbridge",params:{}}))},[o,c]),r.useEffect(()=>{O&&v&&(i&&console.log("Devices sending /api/clusters"),c({id:a.current,sender:"Devices",method:"/api/clusters",src:"Frontend",dst:"Matterbridge",params:{plugin:O,endpoint:Number(v)}}))},[O,v,c]),r.useEffect(()=>{if($===""){x(y);return}const L=y.filter(X=>X.name.toLowerCase().includes($)||X.serial.toLowerCase().includes($));x(L)},[y,$]),r.useEffect(()=>{const L=localStorage.getItem("devicesFilter");L&&T(L)},[]),r.useEffect(()=>{const L=localStorage.getItem("devicesViewMode");L&&f(L)},[]);const l=L=>{T(L.target.value.toLowerCase()),localStorage.setItem("devicesFilter",L.target.value.toLowerCase())},g=L=>{f(L),localStorage.setItem("devicesViewMode",L)},h=L=>{if(L.uniqueId===M){U(null),b(null),w(null),j(null);return}U(L.uniqueId),b(L.pluginName),w(L.endpoint?L.endpoint.toString():null),j(L.name)};return i&&console.log("Devices rendering..."),o?e.jsxs("div",{className:"MbfPageDiv",children:[e.jsxs("div",{className:"MbfWindowBodyRow",style:{justifyContent:"space-between",padding:0,gap:"20px",width:"100%",height:"45px",minHeight:"45px",maxHeight:"45px"},children:[e.jsxs(Y,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx(re,{sx:{fontSize:"16px",fontWeight:"normal",color:"var(--div-text-color)",marginLeft:"5px",whiteSpace:"nowrap"},children:"Filter by:"}),e.jsx(de,{variant:"outlined",value:$,onChange:l,placeholder:"Enter the device name or serial number",sx:{width:"320px"},InputProps:{style:{backgroundColor:"var(--main-bg-color)"}}})]}),e.jsxs(Y,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[e.jsx(re,{sx:{fontSize:"16px",fontWeight:"normal",color:"var(--div-text-color)",marginLeft:"5px",whiteSpace:"nowrap"},children:"View mode:"}),e.jsx(Q,{onClick:()=>g("table"),"aria-label":"Table View",disabled:V==="table",children:e.jsx(R,{title:"Table View",children:e.jsx(Yr,{style:{color:V==="table"?"var(--main-icon-color)":"var(--primary-color)"}})})}),e.jsx(Q,{onClick:()=>g("icon"),"aria-label":"Icon View",disabled:V==="icon",children:e.jsx(R,{title:"Icon View (beta)",children:e.jsx(Xr,{style:{color:V==="icon"?"var(--main-icon-color)":"var(--primary-color)"}})})})]})]}),V==="table"&&e.jsx("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",maxHeight:`${O&&v?"50%":"100%"}`,width:"100%",flex:"1 1 auto",overflow:"hidden"},children:e.jsx(mt,{name:"Registered devices",getRowKey:In,onRowClick:h,rows:t,columns:Mn,footerLeft:`Total devices: ${t.length.toString()}`})}),V==="table"&&O&&v&&e.jsx("div",{className:"MbfWindowDiv",style:{margin:"0",padding:"0",gap:"0",height:"50%",maxHeight:"50%",width:"100%",flex:"1 1 auto",overflow:"hidden"},children:e.jsx(mt,{name:"Clusters",title:H||"",getRowKey:Dn,rows:W,columns:kn,footerLeft:`Total child endpoints: ${C-1}`})}),V==="icon"&&e.jsx(Sn,{filter:$})]}):e.jsx(Oe,{})}const Pn=r.memo(Nn);function Wn(){const[o,c]=r.useState(localStorage.getItem("logFilterLevel")??"info"),[d,n]=r.useState(localStorage.getItem("logFilterSearch")??"*"),[s,y]=r.useState(localStorage.getItem("logAutoScroll")!=="false"),{setMessages:m,setLogFilters:t,online:x,setAutoScroll:W}=r.useContext(fe),u=T=>{c(T.target.value),t(T.target.value,d),localStorage.setItem("logFilterLevel",T.target.value),i&&console.log("handleChangeLevel called with value:",T.target.value)},C=T=>{n(T.target.value),t(o,T.target.value),localStorage.setItem("logFilterSearch",T.target.value),i&&console.log("handleChangeSearch called with value:",T.target.value)},E=T=>{y(T.target.checked),W(T.target.checked),localStorage.setItem("logAutoScroll",T.target.value?"true":"false"),i&&console.log("handleAutoScrollChange called with value:",T.target.checked)},$=()=>{i&&console.log("handleClearLogsClick called"),m([])};return i&&console.log("Logs rendering..."),x?e.jsxs("div",{className:"MbfPageDiv",children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",margin:"0px",padding:"0px",gap:"10px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(Pt,{id:"select-level",style:{color:"var(--div-text-color)"},children:"Filter log by level:"}),e.jsxs(Ue,{style:{height:"30px",backgroundColor:"var(--main-bg-color)"},labelId:"select-level",id:"debug-level",value:o,onChange:u,children:[e.jsx(D,{value:"debug",children:"Debug"}),e.jsx(D,{value:"info",children:"Info"}),e.jsx(D,{value:"notice",children:"Notice"}),e.jsx(D,{value:"warn",children:"Warn"}),e.jsx(D,{value:"error",children:"Error"}),e.jsx(D,{value:"fatal",children:"Fatal"})]}),e.jsx(Pt,{id:"search",style:{color:"var(--div-text-color)"},children:"Filter log by text:"}),e.jsx(de,{style:{width:"300px"},size:"small",id:"logsearch",variant:"outlined",value:d,onChange:C,InputProps:{style:{height:"30px",padding:"0 0px",backgroundColor:"var(--main-bg-color)"}}}),e.jsx(Le,{control:e.jsx(Te,{checked:s,onChange:E}),label:"Auto scroll",style:{color:"var(--div-text-color)"}})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:e.jsx(R,{title:"Clear the logs",children:e.jsx(oe,{onClick:$,endIcon:e.jsx(ut,{}),style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",height:"30px"},children:"Clear"})})})]}),e.jsx("div",{style:{flex:"1",overflow:"auto",margin:"0px",padding:"0px"},children:e.jsx(Bt,{})})]}):e.jsx(Oe,{})}const Fn=r.memo(Wn),Ln=({open:o,ip:c,onClose:d,onSave:n})=>{const s=c?c.split(".").slice(0,3).join(".")+".1":"",[y,m]=r.useState("dhcp"),[t,x]=r.useState({ip:c??"",subnet:"255.255.255.0",gateway:s,dns:s}),W=E=>$=>{x({...t,[E]:$.target.value})},u=()=>{d()},C=()=>{n({type:y,...t}),d()};return e.jsxs(Ie,{open:o,onClose:(E,$)=>{$==="backdropClick"||$==="escapeKeyDown"||d()},maxWidth:"sm",style:{maxWidth:"550px",margin:"auto"},children:[e.jsx(De,{gap:"20px",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:"Network Configuration"})]})}),e.jsxs(Ne,{dividers:!0,children:[e.jsxs(qt,{component:"fieldset",fullWidth:!0,children:[e.jsx(je,{component:"legend",children:"Select IP Configuration"}),e.jsxs(zt,{row:!0,value:y,onChange:E=>m(E.target.value),children:[e.jsx(Le,{value:"dhcp",control:e.jsx(gt,{}),label:"DHCP"}),e.jsx(Le,{value:"static",control:e.jsx(gt,{}),label:"Static"})]})]}),y==="static"&&e.jsxs(Fe,{container:!0,spacing:2,sx:{mt:2},children:[e.jsx(Fe,{size:6,children:e.jsx(de,{label:"IP Address",fullWidth:!0,value:t.ip,onChange:W("ip")})}),e.jsx(Fe,{size:6,children:e.jsx(de,{label:"Subnet Mask",fullWidth:!0,value:t.subnet,onChange:W("subnet")})}),e.jsx(Fe,{size:6,children:e.jsx(de,{label:"Gateway",fullWidth:!0,value:t.gateway,onChange:W("gateway")})}),e.jsx(Fe,{size:6,children:e.jsx(de,{label:"DNS Server",fullWidth:!0,value:t.dns,onChange:W("dns")})})]})]}),e.jsxs(He,{children:[e.jsx(oe,{onClick:u,children:"Cancel"}),e.jsx(oe,{variant:"contained",onClick:C,children:"Save"})]})]})},Tn=({open:o,onClose:c,onSave:d})=>{const[n,s]=r.useState(""),[y,m]=r.useState(""),t=$=>{s($.target.value)},x=$=>{m($.target.value)},W=n.length>0&&n===y,u=()=>{c()},C=()=>{W&&(d(n),c())},E=()=>{d(""),c()};return e.jsxs(Ie,{open:o,onClose:($,T)=>{T==="backdropClick"||T==="escapeKeyDown"||c()},maxWidth:"sm",style:{maxWidth:"500px",margin:"auto"},disableEscapeKeyDown:!0,children:[e.jsx(De,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"32px",width:"32px"}}),e.jsx("h4",{style:{margin:0},children:"Change Password"})]})}),e.jsx(Ne,{dividers:!0,children:e.jsx(qt,{component:"fieldset",fullWidth:!0,sx:{margin:0,padding:0,gap:"20px"},children:e.jsxs(Fe,{container:!0,spacing:2,sx:{mt:2},children:[e.jsx(Fe,{size:12,children:e.jsx(de,{type:"password",autoComplete:"new-password",label:"New Password",size:"small",variant:"outlined",fullWidth:!0,value:n,onChange:t})}),e.jsx(Fe,{size:12,children:e.jsx(de,{type:"password",autoComplete:"new-password",label:"Confirm Password",size:"small",variant:"outlined",fullWidth:!0,value:y,onChange:x,error:y!==""&&n!==y,helperText:y!==""&&n!==y?"Passwords do not match":""})})]})})}),e.jsxs(He,{children:[e.jsx(oe,{onClick:u,children:"Cancel"}),e.jsx(oe,{variant:"contained",onClick:C,disabled:!W,children:"Change"}),e.jsx(oe,{variant:"contained",onClick:E,children:"Reset"})]})]})};function $n(){const{online:o,addListener:c,removeListener:d,sendMessage:n,getUniqueId:s}=r.useContext(fe),[y,m]=r.useState(null),[t,x]=r.useState(null),W=r.useRef(s());return r.useEffect(()=>{const u=C=>{C.src==="Matterbridge"&&C.dst==="Frontend"&&(C.method==="refresh_required"&&C.response.changed==="settings"&&(i&&console.log(`Settings received refresh_required: changed=${C.response.changed} and sending /api/settings request`),n({id:W.current,sender:"Settings",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}})),C.method==="/api/settings"&&(i&&console.log("Settings received /api/settings:",C.response),m(C.response.matterbridgeInformation),x(C.response.systemInformation)))};return c(u,W.current),i&&console.log("Settings added WebSocket listener"),()=>{d(u),i&&console.log("Settings removed WebSocket listener")}},[c,d,n]),r.useEffect(()=>{o&&(i&&console.log("Settings received online"),n({id:W.current,sender:"Settings",method:"/api/settings",src:"Frontend",dst:"Matterbridge",params:{}}))},[o,n]),y?(i&&console.log("Settings rendering..."),o?e.jsx("div",{className:"MbfPageDiv",children:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"20px",width:"100%"},children:[e.jsx(Rn,{matterbridgeInfo:y,systemInfo:t}),e.jsx(Hn,{matterbridgeInfo:y}),e.jsx(On,{matterbridgeInfo:y})]})}):e.jsx(Oe,{})):null}function Rn({matterbridgeInfo:o,systemInfo:c}){const{sendMessage:d,getUniqueId:n}=r.useContext(fe),[s,y]=r.useState("bridge"),[m,t]=r.useState("Info"),[x,W]=r.useState(!1),[u,C]=r.useState("dark"),[E,$]=r.useState(localStorage.getItem("homePagePlugins")!=="false"),[T,V]=r.useState(localStorage.getItem("homePageMode")??"devices"),[f,O]=r.useState(localStorage.getItem("virtualMode")??"outlet"),b=r.useRef(n()),[v,w]=r.useState(!1),H=()=>w(!1),j=G=>{i&&console.log("handleSaveNetConfig called with config:",G),d({id:b.current,sender:"Settings",method:"/api/shellynetconfig",src:"Frontend",dst:"Matterbridge",params:G})},[M,U]=r.useState(!1),a=()=>U(!1),l=G=>{i&&console.log("handleSaveChangePassword called with password:",G),d({id:b.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setpassword",value:G}})};r.useEffect(()=>{o&&(y(o.bridgeMode==="bridge"?"bridge":"childbridge"),t(o.loggerLevel.charAt(0).toUpperCase()+o.loggerLevel.slice(1)),W(o.fileLogger),O(o.virtualMode))},[o]),r.useEffect(()=>{const G=localStorage.getItem("frontendTheme");G&&C(G)},[]);const g=G=>{i&&console.log("handleChangeBridgeMode called with value:",G.target.value),y(G.target.value),d({id:b.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setbridgemode",value:G.target.value}})},h=G=>{i&&console.log("handleChangeMbLoggerLevel called with value:",G.target.value),t(G.target.value),d({id:b.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmbloglevel",value:G.target.value}})},L=G=>{i&&console.log("handleLogOnFileMbChange called with value:",G.target.checked),W(G.target.checked),d({id:b.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmblogfile",value:G.target.checked}})},X=G=>{const ne=G.target.value;i&&console.log("handleChangeTheme called with value:",ne),C(ne),localStorage.setItem("frontendTheme",ne),document.body.setAttribute("frontend-theme",ne)},be=G=>{const ne=G.target.checked;i&&console.log("handleChangeHomePagePlugins called with value:",ne),$(ne),localStorage.setItem("homePagePlugins",ne?"true":"false")},he=G=>{const ne=G.target.value;i&&console.log("handleChangeHomePageMode called with value:",ne),V(ne),localStorage.setItem("homePageMode",ne)},ge=G=>{const ne=G.target.value;i&&console.log("handleChangeVirtualMode called with value:",ne),O(ne),localStorage.setItem("virtualMode",ne),d({id:b.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setvirtualmode",value:ne}})};return!o||!c?null:e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge settings"})}),e.jsx(Ln,{open:v,ip:c.ipv4Address,onClose:H,onSave:j}),e.jsx(Tn,{open:M,onClose:a,onSave:l}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(Y,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(je,{style:{padding:"0px",margin:"0px"},id:"matterbridgeInfo-mode",children:"Matterbridge mode:"}),e.jsxs(zt,{row:!0,name:"mode-buttons-group",value:s,onChange:g,children:[e.jsx(Le,{value:"bridge",control:e.jsx(gt,{}),label:"Bridge",disabled:o.readOnly===!0}),e.jsx(Le,{value:"childbridge",control:e.jsx(gt,{}),label:"Childbridge",disabled:o.readOnly===!0})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(je,{style:{padding:"0px",margin:"0px"},id:"mblogger-level-label",children:"Logger level:"}),e.jsxs(Ue,{style:{height:"30px"},labelId:"mblogger-level-label",id:"mblogger-level",value:m,onChange:h,children:[e.jsx(D,{value:"Debug",children:"Debug"}),e.jsx(D,{value:"Info",children:"Info"}),e.jsx(D,{value:"Notice",children:"Notice"}),e.jsx(D,{value:"Warn",children:"Warn"}),e.jsx(D,{value:"Error",children:"Error"}),e.jsx(D,{value:"Fatal",children:"Fatal"})]}),e.jsx(Le,{style:{padding:"0px",margin:"0px"},control:e.jsx(Te,{checked:x,onChange:L,name:"logOnFileMb"}),label:"Log on file:",labelPlacement:"start"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(je,{style:{padding:"0px",margin:"0px"},id:"frontend-theme-label",children:"Frontend theme:"}),e.jsxs(Ue,{style:{height:"30px"},labelId:"frontend-theme-label",id:"frontend-theme",value:u,onChange:X,children:[e.jsx(D,{value:"classic",children:"Classic"}),e.jsx(D,{value:"light",children:"Light"}),e.jsx(D,{value:"dark",children:"Dark"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(je,{style:{padding:"0px",margin:"0px"},id:"frontend-home-plugin-label",children:"Home page plugins:"}),e.jsx(Te,{checked:E,onChange:be,name:"showPlugins"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"5px"},children:[e.jsx(je,{style:{padding:"0px",margin:"0px"},id:"frontend-home-label",children:"Home page bottom panel:"}),e.jsxs(Ue,{style:{height:"30px"},labelId:"frontend-home-label",id:"frontend-home",value:T,onChange:he,children:[e.jsx(D,{value:"logs",children:"Logs"}),e.jsx(D,{value:"devices",children:"Devices"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"10px"},children:[e.jsx(je,{style:{padding:"0px",margin:"0px"},id:"frontend-virtual-label",children:"Virtual devices:"}),e.jsxs(Ue,{style:{height:"30px"},labelId:"frontend-virtual-label",id:"frontend-virtual",value:f,onChange:ge,children:[e.jsx(D,{value:"disabled",children:"Disabled"}),e.jsx(D,{value:"outlet",children:"Outlet"}),e.jsx(D,{value:"light",children:"Light"}),e.jsx(D,{value:"switch",children:"Switch"}),e.jsx(D,{value:"mounted_switch",children:"Mounted Switch"})]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"20px"},children:e.jsx(oe,{variant:"contained",color:"primary",onClick:()=>U(!0),children:"Change password"})}),o.shellyBoard&&e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginTop:"20px"},children:e.jsx(oe,{variant:"contained",color:"primary",onClick:()=>w(!0),children:"Configure IP"})})]})})]})}function Hn({matterbridgeInfo:o}){const{sendMessage:c,getUniqueId:d}=r.useContext(fe),[n,s]=r.useState("Info"),[y,m]=r.useState(!1),[t,x]=r.useState(""),[W,u]=r.useState(""),[C,E]=r.useState(""),[$,T]=r.useState(""),[V,f]=r.useState(""),[O,b]=r.useState(""),v=r.useRef(d());r.useEffect(()=>{o&&(s(["Debug","Info","Notice","Warn","Error","Fatal"][o.matterLoggerLevel]),m(o.matterFileLogger),x(o.matterMdnsInterface||""),u(o.matterIpv4Address||""),E(o.matterIpv6Address||""),T(o.matterPort?o.matterPort.toString():""),f(o.matterDiscriminator?o.matterDiscriminator.toString():""),b(o.matterPasscode?o.matterPasscode.toString():""))},[o]);const w=h=>{i&&console.log("handleChangeMjLoggerLevel called with value:",h.target.value),s(h.target.value),c({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmjloglevel",value:h.target.value}})},H=h=>{i&&console.log("handleLogOnFileMjChange called with value:",h.target.checked),m(h.target.checked),c({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmjlogfile",value:h.target.checked}})},j=h=>{i&&console.log("handleChangeMdnsInterface called with value:",h.target.value),x(h.target.value),c({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmdnsinterface",value:h.target.value}})},M=h=>{i&&console.log("handleChangeIpv4Address called with value:",h.target.value),u(h.target.value),c({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setipv4address",value:h.target.value}})},U=h=>{i&&console.log("handleChangeIpv6Address called with value:",h.target.value),E(h.target.value),c({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setipv6address",value:h.target.value}})},a=h=>{i&&console.log("handleChangeMatterPort called with value:",h.target.value),T(h.target.value),c({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterport",value:h.target.value}})},l=h=>{i&&console.log("handleChangeMatterDiscriminator called with value:",h.target.value),f(h.target.value),c({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterdiscriminator",value:h.target.value}})},g=h=>{i&&console.log("handleChangemMatterPasscode called with value:",h.target.value),b(h.target.value),c({id:v.current,sender:"Settings",method:"/api/config",src:"Frontend",dst:"Matterbridge",params:{name:"setmatterpasscode",value:h.target.value}})};return o?e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matter settings"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(Y,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(je,{style:{padding:"0px",margin:"0px"},id:"mjdebug-info",children:"Logger level:"}),e.jsxs(Ue,{style:{height:"30px"},labelId:"select-mjlevel",id:"mjdebug-level",value:n,onChange:w,children:[e.jsx(D,{value:"Debug",children:"Debug"}),e.jsx(D,{value:"Info",children:"Info"}),e.jsx(D,{value:"Notice",children:"Notice"}),e.jsx(D,{value:"Warn",children:"Warn"}),e.jsx(D,{value:"Error",children:"Error"}),e.jsx(D,{value:"Fatal",children:"Fatal"})]}),e.jsx(Le,{style:{padding:"0px",margin:"0px"},control:e.jsx(Te,{checked:y,onChange:H,name:"logOnFileMj"}),label:"Log on file:",labelPlacement:"start"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(je,{style:{padding:"0px",margin:"0px"},children:"Mdns interface:"}),e.jsx(de,{value:t,onChange:j,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:o.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(je,{style:{padding:"0px",margin:"0px"},children:"Ipv4 address:"}),e.jsx(de,{value:W,onChange:M,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:o.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(je,{style:{padding:"0px",margin:"0px"},children:"Ipv6 address:"}),e.jsx(de,{value:C,onChange:U,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:o.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(je,{style:{padding:"0px",margin:"0px"},children:"Commissioning port:"}),e.jsx(de,{value:$,onChange:a,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:o.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(je,{style:{padding:"0px",margin:"0px"},children:"Commissioning discriminator:"}),e.jsx(de,{value:V,onChange:l,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:o.readOnly===!0,style:{height:"30px",padding:"0"}}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx(je,{style:{padding:"0px",margin:"0px"},children:"Commissioning passcode:"}),e.jsx(de,{value:O,onChange:g,size:"small",variant:"outlined",style:{height:"30px",flexGrow:1},InputProps:{readOnly:o.readOnly===!0,style:{height:"30px",padding:"0"}}})]})]})})]}):null}function On({matterbridgeInfo:o}){return o?e.jsxs("div",{className:"MbfWindowDiv",style:{flex:"0 0 auto"},children:[e.jsx("div",{className:"MbfWindowHeader",children:e.jsx("p",{className:"MbfWindowHeaderText",children:"Matterbridge info"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",flex:"0 0 auto"},children:e.jsxs(Y,{sx:{gap:"10px",margin:"0px",padding:"10px",width:"400px",backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)"},children:["          ",e.jsx(Re,{value:o.matterbridgeVersion,label:"Current Version"}),e.jsx(Re,{value:o.matterbridgeLatestVersion,label:"Latest Version"}),e.jsx(Re,{value:o.homeDirectory,label:"Home Directory"}),e.jsx(Re,{value:o.rootDirectory,label:"Root Directory"}),e.jsx(Re,{value:o.matterbridgeDirectory,label:"Matterbridge Storage Directory"}),e.jsx(Re,{value:o.matterbridgePluginDirectory,label:"Matterbridge Plugin Directory"}),e.jsx(Re,{value:o.globalModulesDirectory,label:"Global Module Directory"})]})})]}):null}function Re({value:o,label:c}){return e.jsx(de,{focused:!0,value:o,size:"small",label:c,variant:"standard",sx:{width:"400px"},InputProps:{readOnly:!0,sx:{color:"var(--div-text-color)","&:before":{borderBottomColor:"var(--main-label-color)"},"&:after":{borderBottomColor:"var(--main-label-color)"}}},InputLabelProps:{sx:{marginTop:"3px",color:"var(--main-label-color)","&.Mui-focused":{color:"var(--main-label-color)"}}}})}const Vn=r.memo($n);function En(){const{online:o,sendMessage:c,addListener:d,removeListener:n,getUniqueId:s}=r.useContext(fe),{showSnackbarMessage:y}=r.useContext(Be),[m,t]=r.useState(null),[x,W]=r.useState([]),[u,C]=r.useState([]),[E,$]=r.useState(null),[T,V]=r.useState({cpuUsage:0}),[f,O]=r.useState({totalMemory:"",freeMemory:"",heapTotal:"",heapUsed:"",external:"",arrayBuffers:"",rss:""}),[b,v]=r.useState({systemUptime:"",processUptime:""}),w=r.useRef(s());return console.log("Test uniqueId:",w),r.useEffect(()=>{console.log("Test useEffect WebSocketMessage mounting");const H=j=>{if(j.method==="restart_required")console.log("Test received restart_required"),y("Restart required",0);else if(j.method==="refresh_required")console.log(`Test received refresh_required: changed=${j.response.changed} and sending api requests`),y("Refresh required",0),c({id:w.current,method:"/api/settings",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:w.current,method:"/api/plugins",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:w.current,method:"/api/devices",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}});else if(j.method==="memory_update")console.log("Test received memory_update",j),O(j.response);else if(j.method==="cpu_update")console.log("Test received cpu_update",j),V(j.response);else if(j.method==="uptime_update")console.log("Test received uptime_update",j),v(j.response);else if(j.method==="/api/settings"&&j.response)console.log("Test received /api/settings:",j.response),y("Test received /api/settings",0),t(j.response);else if(j.method==="/api/plugins"&&j.response)console.log(`Test received ${j.response.length} plugins:`,j.response),y("Test received /api/plugins",0),W(j.response);else if(j.method==="/api/devices"&&j.response){console.log(`Test received ${j.response.length} devices:`,j.response),y("Test received /api/devices",0),C(j.response);for(const M of j.response)console.log("Test sending /api/clusters for device:",M.pluginName,M.name,M.endpoint),c({id:w.current,method:"/api/clusters",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{plugin:M.pluginName,endpoint:M.endpoint||0}})}else j.method==="/api/clusters"&&j.response&&(console.log(`Test received ${j.response.clusters.length} clusters for device ${j.response.deviceName} endpoint ${j.response.endpoint}:`,j),y(`Test received /api/clusters for ${j.response.plugin}::${j.response.deviceName}`,0),$(j.response))};return d(H,w.current),console.log("Test useEffect WebSocketMessage mounted"),()=>{console.log("Test useEffect WebSocketMessage unmounting"),n(H),console.log("Test useEffect WebSocketMessage unmounted")}},[d,n,c,y]),r.useEffect(()=>(console.log("Test useEffect online mounting"),o&&(console.log("Test useEffect online received online"),c({id:w.current,method:"/api/settings",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:w.current,method:"/api/plugins",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}}),c({id:w.current,method:"/api/devices",sender:"Test",src:"Frontend",dst:"Matterbridge",params:{}})),console.log("Test useEffect online mounted"),()=>{console.log("Test useEffect online unmounted")}),[o,c,y]),console.log("Test rendering..."),o?e.jsx("div",{className:"MbfPageDiv",style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"20px",width:"100%"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"256px",width:"256px",margin:"10px"}}),e.jsx("p",{children:"Welcome to the Test page of the Matterbridge frontend"})]})}):e.jsx(Oe,{})}const An=r.memo(En);function _n(o,c){i&&console.log("getCssVariable:",o,"defaultValue",c);const d=getComputedStyle(document.body).getPropertyValue(o).trim();return d||console.error("getCssVariable: undefined",d),d||c}function qn(o){return Zr({palette:{primary:{main:o},action:{disabled:"var(--main-label-color)"},text:{disabled:"var(--main-label-color)"}},typography:{fontFamily:"Roboto, Helvetica, Arial, sans-serif"},components:{MuiDialog:{styleOverrides:{paper:{color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)",border:"2px solid var(--div-border-color)",borderRadius:"var(--div-border-radius)",boxShadow:"2px 2px 5px var(--div-shadow-color)"}}},MuiTooltip:{defaultProps:{placement:"top-start",arrow:!0}},MuiButton:{styleOverrides:{root:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)","&:hover":{backgroundColor:"var(--main-button-bg-color)"},"&.Mui-disabled":{color:"var(--main-button-color)",backgroundColor:"var(--main-grey-color)"}},contained:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},outlined:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)"},text:{color:"var(--main-button-color)"}},defaultProps:{variant:"contained",size:"small"}},MuiIconButton:{styleOverrides:{root:{color:"var(--main-icon-color)","&:hover .MuiSvgIcon-root":{color:"var(--primary-color)"}}}},MuiCheckbox:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-checked":{color:"var(--primary-color)"}}}},MuiTextField:{defaultProps:{size:"small",variant:"outlined",fullWidth:!0}},MuiOutlinedInput:{styleOverrides:{root:{backgroundColor:"var(--div-bg-color)","& .MuiOutlinedInput-notchedOutline":{borderColor:"var(--main-label-color)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"var(--main-text-color)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"var(--primary-color)"},padding:"0px"},input:{color:"var(--div-text-color)",padding:"4px 8px"}}},MuiInputLabel:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-focused":{color:"var(--primary-color)"}}}},MuiFormLabel:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-focused":{color:"var(--main-label-color)"}}}},MuiFormControl:{styleOverrides:{root:{color:"var(--main-grey-color)"}}},MuiRadio:{styleOverrides:{root:{color:"var(--main-label-color)","&.Mui-checked":{color:"var(--primary-color)"}}}},MuiSelect:{styleOverrides:{root:{backgroundColor:"var(--div-bg-color)",color:"var(--div-text-color)",height:"30px","&:hover":{borderColor:"var(--main-text-color)"},"&.Mui-focused":{borderColor:"var(--primary-color)"}}}},MuiMenu:{styleOverrides:{paper:{backgroundColor:"var(--main-menu-bg-color)",padding:"0px",margin:"0px"},list:{padding:"0px"}}},MuiMenuItem:{styleOverrides:{root:{color:"var(--main-menu-color)",backgroundColor:"var(--main-menu-bg-color)","&:hover":{backgroundColor:"var(--main-menu-hover-color)"},"&.Mui-selected":{color:"var(--main-menu-color)",backgroundColor:"var(--main-menu-bg-color)"},"&.Mui-selected:hover":{backgroundColor:"var(--main-menu-hover-color)"}}}},MuiListItemButton:{styleOverrides:{root:{cursor:"pointer","&:hover":{backgroundColor:"var(--main-bg-color)"}}}},MuiListItemIcon:{styleOverrides:{root:{color:"var(--div-text-color)"}}},MuiListItemText:{styleOverrides:{primary:{fontSize:"16px",fontWeight:"bold",color:"var(--div-text-color)"},secondary:{fontSize:"14px",fontWeight:"normal",color:"var(--div-text-color)"}}}}})}let i=!1;const zn=()=>{i=!i};function Un({setLoggedIn:o}){const[c,d]=r.useState(""),[n,s]=r.useState(""),y={display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",backgroundColor:"var(--main-bg-color)"},m={display:"flex",flexDirection:"column",maxWidth:"400px",margin:"0 auto",padding:"20px",gap:"20px",border:"1px solid var(--div-border-color)",borderRadius:"var(--div-border-radius)",boxShadow:"2px 2px 5px var(--div-shadow-color)",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},t={margin:"10px 0",padding:"3px 3px",fontSize:"14px",width:"230px",border:"1px solid var(--main-label-color)",color:"var(--div-text-color)",backgroundColor:"var(--div-bg-color)"},x=async u=>{try{const C=await fetch("./api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:u})});if(C.ok){const{valid:E}=await C.json();E?o(!0):u!==""&&s("Incorrect password!")}else console.error("Failed to log in:",C.statusText)}catch(C){console.error("Failed to log in:",C)}},W=u=>{u.preventDefault(),x(c)};return x(""),e.jsx("div",{style:y,children:e.jsxs("form",{onSubmit:W,style:m,children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"20px"},children:[e.jsx("img",{src:"matterbridge.svg",alt:"Matterbridge Logo",style:{height:"64px",width:"64px"}}),e.jsx("h3",{style:{color:"var(--div-text-color)"},children:"Welcome to Matterbridge"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:"20px"},children:[e.jsx("input",{type:"text",name:"username",autoComplete:"username",style:{display:"none"},tabIndex:-1}),e.jsx("input",{type:"password",value:c,onChange:u=>d(u.target.value),style:t,placeholder:"password",autoComplete:"current-password"}),e.jsx("button",{type:"submit",style:{color:"var(--main-button-color)",backgroundColor:"var(--main-button-bg-color)",borderColor:"var(--div-bg-color)"},children:"Log in"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",margin:0,height:"30px"},children:n&&e.jsx("p",{style:{color:"red"},children:n})})]})})}function Bn(){const[o,c]=r.useState(!1);i&&console.log("Setting frontend theme");const d=localStorage.getItem("frontendTheme");i&&console.log("Saved theme:",d),d?document.body.setAttribute("frontend-theme",d):document.body.setAttribute("frontend-theme","dark");const n=_n("--primary-color","#1976d2");i&&console.log("Primary color from CSS:",n);const s=qn(n),y=window.location.pathname.includes("/matterbridge/")?"/matterbridge":window.location.href.includes("/api/hassio_ingress/")?window.location.pathname:"/";return i&&(console.log("Loading App..."),console.log("- production mode"),console.log(`- with href = "${window.location.href}"`),console.log(`- pathname = "${window.location.pathname}"`),console.log(`- baseName = "${y}"`)),o?e.jsx(eo,{theme:s,children:e.jsx(cr,{dense:!0,maxSnack:10,preventDuplicate:!0,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(Ro,{children:e.jsx(Ho,{children:e.jsx(nr,{basename:y,children:e.jsxs("div",{className:"MbfScreen",children:[e.jsx(Vo,{}),e.jsxs(ir,{children:[e.jsx(Ve,{path:"/",element:e.jsx(cn,{})}),e.jsx(Ve,{path:"/devices",element:e.jsx(Pn,{})}),e.jsx(Ve,{path:"/log",element:e.jsx(Fn,{})}),e.jsx(Ve,{path:"/settings",element:e.jsx(Vn,{})}),e.jsx(Ve,{path:"/test",element:e.jsx(An,{})}),e.jsx(Ve,{path:"*",element:e.jsx(sr,{to:"/"})})]})]})})})})})}):e.jsx(Un,{setLoggedIn:c})}ar.createRoot(document.getElementById("root")).render(e.jsx(lr.StrictMode,{children:e.jsx(Bn,{})}));
